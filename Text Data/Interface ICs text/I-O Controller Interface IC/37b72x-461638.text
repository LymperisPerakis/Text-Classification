                                                                      FDC37B72x
    128 Pin Enhanced Super I/O Controller with
                                     ACPI Support
                                          FEATURES
• 5 Volt Operation                                 -   Port 92 Support
• PC98/99 and ACPI 1.0 Compliant                   -   Fast Gate A20 and Hardware Keyboard
• Battery Back-up for Wake-Events                      Reset
• ISA Host Interface                           •   2.88MB Super I/O Floppy Disk Controller
• ISA Plug-and-Play Compatible Register            -   Relocatable to 480 Different Addresses
  Set                                              -   Licensed CMOS 765B Floppy Disk
  -     12 IRQ Options                                 Controller
  -     15 Serial IRQ Options                      -   Advanced Digital Data Separator
  -     16 Bit Address Qualification               -   SMSC's Proprietary 82077AA
  -     Four DMA Options                               Compatible Core
  -     12mA AT Bus Drivers                        -   Sophisticated Power Control Circuitry
• BIOS Buffer                                          (PCC) Including Multiple Powerdown
• 20 GPI/O Pins                                        Modes for Reduced Power Consumption
                                                   -   Supports Two Floppy Drives Directly
• 32 kHz Standby Clock Output
                                                   -   Software Write Protect
• Soft Power Management
                                                   -   FDC on Parallel Port
• ACPI/PME Support                                 -   Low Power CMOS Design
• SCI/SMI Support                                  -   Supports Vertical Recording Format
  -     Watchdog timer                             -   16 Byte Data FIFO
  -     Power Button Override Event                -   100% IBM® Compatibility
  -     Either Edge Triggered Interrupts           -   Detects All Overrun and Underrun
• Intelligent Auto Power Management                    Conditions
  -     Shadowed Write-only Registers              -   24mA Drivers and Schmitt Trigger Inputs
  -     Programmable Wake-up Event             •   Enhanced FDC Digital Data Separator
        Interface                                  -   Low Cost Implementation
• 8042 Keyboard Controller                         -   No Filter Components Required
  -     2K Program ROM                             -   2 Mbps, 1 Mbps, 500 Kbps, 300 Kbps,
  -     256 Bytes Data RAM                             250 Kbps Data Rates
  -     Asynchronous Access to Two Data            -   Programmable Precompensation Modes
        Registers and One Status Register      •   Serial Ports
  -     Supports Interrupt and Polling             -   Relocatable to 480 Different Addresses
        Access
  -     8 Bit Timer/Counter


  - Two High Speed NS16C550A            • Multi-Mode™ Parallel Port with ChiProtect™
    Compatible UARTs with                 -    Relocatable to 480 Different Addresses
    Send/Receive 16 Byte FIFOs            -    Standard Mode
  - Programmable Baud Rate                -    IBM PC/XT®, PC/AT®, and PS/2™
    Generator                                  Compatible Bidirectional ParallelPort
  - Modem Control Circuitry Including     -    Enhanced Mode
    230K and 460K Baud                    -    Enhanced Parallel Port (EPP)
-   IrDA 1.0, HP-SIR, ASK-IR Support           Compatible EPP 1.7 and EPP 1.9 (IEEE
-   Ring Wake Filter                           1284 Compliant)
                                          -    High Speed Mode
                                          -    Microsoft and Hewlett Packard
                                               Extended Capabilities Port (ECP)
                                               Compatible (IEEE 1284 Compliant)
                                          -    Incorporates ChiProtect™ Circuitry for
                                               Protection Against Damage Due to
                                               Printer Power-On
                                          -    14 mA Output Drivers
                                        •  128 Pin QFP Package
                                      2


                                                 TABLE OF CONTENTS
FEATURES ........................................................................................................................................... 1
GENERAL DESCRIPTION ................................................................................................................. 5
DESCRIPTION OF PIN FUNCTIONS ............................................................................................... 7
      BUFFER TYPE DESCRIPTIONS............................................................................... 10
GENERAL PURPOSE I/O PINS .......................................................................................................11
REFERENCE DOCUMENTS ............................................................................................................12
FUNCTIONAL DESCRIPTION ..........................................................................................................14
      SUPER I/O REGISTERS ........................................................................................... 14
      HOST PROCESSOR INTERFACE............................................................................ 14
FLOPPY DISK CONTROLLER .........................................................................................................15
FDC INTERNAL REGISTERS ...........................................................................................................15
COMMAND SET/DESCRIPTIONS ...................................................................................................38
INSTRUCTION SET ............................................................................................................................41
      DATA TRANSFER COMMANDS ............................................................................... 53
      CONTROL COMMANDS ........................................................................................... 62
SERIAL PORT (UART) .......................................................................................................................69
      INFRARED INTERFACE ........................................................................................... 85
PARALLEL PORT ...............................................................................................................................86
      IBM XT/AT COMPATIBLE, BI-DIRECTIONAL AND EPP MODES ............................ 88
EXTENDED CAPABILITIES PARALLEL PORT .............................................................................94
      OPERATION ............................................................................................................ 102
PARALLEL PORT FLOPPY DISK CONTROLLER ......................................................................107
POWER MANAGEMENT .................................................................................................................109
      UART POWER MANAGEMENT .............................................................................. 113
      PARALLEL PORT .................................................................................................... 113
      INTERNAL PWRGOOD ........................................................................................... 113
      32.768 KHZ STANDBY CLOCK OUTPUT ................................................................ 114
SERIAL IRQ .......................................................................................................................................115
BIOS BUFFER ...................................................................................................................................120
GENERAL PURPOSE I/O ................................................................................................................121
      DESCRIPTION......................................................................................................... 121
      RUN STATE GPIO DATA REGISTER ACCESS...................................................... 122
      GPIO CONFIGURATION ......................................................................................... 122
WATCH DOG TIMER .......................................................................................................................126
                                                                     3


8042 KEYBOARD CONTROLLER DESCRIPTION .....................................................................128
SOFT POWER MANAGEMENT .....................................................................................................136
       BUTTON OVERRIDE FEATURE ............................................................................. 139
ACPI/PME/SMI FEATURES ............................................................................................................141
       ACPI FEATURES..................................................................................................... 141
       PME SUPPORT ....................................................................................................... 143
       ACPI, PME AND SMI REGISTERS ............................................................................... 143
       EITHER EDGE TRIGGERED INTERRUPTS .............................................................................. 155
CONFIGURATION ............................................................................................................................157
       SYSTEM ELEMENTS.................................................................................................... 10
       CONFIGURATION SEQUENCE................................................................................ 10
       CONFIGURATION REGISTERS .................................................................................. 162
OPERATIONAL DESCRIPTION .....................................................................................................199
       MAXIMUM GUARANTEED RATINGS* .......................................................................... 199
       DC ELECTRICAL CHARACTERISTICS ........................................................................ 199
       AC TIMING............................................................................................................... 204
       CAPACITIVE LOADING........................................................................................... 204
       ECP PARALLEL PORT TIMING .............................................................................. 229
                                                             4


                                       GENERAL DESCRIPTION
The FDC37B72x incorporates a keyboard
interface, SMSC's true CMOS 765B floppy disk           These features include support of both legacy and
controller, advanced digital data separator, 16 byte   ACPI power management models through the
data FIFO, two 16C550 compatible UARTs, one            selection of SMI or SCI. It implements a power
Multi-Mode parallel port which includes ChiProtect     button override event (4 second button hold to turn
circuitry plus EPP and ECP support, on-chip 12         off the system) and either edge triggered
mA AT bus drivers, and two floppy direct drive         interrupts.
support, soft power management and SMI support
and Intelligent Power Management including             The FDC37B72x provides support for the ISA
PME and SCI/ACPI support. The true CMOS                Plug-and-Play Standard (Version 1.0a) and
765B core provides 100% compatibility with IBM         provides for the recommended functionality to
PC/XT and PC/AT architectures in addition to           support Windows '95/’98 and PC98/PC99.
providing data overflow and underflow protection.      Through internal configuration registers, each of
The SMSC advanced digital data separator               the FDC37B72x's logical device's I/O address,
incorporates SMSC's patented data separator            DMA channel and IRQ channel may be
technology, allowing for ease of testing and use.      programmed. There are 480 I/O address location
Both on-chip UARTs are compatible with the             options, 12 IRQ pin options or Serial IRQ option,
NS16C550A. The parallel port is compatible with        and four DMA channel options for each logical
IBM PC/AT architecture, as well as EPP and ECP.        device.
The FDC37B72x incorporates sophisticated power
control circuitry (PCC) which includes support for     The FDC37B72x Floppy Disk Controller and      data
keyboard, mouse, modem ring, power button              separator do not require any external          filter
support and other wake-up events. The PCC              components and are therefore easy to use,     offer
supports multiple low power down modes.                lower system cost and reduced board area.      The
                                                       FDC is software and register compatible        with
The FDC37B72x provides features for compliance         SMSC's proprietary 82077AA core.
with the “Advanced Configuration and Power
Interface Specification” (ACPI).
                                                     5


                                                                                      PD7
                                                                                      VSS
                                                                                    SLCT
                                                                                       PE
                                                                                    BUSY
                                                                                    nACK
                                                                                 nERROR
                                                                                     nALF
                                                                                nSTROBE
                                                                                    RXD1
                                                                                    TXD1
                                                                                   nDSR1
                                                                            nRTS1/SYSOP
                                                                                   nCTS1
                                                                                   nDTR1
                                                                                      nRI1
                                                                                   nDCD1
                                                                                      nRI2
                                                                                      VCC
                                                                                   nDCD2
                                                                              RXD2/IRRX
                                                                               TXD2/IRTX
                                                                                   nDSR2
                                                                                   nRTS2
                                                                                   nCTS2
                                                                                   nDTR2
                                                                            103
                                                                            104
                                                                            105
                                                                            106
                                                                            107
                                                                            108
                                                                            109
                                                                            110
                                                                            111
                                                                            112
                                                                            113
                                                                            114
                                                                            115
                                                                            116
                                                                            117
                                                                            118
                                                                            119
                                                                            120
                                                                            121
                                                                            122
                                                                            123
                                                                            124
                                                                            125
                                                                            126
                                                                            127
                                                                            128
                                                           DRVDEN0     1                                    102   PD6
                                             DRVDEN1/GP52/IRQ8/nSMI    2                                    101   PD5
                                                              nMTR0    3                                    100   PD4
                                                        nMTR1/GP16     4                                     99   PD3
                                                               nDS0    5                                     98   PD2
                                                          nDS1/GP17    6                                     97   PD1
                                                                 VSS   7                                     96   PD0
                                                                nDIR   8                                     95   nSLCTIN
                                                              nSTEP    9                                     94   nINIT
                                                            nWDATA     10                                    93   VCC
                                                            nWGATE     11                                    92   nROMOE/IRQ12/GP54/EETI
                                                             nHDSEL    12                                    91   nROMCS/IRQ11/GP53/EETI
                                                             nINDEX    13                                    90   RD7/IRQ10/GP67
                                                              nTRK0    14                                    89   RD6/IRQ8/GP66
                                                           nWRTPRT     15                                    88   RD5/IRQ7/GP65
                                                             nRDATA    16                                    87   RD4/IRQ6/GP64/P17
                                                           nDSKCHG     17                                    86   RD3/IRQ5/GP63/WDT
                                                          CLK32OUT     18                                    85   RD2/IRQ4/GP62/nRING
                                                         nPOWERON      19                                    84   RD1/IRQ3/GP61/LED
6                                                                      20
                                                         BUTTON_IN                                           83   RD0/IRQ1/GP60/nSMI
                                                      nPME/SCI/IRQ9    21                                    82   GP15/IRTX2
                                                             CLOCKI    22                                    81   GP14/IRRX2
                                                                 SA0   23                                    80   GP13/LED
                                                                 SA1   24                                    79   GP12/WDT/P17/EETI
                                                                 SA2   25                                    78   GP11/nRING/EETI
                                                                 SA3   26                                    77   GP10/nSMI
                                                                                  128 Pin QFP   FDC37M72x
                                                                 SA4   27                                    76   A20M
                                                                 SA5   28                                    75   KBDRST
                                                                 SA6   29                                    74   VSS
                                                                 SA7   30                                    73   MCLK
                                                                 SA8   31                                    72   MDAT
                                                                 SA9   32                                    71   KCLK
                                                               SA10    33                                    70   KDAT
                                                               SA11    34                                    69   VTR
                                                               SA12    35                                    68   XTAL2
    FIGURE 1 - FDC37B72x PIN CONFIGURATION
                                                               SA13    36                                    67   AVSS
                                                               SA14    37                                    66   XTAL1
                                                               SA15    38                                    65   VBAT
                                                                            64
                                                                            63
                                                                            62
                                                                            61
                                                                            60
                                                                            59
                                                                            58
                                                                            57
                                                                            56
                                                                            55
                                                                            54
                                                                            53
                                                                            52
                                                                            51
                                                                            50
                                                                            49
                                                                            48
                                                                            47
                                                                            46
                                                                            45
                                                                            44
                                                                            43
                                                                            42
                                                                            41
                                                                            40
                                                                            39
                                                                            IOCHRDY
                                                                            TC
                                                                            VCC
                                                                            DRQ3
                                                                            nDACK3
                                                                            DRQ2
                                                                            nDACK2
                                                                            DRQ1
                                                                            nDACK1
                                                                            DRQ0
                                                                            nDACK0
                                                                            RESET_DRV
                                                                            SD7
                                                                            SD6
                                                                            SD5
                                                                            SD4
                                                                            VSS
                                                                            SD3
                                                                            SD2
                                                                            SD1
                                                                            SD0
                                                                            AEN
                                                                            nIOW
                                                                            nIOR
                                                                            SER_IRQ/IRQ15
                                                                            PCI_CLK/IRQ14/GP50


DESCRIPTION OF PIN FUNCTIONS
                         TABLE 1 - DESCRIPTION OF PIN FUNCTIONS
  PIN
No./QFP                      NAME                   TOTAL    SYMBOL  BUFFER TYPE
                              PROCESSOR/HOST INTERFACE (40)
 44-47,  System Data Bus                               8   SD[0:7]       IO12
 49-52
 23-38   16-bit System Address Bus                     16  SA[0:15]         I
   43    Address Enable                                1   AEN              I
   64    I/O Channel Ready                             1   IOCHRDY      OD12
   53    ISA Reset Drive                               1   RESET_DRV       IS
   40    Serial IRQ/IRQ15                              1   SER_IRQ       IO12
   39    PCI Clock/IRQ14/GP50                          1   PCI_CLK       IO12
   55    DMA Request 0                                 1   DRQ0           O12
   57    DMA Request 1                                 1   DRQ1           O12
   59    DMA Request 2                                 1   DRQ2           O12
   54    DMA Acknowledge 0                             1   nDACK0           I
   56    DMA Acknowledge 1                             1   nDACK1           I
   58    DMA Acknowledge 2                             1   nDACK2           I
   61    DMA Request 3                                 1   DRQ3           O12
   60    DMA Acknowledge 3                             1   nDACK3           I
   63    Terminal Count                                1   TC               I
   41    I/O Read                                      1   nIOR             I
   42    I/O Write                                     1   nIOW             I
                                       CLOCKS (4)
   22    14.318MHz Clock Input                         1   CLOCKI        ICLK
   66    32.768kHz Crystal Input                       1   XTAL1         ICLK
   68    32.768kHz Crystal Driver                      1   XTAL2        OCLK2
   18    32.768kHz Clock Out                           1   CLK32OUT       O8
                                     POWER PINS (10)
 62, 93, +5V Supply Voltage                            3   VCC
  121
 7, 48,  Digital Ground                                4   VSS
74, 104
   67    Analog Ground                                 1   AVSS
   69    Trickle Supply Voltage                        1   VTR
   65    Battery Voltage                               1   VBAT
                                  POWER MANAGEMENT (3)
   19    Power On                                      1   nPOWERON     OD24
   20    Button In                                     1   BUTTON_IN        I
   21    Power Management Event/SCI/IRQ9               1   nPME           O12
                                    FDD INTERFACE (16)
   16    Read Disk Data                                1   nRDATA          IS
   11    Write Gate                                    1   nWGATE         O24
   10    Write Disk Data                               1   nWDATA         O24
                                             7


  PIN
No./QFP                     NAME                     TOTAL    SYMBOL  BUFFER TYPE
   12   Head Select                                      1  nHDSEL         O24
   8    Step Direction                                   1  nDIR           O24
   9    Step Pulse                                       1  nSTEP          O24
   17   Disk Change                                      1  nDSKCHG         IS
   5    Drive Select 0                                   1  nDS0           O24
   6    Drive Select 1/GP17                              1  nDS1          IO24
   3    Motor On 0                                       1  nMTR0          O24
   4    Motor On 1/GP16                                  1  nMTR1         IO24
   15   Write Protected                                  1  nWRTPRT         IS
   14   Track 0                                          1  nTRKO           IS
   13   Index Pulse Input                                1  nINDEX          IS
   1    Drive Density Select 0                           1  DRVDEN0        O24
   2    Drive Density Select 1/GP52/IRQ8/nSMI            1  DRVDEN1       IO24
                                  GENERAL PURPOSE I/O (6)
   77   General Purpose 10/nSMI                          1  GP10          IO12
   78   General Purpose 11/nRING/EETI (Note 4)           1  GP11           IO4
   79   General Purpose 12/WDT/P17/P12/EETI              1  GP12           IO4
        (Note 4)
   80   General Purpose 13/LED Driver                    1  GP13          IO24
   81   General Purpose 14/Infrared Rx                   1  GP14           IO4
   82   General Purpose 15/Infrared Tx (Note 3)          1  GP15          IO24
                                     BIOS INTERFACE (10)
   83   ROM Bus 0/IRQ1/GP60/nSMI                         1  RD0           IO12
   84   ROM Bus 1/IRQ3/GP61/LED                          1  RD1           IO24
   85   ROM Bus 2/IRQ4/GP62/nRING                        1  RD2           IO12
   86   ROM Bus 3/IRQ5/GP63/WDT                          1  RD3           IO12
   87   ROM Bus 4/IRQ6/GP64/P17/P12                      1  RD4           IO12
   88   ROM Bus 5/IRQ7/GP65                              1  RD5           IO12
   89   ROM Bus 6/IRQ8/GP66                              1  RD6           IO12
   90   ROM Bus 7/IRQ10/GP67                             1  RD7           IO12
   91   nROMCS/IRQ11/GP53/EETI (Note 4)                  1  nROMCS        IO12
   92   nROMOE/IRQ12/GP54/EETI (Note 4)                  1  nROMOE        IO12
                                SERIAL PORT 1 INTERFACE (8)
  112   Receive Serial Data 1                            1  RXD1             I
  113   Transmit Serial Data 1                           1  TXD1            O4
  115   Request to Send 1                                1  nRTS1/         IO4
                                                            SYSOP
  116   Clear to Send 1                                  1  nCTS1            I
  117   Data Terminal Ready 1                            1  nDTR1           O4
  114   Data Set Ready 1                                 1  nDSR1            I
  119   Data Carrier Detect 1                            1  nDCD1            I
  118   Ring Indicator 1                                 1  nRI1             I
                                SERIAL PORT 2 INTERFACE (8)
  123   Receive Serial Data 2/Infrared Rx                1  RXD2/IRRX        I
                                                8


  PIN
No./QFP                           NAME                          TOTAL        SYMBOL    BUFFER TYPE
  124      Transmit Serial Data 2/Infrared Tx (Note 3)             1       TXD2/IRTX         O24
  126      Request to Send 2                                       1       nRTS2              O4
  127      Clear to Send 2                                         1       nCTS2               I
  128      Data Terminal Ready                                     1       nDTR2              O4
  125      Data Set Ready 2                                        1       nDSR2               I
  122      Data Carrier Detect 2                                   1       nDCD2               I
  120      Ring Indicator 2                                        1       nRI2                I
                                    PARALLEL PORT INTERFACE (17)
 96-103    Parallel Port Data Bus                                  8       PD[0:7]          IOP14
   95      Printer Select                                          1       nSLCTIN           OP14
   94      Initiate Output                                         1       nINIT             OP14
  110      Auto Line Feed                                          1       nALF              OP14
  111      Strobe Signal                                           1       nSTROBE           OP14
  107      Busy Signal                                             1       BUSY                I
  108      Acknowledge Handshake                                   1       nACK                I
  106      Paper End                                               1       PE                  I
  105      Printer Selected                                        1       SLCT                I
  109      Error at Printer                                        1       nERROR              I
                                   KEYBOARD/MOUSE INTERFACE (6)
   70      Keyboard Data                                           1       KDAT             IOD16
   71      Keyboard Clock                                          1       KCLK             IOD16
   72      Mouse Data                                              1       MDAT             IOD16
   73      Mouse Clock                                             1       MCLK             IOD16
   75      Keyboard Reset                                          1       KBDRST             O4
                                                                           (Note 2)
   76      Gate A20                                                1       A20M               O4
Note 1: The “n” as the first letter of a signal name indicates an “Active Low” signal.
Note 2: KBDRST is active low.
Note 3: This pin defaults to an output and low. When configured as IRTX (or IRTX2), this pin is low when
        the IR block is not transmitting.
Note 4: EETI is the Either Edge Triggered Interrupt Input function.
                                                       9


BUFFER TYPE DESCRIPTIONS
                             TABLE 2 - BUFFER TYPES
        SYMBOL                             DESCRIPTION
       I        Input, TTL compatible.
       IS       Input with Schmitt trigger.
       ICLK     Clock Input.
       OCLK2    Clock Output, 2mA sink, 2mA source.
       IO4      Input/Output, 4mA sink, 2mA source.
       IOP4     Input/Output, 4mA sink, 2mA source. Backdrive Protected.
       O4       Output, 4mA sink, 2mA source.
       O8       Output, 8mA sink, 4mA source.
       IO12     Input/Output, 12mA sink, 6mA source.
       O12      Output, 12mA sink, 6mA source.
       OP12     Output, 12mA sink, 6mA source. Backdrive Protected.
       OD12     Output, Open Drain, 12 mA sink.
       IOP14    Input/Output, 14mA sink, 14mA source. Backdrive Protected.
       OD14     Output, Open Drain, 14mA sink.
       OP14     Output, 14mA sink, 14mA source. Backdrive Protected.
       IOD16    Input/Output, Open Drain, 16mA sink
       O24      Output, 24mA sink, 12mA source.
       OD24     Output, Open Drain, 24mA sink.
                                            10


GENERAL PURPOSE I/O PINS
                       TABLE 3 - GENERAL PURPOSE I/O PIN FUNCTIONS
PIN NO.    DEFAULT       ALTERNATE        ALTERNATE      ALTERNATE                      INDEX
  QFP      FUNCTION      FUNCTION 1       FUNCTION 2     FUNCTION 3         BUFFER       REG. GPIO
                                                                                   5
                                                                             TYPE
   77     GPIO          nSMI             -              -               IOP4/(OP12/      GP1  GP10
                                                                        OD12)
                                              1
   78     GPIO          nRING            EETI           -               IOP4/I/I         GP1  GP11
                                                 4          1
   79     GPIO          WDT              P17/P12        EETI            IOP4/O4/IO4/I    GP1  GP12
   80     GPIO          LED              -              -               IOP4/O24         GP1  GP13
   81     GPIO          IRRX2            -              -               IOP4/I           GP1  GP14
   82     GPIO          IRTX2            -              -               IOP4/O24         GP1  GP15
    4     nMTR1         GPIO             -              -               (O24/OD24)/      GP1  GP16
                                                                        IOP4
    6     nDS1          GPIO             -              -               (O24/OD24)/      GP1  GP17
                                                                        IOP4
   39     PCI_CLK       IRQ14            GPIO           -               CLKIN/(O12/      GP5  GP50
                                                                        OD12)/IOP4
    2     DRVDEN1       GPIO             IRQ8           nSMI            (O24/OD24)       GP5  GP52
                                                                        /IOP4/
                                                                        (OP12/OD12)/
                                                                        (OP12/OD12)
                   2                                        1
   91     nROMCS        IRQ11            GPIO           EETI            IO12/(O12/       GP5  GP53
                                                                        OD12)/IOP4/I
                   2                                        1
   92     nROMOE        IRQ12            GPIO           EETI            IO12/(O12/       GP5  GP54
                                                                        OD12)/IOP4/I
              2,3
   83     RD0           IRQ1             GPIO           nSMI            IO12/(O12/       GP6  GP60
                                                                        OD12)/IOP4/
                                                                        (OP12/OD12)
              2,3
   84     RD1           IRQ3             GPIO           LED             IO12/(O12/       GP6  GP61
                                                                        OD12)/IOP4/
                                                                        O24
              2,3
   85     RD2           IRQ4             GPIO           nRING           IO12/(O12/       GP6  GP62
                                                                        OD12)/IOP4/I
              2,3
   86     RD3           IRQ5             GPIO           WDT             IO12/(O12/       GP6  GP63
                                                                        OD12)/IOP4/
                                                                        O4
              2,3                                                4
   87     RD4           IRQ6             GPIO           P17/P12         IO12/(O12/       GP6  GP64
                                                                        OD12)/IOP4/
                                                                        IO4
              2,3
   88     RD5           IRQ7             GPIO           -               IO12/(O12/       GP6  GP65
                                                                        OD12)/IOP4
              2,3
   89     RD6           IRQ8             GPIO           -               IO12/(OP12/      GP6  GP66
                                                                        OD12)/IOP4
              2,3
   90     RD7           IRQ10            GPIO           -               IO12/(O12/       GP6  GP67
                                                                        OD12)/IOP4
Note 1: Either Edge Triggered Interrupt Inputs.
Note 2: At power-up, RD0-7, nROMCS and nROMOE function as the XD Bus. To use RD0-7 for alternate
        functions, nROMCS must stay high until those pins are finished being programmed.
Note 3: These pins cannot be programmed as open drain pins in their original function.
                                                   11


Note 4: The function of P17 or P12 is selected via the P17/P12 select bit in the Ring Filter Select Register
        in Logical Device 8 at 0xC6. Default is P17.
Note 5: Buffer types per function are separated by a forward slash “/”. Multiple buffer types per function
        are separated by a forward slash “/” and enclosed in parentheses; e.g., IRQ outputs can be open
        drain or push-pull and are shown as “(O12/OD12)”.
REFERENCE DOCUMENTS
   IEEE 1284 Extended Capabilities Port Protocol and ISA Standard, Rev. 1.14, July 14, 1993.
   Hardware Description of the 8042, Intel 8 bit Embedded Controller Handbook.
   PCI Bus Power Management Interface Specification, Rev. 1.0, Draft, March 18, 1997.
                                                   12


                                         nPME/SCI            nSMI*
                      SOFT                                                                     nROMOE *
   nPowerOn                                PME/                                     BIOS
                     POWER                                  nSMI                               nROMCS *
     Button_In   MANAGEMENT                ACPI                                   BUFFER       RD[0:7]*                                    PD0-7
                                                                                                                               MULTI-MODE  BUSY, SLCT, PE,
                    POWER                                                                                                       PARALLEL
                                                                                                                                PORT/FDC   nERROR , nACK
                 MANAGEMENT
                                                                           DATA BUS                                                 MUX
                                                                                                                                           nSTB, nSLCTIN ,
     SER_IRQ          SERIAL                                                                                                               nINIT, nALF
                        IRQ
      PCI_CLK
                                                      ADDRESS BUS                                                               GENERAL    GP1[0:7]*
                                                                                                                                PURPOSE    GP5[0,2:4]*
                                                                                                                                     I/O   GP6[0:7]*
          nIOR                                                                                                                             TXD1
                                                                       CONFIGURATION
                                                                                                                                  16C550
         nIOW                                                             REGISTERS
                                                                                                                              COMPATIBLE   RXD1
                                                                                                                                 SERIAL
                                                                                                                                           nDSR1, nDCD1, nRI1, nDTR1
                                                                                                                                  PORT 1
           AEN
                                                                                                                                            nCTS1, nRTS1
                                                                      CONTROL BUS
      SA[0:15]
                                                                                                                                           IRTX
      SD[O:7]
                     HOST                                                                                                                  IRRX
                                                                            WDATA
                                                                                                                                   16C550
     DRQ[0:3]         CPU                                                                                                                  TXD2(IRTX)
                                                                                                                               COMPATIBLE
                                                                            WCLOCK                                                 SERIAL
                   INTERFACE                                                                                                               RXD2(IRRX)
  nDACK [0:3]                                                                                                                  PORT 2 WITH
                                                                SMSC                                                             INFRARED  nDSR2, nDCD2, nRI2, nDTR2
                                                           PROPRIETARY                   DIGITAL
            TC                                                 82077                      DATA                                              nCTS2, nRTS2
                                                            COMPATIBLE                 SEPARATOR
                                                                                       WITH WRITE
IRQ[1,3-12,14]                                               VERTICAL
                                                                                         PRECOM-
                                                           FLOPPYDISK                                                                       KCLK
                                                                                        PENSATION
                                                           CONTROLLER
 RESET_DRV                                                                                                                                  KDATA
                                                               CORE
                                                                            RCLOCK                                                          MCLK
                                                                                                                                    8042
    IOCHRDY                                                                                                                                 MDATA
                                                                             RDATA
                                                                                                                                            P20, P21
                                                                                                                                            P17/P12*
                                                                                                                                                 CLK32OUT
                                                    nINDEX    DENSEL     nDS0,1                                                   CLOCK
                                                     nTRK0                                                                          GEN          CLOCKI
                                                                 nDIR    nMTR0,1
                                                                                  nWDATA     nRDATA                                              (14.318)
                                                  nDSKCHG
                                                                nSTEP   DRVDEN0
                                                   nWRPRT                                                                                  XTAL1
                                                                        DRVDEN1
                                                               nHDSEL
                                                   nWGATE
                                                                                                                                           XTAL2
               VCC     VTR   VBAT VSS                                                      *Multi-Function I/O Pin - Optional
                                      FIGURE 2 - FDC37B72x BLOCK DIAGRAM
                                                                             13


                                     FUNCTIONAL DESCRIPTION
SUPER I/O REGISTERS                                       HOST PROCESSOR INTERFACE
The address map, shown below in Table 1, shows            The host processor communicates with the
the addresses of the different blocks of the Super        FDC37B72x through a series of read/write
I/O immediately after power up.           The base        registers. The port addresses for these registers
addresses of the FDC, serial and parallel ports can       are shown in Table 1.            Register access is
be moved via the configuration registers. Some            accomplished through programmed I/O or DMA
addresses are used to access more than one                transfers. All registers are 8 bits wide. All host
register.                                                 interface output buffers are capable of sinking a
                                                          minimum of 12 mA.
                               TABLE 4 - SUPER I/O BLOCK ADDRESSES
                                                                       LOGICAL
                    ADDRESS                    BLOCK NAME               DEVICE            NOTES
          Base+(0-5) and +(7)               Floppy Disk                     0
                                            Parallel Port                   3
          Base+(0-3)                        SPP
          Base+(0-7)                        EPP
          Base+(0-3), +(400-402)            ECP
          Base+(0-7), +(400-402)            ECP+EPP+SPP
          Base+(0-7)                        Serial Port Com 1               4
          Base+(0-7)                        Serial Port Com 2               5         IR Support
          60, 64                            KYBD                            7
          Base + (0-17h)                    ACPI, PME, SMI                  A
          Base + (0-1)                      Configuration
          Note 1: Refer to the configuration register descriptions for setting the base address
                                                       14


FLOPPY DISK CONTROLLER                                  The FDC is compatible to the 82077AA using
                                                        SMSC's proprietary floppy disk controller core.
The Floppy Disk Controller (FDC) provides the
interface between a host microprocessor and the         FDC INTERNAL REGISTERS
floppy disk drives.      The FDC integrates the
functions of the Formatter/Controller, Digital Data     The Floppy Disk Controller contains eight internal
Separator, Write Precompensation and Data Rate          registers that facilitate the interfacing between the
Selection logic for an IBM XT/AT compatible FDC.        host microprocessor and the disk drive. TABLE 5
The true CMOS 765B core guarantees 100% IBM             shows the addresses required to access these
PC XT/AT compatibility in addition to providing         registers. Registers other than the ones shown are
data overflow and underflow protection.                 not supported.        The rest of the description
                                                        assumes that the primary addresses have been
                                                        selected.
                         TABLE 5 - STATUS, DATA AND CONTROL REGISTERS
                              (Shown with base addresses of 3F0 and 370)
            PRIMARY          SECONDARY
            ADDRESS           ADDRESS            R/W                     REGISTER
                3F0              370               R      Status Register A (SRA)
                3F1              371               R      Status Register B (SRB)
                3F2              372             R/W      Digital Output Register (DOR)
                3F3              373             R/W      Tape Drive Register (TSR)
                3F4              374               R      Main Status Register (MSR)
                3F4              374               W      Data Rate Select Register (DSR)
                3F5              375             R/W      Data (FIFO)
                3F6              376                      Reserved
                3F7              377               R      Digital Input Register (DIR)
                3F7              377               W      Configuration Control Register (CCR)
                                                     15


STATUS REGISTER A (SRA)                                     accessed at any time when in PS/2 mode. In the
                                                            PC/AT mode the data bus pins D0 - D7 are held in
Address 3F0 READ ONLY                                       a high impedance state for a read of address 3F0.
This register is read-only and monitors the state of
the FINTR pin and several disk interface pins in            PS/2 Mode
PS/2 and Model 30 modes. The SRA can be
                            7            6         5         4         3        2        1        0
                           INT        nDRV2     STEP     nTRK0 HDSEL nINDX             nWP       DIR
                       PENDING
           RESET            0            1         0       N/A         0       N/A      N/A       0
            COND.
BIT 0 DIRECTION                                             Active low status of the TRK0 disk interface input.
Active high status indicating the direction of head
movement. A logic "1" indicates inward direction; a         BIT 5 STEP
logic "0" indicates outward direction.                      Active high status of the STEP output disk
                                                            interface output pin.
BIT 1 nWRITE PROTECT
Active low status of the WRITE PROTECT disk                 BIT 6 nDRV2
interface input. A logic "0" indicates that the disk is     Active low status of the DRV2 disk interface input
write protected. (See also Force Write Protect              pin, indicating that a second drive has been
Function)                                                   installed. Note: This function is not supported
                                                            in this chip. (Always 1, indicating 1 drive)
BIT 2 nINDEX
Active low status of the INDEX disk interface input.        BIT 7 INTERRUPT PENDING
                                                            Active high bit indicating the state of the Floppy
BIT 3 HEAD SELECT                                           Disk Interrupt output.
Active high status of the HDSEL disk interface
input. A logic "1" selects side 1 and a logic "0"
selects side 0.
BIT 4 nTRACK 0
                                                        16


PS/2 Model 30 Mode
                            7            6        5        4         3         2        1        0
                           INT        DRQ      STEP      TRK0    nHDSEL     INDX       WP      nDIR
                       PENDING                   F/F
           RESET            0            0        0       N/A        1       N/A       N/A       1
            COND.
BIT 0 nDIRECTION                                           BIT 4 TRACK 0
Active low status indicating the direction of head         Active high status of the TRK0 disk interface input.
movement. A logic "0" indicates inward direction; a
logic "1" indicates outward direction.                     BIT 5 STEP
                                                           Active high status of the latched STEP disk
BIT 1 WRITE PROTECT                                        interface output pin. This bit is latched with the
Active high status of the WRITE PROTECT disk               STEP output going active, and is cleared with a
interface input. A logic "1" indicates that the disk is    read from the DIR register, or with a hardware or
write protected. (See also Force Write Protect             software reset.
Function)
                                                           BIT 6 DMA REQUEST
BIT 2 INDEX                                                Active high status of the DRQ output pin.
Active high status of the INDEX disk interface
input.                                                     BIT 7 INTERRUPT PENDING
                                                           Active high bit indicating the state of the Floppy
BIT 3 nHEAD SELECT                                         Disk Interrupt output.
Active low status of the HDSEL disk interface
input. A logic "0" selects side 1 and a logic "1"
selects side 0.
                                                        17


STATUS REGISTER B (SRB)                                 when in PS/2 mode. In the PC/AT mode the data
                                                        bus pins D0 - D7 are held in a high impedance
Address 3F1 READ ONLY                                   state for a read of address 3F1.
This register is read-only and monitors the state of
several disk interface pins in PS/2 and Model 30        PS/2 Mode
modes. The SRB can be accessed at any time
                         7       6        5          4           3          2        1        0
                         1       1     DRIVE WDATA RDATA WGATE                     MOT      MOT
                                        SEL0 TOGGLE TOGGLE                          EN1     EN0
            RESET        1       1        0          0           0          0        0        0
            COND.
BIT 0 MOTOR ENABLE 0                                    BIT 4 WRITE DATA TOGGLE
Active high status of the MTR0 disk interface           Every inactive edge of the WDATA input causes
output pin. This bit is low after a hardware reset      this bit to change state.
and unaffected by a software reset.
                                                        BIT 5 DRIVE SELECT 0
BIT 1 MOTOR ENABLE 1                                    Reflects the status of the Drive Select 0 bit of the
Active high status of the MTR1 disk interface           DOR (address 3F2 bit 0). This bit is cleared after
output pin. This bit is low after a hardware reset      a hardware reset and it is unaffected by a software
and unaffected by a software reset.                     reset.
BIT 2 WRITE GATE                                        BIT 6 RESERVED
Active high status of the WGATE disk interface          Always read as a logic "1".
output.
                                                        BIT 7 RESERVED
BIT 3 READ DATA TOGGLE                                  Always read as a logic "1".
Every inactive edge of the RDATA input causes
this bit to change state.
                                                     18


PS/2 Model 30 Mode
                         7        6         5         4          3          2          1         0
                      nDRV2     nDS1      nDS0    WDATA      RDATA       WGATE       nDS3     nDS2
                                                     F/F        F/F        F/F
          RESET         N/A       1         1         0          0          0          1         1
          COND.
BIT 0 nDRIVE SELECT 2                                    edge of RDATA and is cleared by the read of the
The DS2 disk interface is not supported. (Always         DIR register.
1)                                                       BIT 4 WRITE DATA
                                                         Active high status of the latched WDATA output
BIT 1 nDRIVE SELECT 3                                    signal. This bit is latched by the inactive going
The DS3 disk interface is not supported. (Always         edge of WDATA and is cleared by the read of the
1)                                                       DIR register. This bit is not gated with WGATE.
BIT 2 WRITE GATE                                         BIT 5 nDRIVE SELECT 0
Active high status of the latched WGATE output           Active low status of the DS0 disk interface output.
signal. This bit is latched by the active going edge
of WGATE and is cleared by the read of the DIR           BIT 6 nDRIVE SELECT 1
register.                                                Active low status of the DS1 disk interface output.
BIT 3 READ DATA                                          BIT 7 nDRV2
Active high status of the latched RDATA output           Active low status of the DRV2 disk interface input,
signal. This bit is latched by the inactive going        this is not supported. (Always 1).
                                                      19


DIGITAL OUTPUT REGISTER (DOR)                               contains the enable for the DMA logic and a
                                                            software reset bit. The contents of the DOR are
Address 3F2 READ/WRITE                                      unaffected by a software reset. The DOR can be
The DOR controls the drive select and motor                 written to at any time.
enables of the disk interface outputs. It also
                            7         6         5        4          3           2         1       0
                          MOT       MOT       MOT       MOT     DMAEN       nRESE DRIVE DRIVE
                           EN3      EN2       EN1       EN0                     T       SEL1    SEL0
             RESET          0         0         0        0          0           0         0       0
              COND.
BIT 0 and 1 DRIVE SELECT                                    impedance state. This bit is a logic "0" after a
These two bits are binary encoded for the drive             reset and in these modes.
selects, thereby allowing only one drive to be              PS/2 Mode: In this mode the DRQ, nDACK, TC
selected at one time.                                       and FINTR pins are always enabled. During a
                                                            reset, the DRQ, nDACK, TC, and FINTR pins will
BIT 2 nRESET                                                remain enabled, but this bit will be cleared to a
A logic "0" written to this bit resets the Floppy disk      logic "0".
controller. This reset will remain active until a logic
"1" is written to this bit. This software reset does        BIT 4 MOTOR ENABLE 0
not affect the DSR and CCR registers, nor does it           This bit controls the MTR0 disk interface output. A
affect the other bits of the DOR register. The              logic "1" in this bit will cause the output pin to go
minimum reset duration required is 100ns,                   active.
therefore toggling this bit by consecutive writes to
this register is a valid method of issuing a software       BIT 5 MOTOR ENABLE 1
reset.                                                      This bit controls the MTR1 disk interface output. A
                                                            logic "1" in this bit will cause the output pin to go
BIT 3 DMAEN                                                 active.
PC/AT and Model 30 Mode:
Writing this bit to logic "1" will enable the DRQ,          BIT 6 MOTOR ENABLE 2
nDACK, TC and FINTR outputs. This bit being a               The MTR2 disk interface output is not. (Always 0)
logic "0" will disable the nDACK and TC inputs,
and hold the DRQ and FINTR outputs in a high                BIT 7 MOTOR ENABLE 3
                                                            The MTR3 disk interface output is not. (Always 0)
                                   TABLE 6 - DRIVE ACTIVATION VALUES
                                         DRIVE                DOR VALUE
                                            0                      1CH
                                            1                      2DH
                                                        20


TAPE DRIVE REGISTER (TDR)
Address 3F3 READ/WRITE
                                    TABLE 7 - TAPE SELECT BITS
                            TAPE SEL1           TAPE SEL0            DRIVE
                              (TDR.1)             (TDR.0)         SELECTED
                                 0                   0               None
                                 0                   1                 1
                                 1                   0                 2
                                 1                   1                 3
The     Tape      Drive                                                            TABLE 7 illustrates the
Register (TDR) is included for 82077 software           Tape Select Bit encoding. Note that drive 0 is the
compatibility and allows the user to assign tape        boot device and cannot be assigned tape support.
support to a particular drive during initialization.    The remaining Tape Drive Register bits TDR.[7:2]
Any future references to that drive automatically       are tristated when read. The TDR is unaffected by
invokes tape support. The TDR Tape Select bits          a software reset.
TDR.[1:0] determine the tape drive number.
                         TABLE 8 - INTERNAL 2 DRIVE DECODE - NORMAL
                                                DRIVE SELECT OUTPUTS           MOTOR ON OUTPUTS
       DIGITAL OUTPUT REGISTER                        (ACTIVE LOW)                  (ACTIVE LOW)
  Bit 7 Bit 6 Bit 5 Bit 4 Bit1 Bit 0                nDS1           nDS0         nMTR1          nMTR0
   X       X      X       1     0        0            1              0           nBIT 5        nBIT 4
   X       X      1      X      0        1            0              1           nBIT 5        nBIT 4
   X       1      X      X      1        0            1              1           nBIT 5        nBIT 4
   1       X      X      X      1        1            1              1           nBIT 5        nBIT 4
   0       0      0       0     X        X            1              1           nBIT 5        nBIT 4
                TABLE 9 - INTERNAL 2 DRIVE DECODE - DRIVES 0 AND 1 SWAPPED
                                                     DRIVE SELECT             MOTOR ON OUTPUTS
       DIGITAL OUTPUT REGISTER                  OUTPUTS (ACTIVE LOW)              (ACTIVE LOW)
  Bit 7 Bit 6 Bit 5 Bit 4 Bit1 Bit 0               nDS1           nDS0         nMTR1        nMTR0
   X       X      X      1      0        0           0              1          nBIT 4        nBIT 5
   X       X      1      X      0        1           1              0          nBIT 4        nBIT 5
   X       1      X      X      1        0           1              1          nBIT 4        nBIT 5
   1       X      X      X      1        1           1              1          nBIT 4        nBIT 5
   0       0      0      0      X        X           1              1          nBIT 4        nBIT 5
                                                     21


Normal Floppy Mode
Normal mode. Register 3F3 contains only bits 0 and 1. When this register is read, bits 2 - 7 are a high
impedance.
               DB7         DB6       DB5         DB4           DB3        DB2          DB1       DB0
 REG 3F3     Tri-state   Tri-state Tri-state   Tri-state    Tri-state  Tri-state     tape sel1 tape sel0
Enhanced Floppy Mode 2 (OS2)
Register 3F3 for Enhanced Floppy Mode 2 operation.
               DB7         DB6       DB5         DB4           DB3        DB2          DB1       DB0
 REG 3F3 Reserved Reserved             Drive Type ID          Floppy Boot Drive      tape sel1 tape sel0
                                    TABLE 10 - DRIVE TYPE ID
              DIGITAL OUTPUT REGISTER                REGISTER 3F3 - DRIVE TYPE ID
                   Bit 1           Bit 0                 Bit 5                   Bit 4
                    0               0               L0-CRF2 - B1           L0-CRF2 - B0
                    0               1               L0-CRF2 - B3           L0-CRF2 - B2
                    1               0               L0-CRF2 - B5           L0-CRF2 - B4
                    1               1               L0-CRF2 - B7           L0-CRF2 - B6
Note:L0-CRF2-Bx = Logical Device 0, Configuration Register F2, Bit x.
                                                  22


DATA RATE SELECT REGISTER (DSR)                           and PS/2 Model 30 and Microchannel
                                                          applications. Other applications can set the data
Address 3F4 WRITE ONLY                                    rate in the DSR. The data rate of the floppy
This register is write only. It is used to program        controller is the most recent write of either the
the data rate, amount of write precompensation,           DSR or CCR. The DSR is unaffected by a
power down status, and software reset. The data           software reset. A hardware reset will set the DSR
rate is programmed using the Configuration                to 02H, which corresponds to the default
Control Register (CCR) not the DSR, for PC/AT             precompensation setting and 250 Kbps.
                       7          6        5           4          3           2          1        0
                      S/W    POWER         0         PRE-        PRE-       PRE-      DRATE DRATE
                    RESET DOWN                     COMP2        COMP1     COMP0 SEL1             SEL0
         RESET         0          0        0           0          0           0          1        0
          COND.
BIT 0 and 1 DATA RATE SELECT                              BIT 5 UNDEFINED
These bits control the data rate of the floppy            Should be written as a logic "0".
controller.    See Table 11 for the settings
corresponding to the individual data rates. The           BIT 6 LOW POWER
data rate select bits are unaffected by a software        A logic "1" written to this bit will put the floppy
reset, and are set to 250 Kbps after a hardware           controller into manual low power mode. The
reset.                                                    floppy controller clock and data mode after a
                                                          software reset or access to the Data Register or
BIT 2 through 4             PRECOMPENSATION               Main Status Register.
SELECT
These three bits select the value of write
precompensation that will be applied to the               BIT 7 SOFTWARE RESET
WDATA output signal. Table 10 shows the                   This active high bit has the same function as the
precompensation values for the combination of             DOR RESET (DOR bit 2) except that this bit is self
these bits settings. Track 0 is the default starting      clearing.
track number to start precompensation. this
starting track number can be changed by the               Note: The DSR is Shadowed in the Floppy Data
configure command.                                        Rate Select Shadow Register, LD8:CRC2[7:0].
                                                          separator circuits will be turned off. The controller
                                                          will come out of manual low power.
                                                      23


                          TABLE 11 - PRECOMPENSATION DELAYS
                            PRECOMP          PRECOMPENSATION
                               432               DELAY (nsec)
                                              <2Mbps          2Mbps
                               111             0.00             0
                               001             41.67           20.8
                               010             83.34           41.7
                               011            125.00           62.5
                               100            166.67           83.3
                               101            208.33          104.2
                               110            250.00           125
                               000            Default        Default
                                          Default: See Table 11
                                   TABLE 12 - DATA RATES
           DRIVE RATE      DATA RATE         DATA RATE                        DRATE(1)
                                                                DENSEL
         DRT1      DRT0   SEL1     SEL0     MFM        FM                      1     0
            0        0      1        1      1Meg        ---          1         1     1
            0        0      0        0       500       250           1         0     0
            0        0      0        1       300       150           0         0     1
            0        0      1        0       250       125           0         1     0
            0        1      1        1      1Meg        ---          1         1     1
            0        1      0        0       500       250           1         0     0
            0        1      0        1       500       250           0         0     1
            0        1      1        0       250       125           0         1     0
            1        0      1        1      1Meg        ---          1         1     1
            1        0      0        0       500       250           1         0     0
            1        0      0        1      2Meg        ---          0         0     1
            1        0      1        0       250       125           0         1     0
Drive Rate Table (Recommended)00 = 360K, 1.2M, 720K, 1.44M and 2.88M Vertical Format
01 = 3-Mode Drive
10 = 2 Meg Tape
Note 1:The DRATE and DENSEL values are mapped onto the DRVDEN pins.
                                               24


                  TABLE 13 - DRVDEN MAPPING
DT1 DT0    DRVDEN1 (1)       DRVDEN0 (1)              DRIVE TYPE
 0   0       DRATE0             DENSEL       4/2/1 MB 3.5"
                                             2/1 MB 5.25" FDDS
                                             2/1.6/1 MB 3.5" (3-MODE)
 1   0       DRATE0             DRATE1
 0   1       DRATE0            nDENSEL       PS/2
 1   1       DRATE1             DRATE0
        TABLE 14 - DEFAULT PRECOMPENSATION DELAYS
                               PRECOMPENSATION
               DATA RATE            DELAYS
                 2 Mbps              20.8 ns
                 1 Mbps             41.67 ns
                500 Kbps             125 ns
                300 Kbps             125 ns
                250 Kbps             125 ns
                               25


MAIN STATUS REGISTER                                      The MSR indicates when the disk controller is
                                                          ready to receive data via the Data Register. It
Address 3F4 READ ONLY                                     should be read before each byte transferring to or
The Main Status Register is a read-only register          from the data register except in DMA mode. No
and indicates the status of the disk controller. The      delay is required when reading the MSR after a
Main Status Register can be read at any time.             data                                           transfer.
                7           6           5         4           3           2          1            0
                                     NON        CMD                                DRV1        DRV0
              RQM         DIO        DMA       BUSY      Reserved Reserved         BUSY        BUSY
BIT 0 - 1 DRV x BUSY                                      DATA REGISTER (FIFO)
These bits are set to 1s when a drive is in the seek
portion of a command, including implied and               Address 3F5 READ/WRITE
overlapped seeks and recalibrates.                        All command parameter information, disk data and
                                                          result status are transferred between the host
BIT 4 COMMAND BUSY                                        processor and the floppy disk controller through
This bit is set to a 1 when a command is in               the Data Register.
progress. This bit will go active after the command
byte has been accepted and goes inactive at the           Data transfers are governed by the RQM and DIO
end of the results phase. If there is no result           bits in the Main Status Register.
phase (Seek, Recalibrate commands), this bit is
returned to a 0 after the last command byte.              The Data Register defaults to FIFO disabled mode
                                                          after any form of reset. This maintains PC/AT
BIT 5 NON-DMA                                             hardware compatibility. The default values can be
This mode is selected in the SPECIFY command              changed through the Configure command (enable
and will be set to a 1 during the execution phase of      full FIFO operation with threshold control). The
a command. This is for polled data transfers and          advantage of the FIFO is that it allows the system
helps differentiate between the data transfer phase       a larger DMA latency without causing a disk error.
and the reading of result bytes.                          Table 14 gives several examples of the delays
                                                          with a FIFO. The data is based upon the following
BIT 6 DIO                                                 formula:
Indicates the direction of a data transfer once a
RQM is set. A 1 indicates a read and a 0 indicates          Threshold # x       1      x8   - 1.5  s = DELAY
                                                                            DATA RATE
a write is required.
                                                          At the start of a command, the FIFO action is
BIT 7 RQM
                                                          always disabled and command parameters must
Indicates that the host can transfer data if set to a
                                                          be sent based upon the RQM and DIO bit settings.
1. No access is permitted if set to a 0.
                                                          As the command execution phase is entered, the
                                                          FIFO is cleared of any data to ensure that invalid
                                                          data is not transferred.
                                                      26


An overrun or underrun will terminate the current      pattern and valid CRC. Reads require the host to
command and the transfer of data. Disk writes will     remove the remaining data so that the result
complete the current sector by generating a 00         phase may be entered.
                                  TABLE 15 - FIFO SERVICE DELAY
                    FIFO THRESHOLD             MAXIMUM DELAY TO SERVICING AT
                       EXAMPLES                         2 Mbps DATA RATE
                            1 byte           1 x 4 μs - 1.5 μs = 2.5 μs
                           2 bytes           2 x 4 μs - 1.5 μs = 6.5 μs
                           8 bytes           8 x 4 μs - 1.5 μs = 30.5 μs
                          15 bytes           15 x 4 μs - 1.5 μs = 58.5 μs
                    FIFO THRESHOLD             MAXIMUM DELAY TO SERVICING AT
                       EXAMPLES                         1 Mbps DATA RATE
                            1 byte           1 x 8 μs - 1.5 μs = 6.5 μs
                           2 bytes           2 x 8 μs - 1.5 μs = 14.5 μs
                           8 bytes           8 x 8 μs - 1.5 μs = 62.5 μs
                          15 bytes           15 x 8 μs - 1.5 μs = 118.5 μs
                    FIFO THRESHOLD            MAXIMUM DELAY TO SERVICING AT
                       EXAMPLES                       500 Kbps DATA RATE
                            1 byte           1 x 16 μs - 1.5 μs = 14.5 μs
                           2 bytes           2 x 16 μs - 1.5 μs = 30.5 μs
                           8 bytes           8 x 16 μs - 1.5 μs = 126.5 μs
                          15 bytes           15 x 16 μs - 1.5 μs = 238.5 μs
                                                   27


DIGITAL INPUT REGISTER (DIR)
Address 3F7 READ ONLY
This register is read-only in all modes.
PC-AT Mode
                            7         6       5     4         3        2        1        0
                          DSK
                         CHG
              RESET       N/A       N/A     N/A   N/A       N/A      N/A       N/A     N/A
              COND.
BIT 0 - 6 UNDEFINED                                   BIT 7 DSKCHG
The data bus outputs D0 - 6 will remain in a high     This bit monitors the pin of the same name and
impedance state during a read of this register.       reflects the opposite value seen on the disk cable
                                                      or the value programmed in the Force Disk
                                                      Change Register (see Configuration Register
                                                      LD8:CRC1[1:0]).
                                                      PS/2 Mode
                           7         6       5     4         3        2        1        0
                         DSK         1       1     1         1     DRATE DRATE nHIGH
                         CHG                                        SEL1     SEL0 nDENS
              RESET      N/A        N/A    N/A    N/A      N/A       N/A      N/A       1
              COND.
BIT 0 nHIGH DENS
This bit is low whenever the 500 Kbps or 1 Mbps       BITS 3 - 6 UNDEFINED
data rates are selected, and high when 250 Kbps       Always read as a logic "1"
and 300 Kbps are selected.
                                                      BIT 7 DSKCHG
BITS 1 - 2 DATA RATE SELECT                           This bit monitors the pin of the same name and
These bits control the data rate of the floppy        reflects the opposite value seen on the disk cable
controller.     See Table 11 for the settings         or the value programmed in the Force Disk
corresponding to the individual data rates. The       Change Register (see Configuration Register
data rate select bits are unaffected by a             LD8:CRC1[1:0]).
software reset, and are set to 250 Kbps after a
hardware reset.
                                                  28


Model 30 Mode
                           7       6        5         4        3          2         1      0
                          DSK      0        0         0    DMAEN NOPREC DRATE DRATE
                         CHG                                                      SEL1    SEL0
             RESET        N/A      0        0         0        0          0         1      0
              COND.
BITS 0 - 1 DATA RATE SELECT                             BIT 3 DMAEN
These bits control the data rate of the floppy          This bit reflects the value of DMAEN bit set in the
controller.     See Table 11 for the settings           DOR register bit 3.
corresponding to the individual data rates. The
data rate select bits are unaffected by a software      BITS 4 - 6 UNDEFINED
reset, and are set to 250 Kbps after a hardware         Always read as a logic "0"
reset.
                                                        BIT 7 DSKCHG
BIT 2 NOPREC                                            This bit monitors the pin of the same name and
This bit reflects the value of NOPREC bit set in the    reflects the opposite value seen on the disk cable
CCR register.                                           or the value programmed in the Force Disk
                                                        Change Register (see Configuration Register
                                                        LD8:CRC1[1:0]).
                                                     29


CONFIGURATION CONTROL REGISTER (CCR)
Address 3F7 WRITE ONLY
PC/AT and PS/2 Modes
                          7        6         5     4         3         2        1       0
                                                                             DRATE DRATE
                                                                              SEL1    SEL0
              RESET      N/A     N/A        N/A   N/A       N/A       N/A       1       0
              COND.
BIT 0 and 1 DATA RATE SELECT 0 and 1                  BIT 2 - 7 RESERVED
These bits determine the data rate of the floppy      Should be set to a logical "0"
controller. See Table 11 for the appropriate
values.                                               PS/2 Model 30 Mode
                          7       6          5     4         3          2         1       0
                                                                   NOPREC DRATE DRATE
                                                                               SEL1     SEL0
              RESET      N/A     N/A       N/A    N/A      N/A        N/A         1       0
              COND.
BIT 0 and 1 DATA RATE SELECT 0 and 1                  BIT 3 - 7 RESERVED
These bits determine the data rate of the floppy      Should be set to a logical "0"
controller. See Table 11 for the appropriate
values.                                               Table 12 shows the state of the DENSEL pin. The
                                                      DENSEL pin is set high after a hardware reset and
BIT 2 NO PRECOMPENSATION                              is unaffected by the DOR and the DSR resets.
This bit can be set by software, but it has no
functionality. It can be read by bit 2 of the DSR     STATUS REGISTER ENCODING
when in Model 30 register mode. Unaffected by
software reset.                                       During the Result Phase of certain commands, the
                                                      Data Register contains data bytes that give the
                                                      status of the command just executed.
                                                  30


                    TABLE 16 - STATUS REGISTER 0
BIT NO.   SYMBOL     NAME                            DESCRIPTION
  7,6   IC       Interrupt Code 00 - Normal termination of command. The specified
                                command was properly executed and completed without
                                error.
                                01 - Abnormal termination of command. Command
                                execution was started, but was not successfully
                                completed.
                                10 - Invalid command. The requested command could
                                not be executed.
                                11 - Abnormal termination caused by Polling.
   5    SE       Seek End       The FDC completed a Seek, Relative Seek or
                                Recalibrate command (used during a Sense Interrupt
                                Command).
   4    EC       Equipment      The TRK0 pin failed to become a "1" after:
                 Check          1. 80 step pulses in the Recalibrate command.
                                2. The Relative Seek command caused the FDC to
                                step outward beyond Track 0.
   3                            Unused. This bit is always "0".
   2    H        Head Address The current head address.
  1,0   DS1,0    Drive Select   The current selected drive.
                                    31


                  TABLE 17 - STATUS REGISTER 1
BIT NO.  SYMBOL     NAME                            DESCRIPTION
   7    EN      End of        The FDC tried to access a sector beyond the final sector
                Cylinder      of the track (255D). Will be set if TC is not issued after
                              Read or Write Data command.
   6                          Unused. This bit is always "0".
   5    DE      Data Error    The FDC detected a CRC error in either the ID field or
                              the data field of a sector.
   4    OR      Overrun/      Becomes set if the FDC does not receive CPU or DMA
                Underrun      service within the required time interval, resulting in data
                              overrun or underrun.
   3                          Unused. This bit is always "0".
   2    ND      No Data       Any one of the following:
                              1. Read Data, Read Deleted Data command - the FDC
                              did not find the specified sector.
                              2. Read ID command - the FDC cannot read the ID field
                              without an error.
                              3. Read A Track command - the FDC cannot find the
                              proper sector sequence.
   1    NW      Not Writeable WP pin became a "1" while the FDC is executing a Write
                              Data, Write Deleted Data, or Format A Track command.
   0    MA      Missing       Any one of the following:
                Address Mark 1. The FDC did not detect an ID address mark at the
                              specified track after encountering the index pulse from
                              the IDX pin twice.
                              2. The FDC cannot detect a data address mark or a
                              deleted data address mark on the specified track.
                                  32


                   TABLE 18 - STATUS REGISTER 2
BIT NO.  SYMBOL     NAME                            DESCRIPTION
   7                          Unused. This bit is always "0".
   6    CM      Control Mark Any one of the following:
                              1. Read Data command - the FDC encountered a
                              deleted data address mark.
                              2. Read Deleted Data command - the FDC
                              encountered a data address mark.
   5    DD      Data Error in The FDC detected a CRC error in the data field.
                Data Field
   4    WC      Wrong         The track address from the sector ID field is different
                Cylinder      from the track address maintained inside the FDC.
   3                          Unused. This bit is always "0".
   2                          Unused. This bit is always "0".
   1    BC      Bad Cylinder  The track address from the sector ID field is different
                              from the track address maintained inside the FDC and is
                              equal to FF hex, which indicates a bad track with a hard
                              error according to the IBM soft-sectored format.
   0    MD      Missing Data The FDC cannot detect a data address mark or a deleted
                Address Mark data address mark.
                   TABLE 19 - STATUS REGISTER 3
BIT NO.  SYMBOL     NAME                            DESCRIPTION
   7                          Unused. This bit is always "0".
   6    WP      Write         Indicates the status of the WP pin.
                Protected
   5                          Unused. This bit is always "1".
   4    T0      Track 0       Indicates the status of the TRK0 pin.
   3                          Unused. This bit is always "1".
   2    HD      Head Address Indicates the status of the HDSEL pin.
  1,0   DS1,0   Drive Select  Indicates the status of the DS1, DS0 pins.
                                  33


RESET                                                   DRQ can be hi Z), and TC and DENSEL become
                                                        active high signals.
There are three sources of system reset on the
FDC: the RESET pin of the FDC, a reset                  PS/2 mode - (IDENT low, MFM high)
generated via a bit in the DOR, and a reset             This mode supports the PS/2 models 50/60/80
generated via a bit in the DSR. At power on, a          configuration and register set. The DMA bit of the
Power On Reset initializes the FDC. All resets          DOR becomes a "don't care", (FINTR and DRQ
take the FDC out of the power down state.               are always valid), TC and DENSEL become active
                                                        low.
All operations are terminated upon a RESET, and
the FDC enters an idle state. A reset while a disk      Model 30 mode - (IDENT low, MFM low)
write is in progress will corrupt the data and CRC.     This mode supports PS/2 Model 30 configuration
                                                        and register set. The DMA enable bit of the DOR
On exiting the reset state, various internal            becomes valid (FINTR and DRQ can be hi Z), TC
registers are cleared, including the Configure          is active high and DENSEL is active low.
command information, and the FDC waits for a
new command. Drive polling will start unless            DMA TRANSFERS
disabled by a new Configure command.
                                                        DMA transfers are enabled with the Specify
RESET Pin (Hardware Reset)                              command and are initiated by the FDC by
                                                        activating the FDRQ pin during a data transfer
The RESET pin is a global reset and clears all          command. The FIFO is enabled directly by
registers except those programmed by the Specify        asserting nDACK and addresses need not be
command. The DOR reset bit is enabled and               valid.
must be cleared by the host to exit the reset state.
                                                        Note that if the DMA controller (i.e. 8237A) is
DOR Reset vs. DSR Reset (Software Reset)                programmed to function in verify mode, a pseudo
                                                        read is performed by the FDC based only on
These two resets are functionally the same. Both        nDACK. This mode is only available when the
will reset the FDC core, which affects drive status     FDC has been configured into byte mode (FIFO
information and the FIFO circuits. The DSR reset        disabled) and is programmed to do a read. With
clears itself automatically while the DOR reset         the FIFO enabled, the FDC can perform the above
requires the host to manually clear it. DOR reset       operation by using the new Verify command; no
has precedence over the DSR reset. The DOR              DMA operation is needed.
reset is set automatically upon a pin reset. The
user must manually clear this reset bit in the DOR      Two DMA transfer modes are supported for the
to exit the reset state.                                FDC: Single Transfer and Burst Transfer. In the
                                                        case of the single transfer, the DMA Req goes
MODES OF OPERATION                                      active at the start of the DMA cycle, and the DMA
                                                        Req is deasserted after the nDACK. In the case of
The FDC has three modes of operation, PC/AT             the burst transfer, the Req is held active until the
mode, PS/2 mode and Model 30 mode. These                last transfer (independent of nDACK). See timing
are determined by the state of the IDENT and            diagrams for more information.
MFM bits 3 and 2 respectively of LD8CRF0.
                                                        Burst mode is enabled via Bit[1] of CRF0 in
PC/AT mode - (IDENT high, MFM a "don't care")           Logical Device 0. Setting Bit[1]=0 enables burst
                                                        mode; the default is Bit[1]=1, for non-burst mode.
The PC/AT register set is enabled, the DMA
enable bit of the DOR becomes valid (FINTR and          CONTROLLER PHASES
                                                     34


                                                      Execution Phase
For simplicity, command handling in the FDC can
be divided into three phases: Command,                All data transfers to or from the FDC occur during
Execution, and Result. Each phase is described in     the execution phase, which can proceed in DMA
the following sections.                               or non-DMA mode as indicated in the Specify
                                                      command.
Command Phase
                                                      After a reset, the FIFO is disabled. Each data byte
After a reset, the FDC enters the command phase       is transferred by an FINT or FDRQ depending on
and is ready to accept a command from the host.       the DMA mode. The Configure command can
For each of the commands, a defined set of            enable the FIFO and set the FIFO threshold value.
command code bytes and parameter bytes has to
be written to the FDC before the command phase        The following paragraphs detail the operation of
is complete. (Please refer to TABLE 20 for the        the FIFO flow control. In these descriptions,
command set descriptions). These bytes of data        <threshold> is defined as the number of bytes
must be transferred in the order prescribed.          available to the FDC when service is requested
                                                      from the host and ranges from 1 to 16. The
Before writing to the FDC, the host must examine      parameter FIFOTHR, which the user programs, is
the RQM and DIO bits of the Main Status Register.     one less and ranges from 0 to 15.
RQM and DIO must be equal to "1" and "0"
respectively before command bytes may be              A low threshold value (i.e. 2) results in longer
written. RQM is set false by the FDC after each       periods of time between service requests, but
write cycle until the received byte is processed.     requires faster servicing of the request for both
The FDC asserts RQM again to request each             read and write cases. The host reads (writes)
parameter byte of the command unless an illegal       from (to) the FIFO until empty (full), then the
command condition is detected. After the last         transfer request goes inactive. The host must be
parameter byte is received, RQM remains "0" and       very responsive to the service request. This is the
the FDC automatically enters the next phase as        desired case for use with a "fast" system.
defined by the command definition.
                                                      A high value of threshold (i.e. 12) is used with a
The FIFO is disabled during the command phase         "sluggish" system by affording a long latency
to provide for the proper handling of the "Invalid    period after a service request, but results in more
Command" condition.                                   frequent service requests.
                                                      Non-DMA Mode - Transfers from the FIFO to the
                                                      Host
                                                      The FINT pin and RQM bits in the Main Status
                                                      Register are activated when the FIFO contains
                                                      (16-<threshold>) bytes or the last bytes of a full
                                                      sector have been placed in the FIFO. The FINT
                                                      pin can be used for interrupt-driven systems, and
                                                      RQM can be used for polled systems. The host
                                                      must respond to the request by reading data from
                                                      the FIFO. This process is repeated until the last
                                                      byte is transferred out of the FIFO. The FDC will
                                                      deactivate the FINT pin and RQM bit when the
                                                      FIFO becomes empty.
                                                   35


Non-DMA Mode - Transfers from the Host to the           commands. The DMA controller must respond by
FIFO                                                    activating the nDACK and nIOW pins and placing
                                                        data in the FIFO. FDRQ remains active until the
The FINT pin and RQM bit in the Main Status             FIFO becomes full. FDRQ is again set true when
Register are activated upon entering the execution      the FIFO has <threshold> bytes remaining in the
phase of data transfer commands. The host must          FIFO. The FDC will also deactivate the FDRQ pin
respond to the request by writing data into the         when TC becomes true (qualified by nDACK),
FIFO. The FINT pin and RQM bit remain true until        indicating that no more data is required. FDRQ
the FIFO becomes full. They are set true again          goes inactive after nDACK goes active for the last
when the FIFO has <threshold> bytes remaining in        byte of a data transfer (or on the active edge of
the FIFO. The FINT pin will also be deactivated if      nIOW of the last byte, if no edge is present on
TC and nDACK both go inactive. The FDC enters           nDACK). A data overrun may occur if FDRQ is
the result phase after the last byte is taken by the    not removed in time to prevent an unwanted cycle.
FDC from the FIFO (i.e. FIFO empty condition).
                                                        Data Transfer Termination
DMA Mode - Transfers from the FIFO to the Host
                                                        The FDC supports terminal count explicitly through
The FDC activates the DDRQ pin when the FIFO            the TC pin and implicitly through the
contains (16 - <threshold>) bytes, or the last byte     underrun/overrun      and     end-of-track    (EOT)
of a full sector transfer has been placed in the        functions. For full sector transfers, the EOT
FIFO. The DMA controller must respond to the            parameter can define the last sector to be
request by reading data from the FIFO. The FDC          transferred in a single or multi-sector transfer.
will deactivate the DDRQ pin when the FIFO
becomes empty.         FDRQ goes inactive after         If the last sector to be transferred is a partial
nDACK goes active for the last byte of a data           sector, the host can stop transferring the data in
transfer (or on the active edge of nIOR, on the last    mid-sector, and the FDC will continue to complete
byte, if no edge is present on nDACK). A data           the sector as if a hardware TC was
underrun may occur if FDRQ is not removed in            received. The only difference between these
time to prevent an unwanted cycle.                      implicit functions and TC is that they return
                                                        "abnormal termination" result status. Such status
DMA Mode - Transfers from the Host to the FIFO.         indications can be ignored if they were expected.
The FDC activates the FDRQ pin when entering            Note that when the host is sending data to the
the execution phase of the data transfer                FIFO of the FDC, the internal sector count will be
                                                        complete when the FDC reads the last byte from
                                                        its side of the FIFO. There may be a delay in the
                                                        removal of the transfer request signal of up to the
                                                        time taken for the FDC to read the last 16 bytes
                                                        from the FIFO. The host must tolerate this delay.
                                                     36


Result Phase
                                                       RQM and DIO must both equal "1" before the
The generation of FINT determines the beginning        result bytes may be read. After all the result bytes
of the result phase. For each of the commands, a       have been read, the RQM and DIO bits switch to
defined set of result bytes has to be read from the    "1" and "0" respectively, and the CB bit is cleared,
FDC before the result phase is complete. These         indicating that the FDC is ready to accept the next
bytes of data must be read out for another             command.
command to start.
                                                    37


                                   COMMAND SET/DESCRIPTIONS
Commands can be written whenever the FDC is in             The user sends a Sense Interrupt Status
the command phase. Each command has a                      command which returns an invalid command error.
unique set of needed parameters and status                 Refer to TABLE 20 for explanations of the various
results. The FDC checks to see that the first byte         symbols used. TABLE 21 lists the required
is a valid command and, if valid, proceeds with the        parameters and the results associated with each
command. If it is invalid, an interrupt is issued.         command that the FDC is capable of performing.
                         TABLE 20 - DESCRIPTION OF COMMAND SYMBOLS
   SYMBOL            NAME                                          DESCRIPTION
 C             Cylinder Address      The currently selected address; 0 to 255.
 D             Data Pattern          The pattern to be written in each sector data field during formatting.
 D0, D1        Drive Select 0-1      Designates which drives are perpendicular drives on the
                                     Perpendicular Mode Command. A "1" indicates a perpendicular
                                     drive.
 DIR           Direction Control     If this bit is 0, then the head will step out from the spindle during a
                                     relative seek. If set to a 1, the head will step in toward the spindle.
 DS0, DS1      Disk Drive Select     DS1 DS0 Drive Selected
                                       0      0    Drive 0
                                       0      1    Drive 1
 DTL           Special Sector        By setting N to zero (00), DTL may be used to control the number of
               Size                  bytes transferred in disk read/write commands. The sector size (N =
                                     0) is set to 128. If the actual sector (on the diskette) is larger than
                                     DTL, the remainder of the actual sector is read but is not passed to
                                     the host during read commands; during write commands, the
                                     remainder of the actual sector is written with all zero bytes. The CRC
                                     check code is calculated with the actual sector. When N is not zero,
                                     DTL has no meaning and should be set to FF HEX.
 EC            Enable Count          When this bit is "1" the "DTL" parameter of the Verify command
                                     becomes SC (number of sectors per track).
 EFIFO         Enable FIFO           This active low bit when a 0, enables the FIFO. A "1" disables the
                                     FIFO (default).
 EIS           Enable Implied        When set, a seek operation will be performed before executing any
               Seek                  read or write command that requires the C parameter in the
                                     command phase. A "0" disables the implied seek.
 EOT           End of Track          The final sector number of the current track.
 GAP                                 Alters Gap 2 length when using Perpendicular Mode.
 GPL           Gap Length            The Gap 3 size. (Gap 3 is the space between sectors excluding the
                                     VCO synchronization field).
 H/HDS         Head Address          Selected head: 0 or 1 (disk side 0 or 1) as encoded in the sector ID
                                     field.
 HLT           Head Load Time        The time interval that FDC waits after loading the head and before
                                     initializing a read or write operation. Refer to the Specify command
                                     for actual delays.
 HUT           Head Unload Time The time interval from the end of the execution phase (of a read or
                                     write command) until the head is unloaded. Refer to the Specify
                                     command for actual delays.
                                                        38


 SYMBOL        NAME                                    DESCRIPTION
LOCK                      Lock defines whether EFIFO, FIFOTHR, and PRETRK parameters of
                          the CONFIGURE COMMAND can be reset to their default values by
                          a "software Reset". (A reset caused by writing to the appropriate bits
                          of either the DSR or DOR)
MFM     MFM/FM Mode       A one selects the double density (MFM) mode. A zero selects single
        Selector          density (FM) mode.
MT      Multi-Track       When set, this flag selects the multi-track operating mode. In this
        Selector          mode, the FDC treats a complete cylinder under head 0 and 1 as a
                          single track. The FDC operates as this expanded track started at the
                          first sector under head 0 and ended at the last sector under head 1.
                          With this flag set, a multitrack read or write operation will
                          automatically continue to the first sector under head 1 when the FDC
                          finishes operating on the last sector under head 0.
N       Sector Size Code  This specifies the number of bytes in a sector. If this parameter is
                          "00", then the sector size is 128 bytes. The number of bytes
                          transferred is determined by the DTL parameter. Otherwise the sector
                          size is (2 raised to the "N'th" power) times 128. All values up to "07"
                          hex are allowable. "07"h would equal a sector size of 16k. It is the
                          user's responsibility to not select combinations that are not possible
                          with the drive.
                          N      Sector Size
                          0       128 Bytes
                          1      256 Bytes
                          2      512 Bytes
                          3      1024 Bytes
                          …        …
NCN     New Cylinder      The desired cylinder number.
        Number
ND      Non-DMA Mode      When set to 1, indicates that the FDC is to operate in the non-DMA
        Flag              mode. In this mode, the host is interrupted for each data transfer.
                          When set to 0, the FDC operates in DMA mode, interfacing to a DMA
                          controller by means of the DRQ and nDACK signals.
OW      Overwrite         The bits D0-D3 of the Perpendicular Mode Command can only be
                          modified if OW is set to 1. OW id defined in the Lock command.
PCN     Present Cylinder  The current position of the head at the completion of Sense Interrupt
        Number            Status command.
POLL    Polling Disable   When set, the internal polling routine is disabled. When clear, polling
                          is enabled.
PRETRK  Precompensation   Programmable from track 00 to FFH.
        Start Track
        Number
R       Sector Address    The sector number to be read or written. In multi-sector transfers, this
                          parameter specifies the sector number of the first sector to be read or
                          written.
RCN     Relative Cylinder Relative cylinder offset from present cylinder as used by the Relative
        Number            Seek command.
                                            39


 SYMBOL       NAME                                     DESCRIPTION
SC      Number of Sectors The number of sectors per track to be initialized by the Format
        Per Track          command. The number of sectors per track to be verified during a
                           Verify command when EC is set.
SK      Skip Flag          When set to 1, sectors containing a deleted data address mark will
                           automatically be skipped during the execution of Read Data. If Read
                           Deleted is executed, only sectors with a deleted address mark will be
                           accessed. When set to "0", the sector is read or written the same as
                           the read and write commands.
SRT     Step Rate Interval The time interval between step pulses issued by the FDC.
                           Programmable from 0.5 to 8 milliseconds in increments of 0.5 ms at
                           the 1 Mbit data rate. Refer to the SPECIFY command for actual
                           delays.
ST0     Status 0           Registers within the FDC which store status information after a
ST1     Status 1           command has been executed. This status information is available to
ST2     Status 2           the host during the result phase after command execution.
ST3     Status 3
WGATE   Write Gate         Alters timing of WE to allow for pre-erase loads in perpendicular
                           drives.
                                           40


                        INSTRUCTION SET
                     TABLE 21 - INSTRUCTION SET
                                READ DATA
                             DATA BUS
   PHASE  R/W D7  D6    D5 D4 D3 D2 D1 D0                       REMARKS
Command    W  MT MFM SK          0      0      1 1 0 Command Codes
           W   0   0     0       0      0 HDS DS1 DS0
           W               -------- C --------        Sector ID information prior to
                                                      Command execution.
           W               -------- H --------
           W               -------- R --------
           W               -------- N --------
           W             ------- EOT -------
           W              ------- GPL -------
           W              ------- DTL -------
Execution                                             Data transfer between the
                                                      FDD and system.
Result     R              ------- ST0 -------         Status information after Com-
                                                      mand execution.
           R              ------- ST1 -------
           R              ------- ST2 -------
           R               -------- C --------        Sector ID information after
                                                      Command execution.
           R               -------- H --------
           R               -------- R --------
           R               -------- N --------
                                      41


                      READ DELETED DATA
                          DATA BUS
   PHASE  R/W D7  D6 D5 D4 D3 D2 D1 D0                       REMARKS
Command    W  MT MFM SK       0      1      1 0 0 Command Codes
           W   0   0  0       0      0 HDS DS1 DS0
           W            -------- C --------        Sector ID information prior to
                                                   Command execution.
           W            -------- H --------
           W            -------- R --------
           W            -------- N --------
           W          ------- EOT -------
           W           ------- GPL -------
           W           ------- DTL -------
Execution                                          Data transfer between the
                                                   FDD and system.
Result     R           ------- ST0 -------         Status information after Com-
                                                   mand execution.
           R           ------- ST1 -------
           R           ------- ST2 -------
           R            -------- C --------        Sector ID information after
                                                   Command execution.
           R            -------- H --------
           R            -------- R --------
           R            -------- N --------
                                   42


                             WRITE DATA
                          DATA BUS
   PHASE  R/W D7  D6 D5 D4 D3 D2 D1 D0                       REMARKS
Command    W  MT MFM 0        0      0      1 0 1 Command Codes
           W   0   0  0       0      0 HDS DS1 DS0
           W            -------- C --------        Sector ID information prior to
                                                   Command execution.
           W            -------- H --------
           W            -------- R --------
           W            -------- N --------
           W          ------- EOT -------
           W           ------- GPL -------
           W           ------- DTL -------
Execution                                          Data transfer between the
                                                   FDD and system.
Result     R           ------- ST0 -------         Status information after Com-
                                                   mand execution.
           R           ------- ST1 -------
           R           ------- ST2 -------
           R            -------- C --------        Sector ID information after
                                                   Command execution.
           R            -------- H --------
           R            -------- R --------
           R            -------- N --------
                                   43


                     WRITE DELETED DATA
                           DATA BUS
   PHASE  R/W D7  D6 D5 D4 D3              D2  D1 D0          REMARKS
Command    W  MT MFM  0     0      1         0 0   1  Command Codes
           W   0   0  0     0      0      HDS DS1 DS0
           W             -------- C --------          Sector ID information
                                                      prior to Command
                                                      execution.
           W             -------- H --------
           W             -------- R --------
           W             -------- N --------
           W            ------- EOT -------
           W            ------- GPL -------
           W            ------- DTL -------
Execution                                             Data transfer between
                                                      the FDD and system.
Result     R            ------- ST0 -------           Status information after
                                                      Command execution.
           R            ------- ST1 -------
           R            ------- ST2 -------
           R             -------- C --------          Sector ID information
                                                      after Command
                                                      execution.
           R             -------- H --------
           R             -------- R --------
           R             -------- N --------
                                  44


                        READ A TRACK
                           DATA BUS
   PHASE  R/W D7  D6 D5 D4 D3              D2  D1  D0          REMARKS
Command    W  0  MFM 0      0      0         0  1   0  Command Codes
           W   0   0  0     0      0      HDS  DS1 DS0
           W             -------- C --------           Sector ID information
                                                       prior to Command
                                                       execution.
           W             -------- H --------
           W             -------- R --------
           W             -------- N --------
           W            ------- EOT -------
           W            ------- GPL -------
           W            ------- DTL -------
Execution                                              Data transfer between
                                                       the FDD and system.
                                                       FDC reads all of
                                                       cylinders' contents from
                                                       index hole to EOT.
Result     R            ------- ST0 -------            Status information after
                                                       Command execution.
           R            ------- ST1 -------
           R            ------- ST2 -------
           R             -------- C --------           Sector ID information
                                                       after Command
                                                       execution.
           R             -------- H --------
           R             -------- R --------
           R             -------- N --------
                                  45


                                VERIFY
                             DATA BUS
   PHASE  R/W D7  D6 D5 D4 D3                D2  D1  D0          REMARKS
Command    W  MT MFM SK       1      0         1  1   0  Command Codes
           W  EC  0   0       0      0      HDS  DS1 DS0
           W               -------- C --------           Sector ID information
                                                         prior to Command
                                                         execution.
           W               -------- H --------
           W               -------- R --------
           W               -------- N --------
           W             ------- EOT -------
           W             ------- GPL -------
           W            ------ DTL/SC ------
Execution                                                No data transfer takes
                                                         place.
Result     R              ------- ST0 -------            Status information after
                                                         Command execution.
           R              ------- ST1 -------
           R              ------- ST2 -------
           R               -------- C --------           Sector ID information
                                                         after Command
                                                         execution.
           R               -------- H --------
           R               -------- R --------
           R               -------- N --------
                               VERSION
                             DATA BUS
   PHASE  R/W D7  D6 D5 D4 D3                D2  D1  D0          REMARKS
Command    W   0  0   0       1      0         0  0   0  Command Code
Result     R   1  0   0       1      0         0  0   0  Enhanced Controller
                                    46


                            FORMAT A TRACK
                                 DATA BUS
   PHASE      R/W D7  D6 D5 D4 D3                D2  D1  D0          REMARKS
Command        W  0  MFM 0        0      1         1  0   1  Command Codes
               W   0   0  0       0      0      HDS  DS1 DS0
               W               -------- N --------           Bytes/Sector
               W              -------- SC --------           Sectors/Cylinder
               W              ------- GPL -------            Gap 3
               W               -------- D --------           Filler Byte
Execution for  W               -------- C --------           Input Sector Parameters
Each Sector
Repeat:
               W               -------- H --------
               W               -------- R --------
               W               -------- N --------
                                                             FDC formats an entire
                                                             cylinder
Result         R              ------- ST0 -------            Status information after
                                                             Command execution
               R              ------- ST1 -------
               R              ------- ST2 -------
               R           ------ Undefined ------
               R           ------ Undefined ------
               R           ------ Undefined ------
               R           ------ Undefined ------
                                        47


                                RECALIBRATE
                                DATA BUS
   PHASE  R/W D7  D6   D5       D4 D3 D2            D1     D0             REMARKS
Command    W  0    0     0       0    0        1     1     1     Command Codes
           W   0   0     0       0    0        0   DS1    DS0
Execution                                                        Head retracted to Track 0
                                                                 Interrupt.
                      SENSE INTERRUPT STATUS
                              DATA BUS
   PHASE  R/W D7  D6 D5 D4 D3 D2 D1 D0                                  REMARKS
Command    W  0    0     0       0    1        0    0    0    Command Codes
Result     R               ------- ST0 -------                Status information at the end
                                                              of each seek operation.
           R               ------- PCN -------
                                    SPECIFY
                              DATA BUS
   PHASE  R/W D7 D6 D5 D4 D3 D2 D1 D0                                    REMARKS
Command    W  0    0     0       0    0        0    1     1 Command Codes
           W     --- SRT ---                 --- HUT ---
           W            ------ HLT ------                ND
                                      48


                      SENSE DRIVE STATUS
                              DATA BUS
   PHASE  R/W D7 D6  D5 D4 D3              D2       D1    D0           REMARKS
Command    W  0   0   0       0       0      1       0     0   Command Codes
           W   0  0   0       0       0   HDS DS1       DS0
Result     R               ------- ST3 -------                 Status information about
                                                               FDD
                                   SEEK
                              DATA BUS
   PHASE  R/W D7 D6  D5 D4 D3              D2       D1    D0           REMARKS
Command    W  0   0   0       0       1      1       1     1   Command Codes
           W   0  0   0       0       0   HDS      DS1  DS0
           W              ------- NCN -------
Execution                                                      Head positioned over
                                                               proper cylinder on
                                                               diskette.
                              CONFIGURE
                                  DATA BUS
   PHASE  R/W D7 D6    D5          D4     D3      D2    D1     D0         REMARKS
Command    W  0   0     0           1      0       0    1      1     Configure
                                                                     Information
           W   0  0     0           0       0      0     0      0
           W  0  EIS EFIFO POLL                --- FIFOTHR ---
Execution  W              --------- PRETRK ---------
                                      49


                              RELATIVE SEEK
                                DATA BUS
   PHASE  R/W D7   D6     D5 D4 D3             D2     D1        D0          REMARKS
Command    W   1   DIR     0    0        1     1       1         1
           W   0    0      0    0        0    HDS    DS1       DS0
           W                 ------- RCN -------
                                  DUMPREG
                                          DATA BUS
   PHASE  R/W   D7    D6      D5          D4     D3 D2           D1      D0     REMARKS
Command    W     0     0       0           0       1    1         1       0    *Note:
                                                                               Registers
                                                                               placed in
                                                                               FIFO
Execution
Result     R                     ------ PCN-Drive 0 -------
           R                     ------ PCN-Drive 1 -------
           R                     ------ PCN-Drive 2 -------
           R                     ------ PCN-Drive 3 -------
           R          ---- SRT ----                         --- HUT ---
           R                   ------- HLT -------                       ND
           R                        ------- SC/EOT -------
           R  LOCK     0      D3          D2     D1 D0          GAP     WGATE
           R     0    EIS EFIFO POLL                     -- FIFOTHR --
           R                      -------- PRETRK --------
                                         50


                              READ ID
                            DATA BUS
   PHASE  R/W D7  D6 D5     D4 D3           D2  D1  D0         REMARKS
Command    W  0  MFM 0       0      1         0  1   0  Commands
           W   0   0  0      0      0      HDS  DS1 DS0
Execution                                               The first correct ID
                                                        information on the
                                                        Cylinder is stored in Data
                                                        Register
Result     R            -------- ST0 --------           Status information after
                                                        Command execution.
                                                        Disk status after the
                                                        Command has
                                                        completed
           R            -------- ST1 --------
           R            -------- ST2 --------
           R              -------- C --------
           R              -------- H --------
           R              -------- R --------
           R              -------- N --------
                                   51


                                         PERPENDICULAR MODE
                                                     DATA BUS
    PHASE            R/W      D7    D6 D5 D4 D3 D2                   D1      D0          REMARKS
 Command              W        0    0      0       1    0      0     1        0      Command Codes
                             OW     0     D3 D2 D1 D0               GAP   WGATE
                                               INVALID CODES
                                              DATA BUS
    PHASE            R/W     D7    D6 D5 D4 D3 D2 D1                   D0            REMARKS
 Command              W                ----- Invalid Codes -----           Invalid Command Codes
                                                                           (NoOp - FDC goes into Stand-
                                                                           by State)
 Result               R                    ------- ST0 -------             ST0 = 80H
                                                      LOCK
                                                     DATA BUS
    PHASE            R/W        D7     D6      D5       D4       D3   D2  D1     D0      REMARKS
 Command              W       LOCK      0       0        1       0    1   0      0   Command Codes
 Result               R          0      0       0      LOCK      0    0   0      0
SC is returned if the last command that was issued was the Format command. EOT is returned if the last
command was a Read or Write.
Note: These bits are used internally only. They are not reflected in the Drive Select pins. It is the user's
responsibility to maintain correspondence between these bits and the Drive Select pins (DOR).
                                                       52


DATA TRANSFER COMMANDS                                        address read off the diskette matches with the
                                                              sector address specified in the command, the FDC
All of the Read Data, Write Data and Verify type              reads the sector's data field and transfers the data
commands use the same parameter bytes and                     to the FIFO.
return the same results information, the only
difference being the coding of bits 0-4 in the first          After completion of the read operation from the
byte.                                                         current sector, the sector address is incremented
                                                              by one and the data from the next logical sector is
An implied seek will be executed if the feature was           read and output via the FIFO. This continuous
enabled by the Configure command. This seek is                read function is called "Multi-Sector Read
completely transparent to the user. The Drive Busy            Operation". Upon receipt of TC, or an implied TC
bit for the drive will go active in the Main Status           (FIFO overrun/underrun), the FDC stops sending
Register during the seek portion of the command.              data but will continue to read data from the current
If the seek portion fails, it is reflected in the results     sector, check the CRC bytes, and at the end of the
status normally returned for a Read/Write Data                sector, terminate the Read Data Command.
command. Status Register 0 (ST0) would contain
the error code and C would contain the cylinder on            N determines the number of bytes per sector (see
which the seek failed.                                        Table 21 below). If N is set to zero, the sector size
                                                              is set to 128. The DTL value determines the
Read Data                                                     number of bytes to be transferred. If DTL is less
                                                              than 128, the FDC transfers the specified number
A set of nine (9) bytes is required to place the FDC          of bytes to the host. For reads, it continues to
in the Read Data Mode. After the Read Data                    read the entire 128-byte sector and checks for
command has been issued, the FDC loads the                    CRC errors. For writes, it completes the 128-byte
head (if it is in the unloaded state), waits the              sector by filling in zeros. If N is not set to 00 Hex,
specified head settling time (defined in the Specify          DTL should be set to FF Hex and has no impact
command), and begins reading ID Address Marks                 on the number of bytes transferred.
and      ID     fields.         When       the     sector
                                            TABLE 22 - SECTOR SIZES
                                            N             SECTOR SIZE
                                           00                128 bytes
                                           01                256 bytes
                                           02                512 bytes
                                           03               1024 bytes
                                            ..                    ...
                                           07               16 Kbytes
                                                              at Sector 1, Side 0 and completing the last sector
The amount of data which can be handled with a                of the same track at Side 1.
single command to the FDC depends upon MT                     If the host terminates a read or write operation in
(multi-track) and N (number of bytes/sector).                 the FDC, the ID information in the result phase is
                                                              dependent upon the state of the MT bit and EOT
                                                              byte. Refer to Table 20.
The Multi-Track function (MT) allows the FDC to               At the completion of the Read Data command, the
read data from both sides of the diskette. For a              head is not unloaded until after the Head Unload
particular cylinder, data will be transferred starting        Time Interval (specified in the Specify command)
                                                          53


has elapsed. If the host issues another command           After reading the ID and Data Fields in each
before the head unloads, then the head settling           sector, the FDC checks the CRC bytes. If a CRC
time may be saved between subsequent reads.               error occurs in the ID or data field, the FDC sets
                                                          the IC code in Status Register 0 to "01" indicating
If the FDC detects a pulse on the nINDEX pin              abnormal termination, sets the DE bit flag in Status
twice without finding the specified sector (meaning       Register 1 to "1", sets the DD bit in Status Register
that the diskette's index hole passes through index       2 to "1" if CRC is incorrect in the ID field, and
detect logic in the drive twice), the FDC sets the IC     terminates the Read Data Command. Table 21
code in Status Register 0 to           "01" indicating    describes the effect of the SK bit on the Read
abnormal termination, sets the ND bit in Status           Data command execution and results. Except
Register 1 to "1" indicating a sector not found, and      where noted in Table 21, the C or R value of the
terminates the Read Data Command.                         sector address is automatically incremented (see
                                                          Table 23).
                                   TABLE 24 - EFFECTS OF MT AND N BITS
                                     MAXIMUM TRANSFER            FINAL SECTOR READ
                     MT      N             CAPACITY                    FROM DISK
                      0      1     256 x 26 = 6,656            26 at side 0 or 1
                      1      1     256 x 52 = 13,312           26 at side 1
                      0      2     512 x 15 = 7,680            15 at side 0 or 1
                      1      2     512 x 30 = 15,360           15 at side 1
                      0      3     1024 x 8 = 8,192            8 at side 0 or 1
                      1      3     1024 x 16 = 16,384          16 at side 1
                                                       54


          TABLE 25 - SKIP BIT VS READ DATA COMMAND
        DATA ADDRESS
SK BIT    MARK TYPE                      RESULTS
VALUE   ENCOUNTERED
                           SECTOR CM BIT OF DESCRIPTION OF
                            READ?     ST2 SET?      RESULTS
  0    Normal Data            Yes        No    Normal
                                               termination.
  0    Deleted Data           Yes       Yes    Address not
                                               incremented. Next
                                               sector not
                                               searched for.
  1    Normal Data            Yes        No    Normal
                                               termination.
  1    Deleted Data           No        Yes    Normal
                                               termination. Sector
                                               not read
                                               ("skipped").
                               55


Read Deleted Data                                    Table 22 describes the effect of the SK bit on the
                                                     Read Deleted Data command execution and
This command is the same as the Read Data            results.
command, only it operates on sectors that contain
a Deleted Data Address Mark at the beginning of a    Except where noted in Table 22, the C or R value
Data Field.                                          of the sector address is automatically incremented
                                                     (see Table 23).
                    TABLE 26 - SKIP BIT VS. READ DELETED DATA COMMAND
                        DATA ADDRESS
             SK BIT       MARK TYPE                            RESULTS
            VALUE       ENCOUNTERED
                                             SECTOR CM BIT OF DESCRIPTION OF
                                              READ?       ST2 SET?          RESULTS
                0     Normal Data               Yes           Yes      Address not
                                                                       incremented. Next
                                                                       sector not
                                                                       searched for.
                0     Deleted Data              Yes           No       Normal
                                                                       termination.
                1     Normal Data                No           Yes      Normal
                                                                       termination. Sector
                                                                       not read
                                                                       ("skipped").
                1     Deleted Data              Yes           No       Normal
                                                                       termination.
                                                  56


Read A Track                                            1 to a "1" if there is no comparison. Multi-track or
                                                        skip operations are not allowed with this
This command is similar to the Read Data                command. The MT and SK bits (bits D7 and D5 of
command except that the entire data field is read       the first command byte respectively) should always
continuously from each of the sectors of a track.       be set to "0".
Immediately after encountering a pulse on the
nINDEX pin, the FDC starts to read all data fields      This command terminates when the EOT specified
on the track as continuous blocks of data without       number of sectors has not been read. If the FDC
regard to logical sector numbers. If the FDC finds      does not find an ID Address Mark on the diskette
an error in the ID or DATA CRC check bytes, it          after the second occurrence of a pulse on the IDX
continues to read data from the track and sets the      pin, then it sets the IC code in Status Register 0 to
appropriate error bits at the end of the command.       "01" (abnormal termination), sets the MA bit in
The FDC compares the ID information read from           Status Register 1 to "1", and terminates the
each sector with the specified value in the             command.
command and sets the ND flag of Status Register
                                        TABLE 27 - RESULT PHASE
                              FINAL SECTOR
    MT         HEAD         TRANSFERRED TO                ID INFORMATION AT RESULT PHASE
                                    HOST                 C               H           R             N
     0            0            Less than EOT            NC              NC          R+1           NC
                                Equal to EOT           C+1              NC           01           NC
                  1            Less than EOT            NC              NC          R+1           NC
                                Equal to EOT           C+1              NC           01           NC
     1            0            Less than EOT            NC              NC          R+1           NC
                                Equal to EOT            NC             LSB           01           NC
                  1            Less than EOT            NC              NC          R+1           NC
                                Equal to EOT           C+1             LSB           01           NC
NC:       No Change, the same value as the one at the beginning of command execution.
LSB:     Least Significant Bit, the LSB of H is complemented.
                                                     57


 Write Data                                             •    Definition of DTL when N = 0 and when N
                                                             does not = 0
After the Write Data command has been issued,
the FDC loads the head (if it is in the unloaded        Write Deleted Data
state), waits the specified head load time if
unloaded (defined in the Specify command), and          This command is almost the same as the Write
begins reading ID fields. When the sector address       Data command except that a Deleted Data
read from the diskette matches the sector address       Address Mark is written at the beginning of the
specified in the command, the FDC reads the data        Data Field instead of the normal Data Address
from the host via the FIFO and writes it to the         Mark. This command is typically used to mark a
sector's data field.                                    bad sector containing an error on the floppy disk.
After writing data into the current sector, the FDC     Verify
computes the CRC value and writes it into the
CRC field at the end of the sector transfer. The        The Verify command is used to verify the data
Sector Number stored in "R" is incremented by           stored on a disk. This command acts exactly like
one, and the FDC continues writing to the next          a Read Data command except that no data is
data field. The FDC continues this "Multi-Sector        transferred to the host. Data is read from the disk
Write Operation". Upon receipt of a terminal count      and CRC is computed and checked against the
signal or if a FIFO over/under run occurs while a       previously-stored value.
data field is being written, then the remainder of
the data field is filled with zeros. The FDC reads      Because data is not transferred to the host, TC
the ID field of each sector and checks the CRC          (pin    89) cannot be used to terminate this
bytes. If it detects a CRC error in one of the ID       command. By setting the EC bit to "1", an implicit
fields, it sets the IC code in Status Register          TC will be issued to the FDC. This implicit TC
                                                        will occur when the SC value has decremented
0 to "01" (abnormal termination), sets the DE bit of    to 0 (an SC value of 0 will verify 256 sectors). This
Status Register 1 to "1", and terminates the Write      command can also be terminated by setting the
Data command.                                           EC bit to "0" and the EOT value equal to the final
                                                        sector to be checked. If EC is set to "0", DTL/SC
The Write Data command operates in much the             should be programmed to 0FFH. Refer to Table
same manner as the Read Data command. The               23 and Table 24 for information concerning the
following items are the same. Please refer to the       values of MT and EC versus SC and EOT value.
Read Data Command for details:
                                                        Definitions:
•    Transfer Capacity                                  # Sectors Per Side = Number of formatted sectors
•    EN (End of Cylinder) bit                           per each side of the disk.
•    ND (No Data) bit                                   # Sectors Remaining = Number of formatted
•    Head Load, Unload Time Interval                    sectors left which can be read, including side 1 of
•    ID information when the host terminates the        the disk if MT is set to "1".
     command
                                                     58


                               TABLE 28 - VERIFY COMMAND RESULT PHASE
      MT             EC                      SC/EOT VALUE                        TERMINATION RESULT
       0              0          SC = DTL                                  Success Termination
                                 EOT # Sectors Per Side                    Result Phase Valid
       0              0          SC = DTL                                  Unsuccessful Termination
                                 EOT > # Sectors Per Side                  Result Phase Invalid
       0              1          SC # Sectors Remaining AND                Successful Termination
                                 EOT # Sectors Per Side                    Result Phase Valid
       0              1          SC > # Sectors Remaining OR               Unsuccessful Termination
                                 EOT > # Sectors Per Side                  Result Phase Invalid
       1              0          SC = DTL                                  Successful Termination
                                 EOT # Sectors Per Side                    Result Phase Valid
       1              0          SC = DTL                                  Unsuccessful Termination
                                 EOT > # Sectors Per Side                  Result Phase Invalid
       1              1          SC # Sectors Remaining AND                Successful Termination
                                 EOT # Sectors Per Side                    Result Phase Valid
       1              1          SC > # Sectors Remaining OR               Unsuccessful Termination
                                 EOT > # Sectors Per Side                  Result Phase Invalid
Note:     If MT is set to "1" and the SC value is greater than the number of remaining formatted sectors on
            Side 0, verifying will continue on Side 1 of the disk.
Format A Track                                                C, H, R, and N (cylinder, head, sector number and
                                                              sector size respectively).
The Format command allows an entire track to be               After formatting each sector, the host must send
formatted. After a pulse from the IDX pin is                  new values for C, H, R and N to the FDC for the
detected, the FDC starts writing data on the disk             next sector on the track. The R value (sector
including gaps, address marks, ID fields, and data            number) is the only value that must be changed by
fields per the IBM System 34 or 3740 format (MFM              the host after each sector is formatted. This
or FM respectively). The particular values that will          allows the disk to be formatted with nonsequential
be written to the gap and data field are controlled           sector addresses (interleaving). This incrementing
by the values programmed into N, SC, GPL, and D               and formatting continues for the whole track until
which are specified by the host during the                    the FDC encounters a pulse on the IDX pin again
command phase. The data field of the sector is                and it terminates the command.
filled with the data byte specified by D. The ID field
for each sector is supplied by the host; that is, four        Table 25 contains typical values for gap fields
data bytes per sector are needed by the FDC for               which are dependent upon the size of the sector
                                                              and the number of sectors on each track. Actual
                                                              values can vary due to drive electronics.
                                                          59


                                 FORMAT FIELDS
                      SYSTEM 34 (DOUBLE DENSITY) FORMAT
                                                        DATA
GAP4a SYNC  IAM  GAP1 SYNC  IDAM  C  H S N C GAP2 SYNC    AM        C
 80x   12x        50x  12x        Y  D E O R  22x   12x        DATA R GAP3 GAP 4b
 4E    00         4E    00        L    C   C   4E    00             C
           3x FC           3x FE                        3x FB
           C2              A1                           A1 F8
                      SYSTEM 3740 (SINGLE DENSITY) FORMAT
                                                        DATA
GAP4a SYNC  IAM  GAP1 SYNC  IDAM  C  H S N C GAP2 SYNC    AM        C
 40x    6x        26x   6x        Y  D E O R  11x    6x        DATA R GAP3 GAP 4b
 FF    00         FF    00        L    C   C   FF    00             C
             FC              FE                          FB or
                                                          F8
                            PERPENDICULAR FORMAT
                                                        DATA
GAP4a SYNC  IAM  GAP1 SYNC  IDAM  C  H S N C GAP2 SYNC    AM        C
 80x   12x        50x  12x        Y  D E O R  41x   12x        DATA R GAP3 GAP 4b
 4E    00         4E    00        L    C   C   4E    00             C
           3x FC           3x FE                        3x FB
           C2              A1                           A1 F8
                                       60


                  TABLE 29 - TYPICAL VALUES FOR FORMATTING
            FORMAT SECTOR SIZE                  N         SC    GPL1 GPL2
                                128             00         12    07   09
                                128             00         10    10   19
                                512             02         08    18   30
                FM             1024             03         04    46   87
                               2048             04         02    C8   FF
  5.25"                        4096             05         01    C8   FF
  Drives                         ...            ...
                                256             01         12    0A   0C
                                256             01         10    20   32
                               512*             02         09    2A   50
               MFM             1024             03         04    80   F0
                               2048             04         02    C8   FF
                               4096             05         01    C8   FF
                                 ...            ...
                                128              0         0F    07   1B
   3.5"         FM              256              1         09    0F   2A
  Drives                        512              2         05    1B   3A
                                256              1         0F    0E   36
               MFM             512**             2         09    1B   54
                               1024              3         05    35   74
GPL1 = suggested GPL values in Read and Write commands to avoid splice point
between data field and ID field of contiguous sections.
GPL2 = suggested GPL value in Format A Track command.
*PC/AT values (typical)
**PS/2 values (typical). Applies with 1.0 MB and 2.0 MB drives.
NOTE: All values except sector size are in hex.
                                             61


CONTROL COMMANDS                                           the head position (PCN). During the command
                                                           phase of the recalibrate operation, the FDC is in
Control commands differ from the other                     the BUSY state, but during the execution phase it
commands in that no data transfer takes place.             is in a NON-BUSY state. At this time, another
Three commands generate an interrupt when                  Recalibrate command may be issued, and in this
complete: Read ID, Recalibrate, and Seek. The              manner parallel Recalibrate operations may be
other control commands do not generate an                  done on up to four drives at once.
interrupt.
                                                           Upon power up, the software must issue a
Read ID                                                    Recalibrate command to properly initialize all
                                                           drives and the controller.
The Read ID command is used to find the present
position of the recording heads. The FDC stores            Seek
the values from the first ID field it is able to read
into its registers. If the FDC does not find an ID         The read/write head within the drive is moved from
address mark on the diskette after the second              track to track under the control of the Seek
occurrence of a pulse on the nINDEX pin, it then           command. The FDC compares the PCN, which is
sets the IC code in Status Register 0 to "01"              the current head position, with the NCN and
(abnormal termination), sets the MA bit in Status          performs the following operation if there is a
Register 1 to "1", and terminates the command.             difference:
The following commands will generate an interrupt               PCN < NCN: Direction signal to drive set to   "1" (step in) and is
upon completion. They do not return any result                  PCN > NCN: Direction signal to drive set to   "0" (step out) and i
bytes. It is highly recommended that control
commands be followed by the Sense Interrupt                The rate at which step pulses are issued is
Status command. Otherwise, valuable interrupt              controlled by SRT (Stepping Rate Time) in the
status information will be lost.                           Specify command. After each step pulse is
                                                           issued, NCN is compared against PCN, and when
Recalibrate                                                NCN = PCN the SE bit in Status Register 0 is set
                                                           to "1" and the command is terminated. During the
This command causes the read/write head within             command phase of the seek or recalibrate
the FDC to retract to the track 0 position. The            operation, the FDC is in the BUSY state, but
FDC clears the contents of the PCN counter and             during the execution phase it is in the NON-BUSY
checks the status of the nTR0 pin from the FDD.            state. At this time, another Seek or Recalibrate
As long as the nTR0 pin is low, the DIR pin                command may be issued, and in this manner,
remains 0 and step pulses are issued. When the             parallel seek operations may be done on up to four
nTR0 pin goes high, the SE bit in Status Register          drives at once.
0 is set to "1" and the command is terminated. If
the nTR0 pin is still low after 79 step pulses have        Note that if implied seek is not enabled, the read
been issued, the FDC sets the SE and the EC bits           and write commands should be preceded by:
of Status Register 0 to "1" and terminates the
command. Disks capable of handling more than               1) Seek command - Step to the proper track
80 tracks per side may require more than one               2) Sense Interrupt Status command - Terminate
Recalibrate command to return the head back to                  the Seek command
physical Track 0.                                          3) Read ID - Verify head is on proper track
The Recalibrate command does not have a result             4) Issue Read/Write command.
phase.      The Sense Interrupt Status command
must be issued after the Recalibrate command to            The Seek command does not have a result phase.
effectively terminate it and to provide verification of    Therefore, it is highly recommended that the
                                                        62


Sense Interrupt Status command is issued after
the Seek command to terminate it and to provide        The Seek, Relative Seek, and Recalibrate
verification of the head position (PCN). The H bit     commands have no result phase. The Sense
(Head Address) in ST0 will always return to a "0".     Interrupt Status command must be issued
When exiting POWERDOWN mode, the FDC                   immediately after these commands to terminate
clears the PCN value and the status information to     them and to provide verification of the head
zero.      Prior to issuing the POWERDOWN              position (PCN). The H (Head Address) bit in ST0
command, it is highly recommended that the user        will always return a "0". If a Sense Interrupt Status
service all pending interrupts through the Sense       is not issued, the drive will continue to be BUSY
Interrupt Status command.                              and may affect the operation of the next
                                                       command.
Sense Interrupt Status
                                                       Sense Drive Status
An interrupt signal on FINT pin is generated by the
FDC for one of the following reasons:                  Sense Drive Status obtains drive status
                                                       information. It has not execution phase and goes
1. Upon entering the Result Phase of:                  directly to the result phase from the command
    a. Read Data command                               phase. Status Register 3 contains the drive status
    b. Read A Track command                            information.
    c. Read ID command
    d. Read Deleted Data command                       Specify
    e. Write Data command
    f. Format A Track command                          The Specify command sets the initial values for
    g. Write Deleted Data command                      each of the three internal times. The HUT (Head
    h. Verify command                                  Unload Time) defines the time from the end of the
                                                       execution phase of one of the read/write
2. End of Seek, Relative Seek, or Recalibrate          commands to the head unload state. The SRT
    command                                            (Step Rate Time) defines the time interval between
                                                       adjacent step pulses. Note that the spacing
3. FDC requires a data transfer during the             between the first and second step pulses may be
    execution phase in the non-DMA mode                shorter than the remaining step pulses. The HLT
                                                       (Head Load Time) defines the time between when
The Sense Interrupt Status command resets the          the Head Load signal goes high and the read/write
interrupt signal and, via the IC code and SE bit of    operation starts. The values change with the data
Status Register 0, identifies the cause of the         rate speed selection and are documented in Table
interrupt.                                             29. The values are the same for MFM and FM.
           INTERRUPT IDENTIFICATION
    SE        IC        INTERRUPT DUE TO               TABLE 30 - DRIVE CONTROL DELAYS (MS)
      0       11     Polling
      1       00     Normal termination of Seek
                     or Recalibrate command
                     Abnormal termination of
      1       01     Seek or Recalibrate
                     command
                                                    63


                                      HUT                                           SRT
                  2M       1M   500K 300K        250K        2M       1M       500K 300K        250K
            0     64       128   256      426     512          4       8        16     26.7      32
            1      4        8     16      26.7     32        3.75     7.5       15      25       30
            ..     ..       ..     ..      ..       ..         ..      ..        ..      ..       ..
           E      56       112   224      373     448         0.5      1         2     3.33       4
            F     60       120   240      400     480        0.25     0.5        1     1.67       2
                                                                  HLT
                      2M              1M               500K               300K              250K
           00          64             128               256                426               512
           01          0.5             1                 2                 3.3                4
           02           1              2                 4                 6.7                8
            ..          ..             ..                ..                 ..                .
           7F          63             126               252                420               504
           7F         63.5            127               254                423               508
The choice of DMA or non-DMA operations is                EIS - Enable Implied Seek. When set to "1", the
made by the ND bit. When this bit is "1", the non-        FDC will perform a Seek operation before
DMA mode is selected, and when ND is "0", the             executing a read or write command. Defaults to
DMA mode is selected. In DMA mode, data                   no implied seek.
transfers are signaled by the FDRQ pin. Non-DMA
mode uses the RQM bit and the FINT pin to signal          EFIFO - A "1" disables the FIFO (default). This
data transfers.                                           means data transfers are asked for on a byte-by-
                                                          byte basis. Defaults to "1", FIFO disabled. The
Configure                                                 threshold defaults to "1".
The Configure command is issued to select the             POLL - Disable polling of the drives. Defaults to
special features of the FDC.          A Configure         "0", polling enabled. When enabled, a single
command need not be issued if the default values          interrupt is generated after a reset. No polling is
of the FDC meet the system requirements.                  performed while the drive head is loaded and the
                                                          head unload delay has not expired.
Configure Default Values:
                                                          FIFOTHR - The FIFO threshold in the execution
EIS - No Implied Seeks                                    phase of read or write commands. This is
EFIFO - FIFO Disabled                                     programmable from 1 to 16 bytes. Defaults to one
POLL - Polling Enabled                                    byte. A "00" selects one byte; "0F" selects 16
FIFOTHR - FIFO Threshold Set to 1 Byte                    bytes.
PRETRK - Pre-Compensation Set to Track 0
                                                          PRETRK - Pre-Compensation Start Track
                                                          Number. Programmable from track 0 to 255.
                                                          Defaults to track 0. A "00" selects track 0; "FF"
                                                          selects track 255.
                                                          Version
                                                          The Version command checks to see if the
                                                          controller is an enhanced type or the older type
                                                          (765A). A value of 90 H is returned as the result
                                                          byte.
                                                     11


                                                           above 255 (D). It is the user's responsibility to
Relative Seek                                              compensate FDC functions (precompensation
                                                           track number) when accessing tracks greater than
The command is coded the same as for Seek,                 255. The FDC does not keep track that it is
except for the MSB of the first byte and the DIR           working in an "extended track area" (greater than
bit.                                                       255). Any command issued will use the current
                                                           PCN value except for the Recalibrate command,
           DIR             ACTION                          which only looks for the TRACK0 signal.
            0       Step Head Out                          Recalibrate will return an error if the head is farther
            1       Step Head In                           than 79 due to its limitation of issuing a maximum
                                                           of 80 step pulses. The user simply needs to issue
                                                           a second Recalibrate command.               The Seek
DIR      Head Step Direction Control
                                                           command and implied seeks will function correctly
                                                           within the 44 (D) track (299-255) area of the
RCN     Relative Cylinder Number that determines
                                                           "extended track area". It is the user's responsibility
        how many tracks to step the head in or out
                                                           not to issue a new track position that will exceed
        from the current track number.
                                                           the maximum track that is present in the extended
                                                           area.
The Relative Seek command differs from the Seek
command in that it steps the head the absolute
                                                           To return to the standard floppy range (0-255) of
number of tracks specified in the command
                                                           tracks, a Relative Seek should be issued to cross
instead of making a comparison against an
                                                           the track 255 boundary.
internal register. The Seek command is good for
drives that support a maximum of 256 tracks.
                                                           A Relative Seek can be used instead of the normal
Relative Seeks cannot be overlapped with other
                                                           Seek, but the host is required to calculate the
Relative Seeks. Only one Relative Seek can be
                                                           difference between the current head location and
active at a time. Relative Seeks may be
                                                           the new (target) head location. This may require
overlapped with Seeks and Recalibrates. Bit 4 of
                                                           the host to issue a Read ID command to ensure
Status Register 0 (EC) will be set if Relative Seek
                                                           that the head is physically on the track that
attempts to step outward beyond Track 0.
                                                           software assumes it to be.             Different FDC
                                                           commands will return different cylinder results
As an example, assume that a floppy drive has
                                                           which may be difficult to keep track of with
300 useable tracks. The host needs to read track
                                                           software without the Read ID command.
300 and the head is on any track (0-255). If a Seek
command is issued, the head will stop at track             Perpendicular Mode
255. If a Relative Seek command is issued, the
FDC will move the head the specified number of             The Perpendicular Mode command should be
tracks, regardless of the internal cylinder position       issued prior to executing Read/Write/Format
register (but will increment the register). If the head    commands that access a disk drive with
was on track 40 (d), the maximum track that the            perpendicular recording capability.          With this
FDC could position the head on using Relative              command, the length of the Gap2 field and VCO
Seek will be 295 (D), the initial track + 255 (D).         enable timing can be altered to accommodate the
The maximum count that the head can be moved               unique requirements of these drives. Table 28
with a single Relative Seek command is 255 (D).            describes the effects of the WGATE and GAP bits
                                                           for the Perpendicular Mode command. Upon a
The internal register, PCN, will overflow as the           reset, the FDC will default to the conventional
cylinder number crosses track 255 and will contain         mode (WGATE = 0, GAP = 0).
39 (D). The resulting PCN value is thus (RCN +
PCN) mod 256. Functionally, the FDC starts                 Selection of the 500 Kbps and 1 Mbps
counting from 0 again as the track number goes             perpendicular modes is independent of the actual
                                                        65


data rate selected in the Data Rate Select                will be written in the Gap2 field for the 500 Kbps
Register. The user must ensure that these two             perpendicular mode (WGATE = 1, GAP =0).
data rates remain consistent.
                                                          It should be noted that none of the alterations in
The Gap2 and VCO timing requirements for                  Gap2 size, VCO timing, or Write Gate timing affect
perpendicular recording type drives are dictated by       normal program flow. The information provided
the design of the read/write head. In the design of       here is just for background purposes and is not
this head, a pre-erase head precedes the normal           needed for normal operation.              Once the
read/write head by a distance of 200 micrometers.         Perpendicular Mode command is invoked, FDC
This works out to about 38 bytes at a 1 Mbps              software behavior from the user standpoint is
recording density. Whenever the write head is             unchanged.
enabled by the Write Gate signal, the pre-erase
head is also activated at the same time. Thus,            The perpendicular mode command is enhanced to
when the write head is initially turned on, flux          allow specific drives to be designated
transitions recorded on the media for the first 38        Perpendicular recording drives. This enhancement
bytes will not be preconditioned with the pre-erase       allows data transfers between Conventional and
head since it has not yet been activated. To              Perpendicular drives without having to issue
accommodate        this    head     activation    and     Perpendicular mode commands between the
deactivation time, the Gap2 field is expanded to a        accesses of the different drive types, nor having to
length of 41 bytes. The format field shown on             change write pre-compensation values.
Page 58 illustrates the change in the Gap2 field
size for the perpendicular format.                        When both GAP and WGATE bits of the
                                                          PERPENDICULAR MODE COMMAND are both
On the read back by the FDC, the controller must          programmed to "0" (Conventional mode), then D0,
begin synchronization at the beginning of the sync        D1, D2, D3, and D4 can be programmed
field. For the conventional mode, the internal PLL        independently to "1" for that drive to be set
VCO is enabled (VCOEN) approximately 24 bytes             automatically to Perpendicular mode. In this mode
from the start of the Gap2 field. But, when the           the following set of conditions also apply:
controller operates in the 1 Mbps perpendicular           1. The GAP2 written to a perpendicular drive
mode (WGATE = 1, GAP = 1), VCOEN goes                          during a write operation will depend upon the
active after 43 bytes to accommodate the                       programmed data rate.
increased Gap2 field size. For both cases, and            2. The write pre-compensation given to a
approximate two-byte cushion is maintained from                perpendicular mode drive will be 0ns.
the beginning of the sync field for the purposes of       3. For D0-D3 programmed to "0" for conventional
avoiding write splices in the presence of motor                mode drives any data written will be at the
speed variation.                                               currently programmed write pre-compensation.
For the Write Data case, the FDC activates Write          Note: Bits D0-D3 can only be overwritten when
Gate at the beginning of the sync field under the         OW is programmed as a "1".If either GAP or
conventional mode. The controller then writes a           WGATE is a "1" then D0-D3 are ignored.
new sync field, data address mark, data field, and
CRC as shown on page 57. With the pre-erase               Software and hardware resets have the following
head of the perpendicular drive, the write head           effect on the PERPENDICULAR MODE
must be activated in the Gap2 field to insure a           COMMAND:
proper write of the new sync field. For the 1 Mbps        1. "Software" resets (via the DOR or DSR
perpendicular mode (WGATE = 1, GAP = 1), 38                    registers) will only clear GAP and WGATE bits
bytes will be written in the Gap2 space. Since the             to "0". D0-D3 are unaffected and retain their
bit density is proportional to the data rate, 19 bytes         previous value.
                                                       66


2. "Hardware" resets will clear all bits (GAP,         mode.
   WGATE and D0-D3) to "0", i.e all conventional
                       TABLE 31 - EFFECTS OF WGATE AND GAP BITS
                                                               PORTION OF
                                                                  GAP 2
                                                    LENGTH OF  WRITTEN BY
                                                   GAP2 FORMAT WRITE DATA
               WGATE GAP              MODE             FIELD   OPERATION
                  0       0      Conventional         22 Bytes    0 Bytes
                  0       1      Perpendicular        22 Bytes   19 Bytes
                                 (500 Kbps)
                  1       0      Reserved             22 Bytes    0 Bytes
                                 (Conventional)
                  1       1      Perpendicular        41 Bytes   38 Bytes
                                 (1 Mbps)
                                                 67


LOCK                                                     accommodate the LOCK command and the
                                                         enhanced PERPENDICULAR MODE command
In order to protect systems with long DMA                the eighth byte of the DUMPREG command has
latencies against older application software that        been modified to contain the additional data from
can disable the FIFO the LOCK Command has                these two commands.
been added. This command should only be used
by the FDC routines, and application software
should refrain from using it. If an application calls    COMPATIBILITY
for the FIFO to be disabled then the CONFIGURE           This chip was designed with software
command should be used.                                  compatibility in mind. It is a fully backwards-
                                                         compatible solution with the older generation
The LOCK command defines whether the EFIFO,              765A/B disk controllers. The FDC also
FIFOTHR, and PRETRK parameters of the                    implements on-board registers for compatibility
CONFIGURE command can be RESET by the                    with the PS/2, as well as PC/AT and PC/XT,
DOR and DSR registers. When the LOCK bit is              floppy disk controller subsystems. After a
set to logic "1" all subsequent "software RESETS         hardware reset of the FDC, all registers,
by the DOR and DSR registers will not change the         functions and enhancements default to a PC/AT,
previously set parameters to their default values.       PS/2 or PS/2 Model 30 compatible operating
All "hardware" RESET from the RESET pin will set         mode, depending on how the IDENT and MFM
the LOCK bit to logic "0" and return the EFIFO,          bits are configured by the system BIOS.
FIFOTHR, and PRETRK to their default values. A
status byte is returned immediately after issuing a      FORCE WRITE PROTECT
LOCK command. This byte reflects the value of
the LOCK bit set by the command byte.                    The Force Write Protect function forces the FDD
                                                         nWRTPRT input active if the FORCE WRTPRT
                                                         bit is active. The Force Write Protect function
ENHANCED DUMPREG                                         applies to the nWRTPRT pin in the FDD
                                                         Interface as well as the nWRTPRT pin in the
The DUMPREG command is designed to support               Parallel Port FDC.       Refer to Configuration
system run-time diagnostics and application              Register L8CR_C5 for more information.
software     development      and     debug.      To
                                                      68


                                         SERIAL PORT (UART)
The chip incorporates two full function UARTs.            "1". OUT2 being a logic "0" disables that UART's
They are compatible with the NS16450, the 16450           interrupt. The second UART also supports IrDA
ACE registers and the NS16C550A. The UARTS                1.0, HP-SIR and ASK-IR infrared modes of
perform serial-to-parallel conversion on received         operation.
characters and parallel-to-serial conversion on
transmit characters.       The data rates are             Note: The UARTs may be configured to share an
independently programmable from 460.8K baud               interrupt. Refer to the Configuration section for
down to 50 baud. The character options are                more information.
programmable for 1 start; 1, 1.5 or 2 stop bits;
even, odd, sticky or no parity; and prioritized           REGISTER DESCRIPTION
interrupts. The UARTs each contain a
programmable baud rate generator that is capable          Addressing of the accessible registers of the Serial
of dividing the input clock or crystal by a number        Port is shown below. The configuration registers
from 1 to 65535. The UARTs are also capable of            (see Configuration section) define the base
supporting the MIDI data rate. Refer to the               addresses of the serial ports. The Serial Port
Configuration Registers for information on                registers are located at sequentially increasing
disabling, power down and changing the base               addresses above these base addresses. The chip
address of the UARTs. The interrupt from a                contains two serial ports, each of which contain a
UART is enabled by programming OUT2 of that               register set as described below.
UART               to            a             logic
                              TABLE 32 - ADDRESSING THE SERIAL PORT
                 DLAB*      A2        A1       A0                REGISTER NAME
                   0         0         0        0     Receive Buffer (read)
                   0         0         0        0     Transmit Buffer (write)
                   0         0         0        1     Interrupt Enable (read/write)
                   X         0         1        0     Interrupt Identification (read)
                   X         0         1        0     FIFO Control (write)
                   X         0         1        1     Line Control (read/write)
                   X         1         0        0     Modem Control (read/write)
                   X         1         0        1     Line Status (read/write)
                   X         1         1        0     Modem Status (read/write)
                   X         1         1        1     Scratchpad (read/write)
                   1         0         0        0     Divisor LSB (read/write)
                   1         0         0        1     Divisor MSB (read/write
                *Note: DLAB is Bit 7 of the Line Control Register
The following section describes the operation of the registers.
                                                     69


RECEIVE BUFFER REGISTER (RB)                              Bit 1
Address Offset = 0H, DLAB = 0, READ ONLY                  This bit enables the Transmitter Holding Register
This register holds the received incoming data            Empty Interrupt when set to logic "1".
byte. Bit 0 is the least significant bit, which is        Bit 2
transmitted and received first. Received data is          This bit enables the Received Line Status Interrupt
double buffered; this uses an additional shift            when set to logic "1". The error sources causing
register to receive the serial data stream and            the interrupt are Overrun, Parity, Framing and
convert it to a parallel 8 bit word which is              Break. The Line Status Register must be read to
transferred to the Receive Buffer register. The           determine the source.
shift register is not accessible.                         Bit 3
                                                          This bit enables the MODEM Status Interrupt
TRANSMIT BUFFER REGISTER (TB)                             when set to logic "1". This is caused when one of
Address Offset = 0H, DLAB = 0, WRITE ONLY                 the Modem Status Register bits changes state.
                                                          Bits 4 through 7
This register contains the data byte to be                These bits are always logic "0".
transmitted.        The transmit buffer is double
buffered, utilizing an additional shift register (not     FIFO CONTROL REGISTER (FCR)
accessible) to convert the 8 bit data word to a           Address Offset = 2H, DLAB = X, WRITE
serial format. This shift register is loaded from the
Transmit Buffer when the transmission of the              This is a write only register at the same location as
previous byte is complete.                                the IIR. This register is used to enable and clear
                                                          the FIFOs, set the RCVR FIFO trigger level. Note:
INTERRUPT ENABLE REGISTER (IER)                           DMA is not supported. The UART1 and UART2
Address Offset = 1H, DLAB = 0, READ/WRITE                 FCR’s are shadowed in the UART1 FIFO Control
                                                          Shadow Register (LD8:CRC3[7:0]) and UART2
The lower four bits of this register control the          FIFO Control Shadow Register (LD8:CRC4[7:0]).
enables of the five interrupt sources of the Serial
Port interrupt. It is possible to totally disable the     Bit 0
interrupt system by resetting bits 0 through 3 of         Setting this bit to a logic "1" enables both the XMIT
this register. Similarly, setting the appropriate bits    and RCVR FIFOs. Clearing this bit to a logic "0"
of this register to a high, selected interrupts can be    disables both the XMIT and RCVR FIFOs and
enabled. Disabling the interrupt system inhibits          clears all bytes from both FIFOs. When changing
the Interrupt Identification Register and disables        from FIFO Mode to non-FIFO (16450) mode, data
any Serial Port interrupt out of the chip. All other      is automatically cleared from the FIFOs. This bit
system functions operate in their normal manner,          must be a 1 when other bits in this register are
including the Line Status and MODEM Status                written to or they will not be properly programmed.
Registers. The contents of the Interrupt Enable
Register are described below.                             Bit 1
                                                          Setting this bit to a logic "1" clears all bytes in the
Bit 0                                                     RCVR FIFO and resets its counter logic to 0. The
This bit enables the Received Data Available              shift register is not cleared. This bit is self-
Interrupt (and timeout interrupts in the FIFO mode)       clearing.
when set to logic "1".
                                                       70


Bit 2                                                      Information indicating that a prioritized interrupt is
Setting this bit to a logic "1" clears all bytes in the    pending and the source of that interrupt is stored
XMIT FIFO and resets its counter logic to 0. The           in the Interrupt Identification Register (refer to
shift register is not cleared. This bit is self-           Interrupt Control Table). When the CPU accesses
clearing.                                                  the IIR, the Serial Port freezes all interrupts and
Bit 3                                                      indicates the highest priority pending interrupt to
Writing to this bit has no effect on the operation of      the CPU. During this CPU access, even if the
the UART. The RXRDY and TXRDY pins are not                 Serial Port records new interrupts, the current
available on this chip.                                    indication does not change until access is
Bit 4,5                                                    completed. The contents of the IIR are described
Reserved                                                   below.
Bit 6,7
These bits are used to set the trigger level for the       Bit 0
RCVR FIFO interrupt.                                       This bit can be used in either a hardwired
                                                           prioritized or polled environment to indicate
                             RCVR FIFO                     whether an interrupt is pending. When bit 0 is a
      Bit 7    Bit 6   Trigger Level (BYTES)               logic "0", an interrupt is pending and the contents
        0        0                  1                      of the IIR may be used as a pointer to the
                                                           appropriate internal service routine. When bit 0 is
        0        1                  4                      a logic "1", no interrupt is pending.
        1        0                  8
                                                           Bits 1 and 2
        1        1                 14                      These two bits of the IIR are used to identify the
                                                           highest priority interrupt pending as indicated by
                                                           the Interrupt Control Table.
INTERRUPT IDENTIFICATION REGISTER (IIR)
Address Offset = 2H, DLAB = X, READ                        Bit 3
                                                           In non-FIFO mode, this bit is a logic "0". In FIFO
By accessing this register, the host CPU can               mode this bit is set along with bit 2 when a timeout
determine the highest priority interrupt and its           interrupt is pending.
source. Four levels of priority interrupt exist. They
are in descending order of priority:                       Bits 4 and 5
                                                           These bits of the IIR are always logic "0".
1.   Receiver Line Status (highest priority)
2.   Received Data Ready                                   Bits 6 and 7
3.   Transmitter Holding Register Empty                    These two bits are set when the FIFO CONTROL
4.   MODEM Status (lowest priority)                        Register bit 0 equals 1.
                                                        71


                         TABLE 33 - INTERRUPT CONTROL
FIFO      INTERRUPT
MODE   IDENTIFICATION
ONLY       REGISTER                  INTERRUPT SET AND RESET FUNCTIONS
                          PRIORITY      INTERRUPT       INTERRUPT           INTERRUPT
BIT 3 BIT 2  BIT 1 BIT 0   LEVEL           TYPE           SOURCE              RESET
                                                                             CONTROL
  0     0      0     1          -     None           None                         -
  0     1      1     0    Highest     Receiver Line  Overrun Error,     Reading the Line
                                      Status         Parity Error,      Status Register
                                                     Framing Error or
                                                     Break Interrupt
  0     1      0     0    Second      Received Data  Receiver Data      Read Receiver
                                      Available      Available          Buffer or the FIFO
                                                                        drops below the
                                                                        trigger level.
  1     1      0     0    Second      Character      No Characters      Reading the
                                      Timeout        Have Been          Receiver Buffer
                                      Indication     Removed From or Register
                                                     Input to the RCVR
                                                     FIFO during the
                                                     last 4 Char times
                                                     and there is at
                                                     least 1 char in it
                                                     during this time
  0     0      1     0    Third       Transmitter    Transmitter        Reading the IIR
                                      Holding        Holding Register   Register (if Source
                                      Register Empty Empty              of Interrupt) or
                                                                        Writing the
                                                                        Transmitter
                                                                        Holding Register
  0     0      0     0    Fourth      MODEM Status Clear to Send or     Reading the
                                                     Data Set Ready or MODEM Status
                                                     Ring Indicator or  Register
                                                     Data Carrier
                                                     Detect
                                          72


                                                                   NUMBER OF
                                   BIT 2         WORD               STOP BITS
                                                LENGTH
                                     0              --                   1
                                     1            5 bits                1.5
                                     1            6 bits                 2
                                     1            7 bits                 2
                                     1            8 bits                 2
LINE CONTROL REGISTER (LCR)                                  Bits 0 and 1
Address Offset = 3H, DLAB = 0, READ/WRITE                    These two bits specify the number of bits in each
                                                             transmitted or received serial character. The
This register contains the format information of the         encoding of bits 0 and 1 is as follows:
serial line. The bit definitions are:
                                                             The Start, Stop and Parity bits are not included in
                                                             the word length.
                                         BIT 1    BIT 0    WORD LENGTH
                                           0         0          5 Bits
                                           0         1          6 Bits
                                           1         0          7 Bits
                                           1         1          8 Bits
Bit 2                                                        Bit 5
This bit specifies the number of stop bits in each           Stick Parity bit. When bit 3 is a logic "1" and bit 5
transmitted or received serial character. The                is a logic "1", the parity bit is transmitted and then
following table summarizes the information. Note:            detected by the receiver in the opposite state
The receiver will ignore all stop bits beyond the            indicated by bit 4.
first, regardless of the number used in transmitting.        Bit 6
Bit 3                                                        Set Break Control bit. When bit 6 is a logic "1", the
Parity Enable bit. When bit 3 is a logic "1", a parity       transmit data output (TXD) is forced to the
bit is generated (transmit data) or checked                  Spacing or logic "0" state and remains there (until
(receive data) between the last data word bit and            reset by a low level bit 6) regardless of other
the first stop bit of the serial data. (The parity bit is    transmitter activity. This feature enables the Serial
used to generate an even or odd number of 1s                 Port to alert a terminal in a communications
when the data word bits and the parity bit are               system.
summed).                                                     Bit 7
Bit 4                                                        Divisor Latch Access bit (DLAB). It must be set
Even Parity Select bit. When bit 3 is a logic "1"            high (logic "1") to access the Divisor Latches of the
and bit 4 is a logic "0", an odd number of logic "1"'s       Baud Rate Generator during read or write
is transmitted or checked in the data word bits and          operations. It must be set low (logic "0") to access
the parity bit. When bit 3 is a logic "1" and bit 4 is       the Receiver Buffer Register, the Transmitter
a logic "1" an even number of bits is transmitted            Holding Register, or the Interrupt Enable Register.
and checked.
                                                          73


MODEM CONTROL REGISTER (MCR)                              This feature allows the processor to verify the
Address Offset = 4H, DLAB = X, READ/WRITE                 transmit and receive data paths of the Serial Port.
This 8 bit register controls the interface with the       In the diagnostic mode, the receiver and the
MODEM or data set (or device emulating a                  transmitter interrupts are fully operational. The
MODEM). The contents of the MODEM control                 MODEM Control Interrupts are also operational
register are described below.                             but the interrupts' sources are now the lower four
Bit 0                                                     bits of the MODEM Control Register instead of the
This bit controls the Data Terminal Ready (nDTR)          MODEM Control inputs. The interrupts are still
output. When bit 0 is set to a logic "1", the nDTR        controlled by the Interrupt Enable Register.
output is forced to a logic "0". When bit 0 is a logic
"0", the nDTR output is forced to a logic "1".            Bits 5 through 7
Bit 1                                                     These bits are permanently set to logic zero.
This bit controls the Request To Send (nRTS)
output. Bit 1 affects the nRTS output in a manner         LINE STATUS REGISTER (LSR)
identical to that described above for bit 0.              Address Offset = 5H, DLAB = X, READ/WRITE
Bit 2
This bit controls the Output 1 (OUT1) bit. This bit       Bit 0
does not have an output pin and can only be read          Data Ready (DR). It is set to a logic "1" whenever
or written by the CPU.                                    a complete incoming character has been received
Bit 3                                                     and transferred into the Receiver Buffer Register
Output 2 (OUT2). This bit is used to enable an            or the FIFO. Bit 0 is reset to a logic "0" by reading
UART interrupt. When OUT2 is a logic "0", the             all of the data in the Receive Buffer Register or the
serial port interrupt output is forced to a high          FIFO.
impedance state - disabled. When OUT2 is a                Bit 1
logic "1", the serial port interrupt outputs are          Overrun Error (OE). Bit 1 indicates that data in the
enabled.                                                  Receiver Buffer Register was not read before the
Bit 4                                                     next character was transferred into the register,
This bit provides the loopback feature for                thereby destroying the previous character. In
diagnostic testing of the Serial Port. When bit 4 is      FIFO mode, an overrun error will occur only when
set to logic "1", the following occur:                    the FIFO is full and the next character has been
                                                          completely received in the shift register, the
1. The TXD is set to the Marking State(logic "1").        character in the shift register is overwritten but not
2. The receiver Serial Input (RXD) is                     transferred to the FIFO. The OE indicator is set to
    disconnected.                                         a logic "1" immediately upon detection of an
3. The output of the Transmitter Shift Register is        overrun condition, and reset whenever the Line
    "looped back" into the Receiver Shift Register        Status Register is read.
    input.                                                Bit 2
4. All MODEM Control inputs (nCTS, nDSR, nRI              Parity Error (PE). Bit 2 indicates that the received
    and nDCD) are disconnected.                           data character does not have the correct even or
5. The four MODEM Control outputs (nDTR,                  odd parity, as selected by the even parity select
    nRTS, OUT1 and OUT2) are internally                   bit. The PE is set to a logic "1" upon detection of a
    connected to the four MODEM Control inputs            parity error and is reset to a logic "0" whenever the
    (nDSR, nCTS, RI, DCD).                                Line Status Register is read. In the FIFO mode
6. The Modem Control output pins are forced               this error is associated with the particular character
    inactive high.                                        in the FIFO it applies to. This error is indicated
7. Data that is transmitted is immediately                when the associated character is at the top of the
    received.                                             FIFO.
                                                          Bit 3
                                                       74


Framing Error (FE). Bit 3 indicates that the               Bit 5
received character did not have a valid stop bit.          Transmitter Holding Register Empty (THRE). Bit 5
Bit 3 is set to a logic "1" whenever the stop bit          indicates that the Serial Port is ready to accept a
following the last data bit or parity bit is detected      new character for transmission. In addition, this bit
as a zero bit (Spacing level). The FE is reset to a        causes the Serial Port to issue an interrupt when
logic "0" whenever the Line Status Register is             the Transmitter Holding Register interrupt enable
read. In the FIFO mode this error is associated            is set high. The THRE bit is set to a logic "1" when
with the particular character in the FIFO it applies       a character is transferred from the Transmitter
to. This error is indicated when the associated            Holding Register into the Transmitter Shift
character is at the top of the FIFO. The Serial Port       Register. The bit is reset to logic "0" whenever the
will try to resynchronize after a framing error. To        CPU loads the Transmitter Holding Register. In
do this, it assumes that the framing error was due         the FIFO mode this bit is set when the XMIT FIFO
to the next start bit, so it samples this 'start' bit      is empty, it is cleared when at least 1 byte is
twice and then takes in the 'data'.                        written to the XMIT FIFO. Bit 5 is a read only bit.
Bit 4                                                      Bit 6
Break Interrupt (BI). Bit 4 is set to a logic "1"          Transmitter Empty (TEMT). Bit 6 is set to a logic
whenever the received data input is held in the            "1" whenever the Transmitter Holding Register
Spacing state (logic "0") for longer than a full word      (THR) and Transmitter Shift Register (TSR) are
transmission time (that is, the total time of the start    both empty. It is reset to logic "0" whenever either
bit + data bits + parity bits + stop bits). The BI is      the THR or TSR contains a data character. Bit 6
reset after the CPU reads the contents of the Line         is a read only bit. In the FIFO mode this bit is set
Status Register. In the FIFO mode this error is            whenever the THR and TSR are both empty,
associated with the particular character in the            Bit 7
FIFO it applies to. This error is indicated when the       This bit is permanently set to logic "0" in the 450
associated character is at the top of the FIFO.            mode. In the FIFO mode, this bit is set to a logic
When break occurs only one zero character is               "1" when there is at least one parity error, framing
loaded into the FIFO. Restarting after a break is          error or break indication in the FIFO. This bit is
received, requires the serial data (RXD) to be logic       cleared when the LSR is read if there are no
"1" for at least 1/2 bit time.                             subsequent errors in the FIFO.
Note: Bits 1 through 4 are the error conditions that       MODEM STATUS REGISTER (MSR)
produce a Receiver Line Status Interrupt                   Address Offset = 6H, DLAB = X, READ/WRITE
whenever any of the corresponding conditions are
detected and the interrupt is enabled.                     This 8 bit register provides the current state of the
                                                           control lines from the MODEM (or peripheral
                                                           device).      In addition to this current state
                                                           information, four bits of the MODEM Status
                                                           Register (MSR) provide change information.
                                                           These bits are set to logic "1" whenever a control
                                                           input from the MODEM changes state. They are
                                                           reset to logic "0" whenever the MODEM Status
                                                           Register is read.
                                                        75


Bit 0                                                     Detect (nDCD) input. If bit 4 of the MCR is set to
Delta Clear To Send (DCTS). Bit 0 indicates that          logic "1", this bit is equivalent to OUT2 in the MCR.
the nCTS input to the chip has changed state
since the last time the MSR was read.                     SCRATCHPAD REGISTER (SCR)
Bit 1                                                     Address Offset =7H, DLAB =X, READ/WRITE
Delta Data Set Ready (DDSR). Bit 1 indicates that         This 8 bit read/write register has no effect on the
the nDSR input has changed state since the last           operation of the Serial Port. It is intended as a
time the MSR was read.                                    scratchpad register to be used by the programmer
Bit 2                                                     to hold data temporarily.
Trailing Edge of Ring Indicator (TERI). Bit 2
indicates that the nRI input has changed from logic       PROGRAMMABLE BAUD RATE GENERATOR
"0" to logic "1".                                         (AND DIVISOR LATCHES DLH, DLL)
Bit 3                                                     The Serial Port contains a programmable Baud
Delta Data Carrier Detect (DDCD). Bit 3 indicates         Rate Generator that is capable of taking any clock
that the nDCD input to the chip has changed state.        input (DC to 3 MHz) and dividing it by any divisor
                                                          from 1 to 65535. This output frequency of the
Note: Whenever bit 0, 1, 2, or 3 is set to a logic        Baud Rate Generator is 16x the Baud rate. Two 8
"1", a MODEM Status Interrupt is generated.               bit latches store the divisor in 16 bit binary format.
Bit 4                                                     These Divisor Latches must be loaded during
This bit is the complement of the Clear To Send           initialization in order to insure desired operation of
(nCTS) input. If bit 4 of the MCR is set to logic "1",    the Baud Rate Generator. Upon loading either of
this bit is equivalent to nRTS in the MCR.                the Divisor Latches, a 16 bit Baud counter is
Bit 5                                                     immediately loaded. This prevents long counts on
This bit is the complement of the Data Set Ready          initial load. If a 0 is loaded into the BRG registers
(nDSR) input. If bit 4 of the MCR is set to logic         the output divides the clock by the number 3. If a
"1", this bit is equivalent to DTR in the MCR.            1 is loaded the output is the inverse of the input
Bit 6                                                     oscillator. If a two is loaded the output is a divide
This bit is the complement of the Ring Indicator          by 2 signal with a 50% duty cycle. If a 3 or greater
(nRI) input. If bit 4 of the MCR is set to logic "1",     is loaded the output is low for 2 bits and high for
this bit is equivalent to OUT1 in the MCR.                the remainder of the count. The input clock to the
Bit 7                                                     BRG is a 1.8462 MHz clock.
This bit is the complement of the Data Carrier
                                                          Table 31 shows the baud rates possible with a
                                                          1.8462 MHz crystal.
                                                       76


         Table 34 - Baud Rates Using 1.8462 MHz Clock for <= 38.4K; Using 1.8432MHz Clock
          for 115.2k ; Using 3.6864MHz Clock for 230.4k; Using 7.3728 MHz Clock for 460.8k
    DESIRED             DIVISOR USED TO               PERCENT ERROR DIFFERENCE                 HIGH
                                                                                         1
   BAUD RATE        GENERATE 16X CLOCK              BETWEEN DESIRED AND ACTUAL             SPEED BIT2
         50                     2304                                0.001                        X
         75                     1536                                   -                         X
        110                     1047                                   -                         X
       134.5                    857                                 0.004                        X
        150                      768                                   -                         X
        300                      384                                   -                         X
        600                      192                                   -                         X
        1200                     96                                    -                         X
        1800                     64                                    -                         X
        2000                     58                                 0.005                        X
        2400                     48                                    -                         X
        3600                     32                                    -                         X
        4800                     24                                    -                         X
        7200                     16                                    -                         X
        9600                     12                                    -                         X
       19200                      6                                    -                         X
       38400                      3                                 0.030                        X
       57600                      2                                 0.16                         X
      115200                      1                                 0.16                         X
      230400                   32770                                 0.16                        1
      460800                   32769                                 0.16                        1
Note1: The percentage error for all baud rates, except where indicated otherwise, is 0.2%.
Note 2: The High Speed bit is located in the Device Configuration Space.
Effect Of The Reset on Register File
The Reset Function Table (Table 35) details the effect of the Reset input on each of the registers of the
Serial Port.
                                                     77


FIFO INTERRUPT MODE OPERATION                              C. When a timeout interrupt has occurred it is
                                                               cleared and the timer reset when the CPU
When the RCVR FIFO and receiver interrupts are                 reads one character from the RCVR FIFO.
enabled (FCR bit 0 = "1", IER bit 0 = "1"), RCVR
interrupts occur as follows:                               D. When a timeout interrupt has not occurred the
                                                               timeout timer is reset after a new character is
A. The receive data available interrupt will be                received or after the CPU reads the RCVR
     issued when the FIFO has reached its                      FIFO.
     programmed trigger level; it is cleared as soon
     as the FIFO drops below its programmed                When the XMIT FIFO and transmitter interrupts
     trigger level.                                        are enabled (FCR bit 0 = "1", IER bit 1 = "1"),
                                                           XMIT interrupts occur as follows:
B. The IIR receive data available indication also
     occurs when the FIFO trigger level is reached.        A. The transmitter holding register interrupt (02H)
     It is cleared when the FIFO drops below the               occurs when the XMIT FIFO is empty; it is
     trigger level.                                            cleared as soon as the transmitter holding
                                                               register is written to (1 of 16 characters may be
C. The receiver line status interrupt (IIR=06H), has           written to the XMIT FIFO while servicing this
     higher priority than the received data available          interrupt) or the IIR is read.
     (IIR=04H) interrupt.
                                                           B. The transmitter FIFO empty indications will be
D. The data ready bit (LSR bit 0) is set as soon as            delayed 1 character time minus the last stop
     a character is transferred from the shift register        bit time whenever the following occurs:
     to the RCVR FIFO. It is reset when the FIFO               THRE=1 and there have not been at least two
     is empty.                                                 bytes at the same time in the transmitter FIFO
                                                               since the last THRE=1. The transmitter
When RCVR FIFO and receiver interrupts are                     interrupt after changing FCR0 will be
enabled, RCVR FIFO timeout interrupts occur as                 immediate, if it is enabled.
follows:
                                                           Character timeout and RCVR FIFO trigger level
A. A FIFO timeout interrupt occurs if all the              interrupts have the same priority as the current
     following conditions exist:                           received data available interrupt; XMIT FIFO
-     At least one character is in the FIFO.               empty has the same priority as the current
-     The most recent serial character received            transmitter holding register empty interrupt.
      was longer than 4 continuous character times
      ago. (If 2 stop bits are programmed, the
      second one is included in this time delay).
-     The most recent CPU read of the FIFO was
      longer than 4 continuous character times ago.
This will cause a maximum character received to
interrupt issued delay of 160 msec at 300 BAUD
with a 12 bit character.
B. Character times are calculated by using the
     RCLK input for a clock signal (this makes the
     delay proportional to the baudrate).
                                                        78


FIFO POLLED MODE OPERATION                                  occurred. Character error status is handled
                                                            the same way as when in the interrupt
With FCR bit 0 = "1" resetting IER bits 0, 1, 2 or 3        mode, the IIR is not affected since EIR bit
or all to zero puts the UART in the FIFO Polled             2=0.
Mode of operation.        Since the RCVR and            -   Bit 5 indicates when the XMIT FIFO is empty.
XMITTER are controlled separately, either one or        -   Bit 6 indicates that both the XMIT FIFO and
both can be in the polled mode of operation. In this        shift register are empty.
mode, the user's program will check RCVR and            -   Bit 7 indicates whether there are any errors in
XMITTER status via the LSR. LSR definitions for             the RCVR FIFO.
the FIFO Polled Mode are as follows:
                                                        There is no trigger level reached or timeout
-    Bit 0=1 as long as there is one byte in the        condition indicated in the FIFO Polled Mode,
     RCVR FIFO.                                         however, the RCVR and XMIT FIFOs are still fully
-    Bits 1 to 4 specify which error(s) have            capable of holding characters.
                                                     79


                              TABLE 35 - RESET FUNCTION
      REGISTER/SIGNAL             RESET CONTROL                   RESET STATE
Interrupt Enable Register     RESET                    All bits low
Interrupt Identification Reg. RESET                    Bit 0 is high; Bits 1 - 7 low
FIFO Control                  RESET                    All bits low
Line Control Reg.             RESET                    All bits low
MODEM Control Reg.            RESET                    All bits low
Line Status Reg.              RESET                    All bits low except 5, 6 high
MODEM Status Reg.             RESET                    Bits 0 - 3 low; Bits 4 - 7 input
TXD1, TXD2                    RESET                    High
INTRPT (RCVR errs)            RESET/Read LSR           Low
INTRPT (RCVR Data Ready)      RESET/Read RBR           Low
INTRPT (THRE)                 RESET/ReadIIR/Write THR  Low
OUT2B                         RESET                    High
RTSB                          RESET                    High
DTRB                          RESET                    High
OUT1B                         RESET                    High
RCVR FIFO                     RESET/                   All Bits Low
                              FCR1*FCR0/_FCR0
XMIT FIFO                     RESET/                   All Bits Low
                              FCR1*FCR0/_FCR0
                                          80


            TABLE 36 - REGISTER SUMMARY FOR AN INDIVIDUAL UART CHANNEL
   REGISTER                                                          REGISTER
   ADDRESS*                     REGISTER NAME                          SYMBOL            BIT 0        BIT 1
 ADDR = 0            Receive Buffer Register (Read Only)                  RBR       Data Bit 0    Data Bit 1
 DLAB = 0                                                                           (Note 1)
 ADDR = 0            Transmitter Holding Register (Write                  THR       Data Bit 0    Data Bit 1
 DLAB = 0            Only)
 ADDR = 1            Interrupt Enable Register                             IER      Enable        Enable
 DLAB = 0                                                                           Received      Transmitter
                                                                                    Data          Holding
                                                                                    Available     Register
                                                                                    Interrupt     Empty
                                                                                    (ERDAI)       Interrupt
                                                                                                  (ETHREI)
 ADDR = 2            Interrupt Ident. Register (Read Only)                  IIR     "0" if        Interrupt ID
                                                                                    Interrupt     Bit
                                                                                    Pending
 ADDR = 2            FIFO Control Register (Write Only)                   FCR       FIFO Enable RCVR FIFO
                                                                        (Note 7)                  Reset
 ADDR = 3            Line Control Register                                LCR       Word Length Word Length
                                                                                    Select Bit 0 Select Bit 1
                                                                                    (WLS0)        (WLS1)
 ADDR = 4            MODEM Control Register                               MCR       Data          Request to
                                                                                    Terminal      Send (RTS)
                                                                                    Ready
                                                                                    (DTR)
 ADDR = 5            Line Status Register                                  LSR      Data Ready    Overrun
                                                                                    (DR)          Error (OE)
 ADDR = 6            MODEM Status Register                                MSR       Delta Clear   Delta Data
                                                                                    to Send       Set Ready
                                                                                    (DCTS)        (DDSR)
 ADDR = 7            Scratch Register (Note 4)                            SCR       Bit 0         Bit 1
 ADDR = 0            Divisor Latch (LS)                                   DDL       Bit 0         Bit 1
 DLAB = 1
 ADDR = 1            Divisor Latch (MS)                                   DLM       Bit 8         Bit 9
 DLAB = 1
*DLAB is Bit 7 of the Line Control Register (ADDR = 3).
Note 1: Bit 0 is the least significant bit. It is the first bit serially transmitted or received.
Note 2: When operating in the XT mode, this bit will be set any time that the transmitter shift register is
         empty.
                                                         81


   TABLE 37 - REGISTER SUMMARY FOR AN INDIVIDUAL UART CHANNEL (CONTINUED)
      BIT 2              BIT 3             BIT 4            BIT 5          BIT 6           BIT 7
Data Bit 2         Data Bit 3        Data Bit 4       Data Bit 5     Data Bit 6      Data Bit 7
Data Bit 2         Data Bit 3        Data Bit 4       Data Bit 5     Data Bit 6      Data Bit 7
Enable             Enable            0                0              0               0
Receiver Line      MODEM
Status             Status
Interrupt          Interrupt
(ELSI)             (EMSI)
Interrupt ID Bit Interrupt ID Bit 0                   0              FIFOs           FIFOs
                   (Note 5)                                          Enabled         Enabled
                                                                     (Note 5)        (Note 5)
XMIT FIFO          DMA Mode          Reserved         Reserved       RCVR Trigger    RCVR Trigger
Reset              Select (Note                                      LSB             MSB
                   6)
Number of          Parity Enable     Even Parity      Stick Parity   Set Break       Divisor Latch
Stop Bits          (PEN)             Select (EPS)                                    Access Bit
(STB)                                                                                (DLAB)
OUT1               OUT2              Loop             0              0               0
(Note 3)           (Note 3)
Parity Error       Framing Error     Break            Transmitter    Transmitter     Error in RCVR
(PE)               (FE)              Interrupt (BI)   Holding        Empty (TEMT) FIFO (Note 5)
                                                      Register       (Note 2)
                                                      (THRE)
Trailing Edge      Delta Data        Clear to Send    Data Set       Ring Indicator  Data Carrier
Ring Indicator     Carrier Detect    (CTS)            Ready (DSR)    (RI)            Detect (DCD)
(TERI)             (DDCD)
Bit 2              Bit 3             Bit 4            Bit 5          Bit 6           Bit 7
Bit 2              Bit 3             Bit 4            Bit 5          Bit 6            Bit 7
Bit 10             Bit 11            Bit 12           Bit 13         Bit 14          Bit 15
Note 3:  This bit no longer has a pin associated with it.
Note 4:  When operating in the XT mode, this register is not available.
Note 5:  These bits are always zero in the non-FIFO mode.
Note 6:  Writing a one to this bit has no effect. DMA modes are not supported in this chip.
Note 7:  The UART1 and UART2 FCR’s are shadowed in the UART1 FIFO Control Shadow Register
          (LD8:CRC3[7:0]) and UART2 FIFO Control Shadow Register (LD8:CRC4[7:0]).
                                                    82


NOTES ON SERIAL PORT OPERATION                          Rx support functions and operation are quite
                                                        different from those described for the transmitter.
FIFO MODE OPERATION:                                    The Rx FIFO receives data until the number of
                                                        bytes in the FIFO equals the selected interrupt
GENERAL                                                 trigger level. At that time if Rx interrupts are
                                                        enabled, the UART will issue an interrupt to the
The RCVR FIFO will hold up to 16 bytes                  CPU. The Rx FIFO will continue to store bytes
regardless of which trigger level is selected.          until it holds 16 of them. It will not accept any
                                                        more data when it is full. Any more data entering
TX AND RX FIFO OPERATION                                the Rx shift register will set the Overrun Error flag.
                                                        Normally, the FIFO depth and the programmable
The Tx portion of the UART transmits data through       trigger levels will give the CPU ample time to
TXD as soon as the CPU loads a byte into the Tx         empty the Rx FIFO before an overrun occurs.
FIFO. The UART will prevent loads to the Tx
FIFO if it currently holds 16 characters.               One side-effect of having a Rx FIFO is that the
Loading to the Tx FIFO will again be enabled as         selected interrupt trigger level may be above the
soon as the next character is transferred to the Tx     data level in the FIFO. This could occur when
shift register. These capabilities account for the      data at the end of the block contains fewer bytes
largely autonomous operation of the Tx.                 than the trigger level. No interrupt would be issued
                                                        to the CPU and the data would remain in the
The UART starts the above operations typically          UART. To prevent the software from having to
with a Tx interrupt. The chip issues a Tx interrupt     check for this situation the chip incorporates a
whenever the Tx FIFO is empty and the Tx                timeout interrupt.
interrupt is enabled, except in the following
instance. Assume that the Tx FIFO is empty and          The timeout interrupt is activated when there is a
the CPU starts to load it. When the first byte          least one byte in the Rx FIFO, and neither the
enters the FIFO the Tx FIFO empty interrupt will        CPU nor the Rx shift register has accessed the Rx
transition from active to inactive. Depending on the    FIFO within 4 character times of the last byte. The
execution speed of the service routine software,        timeout interrupt is cleared or reset when the CPU
the UART may be able to transfer this byte from         reads the Rx FIFO or another character enters it.
the FIFO to the shift register before the CPU loads
another byte. If this happens, the Tx FIFO will be      These FIFO related features allow optimization of
empty again and typically the UART's interrupt line     CPU/UART transactions and are especially useful
would transition to the active state. This could        given the higher baud rate capability (256 kbaud).
cause a system with an interrupt control unit to
record a Tx FIFO empty condition, even though           Ring Wake Filter
the CPU is currently servicing that interrupt.
Therefore, after the first byte has been loaded         An optional filter is provided to prevent glitches to
into the FIFO the UART will wait one serial             the wakeup circuitry and prevent unnecessary
character transmission time before issuing a            wakeup of the system when a phone is picked up
new Tx FIFO empty interrupt.               This one     or hung up. If enabled, this filter will be placed
character Tx interrupt delay will remain active         into the soft power management, SMI and
until at least two bytes have the Tx FIFO               PME/SCI wakeup event path of either of the
empties after this condition, the Tx been               UART ring indicator pins (nRI1, nRI2), or the
loaded into the FIFO, concurrently. When                nRING pin, which is an alternate function on
interrupt will be activated without a one               GP11 and GP62.
character delay.                                        This feature is enabled onto the nRING pin or
                                                        one of the ring indicator pins (nRI1, nRI2) via the
                                                        Ring Filter Select Register defined below. If
                                                     83


enabled, a frequency detection filter is placed in        •    RING Enable bit - R/W: RING_EN, Bit 0 of
the path to the soft power management block,                   SMI Register 1 (System I/O Space, at
SMI and PME interface that generates an active                 <PM1_BLK>+14h). 1=Enable ring indication
low pulse for the duration of a signal that                    on nRING pin as SMI function. 0=Disable.
produces 3 edges in a 200msec time period i.e.,                Note: The PME status bit for RING is used
detects a pulse train of frequency 15Hz or higher.             as the SMI status bit for RING (see PME
                                                               Status Register).
This filter circuit runs off of the 32 kHz clock. This
                                                          3.   A status and enable bit is in the PME status
circuit is powered by the VTR power supply.
                                                               and enable registers as follows:
When this circuit is disabled, it will draw no
                                                          •    RING Status bit - R/W: RING_STS, Bit 5 of
current.
                                                               PME Status Register 1 (System I/O Space,
The nRING function is part of the soft power                   at <PM1_BLK>+Ch); latched, cleared by
management block as an additional wakeup                       writing a “1” to this bit. 1= Ring indicator
event, and the SMI and PME interface logic.                    input occurred on the nRING pin and, if
1. A status and enable bit is in the soft power                enabled, caused the nPME/SCI or SMI. 0=
     status and enable registers as follows:                   nRING input did not occur.
•    RING Status bit - R/W: RING_STS, Bit 3 of            •    RING Enable bit - R/W: RING_EN, Bit 5 of
     Soft Power Status Register 2 (Logical                     PME Enable Register 1 (System I/O Space,
     Device 8, 0xB3); latched, cleared on read.                at <PM1_BLK>+Eh).            1=Enable ring
     1= Ring indicator input occurred on the                   indication on nRING pin as PME wakeup
     nRING pin and, if enabled, caused the                     function. 0=Disable.
     wakeup (activated nPowerOn). 0= nRING
     input did not occur.                                 Refer to Logical Device 8, 0xC6 for programming
•    RING Enable bit - R/W: RING_EN, Bit 3 of             information
     Soft Power Enable Register 2 (Logical
     Device 8, 0xB1). 1=Enable ring indication            The ring wakeup filter will produce an active low
     on nRING pin as wakeup function to activate          pulse for the period of time that nRING, nRI1
     nPowerOn. 0=Disable.                                 and/or nRI2 is toggling.       See figure below.
2. An enable bit is in the SMI Enable Register
     1 as follows:
                                                       84


                    n R IN G
                    R in g W a k e u p F ilte r O u tp u t
                            FIGURE 3 - RING WAKEUP FILTER OUTPUT
INFRARED INTERFACE
                                                           signaled by sending a 500KHz waveform for the
The infrared interface provides a two-way wireless         duration of the serial bit time. A one is signaled by
communications port using infrared as a                    sending no transmission during the bit time.
transmission medium. Several IR implementations            Please refer to the AC timing for the parameters of
have been provided for the second UART in this             the ASK-IR waveform.
chip (logical device 5), IrDA 1.0 and Amplitude
Shift Keyed IR. The IR transmission can use the            If the Half-Duplex option is chosen, there is a time-
standard UART2 TXD2 and RXD2 pins or optional              out when the direction of the transmission is
IRTX and IRRX pins. These can be selected                  changed. This time-out starts at the last bit
through the configuration registers.                       transferred during a transmission and blocks the
                                                           receiver input until the timeout expires. If the
IrDA 1.0 allows serial communication at baud rates         transmit buffer is loaded with more data before the
up to 115.2 kbps. Each word is sent serially               time-out expires, the timer is restarted after the
beginning with a zero value start bit. A zero is           new byte is transmitted. If data is loaded into the
signaled by sending a single IR pulse at the               transmit buffer while a character is being received,
beginning of the serial bit time. A one is signaled        the transmission will not start until the time-out
by sending no IR pulse during the bit time. Please         expires after the last receive bit has been
refer to the AC timing for the parameters of these         received. If the start bit of another character is
pulses and the IrDA waveform.                              received during this time-out, the timer is restarted
                                                           after the new character is received. The IR half-
The Amplitude Shift Keyed IR allows                        duplex time-out is programmable via CRF2 in
asynchronous serial communication at baud rates            Logical Device 5. This register allows the time-out
up to 19.2K Baud. Each word is sent serially               to be programmed to any value between 0 and
beginning with a zero value start bit. A zero is           10msec in 100usec increments.
                                                        85


                                             PARALLEL PORT
This chip incorporates an IBM XT/AT compatible           The functionality of the Parallel Port is achieved
parallel port. This supports the optional PS/2 type      through the use of eight addressable ports, with
bi-directional parallel port (SPP), the Enhanced         their associated registers and control gating. The
Parallel Port (EPP) and the Extended Capabilities        control and data port are read/write by the CPU,
Port (ECP) parallel port modes. Refer to the             the status port is read/write in the EPP mode. The
Configuration Registers for information on               address map of the Parallel Port is shown below:
disabling, power down, changing the base address
of the parallel port, and selecting the mode of          DATA PORT                   BASE ADDRESS + 00H
operation.                                               STATUS PORT                 BASE ADDRESS + 01H
                                                         CONTROL PORT                BASE ADDRESS + 02H
This chip also provides a mode for support of the        EPP ADDR PORT               BASE ADDRESS + 03H
floppy disk controller on the parallel port. The         EPP DATA PORT 0             BASE ADDRESS + 04H
parallel port also incorporates SMSC's ChiProtect        EPP DATA PORT 1             BASE ADDRESS + 05H
circuitry, which prevents possible damage to the         EPP DATA PORT 2             BASE ADDRESS + 06H
parallel port due to printer power-up.                   EPP DATA PORT 3             BASE ADDRESS + 07H
                                                         The bit map of these registers is:
                      D0          D1       D2         D3        D4        D5         D6         D7    Note
 DATA PORT           PD0         PD1      PD2        PD3       PD4       PD5        PD6        PD7      1
 STATUS PORT       TMOUT           0        0       nERR      SLCT        PE       nACK       nBUSY     1
 CONTROL          STROBE       AUTOFD    nINIT       SLC      IRQE       PCD         0          0       1
 PORT
 EPP ADDR            PD0         PD1      PD2        PD3       PD4       PD5        PD6        AD7     2,3
 PORT
 EPP DATA            PD0         PD1      PD2        PD3       PD4       PD5        PD6        PD7     2,3
 PORT 0
 EPP DATA            PD0         PD1      PD2        PD3       PD4       PD5        PD6        PD7     2,3
 PORT 1
 EPP DATA            PD0         PD1      PD2        PD3       PD4       PD5        PD6        PD7     2,3
 PORT 2
 EPP DATA            PD0         PD1      PD2        PD3       PD4       PD5        PD6        PD7     2,3
 PORT 3
Note 1: These registers are available in all modes.
Note 2: These registers are only available in EPP mode.
Note 3: For EPP mode, IOCHRDY must be connected to the ISA bus.
                                                      86


                                TABLE 38 - PARALLEL PORT CONNECTOR
      HOST
  CONNECTOR             PIN NUMBER          STANDARD                  EPP                  ECP
         1                   111       nStrobe                nWrite              nStrobe
        2-9                96-103      PData<0:7>             PData<0:7>          PData<0:7>
        10                   108       nAck                   Intr                nAck
        11                   107       Busy                   nWait               Busy, PeriphAck(3)
        12                   106       PE                     (NU)                PError,
                                                                                  nAckReverse(3)
        13                   105       Select                 (NU)                Select
        14                   110       nAutofd                nDatastb            nAutoFd,
                                                                                  HostAck(3)
        15                   109       nError                 (NU)                nFault(1)
                                                                                  nPeriphRequest(3)
        16                    94       nInit                  (NU)                nInit(1)
                                                                                  nReverseRqst(3)
        17                    95       nSelectin              nAddrstrb           nSelectIn(1,3)
(1) = Compatible Mode
(3) = High Speed Mode
Note:    For the cable interconnection required for ECP support and the Slave Connector pin numbers,
          refer to the IEEE 1284 Extended Capabilities Port Protocol and ISA Standard, Rev. 1.14, July 14,
          1993. This document is available from Microsoft.
                                                    87


IBM XT/AT COMPATIBLE, BI-                                  The level on the SLCT input is read by the CPU as
DIRECTIONAL AND EPP MODES                                  bit 4 of the Printer Status Register. A logic 1
                                                           means the printer is on line; a logic 0 means it is
DATA PORT                                                  not selected.
ADDRESS OFFSET = 00H
                                                           BIT 5 PE - PAPER END
The Data Port is located at an offset of '00H' from        The level on the PE input is read by the CPU as bit
the base address. The data register is cleared at          5 of the Printer Status Register. A logic 1
initialization by RESET.            During a WRITE         indicates a paper end; a logic 0 indicates the
operation, the Data Register latches the contents          presence of paper.
of the data bus with the rising edge of the nIOW
input. The contents of this register are buffered          BIT 6 nACK - nACKNOWLEDGE
(non inverting) and output onto the PD0 - PD7              The level on the nACK input is read by the CPU as
ports. During a READ operation in SPP mode,                bit 6 of the Printer Status Register. A logic 0
PD0 - PD7 ports are buffered (not latched) and             means that the printer has received a character
output to the host CPU.                                    and can now accept another. A logic 1 means that
                                                           it is still processing the last character or has not
STATUS PORT                                                received the data.
ADDRESS OFFSET = 01H
                                                           BIT 7 nBUSY - nBUSY
The Status Port is located at an offset of '01H'           The complement of the level on the BUSY input is
from the base address. The contents of this                read by the CPU as bit 7 of the Printer Status
register are latched for the duration of an nIOR           Register. A logic 0 in this bit means that the
read cycle. The bits of the Status Port are defined        printer is busy and cannot accept a new character.
as follows:                                                A logic 1 means that it is ready to accept the next
                                                           character.
BIT 0 TMOUT - TIME OUT
This bit is valid in EPP mode only and indicates           CONTROL PORT
that a 10 usec time out has occurred on the EPP            ADDRESS OFFSET = 02H
bus. A logic O means that no time out error has
occurred; a logic 1 means that a time out error has        The Control Port is located at an offset of '02H'
been detected. This bit is cleared by a RESET.             from the base address. The Control Register is
Writing a one to this bit clears the time out status       initialized by the RESET input, bits 0 to 5 only
bit. On a write, this bit is self clearing and does not    being affected; bits 6 and 7 are hard wired low.
require a write of a zero. Writing a zero to this bit
has no effect.                                             BIT 0 STROBE - STROBE
                                                           This bit is inverted and output onto the nSTROBE
BITS 1, 2 - are not implemented as register bits,          output.
during a read of the Printer Status Register these
bits are a low level.                                      BIT 1 AUTOFD - AUTOFEED
                                                           This bit is inverted and output onto the nAUTOFD
BIT 3 nERR - nERROR                                        output. A logic 1 causes the printer to generate a
The level on the nERROR input is read by the               line feed after each line is printed. A logic 0 means
CPU as bit 3 of the Printer Status Register. A             no autofeed.
logic 0 means an error has been detected; a logic
1 means no error has been detected.
BIT 4 SLCT - PRINTER SELECTED STATUS
                                                        88


BIT 2 nINIT - nINITIATE OUTPUT                             ADDRESS OFFSET = 04H
This bit is output onto the nINIT output without
inversion.                                                 The EPP Data Port 0 is located at an offset of
                                                           '04H' from the base address. The data register is
BIT 3 SLCTIN - PRINTER SELECT INPUT                        cleared at initialization by RESET. During a
This bit is inverted and output onto the nSLCTIN           WRITE operation, the contents of DB0-DB7 are
output. A logic 1 on this bit selects the printer; a       buffered (non inverting) and output onto the PD0 -
logic 0 means the printer is not selected.                 PD7 ports, the leading edge of nIOW causes an
                                                           EPP DATA WRITE cycle to be performed, the
BIT 4 IRQE - INTERRUPT REQUEST ENABLE                      trailing edge of IOW latches the data for the
The interrupt request enable bit when set to a high        duration of the EPP write cycle. During a READ
level may be used to enable interrupt requests             operation, PD0 - PD7 ports are read, the leading
from the Parallel Port to the CPU. An interrupt            edge of IOR causes an EPP READ cycle to be
request is generated on the IRQ port by a positive         performed and the data output to the host CPU,
going nACK input.        When the IRQE bit is              the deassertion of DATASTB latches the PData
programmed low the IRQ is disabled.                        for the duration of the IOR cycle. This register is
                                                           only available in EPP mode.
BIT 5 PCD - PARALLEL CONTROL DIRECTION
Parallel Control Direction is not valid in printer         EPP DATA PORT 1
mode. In printer mode, the direction is always out         ADDRESS OFFSET = 05H
regardless of the state of this bit. In bi-directional,
EPP or ECP mode, a logic 0 means that the                  The EPP Data Port 1 is located at an offset of
printer port is in output mode (write); a logic 1          '05H' from the base address. Refer to EPP DATA
means that the printer port is in input mode (read).       PORT 0 for a description of operation. This
                                                           register is only available in EPP mode.
Bits 6 and 7 during a read are a low level, and
cannot be written.                                         EPP DATA PORT 2
                                                           ADDRESS OFFSET = 06H
EPP ADDRESS PORT
ADDRESS OFFSET = 03H                                       The EPP Data Port 2 is located at an offset of
                                                           '06H' from the base address. Refer to EPP DATA
The EPP Address Port is located at an offset of            PORT 0 for a description of operation. This
'03H' from the base address. The address                   register is only available in EPP mode.
register is cleared at initialization by RESET.
During a WRITE operation, the contents of DB0-             EPP DATA PORT 3
DB7 are buffered (non inverting) and output onto           ADDRESS OFFSET = 07H
the PD0 - PD7 ports, the leading edge of nIOW
causes an EPP ADDRESS WRITE cycle to be                    The EPP Data Port 3 is located at an offset of
performed, the trailing edge of IOW latches the            '07H' from the base address. Refer to EPP DATA
data for the duration of the EPP write cycle.              PORT 0 for a description of operation. This
During a READ operation, PD0 - PD7 ports are               register is only available in EPP mode.
read, the leading edge of IOR causes an EPP
ADDRESS READ cycle to be performed and the                 EPP 1.9 OPERATION
data output to the host CPU, the deassertion of
ADDRSTB latches the PData for the duration of              When the EPP mode is selected in the
the IOR cycle. This register is only available in          configuration register, the standard and bi-
EPP mode.                                                  directional modes are also available. If no EPP
                                                           Read, Write or Address cycle is currently
EPP DATA PORT 0                                            executing, then the PDx bus is in the standard or
                                                        89


bi-directional mode, and all output signals             write cycle can complete. The write cycle can
(STROBE, AUTOFD, INIT) are as set by the SPP            complete under the following circumstances:
Control Port and direction is controlled by PCD of      1. If the EPP bus is not ready (nWAIT is active
the Control port.                                            low) when nDATASTB or nADDRSTB goes
                                                             active then the write can complete when
In EPP mode, the system timing is closely coupled            nWAIT goes inactive high.
to the EPP timing. For this reason, a watchdog          2. If the EPP bus is ready (nWAIT is inactive
timer is required to prevent system lockup. The              high) then the chip must wait for it to go active
timer indicates if more than 10usec have elapsed             low before changing the state of nDATASTB,
from the start of the EPP cycle (nIOR or nIOW                nWRITE or nADDRSTB. The write can
asserted) to nWAIT being deasserted (after                   complete once nWAIT is determined inactive.
command). If a time-out occurs, the current EPP
cycle is aborted and the time-out condition is          Write Sequence of operation
indicated in Status bit 0.
                                                        1.   The host selects an EPP register, places data
During an EPP cycle, if STROBE is active, it                 on the SData bus and drives nIOW active.
overrides the EPP write signal forcing the PDx bus      2.   The chip drives IOCHRDY inactive (low).
to always be in a write mode and the nWRITE             3.   If WAIT is not asserted, the chip must wait
signal to always be asserted.                                until WAIT is asserted.
                                                        4.   The chip places address or data on PData
Software Constraints                                         bus, clears PDIR, and asserts nWRITE.
                                                        5.   Chip asserts nDATASTB or nADDRSTRB
Before an EPP cycle is executed, the software                indicating that PData bus contains valid
must ensure that the control register bit PCD is a           information, and the WRITE signal is valid.
logic "0" (ie a 04H or 05H should be written to the     6.   Peripheral deasserts nWAIT, indicating that
Control port). If the user leaves PCD as a logic             any setup requirements have been satisfied
"1", and attempts to perform an EPP write, the               and the chip may begin the termination phase
chip is unable to perform the write (because PCD             of the cycle.
is a logic "1") and will appear to perform an EPP       7.   a) The chip deasserts nDATASTB or
read on the parallel bus, no error is indicated.                   nADDRSTRB, this marks the beginning
                                                                   of the termination phase. If it has not
EPP 1.9 Write                                                      already done so, the peripheral should
                                                                   latch the information byte now.
The timing for a write operation (address or data)           b) The chip latches the data from the SData
is shown in timing diagram EPP Write Data or                       bus for the PData bus and asserts
Address cycle. IOCHRDY is driven active low at                     (releases) IOCHRDY allowing the host to
the start of each EPP write and is released when                   complete the write cycle.
it     has     been      determined       that   the    8.   Peripheral asserts nWAIT, indicating to the
                                                             host that any hold time requirements have
                                                             been satisfied and acknowledging the
                                                             termination of the cycle.
                                                        9.   Chip may modify nWRITE and nPDATA in
                                                             preparation for the next cycle.
                                                     90


EPP 1.9 Read                                              EPP 1.7 OPERATION
The timing for a read operation (data) is shown in        When the EPP 1.7 mode is selected in the
timing diagram EPP Read Data cycle. IOCHRDY               configuration register, the standard and bi-
is driven active low at the start of each EPP read        directional modes are also available. If no EPP
and is released when it has been determined that          Read, Write or Address cycle is currently
the read cycle can complete. The read cycle can           executing, then the PDx bus is in the standard or
complete under the following circumstances:               bi-directional mode, and all output signals
                                                          (STROBE, AUTOFD, INIT) are as set by the SPP
1    If the EPP bus is not ready (nWAIT is active         Control Port and direction is controlled by PCD of
     low) when nDATASTB goes active then the              the Control port.
     read can complete when nWAIT goes inactive
     high.
2.   If the EPP bus is ready (nWAIT is inactive           In EPP mode, the system timing is closely coupled
     high) then the chip must wait for it to go active    to the EPP timing. For this reason, a watchdog
     low before changing the state of WRITE or            timer is required to prevent system lockup. The
     before nDATASTB goes active. The read can            timer indicates if more than 10usec have elapsed
     complete once nWAIT is determined inactive.          from the start of the EPP cycle (nIOR or nIOW
                                                          asserted) to the end of the cycle nIOR or nIOW
Read Sequence of Operation                                deasserted). If a time-out occurs, the current EPP
                                                          cycle is aborted and the time-out condition is
1.   The host selects an EPP register and drives          indicated in Status bit 0.
     nIOR active.
2. The chip drives IOCHRDY inactive (low).                Software Constraints
3. If WAIT is not asserted, the chip must wait
     until WAIT is asserted.                              Before an EPP cycle is executed, the software
4. The chip tri-states the PData bus and                  must ensure that the control register bits D0, D1
     deasserts nWRITE.                                    and D3 are set to zero. Also, bit D5 (PCD) is a
5. Chip asserts nDATASTB or nADDRSTRB                     logic "0" for an EPP write or a logic "1" for and
     indicating that PData bus is tri-stated, PDIR is     EPP read.
     set and the nWRITE signal is valid.
6. Peripheral drives PData bus valid.                     EPP 1.7 Write
7. Peripheral deasserts nWAIT, indicating that
     PData is valid and the chip may begin the            The timing for a write operation (address or data)
     termination phase of the cycle.                      is shown in timing diagram EPP 1.7 Write Data or
8. a) The chip latches the data from the PData            Address cycle. IOCHRDY is driven active low
           bus for the SData bus and deasserts            when nWAIT is active low during the EPP cycle.
           nDATASTB or nADDRSTRB. This marks              This can be used to extend the cycle time. The
           the beginning of the termination phase.        write cycle can complete when nWAIT is inactive
     b) The chip drives the valid data onto the           high.
           SData bus and asserts (releases)
           IOCHRDY allowing the host to complete
           the read cycle.
9. Peripheral tri-states the PData bus and
     asserts nWAIT, indicating to the host that the
     PData bus is tri-stated.
10. Chip may modify nWRITE, PDIR and
     nPDATA in preparation for the next cycle.
                                                       91


Write Sequence of Operation                            IOCHRDY is driven active low when nWAIT is
                                                       active low during the EPP cycle. This can be used
1.   The host sets PDIR bit in the control register    to extend the cycle time. The read cycle can
     to a logic "0". This asserts nWRITE.              complete when nWAIT is inactive high.
2.   The host selects an EPP register, places data
     on the SData bus and drives nIOW active.          Read Sequence of Operation
3.   The chip places address or data on PData
     bus.                                              1.   The host sets PDIR bit in the control register
4.   Chip asserts nDATASTB or nADDRSTRB                     to a logic "1". This deasserts nWRITE and tri-
     indicating that PData bus contains valid               states the PData bus.
     information, and the WRITE signal is valid.       2.   The host selects an EPP register and drives
5.   If nWAIT is asserted, IOCHRDY is                       nIOR active.
     deasserted until the peripheral deasserts         3.   Chip asserts nDATASTB or nADDRSTRB
     nWAIT or a time-out occurs.                            indicating that PData bus is tri-stated, PDIR is
6.   When the host deasserts nIOW the chip                  set and the nWRITE signal is valid.
     deasserts nDATASTB or nADDRSTRB and               4.   If nWAIT is asserted, IOCHRDY is
     latches the data from the SData bus for the            deasserted until the peripheral deasserts
     PData bus.                                             nWAIT or a time-out occurs.
7.   Chip may modify nWRITE, PDIR and                  5.   The Peripheral drives PData bus valid.
     nPDATA in preparation of the next cycle.          6.   The Peripheral deasserts nWAIT, indicating
                                                            that PData is valid and the chip may begin the
EPP 1.7 Read                                                termination phase of the cycle.
                                                       7.   When the host deasserts nIOR the chip
The timing for a read operation (data) is shown in          deasserts nDATASTB or nADDRSTRB.
timing diagram EPP 1.7 Read Data cycle.                8.   Peripheral tri-states the PData bus.
                                                       9.   Chip may modify nWRITE, PDIR and
                                                            nPDATA in preparation of the next cycle.
                                                    92


                                TABLE 39 - EPP PIN DESCRIPTIONS
     EPP
   SIGNAL        EPP NAME       TYPE                              EPP DESCRIPTION
 nWRITE       nWrite               O    This signal is active low. It denotes a write operation.
 PD<0:7>      Address/Data        I/O   Bi-directional EPP byte wide address and data bus.
 INTR         Interrupt             I   This signal is active high and positive edge triggered. (Pass
                                        through with no inversion, Same as SPP).
 WAIT         nWait                 I   This signal is active low. It is driven inactive as a positive
                                        acknowledgement from the device that the transfer of data is
                                        completed. It is driven active as an indication that the device is
                                        ready for the next transfer.
 DATASTB      nData Strobe         O    This signal is active low. It is used to denote data read or write
                                        operation.
 RESET        nReset               O    This signal is active low. When driven active, the EPP device
                                        is reset to its initial operational mode.
 ADDRSTB      nAddress             O    This signal is active low.      It is used to denote address read or
              Strobe                    write operation.
 PE           Paper End             I   Same as SPP mode.
 SLCT         Printer Selected      I   Same as SPP mode.
              Status
 nERR         Error                 I   Same as SPP mode.
 PDIR         Parallel Port        O    This output shows the direction of the data transfer on the
              Direction                 parallel port bus. A low means an output/write condition and a
                                        high means an input/read condition. This signal is normally a
                                        low (output/write) unless PCD of the control register is set or if
                                        an EPP read cycle is in progress.
Note 1: SPP and EPP can use 1 common register.
Note 2: nWrite is the only EPP output that can be over-ridden by SPP control port during an EPP cycle.
         For correct EPP read cycles, PCD is required to be a low.
                                                   93


                               EXTENDED CAPABILITIES PARALLEL PORT
ECP provides a number of advantages, some of                         Pword: A port word; equal in size to the width of
which are listed below. The individual features are                               the     ISA        interface.         For    this
explained in greater detail in the remainder of this                              implementation, PWord is always 8 bits.
section.                                                             1            A high level.
                                                                     0            A low level.
•      High performance half-duplex forward and
       reverse channel                                               These terms may be considered synonymous:
•      Interlocked handshake, for fast reliable
                                                                     •     PeriphClk, nAck
       transfer
                                                                     •     HostAck, nAutoFd
•      Optional single byte RLE compression for
       improved throughput (64:1)                                    •     PeriphAck, Busy
•      Channel addressing for low-cost peripherals                   •     nPeriphRequest, nFault
•      Maintains link and data layer separation                      •     nReverseRequest, nInit
•      Permits the use of active output drivers                      •     nAckReverse, PError
•      Permits the use of adaptive signal timing                     •     Xflag, Select
•      Peer-to-peer capability                                       •     ECPMode, nSelectln
                                                                     •     HostClk, nStrobe
Vocabulary
The following terms are used in this document:                       Reference Document:                  IEEE 1284 Extended
                                                                     Capabilities Port Protocol and ISA Interface
assert:     When a signal asserts it transitions to a                Standard, Rev 1.14, July 14, 1993.                       This
            "true" state, when a signal deasserts it                 document is available from Microsoft.
            transitions to a "false" state.
forward: Host to Peripheral communication.                           The bit map of the Extended Parallel Port
reverse: Peripheral to Host communication                            registers is:
                     D7           D6          D5              D4            D3            D2             D1        D0       Note
 data               PD7          PD6         PD5             PD4           PD3           PD2             PD1      PD0
 ecpAFifo        Addr/RLE                                        Address or RLE field                                        2
 dsr               nBusy        nAck        PError          Select        nFault           0               0        0        1
 dcr                 0            0        Direction      ackIntEn       SelectIn        nInit          autofd   strobe      1
 cFifo                                                Parallel Port Data FIFO                                                2
 ecpDFifo                                                 ECP Data FIFO                                                      2
 tFifo                                                        Test FIFO                                                      2
 cnfgA               0            0            0               1            0              0               0        0
 cnfgB           compress     intrValue              Parallel Port IRQ                         Parallel Port DMA
 ecr                           MODE                      nErrIntrEn      dmaEn        serviceIntr         full   empty
Note 1: These registers are available in all modes.
Note 2: All FIFOs use one common 16 byte FIFO.
Note 3: The ECP Parallel Port Config Reg B reflects the IRQ and DRQ selected by the Configuration
            Registers.
ISA IMPLEMENTATION STANDARD                                          This specification describes the standard ISA
                                                                     interface to the Extended Capabilities Port (ECP).
                                                                94


All ISA devices supporting ECP must meet the
requirements contained in this section or the port      Small FIFOs are employed in both forward and
will not be supported by Microsoft. For a               reverse directions to smooth data flow and
description of the ECP Protocol, please refer to the    improve the maximum bandwidth requirement.
IEEE 1284 Extended Capabilities Port Protocol           The size of the FIFO is 16 bytes deep. The port
and ISA Interface Standard, Rev. 1.14, July 14,         supports an automatic handshake for the standard
1993. This document is available from Microsoft.        parallel port to improve compatibility mode transfer
                                                        speed.
Description
                                                        The port also supports run length encoded (RLE)
The port is software and hardware compatible with       decompression        (required)     in    hardware.
existing parallel ports so that it may be used as a     Compression is accomplished by counting
standard LPT port if ECP is not required. The port      identical bytes and transmitting an RLE byte that
is designed to be simple and requires a small           indicates how many times the next byte is to be
number of gates to implement. It does not do any        repeated. Decompression simply intercepts the
"protocol" negotiation, rather it provides an           RLE byte and repeats the following byte the
automatic high burst-bandwidth channel that             specified number of times. Hardware support for
supports DMA for ECP in both the forward and            compression                 is             optional.
reverse directions.
                                                     96


                         TABLE 40 - ECP PIN DESCRIPTIONS
      NAME       TYPE                                  DESCRIPTION
nStrobe            O  During write operations nStrobe registers data or address into the slave on
                      the asserting edge (handshakes with Busy).
PData 7:0         I/O Contains address or data or RLE data.
nAck                I Indicates valid data driven by the peripheral when asserted. This signal
                      handshakes with nAutoFd in reverse.
PeriphAck (Busy)    I This signal deasserts to indicate that the peripheral can accept data. This
                      signal handshakes with nStrobe in the forward direction. In the reverse
                      direction this signal indicates whether the data lines contain ECP command
                      information or data. The peripheral uses this signal to flow control in the
                      forward direction. It is an "interlocked" handshake with nStrobe. PeriphAck
                      also provides command information in the reverse direction.
PError              I Used to acknowledge a change in the direction the transfer (asserted =
(nAckReverse)         forward).       The peripheral drives this signal low to acknowledge
                      nReverseRequest. It is an "interlocked" handshake with nReverseRequest.
                      The host relies upon nAckReverse to determine when it is permitted to
                      drive the data bus.
Select              I Indicates printer on line.
nAutoFd            O  Requests a byte of data from the peripheral when asserted, handshaking
(HostAck)             with nAck in the reverse direction. In the forward direction this signal
                      indicates whether the data lines contain ECP address or data. The host
                      drives this signal to flow control in the reverse direction. It is an "interlocked"
                      handshake with nAck. HostAck also provides command information in the
                      forward phase.
nFault              I Generates an error interrupt when asserted. This signal provides a
(nPeriphRequest)      mechanism for peer-to-peer communication. This signal is valid only in the
                      forward direction. During ECP Mode the peripheral is permitted (but not
                      required) to drive this pin low to request a reverse transfer. The request is
                      merely a "hint" to the host; the host has ultimate control over the transfer
                      direction. This signal would be typically used to generate an interrupt to the
                      host CPU.
nInit              O  Sets the transfer direction (asserted = reverse, deasserted = forward). This
                      pin is driven low to place the channel in the reverse direction. The
                      peripheral is only allowed to drive the bi-directional data bus while in ECP
                      Mode and HostAck is low and nSelectIn is high.
nSelectIn          O  Always deasserted in ECP mode.
                                               96


Register Definitions                                      devices. The port is equivalent to a generic parallel
                                                          port interface and may be operated in that mode.
The register definitions are based on the standard        The port registers vary depending on the mode
IBM addresses for LPT. All of the standard printer        field in the ecr. The table below lists these
ports are supported. The additional registers             dependencies. Operation of the devices in modes
attach to an upper bit decode of the standard LPT         other that those specified is undefined.
port definition to avoid conflict with standard ISA
                                 TABLE 41 - ECP REGISTER DEFINITIONS
       NAME             ADDRESS (Note 1)                 ECP MODES                       FUNCTION
 data                       +000h R/W                        000-001            Data Register
 ecpAFifo                   +000h R/W                          011              ECP FIFO (Address)
 dsr                        +001h R/W                           All             Status Register
 dcr                        +002h R/W                           All             Control Register
 cFifo                      +400h R/W                          010              Parallel Port Data FIFO
 ecpDFifo                   +400h R/W                          011              ECP FIFO (DATA)
 tFifo                      +400h R/W                          110              Test FIFO
 cnfgA                        +400h R                          111              Configuration Register A
 cnfgB                      +401h R/W                          111              Configuration Register B
 ecr                        +402h R/W                           All             Extended Control Register
Note 1: These addresses are added to the parallel port base address as selected by configuration register
          or jumpers.
Note 2: All addresses are qualified with AEN. Refer to the AEN pin definition.
                                     TABLE 42 - MODE DESCRIPTIONS
              MODE                                   DESCRIPTION*
               000      SPP mode
               001      PS/2 Parallel Port mode
               010      Parallel Port Data FIFO mode
               011      ECP Parallel Port mode
               100      EPP mode (If this option is enabled in the configuration registers)
               101      Reserved
               110      Test mode
               111      Configuration mode
                                           *Refer to ECR Register Description
                                                      97


DATA and ecpAFifo PORT                                  The complement of the level on the BUSY input is
ADDRESS OFFSET = 00H                                    read by the CPU as bit 7 of the Device Status
                                                        Register.
Modes 000 and 001 (Data Port)
                                                        DEVICE CONTROL REGISTER (dcr)
The Data Port is located at an offset of '00H' from     ADDRESS OFFSET = 02H
the base address. The data register is cleared at
initialization by RESET.        During a WRITE          The Control Register is located at an offset of
operation, the Data Register latches the contents       '02H' from the base address.            The Control
of the data bus on the rising edge of the nIOW          Register is initialized to zero by the RESET input,
input. The contents of this register are buffered       bits 0 to 5 only being affected; bits 6 and 7 are
(non inverting) and output onto the PD0 - PD7           hard wired low.
ports. During a READ operation, PD0 - PD7 ports         BIT 0 STROBE - STROBE
are read and output to the host CPU.                    This bit is inverted and output onto the nSTROBE
                                                        output.
Mode 011 (ECP FIFO - Address/RLE)                       BIT 1 AUTOFD - AUTOFEED
                                                        This bit is inverted and output onto the nAUTOFD
A data byte written to this address is placed in the    output. A logic 1 causes the printer to generate a
FIFO and tagged as an ECP Address/RLE. The              line feed after each line is printed. A logic 0
hardware at the ECP port transmits this byte to the     means no autofeed.
peripheral automatically. The operation of this         BIT 2 nINIT - nINITIATE OUTPUT
register is ony defined for the forward direction       This bit is output onto the nINIT output without
(direction is 0). Refer to the ECP Parallel Port        inversion.
Forward Timing Diagram, located in the Timing           BIT 3 SELECTIN
Diagrams section of this data sheet .                   This bit is inverted and output onto the nSLCTIN
                                                        output. A logic 1 on this bit selects the printer; a
DEVICE STATUS REGISTER (dsr)                            logic 0 means the printer is not selected.
ADDRESS OFFSET = 01H                                    BIT 4 ackIntEn - INTERRUPT REQUEST
                                                        ENABLE
The Status Port is located at an offset of '01H'        The interrupt request enable bit when set to a high
from the base address. Bits 0 - 2 are not               level may be used to enable interrupt requests
implemented as register bits, during a read of the      from the Parallel Port to the CPU due to a low to
Printer Status Register these bits are a low level.     high transition on the nACK input. Refer to the
The bits of the Status Port are defined as follows:     description of the interrupt under Operation,
BIT 3 nFault                                            Interrupts.
The level on the nFault input is read by the CPU        BIT 5 DIRECTION
as bit 3 of the Device Status Register.                 If mode=000 or mode=010, this bit has no effect
BIT 4 Select                                            and the direction is always out regardless of the
The level on the Select input is read by the CPU        state of this bit. In all other modes, Direction is
as bit 4 of the Device Status Register.                 valid and a logic 0 means that the printer port is in
BIT 5 PError                                            output mode (write); a logic 1 means that the
The level on the PError input is read by the CPU        printer port is in input mode (read).
as bit 5 of the Device Status Register. Printer         BITS 6 and 7 during a read are a low level, and
Status Register.                                        cannot be written.
BIT 6 nAck
The level on the nAck input is read by the CPU as       cFifo (Parallel Port Data FIFO)
bit 6 of the Device Status Register.                    ADDRESS OFFSET = 400h
BIT 7 nBusy                                             Mode = 010
                                                     98


Bytes written or DMAed from the system to this              0 and emptying it a byte at a time until serviceIntr
FIFO are transmitted by a hardware handshake to             is set. This may generate a spurious interrupt, but
the peripheral using the standard parallel port             will indicate that the threshold has been reached.
protocol. Transfers to the FIFO are byte aligned.
This mode is only defined for the forward direction.        The readIntrThreshold can be determined by
                                                            setting the direction bit to 1 and filling the empty
ecpDFifo (ECP Data FIFO)                                    tFIFO a byte at a time until serviceIntr is set. This
ADDRESS OFFSET = 400H                                       may generate a spurious interrupt, but will indicate
Mode = 011                                                  that the threshold has been reached.
Bytes written or DMAed from the system to this              Data bytes are always read from the head of tFIFO
FIFO, when the direction bit is 0, are transmitted          regardless of the value of the direction bit. For
by a hardware handshake to the peripheral using             example if 44h, 33h, 22h is written to the FIFO,
the ECP parallel port protocol. Transfers to the            then reading the tFIFO will return 44h, 33h, 22h in
FIFO are byte aligned.                                      the same order as was written.
Data bytes from the peripheral are read under               cnfgA (Configuration Register A)
automatic hardware handshake from ECP into this             ADDRESS OFFSET = 400H
FIFO when the direction bit is 1. Reads or DMAs             Mode = 111
from the FIFO will return bytes of ECP data to the
system.                                                     This register is a read only register. When read,
                                                            10H is returned. This indicates to the system that
tFifo (Test FIFO Mode)                                      this is an 8-bit implementation. (PWord = 1 byte)
ADDRESS OFFSET = 400H
Mode = 110                                                  cnfgB (Configuration Register B)
                                                            ADDRESS OFFSET = 401H
Data bytes may be read, written or DMAed to or              Mode = 111
from the system to this FIFO in any direction.
Data in the tFIFO will not be transmitted to the to         BIT 7 compress
the parallel port lines using a hardware protocol           This bit is read only. During a read it is a low level.
handshake. However, data in the tFIFO may be                This means that this chip does not support
displayed on the parallel port data lines.                  hardware RLE compression. It does support
                                                            hardware de-compression!
The tFIFO will not stall when overwritten or                BIT 6 intrValue
underrun. If an attempt is made to write data to a          Returns the value on the ISA IRq line to determine
full tFIFO, the new data is not accepted into the           possible conflicts.
tFIFO. If an attempt is made to read data from an           BITS [5:3] Parallel Port IRQ (read-only)
empty tFIFO, the last data byte is re-read again.           Refer to Table 39B.
The full and empty bits must always keep track of           BITS [2:0] Parallel Port DMA (read-only)
the correct FIFO state. The tFIFO will transfer data        Refer to Table 39C.
at the maximum ISA rate so that software may
generate performance metrics.                               ecr (Extended Control Register)
                                                            ADDRESS OFFSET = 402H
The FIFO size and interrupt threshold can be                Mode = all
determined by writing bytes to the FIFO and                 This register controls the extended ECP parallel
checking the full and serviceIntr bits.                     port functions.
                                                            BITS 7,6,5
The writeIntrThreshold can be determined by                 These bits are Read/Write and select the Mode.
starting with a full tFIFO, setting the direction bit to    BIT 4 nErrIntrEn
                                                         99


Read/Write (Valid only in ECP Mode)                          re-enable the interrupts. Writing this bit to a 1
1: Disables the interrupt generated on the                   will not cause an interrupt.
    asserting edge of nFault.                            case dmaEn=1:
0: Enables an interrupt pulse on the high to low             During DMA (this bit is set to a 1 when
    edge of nFault. Note that an interrupt will be           terminal count is reached).
    generated if nFault is asserted (interrupting)       case dmaEn=0 direction=0:
    and this bit is written from a 1 to a 0. This            This bit shall be set to 1 whenever there are
    prevents interrupts from being lost in the time          writeIntrThreshold or more bytes free in the
    between the read of the ecr and the write of             FIFO.
    the ecr.                                             case dmaEn=0 direction=1:
BIT 3 dmaEn                                                  This bit shall be set to 1 whenever there are
Read/Write                                                   readIntrThreshold or more valid bytes to be
1: Enables DMA (DMA starts when serviceIntr is               read from the FIFO.
    0).                                                  BIT 1 full
0: Disables DMA unconditionally.                         Read only
BIT 2 serviceIntr                                        1: The FIFO cannot accept another byte or the
Read/Write                                                   FIFO is completely full.
1: Disables DMA and all of the service                   0: The FIFO has at least 1 free byte.
    interrupts.                                          BIT 0 empty
0: Enables one of the following 3 cases of               Read only
    interrupts. Once one of the 3 service                1: The FIFO is completely empty.
    interrupts has occurred serviceIntr bit shall be     0: The FIFO contains at least 1 byte of data.
    set to a 1 by hardware. It must be reset to 0 to
                                                     100


                           TABLE 43 - EXTENDED CONTROL REGISTER
R/W                                                   MODE
000:  Standard Parallel Port Mode . In this mode the FIFO is reset and common collector drivers are
      used on the control lines (nStrobe, nAutoFd, nInit and nSelectIn). Setting the direction bit will
      not tri-state the output drivers in this mode.
001:  PS/2 Parallel Port Mode. Same as above except that direction may be used to tri-state the
      data lines and reading the data register returns the value on the data lines and not the value in
      the data register. All drivers have active pull-ups (push-pull).
010:  Parallel Port FIFO Mode. This is the same as 000 except that bytes are written or DMAed to the
      FIFO. FIFO data is automatically transmitted using the standard parallel port protocol. Note that
      this mode is only useful when direction is 0. All drivers have active pull-ups (push-pull).
011:  ECP Parallel Port Mode. In the forward direction (direction is 0) bytes placed into the ecpDFifo
      and bytes written to the ecpAFifo are placed in a single FIFO and transmitted automatically to
      the peripheral using ECP Protocol. In the reverse direction (direction is 1) bytes are moved from
      the ECP parallel port and packed into bytes in the ecpDFifo. All drivers have active pull-ups
      (push-pull).
100:  Selects EPP Mode: In this mode, EPP is selected if the EPP supported option is selected in
      configuration register L3-CRF0. All drivers have active pull-ups (push-pull).
101:  Reserved
110:  Test Mode. In this mode the FIFO may be written and read, but the data will not be transmitted
      on the parallel port. All drivers have active pull-ups (push-pull).
111:  Configuration Mode. In this mode the confgA, confgB registers are accessible at 0x400 and
      0x401. All drivers have active pull-ups (push-pull).
               Table 43B                                        Table 43C
                           CONFIG REG B                                             CONFIG REG B
  IRQ SELECTED                 BITS 5:3                    DMA SELECTED                 BITS 2:0
         15                       110                               3                     011
         14                       101                               2                     010
         11                       100                               1                     001
         10                       011                          All Others                 000
          9                       010
          7                       001
          5                       111
     All Others                   000
                                                  101


OPERATION                                                 •    Set strobe = 0, causing the nStrobe signal to
                                                               default to the deasserted state.
Mode Switching/Software Control                           •    Set autoFd = 0, causing the nAutoFd signal
                                                               to default to the deasserted state.
Software will execute P1284 negotiation and all           •    Set mode = 011 (ECP Mode)
operation prior to a data transfer phase under
programmed I/O control (mode 000 or 001).                 ECP address/RLE bytes or data bytes may be
Hardware provides an automatic control line               sent automatically by writing the ecpAFifo or
handshake, moving data between the FIFO and               ecpDFifo respectively.
the ECP port only in the data transfer phase
(modes 011 or 010).                                       Note that all FIFO data transfers are byte wide and
                                                          byte aligned.         Address/RLE transfers are
Setting the mode to 011 or 010 will cause the             byte-wide and only allowed in the forward
hardware to initiate data transfer.                       direction.
If the port is in mode 000 or 001 it may switch to        The host may switch directions by first switching to
any other mode. If the port is not in mode 000 or         mode = 001, negotiating for the forward or reverse
001 it can only be switched into mode 000 or 001.         channel, setting direction to 1 or 0, then setting
The direction can only be changed in mode 001.            mode = 011. When direction is 1 the hardware
                                                          shall handshake for each ECP read data byte and
Once in an extended forward mode the software             attempt to fill the FIFO. Bytes may then be read
should wait for the FIFO to be empty before               from the ecpDFifo as long as it is not empty.
switching back to mode 000 or 001. In this case
all control signals will be deasserted before the         ECP transfers may also be accomplished (albeit
mode switch. In an ecp reverse mode the software          slowly) by handshaking individual bytes under
waits for all the data to be read from the FIFO           program control in mode = 001, or 000.
before changing back to mode 000 or 001. Since
the automatic hardware ecp reverse handshake              Termination from ECP Mode
only cares about the state of the FIFO it may have
acquired extra data which will be discarded. It may       Termination from ECP Mode is similar to the
in fact be in the middle of a transfer when the           termination from Nibble/Byte Modes. The host is
mode is changed back to 000 or 001. In this case          permitted to terminate from ECP Mode only in
the port will deassert nAutoFd independent of the         specific well-defined states. The termination can
state of the transfer. The design shall not cause         only be executed while the bus is in the forward
glitches on the handshake signals if the software         direction. To terminate while the channel is in the
meets the constraints above.                              reverse direction, it must first be transitioned into
                                                          the forward direction.
ECP Operation
Prior to ECP operation the Host must negotiate on
the parallel port to determine if the peripheral
supports the ECP protocol. This is a somewhat
complex negotiation carried out under program
control in mode 000.
After negotiation, it is necessary to initialize some
of the port bits. The following are required:
•     Set Direction = 0, enabling the drivers.
                                                      102


Command/Data                                            subsequent data byte is replicated the specified
                                                        number of times. A run-length count of zero
ECP Mode supports two advanced features to              specifies that only one byte of data is represented
improve the effectiveness of the protocol for some      by the next data byte, whereas a run-length count
applications. The features are implemented by           of 127 indicates that the next byte should be
allowing the transfer of normal 8 bit data or 8 bit     expanded to 128 bytes. To prevent data
commands.                                               expansion, however, run-length counts of zero
                                                        should be avoided.
When in the forward direction, normal data is
transferred when HostAck is high and an 8 bit           Pin Definition
command is transferred when HostAck is low.
                                                        The drivers for nStrobe, nAutoFd, nInit and
The most significant bit of the command indicates       nSelectIn are open-collector in mode 000 and are
whether it is a run-length count (for compression)      push-pull in all other modes.
or a channel address.
                                                        ISA Connections
When in the reverse direction, normal data is
transferred when PeriphAck is high and an 8 bit         The interface can never stall causing the host to
command is transferred when PeriphAck is low.           hang. The width of data transfers is strictly
The most significant bit of the command is always       controlled on an I/O address basis per this
zero. Reverse channel addresses are seldom              specification. All FIFO-DMA transfers are byte
used and may not be supported in hardware.              wide, byte aligned and end on a byte boundary.
                    TABLE 44 -                          (The PWord value can be obtained by reading
  Forward Channel Commands (HostAck Low)                Configuration Register A, cnfgA, described in the
  Reverse Channel Commands (PeripAck Low)               next section).      Single byte wide transfers are
      D7                    D[6:0]                      always possible with standard or PS/2 mode using
                                                        program control of the control signals.
       0     Run-Length Count (0-127)    (mode
             0011 0X00 only)                            Interrupts
       1     Channel Address (0-127)
                                                        The interrupts are enabled by serviceIntr in the ecr
Data Compression                                        register.
The ECP port supports run length encoded (RLE)          serviceIntr = 1 Disables the DMA and all of the
decompression in hardware and can transfer                                  service interrupts.
compressed data to a peripheral. Run length
encoded (RLE) compression in hardware is not            serviceIntr = 0      Enables the selected interrupt
supported. To transfer compressed data in ECP                               condition.     If the interrupting
mode, the compression count is written to the                               condition is valid, then the
ecpAFifo and the data byte is written to the                                interrupt       is     generated
ecpDFifo.                                                                   immediately when this bit is
                                                                            changed from a 1 to a 0. This
Compression is accomplished by counting                                     can occur during Programmed
identical bytes and transmitting an RLE byte that                           I/O if the number of bytes
indicates how many times the next byte is to be                             removed or added from/to the
repeated. Decompression simply intercepts the                               FIFO does not cross the
RLE byte and repeats the following byte the                                 threshold.
specified number of times. When a run-length
count is received from a peripheral, the
                                                    103


The interrupt generated is ISA friendly in that it           FIFOTHR, which the user programs, is one less
must pulse the interrupt line low, allowing for              and ranges from 0 to 15.
interrupt sharing. After a brief pulse low following
the interrupt event, the interrupt line is tri-stated so     A low threshold value (i.e. 2) results in longer
that other interrupts may assert.                            periods of time between service requests, but
                                                             requires faster servicing of the request for both
An interrupt is generated when:                              read and write cases. The host must be very
                                                             responsive to the service request. This is the
1. For DMA transfers: When serviceIntr is 0,                 desired case for use with a "fast" system. A high
    dmaEn is 1 and the DMA TC is received.                   value of threshold (i.e. 12) is used with a "sluggish"
2. For Programmed I/O:                                       system by affording a long latency period after a
    a.    When serviceIntr is 0, dmaEn is 0,                 service request, but results in more frequent
          direction    is    0   and       there     are     service requests.
          writeIntrThreshold or more free bytes in
          the FIFO. Also, an interrupt is generated          DMA TRANSFERS
          when serviceIntr is cleared to 0 whenever
          there are writeIntrThreshold or more free          DMA transfers are always to or from the ecpDFifo,
          bytes in the FIFO.                                 tFifo or CFifo. DMA utilizes the standard PC DMA
    b.(1) When serviceIntr is 0, dmaEn is 0,                 services. To use the DMA transfers, the host first
          direction    is    1   and       there     are     sets up the direction and state as in the
          readIntrThreshold or more bytes in the             programmed I/O case. Then it programs the DMA
          FIFO. Also, an interrupt is generated              controller in the host with the desired count and
          when serviceIntr is cleared to 0 whenever          memory address. Lastly it sets dmaEn to 1 and
          there are readIntrThreshold or more                serviceIntr to 0. The ECP requests DMA transfers
          bytes in the FIFO.                                 from the host by activating the PDRQ pin. The
3. When nErrIntrEn is 0 and nFault transitions               DMA will empty or fill the FIFO using the
    from high to low or when nErrIntrEn is set from          appropriate direction and mode.            When the
    1 to 0 and nFault is asserted.                           terminal count in the DMA controller is reached, an
4. When ackIntEn is 1 and the nAck signal                    interrupt is generated and serviceIntr is asserted,
    transitions from a low to a high.                        disabling DMA. In order to prevent possible
                                                             blocking of refresh requests dReq shall not be
FIFO Operation                                               asserted for more than 32 DMA cycles in a row.
                                                             The FIFO is enabled directly by asserting
The FIFO threshold is set in the chip configuration          nPDACK and addresses need not be valid. PINTR
registers. All data transfers to or from the parallel        is generated when a TC is received. PDRQ must
port can proceed in DMA or Programmed I/O                    not be asserted for more than 32 DMA cycles in a
(non-DMA) mode as indicated by the selected                  row. After the 32nd cycle, PDRQ must be kept
mode. The FIFO is used by selecting the Parallel             unasserted until nPDACK is deasserted for a
Port FIFO mode or ECP Parallel Port Mode. (FIFO              minimum of 350nsec. (Note: The only way to
test mode will be addressed separately.) After a             properly terminate DMA transfers is with a TC.)
reset, the FIFO is disabled. Each data byte is
transferred by a Programmed I/O cycle or PDRQ                DMA may be disabled in the middle of a transfer
depending on the selection of DMA or                         by first disabling the host DMA controller. Then
Programmed I/O mode.                                         setting serviceIntr to 1, followed by setting dmaEn
                                                             to 0, and waiting for the FIFO to become empty or
The following paragraphs detail the operation of             full. Restarting the DMA is accomplished by
the FIFO flow control. In these descriptions,                enabling DMA in the host, setting dmaEn to 1,
<threshold> ranges from 1 to 16. The parameter               followed by setting serviceIntr to 0.
                                                         104


DMA Mode - Transfers from the FIFO to the                Programmed I/O - Transfers from the FIFO to
Host                                                     the Host
(Note: In the reverse mode, the peripheral may not       In the reverse direction an interrupt occurs when
continue to fill the FIFO if it runs out of data to      serviceIntr is 0 and readIntrThreshold bytes are
transfer, even if the chip continues to request more     available in the FIFO. If at this time the FIFO is full
data from the peripheral.)                               it can be emptied completely in a single burst,
                                                         otherwise readIntrThreshold bytes may be read
The ECP activates the PDRQ pin whenever there            from the FIFO in a single burst.
is data in the FIFO. The DMA controller must
respond to the request by reading data from the          readIntrThreshold =(16-<threshold>) data bytes in
FIFO. The ECP will deactivate the PDRQ pin                                      FIFO
when the FIFO becomes empty or when the TC
becomes true (qualified by nPDACK), indicating           An interrupt is generated when serviceIntr is 0 and
that no more data is required. PDRQ goes                 the number of bytes in the FIFO is greater than or
inactive after nPDACK goes active for the last byte      equal to (16-<threshold>). (If the threshold = 12,
of a data transfer (or on the active edge of nIOR,       then the interrupt is set whenever there are 4-16
on the last byte, if no edge is present on               bytes in the FIFO). The PINT pin can be used for
nPDACK). If PDRQ goes inactive due to the FIFO           interrupt-driven systems. The host must respond
going empty, then PDRQ is active again as soon           to the request by reading data from the FIFO.
as there is one byte in the FIFO. If PDRQ goes           This process is repeated until the last byte is
inactive due to the TC, then PDRQ is active again        transferred out of the FIFO. If at this time the
when there is one byte in the FIFO, and serviceIntr      FIFO is full, it can be completely emptied in a
has been re-enabled. (Note: A data underrun may          single burst, otherwise a minimum of (16-
occur if PDRQ is not removed in time to prevent          <threshold>) bytes may be read from the FIFO in
an unwanted cycle).                                      a single burst.
Programmed I/O Mode or Non-DMA Mode
The ECP or parallel port FIFOs may also be
operated using interrupt driven programmed I/O.
Software can determine the writeIntrThreshold,
readIntrThreshold, and FIFO depth by accessing
the FIFO in Test Mode.
Programmed I/O transfers are to the ecpDFifo at
400H and ecpAFifo at 000H or from the ecpDFifo
located at 400H, or to/from the tFifo at 400H. To
use the programmed I/O transfers, the host first
sets up the direction and state, sets dmaEn to 0
and serviceIntr to 0.
The ECP requests programmed I/O transfers from
the host by activating the PINTR pin. The
programmed I/O will empty or fill the FIFO using
the appropriate direction and mode.
Note: A threshold of 16 is equivalent to a threshold
of 15. These two cases are treated the same.
                                                     105


Programmed I/O - Transfers from the Host to              An interrupt is generated when serviceIntr is 0 and
the FIFO                                                 the number of bytes in the FIFO is less than or
                                                         equal to <threshold>. (If the threshold = 12, then
In the forward direction an interrupt occurs when        the interrupt is set whenever there are 12 or less
serviceIntr is 0 and there are writeIntrThreshold or     bytes of data in the FIFO.) The PINT pin can be
more bytes free in the FIFO. At this time if the         used for interrupt-driven systems. The host must
FIFO is empty it can be filled with a single burst       respond to the request by writing data to the FIFO.
before the empty bit needs to be re-read.                If at this time the FIFO is empty, it can be
Otherwise it may be filled with writeIntrThreshold       completely filled in a single burst, otherwise a
bytes.                                                   minimum of (16-<threshold>) bytes may be written
                                                         to the FIFO in a single burst. This process is
writeIntrThreshold =         (16-<threshold>) free       repeated until the last byte is transferred into the
                             bytes in FIFO               FIFO.
                                                     106


                           PARALLEL PORT FLOPPY DISK CONTROLLER
The Floppy Disk Control signals are available             2.    Control Register read as "cable not
optionally on the parallel port pins. When this                 connected" STROBE, AUTOFD and SLC = 0
mode is selected, the parallel port is not available.           and nINIT =1
There are two modes of operation, PPFD1 and               3.    Status Register reads: nBUSY = 0, PE = 0,
PPFD2. These modes can be selected in the                       SLCT = 0, nACK = 1, nERR = 1
Parallel Port Mode Register, as defined in the
Parallel Port Mode Register, Logical Device 3, at         The following FDC pins are all in the high
0xF1. PPFD1 has only drive 1 on the parallel port         impedence state when the PPFDC is actually
pins; PPFD2 has drive 0 and 1 on the parallel port        selected by the drive select register:
pins.
                                                          1.    nWDATA, DENSEL, nHDSEL, nWGATE,
When the PPFDC is selected the following pins                   nDIR, nSTEP, nDS1, nDS0, nMTR0, nMTR1.
are set as follows:
                                                          2.    If PPFDx is selected, then the parallel port
1.    nPDACK: high-Z                                            can not be used as a parallel port until
2.    PDRQ: not ECP = high-Z, ECP & dmaEn = 0,                  "Normal" mode is selected.
      ECP & not dmaEn = high-Z
3.    PINTR: not active, this is hi-Z or Low              The FDC signals are muxed onto the Parallel Port
      depending on settings.                              pins as shown in Table 42.
Note: nPDACK, PDRQ and PINTR refer to the                 For ACPI compliance the FDD pins that are
nDACK, DRQ and IRQ chosen for the parallel                multiplexed onto the Parallel Port function
port.                                                     independently of the state of the Parallel Port
                                                          controller. For example, if the FDC is enabled
The following parallel port pins are read as follows      onto the Parallel Port the multiplexed FDD
by a read of the parallel port register:                  interface functions normally regardless of the
                                                          Parallel Port Power control, CR22.3. Table 41
1.    Data Register (read) = last Data Register           illustrates this functionality.
      (write)
                               TABLE 45 - PARALLEL PORT FDD CONTROL
       PARALLEL              PARALLEL PORT FDC               PARALLEL PORT             PARALLEL PORT
           PORT                    CONTROL                      FDC STATE                  STATE
         POWER
          CR22.3          LD3:CRF1.1     LD3:CRF1.0
              1                 0               0                   OFF                      ON
              0                 0               0                   OFF                      OFF
              X                 1               X                    ON                      OFF
                               X                1                                         (NOTE1)
NOTE1: The Parallel Port Control register reads as “Cable Not Connected” when the Parallel Port FDC
           is enabled; i.e., STROBE = AUTOFD = SLC = 0 and nINIT = 1.
                                                      107


                                 TABLE 46 - FDC PARALLEL PORT PINS
                   SPP MODE        PIN DIRECTION       FDC MODE     PIN DIRECTION
                    nSTROBE              I/O             (nDS0)          I/(O) Note1
                        PD0              I/O             nINDEX              I
                        PD1              I/O             nTRK0               I
                        PD2              I/O               nWP               I
                        PD3              I/O            nRDATA               I
                        PD4              I/O           nDSKCHG               I
                        PD5              I/O                -                -
                        PD6              I/O            (nMTR0)          I/(O) Note1
                        PD7              I/O                -                -
                       nACK                I              nDS1               O
                      BUSY                 I             nMTR1               O
                        PE                 I            nWDATA               O
                       SLCT                I            nWGATE               O
                       nALF              I/O           DRVDEN0               O
                     nERROR                I            nHDSEL               O
                       nINIT             I/O              nDIR               O
                     nSLCTIN             I/O             nSTEP               O
                 Note 1: These pins are outputs in mode PPFD2, inputs in mode PPFD1.
Refer to Force Write Protect in the Floppy Disk Controller section for information on the Floppy disk
Controller Force Write Protect function.
                                                   108


                                         POWER MANAGEMENT
Power management capabilities are provided for          the part is awakened from DSR powerdown, the
the following logical devices: floppy disk, UART 1,     auto powerdown will once again become effective.
UART 2 and the parallel port. For each logical
device, two types of power management are               Wake Up From Auto Powerdown
provided; direct powerdown and auto powerdown.
                                                        If the part enters the powerdown state through the
FDC POWER MANAGEMENT                                    auto powerdown mode, then the part can be
                                                        awakened by reset or by appropriate access to
Direct power management is controlled by CR22.          certain registers.
Refer to CR22 for more information.
                                                        If a hardware or software reset is used then the
Auto Power Management is enabled by CR23-B0.            part will go through the normal reset sequence. If
When set, this bit allows FDC to enter powerdown        the access is through the selected registers, then
when all of the following conditions have been met:     the FDC resumes operation as though it was
                                                        never in powerdown.          Besides activating the
1.   The motor enable pins of register 3F2H are         RESET pin or one of the software reset bits in the
     inactive (zero).                                   DOR or DSR, the following register accesses will
2.   The part must be idle; MSR=80H and INT = 0         wake up the part:
     (INT may be high even if MSR = 80H due to
     polling interrupts).                               1.    Enabling any one of the motor enable bits in
3.   The head unload timer must have expired.                 the DOR register (reading the DOR does not
4.   The Auto powerdown timer (10msec) must                   awaken the part).
     have timed out.                                    2.    A read from the MSR register.
                                                        3.    A read or write to the Data register.
An internal timer is initiated as soon as the auto
powerdown command is enabled. The part is then          Once awake, the FDC will reinitiate the auto
powered down when all the conditions are met.           powerdown timer for 10 ms. The part will
                                                        powerdown again when all the powerdown
Disabling the auto powerdown mode cancels the           conditions are satisfied.
timer and holds the FDC block out of auto
powerdown.                                              Register Behavior
DSR From Powerdown                                      Table 44 illustrates the AT and PS/2 (including
                                                        Model 30) configuration registers available and the
If DSR powerdown is used when the part is in auto       type of access permitted. In order to maintain
powerdown, the DSR powerdown will override the          software transparency, access to all the registers
auto powerdown. However, when                           must be maintained. As Table 44 shows, two sets
                                                        of registers are distinguished based on whether
                                                        their access results in the part remaining in
                                                        powerdown state or exiting it.
                                                    109


Access to all other registers is possible without        The pins can be divided into two major categories:
awakening the part. These registers can be               system interface and floppy disk drive interface.
accessed during powerdown without changing the           The floppy disk drive pins are disabled so that no
status of the part. A read from these registers will     power will be drawn through the part as a result of
reflect the true status as shown in the register         any voltage applied to the pin within the part's
description in the FDC description. A write to the       power supply range. Most of the system interface
part will result in the part retaining the data and      pins are left active to monitor system accesses
subsequently reflecting it when the part awakens.        that may wake up the part.
Accessing the part during powerdown may cause
an increase in the power consumption by the part.        System Interface Pins
The part will revert back to its low power mode
when the access has been completed.                      Table 45 gives the state of the system interface
                                                         pins in the powerdown state. Pins unaffected by
Pin Behavior                                             the powerdown are labeled "Unchanged". Input
                                                         pins are "Disabled" to prevent them from causing
This chip is specifically designed for systems in        currents internal to the chip when they have
which power conservation is a primary concern.           indeterminate input values.
This makes the behavior of the pins during
powerdown very important.
                                                     110


                         TABLE 47 - PC/AT AND PS/2 AVAILABLE REGISTERS
                                       AVAILABLE REGISTERS
            BASE + ADDRESS            PC-AT          PS/2 (MODEL 30)       ACCESS PERMITTED
                           Access to these registers DOES NOT wake up the part
                    00H                 ----               SRA                       R
                    01H                 ----               SRB                       R
                    02H              DOR (1)             DOR (1)                    R/W
                    03H                  ---                 ---                     ---
                    04H              DSR (1)             DSR (1)                     W
                    06H                  ---                 ---                     ---
                    07H                DIR                  DIR                      R
                    07H                CCR                 CCR                       W
                                 Access to these registers wakes up the part
                    04H                MSR                 MSR                       R
                    05H                Data                Data                     R/W
          Note 1: Writing to the DOR or DSR does not wake up the part, however, writing any of the motor
                   enable bits or doing a software reset (via DOR or DSR reset bits) will wake up the part.
                     TABLE 48 - STATE OF SYSTEM PINS IN AUTO POWERDOWN
                            SYSTEM PINS             STATE IN AUTO POWERDOWN
                                                   INPUT PINS
                                 nIOR                           Unchanged
                                nIOW                            Unchanged
                               SA[0:9]                          Unchanged
                               SD[0:7]                          Unchanged
                             RESET_DRV                          Unchanged
                               DACKx                            Unchanged
                                  TC                            Unchanged
                                                OUTPUT PINS
                                 IRQx                       Unchanged (low)
                               SD[0:7]                          Unchanged
                                DRQx                        Unchanged (low)
FDD Interface Pins
                                                           Pins used for local logic control or part
All pins in the FDD interface which can be                 programming are unaffected. Table 46 depicts the
connected directly to the floppy disk drive itself are     state of the floppy disk drive interface pins in the
either DISABLED or TRISTATED.                              powerdown state.
                                                       111


TABLE 49 - STATE OF FLOPPY DISK DRIVE INTERFACE PINS IN POWERDOWN
              FDD PINS         STATE IN AUTO POWERDOWN
                             INPUT PINS
               nRDATA                      Input
               nWPROT                      Input
                 nTR0                      Input
                nINDEX                     Input
              nDSKCHG                      Input
                            OUTPUT PINS
                nMTR0                    Tristated
                 nDS0                    Tristated
                 nDIR                     Active
                nSTEP                     Active
               nWDATA                    Tristated
               nWGATE                    Tristated
               nHDSEL                     Active
             DRVDEN[0:1]                  Active
                                 112


UART POWER MANAGEMENT                                       1.    ECP is not enabled in the configuration
                                                                  registers.
Direct power management is controlled by CR22.              2     SPP, PS/2 Parallel port or EPP mode is
Refer to CR22 for more information.                               selected through ecr while in ECP mode.
Auto Power Management is enabled by CR23-B4                 Exit Auto Powerdown
and B5. When set, these bits allow the following
auto power management operations:                           The parallel port logic can change powerdown
                                                            modes when the ECP mode is changed through
1.   The transmitter enters auto powerdown when             the ecr register or when the parallel port mode is
     the transmit buffer and shift register are             changed through the configuration registers.
     empty.
2.   The receiver enters powerdown when the                 VBAT Support
     following conditions are all met:
                                                            This chip requires a (TBD) MicroAmp battery
     A.   Receive FIFO is empty                             supply (VBAT) to provide battery backed up
     B.   The receiver is waiting for a start bit.          registers. These registers retain the contents of
                                                            the general purpose registers and wake-up event
Note:     While in powerdown the Ring Indicator             registers.
          interrupt is still valid and transitions when
          the RI input changes.                             VTR Support
Exit Auto Powerdown                                         The FDC37B72x requires a 25 mA trickle
                                                            (standby) supply (VTR) to provide sleep current
The transmitter exits powerdown on a write to the           for the programmable wake-up events in the Soft
XMIT buffer. The receiver exits auto powerdown              Power Management logic, SCI, PME and SMI
when RXDx changes state.                                    interfaces when VCC is removed.              If the
                                                            FDC37B72x is not intended to provide wake-up
PARALLEL PORT                                               capabilities on standby power, VTR can be
                                                            connected to VCC. VTR powers the IR interface,
Direct power management is controlled by CR22.              the PME registers, the PME interface, the ACPI
Refer to CR22 for more information.                         registers, the SCI interface, the GPIO logic, the
                                                            GPIO configuration registers and other wakeup
Auto Power Management is enabled by CR23-B3.                related configuration registers. The VTR pin
When set, this bit allows the ECP or EPP logical            generates a VTR Power-on-Reset signal to
parallel port blocks to be placed into powerdown            initialize certain components. All wakeup event
when not being used.                                        registers and related logic are battery backed-up
                                                            to retain the configuration of the wakeup events
The EPP logic is in powerdown under any of the              upon a power loss (i.e., VCC = 0 V and VTR = 0
following conditions:                                       V). These registers are reset on a VBAT POR.
                                                            The following section lists the pins that are active
1.   EPP is not enabled in the configuration                under VTR power.
     registers.
2.   EPP is not selected through ecr while in ECP           INTERNAL PWRGOOD
     mode.
                                                            An internal PWRGOOD logical control is included
The ECP logic is in powerdown under any of the
                                                            to minimize the effects of pin-state uncertainty in
following conditions:
                                                            the host interface as Vcc cycles on and off.
                                                            When the internal PWRGOOD signal is “1”
                                                        113


(active), Vcc is > 4V, and the FDC37B72x host
interface is active.        When the internal
                                                        32.768 kHz STANDBY CLOCK OUTPUT
PWRGOOD signal is “0” (inactive), Vcc is ≤ 4V,
and the FDC37B72x host interface is inactive;
                                                        The FDC37B72x provides a 32.768 kHz trickle
that is, ISA bus reads and writes will not be
                                                        clock output pin. This output is active as long as
decoded.
                                                        VTR is present.
The FDC37B72x device pins KDAT, MDAT,
                                                        OSCILLATOR
IRRX, nRI1, nRI2, RXD1, RXD2, nRING,
Button_In and the GPIOs are part of the PME
                                                        Crystal Oscillator input. A 32.768kHz crystal
interface and remain active as inputs for wakeup
                                                        connected externally on the XTAL1 and XTAL2
when the internal PWRGOOD signal has gone
                                                        pins generates the 32.768kHz input clock.
inactive, provided VTR is powered. In addition, the
                                                        Maximum clock frequency is 32.768kHz. This
nPME/SCI, GP53/IRQ11 (SCI pin), nPowerOn
                                                        oscillator is also used as an internal clock source
and CLK32OUT pins remain active as outputs
                                                        for functions within the FDC37B72x.
when the internal PWRGOOD is inactive and VTR
is powered. The internal PWRGOOD signal is
also used to disable the IR Half Duplex Timeout.
                                                        There is a bit in the Ring Filter Select Register that
                                                        can be used to select the load capacitance of the
Note: If VTR is to be used for programmable
                                                        crystal to ensure accurate time keeping. This bit is
wake-up events when VCC is removed, VTR must
                                                        defined as follows: Bit 6 - XTAL_CAP. This bit is
be at its full minimum potential at least 10 μs
                                                        used to specify the 32kHz XTAL load
before Vcc begins a power-on cycle. When VTR
                                                        capacitance (12pF vs. 6pF):
and Vcc are fully powered, the potential difference
                                                        0=12pF (Default), 1=6pF.
between the two supplies must not exceed
500mV.
                                                    114


SERIAL IRQ
The FDC37B72x supports serial interrupts to transmit interrupt information to the host system. The serial
interrupt scheme adheres to the Serial IRQ Specification for PCI Systems, Version 6.0.
Timing Diagrams For IRQSER Cycle
          PCICLK = 33Mhz_IN pin
          IRQSER = SIRQ pin
     A) Start Frame timing with source sampled a low pulse on IRQ1
                                START FRAME               IRQ0 FRAME IRQ1 FRAME IRQ2 FRAME
                        SL
                         or     H             R     T      S    R     T    S    R      T    S    R   T
                         H
  PCICLK
  IRQSER                      START1
  Drive Source         IRQ1    Host Controller             None             IRQ1              None
                            H=Host Control              R=Recovery
                            SL=Slave Control            T=Turn-around
                                       S=Sample
          1) Start Frame pulse can be 4-8 clocks wide.
                                                   115


      B) Stop Frame Timing with Host using 17 IRQSER sampling period
                   IRQ14           IRQ15         IOCHCK#
                                                                      STOP FRAME            NEXT CYCLE
                  FRAME            FRAME           FRAME
                                                                   2
                S R T            S R T          S R T            I        H      R     T
   PCICLK
   IRQSER                                                                STOP1                      START3
      Driver       None           IRQ15           None                 Host Controller
                                          H=Host Control         T=Turn-around
                                          R=Recovery             S=Sample
                                                I= Idle.
           1)       Stop pulse is 2 clocks wide for Quiet mode, 3 clocks wide for Continuous mode.
           2)       There may be none, one or more Idle states during the Stop Frame.
           3)       The next IRQSER cycle’s Start Frame pulse may or may not start immediately
                    after the turn-around clock of the Stop Frame.
IRQSER Cycle Control                                      This makes a total low pulse width of four to eight
                                                          clocks. Finally, the Host Controller will drive the
There are two modes of operation for the                  IRQSER back high for one clock, then tri-state.
IRQSER Start Frame.
                                                          Any IRQSER Device (i.e., The FDC37B72x)
1) Quiet (Active) Mode: Any device may initiate           which detects any transition on an IRQ/Data line
a Start Frame by driving the IRQSER low for one           for which it is responsible must initiate a Start
clock, while the IRQSER is Idle. After driving low        Frame in order to update the Host Controller
for one clock the IRQSER must immediately be              unless the IRQSER is already in an IRQSER
tri-stated without at any time driving high. A Start      Cycle and the IRQ/Data transition can be
Frame may not be initiated while the IRQSER is            delivered in that IRQSER Cycle.
Active. The IRQSER is Idle between Stop and
Start Frames. The IRQSER is Active between                2) Continuous (Idle) Mode: Only the Host
Start and Stop Frames. This mode of operation             controller can initiate a Start Frame to update
allows the IRQSER to be Idle when there are no            IRQ/Data line information. All other IRQSER
IRQ/Data transitions which should be most of the          agents become passive and may not initiate a
time.                                                     Start Frame. IRQSER will be driven low for four
                                                          to eight clocks by Host Controller. This mode
Once a Start Frame has been initiated the Host            has two functions. It can be used to stop or idle
Controller will take over driving the IRQSER low          the IRQSER or the Host Controller can operate
in the next clock and will continue driving the           IRQSER in a continuous mode by initiating a
IRQSER low for a programmable period of three             Start Frame at the end of every Stop Frame.
to seven clocks.
                                                          An IRQSER mode transition can only occur
                                                          during the Stop Frame. Upon reset, IRQSER
                                                          bus is defaulted to Continuous mode,
                                                      116


therefore only the Host controller can initiate           Recovery phase the FDC37B72x must drive the
the first Start Frame.                Slaves must         SERIRQ high, if and only if, it had driven the
continuously sample the Stop Frames pulse                 IRQSER low during the previous Sample Phase.
width to determine the next IRQSER Cycle’s                During the Turn-around Phase the FDC37B72x
mode.                                                     must tri-state the SERIRQ. The FDC37B72x will
                                                          drive the IRQSER line low at the appropriate
IRQSER Data Frame                                         sample point if its associated IRQ/Data line is
Once a Start Frame has been initiated, the                low, regardless of which device initiated the Start
FDC37B72x will watch for the rising edge of the           Frame.
Start Pulse and start counting IRQ/Data Frames
from there. Each IRQ/Data Frame is three                  The Sample Phase for each IRQ/Data follows the
clocks: Sample phase, Recovery phase, and                 low to high transition of the Start Frame pulse by
Turn-around phase. During the Sample phase                a number of clocks equal to the IRQ/Data Frame
the FDC37B72x must drive the IRQSER (SIRQ                 times three, minus one. (e.g. The IRQ5 Sample
pin) low, if and only if, its last detected IRQ/Data      clock is the sixth IRQ/Data Frame, (6 x 3) - 1 =
value was low. If its detected IRQ/Data value is          17th clock after the rising edge of the Start
high, IRQSER must be left tri-stated. During the          Pulse).
                                          IRQSER Sampling Periods
              IRQSER PERIOD                   SIGNAL SAMPLED            # OF CLOCKS PAST START
                       1                           Not Used                             2
                       2                              IRQ1                              5
                       3                          nSMI/IRQ2                             8
                       4                              IRQ3                             11
                       5                              IRQ4                             14
                       6                              IRQ5                             17
                       7                              IRQ6                             20
                       8                              IRQ7                             23
                       9                              IRQ8                             26
                      10                              IRQ9                             29
                      11                             IRQ10                             32
                      12                             IRQ11                             35
                      13                             IRQ12                             38
                      14                             IRQ13                             41
                      15                             IRQ14                             44
                      16                             IRQ15                             47
                                                      117


The SIRQ data frame will now support IRQ2 from         Latency
a logical device, previously IRQSER Period 3
was reserved for use by the System                     Latency for IRQ/Data updates over the IRQSER
Management Interrupt (nSMI).          When using       bus in bridge-less systems with the minimum
Period 3 for IRQ2 the user should mask off the         IRQ/Data Frames of seventeen, will range up to
SMI via the SMI Enable Register. Likewise,             96 clocks (3.84μS with a 25MHz PCI Bus or
when using Period 3 for nSMI the user should           2.88uS with a 33MHz PCI Bus). If one or more
not configure any logical devices as using IRQ2.       PCI to PCI Bridge is added to a system, the
                                                       latency for IRQ/Data updates from the secondary
IRQSER Period 14 is used to transfer IRQ13.            or tertiary buses will be a few clocks longer for
Logical devices 0 (FDC), 3 (Par Port), 4 (Ser Port     synchronous buses, and approximately double
1), 5 (Ser Port 2), and 7 (KBD) shall have IRQ13       for asynchronous buses.
as a choice for their primary interrupt.
                                                       EOI/ISR Read Latency
The SMI is enabled onto the SMI frame of the
Serial IRQ via bit 6 of SMI Enable Register 2 and      Any serialized IRQ scheme has a potential
onto the SMI pin via bit 7 of the SMI Enable           implementation issue related to IRQ latency. IRQ
Register 2.                                            latency could cause an EOI or ISR Read to
                                                       precede an IRQ transition that it should have
Note: When Serial IRQs are used, nIRQ8,                followed. This could cause a system fault. The
nSCI and nSMI may be output on one of their            host interrupt controller is responsible for
respective pin options. See the IRQ MUX                ensuring that these latency issues are mitigated.
Configuration Register.                                The recommended solution is to delay EOIs and
                                                       ISR Reads to the interrupt controller by the same
Stop Cycle Control                                     amount as the IRQSER Cycle latency in order to
                                                       ensure that these events do not occur out of
Once all IRQ/Data Frames have completed the            order.
Host Controller will terminate IRQSER activity by
initiating a Stop Frame. Only the Host Controller      AC/DC Specification Issue
can initiate the Stop Frame. A Stop Frame is
indicated when the IRQSER is low for two or            All IRQSER agents must drive / sample IRQSER
three clocks. If the Stop Frame’s low time is two      synchronously related to the rising edge of PCI
clocks then the next IRQSER Cycle’s sampled            bus clock. IRQSER (SIRQ) pin uses the
mode is the Quiet mode; and any IRQSER                 electrical specification of PCI bus. Electrical
device may initiate a Start Frame in the second        parameters will follow PCI spec. section 4,
clock or more after the rising edge of the Stop        sustained tri-state.
Frame’s pulse. If the Stop Frame’s low time is
three clocks then the next IRQSER Cycle’s              Reset and Initialization
sampled mode is the Continuos mode; and only
the Host Controller may initiate a Start Frame in      The IRQSER bus uses RESET_DRV as its reset
the second clock or more after the rising edge of      signal. The IRQSER pin is tri-stated by all agents
the Stop Frame’s pulse.                                while RESET_DRV is active. With reset,
                                                       IRQSER Slaves are put into the (continuous)
                                                       IDLE mode. The Host Controller is responsible
                                                       for starting the initial IRQSER Cycle to collect
                                                       system’s IRQ/Data default values. The system
                                                       then follows with the Continuous/Quiet mode
                                                       protocol (Stop Frame pulse width) for
                                                       subsequent IRQSER Cycles. It is Host
                                                   118


Controller’s responsibility to provide the default     application, the Host controller should be
values to 8259’s and other system logic before         programmed into Continuous (IDLE) mode first.
the first IRQSER Cycle is performed.          For      This is to guarantee IRQSER bus is in IDLE state
IRQSER system suspend, insertion, or removal           before the system configuration changes.
                                                   119


                                               BIOS BUFFER
The chip contains one 245 type buffer that can be         transmission from the RD bus to the SD bus or
used for a BIOS Buffer. If the BIOS buffer is not         from the SD bus to the RD bus. The direction of
used, then nROMCS must be tied high or pulled             the transfer is controlled by nROMOE. The enable
up to Vcc with a resistor so as not to interfere with     input, nROMCS, can be used to disable the
the boot ROM.           This function allows data         transfer       and       isolate   the       buses.
                         nROMCS             nROMOE                 DESCRIPTION
                             L                  L         RD[0:7] data to SD[0:7] bus
                             L                 H          SD[0:7] data to RD[0:7]
                            H                  X          Isolation
RD Bus Functionality                                      appear on SD0-7. If nROMCS = 1, the RD bus is
                                                          disabled, and nothing appears on the SD bus.
The following cases described below illustrate the        Note: any RD bus pin can be programmed as an
use of the RD Bus.                                        alternate function, however, if nROMCS=0, then
                                                          anything on the RD bus will appear on the SD bus.
Case 1: nROMCS and nROMOE as original
function. The RD bus can be used as the RD bus            Case 3: nROMCS as GPIO function. (nROMCS
or one or more RD pins can be programmed as               internally tied to VDD.) The RD bus floats - cannot
alternate function.      These alternate functions        use as a bus. Any pin can be programmed as an
behave as follows: if in RD to SD mode, any value         alternate function.
on RDx will appear on SDx; if in SD to RD mode,
SDx will not appear on RDx, RDx gets the                  Case 4: nROMCS and nROMOE as GPIO
alternate function value. Note: In this case,             function. Same as Case 3.
nROMCS=0, nROMOE=1.
                                                          Case 5: Parallel IRQ enabled; RD Bus pins,
Case 2: nROMOE as GPIO function. (nROMOE                  nROMOE, nROMCS are used as IRQ pins.
internally tied to ground). In this case, the RD bus
is a unidirectional bus (read only) controlled by
nROMCS. If nROMCS = 0, the values on RD0-7
                                                      120


                                         GENERAL PURPOSE I/O
The FDC37B72x provides a set of flexible                  The GPIO pins can perform simple I/O or can be
Input/Output control functions to the system              individually configured to provide predefined
designer through the 20 dedicated independently           alternate functions.       VBAT Power-On-Reset
programmable General Purpose I/O pins (GPIO).             configures all GPIO pins as non-inverting inputs.
                                                DESCRIPTION
Each GPIO port requires a 1-bit data register and         available at different addresses when the
an 8-bit configuration control register. The data         FDC37B72x is in the Run state (see the Run State
register for each GPIO port is represented as a bit       GPIO Register Access section below). The GPIO
in one of three 8-bit GPIO DATA Registers, GP1,           ports with their alternate functions and
GP5, and GP6. All of the GPIO registers are               configuration state register addresses are listed in
located in Logical Device Block No. 8 in the              TABLE 50. Note: four bits 1, 5-7 of GP5 are not
FDC37B72x device configuration space. The                 implemented.
GPIO DATA Registers are also optionally
                      TABLE 50 - GENERAL PURPOSE I/O PORT ASSIGNMENTS
                                                                       DATA           DATA        CONFIG.
                                                                               5                            5
  PIN NO.     DEFAULT          ALT.          ALT.        ALT.       REGISTER       REGISTER     REGISTER
    QFP       FUNCTION       FUNC. 1        FUNC. 2     FUNC. 3        (HEX)         BIT NO.       (HEX)
     77      GPIO           nSMI          -           -                 GP1             0          CRE0
                                               1
     78      GPIO           nRING         EETI        -               (CRF6)            1          CRE1
                                                  4        1
     79      GPIO           WDT           P17/P12     EETI                              2          CRE2
     80      GPIO           LED           -           -                                 3          CRE3
     81      GPIO           IRRX2         -           -                                 4          CRE4
     82      GPIO           IRTX2         -           -                                 5          CRE5
      4      GPIO           nMTR1         -           -                                 6          CRE6
      6      GPIO           nDS1          -           -                                 7          CRE7
     39      PCI_CLK        IRQ14         GPIO        -                 GP5             0          CRC8
      2      GPIO           DRVDEN1       IRQ8        nSMI            (CRF9)            2          CRCA
                      2                                    1
     91      nROMCS         IRQ11         GPIO        EETI                              3          CRCB
                      2                                    1
     92      nROMOE         IRQ12         GPIO        EETI                              4          CRCC
                  2,3
     83      RD0            IRQ1          GPIO        nSMI              GP6             0          CRD0
                  2,3
     84      RD1            IRQ3          GPIO        LED             (CRFA)            1          CRD1
                  2,3
     85      RD2            IRQ4          GPIO        nRING                             2          CRD2
                  2,3
     86      RD3            IRQ5          GPIO        WDT                               3          CRD3
                  2,3                                         4
     87      RD4            IRQ6          GPIO        P17/P12                           4          CRD4
                  2,3
     88      RD5            IRQ7          GPIO        -                                 5          CRD5
                  2,3
     89      RD6            IRQ8          GPIO        -                                 6          CRD6
                  2,3
     90      RD7            IRQ10         GPIO        -                                 7          CRD7
Note 1:       Refer to the section on Either Edge Triggered Interrupt Inputs.
Note 2:       At power-up, RD0-7, nROMCS and nROMOE function as the XD Bus. To use RD0-7 for
              alternate functions, nROMCS must stay high until those pins are finished being programmed.
Note 3:       These pins cannot be programmed as open drain pins in their original function.
Note 4:       The function of P17 or P12 is selected via the P17/P12 select bit in the Ring Filter Select
              Register in Logical Device 8 at 0xC6.
Note 5:       The GPIO Data and Configuration Registers are located in Logical Device Block Number 8.
                                                     121


RUN STATE GPIO DATA REGISTER                              and Data port addresses are used to access the
ACCESS                                                    GPIO data, Soft Power Status and Enable, and
                                                          the Watchdog Timer Control registers.
The GPIO data registers as well as the Watchdog
Timer Control, and the Soft Power Enable and              For example, to access the GP1 data register
Status registers can be accessed by the host              when in the run state, the host should perform an
when the chip is in the run state if CR03 Bit[7] = 1.     I/O Write of 0x01 to the Index port address (0xEx)
The host uses an Index and Data port to access            to select GP1 and then read or write the Data port
these registers (TABLE 51). The Index and Data            (at Index+1) to access the GP1 register.
port power-on default addresses are 0xEA and              Generally, to access any GPIO data register GPx
0xEB respectively. In the configuration state the         the host should perform an I/O Write of 0x0x to the
Index port address may be re-programmed to                Index port address and then access GPx through
0xE0, 0xE2, 0xE4 or 0xEA; the Data port address           the Data port. The Soft Power and Watchdog
is automatically set to the Index port address + 1.       Timer Control registers are accessed similarly.
Upon exiting the configuration state the new Index
                                  TABLE 51 - INDEX AND DATA PORTS
                     PORT               PORT
                    NAME              ADDRESS                  RUN STATE ACCESS
                     Index         0xE0, E2, E4, EA      0x01-0x0F
                      Data        Index address + 1      Access to GP1, Watchdog Timer
                                                         Control, GP5, GP6, and the Soft
                                                         Power Status and Enable registers
                                                         (see TABLE 52).
                 TABLE 52 - RUN STATE ACCESSABLE CONFIGURATION REGISTERS
          RUN STATE REGISTER           REGISTER (CONFIGURATION STATE ADDRESSING1)
             ADDRESS (INDEX)
                     0x01                                    GP1 (L8 - CRF6)
                     0x03                          Watchdog Timer Control (L8 - CRF4)
                     0x05                                    GP5 (L8 - CRF9)
                     0x06                                   GP6 (L8 - CRFA)
                     0x08                        Soft Power Enable Register 1 (L8-CRB0)
                     0x09                        Soft Power Enable Register 2 (L8-CRB1)
                     0x0A                        Soft Power Status Register 1 (L8-CRB2)
                     0x0B                        Soft Power Status Register 2 (L8-CRB3)
Note 1: These registers can also be accessed through the configuration registers L8 - CRxx, as shown,
          when the FDC37B72x is in the configuration state.
GPIO CONFIGURATION
                                                          Each GPIO port may be configured as either an
Each GPIO port has an 8-bit configuration register        input or an output. If the pin is configured as an
that controls the behavior of the pin. The GPIO           output, it can be programmed as open-drain or
configuration registers are only accessible when          push-pull. Inputs and outputs can be configured
the FDC37B72x is in the Configuration state; more         as non-inverting or inverting and can be
information can be found in the Configuration             programmed to generate an interrupt. GPIO ports
section of this specification.                            can also be configured as a pre-defined alternate
                                                      122


function.    Bit[0] of each GPIO Configuration              of the GPIO Direction bit[0]. Also, selected
Register determines the port direction, bit[1]              Alternate INPUT functions cannot be inverted,
determines the signal polarity, bits[4:3] select the        regardless of the state of the GPIO polarity bit[1],
port function, bit[5] enables the interrupt, and bit[7]     except for the EETI function.
determines the output driver type select. The
GPIO configuration register Output Type select              The interrupt channel for the group Interrupts is
bit[7] applies to GPIO functions, the Watchdog              selected by the GP_INT[2:1] configuration
Timer WDT, the LED and the nSMI Alternate                   registers defined in the FDC37B72x Configuration
functions. The basic GPIO configuration options             Register Section. The group interrupts are the
are summarized in TABLE 53.                                 "ORed" function of the group interrupt enabled
                                                            GPIO ports and will represent a standard ISA
For Alternate functions, the pin direction is set and       interrupt (edge high). GPIO Group 1 and 2
controlled internally, regardless of the state              Interrupts can generate SMI events, wake-up
                                                            events through the Soft Power Management logic,
                                                            and SCI/PME events. See the ACPI, PME and
                                                            SMI section for details.
                                                            When the group interrupt is enabled on a GPIO
                                                            input port, the interrupt circuitry contains a
                                                            selectable digital debounce filter so that switches
                                                            or push-buttons may be directly connected to the
                                                            chip. The debounce filters reject signals with pulse
                                                            widths ≤1ms and are enabled per interrupt group
                                                            in the GP_INT[2:1] configuration registers.
                                                            The state of unconnected GPIO alternate input
                                                            functions is inactive. For example, if bits[4:3] in
                                                            LD8 -CRCB are not “00”, i.e. nROMCS is not the
                                                            selected function for GP53, internally the state of
                                                            nROMCS is inactive, “1”.
                                                        123


                            TABLE 53 - GPIO CONFIGURATION SUMMARY
   SELECTED          DIRECTION         POLARITY        GROUP INT.
    FUNCTION             BIT               BIT         ENABLE BIT                DESCRIPTION
                          B0               B1                B5
       GPIO               0                 0                 0         Pin is a non-inverted output
                                                                        with the Interrupt disabled.
                           0                0                 1         Pin is a non-inverted output
                                                                        with the Interrupt enabled.
                           0                1                 0         Pin is an inverted output with
                                                                        the Interrupt disabled.
                           0                1                 1         Pin is a inverted output with
                                                                        the Interrupt enabled.
                           1                0                 0         Pin is a non-inverted input with
                                                                        the Interrupt disabled.
                           1                0                 1         Pin is a non-inverted input with
                                                                        the Interrupt enabled.
                           1                1                 0         Pin is an inverted input with the
                                                                        Interrupt disabled.
                           1                1                 1         Pin is a inverted input with the
                                                                        Interrupt enabled.
       ALT.               X1                0                 0         Non-inverted alternate function
                                                                        with Interrupt disabled.
                                            0                 1         Non-inverted alternate function
                                                                        with Interrupt enabled.
                                           12                 0         Alternate OUTPUT functions
                                                                        are inverted, Alternate INPUT
                                                                        functions are non-inverted;
                                                                        Interrupts are disabled.
                                                              1         Alternate OUTPUT functions
                                                                        are inverted, Alternate INPUT
                                                                        functions are non-inverted;
                                                                        Interrupts are enabled.
Note 1: For alternate function selects, the pin direction is set and controlled internally; i.e., regardless of
        the state of the GPIO configuration register Direction bit.
Note 2: For alternate function selects, INPUT functions cannot be inverted, regardless of the state of the
        GPIO polarity bit, except for the EETI function.
                                                    124


GPIO OPERATION
The operation of the GPIO ports is illustrated in FIGURE 4. Note: FIGURE 4 is for illustration
purposes only and is not intended to suggest specific implementation details.
                                                             GPIO                GPIO
                                                             Configuration       Configuration
                                                             Register bit-1      Register bit-0
                                                             (Polarity)          (Input/Output)
                     D-TYPE
           SD-bit
                     D      Q
  GPx_nIOW
                                        0
                                                                                                 GPIO
                    Transparent
                                                                        1   0
                                                                                                   PIN
                     Q      D           1
  GPx_nIOR
                                                  GPIO
                       GPIO
                                                  Configuration
                  Data Register                   Register bit-2 or 5
                       Bit-n
                                                  (GROUP INT. ENABLE)
                                                            GP Group Interrupts (1 or 2)
                              FIGURE 4 - GPIO FUNCTION ILLUSTRATION
When a GPIO port is programmed as an input,             When a GPIO port is programmed as an output,
reading it through the GPIO data register latches       the logic value or the inverted logic value that has
either the inverted or non-inverted logic value         been written into the GPIO data register is output
present at the GPIO pin. Writing to a GPIO port         to the GPIO pin. Reading from a GPIO port that is
that is programmed as an input has no effect            programmed as an output returns the last value
(TABLE 54).                                             written to the data register (TABLE 54).
                                 TABLE 54 - GPIO READ/WRITE BEHAVIOR
         HOST OPERATION                     GPIO INPUT PORT                      GPIO OUTPUT PORT
                 READ                LATCHED VALUE OF GPIO PIN LAST WRITE TO GPIO DATA
                                                                           REGISTER
                WRITE                NO EFFECT                             BIT PLACED IN GPIO DATA
                                                                           REGISTER
                                                   125


                                            WATCH DOG TIMER
The FDC37B72x contains a Watch Dog Timer
(WDT). The Watch Dog Time-out status bit may               The host may force a Watch Dog time-out to occur
be mapped to an interrupt through the WDT_CFG              by writing a "1" to bit 2 of the WDT_CTRL (Force
Configuration Register. It can also be brought out         WD Time-out) Configuration Register. Writing a
on the GP12 or GP63 pins by programming the                "1" to this bit forces the WDT count value to zero
corresponding GPIO configuration register.                 and sets bit 0 of the WDT_CTRL (Watch Dog
                                                           Status). Bit 2 of the WDT_CTRL is self-clearing.
The FDC37B72x's WDT has a programmable
time-out ranging from 1 to 255 minutes with one            LED
minute resolution, or 1 to 255 seconds with 1
second resolution. The units of the WDT timeout            The FDC37B72x can directly drive an LED using
value are selected via bit[7] of the                       the alternate function of GP13 or GP61 (only one
WDT_TIMEOUT register (LD8:CRF1.7). The WDT                 may be used at at time). These pins are active
time-out value is set through the WDT_VAL                  under VTR power so the LED may be used in any
Configuration register. Setting the WDT_VAL                system power state. The GPIO used for the LED
register to 0x00 disables the WDT function (this is        will initially default to an input; the corresponding
its power on default). Setting the WDT_VAL to              GPIO configuration register must be programmed
any other non-zero value will cause the WDT to             to configure the pin for the LED function and as a
reload and begin counting down from the value              push pull or an open drain output. However, under
loaded. When the WDT count value reaches zero              VTR power the LED must be configured as open
the counter stops and sets the Watchdog time-out           drain, since the pin cannot drive current under
status bit in the WDT_CTRL Configuration                   VTR power. The polarity bit may be chosen as
Register. Note: Regardless of the current state of         either non-inverted or inverted (active high or
the WDT, the WDT time-out status bit can be                active low).
directly set or cleared by the Host CPU.
                                                           The LED can be turned on and off or toggled at a
There are three system events which can reset the          1 Hertz rate with a 50 percent duty cycle. When
WDT. These are a Keyboard Interrupt, a                     the GP13 or GP61 pin is configured as a non-
Mouse Interrupt, or I/O reads/writes to address            inverted, open drain output and the LED function is
0x201 (the internal or an external Joystick Port).         chosen, the LED may be turned on by writing ‘1’
The effect on the WDT for each of these system             the GP1 register bit 3 or the GP6 register bit 1.
events may be individually enabled or disabled             Clearing these bits will then turn the LED off. The
through bits in the WDT_CFG configuration                  LED may be toggled as described below. Note
register. When a system event is enabled through           that the GPIO can control the LED in its default
the WDT_CFG register, the occurrence of that               GPIO function, but it may only toggle if the LED
event will cause the WDT to reload the value               function is chosen.
stored in WDT_VAL and reset the WDT time-out
status bit if set. If all three system events are          Setting bit 1 of the WDT_CTRL configuration
disabled the WDT will inevitably time out.                 register will cause the Power LED output driver to
                                                           toggle at 1 Hertz with a 50 percent duty cycle.
The Watch Dog Timer may be configured to                   When this bit is cleared the Power LED output will
generate an interrupt on the rising edge of the            drive continuously unless it has been configured to
Time-out status bit. The WDT interrupt is mapped           toggle on Watch Dog time-out conditions. Setting
to an interrupt channel through the WDT_CFG                bit 3 of the WDT_CFG configuration register will
Configuration Register. When mapped to an                  cause the Power LED output driver to toggle at 1
interrupt the interrupt request pin reflects the value     Hertz with a 50 percent duty cycle whenever the
of the WDT time-out status bit.                            WDT time-out status bit is set. The truth table
                                                       126


below clarifies the conditions for which the Power     LED               will              toggle.
                                        TABLE 55 - LED TOGGLE
                                WDT_CFG BIT[3]
    WDT_CTRL BIT[1]          POWER LED TOGGLE           WDT_CTRL BIT[0]
     LED TOGGLE                     ON WDT            WDT T/O STATUS BIT         LED STATE
              1                         X                      X           Toggle
              0                         0                      X           Continuous
              0                         1                      0           Continuous
              0                         1                      1           Toggle
                                                   127


                         8042 KEYBOARD CONTROLLER DESCRIPTION
A Universal Keyboard Controller designed for          concentrates on the enhancements to the 8042.
intelligent keyboard management in desktop            For general information about the 8042, refer to
computer applications is implemented.         The     the "Hardware Description of the 8042" in the 8-Bit
Universal Keyboard Controller uses an 8042            Embedded           Controller          Handbook.
microcontroller CPU core.         This section
             8042A                                 LS05
                           P27                                                              KDAT
                           P10
                           P26                                                              KCLK
                        TST0
                           P23                                                              MCLK
                        TST1
                            P22                                                             MDAT
                            P11
                              Keyboard and Mouse Interface
KIRQ is the Keyboard IRQ
MIRQ is the Mouse IRQ
Port 21 is used to create a GATEA20 signal from the FDC37B72x.
                                                  128


KEYBOARD ISA INTERFACE                                   and the Status register, Input Data register, and
                                                         Output Data register. Table 48 shows how the
The FDC37B72x ISA interface is functionally              interface decodes the control signals. In addition
compatible with the 8042-style host interface. It        to the above signals, the host interface includes
consists of the D0-7 data bus; the nIOR, nIOW            keyboard          and          mouse         IRQs.
                                    TABLE 56 - ISA I/O ADDRESS MAP
  ISA ADDRESS          nIOW          nIOR          BLOCK                  FUNCTION (NOTE 1)
       0x60               0            1           KDATA        Keyboard Data Write (C/D=0)
                          1            0           KDATA        Keyboard Data Read
       0x64               0            1           KDCTL        Keyboard Command Write (C/D=1)
                          1            0           KDCTL        Keyboard Status Read
Note 1: These registers consist of three separate 8 bit registers. Status, Data/Command Write and Data
          Read.
Keyboard Data Write                                      Keyboard Command Write
This is an 8 bit write only register. When written,      This is an 8 bit write only register. When written,
the C/D status bit of the status register is cleared     the C/D status bit of the status register is set to
to zero and the IBF bit is set.                          one and the IBF bit is set.
Keyboard Data Read                                       Keyboard Status Read
This is an 8 bit read only register. If enabled by       This is an 8 bit read only register. Refer to the
"ENABLE FLAGS", when read, the KIRQ output is            description of the Status Register for more
cleared and the OBF flag in the status register is       information.
cleared.    If not enabled, the KIRQ and/or
AUXOBF1 must be cleared in software.
                                                         CPU-to-Host Communication
                                                         The FDC37B72x CPU can write to the Output
                                                         Data register via register DBB. A write to this
                                                         register automatically sets Bit 0 (OBF) in the
                                                         Status register. See Table 49.
                                  TABLE 57 - HOST INTERFACE FLAGS
         8042 INSTRUCTION                                         FLAG
      OUT DBB                      Set OBF, and, if enabled, the KIRQ output signal goes high
                                                     129


Host-to-CPU Communication                                 PS/2 mouse products that employ the same type
The host system can send both commands and                of interface. To facilitate system expansion, the
data to the Input Data register.         The CPU          FDC37B72x provides four signal pins that may be
differentiates between commands and data by               used to implement this interface directly for an
reading the value of Bit 3 of the Status register.        external keyboard and mouse.
When bit 3 is "1", the CPU interprets the register
contents as a command. When bit 3 is "0", the             The FDC37B72x has four high-drive, open-drain
CPU interprets the register contents as data.             output, bidirectional port pins that can be used for
During a host write operation, bit 3 is set to "1" if     external serial interfaces, such as ISA external
SA2 = 1 or reset to "0" if SA2 = 0.                       keyboard and PS/2-type mouse interfaces. They
                                                          are KCLK, KDAT, MCLK, and MDAT. P26 is
KIRQ                                                      inverted and output as KCLK. The KCLK pin is
If "EN FLAGS" has been executed and P24 is set            connected to TEST0. P27 is inverted and output
to a one: the OBF flag is gated onto KIRQ. The            as KDAT. The KDAT pin is connected to P10.
KIRQ signal can be connected to system interrupt          P23 is inverted and output as MCLK. The MCLK
to signify that the FDC37B72x CPU has written to          pin is connected to TEST1. P22 is inverted and
the output data register via "OUT DBB,A". If P24          output as MDAT. The MDAT pin is connected to
is set to a zero, KIRQ is forced low. On power-up,        P11. NOTE: External pull-ups may be required.
after a valid RST pulse has been delivered to the
device, KIRQ is reset to 0. KIRQ will normally            KEYBOARD POWER MANAGEMENT
reflects the status of writes "DBB". (KIRQ is
normally selected as IRQ1 for keyboard support.)          The keyboard provides support for two power-
                                                          saving modes: soft powerdown mode and hard
If "EN FLAGS” has not been executed: KIRQ can             powerdown mode. In soft powerdown mode, the
be controlled by writing to P24. Writing a zero to        clock to the ALU is stopped but the timer/counter
P24 forces KIRQ low; a high forces KIRQ high.             and interrupts are still active. In hard power down
                                                          mode the clock to the 8042 is stopped.
MIRQ
If "EN FLAGS" has been executed and P25 is set            Soft Power Down Mode
to a one:; IBF is inverted and gated onto MIRQ.
The MIRQ signal can be connected to system                This mode is entered by executing a HALT
interrupt to signify that the FDC37B72x CPU has           instruction. The execution of program code is
read the DBB register.                                    halted until either RESET is driven active or a data
                                                          byte is written to the DBBIN register by a master
If "EN FLAGS” has not been executed, MIRQ is              CPU. If this mode is exited using the interrupt,
controlled by P25, Writing a zero to P25 forces           and the IBF interrupt is enabled, then program
MIRQ low, a high forces MIRQ high. (MIRQ is               execution resumes with a CALL to the interrupt
normally selected as IRQ12 for mouse support).            routine, otherwise the next instruction is executed.
                                                          If it is exited using RESET then a normal reset
Gate A20                                                  sequence is initiated and program execution starts
A general purpose P21 is used as a software               from program memory location 0.
controlled Gate A20 or user defined output.
                                                          Hard Power Down Mode
EXTERNAL          KEYBOARD         AND     MOUSE
INTERFACE                                                 Hard Power Down Mode is entered by executing a
                                                          STOP instruction. Disabling the oscillator driver
Industry-standard PC-AT-compatible keyboards              cell stops the oscillator. When either RESET is
employ a two-wire, bidirectional TTL interface for        driven active or a data byte is written to the DBBIN
data transmission. Several sources also supply            register by a master CPU, this mode will be exited
                                                      130


(as above). However, as the oscillator cell will
require an initialization time, either RESET must           Host I/F Data Register
be held active for sufficient time to allow the
oscillator to stabilize. Program execution will             The Input Data and Output Data registers are
resume as above.                                            each 8 bits wide. A write to this 8 bit register will
                                                            load the Keyboard Data Read Buffer, set the OBF
INTERRUPTS                                                  flag and set the KIRQ output if enabled. A read of
                                                            this register will read the data from the Keyboard
The FDC37B72x provides the two 8042 interrupts,             Data or Command Write Buffer and clear the IBF
the IBF and the Timer/Counter Overflow.                     flag. Refer to the KIRQ and Status register
MEMORY CONFIGURATIONS                                       descriptions for more information.
The FDC37B72x provides 2K of on-chip ROM and                Host I/F Status Register
256 bytes of on-chip RAM.
                                                            The Status register is 8 bits wide. Table 58 shows
Register Definitions                                        the    contents       of     the    Status      register.
                                      TABLE 58 - STATUS REGISTER
      D7            D6            D5             D4            D3             D2             D1            D0
      UD            UD            UD             UD            C/D           UD              IBF           OBF
Status Register                                                       cleared.       There is no output pin
                                                                      associated with this internal signal.
This register is cleared on a reset. This register is
read-only for the Host and read/write by the                OBF       (Output Buffer Full) - This flag is set to
FDC37B72x CPU.                                                        whenever the FDC37B72x CPU write to
                                                                      the output data register (DBB). When the
UD        Writable by FDC37B72x CPU.            These                 host system reads the output data
          bits are user-definable.                                    register, this bit is automatically reset.
C/D       (Command Data)-This bit specifies                 EXTERNAL CLOCK SIGNAL
          whether the input data register contains
          data or a command (0 = data, 1 =                  The FDC37B72x Keyboard Controller clock source
          command).            During       a      host     is a 12 MHz clock generated from a 14.318 MHz
          data/command write operation, this bit is         clock. The reset pulse must last for at least 24 16
          set to "1" if SA2 = 1 or reset to "0" if SA2      MHz clock periods. The pulse-width requirement
          = 0.                                              applies to both internally (Vcc POR) and externally
                                                            generated reset signals. In powerdown mode, the
IBF       (Input Buffer Full)- This flag is set to 1        external clock signal is not loaded by the chip.
          whenever the host system writes data
          into the input data register. Setting this        DEFAULT RESET CONDITIONS
          flag activates the FDC37B72x CPU's
          nIBF (MIRQ) interrupt if enabled. When            The FDC37B72x has one source of reset: an
          the FDC37B72x CPU reads the input                 external reset via the RESET_DRV pin. Refer to
          data register (DBB), this bit is                  Table 59 for the effect of each type of reset on the
          automatically reset and the interrupt is          internal registers.
                                              TABLE 59 - RESETS
                             DESCRIPTION                    HARDWARE RESET (RESET)
                                                        131


                           DESCRIPTION                   HARDWARE RESET (RESET)
                 KCLK                                                   Input
                 KDAT                                                   Input
                 MCLK                                                   Input
                 MDAT                                                   Input
                 Host I/F Data Reg                                       N/A
                 Host I/F Status Reg                                     00H
                                             N/A: Not Applicable
GATEA20 AND KEYBOARD RESET                               has been enabled via bit 2 of the KRST_GA20
                                                         Register (Logical Device 7, 0xF0) set to 1.
The FDC37B72x provides two options for
GateA20 and Keyboard Reset: 8042 Software                This register is used to support the alternate
Generated GateA20 and KRESET and Port 92                 reset (nALT_RST) and alternate A20 (ALT_A20)
Fast GateA20 and KRESET.                                 functions.
PORT 92 FAST GATEA20 AND KEYBOARD
RESET                                                                  NAME            PORT 92
                                                                 Location          92h
Port 92 Register                                                 Default Value     24h
This port can only be read or written if Port 92                 Attribute         Read/Write
                                                                 Size              8 bits
                                                     11


                                               Port 92 Register
        Bit    Function
        7:6    Reserved. Returns 00 when read
         5     Reserved. Returns a 1 when read
         4     Reserved. Returns a 0 when read
         3     Reserved. Returns a 0 when read
         2     Reserved. Returns a 1 when read
         1     ALT_A20 Signal control. Writing a 0 to this bit causes the ALT_A20 signal to be
               driven low. Writing a 1 to this bit causes the ALT_A20 signal to be driven high.
         0     Alternate System Reset. This read/write bit provides an alternate system reset
               function. This function provides an alternate means to reset the system CPU to
               effect a mode switch from Protected Virtual Address Mode to the Real Address
               Mode. This provides a faster means of reset than is provided by the Keyboard
               controller. This bit is set to a 0 by a system reset. Writing a 1 to this bit will cause
               the nALT_RST signal to pulse active (low) for a minimum of 1 µs after a delay of
               500 ns. Before another nALT_RST pulse can be generated, this bit must be written
               back to a 0.
                                                  nGATEA20
                                     8042                          System
                                      P21          ALT_A20          nA20M
                                        0              0               0
                                        0              1               1
                                        1              0               1
                                        1              1               1
Bit 0 of Port 92, which generates the nALT_RST             system reset of a write to Port 92. Upon reset,
signal, is used to reset the CPU under program             this signal is driven inactive high (bit 0 in the Port
control. This signal is AND’ed together externally         92 Register is set to 0).
with the reset signal (nKBDRST) from the
keyboard controller to provide a software means            If Port 92 is enabled, i.e., bit 2 of KRST_GA20 is
of resetting the CPU. This provides a faster               set to 1, then a pulse is generated by writing a 1
means of reset than is provided by the keyboard            to bit 0 of the Port 92 Register and this pulse is
controller. Writing a 1 to bit 0 in the Port 92            AND’ed with the pulse generated from the 8042.
Register causes this signal to pulse low for a             This pulse is output on pin KRESET and its
minimum of 6µs, after a delay of a minimum of              polarity is controlled by the GPI/O polarity
14µs. Before another nALT_RST pulse can be                 configuration.
generated, bit 0 must be set to 0 either by a
                                                      133


                                          14us
                                          ~
                                          ~
                                                      6us
                  8042
                              P20
                                                             KRST
                                                                                       KBDRST
                                          KRST_GA20
               P92                           Bit 2
                                                                     nALT_RST
                     Bit 0
                                     Pulse
                                     Gen
               Note: When Port 92 is disabled,        14us
               writes are ignored and reads           ~~
                                                                     6us
               return undefined values.
                                                 KRESET Generation
Bit 1 of Port 92, the ALT_A20 signal, is used to             of A20GATE from the keyboard controller. Upon
force nA20M to the CPU low for support of real               reset, this signal is driven low.
mode compatible software.         This signal is
externally OR’ed with the A20GATE signal from                8042 P17 Functions
the keyboard controller and CPURST to control
the nA20M input of the CPU. Writing a 0 to bit 1             8042 function P17 is implemented as in a true
of the Port 92 Register forces ALT_A20 low.                  8042 part. Reference the 8042 spec for all timing.
ALT_A20 low drives nA20M to the CPU low, if                  A port signal of 0 drives the output to 0. A port
A20GATE from the keyboard controller is also                 signal of 1 causes the port enable signal to drive
low. Writing a 1 to bit 1 of the Port 92 Register            the output to 1 within 20-30nsec. After several (#
forces ALT_A20 high. ALT_A20 high drives                     TBD) clocks, the port enable goes away and the
nA20M to the CPU high, regardless of the state               internal 90µA pull-up maintains the output signal
                                                             as 1.
In 8042 mode, the pins can be programmed as                  mode, the port enables do not come into play. If
open drain. When programmed in open drain                    the port signal is 0 the output will be 0. If the port
                                                       134


signal is 1, the output tristates: an external pull-up         In 8042 mode, the pins cannot be programmed as
can pull the pin high, and the pin can be shared               input nor inverted through the GP configuration
i.e., P17 and nSMI can be externally tied together.            registers.
                                        0ns              250ns                500ns
                                  CLK
                                  AEN
                                 nAEN
                          64=I/O Addr
                                   n64
                                 nIOW
                                    nA
                                  DD1
                                 nDD1
                               nCNTL
                                nIOW'
                            nIOW+n64
                               AfterD1
                              nAfterD1
                          60=I/O Addr
                                   n60
                         nIOW+n60=B
                           nAfterD1+B
                                   D[1]
                                 GA20
                                          Gate A20 Turn-On Sequence Timing
When writing to the command and data port with                 time is only required to be met when using
hardware speedup, the IOW timing shown in the                  hardware speedup; the data must be valid a
figure titled “IOW Timing for Port 92” in the                  minimum of 0 nsec from the leading edge of the
Timing Diagrams Section is used. This setup                    write and held throughout the entire write cycle.
                                                         136


                                     SOFT POWER MANAGEMENT
This chip employs soft power management to                be programmed to always stay off when the AC
allow the chip to enter low power mode and to             power returns if the VTR_POR_OFF bit is
provide a variety of wakeup events to power up            enabled. These bits are located in the Soft Power
the chip. This technique allows for software              Enable Register 2 in Logical Device 8 at 0xB1.
control over powerdown and wakeup events. In
low power mode, the chip runs off of the trickle          The Button input can be used to turn off the power
voltage, VTR. In this mode, the chip is ready to          supply after a debounce delay. The power supply
power up from either the power button or from one         can also be turned off under software control (via a
of a number of wakeup events including pressing a         write to register WDT_CTRL with bit 7 set).
key, touching the mouse or receiving data from
one of the UARTs. The alarm can also be set to            Configuration registers L8-CR_B0 and L8-
power up the system at a predetermined time to            CR_B1 select the wake-up events (SPx). The
perform one or more tasks.                                Configuration registers L8-CR_B2 and L8-
                                                          CR_B3 indict the wake-up event status. The
The implementation of Soft Power Management is            possible wake-events are:
illustrated in Figure 11. A high to low transition on
the Button input or on any of the enabled wakeup              UART1 and UART 2 Ring Indicator Pin
events (SPx) causes the nPowerOn output to go                 Keyboard and Mouse clock Pin
active low which turns on the main power supply.              Group Interrupt 1, Group Interrupt 2
Even if the power supply is completely lost (i.e.,            IRRX2 input pin
VTR is not present) the power supply can still be             UART 1 and UART 2 Receive Data Pin
turned on upon the return of VTR. This is                     nRING pin
accomplished by a VTR power on reset if the                   Power Button input pin
VTR_POR_EN bit is enabled. The chip can also                  VTR_POR
                                                      136


                                                                                                                nBINT
                                         OFF_EN                 Delay2
                                         OFF_DLY                              Logic          nSPOFF1
                         Button                                  nSPOFF
                   L
                                                                       VTR_POR_EN
                                                                           VTR POR
 Button Input                                                            AL_REM_EN        Logic
                                                                               Alarm
                            ED; PG                                                                             OFF_DLY
                                                                                                        Delay1
                                                                                           VTR
               SP1
                            ED; L
                                                                                                  Flip
                          EN1                                                                    Flop 1
                      nSPOFF1
                                                                                                 D                 nPowerOn
                                                                                                     Q
                                                                                                  CLR
                                                                               VTR_POR_OFF                         Open Collector
               SPx                                                                  VTR POR                        Type Output
                           ED; L                                             VBAT POR
                          ENx                                               Soft Power     Logic
                      nSPOFF1                                               Off nSPOFF1
                                                                            VTR POR With
                                                                            Vbat<1.2V
                                                                       Override        PWRBTNOR_STS
                                             PWRBTNOR_EN
                                                                         Timer
 A transition on the Button input, or on any enabled SPx inputs causes the nPowerOn output to go active low.
 A low pulse on the Soft Power Off signal, a Vbat POR, a VTR POR with Vbat<1.2V, or Power Button Override Event causes
 nPowerOn to float.
 ED;PG = Edge Detect, Pulse Generator
 ED;L = Edge Detect and Latch
                FIGURE 5 - SOFT POWER MANAGEMENT FUNCTIONAL DIAGRAM
Note 1: All soft power management functions run off of VTR. When VTR is not present, Vbat supplies
            power to Flip Flop 1.
Note 2: Flip Flop 1 is battery backed-up so that it returns the last valid state of the machine.
Note 3: A battery backed-up enable bit in the alarm control register can be set to force Flip Flop 1 to come
            up ‘off’ after a VTR POR, the VTR_POR_OFF bit. A similar bit can be set to force Flip Flop 1 to
            come up ‘on’ after a VTR POR, the VTR_POR_EN bit. These bits are in the Soft Power Enable
            Register 2 in Logical Device 8 at 0xB1, defined as follows.
            Bit 4 – VTR_POR_OFF
            If VTR_POR_OFF is set, the nPowerOn pin will go inactive (float) and the main power (Vcc) will
            remain off when the VTR POR occurs. The software must not set VTR_POR_OFF and
            VTR_POR_EN at the same time.
            BIT 6 - VTR_POR_EN
            If VTR_POR_EN is set, the nPowerOn pin will go active (low) and the machine will power-up as
            soon as a VTR POR occurs. The software must not set VTR_POR_OFF and VTR_POR_EN at
            the same time.
REGISTERS
                                                                   137


The following registers can be accessed when in           (Configuration Register B2, Logical Device 8)
configuration mode at Logical Device 8,
Registers B0-B3, B8 and F4, and when not in               This register contains the status for the wake-up
configuration they can be accessed through the            events. Note: The status bit gets set if the
Index and Data Register. All soft power                   wakeup event occurs, whether or not it is
management configuration registers are battery            enabled as a wakeup function by setting the
backed up and are reset on Vbat POR.                      corresponding bit in Soft Power Enable Register
                                                          1. However, only the enabled wakeup functions
                                                          will turn on power to the system.
Soft Power Enable Registers
                                                          Soft Power Status Register 2
Soft Power Enable Register 1                              (Configuration Register B3, Logical Device 8)
(Configuration Register B0, Logical Device 8)             This register contains additional status for the
This register contains the enable bits for the            wake-up events. Note: The status bit gets set if
wake-up function of the nPowerOn bit. When                the wakeup event occurs, whether or not it is
enabled, these bits allow their corresponding             enabled as a wakeup function by setting the
function to turn on power to the system.                  corresponding bit in Soft Power Enable Register
                                                          2. However, only the enabled wakeup functions
Soft Power Enable Register 2                              will turn on power to the system.
(Configuration Register B1, Logical Device 8)
This register contains additional enable bits for         Soft Power Control Registers
the wake-up function of the nPowerOn bit. When
enabled, these bits allow their corresponding             WDT_CTRL
function to turn on power to the system. It also          (Configuration Register F4, Logical Device 8)
contains        the        VTR_POR_EN            and      This register is used for soft power management
VTR_POR_OFF bits, as well as the OFF_EN bit,              and watchdog timer control. Bits [7:5] are for soft
which is defined as follows: After power up, this         power management: SPOFF, Restart_Cnt,
bit defaults to 1, i.e., enabled. This bit allows the     Stop_Cnt.
software to enable or disable the button control
of power off.                                             Delay 2 Time Set Register
                                                          (Configuration Register B8, Logical Device 8)
Soft Power Status Registers                               This register is used to set Delay 2 to value from
                                                          500msec to 32sec. The default value is
Soft Power Status Register 1                              500msec.
                                                      138


                                    BUTTON OVERRIDE FEATURE
The power button has an override event as                  override status bit alerts the system upon power-
required by the ACPI specification. If the user            up that an override event was used to power
presses the power button for more than four                down the system, and will be used to properly
seconds while the system is in the working state,          power-up the system.
a hardware event is generated and the system
will transition to the off state. There are status         Figure 11 shows the soft power management
bits and enable bits associated with this feature          logic with the override timer path from the button
in the PM1_BLK registers.           See the ACPI           input. The override timer counts while the button
section.                                                   is held (in the present implementation this would
                                                           be when the button input is high) and is cleared
This override event utilizes power button logic to         upon release of the button. It has a 0.5 second
determine that the power button (Button_In) has            or faster resolution (run off of the 32kHz clock
been pressed for more that four seconds. The               divided down) and the minimum time for
override enable/disable bit, PWRBTNOR_EN,                  triggering the override power down is four
allows this override function to be turned on/off.         seconds, with a maximum of 4.5 seconds. The
If enabled, this override event will result in setting     timer output will pulse the clear on the Flip Flop
the override status bit, PWRBTNOR_STS (to be               1.
cleared by writing a 1 to its bit position - writing a
0 has no effect), clearing the regular button              Figure 12 illustrates the timing of the blanking
status bit, PWRBTN_STS, and generating an                  period relative to Button_In and nPowerOn for
event to be routed into the soft power                     the override event.
management logic to turn off the system. The
                                                       139


      Button_In
                        4+      sec        Release
     nPowerOn
                     4 sec
Blanking Period
                                              4 sec
            Vcc
                FIGURE 6 - BLANKING PERIOD
                             140


                                       ACPI/PME/SMI FEATURES
ACPI FEATURES                                           Power Button With Override
The FDC37B72x supports ACPI as described in             The power button has a status and and enable
this section. These features comply with the            bit in the PM1_BLK of registers to provide an SCI
ACPI Specification, Revision 1.0.                       upon the button press. The power button can
                                                        also turn the system on and off through the soft
Legacy/ACPI Select Capability                           power management logic. The power button
                                                        also has an override event as required by the
This capability consists of an SMI/SCI switch           ACPI specification.         See The Soft Power
which is required in a system that supports both        Management Section. This override event is
legacy and ACPI power management models.                described as follows: If the user presses the
This is due to the fact that the system software        power button for more than 4 seconds while the
for legacy power management consists of the             system is in the working state, a hardware event
SMI interrupt handler while for ACPI it consists of     is generated and the system will transition to the
the ACPI driver (SCI interrupt handler). This           off state. There are status and enable bits
support uses Logical Device A at 0x0A to hold           associated with this feature in the PM1_BLK
the address pointers to the ACPI power                  registers.
management register block, PM1_BLK, which
consists of run-time registers. Included in the         General Purpose ACPI Events
PM1_BLK is an enable bit, SCI_EN, to allow the
SCI interrupt to be generated upon an enabled           The General Purpose ACPI events are enabled
SCI event. This SCI interrupt can be switched           through the SCI_EN1 bit in the GPE_EN register.
out to the nPME/SCI pin or routed to one of the         This bit, if set, allows any of the enabled PME
parallel interrupts. The polarity and output type       events to generate an SCI. In addition, if the
(open collector or push-pull) of the SCI is             DEVINT_EN bit in the PME_EN 1 Register is set,
selected through the IRQ MUX Register.                  and if the EN_SMI_PME bit in the SMI_EN 2
                                                        register is set, then any of the SMI Events can
The software power management events (those             also generate an SCI. See the SCI/PME and
that generate an SMI in legacy mode and an SCI          SMI/PME logic diagrams below.
in ACPI mode) are controlled by the EN_SMI and
SCI_EN bits. The SCI enable bit, SCI_EN, is             Device Sleep States
located in the PM1_CNTRL register, bit 0. This
bit is used in conjunction with EN_SMI, bit 7 of        Each device in the FDC37B72x supports two
the SMI enable register 2, to enable either SCI or      device sleep states, D0 (on) and D3 (off). With
SMI (or both). For legacy power management,             all devices off, the part is powered either by main
the EN_SMI bit is used; if set, it routes the power     power (Vcc) or standby power (Vtr), depending
management events to the SMI interrupt logic.           on the system sleep state. In both cases, the
For ACPI power management, the SCI_EN bit is            part can provide wakeup capability through the
used; if set, it routes the power management            soft power management logic and generate a
events to the SCI interrupt logic.                      nPME or nSCI. In an ACPI system, the devices
                                                        are powered on and off through control methods.
                                                    141


Wake Events                                              nPME events as shown in the following table. In
                                                         addition, these wake events set the WAK_STS
Wake events are events that turn power on                bit if enabled (see ACPI PM1_STS2 Register
(activate nPowerOn output) if enabled. These             description).
events can also be enabled as SMI, SCI and
                                                       INPUT TO SOFT POWER                SMI/SCI/PME
                  WAKE EVENTS                                MANAGEMENT                  GENERATION
   PINS        KDAT                                   KDAT                           SMI/SCI/PME
               MDAT                                   MDAT                           SMI/SCI/PME
               IRRX2                                  IRRX2                          SMI/SCI/PME
               RXD2/IRRX                              RXD2/IRRX                      SMI/SCI/PME
               RXD1                                   RXD1                           SMI/SCI1/PME1
               nRI1                                   nRI1                           SMI/SCI/PME
               nRI2                                   nRI2                           SMI/SCI/PME
               nRING                                  nRING                          SMI/SCI/PME
               Button                                 Button                         SMI/SCI2/PME1
               GP10-173                               GPINT1                         SMI/SCI1/PME
               GP50-54, GP60-67                       GPINT2                         SMI/SCI1/PME1
 INTERNA       VTR POR                                VTR POR                        SCI
      L
 SIGNALS
Note 1: These SCI/PME events are SMI events that are enabled through DEVINT_EN.
Note 2: These SCI events have Status and Enable bits in the PM1 registers.
Note 3: The polarity of the edge that causes the event is programmable through the polarity bit in the
         GPIO configuration registers. The default is the low-to-high edge.
The following are SMI events that are not wake events:
•     Floppy Interrupt
•     Parallel Port Interrupt
•     WDT
•     P12
Any wakeup logic that affects the configuration of the wakeup events is implemented so that the
configuration of the wakeup events is retained (in the event of total power loss) upon Vtr POR.
                                                    142


PME SUPPORT                                             Logical Device A in the configuration section
                                                        contains the address pointer to the ACPI power
The FDC37B72x offers support for PCI power              management register block, and PM1_BLK.
management events (PMEs).               A power         These are run-time registers; Included in the
management event is requested by a PCI function         PM1_BLK is an enable bit to allow the SCI group
via the assertion of the nPME signal. The               interrupt to be routed to any interrupt or onto the
assertion and deassertion of nPME is                    nPME/SCI pin. Note: See IRQ mux control
asynchronous to the PCI clock.              In the      register for SCI/PME/SMI selection function and
FDC37B72x, active transitions on the ring indicator     pin configuration bits.
inputs nRI1 and nRI2 or the nRING pin, active
keyboard-data edges, active mouse-data edges            Register Description
and GPIOs GP10-GP17 can directly assert the
nPME signal. In addition, if the DEVINT_EN bit in       The ACPI register model consists of a number of
the PME_EN 1 Register is set, and if the                fixed register blocks that perform designated
EN_SMI_PME bit in the SMI_EN 2 register is set,         functions. A register block consists of a number
then any of the SMI Events can also generate a          of registers that perform Status, Enable and
nPME. See the SCI/PME and SMI/PME logic                 Control functions. The ACPI specification deals
diagrams below.                                         with events (which have an associated interrupt
                                                        status and enable bits, and sometimes an
nPME functionality is controlled by the runtime         associated control function) and control features.
registers      at    <PM1_BLK>+Ch          through      The status registers illustrate what defined
<PM1_BLK>+11h.           The PME Enable bit,            function is requesting ACPI interrupt services
PME_EN, globally controls PME Wake-up                   (SCI). Any status bit in the ACPI specification
events. When PME_EN is inactive, the nPME               has the following attributes:
signal can not be asserted. When PME_EN is              A.        Status bits are only set through some
asserted, any wake source whose individual                        defined “hardware event.”
PME Wake Enable register bit is asserted can            B.        Unless otherwise noted, Status bits are
cause nPME to become asserted. The PME                            cleared by writing a “HIGH” to that bit
Wake Status register indicates which wake                         position, and upon VTR POR. Writing a
source has asserted the nPME signal. The PME                      0 has no effect.
Status bit, PME_STS, is asserted by active              C.        Status bits only generate interrupts
transitions of PME Wake sources. PME_STS will                     while their associated bit in the enable
become asserted independent of the state of the                   register is set.
global PME enable, PME_EN.                              D.        Function bit positions in the status
                                                                  register have the same bit position in
In the FDC37B72x the nPME pin is an open                          the    enable     register    (there   are
drain, active low, driver. The FDC37B72x nPME                     exceptions to this rule, special status
pin is fully isolated from other external devices                 bits have no enables).
that might pull the PCI nPME signal low; i.e., the
PCI nPME signal is capable of being driven high         Note that this implies that if the respective enable
externally by another active device or pullup           bit is reset and the hardware event occurs, the
even when the the FDC37B72x VDD is                      respective status bit is set, however no interrupt
grounded, providing VTR power is active. The            is generated until the enable bit is set. This
FDC37B72x nPME driver sinks 6mA at .55V max             allows software to test the state of the event (by
(see section 4.2.1.1 DC Specifications, page            examining the status bit) without necessarily
122, in the PCI Local Bus Specification, Revision       generating an interrupt. There are a special class
2.1).                                                   of status bits that have no respective enable bit,
ACPI, PME AND SMI REGISTERS                             these are called out specifically, and the
                                                    143


respective enable bit in the enable register is        of the registers contained in these blocks. All of
marked as reserved for these special cases.            these registers are powered by VTR and battery
                                                       backed-up and are reset on Vbat POR.
The enable registers allow the setting of the
status bit to generate an interrupt. As a general      Wakeup Event Configuration is Retained by
rule there is an enable bit in the enable register     Battery Power
for every status bit in the status register. The
control register provides special controls for the     To preserve the configuration of the wakeup
associated event, or special control features that     functions that were programmed prior to the loss
are not associated with an interrupt event. The        of Vtr upon its return, the soft power
ordering of a register block is the status             management registers, PME, SCI, SMI registers
registers, followed by enable registers, followed      and GPIO registers are all powered by the
by control registers.                                  battery. These registers are reset to their default
                                                       values only on Vbat POR. These registers are
Table 60 and 61 list the PM1/GPE and                   described in the sections below.
PME/SMI/MSC register blocks and the locations
                                                   144


Register Block
The registers in this block are powered by VTR and battery backed up.
                                TABLE 60 - PM1/GPE REGISTER BLOCK
                          REGISTER           SIZE             ADDRESS
                     PM1_STS 1              8        <PM1_BLK>
                     PM1_STS 2              8        <PM1_BLK>+1h
                     PM1_EN 1               8        <PM1_BLK>+2h
                     PM1_EN 2               8        <PM1_BLK>+3h
                     PM1_CNTRL 1            8        <PM1_BLK>+4h
                     PM1_CNTRL 2            8        <PM1_BLK>+5h
                     Reserved               8        <PM1_BLK>+6h
                     Reserved               8        <PM1_BLK>+7h
                     GPE_STS 1              8        <PM1_BLK>+8h
                     GPE_EN 1               8        <PM1_BLK>+9h
                     Reserved               8        <PM1_BLK>+Ah
                     Reserved               8        <PM1_BLK>+Bh
                             TABLE 61 - PME/SMI/MSC REGISTER BLOCK
                          REGISTER           SIZE             ADDRESS
                     PME_STS 1              8        < PM1_BLK>+Ch
                     PME_STS 2              8        < PM1_BLK>+Dh
                     PME_EN 1               8        < PM1_BLK>+Eh
                     PME_EN 2               8        < PM1_BLK>+Fh
                     PME_STS                8        < PM1_BLK>+10h
                     PME_EN                 8        < PM1_BLK>+11h
                     SMI_STS 1              8        < PM1_BLK>+12h
                     SMI_STS 2              8        < PM1_BLK>+13h
                     SMI_EN 1               8        < PM1_BLK>+14h
                     SMI_EN 2               8        < PM1_BLK>+15h
                     MSC_STS                8        < PM1_BLK>+16h
                     Reserved               8        < PM1_BLK>+17h
Table 62 shows the block size and range of base addresses for each block.
                              TABLE 62 - REGISTER BLOCK ATTRIBUTES
                  BLOCK NAME              BLOCK SIZE             BASE ADDRESS
                                                                      RANGE
                     PM1_BLK                24-bytes                   0-FFF
                                                  145


ACPI Registers
In the FDC37B72x, the PME wakeup events can be enabled as SCI events through the SCI_STS1 and
SCI_EN1 bits in the GPE status and enable registers. See PME Interface and SMI/PME/SCI logic
sections.
Power Management 1 Status Register 1 (PM1_STS 1)
Register Location:           <PM1_BLK> System I/O Space
Default Value:               00h on Vbat POR
Attribute:                  Read/Write (Note 0)
Size:                       8-bits
  BIT              NAME                                DESCRIPTION
0-7        Reserved                  Reserved. These bits always return a value of zero.
Note 1: This bit is set by hardware and can only be cleared by software writing a one to this bit position
           and by Vbat POR. Writing a 0 has no effect.
                                                  146


Power Management 1 Status Register 2 (PM1_STS 2)
Register Location:           <PM1_BLK>+1h System I/O Space
Default Value:               00h on Vbat POR
Attribute:                   Read/Write (Note 0)
Size:                        8-bits
  BIT               NAME                                        DESCRIPTION
0           PWRBTN_STS               This bit is set when the Button_In signal is asserted. In the
                                     system working state, while PWRBTN_EN and PWRBTN_STS
                                     are both set an SCI interrupt event is raised. In the sleeping or
                                     soft off state, a wake-up event is generated (regardless of the
                                     setting of PWRBTN_EN) (Note 2). This bit is only set by
                                     hardware and is reset by software writing a one to this bit
                                     position, and by Vbat POR. Writing a 0 has no effect. It is also
                                     reset as follows: If PWRBTNOR_EN is set, and if the
                                     Button_In signal is held asserted for more than four seconds,
                                     then this bit is cleared, the PWRBTNOR_STS bit is set and the
                                     system will transition into the soft off state (nPowerOn floats).
1           Reserved                 Reserved.
2           Reserved                 Reserved
3           PWRBTNOR_STS             This bit is set when the power switch over-ride function is set: If
                                     PWRBTNOR_EN is set, and if the Button_In signal is held
                                     asserted for more than four seconds. Hardware is also
                                     required to reset the PWRBTN_STS when issuing a power
                                     switch over-ride function. (Note 1)
4-6         Reserved                 Reserved. These bits always return a value of zero.
7           WAK_STS                  This bit is set when the system is in the sleeping state and an
                                     enabled wakeup event occurs. This bit is set on the high-to-low
                                     transition of nPowerOn, if the WAK_CTRL bit in the sleep /
                                     wake configuration register (0xF0 in Logical Device A) is
                                     cleared. If the WAK_CTRL bit is set, then any enabled wakeup
                                     event will also set the WAK_STS bit in addition to the high-to-
                                     low transition of nPowerOn. It is cleared by writing a 1 to its bit
                                     location when nPowerOn is active (low). Upon setting this bit,
                                     the system will transition to the working state. (Note 1)
Note 1: This bit is set by hardware and can only be cleared by software writing a one to this bit position
and by Vbat POR. Writing a 0 has no effect.
Nore 2: In the present implementation of Button_In, pressing the button will always wake the machine
(i.e., activate nPowerOn).
                                                      147


Power Management 1 Enable Register 1 (PM1_EN 1)
Register Location:     <PM1_BLK>+2 System I/O Space
Default Value:         00h on Vbat POR
Attribute:             Read/Write (Note 0)
Size:                  8-bits
  BIT             NAME                              DESCRIPTION
0-7        Reserved            Reserved. These bits always return a value of zero.
Power Management 1 Enable Register 2 (PM1_EN 2)
Register Location:     <PM1_BLK>+3 System I/O Space
Default Value:         00h on Vbat POR
Attribute:             Read/Write (Note 0)
Size:                  8-bits
  BIT             NAME                                  DESCRIPTION
0          PWRBTN_EN           This bit is used to enable the assertion of the Button_In to
                               generate an SCI event. The PWRBTN_STS bit is set anytime
                               the Button_In signal is asserted. The enable bit does not
                               have to be set to enable the setting of the PWRBTN_STS bit
                               by the assertion of the Button_In signal.
1-7        Reserved            Reserved. These bits always return a value of zero.
Power Management 1 Control Register 1 (PM1_CNTRL 1)
Register Location:     <PM1_BLK>+4 System I/O Space
Default Value:         00h on Vbat POR
Attribute:             Read/Write (Note 0)
Size:                  8-bits
  BIT             NAME                                  DESCRIPTION
0          SCI_EN              When this bit is set, then the enabled SCI power management
                               events generate an SCI interrupt. When this bit is reset power
                               management events do not generate an SCI interrupt.
1-7        Reserved            Reserved. These bits always return a value of zero.
                                              148


Power Management 1 Control Register 2 (PM1_CNTRL 2)
Register Location:           <PM1_BLK>+5 System I/O Space
Default Value:               00h on Vbat POR
Attribute:                   Read/Write (Note 0)
Size:                        8-bits
BIT           NAME                                            DESCRIPTION
0       Reserved               Reserved. This field always returns zero.
1       PWRBTNOR_EN            This bit controls the power button over-ride function. When set, then
                               anytime the Button_In signal is asserted for more than four seconds
                               the system will transition to the off state. When a power button over-
                               ride event occurs, the logic clears the PWRBTN_STS bit, and sets
                               the PWRBTNOR_STS bit.
2-4     SLP_TYPx               This 3-bit field defines the type of hardware sleep state the system
                               enters when the SLP_EN bit is set to one. When this field is 000 the
                               FDC37B72x will transition the machine to the off state when the
                               SLP_EN bit is set to one. That is, with this field set to 000, nPowerOn
                               will go inactive (float) after a 1-2 clock delay when SLP_EN is set.
                               This delay is a minimum of one 32kHz clock and a maximum of two
                               32kHz clocks (31.25μsec-62.5μsec). When this field is any other
                               value, there is no effect.
5       SLP_EN                 This is a write-only bit and reads to it always return a zero. Writing ‘1’
                               to this bit causes the system to sequence into the sleeping state
                               associated with the SLP_TYPx fields after a 1-2 clock delay, if the
                               SLP_CTRL bit in the sleep / wake configuration register (0xF0 in
                               Logical Device A) is cleared. If the SLP_CTRL bit is set, do not
                               sequence into the sleeping state associated with the SLP_TYPx field,
                               but generate an SMI. Note: the SLP_EN_SMI bit in the SMI Status
                               Register 2 is always set upon writing ‘1’ to the SLP_EN bit. Writing ‘0’
                               to this bit has no effect.
6-7     Reserved               Reserved. This field always returns zero.
General Purpose Event Status Register 1 (GPE_STS1)
Register Location:           <PM1_BLK>+8 System I/O Space
Default Value:               00h on Vbat POR
Attribute:                   Read/Write (Note 0)
Size:                        8-bits
BIT           NAME                                            DESCRIPTION
0       SCI_STS1               This bit is set when the device power management events (PME
                               events) occur. When enabled, the setting of this bit will generate an
                               SCI interrupt. (Note 1)
1-7     Reserved               Reserved. These bits always return a value of zero.
Note 1: This bit is set by hardware and can only be cleared by software writing a one to this bit position
and by Vbat POR. Writing a 0 has no effect.
                                                      149


General Purpose Event Enable Register 1 (GPE_EN1)
Register Location:           <PM1_BLK>+9 System I/O Space
Default Value:               00h on Vbat POR
Attribute:                   Read/Write (Note 0)
Size:                        8-bits
BIT             NAME                                          DESCRIPTION
0       SCI_EN1                When this bit is set, then the enabled device power management events
                               (PME events) will generate an SCI interrupt. When this bit is reset,
                               device power management events will not generate an SCI interrupt.
1-7     Reserved               Reserved. These bits always return a value of zero.
Note 0: all bits described as "reserved" in writeable registers must be written with the value 0 when the
register is written.
PME Registers
The power management event function has a PME_Status bit and a PME_En bit. These bits are
defined in the PCI Bus Power Management Interface Specification, Revision 1.0, Draft, Copyright ©
1997, PCI Special Interest Group, Mar. 18, 1997.
The default states for the PME_Status and PME_En bits are controlled by Vbat Power-On-Reset.
PME Status Register (PME_STS)
Register Location:           <PM1_BLK>+10h System I/O Space
Default Value:               00h on Vbat POR
Attribute:                   Read/Write (Note 0)
Size:                        8-bits
            D7       D6    D5       D4     D3       D2      D1          D0           DEFAULT
                               RESERVED                             PME_Status          0x00
•    The PME_Status bit is set when the FDC37B72x would normally assert the PCI nPME signal,
     independent of the state of the PME_En bit. Only active transitions on the PME Wake sources can
     set the PME_Status bit.
•    The PME_Status bit is read/write-clear. Writing a “1” to the PME_Status bit will clear it and cause
     the FDC37B72x to stop asserting the nPME, if enabled.
•    Writing a “0” has no effect on the PME_Status bit.
•    The PME_Status bit is reset to “0” during VBAT Power-On-Reset.
                                                     150


PME Enable Register (PME_EN)
Register Location:          <PM1_BLK>+11h System I/O Space
Default Value:              00h on Vbat POR
Attribute:                  Read/Write (Note 0)
Size:                       8-bits
         D7       D6        D5        D4         D3        D2         D1         D0       DEFAULT
                                 RESERVED                                      PME_En       0x00
•    Setting the PME_En bit to “1” enables the FDC37B72x to assert the nPME signal.
•    When the PME_En bit is reset to “0”, nPME signal assertion is disabled.
•    The PME_En bit is reset to “0” during VBAT Power-On-Reset.
PME Status Register 1 (PME_STS 1)
Register Location:          <PM1_BLK>+Ch System I/O Space
Default Value:              00h on Vbat POR
Attribute:                  Read/Write (Note 0)
Size:                       8-bits
     D7              D6           D5          D4         D3        D2      D1        D0        DEFAULT
DEVINT_ST        Reserved       nRING       MOUSE       KBD       RI1      RI2    Reserved         0x00
      S
PME Status Register 2 (PME_STS2)
Register Location:          <PM1_BLK>+Dh System I/O Space
Default Value:              00h on Vbat POR
Attribute:                  Read/Write (Note 0)
Size:                       8-bits
    D7          D6          D5          D4          D3           D2         D1        D0      DEFAULT
  GP17         GP16       GP15         GP14        GP13        GP12        GP11      GP10         0x00
•    The PME Status registers indicate the state of the individual FDC37B72x PME wake sources,
     independent of the state of the individual source enables or the PME_En bit.
•    If the wake source has asserted a wake event, the associated PME Status bit will be “1”. The wake
     source bits in the PME Status registers are read/write-clear: an active (“1”) PME Status bit can only
     be cleared by writing a “1” to the bit. Writing a “0” to bits in the PME Wake Status register has no
     effect.
PME Enable Register 1 (PME_EN1)
Register Location:          <PM1_BLK>+Eh System I/O Space
Default Value:              00h on Vbat POR
Attribute:                  Read/Write (Note 0)
Size:                       8-bits
         D7            D6          D5          D4          D3        D2     D1        D0       DEFAUL
                                                                                                    T
  DEVINT_EN        Reserved      nRING       MOUSE        KBD       RI1     RI2    Reserved       0x00
                                                    151


PME Enable Register 2 (PME_EN2)
Register Location:            <PM1_BLK>+Fh System I/O Space
Default Value:                00h on Vbat POR
Attribute:                    Read/Write (Note 0)
Size:                         8-bits
       D7          D6          D5           D4          D3         D2         D1         D0  DEFAULT
      GP17       GP16        GP15         GP14        GP13        GP12       GP11       GP10   0x00
•    The PME Enable registers enable the individual FDC37B72x wake sources onto the nPME bus.
•    When the PME Enable register bit for a wake source is active (“1”), if the source asserts a wake
     event and the PME_En bit is “1”, the source will assert the PCI nPME signal.
•    When the PME Enable register bit for a wake source is inactive (“0”), the PME Status register will
     indicate the state of the wake source but will not assert the PCI nPME signal.
SMI Registers
The FDC37B72x implements a group nSMI output pin. The nSMI group interrupt output consists of the
enabled interrupts from each of the functional blocks in the chip plus other SMI events. The interrupts
are enabled onto the group nSMI output via the SMI Enable Registers 1 and 2. The nSMI output is then
enabled onto the group nSMI output pin via bit[7] in the SMI Enable Register 2. These SMI events can
also be enabled as nPME/SCI events by setting the EN_SMI_PME bit, bit[6] of SMI Enable Register 2.
This register is also used to enable the group nSMI output onto the nSMI Serial/Parallel IRQ pin and the
routing of 8042 P12 internally to nSMI.
SMI Status Register 1 (SMI_STS1)
Register Location:            <PM1_BLK>+12h System I/O Space
Default Value:                00h on Vbat POR
Attribute:                    Read/Write
Size:                         8-bits
         NAME                                       DESCRIPTION
SMI Status Register 1       This register is used to read the status of the SMI inputs.
Default = 0x00              The following bits must be cleared at their source.
on Vbat POR                 Bit[0] Reserved
                            Bit[1] PINT (Parallel Port Interrupt)
                            Bit[2] U2INT (UART 2 Interrupt)
                            Bit[3] U1INT (UART 1 Interrupt)
                            Bit[4] FINT (Floppy Disk Controller Interrupt)
                            Bit[5] GPINT2 (Group Interrupt 2)
                            Bit[6] GPINT1 (Group Interrupt 1)
                            Bit[7] WDT (Watch Dog Timer)
                                                        152


SMI Status Register 2 (SMI_STS2)
Register Location:       <PM1_BLK>+13h System I/O Space
Default Value:           00h on Vbat POR
Attribute:               Read/Write
Size:                     8-bits
         NAME                                            DESCRIPTION
SMI Status Register 2  This register is used to read the status of the SMI inputs.
                       Bit[0] MINT: Mouse Interrupt. Cleared at source.
Default = 0x00         Bit[1] KINT: Keyboard Interrupt. Cleared at source.
on Vbat POR            Bit[2] IRINT: This bit is set by a transition on the IR pin (RXD2 or IRRX2 as
                       selected by Bit 6 of Configuration Register 0xF1 in Logical Device 5, i.e.,
                       after the MUX). Cleared by a read of this register.
                       Bit[3] BINT: Cleared by a read of this register.
                       Bit[4] P12: 8042 P1.2. Cleared at source
                       Bits[5:6] Reserved
                       Bit[7] SLP_EN_SMI. The SLP_EN SMI status bit. Cleared by a read of this
                       register. (See Sleep Enable Config Reg.)
                       0=no SMI due to setting SLP_EN bit
                       1=SMI generated due to setting SLP_EN bit.
SMI Enable Register 1 (SMI_EN1)
Register Location:       < PM1_BLK >+14h System I/O Space
Default Value:           00h on Vbat POR
Attribute:               Read/Write
Size:                     8-bits
         NAME                                            DESCRIPTION
SMI Enable Register 1   This register is used to enable the different interrupt sources onto the group
                        nSMI output.
Default = 0x00          1=Enable
on Vbat POR             0=Disable
                        Bit[0] EN_RING
                        Note: the PME status bit for RING is used as the SMI status bit for RING
                        (see PME Status Register).
                        Bit[1] EN_PINT
                        Bit[2] EN_U2INT
                        Bit[3] EN_U1INT
                        Bit[4] EN_FINT
                        Bit[5] EN_GPINT2
                        Bit[6] EN_GPINT1
                        Bit[7] EN_WDT
                                                    153


SMI Enable Register 2 (SMI_EN2)
Register Location:        < PM1_BLK >+15h System I/O Space
Default Value:            00h on Vbat POR
Attribute:                Read/Write
Size:                     8-bits
       NAME                                          DESCRIPTION
SMI Enable         This register is used to enable the different interrupt sources onto the group
Register 2         nSMI output, and the group nSMI output onto the nSMI GPI/O pin.
                   Unless otherwise noted,
Default = 0x00     1=Enable
on Vbat POR        0=Disable
                   Bit[0] EN_MINT
                   Bit[1] EN_KINT
                   Bit[2] EN_IRINT
                   Bit[3] EN_BINT
                   Bit[4] EN_P12: Enable 8042 P1.2 to route internally to nSMI
                   0=Do not route to nSMI
                   1=Enable routing to nSMI.
                   Bit[5] Reserved
                   Bit[6] EN_SMI_PME: Enable the group nSMI output into the PME interface
                   logic.
                   0= Group SMI output does not go to PME interface logic
                   1= Enable group SMI output to PME interface logic
                   Bit[7] EN_SMI: Enable the group nSMI output onto the nSMI pin or Serial IRQ
                   frame (IRQ2).
                   0=SMI pin floats
                   1=Enable group nSMI output onto nSMI pin or serial IRQ frame
                   Note: the selection of either the nSMI pin or serial IRQ frame is done via bit 7
                   of the IRQ Mux Control Register (0xC0 in Logical Device 8).
                                                 154


Either Edge Triggered Interrupts                           function is selected for the GPIO pin, then the
                                                           bits that control input/output, polarity and open
Four GPIO pins are implemented that allow an               collector/push-pull have no effect on the function
interrupt to be generated on both a high-to-low            of the pin. However, the polarity bit does affect
and a low-to-high edge transition, instead of one          the value of the GP bit (i.e., register GP1, bit 2
or the other as selected by the polarity bit.              for GP12).
The either edge triggered interrupts function as           An interrupt occurs if the status bit is set and the
follows: Selecting the Either Edge Triggered               interrupt is enabled. The status bits indicate
Interrupt (EETI) function for these GPIO pins is           which of the EETI interrupts transitioned. These
applicable when the combined interrupt is                  status bits are located in the MSC_STS register.
enabled for the GPIO pin (GPINT1 for GP11 and              The status is valid whether or not the interrupt is
GP12, and GPINT2 for GP53 and GP54).                       enabled and whether or not the EETI function is
Otherwise, selection of the EETI function will             selected for the pin.
produce no function for the pin. If the EETI
Miscellaneous Status Register
The MSC_STS register is implemented as follows to hold the status bits of these four GPIOs.
Miscellaneous Status Register (PM1_STS)
Register Location:          <PM1_BLK>+16h System I/O Space
Default Value:              00h on Vbat POR
Attribute:                  Read/Write (Note 0)
Size:                       8-bits
    BIT             NAME                                           DEFINITION
0            EETI1_STS             Either Edge Triggered Interrupt Input 1 Status. This bit is set when
                                   an edge occurs on the GP11 pin. This bit is cleared by writing a 1 to
                                   this bit position (writing a 0 has no effect).
1            EETI2_STS             Either Edge Triggered Interrupt Input 2 Status. This bit is set when
                                   an edge occurs on the GP12 pin. This bit is cleared by writing a 1 to
                                   this bit position (writing a 0 has no effect).
2            EETI3_STS             Either Edge Triggered Interrupt Input 3 Status. This bit is set when
                                   an edge occurs on the GP53 pin. This bit is cleared by writing a 1 to
                                   this bit position (writing a 0 has no effect).
3            EETI4_STS             Either Edge Triggered Interrupt Input 4 Status. This bit is set when
                                   an edge occurs on the GP54 pin. This bit is cleared by writing a 1 to
                                   this bit position (writing a 0 has no effect).
4            VTRPOR_STS            This bit is set upon VTR POR. This bit is cleared by writing a 1 to
                                   this bit position (writing a 0 has no effect). Additionally, when the
                                   system turns on (nPowerOn active low) due to a VTR POR, then an
                                   SCI is generated.
5-7          Reserved              Reserved. This bit always returns zero.
                                                      155


SMI/PME/SCI Logic
The logic for the SMI, PME and SCI signals is shown in the figures that follow.
                                                                                       PME_EN                   PME_STS
                                                                                       Registers                Registers
                                                                                    PME_EN1 Register        PME_STS1 Register
                                                                                                                    RI2              From
                                                                                          EN_RI2
                                                                                                                    RI1            SMI/PME
                                                                                          EN_RI1                                    Device
                                                                                                                    KBD
                        MUX                                                               EN_KBD                                   Interrupt
                              nPME                                                                                  MOUSE            Block
        nPME              00                                                              EN_MOUSE
            pin           0 1 nSCI
                                                                                                                    RING
                                                                                          EN_RING
                          1 0 IRQ9                                                                                   DEV_INT
                                                   PME_STS                                EN_DEVINT
                   Bit[6]
         Bits[6:5]
                             Bit[5]                                                 PME_EN2 Register        PME_STS2 Register
          of IRQ
       Mux Control                                                                                                   GP10
        Register                                                                          EN_GP10
                                                   PME_EN                                                            GP11
                                                                                          EN_GP11
                                                                                                                     GP12
        nSCI                                                             GPE_STS
                                                                                          EN_GP12
                                                                                                                     GP13
       on IRQx                                                           Register         EN_GP13
                                                                                                                     GP14
          pin                                                                             EN_GP14
                                                                GPE_EN                                               GP15
                                                                                          EN_GP15
                                                                Register SCI_STS1                                    GP16
                                                                        GPE_STS.0         EN_GP16
                                                                                                                     GP17
                                                                                          EN_GP17
        nSCI                                                    SCI_EN1
       on Serial                                                GPE_EN.0
         IRQx                                                                                     PM1_BLK
                                                      SCI_EN
                                    Bit[2] of IRQ Mux
                                                                                                                     PWRBTN_STS
                                    Control Register                                      PWRBTN_EN
                                       nPowerOn
                                                                                            Key to Symbols
                         WAK_STS
                                                                                                 Enable bit
                                                                                                 Sticky Status bit: Cleared by software
                                                  WAK_CTRL                                       writing a ‘1’ to its bit location
                                                           FIGURE 7 - PME/SCI LOGIC
                                                                             156


                                                          SMI_EN            SMI_STS
                                                         Registers          Registers
                                                                                                         EVENT
                                                    SMI_EN1 Register     SMI_STS1 Register      RING Bit, PME_STS1 Register
                                                                                                         nRING
                                                             EN_RING           PINT
                                                                                                         PINT
                                                             EN_PINT           U2INT
                                                                                                         U2INT
                                                             EN_U2INT          U1INT
                                                                                                         U1INT
                                                             EN_U1INT          FINT
                                                                                                         FINT
                                                             EN_FINT           GPINT2
                                                                                                         GPINT2
                                                             EN_GPINT2         GPINT1
                                                                                                         GPINT1
                     Group                                   EN_GPINT1         WDT
                                                                                                         WDT
                        SMI                                  EN_WDT
   nSMI                                            SMI_EN2 Register      SMI_STS2 Register
  out to pin                                                                   MINT
  or Serial   EN_SMI                                         EN_MINT
                                                                                                         MINT
                                                                               KINT
    IRQ2          Bit 7                                                                                  KINT
              of SMI_EN2                                     EN_KINT           IRINT
                                                                                                         IRINT
               Register                                      EN_IRINT          BINT
                                                                                                         BINT
                                                             EN_BINT           P12
                                                                                                         P12
                                                             EN_P12
DEV_INT
                                                                               SLP_EN_SMI
 to nPME                                                                                                 SLP_EN
 Interface   EN_SMI_PME
   Logic           Bit 6 of
              SMI_EN2 Register                         SLP_CTRL
                                               Bit 0 of the Sleep Enable
                                                Configuration Register          Key to Symbols
                                               0xF0 of Logical Device A.
                                                                                     Enable bit
                                                                                     Interrupt Status bit: Cleared at
                                                                                     source
                                                                                     Interrupt Status bit: Cleared by
                                                                                     a read of register
                                                                                     Sticky Status bit: Cleared by a
                                                                                     write of ‘1’ to this bit
                               FIGURE 8 - SMI/PME LOGIC
                                   CONFIGURATION
                                           157


The Configuration of the FDC37B72x is very                at POST. The INDEX and DATA ports are only
flexible and is based on the configuration                valid when the FDC37B72x is in Configuration
architecture implemented in typical Plug-and-Play         Mode.
components. The FDC37B72x is designed for
motherboard applications in which the resources           The SYSOPT pin is latched on the falling edge of
required by their components are known. With its          the RESET_DRV or on Vcc Power On Reset to
flexible resource allocation architecture, the            determine the configuration register's base
FDC37B72x allows the BIOS to assign resources             address. The SYSOPT pin is used to select the
at POST.                                                  CONFIG PORT's I/O address at power-up. Once
                                                          powered up the configuration port base address
SYSTEM ELEMENTS                                           can be changed through configuration registers
                                                          CR26 and CR27. The SYSOPT pin is a
Primary Configuration Address Decoder                     hardware configuration pin which is shared
                                                          with the nRTS1 signal on pin 115. During reset
After a hard reset (RESET_DRV pin asserted) or            this pin is a weak active low signal which sinks
Vcc Power On Reset the FDC37B72x is in the                30µA. Note: All I/O addresses are qualified with
Run Mode with all logical devices disabled. The           AEN.
logical devices may be configured through two
standard Configuration I/O Ports (INDEX and               The INDEX and DATA ports are effective only
DATA)      by    placing      the FDC37B72x into          when the chip is in the Configuration State.
Configuration Mode.        The BIOS uses these
configuration ports to initialize the logical devices
                                            SYSOPT= 0
           PORT NAME                    (Pull-down resistor)            SYSOPT= 1              TYPE
                                          Refer to Note 1          (10K Pull-up resistor)
    CONFIG PORT (Note 2)            0x03F0                        0x0370                    Write
    INDEX PORT (Note 2)             0x03F0                        0x0370                    Read/Write
    DATA PORT                       INDEX PORT + 1                                          Read/Write
Note 1: If using TTL RS232 drivers use 1K pull-down. If using CMOS RS232 drivers use 10K pull-down.
Note 2: The configuration port base address can be relocated through CR26 and CR27.
Entering the Configuration State
                                                          Exiting the Configuration State
The device enters the Configuration State when
the following Config Key is successfully written to       The device exits the Configuration State when the
the CONFIG PORT.                                          following Config Key is successfully written to the
                                                          CONFIG PORT.
Config Key = < 0x55>
                                                          Config Key = < 0xAA>
When in configuration mode, all logical devices
function properly.          Entering and exiting
configuration mode has no effect on the devices.
CONFIGURATION SEQUENCE                                    To program the configuration registers, the
                                                          following sequence must be followed:
                                                          1. Enter Configuration Mode
                                                      10


2.   Configure the Configuration Registers             The desired configuration registers are accessed
3.   Exit Configuration Mode.                          in two steps:
                                                       a. Write the index of the Logical Device Number
Enter Configuration Mode                                   Configuration Register (i.e., 0x07) to the
                                                           INDEX PORT and then write the number of the
To place the chip into the Configuration State the         desired logical device to the DATA PORT
Config Key is sent to the chip's CONFIG PORT.          b. Write the address of the desired configuration
The config key consists of a write of 0x55 data to         register within the logical device to the INDEX
the CONFIG PORT. Once the initiation key is                PORT and then write or read the configuration
received correctly the chip enters into the                register through the DATA PORT.
Configuration State (The auto Config ports are
enabled).                                              Note: if accessing the Global Configuration
                                                       Registers, step (a) is not required.
Configuration Mode
                                                       Exit Configuration Mode
The system sets the logical device information
and activates desired logical devices through the      To exit the Configuration State the system writes
INDEX and DATA ports. In configuration mode,           0xAA to the CONFIG PORT. The chip returns to
the INDEX PORT is located at the CONFIG PORT           the RUN State.
address and the DATA PORT is at INDEX PORT
address + 1.                                           Note: Only two states are defined (Run and
                                                       Configuration). In the Run State the chip will
                                                       always be ready to enter the Configuration State.
                                                   160


Programming Example
The following is an example of a configuration program in Intel 8086 assembly language.
;--------------------------------------------------.
; ENTER CONFIGURATION MODE |
;--------------------------------------------------'
MOVDX,3F0H
MOVAX,055H
CLI; disable interrupts
OUTDX,AL
STI; enable interrupts
;--------------------------------------------------.
; CONFIGURE REGISTER CRE0,                          |
; LOGICAL DEVICE 8                             |
;--------------------------------------------------'
MOVDX,3F0H
MOVAL,07H
OUTDX,AL ; Point to LD# Config Reg
MOVDX,3F1H
MOVAL, 08H
OUTDX,AL ; Point to Logical Device 8
;
MOVDX,3F0H
MOVAL,E0H
OUTDX,AL; Point to CRE0
MOVDX,3F1H
MOVAL,02H
OUTDX,AL; Update CRE0
;-------------------------------------------------.
; EXIT CONFIGURATION MODE |
;-------------------------------------------------'
MOVDX,3F0H
MOVAX,0AAH
OUTDX,AL
Notes: 1. HARD RESET: RESET_DRV pin asserted
           2. SOFT RESET: Bit 0 of Configuration Control register set to one
           3. All host accesses are blocked for 500µs after Vcc POR (see Power-up Timing Diagram)
                                                      161


CONFIGURATION REGISTERS
               HARD                                  Vbat   SOFT            CONFIGURATION
 INDEX  TYPE   RESET       Vcc POR      Vtr POR      POR   RESET                REGISTER
                            GLOBAL CONFIGURATION REGISTERS
  0x02    W     0x00         0x00         0x00        -       -        Config Control
  0x03   R/W    0x03         0x03         0x03        -       -        Index Address
  0x07   R/W    0x00         0x00         0x00        -     0x00       Logical Device Number
  0x20    R     0x4C         0x4C         0x4C        -     0x4C       Device ID - hard wired
  0x21    R     0x00         0x00         0x00        -     0x00       Device Rev - hard wired
                  (Note 0)     (Note 0)     (Note 0)          (Note 0)
  0x22   R/W  0x00         0x00         0x00          -   0x00         Power Control
  0x23   R/W    0x00         0x00         0x00        -       -        Power Mgmt
  0x24   R/W    0x04         0x04         0x04        -       -        OSC
  0x26   R/W  Sysopt=0:    Sysopt=0:        -         -       -        Configuration Port Address
                0xF0         0xF0                                      Byte 0
              Sysopt=1:    Sysopt=1:
                0x70         0x70
  0x27   R/W  Sysopt=0:    Sysopt=0:        -         -       -        Configuration Port Address
                0x03         0x03                                      Byte 1
              Sysopt=1:    Sysopt=1:
                0x03         0x03
  0x28   R/W    0x00         0x00           -         -     0x00       Clock Mask Register
  0x2B   R/W      -          0x00         0x00        -       -        TEST 4
  0x2C   R/W      -          0x00         0x00        -       -        TEST 5
  0x2D   R/W      -          0x00         0x00        -       -        TEST 1
  0x2E   R/W      -          0x00         0x00        -       -        TEST 2
  0x2F   R/W      -          0x00         0x00        -       -        TEST 3
                     LOGICAL DEVICE 0 CONFIGURATION REGISTERS (FDD)
  0x30   R/W    0x00         0x00         0x00        -     0x00       Activate
  0x60,  R/W    0x03,        0x03,        0x03,       -     0x03,      Primary Base I/O Address
  0x61          0xF0         0xF0         0xF0              0xF0
  0x70   R/W    0x06         0x06         0x06        -     0x06       Primary Interrupt Select
  0x74   R/W    0x02         0x02         0x02        -     0x02       DMA Channel Select
  0xF0   R/W    0x0E         0x0E         0x0E        -       -        FDD Mode Register
  0xF1   R/W    0x00         0x00         0x00        -       -        FDD Option Register
  0xF2   R/W    0xFF         0xFF         0xFF        -       -        FDD Type Register
  0xF4   R/W    0x00         0x00         0x00        -       -        FDD0
  0xF5   R/W    0x00         0x00         0x00        -       -        FDD1
                  LOGICAL DEVICE 1 CONFIGURATION REGISTERS (Reserved)
                  LOGICAL DEVICE 2 CONFIGURATION REGISTERS (Reserved)
                 LOGICAL DEVICE 3 CONFIGURATION REGISTERS (Parallel Port)
  0x30   R/W    0x00         0x00         0x00        -     0x00       Activate
                                              162


            HARD                              Vbat     SOFT            CONFIGURATION
INDEX  TYPE RESET      Vcc POR     Vtr POR    POR     RESET                REGISTER
 0x60,  R/W  0x00,       0x00,      0x00,       -      0x00,     Primary Base I/O Address
 0x61        0x00        0x00       0x00               0x00
 0x70   R/W  0x00        0x00       0x00        -      0x00      Primary Interrupt Select
 0x74   R/W  0x04        0x04        0x04       -      0x04      DMA Channel Select
 0xF0   R/W  0x3C        0x3C       0x3C        -        -       Parallel Port Mode Register
 0xF1   R/W  0x00        0x00        0x00       -        -       Parallel Port Mode Register 2
              LOGICAL DEVICE 4 CONFIGURATION REGISTERS (Serial Port 1)
 0x30   R/W  0x00        0x00        0x00       -      0x00      Activate
 0x60,  R/W  0x00,       0x00,      0x00,       -      0x00,     Primary Base I/O Address
 0x61        0x00        0x00       0x00               0x00
 0x70   R/W  0x00        0x00       0x00        -      0x00      Primary Interrupt Select
 0xF0   R/W  0x00        0x00        0x00       -        -       Serial Port 1 Mode Register
              LOGICAL DEVICE 5 CONFIGURATION REGISTERS (Serial Port 2)
 0x30   R/W    -           -         0x00       -        -       Activate
 0x60,  R/W  0x00,       0x00,      0x00,       -      0x00,     Primary Base I/O Address
 0x61        0x00        0x00       0x00               0x00
 0x70   R/W  0x00        0x00       0x00        -      0x00      Primary Interrupt Select
 0xF0   R/W  0x00        0x00        0x00       -        -       Serial Port 2 Mode Register
 0xF1   R/W  0x02        0x02        0x02       -        -       IR Options Register
 0xF2   R/W  0x03        0x03        0x03       -        -       IR Half Duplex Timeout
               LOGICAL DEVICE 6 CONFIGURATION REGISTERS (Reserved)
               LOGICAL DEVICE 7 CONFIGURATION REGISTERS (Keyboard)
 0x30   R/W  0x00        0x00        0x00       -      0x00      Activate
 0x70   R/W  0x00        0x00       0x00        -      0x00      Primary Interrupt Select
 0x72   R/W  0x00        0x00       0x00        -      0x00      Second Interrupt Select
 0xF0   R/W  0x00        0x00        0x00       -        -       KRESET and GateA20
                                                                 Select
                 LOGICAL DEVICE 8 CONFIGURATION REGISTERS (Aux I/O)
 0x30   R/W  0x00        0x00        0x00       -      0x00      Activate
 0xB0   R/W    -           -           -      0x00       -       Soft Power Enable Register
                                                                   3
                                                                 1
 0xB1   R/W    -           -           -      0x80       -       Soft Power Enable Register
                                                                   3
                                                                 2
 0xB2   R/W    -           -           -      0x00       -       Soft Power Status Register 1
                                                                 3
 0xB3   R/W    -           -           -     0x00        -       Soft Power Status Register 2
                                                                 3
 0xB8   R/W    -           -           -      0x00       -       Delay 2 Time Set Register
                                                                                   3
 0xC0   R/W  0x00        0x00          -        -        -       IRQ Mux Control
                                         163


              HARD                     Vbat SOFT       CONFIGURATION
INDEX TYPE    RESET  Vcc POR Vtr POR   POR  RESET           REGISTER
 0xC1  R/W     0x01    0x01      -       -    -   Force Disk Change
 0xC2   R        -       -       -       -    -   Floppy Data Rate Select
                                                  Shadow
 0xC3   R        -       -       -       -    -   UART1 FIFO Control
                                                  Shadow
 0xC4   R        -       -       -       -    -   UART2 FIFO Control
                                                  Shadow
 0xC5  R/W     0x00    0x00      -       -    -   FDC Forced Write Protect
                                                                     3
 0xC6  R/W       -       -       -     0x00   -   Ring Filter Select
                                                         3
 0xC8  R/W       -       -       -     0x01   -   GP50
                                                         3
 0xCA  R/W       -       -       -     0x09   -   GP52
                                                         3
 0xCB  R/W       -       -       -     0x01   -   GP53
                                                         3
 0xCC  R/W       -       -       -     0x01   -   GP54
                                                         3
 0xD0  R/W       -       -       -     0x01   -   GP60
                                                         3
 0xD1  R/W       -       -       -     0x01   -   GP61
                                                         3
 0xD2  R/W       -       -       -     0x01   -   GP62
                                                         3
 0xD3  R/W       -       -       -     0x01   -   GP63
                                                         3
 0xD4  R/W       -       -       -     0x01   -   GP64
                                                         3
 0xD5  R/W       -       -       -     0x01   -   GP65
                                                         3
 0xD6  R/W       -       -       -     0x01   -   GP66
                                                         3
 0xD7  R/W       -       -       -     0x01   -   GP67
                                                         3
 0xE0  R/W       -       -       -     0x01   -   GP10
                                                         3
 0xE1  R/W       -       -       -     0x01   -   GP11
                                                         3
 0xE2  R/W       -       -       -     0x01   -   GP12
                                                         3
 0xE3  R/W       -       -       -     0x01   -   GP13
                                                         3
 0xE4  R/W       -       -       -     0x01   -   GP14
                                                         3
 0xE5  R/W       -       -       -     0x01   -   GP15
                                                         3
 0xE6  R/W       -       -       -     0x01   -   GP16
                                                         3
 0xE7  R/W       -       -       -     0x01   -   GP17
                                                             3
 0xEF  R/W       -       -       -     0x00   -   GP_INT2
                                                             3
 0xF0  R/W       -       -       -     0x00   -   GP_INT1
 0xF1  R/W     0x00    0x00    0x00      -    -   WDT_UNITS
 0xF2  R/W     0x00    0x00    0x00      -    -   WDT_VAL
 0xF3  R/W     0x00    0x00   0x00       -    -   WDT_CFG
          (1)
 0xF4 R/W     Note 5  Note 5  0x00       -    -   WDT_CTRL
                                                       3
 0xF6  R/W       -       -       -     0x00   -   GP1
                                                       3
 0xF9  R/W       -       -       -     0x00   -   GP5
                                                       3
 0xFA  R/W       -       -       -     0x00   -   GP6
                                   164


                      HARD                                Vbat         SOFT         CONFIGURATION
 INDEX      TYPE      RESET       Vcc POR      Vtr POR    POR        RESET              REGISTER
                           LOGICAL DEVICE A CONFIGURATION REGISTERS (ACPI)
                                                                                        4
  0x30       R/W       0x00         0x00         0x00       -          0x00    Activate
  0x60,      R/W       0x00,        0x00,        0x00,      -          0x00,   Primary Base I/O Address
      (2)
 0x61                  0x00         0x00         0x00                  0x00    PM1_BLK
                                                                                                        3
  0x70       R/W         -            -            -      0x00           -     Primary Interrupt Select
                                                                                                          3
  0xF0       R/W         -            -            -      0x00           -     Sleep/Wake Configuration
Notes
Note 0: CR22 Bit 5 is reset on Vtr POR only
Note 1: This register contains some bits which are read or write only.
Note 2: Register 60 is the high byte; 61 is the low byte. For example to set the primary base address to
          1234h, write 12h into 60, and 34h into 61.
Note 3: These configuration registers are powered by Vtr and battery backed up.
Note 4: The Activate bit for Logical Device A does not effect the generation of an interrupt (SCI).
Note 5: Bits[0,2-7] are cleared on a VCC POR or RESET_DRV.
                                                     165


Chip Level (Global) Control/Configuration Registers [0x00-0x2F]
The chip-level (global) registers lie in the address range [0x00-0x2F]. The design MUST use all 8 bits of
the ADDRESS Port for register selection. All unimplemented registers and bits ignore writes and return
zero when read.
The INDEX PORT is used to select a configuration register in the chip. The DATA PORT is then used to
access the selected register. These registers are accessible only in the Configuration Mode.
                                   TABLE 63 - CHIP LEVEL REGISTERS
    REGISTER          ADDRESS                                  DESCRIPTION                          STATE
                                       Chip (Global) Control Registers
                         0x00 -       Reserved - Writes are ignored, reads return 0.
                          0x01
 Config Control         0x02 W        The hardware automatically clears this bit after the write,     C
                                      there is no need for software to clear the bits.
 Default = 0x00                       Bit 0 = 1: Soft Reset. Refer to the "Configuration Registers"
 on Vcc POR or                        table for the soft reset value for each register.
 Reset_Drv
 Index Address         0x03 R/W       Bit[7]
                                      =1         Enable GP1, WDT_CTRL, GP5, GP6, Soft Power
                                                 Enable and Status Register access when not in
 Default = 0x03                                  configuration mode
 on Vcc POR or                        =0         Disable GP1, WDT_CTRL, GP5, GP6, Soft Power
 Reset_Drv                                       Enable and Status Register access when not in
                                                 configuration mode (Default)
                                      Bits [6:2]
                                      Reserved - Writes are ignored, reads return 0.
                                      Bits[1:0]
                                      Sets GP1 etc. selection register used when in Run mode
                                      (not in Configuration Mode).
                                      = 11       0xEA (Default)
                                      = 10       0xE4
                                      = 01       0xE2
                                      = 00       0xE0
                     0x04 - 0x06      Reserved - Writes are ignored, reads return 0.
 Logical Device #      0x07 R/W       A write to this register selects the current logical device.    C
                                      This allows access to the control and configuration registers
 Default = 0x00                       for each logical device. Note: the Activate command
 on Vcc POR or                        operates only on the selected logical device.
 Reset_Drv
 Card Level          0x08 - 0x1F      Reserved - Writes are ignored, reads return 0.
 Reserved
                                          Chip Level, SMSC Defined
                                                       166


   REGISTER      ADDRESS                           DESCRIPTION                       STATE
Device ID         0x20 R  A read only register which provides device identification.   C
                          Bits[7:0] = 0x4C when read
Hard wired
= 0x4C
Device Rev        0x21 R  A read only register which provides device revision          C
                          information. Bits[7:0] = 0x00 when read
Hard wired
= 0x00
PowerControl     0x22 R/W Bit[0] FDC Power                                             C
                          Bit[1] Reserved
Default = 0x00.           Bit[2] Reserved
on Vcc POR or             Bit[3] Parallel Port Power
Reset_Drv                 Bit[4] Serial Port 1 Power
hardware signal.          Bit[5] Serial Port 2 Power
                          Bit[6] Reserved
                          Bit[7] Reserved
                          =0         Power off or disabled
                          =1         Power on or enabled
Power Mgmt       0x23 R/W Bit[0] FDC                                                   C
                          Bit[1] Reserved
Default = 0x00.           Bit[2] Reserved
on Vcc POR or             Bit[3] Parallel Port
Reset_Drv                 Bit[4] Serial Port 1
hardware signal           Bit[5] Serial Port 2
                          Bit[6] Reserved (read as 0)
                          Bit[7] Reserved (read as 0)
                          =0         Intelligent Pwr Mgmt off
                          =1         Intelligent Pwr Mgmt on
OSC              0x24 R/W Bit[0] Reserved                                              C
                          Bit [1] PLL Control
Default = 0x04,           =0          PLL is on (backward Compatible)
on Vcc POR or             =1          PLL is off
Reset_Drv                 Bits[3:2] OSC
hardware signal.          = 01       Osc is on, BRG clock is on.
                          = 10       Same as above (01) case.
                          = 00       Osc is on, BRG Clock Enabled.
                          = 11       Osc is off, BRG clock is disabled.
                          Bit [6:4] Reserved, set to zero
                          Bit[7] IRQ8 Polarity
                          =0         IRQ8 is active high
                          =1       IRQ8 is active low
Chip Level         0x25   Reserved - Writes are ignored, reads return 0.
Vendor Defined
                                             167


    REGISTER          ADDRESS                               DESCRIPTION                             STATE
 Configuration           0x26       Bit[7:1] Configuration Address Bits [7:1]                         C
 Address Byte 0                     Bit[0] = 0
                                    See Note 1 Below
 Default=0xF0
 (Sysopt=0)
 =0x70 (Sysopt=1)
 on Vcc POR or
 Reset_Drv
 Configuration           0x27       Bit[7:0] Configuration Address Bits [15:8]                        C
 Address Byte 1                     See Note 1 Below
 Default = 0x03
 on Vcc POR or
 Reset_Drv
 Chip Level           0x28 -0x2A    Reserved - Writes are ignored, reads return 0.
 Vendor Defined
 TEST 4               0x2B R/W      Test Modes: Reserved for SMSC. Users should not write             C
                                    to this register, may produce undesired results.
 TEST 5               0x2C R/W      Test Modes: Reserved for SMSC. Users should not write             C
                                    to this register, may produce undesired results.
 TEST 1               0x2D R/W      Test Modes: Reserved for SMSC. Users should not write             C
                                    to this register, may produce undesired results.
 TEST 2               0x2E R/W      Test Modes: Reserved for SMSC. Users should not write             C
                                    to this register, may produce undesired results.
 TEST 3                0x2F R/W     Test Modes: Reserved for SMSC. Users should not write             C
                                    to this register, may produce undesired results.
 Default = 0x00,
 on Vcc POR or
 Reset_Drv
 hardware signal.
Note 1: To allow the selection of the configuration address to a user defined location, these Configuration
         Address Bytes are used. There is no restriction on the address chosen, except that A0 is 0, that
         is, the address must be on an even byte boundary. As soon as both bytes are changed, the
         configuration space is moved to the specified location with no delay (Note: Write byte 0, then byte
         1; writing CR27 changes the base address).
The configuration address is only reset to its default address upon a Hard Reset or Vcc POR.
Note: The default configuration address is either 3F0 or 370, as specified by the SYSOPT pin.
This change affects SMSC Mode only.
                                                      168


Logical Device Configuration/Control
Registers [0x30-0xFF]                                      The INDEX PORT is used to select a specific
                                                           logical device register. These registers are then
Used to access the registers that are assigned to          accessed through the DATA PORT.
each logical unit. This chip supports seven logical
units and has seven sets of logical device                 The Logical Device registers are accessible only
registers. The logical devices are Floppy, Parallel        when the device is in the Configuration State. The
Port, Serial Port 1 and Serial Port 2, Keyboard            logical register addresses are:
Controller, Auxiliary I/O and ACPI. A separate set
(bank) of control and configuration register exists        Logical Device Registers
for each logical device and is selected with the
Logical Device # Register (0x07).
                                 TABLE 64 - LOGICAL DEVICE REGISTERS
   LOGICAL DEVICE
       REGISTER              ADDRESS                           DESCRIPTION                          STATE
          Note1
 Activate                      (0x30)     Bits[7:1] Reserved, set to zero.                             C
                                          Bit[0]
 Default = 0x00                            =1       Activates the logical device currently
 on Vcc POR or                                      selected through the Logical Device #
 Reset_Drv Note 2                                   register.
                                          =0        Logical device currently selected is inactive
 Logical Device Control     (0x31-0x37)   Reserved - Writes are ignored, reads return 0.               C
 Logical Device Control     (0x38-0x3f)   Vendor Defined - Reserved - Writes are ignored,              C
                                          reads return 0.
 Mem Base Addr             (0x40-0x5F)    Reserved - Writes are ignored, reads return 0.               C
 I/O Base Addr.            (0x60-0x6F)    Registers 0x60 and 0x61 set the base address for the         C
                                          device. If more than one base address is required,
 (see Device Base I/O        0x60,2,... = the second base address is set by registers 0x62 and
 Address Table)              addr[15:8]   0x63.
                                          Refer to - I/O Base Address Configuration Register
 Default = 0x00              0x61,3,... = Description - for the number of base address
 on Vcc POR or                addr[7:0]   registers used by each device.
 Reset_Drv
                                          Unused registers will ignore writes and return zero
                                          when read.
 Interrupt Select            (0x70,072)   0x70 is implemented for each logical device. Refer to        C
                                          Interrupt Configuration Register description. Only the
 Defaults :
                                          keyboard controller uses Interrupt Select register
 0x70 = 0x00,
                                          0x72. Unused register (0x72) will ignore writes and
 on Vcc POR or
                                          return zero when read. Interrupts default to edge high
 Reset_Drv
                                          (ISA compatible).
 0x72 = 0x00,
 on Vcc POR or
 Reset_Drv
                                                       169


  LOGICAL DEVICE
      REGISTER              ADDRESS                            DESCRIPTION                         STATE
                           (0x71,0x73)    Reserved - not implemented.            These register
                                         locations ignore writes and return zero when read.
 DMA Channel Select        (0x74,0x75)   Only 0x74 is implemented for FDC, Serial Port 2 and         C
                                         Parallel port. 0x75 is not implemented and ignores
 Default = 0x04                          writes and returns zero when read. Refer to DMA
 on Vcc POR or                           Channel Configuration.
 Reset_Drv
 32-Bit Memory Space       (0x76-0xA8) Reserved - not implemented.               These register
 Configuration                           locations ignore writes and return zero when read.
 Logical Device           (0xA9-0xDF) Reserved - not implemented.                These register      C
                                         locations ignore writes and return zero when read.
 Logical Device Config. (0xE0-0xFE) Reserved - Vendor Defined (see SMSC defined                      C
                                         Logical Device Configuration Registers)
 Reserved                     0xFF       Reserved                                                    C
Note 1: A logical device will be active and powered up according to the following equation:
DEVICE ON (ACTIVE) = (Activate Bit SET or Pwr/Control Bit SET).
         The Logical device's Activate Bit and its Pwr/Control Bit are linked such that setting or clearing
         one sets or clears the other.
Note:    If the I/O Base Addr of the logical device is not within the Base I/O range as shown in the Logical
         Device I/O map, then read or write is not valid and is ignored.
Note 2. The activate bit for Logical Device 5 (Serial Port 2) is reset on Vtr POR only.
                                                     170


I/O Base Address Configuration Register
                 Table 65 - I/O Base Address Configuration Register Description
  LOGICAL                                       BASE I/O
   DEVICE    LOGICAL REGISTER                    RANGE                       FIXED
  NUMBER      DEVICE         INDEX              (NOTE3)                BASE OFFSETS
    0x00        FDC       0x60,0x61         [0x100:0x0FF8]    +0 : SRA
              (Note 4)                                        +1 : SRB
                                               ON 8 BYTE      +2 : DOR
                                             BOUNDARIES       +3 : TSR
                                                              +4 : MSR/DSR
                                                              +5 : FIFO
                                                              +7 : DIR/CCR
    0x03      Parallel    0x60,0x61         [0x100:0x0FFC]    +0 : Data|ecpAfifo
                Port                           ON 4 BYTE      +1 : Status
                                             BOUNDARIES       +2 : Control
                                         (EPP Not supported)  +3 : EPP Address
                                                    or        +4 : EPP Data 0
                                            [0x100:0x0FF8]    +5 : EPP Data 1
                                               ON 8 BYTE      +6 : EPP Data 2
                                             BOUNDARIES       +7 : EPP Data 3
                                        (all modes supported, +400h : cfifo|ecpDfifo|tfifo |cnfgA
                                        EPP is only available +401h : cnfgB
                                       when the base address  +402h : ecr
                                             is on an 8-byte
                                                boundary)
    0x04    Serial Port 1 0x60,0x61         [0x100:0x0FF8]    +0 : RB/TB|LSB div
                                                              +1 : IER|MSB div
                                               ON 8 BYTE      +2 : IIR/FCR
                                             BOUNDARIES       +3 : LCR
                                                              +4 : MSR
                                                              +5 : LSR
                                                              +6 : MSR
                                                              +7 : SCR
    0x05    Serial Port 2 0x60,0x61         [0x100:0x0FF8]    +0 : RB/TB|LSB div
                                                              +1 : IER|MSB div
                                               ON 8 BYTE      +2 : IIR/FCR
                                             BOUNDARIES       +3 : LCR
                                                              +4 : MSR
                                                              +5 : LSR
                                                              +6 : MSR
                                                              +7 : SCR
    0x07       KYBD            n/a          Not Relocatable   +0 : Data Register
                                         Fixed Base Address:  +4 : Command/Status Reg.
                                                  60,64
    0x08      AUX I/O          n/a          Not Relocatable   n/a
                                                  171


  LOGICAL                                             BASE I/O
   DEVICE        LOGICAL        REGISTER                RANGE                            FIXED
  NUMBER          DEVICE           INDEX               (NOTE3)                      BASE OFFSETS
    0x0A           ACPI          0x60,0x61          [0x00:0x0FE7]
                                                     ON 24 BYTE
                                                    BOUNDARIES
Note 3:This chip uses ISA address bits [A11:A0] to decode the base address of each of its logical devices.
Interrupt Select Configuration Register
                       Table 66 - Interrupt Select Configuration Register Description
        NAME            REG INDEX                              DEFINITION                        STATE
 Interrupt             0x70 (R/W)       Bits[3:0] selects which interrupt level is used for        C
 Request Level                          Interrupt 0.
 Select 0                                          0x00=no interrupt selected.
                                                   0x01=IRQ1
                                        0x02=IRQ2
 Default = 0x00
                                                       •
 on Vcc POR or                              •
 Reset_Drv                                             •
                                        0x0E=IRQ14
                                        0x0F=IRQ15
                                        Note: All interrupts are edge high (except ECP/EPP)
Note:      An Interrupt is activated by setting the Interrupt Request Level Select 0 register to a non-zero
           value AND :
       for the FDC logical device by setting DMAEN, bit D3 of the Digital Output Register.
       for the PP logical device by setting IRQE, bit D4 of the Control Port and in addition
       for the PP logical device in ECP mode by clearing serviceIntr, bit D2 of the ecr.
       for the Serial Port logical device by setting any combination of bits D0-D3 in the IER
       and by setting the OUT2 bit in the UART's Modem Control (MCR) Register.
       for the KYBD by (refer to the KYBD controller section of this spec.)
Note:IRQ pins must tri-state if not used/selected by any Logical Device. Refer to Note A.
                                                         172


DMA Channel Select Configuration Register
               Table 67 - DMA Channel Select Configuration Register Description
             NAME            REG INDEX                    DEFINITION                STATE
       DMA Channel           0x74 (R/W)      Bits[2:0] select the DMA Channel.          C
       Select                                0x00=DMA0
                                             0x01=DMA1
       Default = 0x04                        0x02=DMA2
       on Vcc POR or                         0x03=DMA3
       Reset_Drv                             0x04-0x07= No DMA active
Note: A DMA channel is activated by setting the DMA Channel Select register to [0x00-0x03] AND :
      for the FDC logical device by setting DMAEN, bit D3 of the Digital Output Register.
      for the PP logical device in ECP mode by setting dmaEn, bit D3 of the ecr.
      for the UART 2 logical device, by setting the DMA Enable bit. Refer to the IRCC specification.
Note: DMAREQ pins must tri-state if not used/selected by any Logical Device. Refer to Note A.
                                                  173


Note A. Logical Device IRQ and DMA Operation
1)   IRQ and DMA Enable and Disable: Any time the IRQ or DACK for a logical block is disabled by a
     register bit in that logical block, the IRQ and/or DACK must be disabled. This is in addition to the
     IRQ and DACK disabled by the Configuration Registers (active bit or address not valid).
2)   FDC: For the following cases, the IRQ and DACK used by the FDC are disabled (high
     impedance). Will not respond to the DREQ
         (a)        Digital Output Register (Base+2) bit D3 (DMAEN) set to "0".
         (b)        The FDC is in power down (disabled).
3)  Serial Port 1 and 2: Modem Control Register (MCR) Bit D2 (OUT2) - When OUT2 is a logic "0", the
    serial port interrupt is forced to a high impedance state - disabled.
4)  Parallel Port: SPP and EPP modes: Control Port (Base+2) bit D4 (IRQE) set to "0", IRQ is disabled
    (high impedance).
         1) ECP Mode:
                    (a)       (DMA) dmaEn from ecr register. See table.
                    (b)       IRQ - See table.
                           MODE                          IRQ PIN              PDREQ PIN
                (FROM ECR REGISTER)                 CONTROLLED BY          CONTROLLED BY
                 000                PRINTER                IRQE                 dmaEn
                 001                   SPP                 IRQE                 dmaEn
                 010                  FIFO                  (on)                dmaEn
                 011                   ECP                  (on)                dmaEn
                 100                   EPP                 IRQE                 dmaEn
                 101                   RES                 IRQE                 dmaEn
                 110                  TEST                  (on)                dmaEn
                 111                 CONFIG                IRQE                 dmaEn
1)  Keyboard Controller: Refer to the KBD section of this spec.
                                                     174


SMSC Defined Logical Device Configuration Registers
The SMSC Specific Logical Device Configuration Registers reset to their default values only on hard resets
generated by Vcc POR or VTR POR or VBAT POR (as shown) or the RESET_DRV signal. These
registers are not affected by soft resets.
         Table 68 - Floppy Disk Controller, Logical Device 0 [Logical Device Number = 0x00]
         NAME             REG INDEX                             DEFINITION                     STATE
 FDD Mode Register         0xF0 R/W      Bit[0] Floppy Mode                                       C
                                           =0       Normal Floppy Mode (default)
 Default = 0x0E                            =1       Enhanced Floppy Mode 2 (OS2)
 on Vcc POR or                           Bit[1] FDC DMA Mode
 Reset_Drv                               =0         Burst Mode is enabled
                                         =1         Non-Burst Mode (default)
                                         Bit[3:2] Interface Mode
                                         = 11       AT Mode (default)
                                         = 10       (Reserved)
                                         = 01       PS/2
                                         = 00       Model 30
                                         Bit[4] Swap Drives 0,1 Mode
                                         =0         No swap (default)
                                         =1         Drive and Motor sel 0 and 1 are swapped.
                                         Bits[5] Reserved, set to zero.
                                         Bit [6] Output Type Control:
                                         0= FDC outputs are OD24 open drain (default)
                                         1= FDC outputs are O24 push-pull.
                                         Bit [7] FDC output Control:
                                         0= FDC outputs active (default)
                                         1= FDC outputs tristated
                                         Note: these bits do not affect the parallel port FDC
                                         pins.
 FDD Option Register       0xF1 R/W      Bits[1:0] Reserved, set to zero                          C
                                         Bits[3:2] Density Select
 Default = 0x00                          = 00       Normal (default)
 on Vcc POR or                           = 01       Normal (reserved for users)
 Reset_Drv                               = 10       1 (forced to logic "1")
                                         = 11       0 (forced to logic "0")
                                         Bit[5:4] Reserved, set to zero
                                         Bits[7:6] Boot Floppy
                                         = 00       FDD 0 (default)
                                         = 01       FDD 1
                                         = 10       Reserved (neither drive A or B is a boot
                                                    drive).
                                         = 11       Reserved (neither drive A or B is a boot
                                                    drive).
                                                        175


       NAME       REG INDEX                       DEFINITION                  STATE
FDD Type Register  0xF2 R/W Bits[1:0] Floppy Drive A Type                       C
                            Bits[3:2] Floppy Drive B Type
Default = 0xFF              Bits[5:4] Reserved (could be used to store Floppy
on Vcc POR or                                   Drive C type)
Reset_Drv                   Bits[7:6] Reserved (could be used to store Floppy
                                                Drive D type)
                                                Note: The FDC37B72x supports
                                                two floppy drives
                    0xF3 R  Reserved, Read as 0 (read only)                     C
FDD0               0xF4 R/W Bits[1:0] Drive Type Select: DT1, DT0               C
                            Bits[2] Read as 0 (read only)
Default = 0x00              Bits[4:3] Data Rate Table Select: DRT1, DRT0
on Vcc POR or               Bits[5] Read as 0 (read only)
Reset_Drv                   Bits[6] Precompensation Disable PTS
                                     =0 Use Precompensation
                                     =1 No Precompensation
                            Bits[7] Read as 0 (read only)
FDD1               0xF5 R/W Refer to definition and default for 0xF4            C
                                          176


Parallel Port, Logical Device 3
             Table 69 - Parallel Port, Logical Device 3 [Logical Device Number = 0x03]
       NAME           REG INDEX                              DEFINITION                     STATE
 PP Mode Register     0xF0 R/W       Bits[2:0] Parallel Port Mode                             C
                                     = 100     Printer Mode (default)
 Default = 0x3C                      = 000     Standard and Bi-directional (SPP) Mode
 on Vcc POR or                       = 001     EPP-1.9 and SPP Mode
 Reset_Drv                           = 101     EPP-1.7 and SPP Mode
                                     = 010     ECP Mode
                                     = 011     ECP and EPP-1.9 Mode
                                     = 111     ECP and EPP-1.7 Mode
                                     Bit[6:3] ECP FIFO Threshold
                                     0111b (default)
                                     Bit[7] PP Interrupt Type
                                     Not valid when the parallel port is in the Printer
                                     Mode (100) or the Standard & Bi-directional Mode
                                     (000).
                                     =1        Pulsed Low, released to high-Z.
                                     =0        IRQ follows nACK when parallel port in EPP
                                               Mode or [Printer,SPP, EPP] under ECP.
                                     IRQ level type when the parallel port is in ECP, TEST,
                                     or Centronics FIFO Mode.
 PP Mode Register     0xF1 R/W       Bits[1:0] PPFDC - muxed PP/FDC control
 2                                   = 00 Normal Parallel Port Mode
                                     = 01 PPFD1: Drive 0 is on the FDC pins
 Default = 0x00                                        Drive 1 is on the Parallel port pins
 on Vcc POR or                                         Drive 2 is on the FDC pins
 Reset_Drv                                             Drive 3 is on the FDC pins
                                     = 10 PPFD2: Drive 0 is on the Parallel port pins
                                                       Drive 1 is on the Parallel port pins
                                                       Drive 2 is on the FDC pins
                                     Drive 3 is on the FDC pins
                                     Bits[7:2] Reserved. Set to zero.
                                                   177


Serial Port 1, Logical Device 4
               Table 70 - Serial Port 1, Logical Device 4 [Logical Device Number = 0x04]
               NAME           REG INDEX                      DEFINITION                    STATE
       Serial Port 1             0xF0 R/W    Bit[0] MIDI Mode                                 C
       Mode Register                         =0        MIDI support disabled (default)
                                             =1        MIDI support enabled
       Default = 0x00
       on Vcc POR or                         Bit[1] High Speed
       Reset_Drv                             =0        High Speed Disabled(default)
                                             =1        High Speed Enabled
                                             Bit[6:2] Reserved, set to zero
                                             Bit[7]: Share IRQ
                                             =0 UARTS use different IRQs
                                             =1 UARTS share a common IRQ
                                             See Note 1 below.
Note 1: To properly share and IRQ,
       1. Configure UART1 (or UART2) to use the desired IRQ pin.
       2. Configure UART2 (or UART1) to use No IRQ selected.
       3. Set the share IRQ bit.
Note: If both UARTs are configured to use different IRQ pins and the share IRQ bit is set, then both of the
UART IRQ pins will assert when either UART generates an interrupt.
                                                     178


Serial Port 2, Logical Device 5
               Table 71 - Serial Port 2, Logical Device 5 [Logical Device Number = 0x05]
         NAME           REG INDEX                            DEFINITION                         STATE
 Serial Port 2            0xF0 R/W     Bit[0] MIDI Mode                                           C
 Mode Register                         =0         MIDI support disabled (default)
                                       =1         MIDI support enabled
 Default = 0x00                        Bit[1] High Speed
 on Vcc POR or                         =0         High Speed disabled(default)
 Reset_Drv                             =1         High Speed enabled
                                       Bit[7:2] Reserved, set to zero
 IR Option Register       0xF1 R/W     Bit[0] Receive Polarity                                    C
                                       =0         Active High (Default)
 Default = 0x02                        =1         Active Low
 on Vcc POR or                         Bit[1] Transmit Polarity
 Reset_Drv                             =0          Active High
                                       =1          Active Low (Default)
                                       Bit[2] Duplex Select
                                       =0         Full Duplex (Default)
                                       =1          Half Duplex
                                       Bits[5:3] IR Mode
                                       = 000      Standard (Default)
                                       = 001      IrDA
                                       = 010      ASK-IR
                                       = 011      Reserved
                                       = 1xx      Reserved
                                       Bit[6] IR Location Mux
                                       =0         Use Serial port TXD2 and RXD2 (Default)
                                       =1         Use alternate IRRX2 (pin 81) and IRTX2
                                                  (pin 82)
                                       Bit[7] Reserved, write 0
 IR Half Duplex             0xF2       Bits [7:0]
 Timeout                               These bits set the half duplex time-out for the IR port.
                                       This value is 0 to 10msec in 100usec increments.
 Default = 0x03                        0= blank during transmit/receive
 on Vcc POR or                         1= blank during transmit/receive + 100usec
 Reset_Drv                             ...
                                                      179


KYBD, Logical Device 7
              Table 72 - KYBD, Logical Device 7 [Logical Device Number = 0x07]
              NAME         REG INDEX                DEFINITION              STATE
       KRST_GA20              0xF0      KRESET and GateA20 Select
                               R/W      Bit[7] Polarity Select for P12
       Default = 0x00                    = 0 P12 active low (default)
       on Vcc POR or                     = 1 P12 active high
       Reset_Drv                        Bits[6:3] Reserved
                                        Bit[2] Port 92 Select
                                         = 0 Port 92 Disabled
                                         = 1 Port 92 Enabled
                                        Bit[1] GATEA20 Select
                                         = 0 Software Control
                                         = 1 Hardware Speed-up
                                        Bit[0] KRESET Select
                                         = 0 Software Control
                                         = 1 Hardware Speed-up
                           0xF1 -       Reserved - read as ‘0’
                           0xFF
                                             180


Auxiliary I/O, Logical Device 8
               Table 73 - Auxiliary I/O, Logical Device 8 [Logical Device Number = 0x08]
       NAME            REG INDEX                            DEFINITION                       STATE
Soft Power Enable       0xB0 R/W       The following bits are the enables for the wake-up      C
Register 1                             function of the nPowerOn bit. When enabled,
                                       these bits allow their corresponding function to turn
Default = 0x00                         on power to the system.
on Vbat POR                            1 = ENABLED
                                       0 = DISABLED
                                       Bit[0] SP_RI1: UART 1 Ring Indicator Pin
                                       Bit[1] SP_RI2: UART 2 Ring Indicator Pin
                                       Bit[2] SP_KDAT: Keyboard Data Pin
                                       Bit[3] SP_MDAT: Mouse Data Pin
                                       Bit[4] SP_GPINT1: Group Interrupt 1
                                       Bit[5] SP_GPINT2: Group Interrupt 2
                                       Bit[6] SP_IRRX2: IRRX2 Input Pin
                                       Bit[7] Reserved
Soft Power Enable       0xB1 R/W       The following bits are the enables for the wake-up      C
Register 2                             function of the nPowerOn bit. When enabled,
                                       these bits allow their corresponding function to turn
Default = 0x80                         on power to the system.
on Vbat POR
                                       1 = ENABLED
                                       0 = DISABLED
                                       Bit[0] SP_RXD1: UART 1 Receive Data Pin
                                       Bit[1] SP_RXD2: UART 2 Receive Data Pin
                                       Bit[2] Reserved
                                       Bit[3] RING Enable bit “RING_EN”
                                       1=Enable ring indicator on nRING pin as wakeup
                                       function to activate nPowerOn.
                                       0=Disable.
                                       Bit[4] VTR_POR_OFF. Controls state of nPowerOn
                                       after VTR POR.
                                       1=the nPowerOn pin will go inactive (float) and the
                                       machine will remain off when the VTR POR occurs.
                                       Software must not set VTR_POR_OFF and
                                       VTR_POR_EN at the same time.
                                       0=the nPowerOn pin will remain in the state it was in
                                       prior to the VTR POR (unless the VTR_POR_EN bit
                                       is set).
                                       Bit[5] Reserved
                                       Bit[6] VTR_POR_EN. Controls state of nPowerOn
                                       after VTR POR.
                                       1= the nPowerOn pin will go active (low) and the
                                                     181


       NAME       REG INDEX                         DEFINITION                      STATE
                            machine will power-up as soon as a VTR POR
                            occurs. Software must not set VTR_POR_OFF and
                            VTR_POR_EN at the same time.
                            0=the nPowerOn pin will remain in the state it was in
                            prior to the VTR POR (unless the VTR_POR_OFF
                            bit is set).
                            Bit[7] OFF_EN: After power up, this bit defaults to 1,
                            i.e., enabled. This bit allows the software to enable
                            or disable the button control of power off.
Soft Power Status  0xB2 R/W The following bits are the status for the wake-up         C
Register 1                  function of the nPowerOn bit. These indicate which
                            of the enabled wakeup functions caused the power
Default = 0x00              up.
on Vbat POR                 1 = Occurred
                            0 = Did not occur since last cleared
                            The following signals are latched to detect and hold
                            the soft power event (Type 1) (Note 1)
                            Bit[0] RI1: UART 1 Ring Indicator; high to low
                                        transition on the pin, cleared by a read of
                                        this register
                            Bit[1] RI2: UART 2 Ring Indicator; high to low
                                        transition on the pin, cleared by a read of
                                        this register
                            Bit[2] KDAT: Keyboard data; high to low transition
                                        on the pin, cleared by a read of this
                                        register
                            Bit[3] MDAT: Mouse data; high to low transition on
                                        the pin, cleared by a read of this register
                            Bit[6] IRRX2: IRRX2 input; high to low transition on
                                        the pin, cleared by a read of this register
                            Bit[7] Reserved
                            The following signals are not latched to detect and
                            hold the soft power event (Type 2) (Note 1)
                            Bit[4] GPINT1: Group Interrupt 1; status of the
                                   GPINT1 internal signal. Cleared at the
                                   source
                            Bit[5] GPINT2: Group Interrupt 2; status of the
                                   GPINT2 internal signal. Cleared at the
                                   source
Soft Power Status  0xB3 R/W The following bits are the status for the wake-up         C
Register 2                  function of the nPowerOn bit. These indicate
                            which of the enabled wakeup functions caused the
Default = 0x00              power up.
on Vbat POR
                            1 = Occurred
                            0 = Did not occur since last cleared
                                            182


       NAME      REG INDEX                        DEFINITION                      STATE
                           The following signals are latched to detect and hold
                           the soft power event (Type 1) (Note 1)
                           Bit[0] RXD1: UART 1 Receive Data; high to low
                                      transition on the pin, cleared by a read of
                                      this register
                           Bit[1] RXD2: UART 2 Receive Data; high to low
                                      transition on the pin, cleared by a read of
                                      this register
                           Bit[3] RING Status bit “RING_STS”; Latched, cleared
                           on read.
                           0= nRING input did not occur.
                           1= Ring indicator input occurred on the nRING pin
                                     and, if enabled, caused the wakeup
                                     (activated nPowerOn)
                           Bit[5:4] Reserved
                           The following signal is latched to detect and hold the
                           soft power event (Type 3) (Note 1) but the output of
                           the latch does not feed into the power down circuitry:
                           Bit[2] Button: Button pressed, Cleared by a read of
                                     this register
                           Bits[7:6] Reserved
Delay 2 Time Set  0xB8 R/W This register is used to set Delay 2 (for Soft Power     C
Register                   Management) to a value from 500 msec to 32 sec.
                           The default value is 500msec. Engineering Note:
Default = 0x00             this delay is started if OFF_EN is enabled and
on VTR POR                 OFF_DLY was set and a Button Input comes in.
                           Bits[5:0] The value of these bits correspond to the
                           delay time as follows:
                           000000= 500msec min to 510msec max
                           000001= 1sec min to 1.01sec max
                           000010= 1.5sec min to 1.51sec max
                           000011= 2sec min to 2.01sec max
                           ...
                           111111 = 32sec min to 32.01sec max
                           Bits[7:6] Reserved
IRQ Mux Control   0XC0 R/W This register is used to configure the IRQs, including
Register                   PME, SCI and SMI.
Default = 0x00             Bit[0] Serial/Parallel IRQs
on Vbat POR                0=Serial IRQs are used
                           1=Parallel IRQS are used
                           Note 1: This bit does not control the SCI or SMI
                                          183


       NAME        REG INDEX                         DEFINITION                        STATE
                                        interrupts. See bits 2,7 of this register.
                              Note 2: If set, the BIOS buffer is disabled. Also, the
                                      SER_IRQ and PCI_CLK pins are disabled,
                                      and these pins function as IRQ15 and IRQ14,
                                      respectively.
                              Note 3: Select IRQ9 below. Select SCI below. Select
                                      nSMI through the SMI register.
                              Bit[1] Reserved
                              Bit[2] SCI Select
                              0=SCI is on serial IRQ frame
                              1=SCI is on IRQx pin
                              Bit[3] SCI Polarity Select (EN1)
                              0=SCI active low
                              1=SCI active high
                              Bit[4] SCI Buffer Type (EN1)
                              0=Push-pull
                              1=Open drain
                              Bit[6:5] SCI/PME/IRQ9 Pin select
                              00=Pin 21 is used for PME# signal.
                              01=Pin 21 is used for SCI.
                              10=Pin 21 is used for IRQ9.
                              11=Reserved
                             Note: If bit 5 is set, this overrides the setting of the
                              IRQ for SCI in Config Register 0x70 of Logical
                              Device A. See the logic in the SCI section.
                             Note: This bit selects the buffer type of the pin as
                              follows: if PME#is selected, it is active low OD; if SCI
                              is selected, the buffer type and polarity are selected
                              through bits 3 and 4 of this register; if IRQ9 is
                              selected, it is an active high push-pull output.
                              Bit[7] SMI Select
                              0=SMI is on serial IRQ frame (IRQ2)
                              1=SMI is on nSMI pin
                              Engineering Note: the polarity and buffer type of the
                              SMI pin is selected through the GPIO registers
                              (default is active low open drain).
Forced Disk Change  0xC1 R/W  Force Change 1 and Force Change 0 can be
                              written to 1 are not clearable by software.
Default = 0x03                Force Change 1 is cleared on (nSTEP AND nDS1)
on VTR POR                    Force Change 0 is cleared on (nSTEP AND nDS0).
                              DSK CHG (Floppy DIR Register, Bit 7) = (nDS0
                              AND Force Change 0) OR (nDS1 AND Force
                              Change 1) OR nDSKCHG.
                              Setting either of the Force Disk Change bits active
                              (1) forces the FDD nDSKCHG input active when
                                             184


       NAME          REG INDEX                      DEFINITION                      STATE
                               the appropriate drive has been selected.
                               Bit[0] Force Change for FDC0
                               0=Inactive
                               1=Active
                               Bit[1] Force Change for FDC1
                               0=Inactive
                               1=Active
                               Bit[2:7] Reserved, Reads 0
Floppy Data Rate       0xC2 R  Floppy Data Rate Select Shadow Register
Select Shadow                  Bit[7] Soft Reset
                               Bit[6] Power Down
                               Bit[5] Reserved
                               Bit[4] PRECOMP 2
                               Bit[3] PRECOMP 1
                               Bit[2] PRECOMP 0
                               Bit[1] Data Rate Select 1
                               Bit[0] Data Rate Select 0
UART1 FIFO             0xC3 R  UART1 FIFO Control Shadow Register
Control Shadow                 Bit[7] RCVR Trigger MSB
                               Bit[6] RCVR Trigger LSB
                               Bit[5] Reserved
                               Bit[4] Reserved
                               Bit[3] DMA Mode Select
                               Bit[2] XMIT FIFO Reset
                               Bit[1] RCVR FIFO Reset
                               Bit[0] FIFO Enable
UART2 FIFO             0xC4 R  UART2 FIFO Control Shadow Register
Control Shadow                 Bit[7] RCVR Trigger MSB
                               Bit[6] RCVR Trigger LSB
                               Bit[5] Reserved
                               Bit[4] Reserved
                               Bit[3] DMA Mode Select
                               Bit[2] XMIT FIFO Reset
                               Bit[1] RCVR FIFO Reset
                               Bit[0] FIFO Enable
Forced Write Protect  0xC5 R/W Force Write Protect function forces the FDD
                               nWRTPRT input active if the FORCE WRTPRT bit is
Default = 0x00                 active. The Force Write Protect function applies to
on VTR POR                     the nWRTPRT pin in the FDD Interface as well as
                               the nWRTPRT pin in the Parallel Port FDC.
                               Bit[0] Force Write Protect bit FDD0
                               0 = Inactive (Default)
                               1 = Active “forces the FDD nWRTPRT input active
                               when the drive has been selected” Note 2
                               Bit[1:7] Reserved, reads 0.
Ring Filter Select   0xC6 R/W  This register is used to select the operation of the   C
                                            185


       NAME       REG INDEX                      DEFINITION                       STATE
Register                    ring indicator on the nRI1, nRI2 and nRING pins. It
                            also contains bits to select crystal load capacitance
Default = 0x00 on           and P17/P12 function.
Vbat POR
                            Bit[0]: 1=Enable detection of pulse train of
Note 3                      frequency 15Hz or higher for 200msec and
                            generate an active low pulse for its duration to use
                            as the ring indicator function on nRING pin. The
                            leading high-to-low edge is the trigger for the ring
                            indication.
                            0=Ring indicate function is high-to-low transition on
                            the nRING pin.
                            Bit[1]: 1=Enable detection of pulse train of
                            frequency 15Hz or higher and generate an active
                            low pulse for its duration to use for 200msec as the
                            ring indicator function on nRI1 pin. The leading
                            high-to-low edge is the trigger for the ring
                            indication.
                            0=Ring indicate function is high-to-low transition on
                            the nRI1 pin.
                            Bit[2]: 1=Enable detection of pulse train of
                            frequency 15Hz or higher and generate an active
                            low pulse for its duration to use for 200msec as the
                            ring indicator function on nRI2 pin. The leading
                            high-to-low edge is the trigger for the ring
                            indication.
                            0=Ring indicate function is high-to-low transition on
                            the nRI2 pin.
                            Bit[5:3] Reserved
                            Bit[6] XTAL CAP. This bit is used to specify the
                            load capacitance of the 32kHz XTAL: 0=12pF
                            (Default), 1=6pF.
                            Bit[7] P17/P12. 0=the function of P17/P12 on GP12
                            (pin 79) and GP64 (pin 87) is P17. (Default)
                            1=the function of P17/P12 on GP12 (pin 79) and
                            GP64 (pin 87) is P12 and the keylock function is
                            not active.
                                          186


             Table 74 - Auxiliary I/O, Logical Device 8 [Logical Device Number = 0x08]
       NAME           REG INDEX                              DEFINITION                      STATE
GP10                      0xE0       General Purpose I/0 bit 1.0                               C
                                     Bit[0] In/Out : =1 Input, =0 Output
Default = 0x01                       Bit[1] Polarity : =1 Invert, =0 No Invert
on Vbat POR                          Bit[2] Group Interrupt Enable
                                     =1         Enable Combined IRQ 1
                                     =0         Disable Combined IRQ 1
                                     Bit[3] Function Select
                                     =1       nSMI
                                     =0         GPI/O
                                     Bits[6:4] Reserved
                                     Bit[7] Output Type Select
                                     1=Open Drain
                                     0=Push Pull
GP11                      0xE1       General Purpose I/0 bit 1.1                               C
Default = 0x01                       Bit[0] In/Out : =1 Input, =0 Output
on Vbat POR                          Bit[1] Polarity : =1 Invert, =0 No Invert
                                     Bit[2] Group Interrupt Enable
                                     =1         Enable Combined IRQ 1
                                     =0         Disable Combined IRQ 1
                                     Bit[4:3] Function Select
                                     =00 GPI/O
                                     =01 nRING
                                     =10        Either Edge Triggered Interrupt 1
                                     =11        Reserved
                                     Bits[6:5] Reserved
                                     Bit[7] Output Type Select
                                     1=Open Drain
                                     0=Push Pull
GP12                      0xE2       General Purpose I/0 bit 1.2                               C
                                     Bit[0] In/Out : =1 Input, =0 Output
Default = 0x01                       Bit[1] Polarity :=1 Invert, =0 No Invert
on Vbat POR                          Bit[2] Group Interrupt Enable
                                     =1         Enable Combined IRQ 1
                                     =0         Disable Combined IRQ 1
                                     Bit[4:3] Function Select
                                     =00 GPI/O
                                     =01 WDT
                                     =10 P17/P121
                                     =11        Either Edge Triggered Interupt 2
                                     Bits[6:5] Reserved
                                     Bit[7] Output Type Select
                                     1=Open Drain
                                     0=Push Pull
                                     Note 1: This function is selected via bit 7 of the Ring
                                     Filter Select Register. Default is P17.
                                                   187


       NAME    REG INDEX                         DEFINITION        STATE
GP13             0xE3    General Purpose I/0 bit 1.3                 C
                         Bit[0] In/Out : =1 Input, =0 Output
Default = 0x01           Bit[1] Polarity : =1 Invert, =0 No Invert
on Vbat POR              Bit[2] Group Interrupt Enable
                         =1         Enable Combined IRQ 1
                         =0         Disable Combined IRQ 1
                         Bit[3] Function Select
                         =1         LED
                         =0         GPI/O
                         Bits[6:4] Reserved
                         Bit[7] Output Type Select
                         1=Open Drain
                         0=Push Pull
GP14             0xE4    General Purpose I/0 bit 1.4                 C
                         Bit[0] In/Out : =1 Input, =0 Output
Default = 0x01           Bit[1] Polarity : =1 Invert, =0 No Invert
on Vbat POR              Bit[2] Group Interrupt Enable
                         =1         Enable Combined IRQ 1
                         =0         Disable Combined IRQ 1
                         Bit[3] Function Select
                         =1         IRRX2
                         =0         GPI/O
                         Bits[6:4] Reserved
                         Bit[7] Output Type Select
                         1=Open Drain
                         0=Push Pull
GP15             0xE5    General Purpose I/0 bit 1.5                 C
                         Bit[0] In/Out : =1 Input, =0 Output
Default = 0x01           Bit[1] Polarity : =1 Invert, =0 No Invert
on Vbat POR              Bit[2] Group Interrupt Enable
                         =1         Enable Combined IRQ 1
                         =0         Disable Combined IRQ 1
                         Bit[3] Function Select
                         =1 IRTX2
                         =0 GPI/O
                         Bits[6:4] Reserved
                         Bit[7] Output Type Select
                         1=Open Drain
                         0=Push Pull
GP16             0xE6    General Purpose I/0 bit 1.6                 C
                         Bit[0] In/Out : =1 Input, =0 Output
Default = 0x01           Bit[1] Polarity : =1 Invert, =0 No Invert
on Vbat POR              Bit[2] Group Interrupt Enable
                         =1         Enable Combined IRQ 1
                         =0         Disable Combined IRQ 1
                         Bit[3] Function Select
                                       188


       NAME    REG INDEX                         DEFINITION        STATE
                         =1 nMTR1
                         =0 GPI/O
                         Bits[6:4] Reserved
                         Bit[7] Output Type Select
                         1=Open Drain
                         0=Push Pull
GP17             0xE7    General Purpose I/0 bit 1.7                 C
                         Bit[0] In/Out : =1 Input, =0 Output
Default = 0x01           Bit[1] Polarity : =1 Invert, =0 No Invert
on Vbat POR              Bit[2] Group Interrupt Enable
                         =1         Enable Combined IRQ 1
                         =0         Disable Combined IRQ 1
                         Bit[3] Function Select
                         =1 nDS1
                         =0 GPI/O
                         Bits[6:4] Reserved
                         Bit[7] Output Type Select
                         1=Open Drain
                         0=Push Pull
GP50             0xC8    General Purpose I/0 bit 5.0
                         Bit[0] In/Out : =1 Input, =0 Output
Default = 0x01           Bit[1] Polarity : =1 Invert, =0 No Invert
on Vbat POR              Bit[2] Reserved
                         Bit[4:3] Function Select
                         =00 PCI Clock
                         =01 IRQ14
                         =10 GPI/O
                         =11 Reserved
                         Bit[5] Group Interrupt Enable
                         =1 Enable Combined IRQ 2
                         =0 Disable Combined IRQ 2
                         Bit[6] Reserved
                         Bit[7] Output Type Select
                         1=Open Drain
                         0=Push Pull
GP52             0xCA    General Purpose I/0 bit 5.2
                         Bit[0] In/Out : =1 Input, =0 Output
Default =0x09            Bit[1] Polarity : =1 Invert, =0 No Invert
on Vbat POR              Bit[2] Reserved
                         Bit[4:3] Function Select
                         =00 DRVDEN1
                         =01 GPIO
                         =10 IRQ8
                         =11 nSMI
                         Bit[5] Group Interrupt Enable
                         =1 Enable Combined IRQ 2
                                       189


       NAME    REG INDEX                         DEFINITION        STATE
                         =0 Disable Combined IRQ 2
                         Bit[6] Reserved
                         Bit[7] Output Type Select
                         1=Open Drain
                         0=Push Pull
GP53             0xCB    General Purpose I/0 bit 5.3
                         Bit[0] In/Out : =1 Input, =0 Output
Default =0x01            Bit[1] Polarity : =1 Invert, =0 No Invert
on Vbat POR              Bit[2] Reserved
                         Bit[4:3] Function Select
                         =00 nROMCS
                         =01 IRQ11
                         =10 GPI/O
                         =11 Either Edge Triggered Interrupt 3
                         Bit[5] Group Interrupt Enable
                         =1         Enable Combined IRQ 2
                         =0 Disable Combined IRQ 2
                         Bit[6] Reserved
                         Bit[7] Output Type Select
                         1=Open Drain
                         0=Push Pull
GP54             0xCC    General Purpose I/0 bit 5.4
                         Bit[0] In/Out : =1 Input, =0 Output
Default = 0x01           Bit[1] Polarity : =1 Invert, =0 No Invert
on Vbat POR              Bit[2] Reserved
                         Bit[4:3] Function Select
                         =00 nROMOE
                         =01 IRQ12
                         =10 GPI/O
                         =11 Either Edge Triggered Interrupt 4
                         Bit[5] Group Interrupt Enable
                         =1         Enable Combined IRQ 2
                         =0 Disable Combined IRQ 2
                         Bit[6] Reserved
                         Bit[7] Output Type Select
                         1=Open Drain
                         0=Push Pull
GP60             0xD0    General Purpose I/0 bit 6.0
                         Bit[0] In/Out : =1 Input, =0 Output
Default = 0x01           Bit[1] Polarity : =1 Invert, =0 No Invert
on Vbat POR              Bit[2] Reserved
                         Bit[4:3] Function Select
                         =00 RD0
                         =01 IRQ1
                         =10 GPI/O
                         =11 nSMI
                                       190


       NAME    REG INDEX                         DEFINITION        STATE
                         Bit[5] Group Interrupt Enable
                         =1 Enable Combined IRQ 2
                         =0 Disable Combined IRQ 2
                         Bit[6] Reserved
                         Bit[7] Output Type Select
                         1=Open Drain
                         0=Push Pull
GP61             0xD1    General Purpose I/0 bit 6.1
                         Bit[0] In/Out : =1 Input, =0 Output
Default = 0x01           Bit[1] Polarity : =1 Invert, =0 No Invert
on Vbat POR              Bit[2] Reserved
                         Bit[4:3] Function Select
                         =00 RD1
                         =01 IRQ3
                         =10 GPI/O
                         =11 LED
                         Bit[5] Group Interrupt Enable
                         =1 Enable Combined IRQ 2
                         =0 Disable Combined IRQ 2
                         Bit[6] Reserved
                         Bit[7] Output Type Select
                         1=Open Drain
                         0=Push Pull
GP62             0xD2    General Purpose I/0 bit 6.2
                         Bit[0] In/Out : =1 Input, =0 Output
Default = 0x01           Bit[1] Polarity : =1 Invert, =0 No Invert
on Vbat POR              Bit[2] Reserved
                         Bit[4:3] Function Select
                         =00 RD2
                         =01 IRQ4
                         =10 GPI/O
                         =11 nRING
                         Bit[5] Group Interrupt Enable
                         =1 Enable Combined IRQ 2
                         =0 Disable Combined IRQ 2
                         Bit[6] Reserved
                         Bit[7] Output Type Select
                         1=Open Drain
                         0=Push Pull
GP63             0xD3    General Purpose I/0 bit 6.3
                         Bit[0] In/Out : =1 Input, =0 Output
Default = 0x01           Bit[1] Polarity : =1 Invert, =0 No Invert
on Vbat POR              Bit[2] Reserved
                         Bit[4:3] Function Select
                         =00 RD3
                         =01 IRQ5
                                       191


       NAME    REG INDEX                         DEFINITION                      STATE
                         =10 GPI/O
                         =11 WDT
                         Bit[5] Group Interrupt Enable
                         =1 Enable Combined IRQ 2
                         =0 Disable Combined IRQ 2
                         Bit[6] Reserved
                         Bit[7] Output Type Select
                         1=Open Drain
                         0=Push Pull
GP64             0xD4    General Purpose I/0 bit 6.4
                         Bit[0] In/Out : =1 Input, =0 Output
Default = 0x01           Bit[1] Polarity : =1 Invert, =0 No Invert
on Vbat POR              Bit[2] Reserved
                         Bit[4:3] Function Select
                         =00 RD4
                         =01 IRQ6
                         =10 GPI/O
                         =11 P17/P121
                         Bit[5] Group Interrupt Enable
                         =1 Enable Combined IRQ 2
                         =0 Disable Combined IRQ 2
                         Bit[6] Reserved
                         Bit[7] Output Type Select
                         1=Open Drain
                         0=Push Pull
                         Note 1: This function is selected via bit 7 of the Ring
                         Filter Select Register. Default is P17.
GP65             0xD5    General Purpose I/0 bit 6.5
                         Bit[0] In/Out : =1 Input, =0 Output
Default = 0x01           Bit[1] Polarity : =1 Invert, =0 No Invert
on Vbat POR              Bit[2] Reserved
                         Bit[4:3] Function Select
                         =00 RD5
                         =01 IRQ7
                         =10 GPI/O
                         =11 Reserved
                         Bit[5] Group Interrupt Enable
                         =1 Enable Combined IRQ 2
                         =0 Disable Combined IRQ 2
                         Bit[6] Reserved
                         Bit[7] Output Type Select
                         1=Open Drain
                         0=Push Pull
GP66             0xD6    General Purpose I/0 bit 6.6
                         Bit[0] In/Out : =1 Input, =0 Output
Default = 0x01           Bit[1] Polarity : =1 Invert, =0 No Invert
                                       192


       NAME    REG INDEX                         DEFINITION        STATE
on Vbat POR              Bit[2] Reserved
                         Bit[4:3] Function Select
                         =00 RD6
                         =01 IRQ8
                         =10 GPI/O
                         =11 Reserved
                         Bit[5] Group Interrupt Enable
                         =1 Enable Combined IRQ 2
                         =0 Disable Combined IRQ 2
                         Bit[6] Reserved
                         Bit[7] Output Type Select
                         1=Open Drain
                         0=Push Pull
GP67             0xD7    General Purpose I/0 bit 6.7
                         Bit[0] In/Out : =1 Input, =0 Output
Default = 0x01           Bit[1] Polarity : =1 Invert, =0 No Invert
on Vbat POR              Bit[2] Reserved
                         Bit[4:3] Function Select
                         =00 RD7
                         =01 IRQ10
                         =10 GPI/O
                         =11 Reserved
                         Bit[5] Group Interrupt Enable
                         =1 Enable Combined IRQ 2
                         =0 Disable Combined IRQ 2
                         Bit[6] Reserved
                         Bit[7] Output Type Select
                         1=Open Drain
                         0=Push Pull
GP_INT2          0xEF    General Purpose I/O Combined Interrupt 2
                         Bits[2:0] Reserved, = 000
Default = 0x00           Bit[3] GP IRQ Filter Select
on Vbat POR              0=         Debounce Filter Bypassed
                         1=         Debounce Filter Enabled
                         Bits[7:4] Combined IRQ mapping
                         1111 = IRQ15
                         .........
                         0011 = IRQ3
                         0010 = Invalid
                         0001 = IRQ1
                         0000 = Disable
GP_INT1          0xF0    General Purpose I/O Combined Interrupt 1    C
                         Bits[2:0] Reserved, = 000
Default = 0x00           Bit[3] GP IRQ Filter Select
on Vbat POR              0 = Debounce Filter Bypassed
                         1 = Debounce Filter Enabled
                                       193


       NAME    REG INDEX                        DEFINITION                          STATE
                         Bits[7:4] Combined IRQ mapping
                         1111 = IRQ15
                         .........
                         0011 = IRQ3
                         0010 = Invalid
                         0001 = IRQ1
                         0000 = Disable
WDT_UNITS        0xF1    Watch Dog Timer Units                                        C
                         Bits[6:0] Reserved, = 00000
Default = 0x00           Bit[7] WDT Time-out Value Units Select
on Vcc POR or            = 0 Minutes (default)
Reset_Drv                = 1 Seconds
                         Note: If the logical device's activate bit is not set then
                         bits 0 and 1 have no effect.
WDT_VAL          0xF2    Watch-dog Timer Time-out Value                               C
                         Binary coded, units = minutes(default) or seconds,
Default = 0x00           selectable via Bit[7] of Reg 0xF1, LD 8.
on Vcc POR or            0x00 Time out disabled
Reset_Drv                0x01 Time-out = 1 minute/second
                         .........
                         0xFF Time-out = 255 minutes/seconds
                                      194


        NAME         REG INDEX                           DEFINITION                           STATE
WDT_CFG                0xF3    Watch-dog timer Configuration                                    C
                               Bit[0] Joy-stick Enable
Default = 0x00                 =1          WDT is reset upon an I/O read or write of the
On VTR POR                                 Game Port
Bits[0,2-7] are also           =0          WDT is not affected by I/O reads or writes to
cleared on VCC POR                         the Game Port.
or RESET_DRV                   Bit[1] Keyboard Enable
                               =1          WDT is reset upon a Keyboard interrupt.
                               =0          WDT is not affected by Keyboard interrupts.
                               Bit[2] Mouse Enable
                               =1          WDT is reset upon a Mouse interrupt
                               =0          WDT is not affected by Mouse interrupts.
                               Bit[3] PWRLED Time-out enable
                               =1          Enables the Power LED to toggle at a 1Hz
                                           rate with 50 percent duty cycle while the
                                           Watch-dog Status bit is set.
                               =0          Disables the Power LED toggle during Watch-
                                           dog timeout status.
                               Bits[7:4] WDT Interrupt Mapping
                               1111 = IRQ15
                               .........
                               0011 = IRQ3
                               0010 = Invalid
                               0001 = IRQ1
                               0000 = Disable
WDT_CTRL               0xF4    Watch-dog timer Control                                          C
                               Bit[0] Watch-dog Status Bit, R/W
Default = 0x00                 =1          WD timeout occurred
                               =0          WD timer counting
                               Bit[1] Power LED Toggle Enable, R/W
Cleared by VTR                 =1          Toggle Power LED at 1Hz rate with 50 percent
POR                                        duty cycle. (1/2 sec. on, 1/2 sec. off)
                               =0          Disable Power LED Toggle
                               Bit[2] Force Timeout, W
                               =1          Forces WD timeout event; this bit is self-clearing
                               Bit[3] P20 Force Timeout Enable, R/W
                               =1          Allows rising edge of P20, from the Keyboard
                                           Controller, to force the WD timeout event. A WD
                                           timeout event may still be forced by setting the
                                           Force Timeout Bit, bit 2.
                               =0          P20 activity does not generate the WD timeout
                                           event.
                               Note: The P20 signal will remain high for a minimum of
                               1us and can remain high indefinitely. Therefore, when P20
                               forced timeouts are enabled, a self-clearing edge-detect
                               circuit is used to generate a signal which is ORed with the
                                               195


       NAME    REG INDEX                          DEFINITION                          STATE
                         signal generated by the Force Timeout Bit.
                         Bit[4] Reserved. Set to 0.
                         Bit[5] Stop_Cnt: This is used to terminate Delay 2 (Note
                                    1) without generating a power down. This is
                                    used if the software determines that the power
                                    down should be aborted. When read, this bit
                                    indicates the following: Stop_Cnt = 0; Counter
                                    running Stop_Cnt = 1; Counter Stopped. Note:
                                    The write is self clearing.
                         Bit[6] Restart_Cnt: This is used to restart Delay 2 (Note
                                    1) from the button input to the generation of the
                                    power down. When restarted, the count will
                                    start over and delay the power down for the
                                    time that Delay 2 is set for (Default=500msec).
                                    The software can continue to do this
                                    indefinately with out allowing a powerdown.
                                    This bit is self clearing. 1=Restart;
                                    Automatically cleared.
                         Bit[7] SPOFF: This is used to force a software power
                                     down. This bit is self clearing.
                         Note 1: This delay is programmable via the Delay 2
                         Time Set Register at Logical Device 8, 0xB8.
GP1              0xF6    This register is used to read the value of the GPIO
                         pins.
Default = 0x00
                         Bit[0]: GP10
on Vbat POR
                         Bit[1]: GP11
                         Bit[2]: GP12
                         Bit[3]: GP13
                         Bit[4]: GP14
                         Bit[5]: GP15
                         Bit[6]: GP16
                         Bit[7]: GP17
GP5              0xF9    This register is used to read the value of the GPIO
                         pins.
Default = 0x00           Bit[0]: GP50
on Vbat POR              Bit[1]: GP51
                         Bit[2]: GP52
                         Bit[3]: GP53
                         Bit[4]: GP54
                         Bit[7:5]: Reserved
GP6              0xFA    This register is used to read the value of the GPIO
                         pins.
Default = 0x00           Bit[0]: GP60
on Vbat POR              Bit[1]: GP61
                         Bit[2]: GP62
                         Bit[3]: GP63
                                        196


      NAME            REG INDEX                       DEFINITION                      STATE
                                    Bit[4]: GP64
                                    Bit[5]: GP65
                                    Bit[6]: GP66
                                    Bit[7]: GP67
Note:  Registers GP1, WDT_CTRL, GP5-6, Soft Power Enable and Status Registers are also available
       at index 01-0F when not in configuration mode.
Note: GP10-17 can be enabled onto GPINT1; GP50-54 and GP60-67 can be enabled onto GPINT2.
                                                 197


ACPI, Logical Device A
                Table 75 - ACPI, Logical Device A [Logical Device Number = 0x0A]
      NAME        REG INDEX                               DEFINITION                          STATE
 Sleep/Wake      0xF0             This register is used to configure the functionality of the   C
 Configuration                    SLP_EN bit and its associated logic, and the WAK_STS
                                  bit bit and its associated logic.
 Default = 0x00                   Bit[0] SLP_CTRL. SLP_EN Bit Function.
 on Vbat POR                       0=Default. Writing ‘1’ to the SLP_EN bit causes the
                                      system to sequence into the sleeping state
                                      associated with the SLP_TYPx fields.
                                   1=Writing ‘1’ to the SLP_EN bit does not cause the
                                      system to sequence into the sleeping state
                                      associated with the SLP_TYPx fields; instead an SMI
                                      is generated.
                                  Note: the SLP_EN_SMI bit in the SMI Status Register 2
                                      is set whenever ‘1’ is written to the SLP_EN bit; it is
                                      enabled to generate an SMI through bit[0] of this
                                      register.
                                  Bit[1] WAK_CTRL. WAK_STS Bit Function
                                   0=Default. The WAK_STS bit is set on the high-to-low
                                      transition of nPowerOn.
                                   1=The WAK_STS bit is set upon any enabled wakeup
                                      event and the high-to-low transition of nPowerOn.
                                  Bits[2:7] Reserved
                                                   198


OPERATIONAL DESCRIPTION
MAXIMUM GUARANTEED RATINGS*
Operating Temperature Range.....................................................................................................0oC to +70oC
Storage Temperature Range ..................................................................................................... -55o to +150oC
Lead Temperature Range (soldering, 10 seconds) ...............................................................................+325oC
Positive Voltage on any pin, with respect to Ground ...........................................................................Vcc+0.3V
Negative Voltage on any pin, with respect to Ground............................................................................... -0.3V
Maximum Vcc ............................................................................................................................................... +7V
*Stresses above those listed above could cause permanent damage to the device. This is a stress rating
only and functional operation of the device at any other condition above those indicated in the operation
sections of this specification is not implied.
Note: When powering this device from laboratory or system power supplies, it is important that the
Absolute Maximum Ratings not be exceeded or device failure can result. Some power supplies exhibit
voltage spikes on their outputs when the AC power is switched on or off. In addition, voltage transients on
the AC power line may appear on the DC output. If this possibility exists, it is suggested that a clamp circuit
be used.
DC ELECTRICAL CHARACTERISTICS
 (TA = 0°C - 70°C, Vcc = +5 V ± 10%)
            PARAMETER                          SYMBOL                MIN           TYP           MAX            UNITS                 COMMENTS
 I Type Input Buffer
 Low Input Level                                    VILI                                           0.8              V           TTL Levels
 High Input Level                                   VIHI              2.0                                           V
 IS Type Input Buffer
 Low Input Level                                   VILIS                                           0.8              V           Schmitt Trigger
 High Input Level                                  VIHIS              2.2                                           V           Schmitt Trigger
 Schmitt Trigger Hysteresis                        VHYS                             250                            mV
 ICLK Input Buffer
 Low Input Level                                   VILCK                                           0.4              V
 High Input Level                                  VIHCK              2.2                                           V
 Input Leakage
   (All I and IS buffers)
 Low Input Leakage                                   IIL              -10                         +10              μA           VIN = 0
 High Input Leakage                                  IIH              -10                         +10              μA           VIN = VCC
                                                                         199


        PARAMETER   SYMBOL MIN   TYP MAX  UNITS      COMMENTS
OCLK2 Type Buffer
Low Output Level      VOL            0.4    V   IOL = 2 mA
High Output Level     VOH  3.5              V   IOH = -2 mA
Output Leakage        IOL  -10       +10   μA   VIN = 0 to VCC
                                                (Note 1)
IO4 Type Buffer
Low Output Level      VOL            0.4    V   IOL = 4 mA
High Output Level     VOH  2.4              V   IOH = -2 mA
Output Leakage        IOL  -10       +10   μA   VIN = 0 to VCC
                                                (Note 1)
IOP4 Type Buffer
Low Output Level      VOL            0.4    V   IOL = 4 mA
High Output Level     VOH  2.4              V   IOH = -2 mA
Output Leakage        IOL  -10       +10   μA   VIN = 0 to VCC
                                                (Note 1)
Backdrive Protected    IIL           ± 10  μA   VCC=0V; VCC=VTR =0V
                                                VIN = 6V Max
O4 Type Buffer
Low Output Level      VOL            0.4    V   IOL = 4 mA
High Output Level     VOH  2.4              V   IOH = -2 mA
Output Leakage        IOL  -10       +10   μA   VIN = 0 to VCC
                                                (Note 1)
O8 Type Buffer
Low Output Level      VOL            0.4    V   IOL = 8 mA
High Output Level     VOH  2.4              V   IOH = -4 mA
Output Leakage        IOL  -10       +10   μA   VIN = 0 to VCC
                                                (Note 1)
                             200


        PARAMETER   SYMBOL MIN   TYP MAX  UNITS      COMMENTS
IO12 Type Buffer
Low Output Level      VOL            0.4    V   IOL = 12 mA
High Output Level     VOH  2.4              V   IOH = -6 mA
Output Leakage        IOL  -10       +10   μA   VIN = 0 to VCC
                                                (Note 1)
O12 Type Buffer
Low Output Level      VOL            0.4    V   IOL = 12 mA
High Output Level     VOH  2.4              V   IOH = -6 mA
Output Leakage        IOL  -10       +10   μA   VIN = 0 to VCC
                                                (Note 1)
OD12 Type Buffer
Low Output Level      VOL            0.4    V   IOL = 12 mA
Output Leakage        IOL  -10       +10   μA   VIN = 0 to VCC
                                                (Note 1)
OP12 Type Buffer
Low Output Level      VOL            0.4    V   IOL = 12 mA
High Output Level     VOH  2.4              V   IOH = -6 mA
Output Leakage        IOL  -10       +10   μA   VIN = 0 to VCC
Backdrive Protected    IIL           ± 10  μA   VCC=0V; VCC=VTR =0V
                                                VIN = 6V Max
IOP14 Type Buffer
Low Output Level      VOL            0.4    V   IOL = 14 mA
High Output Level     VOH  2.4              V   IOH = -14 mA
Output Leakage        IOL  -10       +10   μA   VIN = 0 to VCC
                                                (Note 1)
Backdrive Protected    IIL           ± 10  μA   VCC=0V; VCC=VTR =0V
                                                VIN = 6V Max
                             201


        PARAMETER        SYMBOL MIN   TYP MAX  UNITS      COMMENTS
OD14 Type Buffer
Low Output Level           VOL            0.4    V   IOL = 14 mA
Output Leakage             IOL  -10       +10   μA   VIN = 0 to VCC
                                                     (Note 1)
OP14 Type Buffer
Low Output Level           VOL            0.4    V   IOL = 14 mA
High Output Level          VOH  2.4              V   IOH = -14 mA
Output Leakage             IOL  -10       +10   μA   VIN = 0 to VCC
Backdrive Protected         IIL           ± 10  μA   VCC=0V; VCC=VTR =0V
                                                     VIN = 6V Max
IOD16 Type Buffer
Low Output Level           VOL            0.4    V   IOL = 16 mA
Output Leakage             IOL  -10             μA   VIN = 0 to VCC
O24 Type Buffer
Low Output Level           VOL            0.4    V   IOL = 24 mA
High Output Level          VOH  2.4              V   IOH = -12 mA
Output Leakage             IOL  -10       +10   μA   VIN = 0 to VCC (Note
                                                     1)
O24PD Type Buffer
Low Output Level           VOL            0.4    V   IOL = 24 mA
High Output Level          VOH  2.4              V   IOH = -12 mA
Output Leakage             IOL  -10       +10   μA   VIN = 0 to VCC
                                                     (Note 1)
OD24 Type Buffer
Low Output Level           VOL            0.4    V   IOL = 24 mA
Output Leakage             IOL            +10   μA   VIN = 0 to VCC
                                                     (Note 1)
ChiProtect                  IIL           ± 10  μA   VCC=0V; VCC=VTR
(SLCT, PE, BUSY, nACK,                               =0V
nERROR, GP10-GP17, GP50-                             VIN = 6V Max
GP54, GP60-GP67,)
                                  202


           PARAMETER              SYMBOL       MIN      TYP      MAX       UNITS           COMMENTS
 Backdrive                            IIL                         ± 10       μA       VCC=0V; VCC=VTR
 (nSTROBE, nAUTOFD, nINIT,                                                            =0V
 nSLCTIN, PD0-PD7, GP10-                                                              VIN = 6V Max
 GP17, GP50-GP54, GP60-
 GP67, nSMI, IRQ8)
 VCC Supply Current Active           ICCI       4.5      30        40        mA       All outputs open.
 Trickle Supply Voltage              VTR       VCC                VCC          V      VCC must not be
 (Note 4)                                      min                max                 greater than .5V
                                               -.5V                                   above VTR
 VTR Supply Current Active3          IVRI                          25        mA       All outputs open.
 Battery Supply Voltage3             VBAT       2.4      3.0       4.0         V
 VBAT Supply Current3                           2.0
 Standby                                                 2.0       3.0       μA       VCC=VTR=VSS =0V
 Input Leakage                                                    100         nA      VCC=5V, VBAT=3V
Note 1: Output leakage is are measured with the current pins in high impedance.
Note 2: Output leakage is measured with the low driving output off, either for a high level output or a high
          impedance state.
Note 3: Please contact SMSC for the latest values.
Note 4: The minimum values given for VTR is for VCC active. When VCC=0, the minimum value given for
          VTR is 0V.
CAPACITANCE TA = 25°C; fc = 1MHz; VCC = 5V
                                                    LIMITS
        PARAMETER             SYMBOL        MIN      TYP      MAX        UNIT         TEST CONDITION
 Clock Input Capacitance         CIN                           20          pF       All pins except pin
 Input Capacitance               CIN                           10          pF       under test tied to AC
 Output Capacitance             COUT                           20          pF       ground
                                                  203


AC TIMING
CAPACITIVE LOADING
For the Timing Diagrams shown, the following capacitive loads (TABLE 76) are used.
                               TABLE 76 - CAPACITIVE LOADING
                                                         CAPACITANCE
                                  NAME                     TOTAL (pF)
                                  SD[0:7]                      120
                                IOCHRDY                        120
                             IRQ[3:7,10:12]                     60
                                 DRQ[1:3]                       60
                                 nWGATE                        240
                                 nWDATA                        240
                                 nHDSEL                        240
                                   nDIR                        240
                                  nSTEP                        240
                                 nDS[1:0]                      240
                                nMTR[1:0]                      240
                              DRVDEN[1:0]                      240
                                   TXD1                        100
                                  nRTS1                        100
                                  nDTR1                        100
                                   TXD2                        100
                                  nRTS2                        100
                                  nDTR2                        100
                                  PD[0:7]                      240
                                 nSLCTIN                       240
                                   nINIT                       240
                                   nALF                        240
                                   nSTB                        240
                                   KDAT                        240
                                   KCLK                        240
                                  MDAT                         240
                                  MCLK                         240
                                                204


IOW Timing Port 92
                                   t3
      SAx
                                                                  t4
 SD<7:0>
                          t1
                           t2                                         t5
   nIOW
                              FIGURE 9 - IOW TIMING FOR PORT 92
                                TABLE 77 - IOW TIMING FOR PORT 92
 NAME                          DESCRIPTION                    MIN TYP MAX UNITS
   t1     SAx Valid to nIOW Asserted                           40          ns
   t2     SDATA Valid to nIOW Asserted                         0           ns
   t3     nIOW Asserted to SAx Invalid                         10          ns
   t4     nIOW Deasserted to DATA Invalid                      0           ns
   t5     nIOW Deasserted to nIOW or nIOR Asserted            100          ns
                                                205


POWER-UP TIMING
                                   t1                                   t2
          Vcc
                                                                                t3
    All Host
    Accesses
                                  FIGURE 10 - POWER-UP TIMING
                                    TABLE 78 - POWER-UP TIMING
 NAME                        DESCRIPTION                           MIN       TYP   MAX UNITS
    t1     Vcc Slew from 4.5V to 0V                                 300                 μs
    t2     Vcc Slew from 0V to 4.5V                                 100                 μs
    t3     All Host Accesses After Powerup (Note 1)                 125            500  μs
Note 1: Internal write-protection period after Vcc passes 4.5 volts on power-up
                                                    206


Button Timing
 B u tto n _ In
                                             tF                 tR
                               FIGURE 11 - BUTTON INPUT TIMING
                                  TABLE 79 - BUTTON INPUT TIMING
 NAME                            DESCRIPTION                     MIN     TYP MAX UNITS
  tR, tF   Button_In Rise/Fall Time                                          0.5  μs
                 B u tto n _ In
                                                      t1       R e le a s e
                n P o w e rO n
                                                 t2
       B la n k in g P e r io d
                                                                     t3
                           V cc
                        FIGURE 12 - BUTTON OVERRIDE TIMING
                               TABLE 80 - BUTTON OVERRIDE TIMING
 NAME                            DESCRIPTION                     MIN     TYP MAX UNITS
    t1     Button_In Hold Time For Override Event                  4              μs
    t2     Button _In Low To nPowerOn Tristate and Vcc Low and             4      μs
           Start of Blanking Period
    t3     Blanking Period After Release of Button_In                      4      μs
                                                  207


ROM INTERFACE
 nR O M C S
 nRO M O E
                         t2                                  t7 N o te 2
                             t1                t3         t2               t8  t3
       R D [x]
                            N o te 1                              t4
                                                              t5            t6
       S D [x]
                            FIGURE 13 - ROM INTERFACE TIMING
Note 1: RD[x] driven by FDC37B72x, SD[x] driven by system
Note 2: RD[x] driven by ROM, SD[x] driven by FDC37B72x
                               TABLE 81 - ROM INTERFACE TIMING
 NAME                       DESCRIPTION                    MIN     TYP   MAX   UNITS
    t1    SD[x] Valid to RD[x] Valid                                      25     ns
    t2    nROMCS Active to RD[X] Driven                                   25     ns
    t3    nROMCS Inactive to RD[X] Float                                  25     ns
    t4    RD[x] Valid to SD[x] Valid                                      25     ns
    t5    nROMCS Active to SD[X] Driven                                   25     ns
    t6    nROMCS Inactive to SD[X] Float                                  25     ns
    t7    nROMOE Active to RD[x] Float                                    25     ns
    t8    nROMOE Inactive to RD[x] Driven                                 25     ns
Note 1: Outputs have a 50 pf load.
                                               208


ISA WRITE
                                                                 t10
       AEN
                                     t3
  SA[x],
                                                t2
                        t1                          t4                 t6
     nIOW
                                                                  t5
      SD[x]                               DATA
                                                                   t7
    FINTR
                                                                      t8
    PINTR
                                                                         t9
         IBF
                                    FIGURE 14 - ISA WRITE TIMING
                                        TABLE 82 - ISA WRITE TIMING
  NAME                            DESCRIPTION                         MIN   TYP MAX UNITS
    t1       SA[x], nCS and AEN valid to nIOW asserted                10             ns
    t2       nIOW asserted to nIOW deasserted                         80             ns
    t3       nIOW asserted to SA[x], nCS invalid                      10             ns
    t4       SD[x] Valid to nIOW deasserted                           45             ns
    t5       SD[x] Hold from nIOW deasserted                                      0  ns
    t6       nIOW deasserted to nIOW asserted                         25             ns
    t7       nIOW deasserted to FINTR deasserted (Note 1)                        55  ns
    t8       nIOW deasserted to PINTER deasserted (Note 2)                      260  ns
    t9       IBF (internal signal) asserted from nIOW deasserted                 40  ns
   t10       nIOW deasserted to AEN invalid                           10             ns
Note 1: FINTR refers to the IRQ used by the floppy disk
Note 2: PINTR refers to the IRQ used by the parallel port
                                                      209


ISA READ
                                                                              t13
                          AEN
                                                    t3
                 SA[x], nCS
                                        t1
                                            t7                 t2                      t6
                         nIOR
                                                 t4                            t5
                         SD[x]                           DATA VALID
         PD[x], nERROR,
  PE, SLCT, ACK, BUSY
                                                                                  t10
                    FINTER
                                                     t9
                    PINTER
                                                                                  t11
                     PCOBF
                                                                                   t12
                  AUXOBF1
                                                                  t8
                nIOR/nIOW
                                      FIGURE 15 - ISA READ TIMING
                               See timing parameters on next page (TABLE 83).
                                                      210


                                     TABLE 83 - ISA READ TIMING
 NAME                           DESCRIPTION                     MIN TYP MAX UNITS
   t1    SA[x], nCS and AEN valid to nIOR asserted              10           ns
   t2    nIOR asserted to nIOR deasserted                       50           ns
   t3    nIOR asserted to SA[x], nCS invalid                    10           ns
   t4    nIOR asserted to Data Valid                                     50  ns
   t5    Data Hold/float from nIOR deasserted                   10       25  ns
   t6    nIOR deasserted                                        25           ns
   t8    nIOR asserted after nIOW deasserted                    80           ns
   t8    nIOR/nIOR, nIOW/nIOW transfers from/to ECP FIFO        150          ns
   t7    Parallel Port setup to nIOR asserted                            20  ns
   t9    nIOR asserted to PINTER deasserted                              55  ns
  t10    nIOR deasserted to FINTER deasserted                           260  ns
  t11    nIOR deasserted to PCOBF deasserted (Notes 3,5)                 80  ns
  t12    nIOR deasserted to AUXOBF1 deasserted (Notes 4,5)               80  ns
  t13    nIOW deasserted to AEN invalid                         10           ns
Note 1: FINTR refers to the IRQ used by the floppy disk.
Note 2: PINTR refers to the IRQ used by the parallel port.
Note 3: PCOBF is used for the Keyboard IRQ.
Note 4: AUXOBF1 is used for the Mouse IRQ.
Note 5: Applies only if deassertion is performed in hardware.
                                                   211


8042 CPU
                                                          t2
    PCOBF
                                                          t1
 AUXOBF1
      nWRT
                                                         t3
        IBF
       nRD
                         FIGURE 16 - INTERNAL 8042 CPU TIMING
                            TABLE 84 - INTERNAL 8042 CPU TIMING
 NAME                         DESCRIPTION                     MIN TYP MAX UNITS
   t1    nWRT deasserted to AUXOBF1 asserted (Notes 1,2)               40  ns
   t2    nWRT deasserted to PCOBF asserted (Notes 1,3)                 40  ns
   t3    nRD deasserted to IBF deasserted (Note 1)                     40  ns
Note 1: IBF, nWRT and nRD are internal signals.
Note 2: PCOBF is used for the Keyboard IRQ.
Note 3: AUXOBF1 is used for the Mouse IRQ.
                                                212


CLOCK TIMING
                                                       t2              t2
CLOCKI
                               FIGURE 17 - INPUT CLOCK TIMING
                                 TABLE 85 - INPUT CLOCK TIMING
 NAME                         DESCRIPTION                      MIN   TYP   MAX       UNITS
   t1    Clock Cycle Time for 14.318MHZ                               70               ns
   t2    Clock High Time/Low Time for 14.318MHz                       35               ns
   t1    Clock Cycle Time for 32KHZ                                  31.25             μs
   t2    Clock High Time/Low Time for 32KHz                          16.53             μs
         Clock Rise Time/Fall Time (not shown)                                5        ns
                                                    t4
RESET_DRV
                                   FIGURE 18 - RESET TIMING
                                     TABLE 86 - RESET TIMING
 NAME                           DESCRIPTION                     MIN   TYP  MAX      UNITS
    t4    RESET width (Note 1)                                   1.5                    s
Note 1: The RESET width is dependent upon the processor clock. The RESET must be active while
        the clock is running and stable.
                                                213


Single Transfer DMA
                                                                                t15
       AEN
                                               t16
                                            t3
                                                 t2
    FDRQ,
    PDRQ
                                t1                         t4
    nDACK
                                                                       t12
                            t14
                                        t11
                                   t6
                                   t5                         t8
      nIOR
         or
     nIOW
                                                                            t10
                                                    t7                       t9
     DATA
                                                                 DATA VALID
  (DO-D7)
                                                       t13
        TC
                 FIGURE 19 - SINGLE TRANSFER DMA TIMING
                 See timing parameters on next page (TABLE 87).
                                            214


                     TABLE 87 - SINGLE TRANSFER DMA TIMING
NAME                  DESCRIPTION                 MIN     TYP MAX UNITS
  t1 nDACK Delay Time from FDRQ High                0              ns
  t2 DRQ Reset Delay from nIOR or nIOW                        100  ns
  t3 FDRQ Reset Delay from nDACK Low                          100  ns
  t4 nDACK Width                                  150              ns
  t5 nIOR Delay from FDRQ High                     0               ns
  t6 nIOW Delay from FDRQ High                     0               ns
  t7 Data Access Time from nIOR Low                           100  ns
  t8 Data Set Up Time to nIOW High                 40              ns
  t9 Data to Float Delay from nIOR High            10          60  ns
 t10 Data Hold Time from nIOW High                 10              ns
 t11 nDACK Set Up to nIOW/nIOR Low                  5              ns
 t12 nDACK Hold after nIOW/nIOR High               10              ns
 t13 TC Pulse Width                                60              ns
 t14 AEN Set Up to nIOR/nIOW                       40              ns
 t15 AEN Hold from nDACK                           10              ns
 t16 TC Active to PDRQ Inactive                               100  ns
                                        215


Burst Transfer DMA Timing
                                                                                    t15
      AEN
                                                       t16
                                          t3
                                                         t2
   FDRQ,
   PDRQ
                   t1                          t4
   nDACK
                                                                            t12
                 t14
                         t11
                      t6
    nIOR              t5                                           t8
        or
    nIOW
                                                                                t10
                                                            t7                   t9
    DATA
                                     DATA VALID                       DATA VALID
 (DO-D7)
                                                               t13
       TC
                FIGURE 20 - BURST TRANSFER DMA TIMING
                See timing parameters on next page (TABLE 88).
                                             216


                      TABLE 88 - BURST TRANSFER DMA TIMING
NAME                  DESCRIPTION                 MIN     TYP MAX UNITS
  t1 nDACK Delay Time from FDRQ High                0              ns
  t2 DRQ Reset Delay from nIOR or nIOW                        100  ns
  t3 FDRQ Reset Delay from nDACK Low                          100  ns
  t4 nDACK Width                                  150              ns
  t5 nIOR Delay from FDRQ High                     0               ns
  t6 nIOW Delay from FDRQ High                     0               ns
  t7 Data Access Time from nIOR Low                           100  ns
  t8 Data Set Up Time to nIOW High                 40              ns
  t9 Data to Float Delay from nIOR High            10          60  ns
 t10 Data Hold Time from nIOW High                 10              ns
 t11 nDACK Set Up to nIOW/nIOR Low                  5              ns
 t12 nDACK Hold after nIOW/nIOR High               10              ns
 t13 TC Pulse Width                                60              ns
 t14 AEN Set Up to nIOR/nIOW                       40              ns
 t15 AEN Hold from nDACK                           10              ns
 t16 TC Active to PDRQ Inactive                               100  ns
                                        217


DISK DRIVE TIMING
                                                                  t3
     nDIR
                                                           t4
                             t1               t2
   nSTEP
                                                                   t5
  nDS0-3
                                           t6
  nINDEX
                                           t7
 nRDATA
                                           t8
 nWDATA
    nIOW
                       t9                                                    t9
  nDS0-1,
  MTR0-1
                     FIGURE 21 - DISK DRIVE TIMING (AT MODE ONLY)
                          TABLE 89 - DISK DRIVE TIMING (AT MODE ONLY)
   NAME                     DESCRIPTION                       MIN     TYP MAX   UNITS
      t1    nDIR Set Up to STEP Low                                     4        X*
      t2    nSTEP Active Time Low                                      24        X*
      t3    nDIR Hold Time after nSTEP                                 96        X*
      t4    nSTEP Cycle Time                                          132        X*
      t5    nDS0-1 Hold Time from nSTEP Low                            20        X*
      t6    nINDEX Pulse Width                                         2         X*
      t7    nRDATA Active Time Low                                     40        ns
      t8    nWDATA Write Data Width Low                                .5        Y*
      t9    nDS0-1, MTRO-1 from End of nIOW                            25        ns
*X specifies one MCLK period and Y specifies one WCLK period.
MCLK = 16 x Data Rate (at 500 kb/s MCLK = 8 MHz)
WCLK = 2 x Data Rate (at 500 kb/s WCLK = 1 MHz)
                                                 218


SERIAL PORT
     nIOW
                                               t1
   nRTSx,
   nDTRx
                                                  t5
      IRQx
   nCTSx,
   nDSRx,
   nDCDx
                                                                      t6
                                      t2                           t4
      IRQx
     nIOW
                                                     t3
      IRQx
     nIOR
       nRIx
                                 FIGURE 22 - SERIAL PORT TIMING
                                   TABLE 90 - SERIAL PORT TIMING
 NAME                           DESCRIPTION                     MIN      TYP MAX UNITS
  t1        nRTSx, nDTRx Delay from nIOW                                     200  ns
  t2        IRQx Active Delay from nCTSx, nDSRx, nDCDx                       100  ns
  t3        IRQx Inactive Delay from nIOR (Leading Edge)                     120  ns
  t4        IRQx Inactive Delay from nIOW (Trailing Edge)                    125  ns
  t5        IRQx Inactive Delay from nIOW                        10          100  ns
  t6        IRQx Active Delay from nRIx                                      100  ns
                                                   219


PARALLEL PORT
               PD0- PD7
                                     t6
                   nIOW
                                                                   t1
       nINIT, nSTROBE.
      nAUTOFD, SLCTIN
                   nACK
                                       t2
                 nPINTR
                 (SPP)
                                                                       t4    t3
                  PINTR
  (ECP or EPP Enabled)
          nFAULT (ECP)
               nERROR
               (ECP)
                                                        t5
                                                          t2 t3
                  PINTR
                              FIGURE 23 - PARALLEL PORT TIMING
                                TABLE 91 - PARALLEL PORT TIMING
 NAME                          DESCRIPTION                     MIN    TYP MAX   UNITS
   t1     PD0-7, nINIT, nSTROBE, nAUTOFD Delay from nIOW                  100    ns
   t2     PINTR Delay from nACK, nFAULT                                    60    ns
   t3     PINTR Active Low in ECP and EPP Modes                 200       300    ns
   t4     PINTR Delay from nACK                                           105    ns
   t5     nERROR Active to PINTR Active                                   105    ns
   t6     PD0 - PD7 Delay from IOW Active                                 100    ns
Note:    PINTR refers to the IRQ used by the parallel port.
                                                   220


EPP 1.9 DATA OR ADDRESS WRITE CYCLE
                                                                    t18
    A0-A10
                                                                      t9
   SD<7:0>
                 t17
                  t8                                           t12       t19
       nIOW
                            t10                       t11
  IOCHRDY
                      t13
                     t22
                   t20                                                    t2
     nWRITE
                       t1                                                 t5
   PD<7:0>
                                t16
                                t3
                          t14                              t4
    nDATAST
 nADDRSTB
                                            t15
                                       t6                          t7
      nWAIT
             t21
       PDIR
             FIGURE 24 - EPP 1.9 DATA OR ADDRESS WRITE CYCLE
                    See timing parameters on next page (TABLE 92).
                                          221


                 TABLE 92 - EPP 1.9 DATA OR ADDRESS WRITE CYCLE TIMING
 NAME                           DESCRIPTION                              MIN   TYP   MAX      UNITS
   t1    nIOW Asserted to PDATA Valid                                      0          50        ns
   t2    nWAIT Asserted to nWRITE Change (Note 1)                         60         185        ns
   t3    nWRITE to Command Asserted                                       5           35        ns
   t4    nWAIT Deasserted to Command Deasserted                           60         190        ns
         (Note 1)
   t5    nWAIT Asserted to PDATA Invalid (Note 1)                          0                    ns
   t6    Time Out                                                         10          12        μs
   t7    Command Deasserted to nWAIT Asserted                             0                     ns
   t8    SDATA Valid to nIOW Asserted                                     10                    ns
   t9    nIOW Deasserted to DATA Invalid                                   0                    ns
  t10    nIOW Asserted to IOCHRDY Asserted                                0           24        ns
  t11    nWAIT Deasserted to IOCHRDY Deasserted                           60         160        ns
         (Note 1)
  t12    IOCHRDY Deasserted to nIOW Deasserted                            10                    ns
  t13    nIOW Asserted to nWRITE Asserted                                  0          70        ns
  t14    nWAIT Asserted to Command Asserted (Note 1)                      60         210        ns
  t15    Command Asserted to nWAIT Deasserted                             0           10          s
  t16    PDATA Valid to Command Asserted                                  10                    ns
  t17    Ax Valid to nIOW Asserted                                        40                    ns
  t18    nIOW Asserted to Ax Invalid                                      10                    ns
  t19    nIOW Deasserted to nIOW or nIOR Asserted                         40                    ns
  t20    nWAIT Asserted to nWRITE Asserted (Note 1)                       60         185        ns
  t21    nWAIT Asserted to PDIR Low                                        0                    ns
  t22    PDIR Low to nWRITE Asserted                                       0                    ns
Note 1: nWAIT must be filtered to compensate for ringing on the parallel bus cable. WAIT is considered
        to have settled after it does not transition for a minimum of 50 nsec.
                                                      222


EPP 1.9 DATA OR ADDRESS READ CYCLE
                                                                         t20
    A0-A10
             t19                                                     t11        t22
        IOR
                                                     t13                 t12
 SD<7:0>
                                                             t18
                t8                                           t10
  IOCHRDY
                           t24
                          t23                                                          t27
       PDIR
                t9
                   t21                                                                 t17
    nWRITE
                       t2                              PData bus driven
                        t25                 t5         by peripheral         t4            t16
 PD<7:0>
                                t28
                                    t26
                                    t1
                               t14                                 t3
   DATASTB
  ADDRSTB
                                        t15
                                                      t7                            t6
      nWAIT
               FIGURE 25 - EPP 1.9 DATA OR ADDRESS READ CYCLE
                         See timing parameters on next page (TABLE 93)
                                               223


                   TABLE 93 - EPP 1.9 DATA OR ADDRESS READ CYCLE TIMING
 NAME                            DESCRIPTION                            MIN       TYP     MAX    UNITS
   t1    PDATA Hi-Z to Command Asserted                                   0                30     ns
   t2    nIOR Asserted to PDATA Hi-Z                                      0                50     ns
   t3    nWAIT Deasserted to Command Deasserted                          60               180     ns
         (Note 1)
   t4    Command Deasserted to PDATA Hi-Z                                 0                       ns
   t5    Command Asserted to PDATA Valid                                  0                       ns
   t6    PDATA Hi-Z to nWAIT Deasserted                                   0                       μs
   t7    PDATA Valid to nWAIT Deasserted                                  0                       ns
   t8    nIOR Asserted to IOCHRDY Asserted                                0                24     ns
   t9    nWRITE Deasserted to nIOR Asserted (Note 2)                      0                       ns
  t10    nWAIT Deasserted to IOCHRDY Deasserted                          60               160     ns
         (Note 1)
  t11    IOCHRDY Deasserted to nIOR Deasserted                            0                       ns
  t12    nIOR Deasserted to SDATA Hi-Z (Hold Time)                        0                40     ns
  t13    PDATA Valid to SDATA Valid                                       0                75     ns
  t14    nWAIT Asserted to Command Asserted                               0               195     ns
  t15    Time Out                                                        10                12     μs
  t16    nWAIT Deasserted to PDATA Driven (Note 1)                       60               190     ns
  t17    nWAIT Deasserted to nWRITE Modified (Notes 1,2)                 60               190     ns
  t18    SDATA Valid to IOCHRDY Deasserted (Note 3)                       0                85     ns
  t19    Ax Valid to nIOR Asserted                                       40                       ns
  t20    nIOR Deasserted to Ax Invalid                                   10                10     ns
  t21    nWAIT Asserted to nWRITE Deasserted                              0               185     ns
  t22    nIOR Deasserted to nIOW or nIOR Asserted                        40                       ns
  t23    nWAIT Asserted to PDIR Set (Note 1)                             60               185     ns
  t24    PDATA Hi-Z to PDIR Set                                           0                       ns
  t25    nWAIT Asserted to PDATA Hi-Z (Note 1)                           60               180     ns
  t26    PDIR Set to Command                                              0                20     ns
  t27    nWAIT Deasserted to PDIR Low (Note 1)                           60               180     ns
  t28    nWRITE Deasserted to Command                                     1                       ns
Note 1: nWAIT is considered to have settled after it does not transition for a minimum of 50 ns.
Note 2: When not executing a write cycle, EPP nWRITE is inactive high.
Note 3: 85 is true only if t7 = 0.
                                                   224


EPP 1.7 DATA OR ADDRESS WRITE CYCLE
                                                               t18
     A0-A10
                                                                t9
    SD<7:0>
                 t17                       t6
                   t8                                                t19
      nIOW                                                 t12
                           t10
                          t20                          t11
  IOCHRDY
                      t13                                                t2
    nWRITE
                       t1                                                t5
    PD<7:0>
                                t16
                               t3
  nDATAST                                                         t4
 nADDRSTB
                                                                            t21
     nWAIT
       PDIR
             FIGURE 26 - EPP 1.7 DATA OR ADDRESS WRITE CYCLE
                   See timing parameters on next page (TABLE 94).
                                        225


                 TABLE 94 - EPP 1.7 DATA OR ADDRESS WRITE CYCLE TIMING
 NAME                        DESCRIPTION                             MIN       TYP      MAX      UNITS
   t1    nIOW Asserted to PDATA Valid                                 0                  50        ns
   t2    Command Deasserted to nWRITE Change                          0                  40        ns
   t3    nWRITE to Command                                            5                  35        ns
   t4    nIOW Deasserted to Command Deasserted (Note 2)                                  50        ns
   t5    Command Deasserted to PDATA Invalid                          50                           ns
   t6    Time Out                                                     10                 12        μs
   t8    SDATA Valid to nIOW Asserted                                 10                           ns
   t9    nIOW Deasserted to DATA Invalid                               0                           ns
  t10    nIOW Asserted to IOCHRDY Asserted                            0                  24        ns
  t11    nWAIT Deasserted to IOCHRDY Deasserted                                          40        ns
  t12    IOCHRDY Deasserted to nIOW Deasserted                        10                           ns
  t13    nIOW Asserted to nWRITE Asserted                             0                  50        ns
  t16    PDATA Valid to Command Asserted                              10                 35        ns
  t17    Ax Valid to nIOW Asserted                                    40                           ns
  t18    nIOW Deasserted to Ax Invalid                                10                           μs
  t19    nIOW Deasserted to nIOW or nIOR Asserted                    100                           ns
  t20    nWAIT Asserted to IOCHRDY Deasserted                                            45        ns
  t21    Command Deasserted to nWAIT Deasserted                       0                            ns
Note 1: nWRITE is controlled by clearing the PDIR bit to "0" in the control register before performing an
        EPP Write.
Note 2: The number is only valid if nWAIT is active when IOW goes active.
                                                   226


EPP 1.7 DATA OR ADDRESS READ CYCLE
                                                                  t20
     A0-A10
                                      t15
            t19                                            t11           t22
       nIOR
                                               t13                t12
    SD<7:0>
                       t8
                           t3                        t10
  IOCHRDY
    nWRITE
                                   t5                                 t4
    PD<7:0>
                   t23
 nDATASTB                                                      t2
 nADDRSTB
                                                                          t21
      nWAIT
       PDIR
            FIGURE 27 - EPP 1.7 DATA OR ADDRESS READ CYCLE
                     See timing parameters on next page (TABLE 95).
                                          227


                 TABLE 95 - EPP 1.7 DAT OR ADDRESS READ CYCLE TIMING
 NAME                      DESCRIPTION                               MIN        TYP      MAX      UNITS
   t2  nIOR Deasserted to Command Deasserted                                              50        ns
   t3  nWAIT Asserted to IOCHRDY Deasserted                            0                  40        ns
   t4  Command Deasserted to PDATA Hi-Z                                0                            ns
   t5  Command Asserted to PDATA Valid                                 0                            ns
   t8  nIOR Asserted to IOCHRDY Asserted                                                  24        ns
  t10  nWAIT Deasserted to IOCHRDY Deasserted                                             50        ns
  t11  IOCHRDY Deasserted to nIOR Deasserted                           0                            ns
  t12  nIOR Deasserted to SDATA High-Z (Hold Time)                     0                  40        ns
  t13  PDATA Valid to SDATA Valid                                                         40        ns
  t15  Time Out                                                       10                  12        μs
  t19  Ax Valid to nIOR Asserted                                      40                            ns
  t20  nIOR Deasserted to Ax Invalid                                  10                            ns
  t21  Command Deasserted to nWAIT Deasserted                          0                            ns
  t22  nIOR Deasserted to nIOW or nIOR Asserted                       40                            ns
  t23  nIOR Asserted to Command Asserted                                                  55        ns
Note: WRITE is controlled by setting the PDIR bit to "1" in the control register before performing an EPP
      Read.
                                               228


ECP PARALLEL PORT TIMING                               The timing is designed to provide 3 cable
                                                       round-trip times for data setup if Data is driven
Parallel Port FIFO (Mode 101)                          simultaneously with HostClk (nStrobe).
The standard parallel port is run at or near the       Reverse-Idle Phase
peak 500KBytes/sec allowed in the forward direc-
tion using DMA. The state machine does not             The peripheral has no data to send and keeps
examine nACK and begins the next transfer based        PeriphClk high. The host is idle and keeps
on Busy. Refer to FIGURE 29.                           HostAck low.
ECP Parallel Port Timing                               Reverse Data Transfer Phase
The timing is designed to allow operation at           The interface transfers data and commands from
approximately 2.0 Mbytes/sec over a 15ft cable. If     the peripheral to the host using an interlocked
a shorter cable is used then the bandwidth will        HostAck and PeriphClk.          The Reverse Data
increase.                                              Transfer Phase may be entered from the Reverse-
                                                       Idle Phase. After the previous byte has beed
Forward-Idle                                           accepted the host sets HostAck (nALF) low. The
                                                       peripheral then sets PeriphClk (nACK) low when it
When the host has no data to send it keeps             has data to send. The data must be stable for the
HostClk (nStrobe) high and the peripheral will         specified setup time prior to the falling edge of
leave PeriphClk (Busy) low.                            PeriphClk. When the host is ready to accept a byte
                                                       it sets HostAck (nALF) high to acknowledge the
Forward Data Transfer Phase                            handshake. The peripheral then sets PeriphClk
                                                       (nACK) high. After the host has accepted the data
The interface transfers data and commands from         it sets HostAck (nALF) low, completing the trans-
the host to the peripheral using an interlocked        fer. This sequence is shown in FIGURE 30.
PeriphAck and HostClk. The peripheral may
indicate its desire to send data to the host by        Output Drivers
asserting nPeriphRequest.
                                                       To facilitate higher performance data transfer, the
The Forward Data Transfer Phase may be entered         use of balanced CMOS active drivers for critical
from the Forward-Idle Phase. While in the Forward      signals (Data, HostAck, HostClk, PeriphAck,
Phase the peripheral may asynchronously assert         PeriphClk) are used ECP Mode. Because the use
the nPeriphRequest (nFault) to request that the        of active drivers can present           compatibility
channel be reversed. When the peripheral is not        problems in Compatible          Mode (the control
busy it sets PeriphAck (Busy) low. The host then       signals,     by tradition,    are    specified    as
sets HostClk (nStrobe) low when it is prepared to      open-collector), the drivers are dynamically
send data. The data must be stable for the             changed from open-collector to totem-pole. The
specified setup time prior to the falling edge of      timing for the dynamic driver change is specified in
HostClk. The peripheral then sets PeriphAck            the IEEE         1284 Extended Capabilities Port
(Busy) high to acknowledge the handshake. The          Protocol and ISA Interface Standard, Rev. 1.14,
host then sets HostClk (nStrobe) high. The             July 14, 1993, available from Microsoft. The
peripheral then accepts the data and sets              dynamic driver change must be implemented
PeriphAck (Busy) low, completing the transfer.         properly to prevent glitching the outputs.
This sequence is shown in FIGURE 29.
                                                   229


                                                                                       t6
                                                                                 t3
     PDATA
                                            t1                 t2                          t5
 nSTROBE
                                                             t4
      BUSY
                         FIGURE 28 - PARALLEL PORT FIFO TIMING
                             TABLE 96 - PARALLEL PORT FIFO TIMING
 NAME                          DESCRIPTION                              MIN       TYP      MAX       UNITS
   t1    DATA Valid to nSTROBE Active                                    600                            ns
   t2    nSTROBE Active Pulse Width                                      600                            ns
   t3    DATA Hold from nSTROBE Inactive (Note 1)                        450                            ns
   t4    nSTROBE Active to BUSY Active                                                      500         ns
   t5    BUSY Inactive to nSTROBE Active                                 680                            ns
   t6    BUSY Inactive to PDATA Invalid (Note 1)                          80                            ns
Note 1: The data is held until BUSY goes inactive or for time t3, whichever is longer. This only applies if
        another data transfer is pending. If no other data transfer is pending, the data is held indefinitely.
                                                   230


                                                                                   t3
    nAUTOFD
                                                                                   t4
 PDATA<7:0>
                                      t2
                                      t1
                                         t7                   t8
     nSTROBE
        BUSY                  t6                    t5                   t6
             FIGURE 29 - ECP PARALLEL PORT FORWARD TIMING
                  TABLE 97 - ECP PARALLEL PORT FORWARD TIMING
 NAME                       DESCRIPTION                                MIN       TYP       MAX    UNITS
   t1    nAUTOFD Valid to nSTROBE Asserted                              0                   60      ns
   t2    PDATA Valid to nSTROBE Asserted                                0                   60      ns
   t3    BUSY Deasserted to nAUTOFD Changed                             80                 180      ns
         (Notes 1,2)
   t4    BUSY Deasserted to PDATA Changed (Notes 1,2)                   80                 180      ns
   t5    nSTROBE Deasserted to Busy Asserted                             0                          ns
   t6    nSTROBE Deasserted to Busy Deasserted                           0                          ns
   t7    BUSY Deasserted to nSTROBE Asserted (Notes 1,2)                80                 200      ns
   t8    BUSY Asserted to nSTROBE Deasserted (Note 2)                   80                 180      ns
Note 1: Maximum value only applies if there is data in the FIFO waiting to be written out.
Note 2: BUSY is not considered asserted or deasserted until it is stable for a minimum of 75 to 130 ns.
                                                  231


                                                                                    t2
 PDATA<7:0>
                                        t1
                                           t5                   t6
       nACK
                                  t4                t3                     t4
    nAUTOFD
                   FIGURE 30 - ECP PARALLEL PORT REVERSE TIMING
                      TABLE 98 - ECP PARALLEL PORT REVERSE TIMING
 NAME                        DESCRIPTION                               MIN       TYP     MAX      UNITS
   t1    PDATA Valid to nACK Asserted                                    0                          ns
   t2    nAUTOFD Deasserted to PDATA Changed                             0                          ns
   t3    nACK Asserted to nAUTOFD Deasserted                            80                200       ns
         (Notes 1,2)
   t4    nACK Deasserted to nAUTOFD Asserted (Note 2)                   80                200       ns
   t5    nAUTOFD Asserted to nACK Asserted                               0                          ns
   t6    nAUTOFD Deasserted to nACK Deasserted                           0                          ns
Note 1: Maximum value only applies if there is room in the FIFO and terminal count has not been
        received. ECP can stall by keeping nAUTOFD low.
Note 2: nACK is not considered asserted or deasserted until it is stable for a minimum of 75 to 130 ns.
                                                232


SERIAL PORT INFRARED TIMING
IRDA SIR RECEIVE
          DATA
                     0       1      0     1      0      0        1     1      0   1     1
                     t2
                             t2
                     t1            t1
         IRRX
        n IRRX
                              Parameter                  min        typ     max    units
           t1   Pulse Width at                            1.4       1.6      2.71   µs
           t1   Pulse Width at                            1.4      3.22      3.69   µs
           t1   Pulse Width at                            1.4       4.8      5.53   µs
           t1   Pulse Width at                            1.4       9.7     11.07   µs
           t1   Pulse Width at                            1.4      19.5     22.13   µs
           t1   Pulse Width at                            1.4       39      44.27   µs
           t1   Pulse Width at                            1.4       78      88.55   µs
           t2   Bit Time at                                        8.68             µs
           t2   Bit Time at                                        17.4             µs
           t2   Bit Time at                                         26              µs
           t2   Bit Time at                                         52              µs
           t2   Bit Time at                                        104              µs
           t2   Bit Time at                                        208              µs
           t2   Bit Time at                                        416              µs
        1. Receive Pulse Detection Criteria: A received pulse is considered
           received pulse is a minimum of 1 41µs
        2. IRRX: L5, CRF1 Bit 0
           nIRRX: L5, CRF1 Bit 0 = 0
                            FIGURE 31 - IRDA SIR RECEIVE TIMING
                                                233


IRDA SIR TRANSMIT
     DAT A
             0           1          0        1       0        0            1     1             0      1 1
              t2
             t1          t2        t1
       IRT X
   n IRT X
                                          Parameter      mi n         typ       max            u nits
               t1      Pulse Width at 115kbaud           1.41         1.6        2.71             µs
               t1      Pulse Widt h at 57. 6kbaud        1.41        3.22        3.69             µs
               t1      Pulse Widt h at 38. 4kbaud        1.41         4.8        5.53             µs
               t1      Pulse Widt h at 19. 2kbaud        1.41         9.7       11.07             µs
               t1      Pulse Widt h at 9. 6kbaud         1.41        19.5       22.13             µs
               t1      Pulse Widt h at 4. 8kbaud         1.41          39       44.27             µs
               t1      Pulse Widt h at 2. 4kbaud         1.41          78       88.55             µs
               t2      Bit T ime at 115kbaud                         8.68                         µs
               t2      Bit Time at 57.6kbaud                         17.4                         µs
               t2      Bit Time at 38.4kbaud                           26                         µs
               t2      Bit Time at 19.2kbaud                           52                         µs
               t2      Bit Tim e at 9.6kbaud                          104                         µs
               t2      Bit Tim e at 4.8kbaud                          208                         µs
               t2      Bit Tim e at 2.4kbaud                          416                         µs
             Notes:
             1. IrDA @ 115k i s HPSIR com pati ble. IrDA @ 2400 wi ll al low compatibilit y with HP95LX
                  and 48SX.
             2. IRT X: L5, CRF 1 Bit 1 = 1 (default)
                 nI RT X: L5, CRF1 Bit 1 = 0
                            FIGURE 32 - IRDA SIR TRANSMIT TIMING
                                                     234


ASK IR RECEIVE
       DAT A
                 0            1           0            1           0   0    1      1       0 1 1
                   t1         t2
         IRRX
       n IRRX
                       t3   t4
       M IRRX
                       t5   t6
     nM IRRX
                                      Pa ramet er                 min   typ   max    units
                   t1      M odu lated Out put Bit T ime                              µs
                   t2      Off Bit Time                                               µs
                   t3      M odu lated Outp ut " On"               0.8    1    1.2    µs
                   t4      M odu lated Out put " Off"              0.8    1    1.2    µs
                   t5      M odu lated Outp ut " On"               0.8    1    1.2    µs
                   t6      M odu lated Out put " Off"              0.8    1    1.2    µs
                Note s:
                1 . IRRX: L 5, CRF 1 Bit 0 = 1
                    n IRRX: L5 , CRF 1 Bit 0 = 0 (de fault)
                    M IRRX, nMI RRX are the mod ulate d ou tpu ts
              FIGURE 33 - AMPLITUDE SHIFT KEYED IR RECEIVE TIMING
                                                               235


ASK IR TRANSMIT
    DATA
            0            1            0          1        0         0     1 1    0       1 1
              t1         t2
    IRTX
    n IRTX
                      t3    t4
   MIRTX
                      t5    t6
   nMIRTX
                                                Parameter      min    typ   max    units
                   t1      Modulated Output Bit Time                                 µs
                   t2      Off Bit Time                                              µs
                   t3      Modulated Output "On"                0.8     1    1.2     µs
                   t4      Modulated Output "Off"               0.8     1    1.2     µs
                   t5      Modulated Output "On"                0.8     1    1.2     µs
                   t6      Modulated Output "Off"               0.8     1    1.2     µs
               Notes:
               1. IRTX: L5, CRF1 Bit 1 = 1 (default)
                  nIRTX: L5, CRF1 Bit 1 = 0
                  MIRTX, nMIRTX are the modulated outputs
                                FIGURE 34 - ASK IR TRANSMIT TIMING
                                                            236


                                                                D
                                                                      3
                                                                D1
                                           102                                       65
                                  103
                               3                                                                 64
  DETAIL "A"
               R1
                 R2
                  0
              L
4            L1
                       E   E1                                                                           e
                                                             5
                                               D1/4
                                                                                                       W
                                                      E1/4                                          2
                                                                                                39
                                    128
                                                                                        38
                                            1
                                        A         A2
                               H
                                                                                                      0
                       1        0.10
                                        A1                                   SEE DETAIL "A"
                           -C-
                                           MIN       NOM   MAX          MIN     NOM        MAX
                                   A                       3.4     L    0.65    0.8        0.95
                                   A1      0.05            0.5     L1           1.95
                                   A2      2.55            3.05    e           0.5BSC
                                   D       23.65     23.9  24.15   0    0                    7
                                   D1      19.9      20    20.1    W    0.1                 0.3
                                   E       17.65     17.9  18.15   R1   0.13
                                   E1      13.9      14    14.1    R2   0.13                0.3
                                   H
          Notes:
          1) Coplanarity is 0.08 mm or 3.2 mils maximum.
          2) Tolerance on the position of the leads is 0.080 mm maximum.
         3) Package body dimensions D1 and E1 do not include the mold protrusion. Maximum
               mold protrusion is 0.25 mm.
          4) Dimensions for foot length L measured at the gauge plane 0.25 mm above the seating plane.
          5) Details of pin 1 identifier are optional but must be located within the zone indicated.
          6) Controlling dimension: millimeter
                           FIGURE 35 – 128 PIN QFP PACKAGE OUTLINE
                                                               237


            FDC37B72x ERRATTA SHEET
                                                         DATE
PAGE      SECTION/FIGURE/ENTRY               CORRECTION REVISED
  85 Figure 3/Heading             See Italicized Text    1/8/99
 142 Table                        See Italicized Text    1/8/99
                               238


80 ARKAY DRIVE, HAUPPAUGE, NY 11788 (631) 435-6000, FAX (631) 273-3123
Copyright © 2007 SMSC or its subsidiaries. All rights reserved.
Circuit diagrams and other information relating to SMSC products are included as a means of illustrating typical applications.
Consequently, complete information sufficient for construction purposes is not necessarily given. Although the information has been
checked and is believed to be accurate, no responsibility is assumed for inaccuracies. SMSC reserves the right to make changes to
specifications and product descriptions at any time without notice. Contact your local SMSC sales office to obtain the latest
specifications before placing your product order. The provision of this information does not convey to the purchaser of the described
semiconductor devices any licenses under any patent rights or other intellectual property rights of SMSC or others. All sales are
expressly conditional on your agreement to the terms and conditions of the most recently dated version of SMSC's standard Terms of
Sale Agreement dated before the date of your order (the "Terms of Sale Agreement"). The product may contain design defects or
errors known as anomalies which may cause the product's functions to deviate from published specifications. Anomaly sheets are
available upon request. SMSC products are not designed, intended, authorized or warranted for use in any life support or other
application where product failure could cause or contribute to personal injury or severe property damage. Any and all such uses
without prior written approval of an Officer of SMSC and further testing and/or modification will be fully at the risk of the customer.
Copies of this document or other SMSC literature, as well as the Terms of Sale Agreement, may be obtained by visiting SMSC’s
website at http://www.smsc.com. SMSC is a registered trademark of Standard Microsystems Corporation (“SMSC”). Product names
and company names are the trademarks of their respective holders.
SMSC DISCLAIMS AND EXCLUDES ANY AND ALL WARRANTIES, INCLUDING WITHOUT LIMITATION ANY AND ALL
IMPLIED WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE, TITLE, AND AGAINST
INFRINGEMENT AND THE LIKE, AND ANY AND ALL WARRANTIES ARISING FROM ANY COURSE OF DEALING OR USAGE
OF TRADE. IN NO EVENT SHALL SMSC BE LIABLE FOR ANY DIRECT, INCIDENTAL, INDIRECT, SPECIAL, PUNITIVE, OR
CONSEQUENTIAL DAMAGES; OR FOR LOST DATA, PROFITS, SAVINGS OR REVENUES OF ANY KIND; REGARDLESS OF
THE FORM OF ACTION, WHETHER BASED ON CONTRACT; TORT; NEGLIGENCE OF SMSC OR OTHERS; STRICT
LIABILITY; BREACH OF WARRANTY; OR OTHERWISE; WHETHER OR NOT ANY REMEDY OF BUYER IS HELD TO HAVE
FAILED OF ITS ESSENTIAL PURPOSE, AND WHETHER OR NOT SMSC HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH
DAMAGES.
                                                                                                           FDC37B72x Rev. 02-16-07


Mouser Electronics
Authorized Distributor
Click to View Pricing, Inventory, Delivery & Lifecycle Information:
Microchip:
 FDC37B727-NS
