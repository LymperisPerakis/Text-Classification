                                                                                                          AEKD-USBTYPEC1
                                                                                                                                 Data brief
     USB Type-C™ and USB Power Delivery evaluation kit based on the automotive
                                                 grade SPC58 MCU and AutoDevKit development initiative
                                                        Features
                                                        •     Kit consisting of two boards:
                                                              –     Dual-port USB Type-C function board (AEK-USB-2TYPEC1)
                                                              –     SPC58 Chorus discovery board (SPC58EC-DISP)
                                                        •     USB Power Delivery software stack pre-loaded on SPC58 discovery board
                                                        •     Power board connector on USB function board
                                                        •     Power Data Objects (PDO)
                                                              –     5 V 500 mA available without external power board
                                                              –     other PDOs possible if a compatible power board (not included) is
                                                                    connected
                                                        •     Downloadable (STSW-USB2TYPEC1) compiled flash image firmware
                                                        •     Portion of connector on SPC58 Chorus discovery board available for extensions
                                                              as part of the AutoDevKit development initiative
                                                        •     All key ST components are qualified automotive grade
                                                        •     RoHS compliant
                                                        Description
                                                        The AEKD-USBTYPEC1 evaluation kit is designed to let you test the USB Power
                                                        Delivery protocol stack implemented on the ASIL-B automotive grade 32-bit Power
                                                        Architecture® microcontroller SPC58 C (Chorus) line (from 1 to 10 MB flash, single or
                                                        multi-core, including ISO CAN FD and Ethernet peripherals).
               Product summary
 dual-port USB Type-C                AEK-
      function board           USB-2TYPEC1
      SPC58 Chorus
                              SPC58EC-DISP
     discovery board
    automotive grade
 USB Type-C controller
                                 STUSB1702
 (with Tx/Rx line driver
         and BMC)
 firmware package for
                                    STSW-
        the AEKD-
                                USB2TYPEC1
     USBTYPEC1 kit
DB3627 - Rev 2 - July 2018                                                                                                            www.st.com
For further information contact your local STMicroelectronics sales office.


                                                                                                                          AEKD-USBTYPEC1
                                                                                                                                      Hardware architecture
1              Hardware architecture
                                                  Figure 1. AEKD-USBTYPEC1 block diagram
                                                                                       4x37 pin
                                SPC58EC-DISP DISCOVERY BOARD                           connector
                                                                                      5V
                                                                                                             Free pins to
                                                                                                4x17 pins    connect other
                                                                                                             function boards
                                                              USB Power Delivery
                 12V                  5V I/O                           Stack
                        DC / DC
                                                                  Device Policy
                         A5973                                                                                                                              USB
                                                                     Manager
                                                                                                   VBUS (5V or higher with Ext. Power board)     Load
                                                                                                                                                           Port 0
                                                                  Policy Engine                                                                 switch
                                                                                                                 3.3V                         STD28P3L
                 12V                                                                                                     STUSB1702             LH6AG
                                    3.3V I/O                                                          LDO
                        DC / DC                                  Protocol Layer                                            Physical
                                                                                                    LD117A
                        A5973                                                                                                Layer
                                                                 Physical Layer                                I2C       (BMC encoding,         Current
                                                                                                                          Clock recovery)        Sense
                                                                   (Preamble, CRC,
                                                                 EOP, 4b/5b encoding)                        SPI                             TSC1031IYPT
                                                                                                                             Type-C
                      3.3V                                                                                                 Interface         ESD Protect.
                                                                                                                                               USBLC6-
                                                                                                4x20 pins                                       2SC6Y
                        Ballast  1.25V Core
                      2STN1360                 32-bit microcontrollers                                       SPI        STUSB1702                           USB
                                                                                                                                                Transil
                                                                                                                                                           Port 1
                         NPN                    Power Architecture®                                                        Physical           ESDA25LY
                                                                                                          4x20               Layer             SM4T26Y
                                                                                                        External         (BMC encoding,
                                                                                                         Power           Clock recovery)
                                                                                                         Board
                                                                                                                                                  Load
                                                                                                       Connector            Type-C               switch
                                                     Available I/Os                                                        Interface          STD28P3L
                                                                                                                                                LH6AG
                                             CAN, Flex, Ethernet, LIN, SPI…                              Power
                                                                                                       Connector
                                                                                                                   AEK-USB-2TYPEC1
               The AEKD-USBTYPEC1 kit includes the following components:
               •     SPC58EC-DISP discovery board
               •     AEK-USB-2TYPEC1 USB function board
               •     STSW-USB2TYPEC1 firmware
               •     USB Type-C to USB Type-C cable (not electrically marked)
               •     12V 2A AC/DC power supply to power the SPC58EC-DISP board
               •     Type-A to Mini USB cable for Test mode screen output to the PC and board programming
               The following optional components can be added separately:
               •     P-NUCLEO-USB001 or P-NUCLEO-USB002 system to simulate the Consumer role instead of a USB Type-
                     C compatible mobile phone or a tablet.
               •     External power board to allow other PDOs.
1.1            USB function board - AEK-USB-2TYPEC1
               The functional interface board hosts two STUSB1702 automotive grade USB Type-C controller with TX/RX line
               driver and BMC for the USB Type-C ports.
               For each port, the status is signaled with a set of LEDs. Once the power profile is successfully negotiated
               between the Provider (AEKD-USBTYPEC1) and Consumer (USB Type-C and PD compatible device connected to
               one of the ports), a green LED signals that the Explicit state has been achieved.
               For ESD protection, the board includes an ESDALY dual Transil™ array and very low capacitance
               USBLC6-2SC6Y. There are numerous test points on the board for debugging.
1.2            SPC58EC-DISP discovery board with SPC58 microcontroller
               The SPC58EC-DISP discovery board hosts an SPC58 microcontroller and CAN, Flex and Ethernet ports, as well
               as a 4 x 37 pin connector which maps to most of the microcontroller I/O pins. You can assign different functions to
               one microcontroller pin (e.g., GPIO or Clock for SPI interface or Timer) with the SPC5 Studio GUI, which also
               supports the generation of .h configuration files from the pin setups established in the GUI.
DB3627 - Rev 2                                                                                                                                          page 2/9


                                                                                                       AEKD-USBTYPEC1
                                                                                             ST’s AutoDevKit development initiative
2              ST’s AutoDevKit development initiative
               AutoDevKit governs the hardware and software connection between micro discovery boards and specific function
               boards for applications like stepper motor control, led control, etc.
               Each function board has a dedicated driver with abstractions for the specific microcontroller peripherals to ensure
               portability between platforms. The drivers are SPC5 Studio plugins that are instantiated dynamically by the tool
               according to the microcontroller used for the development. The instantiation process generates the appropriate
               source code and indicates how a function board should be connected to the chosen discovery board.
2.1            AutoDevKit for AEKD-USBTYPEC1
               The AEKD-USBTYPEC1 evaluation kit consists of a discovery board (SPC58EC-DISP) and a USB Type-C dual
               port interface function board (AEK-USB-2TYPEC1).
               The 20x4 function board female connector on the function board is connected to the 4x37 male connector on the
               discovery board from the 18th pin to 37th pin. These pins cover the following purposes:
               1.    The connection between the USB function board and the discovery board.
               2.    The connection of a power board (not included in the demo kit) and the discovery board to be plugged on
                     top of the function board 4x20 male connector.
               Lines 1 to 17 on the discovery board 4x37 connector can be used to connect additional function boards according
               to the AutoDevKit development initiative.
DB3627 - Rev 2                                                                                                               page 3/9


                                                                                                         AEKD-USBTYPEC1
                                                                                                       USB Power Delivery overview
3              USB Power Delivery overview
               The USB Type-C and USB Power Delivery specifications allow smarter connectivity with fewer cables, less
               connectors and universal chargers. The Type-C connector supports all the features of previous standards, and
               ports can be configured to only supply power in a Provider role, only sink power in a Consumer role, or be able to
               switch between both in a Dual role.
               Both data and power roles can be independently and dynamically swapped using the USB Power Delivery
               protocol.
               Most automotive applications require support for the Provider role only. When a USB device is connected, the
               Provider and the device (Consumer) negotiate a contract for the power objects through configuration channels.
               The message exchange between Provider and Consumer are listed below:
               1.    The Provider sends a Source Capabilities message to the Consumer, advertising its power
                     capabilities.
               2.    The device then sends a Request for one of the advertised power profiles.
               3.    The provider accepts or rejects this request according to its power balance
               4.    If confirmed, provider sends as an Accept message to the device
               5.    The provider then switches to the requested power profile and sends a PS_Ready confirmation message
               Each received message is acknowledged with a GoodCRC to confirm correct reception. Incorrect receptions are
               ignored and persistent communication errors should trigger a soft reset to re-establish communication. If the error
               persists, a hard reset is performed.
3.1            USB Power Delivery negotiation
               Power negotiation between the Consumer and Provider passes through the STUSB1702 controllers, which
               assume the master role during SPI communication with the microcontroller. The STUSB1702 controllers are
               configured by the microcontroller via the I2C protocol.
               The device that assumes the USB Power Delivery Consumer role might be a compatible mobile phone or a tablet
               that can accept the 5 V, 500 mA PDO. If an external power board is connected, the USB Power Delivery stack
               can select an alternative PDO and the microcontroller will configure the desired output by acting on the power
               board and driving the general purpose I/O’s on the male connector on the AEK-USB-2TYPEC1 interface board.
Note:          You can also use the P-NUCLEO-USB001 or P-NUCLEO-USB002 evaluation kit as a compatible USB power
               Consumer.
               If the voltage switch on the port does not occur within a specific time-out (established by the USB PD
               specification), the STUSB1702 signals that there is no voltage output from the port, which triggers a system reset
               to re-start power negotiation. The addition of an external power board may therefore require appropriate
               modifications to the stack.
Note:          The USB Type-C cable in the AEKD-USBTYPEC1 kit is not electronically marked and is not suitable for currents
               above 3 A; the cable does not support USB 3.1 Gen1 or USB 3.1 Gen2 signaling.
DB3627 - Rev 2                                                                                                              page 4/9


                                                                                                     AEKD-USBTYPEC1
                                                                                          Software package - STSW-USB2TYPEC1
4              Software package - STSW-USB2TYPEC1
               The default firmware is already loaded on the SPC58EC-DISP discovery board of the kit, but you can download it
               from the STSW-USB2TYPEC1 page on the ST website.
               You can use the Universal Debug Engine® (UDE) to flash new USB-PD firmware onto the SPC58 microcontroller
               memory. The application is available for download from the SPC5-UDESTK-SW page on www.st.com.
               In addition to the firmware, the software package contains the following SPC5 Studio resources for USB Power
               Delivery:
               •     an abstract driver for the STUSB1702 device
               •     an SPC5 Studio plugin for the USB Power Delivery software stack
               •     a demo application for a 5 V 500 mA PDO
4.1            How to open the SPC5 Studio project
               The SPC5 Studio project gives you access to the USBPD library plugin source code. Follow the procedure below
               to open the project:
               Step 1.    Obtain a valid username and password: send an email to credentials@spc5studio.com and specify the
                          following information:
                          –     your company name
                          –     your project
                          –     project target run-rate
                          –     the date
               Step 2.    Open SPC5 Studio
               Step 3.    Go to [Help]>[Install new Software] and then click the [Add] button
               Step 4.    Enter the text “USBPD” in the name field
               Step 5.    Enter “usbpd.spc5studio.com” in the location field
               Step 6.    Confirm the form
               Step 7.    Enter the username and password
4.2            How to program SPC58 microcontroller present on SPC58EC-DISP
               Step 1.    Download and install SPC5-UDESTK-SW USB/JTAG debugger from www.st.com
               Step 2.    Connect the mini-B USB cable between your PC and the SPC58EC-DISP discovery board
               Step 3.    Turn-on the discovery board
               Step 4.    Run the UDE application on your PC
               Step 5.    In the UDE program, [Open] file st_usbpd.wsx
                          You will find the .wsx file in the zip in the UDE directory.
                          A window appears.
               Step 6.    In the new window, press [Program All]
                          A confirmation message appears in the same window when the operation in complete. At this point, the
                          firmware is flashed to the microcontroller memory.
               Step 7.    Exit the window
               Step 8.    Reset the SPC58EC-DISP discovery board to run the updated firmware
4.3            Configuration of the USB-PD library through SPC5-Studio
               After you download the package, you can open the project in SPC5-Studio and configure certain settings before
               you flash the firmware to the discovery board:
               •     Enable or disable Port 1 (enabled by default).
DB3627 - Rev 2                                                                                                          page 5/9


                                                                                                        AEKD-USBTYPEC1
                                                                            Configuration of the USB-PD library through SPC5-Studio
Note:          Port 0 is always enabled.
               •     Enable or disable hardware CRC (enabled by default). If it is disabled, a software version is used.
               •     Enable or disable LED signals (enabled by default).
               •     Enable or disable hardware Test mode (disabled by default), to check the hardware.
               •     Enable or disable additional PDOs. The PDOs must be compliant with the external power board connected.
                     You can define the current capability and the port for each PDO.
               •     Configure a logic table to determine the microcontroller pin combinations required to switch between
                     different power board supply voltages.
                                                 Table 1. Default logic table for Port 0 and Port1
                           Vout_x [V]                   Port_sig1                   Port_sig2                     Port_sig3
                               5V                           L                            L                            L
                               9V                           H                            L                            L
                              15V                           H                            H                            L
                              20V                           H                            H                            H
               If Test mode is enabled, you must connect a USB cable between the SPC58EC-DISP discovery board and your
               PC to print debug messages to a terminal window on your PC. Configure the corresponding COM port with 38400
               baud and N81.
DB3627 - Rev 2                                                                                                               page 6/9


                                                                        AEKD-USBTYPEC1
Revision history
                             Table 2. Document revision history
                     Date               Version        Changes
                 14-Jun-2018               1           Initial release.
                 16-Jul-2018               2           Minor text edits
DB3627 - Rev 2                                                                    page 7/9


                                                                                                                            AEKD-USBTYPEC1
                                                                                                                                                      Contents
Contents
1      Hardware architecture . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 2
       1.1     USB function board - AEK-USB-2TYPEC1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 2
       1.2     SPC58EC-DISP discovery board with SPC58 microcontroller . . . . . . . . . . . . . . . . . . . . . . . . . 2
2      ST’s AutoDevKit development initiative . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 3
       2.1     AutoDevKit for AEKD-USBTYPEC1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 3
3      USB Power Delivery overview. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 4
       3.1     USB Power Delivery negotiation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 4
4      Software package - STSW-USB2TYPEC1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 5
       4.1     How to open the SPC5 Studio project . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 5
       4.2     How to program SPC58 microcontroller present on SPC58EC-DISP . . . . . . . . . . . . . . . . . . . 5
       4.3     Configuration of the USB-PD library through SPC5-Studio . . . . . . . . . . . . . . . . . . . . . . . . . . . . 5
Revision history . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .7
DB3627 - Rev 2                                                                                                                                           page 8/9


                                                                                                                                AEKD-USBTYPEC1
                                                       IMPORTANT NOTICE – PLEASE READ CAREFULLY
 STMicroelectronics NV and its subsidiaries (“ST”) reserve the right to make changes, corrections, enhancements, modifications, and improvements to ST
 products and/or to this document at any time without notice. Purchasers should obtain the latest relevant information on ST products before placing orders. ST
 products are sold pursuant to ST’s terms and conditions of sale in place at the time of order acknowledgement.
 Purchasers are solely responsible for the choice, selection, and use of ST products and ST assumes no liability for application assistance or the design of
 Purchasers’ products.
 No license, express or implied, to any intellectual property right is granted by ST herein.
 Resale of ST products with provisions different from the information set forth herein shall void any warranty granted by ST for such product.
 ST and the ST logo are trademarks of ST. All other product or service names are the property of their respective owners.
 Information in this document supersedes and replaces information previously supplied in any prior versions of this document.
                                                          © 2018 STMicroelectronics – All rights reserved
DB3627 - Rev 2                                                                                                                                           page 9/9


Mouser Electronics
Authorized Distributor
Click to View Pricing, Inventory, Delivery & Lifecycle Information:
STMicroelectronics:
 AEKD-USBTYPEC1
