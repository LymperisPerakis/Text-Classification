                                                   APPLICATION NOTE
                               ATAK43001-V1 Development Kit for the
                                                              ATA664251 Atmel IC
                                                                               ATAN0063
Introduction
The development kit for the Atmel® ATA664251 IC consists of the PC interface board
(ATAB0004A-V2.0) and the Atmel ATA664251 application board (ATAB664251A-V1.0)
attached together as one unit. The kit provides users with a quick start guide for prototyping
and testing new LIN designs with the Atmel ATA664251 IC.
Figure 1.      Atmel ATAK43001-V1 Development Kit
The Atmel ATA664251 is a system-in-package (SiP) product, which is especially well
suited for complete LIN-bus node applications. It is designed specifically for LIN switch
applications and includes nearly the complete LIN node. It consists of two ICs in one pack-
age supporting highly integrated solutions for in-vehicle LIN networks. The first chip is the
ATA664151 LIN system basis chip (SBC), which has an integrated LIN transceiver, a 5V
regulator (80mA), a window watchdog, an 8-channel high voltage switch interface with
high-voltage current sources and a 16-bit SPI for configuration and diagnosis.
The second chip is an Atmel automotive microcontroller from the AVR 8-bit microcontroller
series featuring advanced RISC architecture, the Atmel ATtiny167 with 16 Kbytes of Flash
memory.
All the LIN SBC pins as well as all the AVR microcontroller pins are bonded out to provide
customers with the same flexibility for their applications they have when using discrete
parts.
                                                                          9300D-AUTO-03/15


  The Atmel® LIN SBC ATA664251 has the following features:
  SBC:
    ●    LIN master and slave operation possible
    ●    Up to 40V supply voltage
    ●    Operating voltage VS = 5V to 27V
    ●    8-channel HV switch interface with HV current sources
    ●    Internal voltage divider for VBattery sensing (±2%)
    ●    16-bit serial interface (daisy-chain-capable) for configuration and diagnosis
    ●    Typically 8µA supply current during sleep mode
    ●    Typically 35µA supply current in active low-power mode
    ●    5V ±2% linear low-drop voltage regulator, up to 80mA current capability
    ●    VCC undervoltage detection (5ms reset time) and watchdog reset logical combined at NRES open drain output
    ●    LIN high-speed mode for transmission rates up to 200kBit/s
    ●    Watchdog timer adjustable via external resistor
    ●    Negative trigger input for watchdog
    ●    LIN physical layer complies with LIN 2.1 specification and SAE J2602-2
    ●    Wake-up capability via LIN bus and CL15
    ●    Bus pin is overtemperature and short-circuit protected versus GND and battery
    ●    Advanced EMC and ESD performance
    ●    System-level ESD performance conforming with OEM “Hardware Requirements for LIN in Automotive Applications
         Rev. 1.2”
    ●    3x PWM inputs for direct control of the switch interface sources
  AVR microcontroller:
    ● High-performance, low-power AVR® 8-bit microcontroller
    ●    Advanced RISC architecture
            ●   123 powerful instructions - in most cases single clock cycle execution
            ●   32 × 8 general purpose working registers
            ●   Fully static operation
    ●    Non-volatile program and data memories
            ●   16 Kbytes of in-system programmable (ISP) program memory flash
                   ●     Endurance: 10,000 write/erase cycles
            ●   512 bytes in-system programmable EEPROM
                   ●     Endurance: 100,000 write/erase cycles
            ●   512 bytes internal SRAM
            ●   Programming lock for self-programming Flash program and EEPROM data security
    ●    Peripheral features
            ●   LIN 2.1 and LIN 1.3 controller or 8-bit UART
            ●   8-bit asynchronous timer/counter0
                   ●     10-bit clock prescaler
                   ●     One output compare or 8-bit PWM channel
            ●   16-bit synchronous timer/counter1
                   ●     10-bit clock prescaler
                   ●     External event counter
                   ●     Two output compare units or 16-bit PWM channels each driving up to four output pins
2 ATAN0063 [APPLICATION NOTE]
  9300D–AUTO–03/15


           ●   Master/slave SPI serial interface
           ●   Universal serial interface (USI) with start condition detector (master/slave SPI, TWI, ...)
           ●   10-bit ADC
                  ●   11 single-ended channels
                  ●   Eight differential ADC channel pairs with programmable gain (8x or 20x)
           ●   On-chip analog comparator with selectable voltage reference
           ●   100µA ±10% current source (LIN node identification)
           ●   On-chip temperature sensor
           ●   Programmable watchdog timer with separate on-chip oscillator
  ●     Special microcontroller features
           ●   Dynamic clock switching (external/internal RC/watchdog clock) for power control, EMC reduction
           ●   DebugWIRE on-chip debug (OCD) system
           ●   Hardware in-system programmable (ISP) via SPI port
           ●   External and internal interrupt sources
           ●   Interrupt and wake-up on pin change
           ●   Low-power idle, ADC noise reduction, and power-down modes
           ●   Enhanced power-on reset circuit
           ●   Programmable brown-out detection circuit
           ●   Internal calibrated RC oscillator 8MHz
           ●   4MHz to 16MHz and 32kHz crystal/ceramic resonator oscillators
  ●     I/O
           ●   16 programmable I/O lines
  ●     Speed grade
           ●   0MHz to 16MHz at 4.5V to 5.5V (automotive temperature range: –40°C to +125°C)
This document has been developed to provide users with start-up information about the Atmel ATAK43001-V1 development
kit. For more information about the use of the devices themselves, see the appropriate datasheet.
                                                                                ATAN0063 [APPLICATION NOTE]            3
                                                                                                      9300D–AUTO–03/15


1. Development Kit Features
   The development kit for the Atmel® ATA664251 IC has the following features, starting with the features of the Atmel
   ATA664251 (ATAB664251A-V1) board:
     ● All necessary components to put the Atmel ATA664251 into operation are included to simulate and test the real
          application
     ●    LEDs connectable to all HV ports
     ●    1x RGB LED
     ●    8x push-buttons
     ●    8x rotary switches
     ●    Easy access to all pins
            ●    ISP connector for on-chip ISP (in-system programming)
     ●    Easily adaptable watchdog times by replacing a single resistor
     ●    Possibility of selecting between master or slave operation (mounting D2 and R1)
     ●    Push button included for creating a local wake-up after entering sleep mode
     ●    Easily adaptable current level of the current sources by replacing a single resistor
     ●    Ground coulter clip for connecting probes easily when measuring with the oscilloscope
   The interface board (Atmel ATAB0004A) has the following features:
     ● Easy connection to a PC (AT90USB1287 on board)
     ●    USB interface to PC
     ●    SBC functions easily configurable via PC GUI
     ●    ISP connector for in-chip ISP (in-system programming)
     ●    JTAG connector for on-chip debugging
     ●    Buzzer
     ●    On-board RESET button
     ●    On-board boot loader button to force AVR® into DFU mode at reset
     ●    16MHz crystal for system clock
4  ATAN0063 [APPLICATION NOTE]
   9300D–AUTO–03/15


2.      Getting Started
        The development kit for the Atmel® ATA664251 is shipped with the default jumper settings and all accessories required for
        immediate use.
Figure 2-1. Atmel ATAK43001-V1 Development Kit with Reference Points
        The IC mounted on the PC interface board (AT90USB1287) is preprogrammed with firmware which facilitates testing and
        gaining familiarity with the basic functions of the kit.
        The microcontroller within the Atmel ATA664251 (Atmel ATtiny167) is held in reset via jumper J12 and the SCB is controlled
        via the PC interface board and the demo GUI.
        First of all the USB drivers and the GUI software have to be installed (please see Section 2.2 “USB Driver Installation” on
        page 8 and Section 2.1 “GUI Software Installation” on page 7 for more information). After correctly connecting an external
        12V DC power supply (reference point 1) to the power connector and connecting the PC interface board to the PC via the
        supplied USB cable, the kit is ready to use.
        The Atmel ATA664251 IC starts in active mode, with the VCC voltage regulator, the window watchdog switched on (the latter
        depends on the VDIV pin, see Section 5.7 “Watchdog Section” on page 39), the AVR core is in reset (reset pin (pin 2) is
        connected by default to GND via jumper J12). The status of all pins is shown in Table 2-1 on page 6.
                                                                                     ATAN0063 [APPLICATION NOTE]                    5
                                                                                                           9300D–AUTO–03/15


  Table 2-1.    Overview of Pin Status at Power-Up of the Development Kit
              Test Point                        Expected Behavior                       Additional Information
                NTRIG                                    5V
                 TXD                                     5V
                 RXD                                     5V
                                       ≈ 5ms reset pulse with ≈ 165ms period,
                NRES
                                       because the watchdog is not triggered
                NIRQ                                     0V
                MISO                                     0V
                MOSI                                     0V
                 SCK                                     0V
                 NCS                                     5V
                PWM1                                     0V
                PWM2                                     0V
                PWM3                                     0V
                 VDIV                                    0V
                                                                                   Dependent on the supply voltage
                  LIN                                  ≈ 12V
                                                                                              (VBAT-0.7V)
                CL15                                     0V
                                                                              If jumper J1 (controller board) is set, this
                  J16                                  ≈ 5.1V
                                                                                        jumper should be open.
                                       ≈ 5ms reset pulse with ≈ 165ms period,
                   J2
                                       because the watchdog is not triggered
                   J1                                  ≈ 5.1V                       Default setting, otherwise ≈ 3.3V
                  Jxx                                    0V                        Default setting: connected to GND
             VCC (pin 14)                                5V                             Voltage regulator is ON
               PA0…7                                     0V                        AVR is in reset --> I/Os in tristate
               PB0…7                                     0V                        AVR is in reset --> I/Os in tristate
               CS1…8                                     0V                             Switch interface is OFF
6 ATAN0063 [APPLICATION NOTE]
  9300D–AUTO–03/15


2.1 GUI Software Installation
    To install the GUI, execute the setup.exe file and follow the instructions to complete the installation.
    Select the directory where you want to install the demo and click “Next.”
    Figure 2-2. Selecting the Directory
                                                                                   ATAN0063 [APPLICATION NOTE]             7
                                                                                                          9300D–AUTO–03/15


    After the installation is done, press “Finish.”
    Figure 2-3. Completing the Installation
2.2 USB Driver Installation
    After connecting the PC interface board to a PC the first time, the required USB drivers must be installed before the kit can
    be used.
    Be sure to install the GUI first before installing the USB driver (see Section 2.1 “GUI Software Installation” on page 7).
    As soon as the PC has detected a new hardware device, the “Hardware Wizard” appears. Select “No, not this time” and then
    click “Next.”
    Figure 2-4. Selecting “No, not this time”
8   ATAN0063 [APPLICATION NOTE]
    9300D–AUTO–03/15


Select “Install from a list or specific location” and then click “Next.”
Figure 2-5. Selecting “Install from a list or specific location (advanced)”
Select “Don’t search. I will choose the driver to install.” and then click “Next.”
Figure 2-6. Selecting “Don’t search. I will choose the driver to install.”
                                                                                 ATAN0063 [APPLICATION NOTE]      9
                                                                                                 9300D–AUTO–03/15


   If more than one driver is found, be sure to select the “Destiny National Instruments” driver and then click “Next.”
   Figure 2-7. Selecting the “Destiny National Instruments” Driver
   Figure 2-8. Installing the Driver
10 ATAN0063 [APPLICATION NOTE]
   9300D–AUTO–03/15


After successfully installing the driver, press the “Finish” button.
Figure 2-9. Selecting “Finish”
                                                                     ATAN0063 [APPLICATION NOTE]      11
                                                                                     9300D–AUTO–03/15


2.3 Quick Start User Guide
      1.   To start working with the kit, execute the Atmel® ATA6641_Demo.exe. This can be done either from the “Start”
           menu or from the folder containing the kit files (see Section 2.1 “GUI Software Installation” on page 7). Before
           starting the GUI, make sure the correct USB driver (see Section 2.2 “USB Driver Installation” on page 8 for more
           information) and GUI software are installed and that the power supply and USB are properly connected. The fol-
           lowing window is opened so that the user can set up and test all the features of the SBC.
    Figure 2-10. Atmel ATA664251 Demo GUI at Start-up
           After starting up the GUI, as standard the SBC is set to low-power mode. This is indicated in Section 5.1 “SBC Sec-
           tion” on page 34 (yellow LED - ActiveLP is ON) in the GUI and on the PC interface board (LED - LD2 is ON (reference
           point 21)) as well (see Figure 2-12).
      2.   A quick check to determine everything is working properly can be done by clicking the “Active Mode” button in the
           SBC section where all “Bit Buttons” in Section 5.5 “I/O Ports Section” on page 36 are checked (please see
           Figure 2-11) and the following LEDs on the ATAB664251A board (please see Figure 2-12) are turned on:
              ●    LD1-3 (indicate that CS1 is set to low-side ON)
              ●    LD7-9 (indicate that CS4 is set to low-side ON)
              ●    LD13-15 (indicate that CS3 is set to low-side ON)
              ●    LD19-33 (indicate that CS4-8 are ON)
12  ATAN0063 [APPLICATION NOTE]
    9300D–AUTO–03/15


Figure 2-11. Atmel ATA664251 Demo GUI after “Active Mode” Button Is Pressed
Figure 2-12. Atmel ATAK43001-V1 Kit LEDs in Active Mode
      In active mode, the watchdog and a valid trigger signal (35ms) are activated. In addition, the LIN interface is enabled
      and a default frequency of 10kHz (20kBit/s) is generated on the TXD pin.
      In order to have a LIN signal approximating a real LIN network, a master pull-up and a master diode (reference point
      4) are populated on the board (see Section 3.6.3 “Configuring the Atmel ATAK43001-V1 Kit as a Master or a Slave
      Node” on page 30).
  3.  It is relatively easy to change the mode of the SBC. Click one of the three mode buttons in Section 5.1 “SBC Sec-
      tion” on page 34. The current mode is indicated in the GUI (3x LEDs in Section 5.1 “SBC Section” on page 34) and
      on the PC interface board (reference point 21; LEDs - LD2, LD4, LD4) as well. For more information about the dif-
      ferent modes, see Section 5.1 “SBC Section” on page 34 or the ATA664251 datasheet.
                                                                             ATAN0063 [APPLICATION NOTE]                   13
                                                                                                   9300D–AUTO–03/15


   Figure 2-13. Mode Change
     4.   To better understand the features of the high-voltage I/O ports, try changing various settings for the I/O ports by:
            ●    Enabling/disabling a specific CSx port (select/deselect the CSE bit and click the appropriate “Configure CSx”
                 button)
            ●    Configure CS1…3 as low-side or high-side by selecting/deselecting the CSSSM bit and click the appropriate
                 “Configure CS1…3” button
            ●    Configure one of the CS1…8 ports to be controlled either by PWM signal or not: Select/deselect the CSC bit
                 and click the appropriate “Configure CS1…8” button. Make sure the dedicated PWM1…3 signals in the
                 corresponding section of the GUI have been enabled (for more information, see Section 5. “Atmel ATA664251
                 Demo GUI Description” on page 33).
            ●    Double/halve the current of the CS1…8 ports by selecting either “x100” or “x50” for the IMUL bit.
   Figure 2-14. CSx Port Setting
14 ATAN0063 [APPLICATION NOTE]
   9300D–AUTO–03/15


  5.  The VBattery voltage or the voltage on the I/O ports can be easily measured (one at a time) at the VDIV pin. To do
      so, select the desired source in the “Voltage Divider” section (at the upper right side of the GUI) that has to be
      measured and press the “Continual” button for continuous measurement of the selected source.
Figure 2-15. Selecting the Voltage Measurement Source
  6.  For testing purposes and to become familiar with the system, it may be helpful to see the behavior when the
      watchdog is not triggered correctly. This can be done in two different ways without changing the firmware of the
      IC:
         ●    Disable NTRIG frequency (click on the “NTRIG ON/OFF” button)
              No trigger signal reaches the watchdog and the watchdog generates a reset directly after the lead time
              td (51k) = 155ms has expired.
         ●    Re-program the fuse bit
              Changing the CKDIV8 fuse bit to be programmed changes the microcontroller’s internal clock from 16MHz to
              2MHz. Because of this the trigger signal generated from the microcontroller does not meet the open window
              from the window watchdog and a reset is generated.
      In this case the watchdog generates resets (≈ 5ms reset pulse with ≈ 165ms period) on the NRES pin (displayed also
      in the GUI in the “Current SBC Status” section).
                                                                              ATAN0063 [APPLICATION NOTE]                15
                                                                                                     9300D–AUTO–03/15


3.    Hardware Description
3.1   Pin Description - ATAB664251A Board
      In the following sections, the external elements required for some of the pins are shown and described. See the relevant
      datasheet for more information about this topic.
      Note:          The Atmel® ATA664251's AVR® is held in reset (J12 connected to GND) and it is not supplied (J16 is open).
3.1.1 Power Supply
      In order to get the Atmel ATAB664251A development board running, an external 5V to 27V DC power supply has to be
      connected to the power connector. The input circuit is protected against inverse polarity with the protection diode D7,
      resulting in a difference of approximately 0.7V between the VBAT supply voltage and the voltage at the VS pin.
      In order to avoid false bus messages, undervoltage detection is implemented to disable data transmission via the LIN bus
      and the switch interface if VVS falls below VVSth. After switching on VS, the IC starts in active mode (for more information,
      please see also Section 4.1 “Active Mode” in the Atmel ATA664251 datasheet) with the VCC voltage regulator and the
      window watchdog switched on.
3.1.2 Voltage Regulator (VCC)
      The internal 5V voltage regulator is capable of driving loads up to 80mA for supplying the microcontroller and other loads. It
      is protected against overloads by means of current limitation and overtemperature shutdown. In addition, the output voltage
      is monitored and causes a reset signal at the NRES output pin if it drops below a defined threshold VVCCthun.
      A safe operating area (SOA) is defined for the voltage regulator because the power dissipation caused by this block might
      exceed the system’s thermal budget (please see the Atmel ATA664251 datasheet for more detailed information).
3.1.3 The Window Watchdog (NTRIG, WD_OSC, and NRES)
      The watchdog anticipates a trigger signal from the microcontroller at the NTRIG input (negative edge) within a defined time
      window. If no correct trigger signal is received during the open window, a reset signal (active low) is generated at the NRES
      output. During silent mode or sleep mode the watchdog is switched off to reduce current consumption.
      The timing basis of the watchdog is provided by the internal oscillator, whose time period tOSC can be adjusted via the
      external resistor R2 at the WD_OSC pin. All watchdog-specific timings (t1, t2, td, ...) are based on the value of this resistor.
      There is a resistor with a value of 51k mounted on the development board by default, resulting in the timing sequence for
      the integrated watchdog in Figure 3-1.
      Figure 3-1. Watchdog Timing Sequence with R2 = 51k
                  VCC
                    5V
                              Undervoltage Reset                                                           Watchdog Reset
                              treset = 4ms                                                                     tnres = 4ms
                 NRES
                                                     td = 155ms                            t1           t2
                                                                 t1 = 20.6ms     t2 = 21ms
                                                                             twd
                 NTRIG
                                                          ttrig > 200ns
16    ATAN0063 [APPLICATION NOTE]
      9300D–AUTO–03/15


        Replacing the resistor R2 results in a frequency change of the internal oscillator. This in turn results in different watchdog
        timing. The following formula demonstrates how the frequency of the internal oscillator depends on the value of the resistor
        R2. For more information, see the Atmel ATA664251 datasheet. The resistor Rwd_osc in the datasheet corresponds to
        resistor R2 on the board:
        tOSC [RWD_OSC] = 0.405 RWD_OSC – 0.0004 (RWD_OSC)2
        tOSC in µs
        RWD_OSC in k
        With the values given in the datasheet, all relevant watchdog times (such as the open window and closed window) can be
        calculated using tOSC.
        In general, the AT90USB1287 is shipped with an oscillator start-up time of 65ms. Due to the extra-long lead time of 155ms it
        should be possible in almost all cases to meet the first open window of the watchdog. If more time is needed, the 65ms
        default start-up time of the microcontroller can be reduced via the fuse bits to 4.1ms or even 0ms. The IC mounted on the
        board is shipped preset to a start-up time of 65ms.
3.1.4   The LIN Interface (LIN, TXD, and RXD)
        A low-side driver with internal current limitation and thermal shutdown, and an internal pull-up resistor in compliance with the
        LIN 2.1 specification are implemented. The allowed voltage range is from –30V to +40V. Reverse currents from the LIN bus
        to VS are suppressed, even in the event of GND shifts or battery disconnection. The LIN receiver thresholds are compatible
        with the LIN protocol specification. The fall time from recessive to dominant bus state and the rise time from dominant to
        recessive bus state are slope-controlled.
        For higher bit rates the slope control can be switched off by setting the SPI-bit LSME. Then the slope time of the LIN falling
        edge is < 2µs. The slope time of the rising edge is highly dependent on the capacitive load and the pull-up resistance at the
        LIN line. To achieve a high bit rate Atmel recommends using a small external pull-up resistor (500) and a small capacitor.
        This allows very fast data transmission of up to 200kBit/s, e.g., for electronic control tests of the ECU, microcontroller
        programming, or data download. In this high-speed mode superior EMC performance is not guaranteed.
        Note:           The internal pull-up resistor is only switched on in active mode and when the LIN transceiver is activated by the
                        LINE bit (active mode with LIN bus transceiver).
        Because the two TXD and RXD pins on the LIN SBC are controlled by the microcontroller’s LIN/UART, they are connected
        to the corresponding TXD and RXD pins on the microcontroller and can be monitored at these pins. Test points have been
        provided on the development board.
3.1.4.1 TXD Input Pin (LIN SBC)
        The TXD pin is the microcontroller interface for controlling the state of the LIN output. TXD must be pulled to ground in order
        to keep the LIN bus in the dominant state. If TXD is high or not connected (internal pull-up resistor), the LIN output transistor
        is turned off and the bus is in recessive state.
        If configured, an internal timer prevents the bus line from being constantly driven in the dominant state. If TXD is forced to
        low for longer than tDOM, the LIN bus driver is switched back to recessive state. TXD has to be switched to high for at least
        tTOrel to reactivate the LIN bus driver (by resetting the time-out timer).
        As mentioned above, this time-out function can be disabled via the SPI configuration register in order to achieve any long
        dominant state on the connected line (such as PWM transmission or low bit rates).
                                                                                        ATAN0063 [APPLICATION NOTE]                    17
                                                                                                               9300D–AUTO–03/15


3.1.4.2 RXD Output Pin (LIN SBC)
        This output pin reports the state of the LIN bus to the microcontroller. SLIN high (recessive state) is reported by a high level,
        LIN low (dominant state) is reported by a low level at RXD. The output has push-pull characteristics, meaning no external
        time-defining measures are required. The RXD pin is at high level during disabled LIN-PHY states (configuration bit “LINE” =
        0).
        Please note that the signal on the RXD pin is not valid for a certain period of time upon activation of the LIN transceiver
        (tRXDinvalid).
        Figure 3-2. RXD Timing upon Transceiver Enable
                                   NCS              SPI word with LINE = 1
                                                                                              LIN bus state
                                   RXD                                            X
                                                                                          0 = DOM --- 1 = REC
                                                                              tRXDinvalid
        RXD is switched off in sleep and unpowered mode.
3.1.5   Interrupt Request Output Pin (NIRQ)
        The interrupt request output pin is an open drain output and switches to low whenever a chip-internal event occurs that is set
        up to trigger an interrupt. A power-up, a wake-up over LIN bus, a change in a switch state, or an overtemperature condition
        are examples of such events. The pin remains at ground until the end of the next SPI command, at which point the interrupt
        source is passed to the SPI master.
3.1.6   CL_15 (LIN SBC)
        This CL15 pin is a high-voltage input that can be used to wake up the device from sleep mode. It is an edge-sensitive pin
        (low-to-high transition). Thus, even if CL15 pin is at high voltage (VCL15 > VCL15th), it is possible to switch to sleep mode.
        The CL 15 pin is usually connected to the ignition for generating a local wake-up in the application if the ignition is switched
        on. If not needed, the CL15 pin should be tied directly to ground. A debounce timer with a value tdebCL15 of typically 160µs
        is implemented. The pin state (CL15 ON or OFF) can be read out through the SPI interface.
3.1.7   VBATT Pin
        The VBATT is a high-voltage input pin for performing measurements using a voltage divider. The latter provides a low-
        voltage signal at the VDIV pin that is linearly dependent on the input voltage. In an application with battery voltage
        monitoring, this pin is connected in series to VBattery via a 51 resistor and a 10nF capacitor to GND. The divider ratio is
        1:4. This ratio results in maximum output voltages on the VDIV pin when 20V is reached at the input.
3.1.8   NRES Output Pin (LIN SBC) and PB6/Reset Input Pin (Microcontroller at the PC Interface Board)
        The NRES reset output pin is an open-drain output and switches to low during a VCC undervoltage event or a watchdog
        timing window failure. Please note the reset hold time of typically 4ms has disappeared after the undervoltage condition. The
        PB6/reset input pin already has a pull-up resistor included with resistance between 30k and 60k. The NRES output pin of
        the LIN SBC is connected by default to the PB6 input pin of the microcontroller at the PC Interface board. The NRES pin can
        be connected to the reset pin of the microcontroller via the JP2 jumper (PC interface board). An additional 10k pull-up
        resistor is included on the development board to have a defined value of the NRES output in case the PJ2 is left open.
        Because the NRES output is an open-drain output, it is not necessary to remove the J2 jumper (only if placed on position 1
        and 2) during programming or debugging of the microcontroller.
18      ATAN0063 [APPLICATION NOTE]
        9300D–AUTO–03/15


3.1.9  VDIV Input/Output Pin
       This pin handles two different functions. During the VCC start-up and watchdog reset phase (pin NRES driven to LOW), the
       pin acts as the input and determines the setting of the WDD bit within the SPI configuration register (see Figure 3-3). In other
       words, if the window watchdog operation were disabled directly after power-up (e.g., for microcontroller programming or
       debugging purposes), the VDIV pin would have to be tied to the HIGH level until the reset phase ends (pin NRES has a
       positive slope from LOW to HIGH). In other cases, such as when the VDIV pin is not driven actively by the application, the
       signal is assessed as LOW and the WDD bit (watchdog disable) is thus also low and the window watchdog is operational
       (see
       Figure 3-3).
       Figure 3-3. WDD Configuration Bit Setup During VCC Start-up
                                             NRES              “LOW” from VCC startup
                           VDIV (driven externally)                    Logic Level “A”                Z (high imp.)
                              WDD config bit state                        X                        Logic Level “A”
       During normal operation, this pin provides a low-voltage signal for the ADC such as for a microcontroller. It is sourced either
       by the VBATT pin or one of the switch input pins CS1 to CS8. An external ceramic capacitor is recommended for low-pass
       filtering of this signal (10nF mounted on the board by default; depending on the timings in the current application, this value
       should be adjusted). If selected in the configuration register of the SPI, this pin guarantees a voltage- and temperature-stable
       output ratio of the selected test input and is available in all modes except sleep mode. Please note that the current
       consumption values in the active low-power mode of the Atmel ATA664251 indicated in the electrical characteristics lose
       their validity if the VDIV output pin is being used in this low-power mode. The voltage on this pin is actively clamped to VCC
       if the input value would lead to higher values.
3.1.10 IREF Output Pin
       This pin is the connection for an external resistor toward ground. It provides regulated voltage which causes a resistor-
       dependent current to be used as reference for the current sources in the switch interface I/O ports. Fail-safe circuitry detects
       if the resistor is missing or if there is a short circuit toward ground or VCC on this pin. An internal fail-safe current is
       generated in this event.
3.1.11 CS1 to CS8 High-Voltage Input/Output Pins
       These pins are intended for contact monitoring and/or constant current sourcing. A total of eight I/Os (pins CS1 through
       CS8) are available, of which three (CS1, CS2, and CS3) can be configured either as current sources (such as for switches
       toward ground) or as current sinks (such as for switches toward battery). The other five pins (CS4 to CS8) have current
       sourcing capability. Apart from a high-voltage (HV) comparator for simple switches, the I/Os are also equipped with a voltage
       divider to enable analog voltage measurements on HV pins by using the ADC of the application’s microcontroller. Also, each
       input can trigger an interrupt upon state change even while low-power mode is active.
                                                                                        ATAN0063 [APPLICATION NOTE]                  19
                                                                                                                9300D–AUTO–03/15


3.1.12 PWM1...3 Input Pins
       These pins can be used to control the switch interface current sources directly, such as for pulse width-modulated load
       control or for pulsed switch scanning. For example, they accept logic level signals from the microcontroller and are equipped
       with
       pull-down structures so that the input is well defined in case of an open connection. For more information, see the “Switch
       Interface Unit” section in the Atmel ATA664251 datasheet.
       The assignment of the current sources to the three PWM input pins is shown in Table 3-1.
       Table 3-1.     CSx Port Configuration Table
           PWM Port           CS1           CS2           CS3          CS4          CS5           CS6          CS7           CS8
             PWM1               x            -             -             -            -             -            x            X
             PWM2               -            x             -             -            x            x             -            -
             PWM3               -            -             x             x            -             -            -            -
3.1.13 PA0…7 Input/Output Pins
       All I/O pins are easily accessible – PA0…7 on Header X2. Most of the I/O ports are hardwired to the corresponding pins of
       the SBC. Table 3-4 on page 29 shows the connection between the Atmel ATtiny167 and the SBC. Cut-straps are available to
       remove the connection between the AVR and the SBC. For more information about the function of the I/O pins, please see
       the datasheet of the Atmel ATA664251.
3.1.14 PB0…7 Input/Output Pins
       All I/O pins are easily accessible – PB0…7 on header X3a and X3b. Most of the I/O ports are hardwired to the corresponding
       pins of the SBC. Table 3-2 shows the connection between the Atmel ATtiny167 and the SBC. A cut-straps are available to
       remove the connection between the AVR and the SBC. For more information about the function of the I/O pins, please see
       the Atmel ATA664251 datasheet.
       Table 3-2.     Hardwire Connections between the Atmel ATtiny167 and the SBC Table
                                    ATtiny167                                                         SBC
                                       PA0                                                            RXD
                                       PA1                                                            TXD
                                       PA2                                                      To switch S21
                                       PA3                                                            VDIV
                                       PA4                                                      To switch S20
                                       PA5                                                      To switch S20
                                       PA6                                                            NCS
                                       PA7                                               Over C300 (100nF) to GND
                                       PB0                                                      To switch S21
                                       PB1                                                      To switch S20
                                       PB2                                                      To switch S20
                                       PB3                                                          NTRIG
                                       PB4                                                          PWM3
                                       PB5                                                          PWM2
                                       PB6                                                            NIRQ
                                       PB7                                                      To jumper J12
20     ATAN0063 [APPLICATION NOTE]
       9300D–AUTO–03/15


3.2   Pin Description - Atmel ATAB0004A Board (PC Interface Board)
3.2.1 PD4 to PD6 and PC5
      Three LEDs are connected to PD4 - PD6 and are used for indicating the status of the SBC:
        ● Green LED connected to PD4, ON when the SBC is in active mode
        ●     Yellow LED connected to PD5, ON when the SBC is in low active mode
        ●     Red LED connected to PD6, ON when the SBC is in sleep mode
      A buzzer is connected to PC5. Currently not used, but if needed can easily be activated via software for any sound
      indication.
3.2.2 JTAG Header
      The JTAG header allows users to upload and debug their application with the JTAG programmer.
      Figure 3-4. The JTAG Header
3.2.3 ISP Header
      The ISP header can be used to program the Atmel® AT90USB1287 through in-system programming.
      Figure 3-5. 6-Pin ISP Connector Pinout
                                                                                 ATAN0063 [APPLICATION NOTE]             21
                                                                                                        9300D–AUTO–03/15


3.2.4 Reset Button
      The “RESET” push button resets the target AVR® device when pushed.
      Figure 3-6. Reset Button
3.2.5 Boot Loader Button
      The “HWB” push button is used to switch the AVR to DFU mode (boot loader).
      The HWB mode of this pin is active only when the HWBE fuse is enabled.
      The following steps enable DFU mode:
        1. Press and hold the “HWB” push button.
        2.    Press the “RESET” push button.
        3.    Release the “RESET” push button.
        4.    Release the “HWB” push button.
      Figure 3-7. Boot Loader Button
3.2.6 Other Pins
      All remaining pins not described in this section do not have any special external circuitry and/or are used as described in
      detail in the next section.
22    ATAN0063 [APPLICATION NOTE]
      9300D–AUTO–03/15


3.3 Summary of the Pin Connection
    As already described in detail in the previous sections, there are some pins tied together on the development board. The pin
    connection of the Atmel ATAB664251A board and ATAB0004A board is summarized in Table 3-3.
    Table 3-3.    Summary of the Hardwired Pins on the Atmel ATA664251 Kit
       Connector Pin No.               Microcontroller Pin                                                 Connector Pin No.
      (PC Interface Board)               (AT90USB1287)              Connected to Atmel ATA664251          (PC Interface Board)
                 1                             PC1                              NIRQx                               1
                 2                             PC6                               NCSx                              18
                 3                             PC4                              PWM2                                2
                 4                             PD2                                RXD                              17
                 5                             PB5                              PWM1                                3
                 6                             PE5                              NTRIG                              16
                 7                             PD0                              PWM3                                4
                 8                             PE4                               NIRQ                              15
                 9                             PB1                                SCK                               5
                10                             PD3                                TXD                              14
                11                             PB0                                NCS                               6
                12                             PB3                               MISO                              13
                13                             PF0                               VDIV                               7
                14                             PB2                               MOSI                              12
                15                             GND                                GND                               8
                16                          PB6/Reset                            NRES                              11
                17                             PF1                               VDIVx                              9
                18                          VCC_AVR                           VCC_SBC                              10
    The three connections marked in bold are made via jumpers and the other connections are hardwired with a test point for
    easy access.
                                                                                 ATAN0063 [APPLICATION NOTE]                  23
                                                                                                        9300D–AUTO–03/15


3.4     Jumper Description
        In order to be more flexible and to meet as many requirements as possible, some jumpers are provided on the development
        board. With the help of these jumpers, users have the opportunity to work with the system itself in order to test some features
        and/or to modify the system to meet their requirements. In the following sections all jumpers on the development board are
        briefly described.
Figure 3-8. Jumpers on the Atmel ATAK43001-V1 Kit
3.4.1   Jumper VCC - J1 (PC Interface Board)
        There are three different ways to supply the microcontroller:
          ● Directly from the USB bus (5V supply) (jumper between 2 and 3)
          ●     Via an on-board voltage regulator (3.3V supply) (jumper between 1 and 2) or
          ●     Via the voltage regulator of the Atmel ATA664251 device (5V); jumper JP1 should be left unconnected and jumper
                JP16 should be set (left side).
        By default, this jumper is set connecting the microcontroller to the USB bus supply. Changing the position of this jumper
        causes the microcontroller to be supplied via the on-board 3.3V voltage regulator.
        To supply the microcontroller (AT90USB1287) from the voltage regulator of the Atmel ATA664251 device, remove this
        jumper and set jumper J16 (left side).
3.4.2   Jumper Reset - J2 (PC Interface Board)
        By default, this jumper is set connecting the NRES output of the LIN SBC and PB6 input of the microcontroller. If desired or
        needed, or when simply changing the position of this jumper, the NRES could be connected to the reset input of the
        microcontroller. This means the microcontroller is reset in the event of watchdog failure or undervoltage at the voltage
        regulator output. It is helpful to leave the jumper in the default position for testing purposes, debugging, etc.
3.4.3   Jumper Reset - J12 (Atmel ATAB664251A Board)
        By default, this jumper is set with the NRES output of the Atmel ATtiny167 and GND connected, thus holding the
        microcontroller inside the Atmel ATA664251 device in reset. In this case the SBC is controlled from GUI via the
        AT90USB1287 (on the PC interface board). To enable the ATtiny167 move this jumper to the left position or leave it open
        and make sure that the jumper J16 is also set in the left position.
        Setting the jumper J12 in the left position connects the reset pin of the Atmel ATtiny167 with the NRES pin of the SBC. This
        means the ATtiny167 is reset in the event of watchdog failure or undervoltage at the voltage regulator output. It is helpful to
        leave the jumper open for testing purposes, debugging, etc.
24      ATAN0063 [APPLICATION NOTE]
        9300D–AUTO–03/15


3.4.4   Jumper SBC VCC - J16 (Atmel ATAB664251A Board)
        By default, this jumper is not set and the microcontroller (AT90USB1287) is supplied either from the USB or from 3.3V
        external voltage regulator. To supply the microcontroller (AT90USB1287) via the voltage regulator of the Atmel ATA664251
        this jumper has to be set on the left side and the jumper J1 (PC interface board) has to be removed.
        Setting this jumper on the right side the Atmel ATtiny167 within the Atmel ATA664251 device powers it. In this case please
        make sure that neither the jumper J12 is set to the right side (GND) nor the PC interface board is plugged to the
        ATAB664251A board.
3.4.5   Jumper Settings for the CSx Ports (Atmel ATAB664251A Board)
        The I/Os pins are intended for contact monitoring and/or constant current sourcing. For maximum flexibility there are various
        components that can be easily connected to the HV I/O ports. The following sections provide a detailed description of how
        the CSx port hardware can be configured.
3.4.5.1 Jumpers of CS1…3
        Jumper JP1…3
        With the jumper header JP1…3 the user can select whether an RGB LED, three simple LEDs (connected in series), rotary
        switch, or a push button is connected to the respective CSx port.
Figure 3-9. Jumpers JP1…3
        By default, this jumper is set so that the CS1…3 ports are connected to the three simple LEDs (red) - LD1…3, LD7…9 and
        LD13…15. Those LEDs are hardwired to VBAT so that the LEDs are turned on when one or all of the CS1…3 ports are
        configured as low-side and are enabled.
        For demonstration purposes a second jumper (in addition to the default jumper) could be set, connecting the three green
        LEDs, showing that by only changing one bit the CS1…3 ports can be configured as high-side or low-side. In the case the
        supply voltage has to be lower than 10V (see Figure 8-2 on page 46).
        If customer-specific circuitry needs to be connected to one or all of the CS1…3 ports, the jumper has to be disconnected and
        the customer circuitry can then be connected to one of the pins on the upper side of the pin headers PJ1…3.
                                                                                     ATAN0063 [APPLICATION NOTE]                   25
                                                                                                           9300D–AUTO–03/15


        Jumper JP9…JP11
        The I/Os pins CS1 to CS3 can be configured either as current sources (such as for switches toward ground) or as current
        sinks (such as for switches toward battery). With the jumpers JP9…11 the user can specify if the particular CSx port should
        be connected to ground or the VBAT. By default, these jumpers are set connecting the CS1…3 ports with VBAT.
3.4.5.2 Jumper of CS4…8 - JP4…8
        With the jumper header JP4…8 the user can select whether three simple LEDs (connected in series), a rotary switch, or a
        push button is connected to a given CSx port. By default, this jumper is set so that the CS4…8 ports are connected to the
        three simple LEDs (green) - LD19…33.
        If customer-specific circuitry needs to be connected to one or all of the CS4…8 ports, the jumper has to be disconnected and
        the customer circuitry can then be connected to one of the pins on the upper side of the pin headers PJ4…8.
Figure 3-10. Jumpers JP4…8
26      ATAN0063 [APPLICATION NOTE]
        9300D–AUTO–03/15


3.5     LEDs Description
Figure 3-11. LEDs on the Atmel ATAK43001-V1 Kit
3.5.1   Power LED (PC Interface Board)
        The blue USB power LED is connected directly to the VCC pin of the USB connector (see Figure 3-11, reference point 19).
        The SBC power LED is always lit when power is available at the USB connector.
3.5.2   Power LED (Atmel ATAB664251A Board)
        The blue SBC power LED is connected directly to the VS pin of the Atmel ATA664251 device (see Figure 3-11, reference
        point 24). The SBC power LED is always lit when power is available at the VBAT and GND connector (reference point 1). For
        current consumption measuring purposes the SBC power LED and the VCC SBC LED might have to be disabled. To do so,
        the resistors R38 and R39 have to be desoldered.
3.5.3   Mode Status LEDs (PC Interface Board)
        There are 3 LEDs (see Figure 3-11, reference point 21) on the PC interface board. The preprogrammed firmware in the
        Atmel AT90USB1287 uses these 3 LEDs to display the current mode of the Atmel ATA664251:
          ● LD4 (green) - active mode
          ●    LD3 (red) - sleep mode
          ●    LD2 (yellow) - active low-power mode
        These 3 LEDs can be used for any indication or debug purposes.
3.5.4   VCC SBC LED (Atmel ATAB664251A Board)
        The green VCC SBC LED on the Atmel ATA66xA board is connected directly to the VCC pin of the Atmel ATA664251 device
        (see Figure 3-11, reference point 19). This LED is always lit when the Atmel ATA664251 is in active mode. The voltage
        regulator of the Atmel ATA664251 device is only on in active mode; in all other modes it is off.
                                                                                    ATAN0063 [APPLICATION NOTE]                27
                                                                                                          9300D–AUTO–03/15


3.5.5 RGB LED (Atmel ATAB664251A Board)
      An RGB LED is mounted on the Atmel ATA664251 board to demonstrate that the Atmel ATA664251 is capable of driving
      RGB LEDs. The RGB LED is connected via jumpers J1…J3 to the CSx ports as follows:
        ● CS1 - blue
        ●    CS2 - red
        ●    CS3 - green
      The RGB LED is hardwired to GND. Therefore, when using the RGB LED (see Section “Jumper JP1…3” on page 25 for
      correct jumper settings), the CS1…3 ports have to be high-side configured. The RGB LED can be permanently driven with
      the selected constant current (see Section 3.6.6 “Changing the Current Level of the Current Sources” on page 31) from the
      CS1…3 ports or with PWM signals fed on the PWM1…3 pins of the Atmel ATA664251 device (for more information, see
      Section 5. “Atmel ATA664251 Demo GUI Description” on page 33 and the Atmel ATA664251 datasheet).
3.5.6 Low-Side LEDs (Atmel ATAB664251A Board)
      The red LEDs LD1…3, LD7…9 and LD13…15 are hardwired to VBAT and via the jumpers JP1…JP3 to the CS1…3 ports of
      the Atmel ATA664251 device.
      When one or all of the CS1…3 ports is/are configured as low-side and enabled, and the jumpers JP1…3 are set so that the
      red LEDs are connected to the CS1…3 ports (see Section “Jumper JP1…3” on page 25 for correct jumper settings), then
      the red LEDs are lit.
3.5.7 High-Side LEDs (Atmel ATAB664251A Board)
      The green LEDs LD4…6, LD10…12 and LD16…33 are hardwired to VBAT and via the jumpers JP1…JP8 to all CS1…8
      ports of the Atmel ATA664251 device.
      When one or all of the CS1…8 ports is/are enabled (CS1…3 have to be configured as low-side) and the jumpers JP1…8 are
      set so that the green LEDs are connected to the CS1…8 ports (see Section “Jumper JP1…3” on page 25 and Section
      3.4.5.2 “Jumper of CS4…8 - JP4…8” on page 26 for correct jumper settings), then the green LEDs are lit.
3.6   Other Components
      The development board for the Atmel ATA664251 comes with some additional components which can be replaced in order
      to adapt the LIN node to user-specific requirements. These components are shown and described in the following sections.
3.6.1 Push Buttons (Atmel ATAB664251A Board)
      There are eight push buttons on the Atmel ATA664251 board demonstrating the switch scanning/monitoring capability of the
      Atmel ATA664251.
      The push buttons S1…3 can be connected to GND or VBAT via the jumpers JP9…11. The push buttons 4…8 are hardwired
      to GND.
      All 8 push buttons are connected to the CS1…8 ports via the jumpers JP1…8 (see Section “Jumper JP1…3” on page 25
      and Section 3.4.5.2 “Jumper of CS4…8 - JP4…8” on page 26 for correct jumper settings).
28    ATAN0063 [APPLICATION NOTE]
      9300D–AUTO–03/15


3.6.2 Rotary Switches (Atmel ATAB664251A Board)
      Eight rotary switches are mounted on the Atmel ATAB664251A board to simulate coded switches. The rotary switches S can
      be connected to GND or VBAT via the jumpers JP9…11. The rotary switches S10, S12, S14, and S16 are hardwired to
      GND.
      All eight rotary switches are connected to the CS1…8 ports via the jumpers JP1…8 (see Section “Jumper JP1…3” on page
      25 and Section 3.4.5.2 “Jumper of CS4…8 - JP4…8” on page 26 for correct jumper settings).
      Figure 3-12. Rotary Switches S2, S4, and S6
      Figure 3-13. Rotary Switches S10, S12, S14, and S16
      Table 3-4.     Coding of the Rotary Switches
            Position            0        1          2       3           4         5       6         7        8         9
                        8                                                                                    X         X
                        4                                               X         X       X         X
           Code
                        2                           X       X                             X         X
                        1                X                  X                                       X                  X
                                                                                 ATAN0063 [APPLICATION NOTE]              29
                                                                                                    9300D–AUTO–03/15


        When one or all of the CS1…8 ports is/are enabled and the jumpers JP1…8 are set so that the rotary switches are
        connected to the CS1…8 ports (see Section “Jumper JP1…3” on page 25 and Section 3.4.5.2 “Jumper of CS4…8 - JP4…8”
        on page 26 for correct jumper settings), a different voltage value resulting from the CSx output current, dependent on the
        position of the rotary switch, can be measured (and displayed in the GUI) on the VDIV pin (see also Section 5.6 “Voltage
        Divider Section” on page 38).
3.6.3   Configuring the Atmel ATAK43001-V1 Kit as a Master or a Slave Node
        Both the LIN2.0 and LIN2.1 specifications specify that the master node in a LIN network has to be set up as shown below.
        Figure 3-14. External Circuitry for a LIN Master Node
        The difference between a master node and a slave node with regard to the hardware is the additional diode Dser_master
        together with a serial 1k pull-up resistor between Vsup and the LIN line. The two components D1 and R42 on the
        ATA66B4251A board required for LIN master applications are shown in Figure 3-15.
Figure 3-15. The Diode and Resistor Required for LIN Master Applications
30      ATAN0063 [APPLICATION NOTE]
        9300D–AUTO–03/15


3.6.4   Generating a Local Wake-Up on CL15
        A positive edge at pin CL15 followed by a high-voltage level for a given time period (> tCL15deb) results in a local wake-up
        request and the device switches to active mode. The debounce time ensures that no transients at CL15 create a wake-up.
        In order to show this function easily a switch is implemented between the CL15 pin and VS. When the device is in sleep
        mode, pressing the S115 switch generates a wake-up pulse. The local wake-up request is indicated by a low level at the
        NIRQ pin, generating an interrupt for the microcontroller, which is displayed in the GUI.
Figure 3-16. Button for Local Wake-Up on CL15
3.6.5   Changing the Watchdog Timings
        On the Atmel ATA66B4251A board, the watchdog timing is generated by default with the help of the 51k resistor R2
        connected between the WD_OSC pin and ground. In order to change these timings, the resistor R2 has to be changed. A
        description of how the R2 resistor influences the watchdog timing can be found in Section 5.7 “Watchdog Section” on page
        39 (NTRIG, WD_OSC, and NRES) and in the Atmel ATA664251 datasheet.
3.6.6   Changing the Current Level of the Current Sources
        The current sources are available in active mode. They deliver a current level derived from a reference value measured at
        the IREF pin. This pin is voltage-stabilized (VIREF = 1.23V typ.) so that the reference current is directly dependent on the
        externally applied resistor (R3) connected between the IREF pin and ground. The resulting current at the CSx- pins is
        (1.23V/RIref)  rICS.
        By default, a 12k resistor is mounted between IREF and GND; therefore the resulting current at the CSx pins is 10mA
        (assumed IMUL = '0' => rICS_H = 100).
        Both a missing and a short-circuited resistor are detected. In this case, an internally generated reference current IIREFfs is
        used instead to maintain fail-safe functionality.
3.6.7   Using the ATAB664251A Board Stand-Alone
        The Atmel ATA664251 kit allows users to learn more about Atmel ATA664251 device features by using the demo GUI but
        also to build their own applications and write own software using the kit.
        Only a few steps are needed to prepare the kit before creating your own applications. First, disconnect the PC interface
        board from the ATAB664251A board, then remove the J12 jumper (for debug and test purposes it should be left open) and
        set the J16 jumper to the right side. Now after powering up the board the Atmel ATA664251 (the ATtiny167 and the SBC)
        device is ready for use.
        The Atmel ATtiny167 can be programmed and debugged with an appropriate programming tool via the ISP1 connector.
        For applications where the 3x different PWM signals have to be generated to control the CS1…8 HV I/O ports (for example,
        RGB LED control), the Atmel ATtiny167 and the SBC have to be interconnected in a different way because the timers of the
        Atmel ATtiny167 are available on certain I/O pins only. The SPI pins (MISO, MOSI, and SCK) have an alternate function
        which is needed to generate PWM signal. That is why instead of the SPI the USI interface has to be used for communicating
        with the SBC. Two SMD DIP switches are included on the board to facilitate quick rerouting of the MISO, MOSI, and SCK
        SBC lines to the corresponding Atmel ATtiny167 I/O pins.
                                                                                       ATAN0063 [APPLICATION NOTE]                     31
                                                                                                               9300D–AUTO–03/15


4.  Programming and Debugging
    The easiest way to program and to debug the Atmel® AT90USB1287 is to use the Atmel Studio environment together with
    the STK500/600 or the JTAG-ICE MkII from Atmel. Atmel Studio is an integrated development platform (IDP) for writing and
    debugging AVR applications in Windows® 9x/Me/NT/2000/XP/7 environments. Atmel Studio provides a project management
    tool, source file editor, chip simulator, and in-circuit emulator interface for the powerful AVR 8-bit RISC family of
    microcontrollers.
4.1 Programming
    Connect the selected hardware (STK500/600 or JTAG-ICE MkII) to the ISP or JTAG header of the ATAB0004A board
    respectively. Pin “1” is marked with two small triangles on the board. In the Atmel Studio select the Atmel AT90USB1287.
    For more information about using the STK500/600, the JTAG-ICE MkII, or the Atmel Studio, see the relevant documentation
    available on the Internet.
4.2 Debugging
    Combined with Atmel Studio, the JTAGICE MkII can perform on-chip debugging on all AVR 8-bit RISC microcontrollers with
    a JTAG or debugWIRE interface. The Atmel AT90USB1287 comes with a debugWIRE interface so only a minimum of three
    wires is required for communication between the JTAGICE MkII and the board. These signals are RESET, VCC, and GND.
    The debugWIRE on-chip debug system uses a one-wire bidirectional interface to control the program flow, execute AVR
    instructions in the CPU, and to program the different non-volatile memories. For debugging via debugWIRE, the reset line is
    used and the NRES jumper has to be removed because the JTAG ICE mkII requires exclusive access to this line.
    For more detailed information about debugging via the debugWIRE interface, see the relevant documentation available on
    the Internet.
32  ATAN0063 [APPLICATION NOTE]
    9300D–AUTO–03/15


5. Atmel ATA664251 Demo GUI Description
   The Atmel® ATA664251 demo GUI (graphical user interface) is a software tool for configuring and demonstrating the Atmel
   ATA664251 device using the Atmel ATAK43001-V1 kit.
   The Atmel ATA664251 demo GUI was designed to minimize the learning curve for using the Atmel ATA664251 device in the
   user application. It is divided into 11 main sections:
     ● SBC: general SBC settings and mode status
     ●     Current SBC Status: displays the current SBC status (16-bit status register)
     ●     Command Builder: builds a specific command and sends to the SBC
     ●     SPI-Log-Window: the complete SPI communication is logged in here
     ●     I/O Ports: configuration settings for all high-voltage I/O ports
     ●     Voltage Divider: voltage divider settings and display of the currently measured voltage
     ●     Watchdog: watchdog settings
     ●     LIN: LIN interface settings
     ●     PWMx: PWM test settings for the three different PWM inputs
   Figure 5-1. Atmel ATA664251 Demo GUI
   In the following section the Atmel ATA664251 demo GUI sections are described in detail, including some examples showing
   how to configure the Atmel ATA664251 device.
                                                                                  ATAN0063 [APPLICATION NOTE]           33
                                                                                                    9300D–AUTO–03/15


5.1 SBC Section
    After executing the Atmel ATA6641xx_Demo.exe file, the Atmel ATA664251 is automatically set to active low-power mode.
    This is indicated in the GUI: Figure 5-2 (yellow LED - ActiveLP is ON) and on the PC interface board (LED - LD2 is ON
    (reference point 21)) as well (please see Figure 2-12 on page 13).
    In this mode, only the VCC voltage regulator is active and can therefore supply the application’s microcontroller. All other
    functions of the Atmel ATA664251 are disabled in the configuration register or inhibited by the PWM pins for the CSx pin
    current sources. This reduces the current consumption of the chip itself to a low-power range typically below 50µA. Note that
    this is only valid if the chip select input of the SPI, NCS, is also kept at a high level. If it is pulled to ground, SPI
    communication is enabled, causing higher current consumption.
    The Atmel ATA664251 can easily be set to active mode (simply press the “Active Mode” button) with all peripherals/functions
    enabled, or set to sleep mode (simply press the “Go to Sleep” button), which switches off all peripherals, i.e., the LIN
    transceiver, the watchdog, the voltage dividers, the switch interface unit, and the VCC voltage regulator. The overall supply
    current on the VS pin is then reduced to a minimum (typ. 8µA). In sleep mode the GUI is also disabled and no changes can
    be made as long as the device is in sleep mode.
    Two wake-up mechanisms are possible for leaving the sleep mode again: wake-up via LIN and wake-up via CL15. A wake-
    up via CL15 is easily generated by pressing the S115 switch.
    The SPI data rate can be modified; it is 4MHz by default.
    Figure 5-2. SBC Section
5.2 Current SBC Status Section
    Section 5.2 “Current SBC Status Section” on page 34 indicates the status of the Atmel ATA664251. The 16 bits of the status
    register, NRES, and NIRQ are displayed where the 16 status bits are updated after a new SPI command.
    This means, for example, that if you enable the watchdog with an SPI command, the status “Watchdog Active” is not
    reported in this data transmission but in the next one.
    Depending on the setting of the VDIVE bit, the bits 15 to 12 in the status register have a different meaning:
      ● VDIVE=0: bits 15 to 12 show the overtemperature status of different peripherals.
    Figure 5-3. Current SBC Status Section VDIVE=0
34  ATAN0063 [APPLICATION NOTE]
    9300D–AUTO–03/15


      ●    VDIVE=1: bits 15 to 12 show the selected source for the voltage monitor (VBATT or CS1…8).
    Figure 5-4. Current SBC Status Section VDIVE=1
    For more information on the single bits, see Table 7-4 in the Atmel ATA664251 datasheet.
5.3 Command Builder Section
    Section 5.3 “Command Builder Section” on page 35 gives the user the ability to create and send any command to the Atmel
    ATA664251 device. There are two possible ways to create a command: either by selecting the desired bits or just typing a
    sixteen-bit value into the “Data to Send” field (press “Enter” to activate the typed value).
    In order to avoid false watchdog disabling, the configuration bit (WDD) needs to be written twice. Therefore two consecutive
    SPI words are sent in order to alter the WDD bit to ‘1’.
    Depending on the setting of the CSPE bit, bit 1 in the configuration register has a different function:
      ● CSPE=0: bit #1 enables/disables the slope control of the CS ports
    Figure 5-5. Command Builder Section CSPE=0
      ●    CSPE=1: bit #1enables interrupt from addressed switch input (CS1…8)
    Figure 5-6. Command Builder Section CSPE=1
    For more information on the single bits, see Table 7-1 in the Atmel ATA664251 datasheet.
                                                                                    ATAN0063 [APPLICATION NOTE]               35
                                                                                                         9300D–AUTO–03/15


5.4 SPI Log Window Section
    The complete communication to and from the Atmel ATA664251 device is logged into the “SPI Log Window.” If a specific
    command has to be resent, just copy and paste it into the “Data to Send” field in Figure 5-7 and press “Send.”
    Figure 5-7. Command Builder Section
5.5 I/O Ports Section
    A total of eight high-side current sources with high-voltage comparators and voltage dividers are available. Note that three of
    them (CS1, CS2, and CS3) can also be switched to low-side current sinks. All eight high-voltage I/O ports can be configured
    separately with the three or four configuration bits:
      ● CSE: Enable/disable addressed current source (CS1…CS8)
      ●      CSC: Control of addressed current source (CS1…CS8) - controlled either by PWMy input or internally by CSE
      ●      CSIE: Enable/disable from interrupt from addressed switch input (CS1…CS8)
      ●      CSSSM: Switch between source/sink mode (CS1…CS3 only)
    The output current level can be divided by 2 using the IMUL bit. With the default setting of IMUL = ‘x100’ the resulting current
    at the CSx- pins is (1.23V/R3) x 100 = 10mA (default value for R3 is 12k).
    The CSSCD bit is the one common control bit for all current sources. With this bit, the slope control of all eight sources can
    be disabled. By default, the slope control is activated and all currents are switched on and off smoothly. When setting this bit
    to ‘1’ the current sources are enabled and disabled without transition times. In order to change the configuration of a certain
    current source via SPI, it must be addressed and the current source programming CSPE bit must be set to ‘1’ (in the GUI this
    is done automatically).
36  ATAN0063 [APPLICATION NOTE]
    9300D–AUTO–03/15


Figure 5-8. I/O Port Section
Example 1: Enabling a particular current source and controlling it via the CSC bit or via the PWMy input:
In this example, the CS1 port is connected to the green/red LEDs (the following is valid for CS1…8). Set the J1 jumper to the
second position (counted from left to right). Then all that has to be done in the GUI is to select the corresponding CSE bit and
CSC bit (for internal control) and press the “Configure CS1” button. Now the CS1 port is enabled as indicated by illuminated
green LEDs and configured as the high-side current source and controlled by the internal logic.
The control of the current source can be easily changed to be PWM-controlled by deselecting the CSC bit and pressing the
“Configure CS1” button again; this turns off the LEDs. The PWM1 pin is assigned to the CS1 port. By default the PWM mode
in the GUI is set to static-low, meaning the PWM1 input is actively kept to low. To turn on the LED the PWM must be
changed to static-high, which is equal to CSC=1, or “pulsed” selected where the signal with default period (1ms) and pulse
width (100µs) is to be generated on the PWM1 pin. To adjust the brightness of the LEDs, simply change the period and the
pulse width as desired.
To configure the CS1 port as the low-side current source (this is only valid for CS1…3), simply set the CSSSM bit and set
the jumper at the very first position on the left side.
Example 2: Connecting a switch to a specific current source (Contact Monitoring):
Now the CS1 port is connected to a tactile switch (S1) (the following is valid for CS1…8). Change the jumper setting of J1 to
the second position from the right, with jumper J9 connecting the middle and right pin (the tactile switch is connected toward
GND). Configure and enable a high-side current source for the CS1 port (set CSE and CSC bits and press “Configure CS1”
button). From the voltage divider section, select the CS1 port as ADC source and activate continuous voltage measurement.
By pressing the tactile switch (S1) the measured voltage in the voltage divider section changes to 0V because the CS1 port
is then (when S1 is pressed) connected directly to GND. This status change is also indicated with the CS1CS bit in the status
register. Please note that the status bits in the “Current SBC Status” section are updated only after an SPI command has
been sent.
Now the interrupt from the CS1 port is enabled and the CS1 port to be PWM1-controlled is configured. To do this, set the
CSIE bit and deselect the CSC bit. Finally, press the “Configure CS1” button and set the pulsed mode in the PWM1 section.
                                                                                ATAN0063 [APPLICATION NOTE]                   37
                                                                                                        9300D–AUTO–03/15


    Now the output state of the HV comparator is sampled with each falling edge of the PWMy or CSC signal. As soon as the
    sampled state changes (S1 pressed), an interrupt request is generated and reported by a low level on the NIRQ pin
    (automatically displayed in the “Current SBC Status” section). Please bear in mind that the NIRQ pin remains at ground until
    the end of the next SPI command.
    The same can be done when the CS1 port is configured as low-side current source (enable the CSSSM bit and change the
    setting of the J9 jumper to the left) (this is only valid for CS1…3).
5.6 Voltage Divider Section
    The VDIV pin provides a low-voltage signal for the microcontroller’s ADC which is linearly dependent on the input voltage. It
    is sourced either by the VBATT pin or one of the switch input pins CS1 to CS8.The divider ratio of the measured input
    voltage for the Atmel ATA664251 is 1:4. This results in maximum output voltages on the VDIV pin when reaching 20V at the
    input.
    The voltage on this pin is actively clamped to VCC if the input value would lead to higher values.
    Figure 5-9. Voltage Divider Section
    The displayed voltage value in the voltage divider section is the result of the following equation:
    Input_Voltage = (Divider_Ratio VDIV_Value Reference_Voltage)/1023
      ● Input_Voltage is the measured and displayed voltage.
      ●    Divider_Ratio is 4.
      ●    VDIV_Value is the measured voltage at the VDIV pin.
      ●    Reference_Voltage is the internal reference voltage of the microcontroller, which is dependent on the microcontroller’s
           supply voltage (for setting jumper J1 and J16, see Section 3.4.1 “Jumper VCC - J1 (PC Interface Board)” on page 24
           and Section 3.4.4 “Jumper SBC VCC - J16 (Atmel ATAB664251A Board)” on page 25).
    Because the supply voltage of the microcontroller is not measured precisely, a fixed values of 5.0V for the
    Reference_Voltage is used. If a more precise display of the measured voltage is desired, the real supply voltage of the
    microcontroller has to be measured and typed in the “Ref. Voltage” field. This value is used in the equation above to
    calculate the input voltage only when the
    button is pressed. The input voltage can be measured continuously or at intervals.
38  ATAN0063 [APPLICATION NOTE]
    9300D–AUTO–03/15


5.7 Watchdog Section
    The watchdog expects a trigger signal from the microcontroller at the NTRIG (negative edge) input within a time window of
    twd = tNTRIG. The trigger signal must exceed a minimum time ttrigmin > 7µs. If a triggering signal is not received, a reset signal
    will be generated at output NRES. The timing basis of the watchdog is provided by the internal watchdog oscillator. Its time
    period, tWDosc, is adjustable between 20ms and 64ms using the external resistor R2 (34k …120k; the default value is
    51k). During sleep mode the watchdog is switched off to reduce current consumption.
    The GUI offers the option of experimenting with trigger values (simply change the tNTRIG value) or even disabling the trigger
    signal in order to gain a better understanding of how the watchdog works.
    Figure 5-10. Watchdog Section
    In order to avoid false watchdog disabling, this configuration bit (WDD) needs to be written twice. Therefore two consecutive
    SPI words are sent in order to alter the WDD bit to ‘1’.
    To disable the watchdog directly after power-up (e.g., for microcontroller programming or debugging purposes)
    (i.e., after external power-up or after sleep mode), the VDIV pin has to be tied to VCC until the start-up time treset of
    typ. 4ms has elapsed.
    The minimum time for the first watchdog pulse is required after the undervoltage reset at NRES disappears. It is defined as
    lead time td = 155ms (for more information, please see Section 10 in the Atmel ATA664251 datasheet). After wake-up from
    sleep mode, the lead time td starts with the positive edge of the NRES output.
5.8 LIN Section
    The LIN interface of the Atmel ATA664251 device has to be activated via an SPI command. This is done with the GUI by
    simply pressing the “LIN Interface” button.
    Figure 5-11. LIN Section
    The slope control of the LIN transceiver can be switched off to achieve higher bit rates (up to 200kBit/s). Then the slope time
    of the LIN falling edge is < 2µs. The slope time of the rising edge greatly depends on the capacitive load and the pull-up
    resistance at the LIN line. To achieve a high bit rate Atmel recommends using a small external pull-up resistor (500) and a
    small capacitor. Superior EMC performance is not guaranteed in this high-speed mode.
    For test purposes a test signal (10Hz - 200kHz) can be generated at the TXD pin and if the LIN interface is enabled, the
    same signal can be observed at the LIN pin.
    In order to achieve any long dominant state on the pin LIN (such as PWM transmission or low bit rates), the time-out function
    can be easily disabled by pressing the “TXD Time-Out” button.
                                                                                   ATAN0063 [APPLICATION NOTE]                      39
                                                                                                           9300D–AUTO–03/15


5.9 PWMy Section
    There are three PWM sections in the GUI where a specific PWM signal can be generated at the corresponding PWM inputs
    of the Atmel ATA664251 device.
    Figure 5-12. PWM Section
    The switch interface current sources can be controlled directly via the PWMy input pins, such as for pulse-width-modulated
    load control or for pulsed switch scanning.
    The assignment of the current sources to the three PWM input pins is shown in Table 5-1.
    Table 5-1.     CSx Port Configuration Table
        PWM Port           CS1          CS2            CS3          CS4          CS5         CS6           CS7           CS8
         PWM1               x            -              -             -            -            -            x            x
         PWM2               -            x              -             -            x            x            -            -
         PWM3               -            -              x            x             -            -            -            -
    To enable the external control functionality of a given current source the relevant CSC bit should be disabled (please see
    Section 5.5 “I/O Ports Section” on page 36). External PWM signals could be applied at the PWMy input pins or the GUI could
    be used to generate a PWM signal on the PWMy input pins. In the PWM 1…3 sections in the GUI three independent PWM
    signals can be generated; just type in the desired period and pulse width and select “pulsed” as the PWM mode. The PWM
    3 signal is generated by using the 8 bit timer of the AT90USB1287 (PC Interface board), therefore fine settings for the
    “PWM3-Pulsewidth” are not possible like for the PWM 1 and PWM 2, where 16 bit timers are used to generate the PWM
    pulses.
40  ATAN0063 [APPLICATION NOTE]
    9300D–AUTO–03/15


6.    Operation Using the Default Software
6.1   Standalone Demonstration Quick Start User Guide
      As the SiP on the Atmel® ATAB664251A-V1.0 includes an Atmel ATtiny167 AVR® 8-bit microcontroller, the Atmel
      ATAB664251A-V1.0 board can operate “standalone” without the PC interface board connected. The following sections
      describe standalone operation with the default software programmed in the Atmel AVR 8-bit microcontroller.
6.1.1 Configuration for Standalone Operation
        1.   Disconnect the PC interface board
        2.   Configure the jumpers and switches
               ●    Jumper reset - J12 (Atmel ATAB664251A board)
                    Jumper J12 controls the reset signal to the Atmel ATtiny167 microcontroller. Remove jumper J12 or set jumper
                    J12 in left side (NRES) for standalone operation. Refer to Section 3.4.3 “Jumper Reset - J12 (Atmel
                    ATAB664251A Board)” on page 24 for additional information concerning this jumper.
               ●    Jumper SBC VCC - J16 (Atmel ATAB664251A board)
                    Jumper J16 controls the supply voltage to the Atmel ATtiny167 microcontroller. Set jumper J16 to the right side
                    (VCC microcontroller) for standalone operation. Refer to Section 3.4.4 “Jumper SBC VCC - J16 (Atmel
                    ATAB664251A Board)” on page 25 for additional information concerning this jumper.
               ●    Jumper J1 to J3
                    Set jumpers J1, J2 and J3 each to the left-most position to connect the constant current source to the RGB
                    LED (LD36).
               ●    Jumper J4
                    Set jumpers J4 to the right-most position to connect to the push button S7.
               ●    Jumper J5 to J8
                    Set jumpers J5, J6, J7 and J8 each to the left-most position to connect the constant current source to the green
                    LED’s (LD22 through LD33).
               ●    Switch S20 and S21
                    Switches S20 and S21 are used to select the peripheral used for the SPI communication between the Atmel
                    ATtiny167 microcontroller and the Atmel ATA664151 LINSBC. If both switches S20 and S21 are in the right
                    position, the USI peripheral in the Atmel ATtiny167 microcontroller is used to communicate with the LINSBC. If
                    both switches S20 and S21 are in the left position, the SPI peripheral in the Atmel ATtiny167 microcontroller is
                    used to communicate with the LINSBC. For standalone operation with the default software programmed in the
                    Atmel AVR 8-bit microcontroller, switches S20 and S21 should be set in the right position (USI).
               ●    Header X4
                    Apply 12V power and ground to header X4.
6.1.2 Standalone Demonstration Operation
      After applying power to header X4, the blue power LED (LD34) and green VCC SBC LED (LD35) should be on indicating
      power is supplied to the Atmel ATtiny167 microcontroller. The RGB LED (LD36) should show blue, the LEDs assigned to
      CS5
      (LD22-LD24) should flash approximately 0.5 seconds on - 0.5 seconds off, and the LEDs connected to CS6 (LD25-LD27)
      should be on.
      After powering up, subsequent presses of the push button (S7) connected to CS4 will cycle LED’s in the following manner,
      demonstrating the capabilities of the device to interface to switch type inputs and drive outputs:
      RGB LED (LD36): RED → GREEN → WHITE → OFF → BLUE → RED → …
      LEDs connected to CS6-CS8 (LD25-LD33): Cycle through binary codes for 2 → 3 → 4 → 5 → 6 → 7 → 0 → 1 → …
      (LEDs connected to CS6 represent the least significant bit of the binary code)
      The LEDs connected to CS5 (LD22-LD24) should continue to blink on-off at the same rate.
                                                                                    ATAN0063 [APPLICATION NOTE]                   41
                                                                                                          9300D–AUTO–03/15


6.2   LIN Slave Node Demonstration Quick Start User Guide
      The default standalone demonstration software also includes the capability for the Atmel® ATAB664251A board to operate
      as a LIN slave node responding to messages from a LIN master node. Among other things, the standalone demonstration
      illustrates the use of the LIN SIP for ambient lighting applications by controlling the RGB LED based on messages received
      from a LIN master node.
6.2.1 Configuration for Ambient Lighting LIN Slave Node
      The Atmel ATAB664251A board should be configured as described in Section 6.1.1 “Configuration for Standalone
      Operation” on page 41. In addition, the LIN BUS from the LIN master node should be connected to header X5.
      The Atmel AT32UC3C-EK evaluation kit (available separately) can be utilized as the LIN Master. Software is available from
      Atmel for this kit to configure it to send ambient lighting messages over the LIN bus in response to actions on the kit’s user
      interface, allowing the user to send different RGB values to each of several ambient lighting slave nodes. Each slave node
      should respond only to the ambient lighting messages directed to its slave node address.
6.2.2 Ambient Lighting LIN Slave Node Operation
      The ambient lighting slave node address of the Atmel ATAB664251A board is selected using the push button (S7)
      connected to CS4. Successive presses of this push button increment the slave node addresses from 1 through 7; after
      address 7, a press of the push button selects an invalid slave address (meaning the board will not respond to any ambient
      lighting messages). A subsequent press of the push button after this starts the sequence again with a slave address of 1.
      The selected slave address is displayed in binary code on the LEDs connected to CS6-CS8 (LD25-LD33) with the LEDs
      connected to CS6 representing the least significant bit of the binary code. The invalid slave address is indicated by all the
      LEDs (LD25-LD33) being off.
      The Atmel ATAB664251A board will respond to ambient lighting messages targeted to its slave node address, allowing the
      RGB LED on the board to be controlled from a LIN master node.
6.2.3 LIN Messages Supported in the Default Software
      In addition to the LIN messages used for ambient lighting control, several other LIN messages are supported in the default
      software on the Atmel ATAB664251A board. These LIN messages allow for complete control of the LIN SBC features from a
      LIN master node.
      Table 6-1.       LIN Messages
             Message           PID    Direction(1)                      Data                    Notes
                                                                                                1 - The received value is transferred
             Set SBC                                                                                over SPI to the LIN SBC.
                                                          2 bytes:
          configuration       0x23      Receive                          Configuration register 2 - Ambient lighting operation will not
                                                      Bit 15 to Bit 0:
              register                                                                              work properly after this message is
                                                                                                    received.
                                                          8 bytes:
                                                      Bit 15 to Bit 0:       PWM Period
         Set PWM period                                                                         Period and duty cycles are in terms of
                              0x25      Receive       Bit 31 to Bit 16:   PWM-1 duty cycle
             and duty                                                                           microseconds (us); 1 count = 1µs.
                                                      Bit 47 to Bit 32:   PWM-2 duty cycle
                                                      Bit 63 to Bit 48:   PWM-3 duty cycle
                                                                                                Watchdog trigger period is in terms of
          Set watchdog                                     1 byte:
                              0x26      Receive                             Trigger period      milliseconds (ms); 1 count = 1 ms. A
          trigger period                               Bit 7 to Bit 0:
                                                                                                period of 0 will not generate a trigger.
                                                          4 bytes:
                                                       Bit 7 to Bit 0:   Slave node address
                                                                                                Duty cycles are scaled to 255 counts;
         Ambient lighting     0x2C      Receive       Bit 15 to Bit 8:      Red duty cycle
                                                                                                255 counts = 100% duty cycle.
                                                      Bit 23 to Bit 16:    Green duty cycle
                                                      Bit 31 to Bit 24:    Blue duty cycle
                                                          4 bytes:
         Get SBC status                                                                         The transmitted value is the value
                              0x24      Transmit       Bit 15 – Bit 0:      Status register
        register and VDIV                                                                       obtained over SPI from the LIN SBC.
                                                      Bit 31 – Bit 16:    VDIV A/D reading
       Note:      1.   Direction is relative to the Atmel ATAB664251A board configured by default software as a LIN slave
42    ATAN0063 [APPLICATION NOTE]
      9300D–AUTO–03/15


6.3 Default Software Overview
    The following depicts an overview of the default software programmed in the Atmel® ATtiny167 AVR® 8-bit microcontroller.
    Figure 6-1. Overview of the Default Software
                                                   Reset
                                                                                                                        Timer0 Overflow Interrup
                                                                                                                             Periodic at 256µs Rate
                      AtaDevMCU_I ni t():
                      - 8MHz operat ion w/ int ernal clock
                      AtaDevTi mer_I ni t():                                                                  Manage “virtual” 16 Bit (max) PWM generation for
                      Timer0: 1Mhz clock, overf low int errupt enabled.                                       PWM1 output
                      Provides syst em int errupt every 256µs and “virt ual”                                  Provide 5ms scheduler tick for background
                      16 Bit PWM1 out put t o Swit chLI N SBC                                                 Manage SwitchLIN SBC watchdog timer every 1ms
                      - Timer1: 8MHz clock, no int errupt s. Provides PWM2
                      and PWM3 out put s t o Swit chLI N SBC
                      AtaDevAnal og_I ni t():
                      - Sof t ware t riggered conversion of VDI V input
                      AtaDevSwi tchLI N_I ni t():
                                                                                                                      Timer1 Compare A Interrup
                      - Conf igure USI t o provide SPI int erf ace t o Swit chLI N SBC
                      I ni ti al i ze PWM Duty Cycl es                                                  At PWM3 Period Completion and Duty Cycle Completion
                      I ni ti al i ze Swi tchLI N SBC Confi gurati on
                      I ni ti al i ze LI N Stack
                      Enabl e I nterrupts
                                                                                                              Manage PWM Generation for PWM3 Output
                      AtaDevVDIV_Sample(): Start VDIV sampling
                                                                                                                      Timer1 Compare B Interrup
                                                                                                        At PWM3 Period Completion and Duty Cycle Completion
                      AtaDevSwitchLIN_GetStatusReg(): Read status register
                      from SwitchLIN SBC
                      Buffer Status Register for LIN Transmit                                                 Manage PWM Generation for PWM2 Output
                      AtaDevVDIV_Get(): Read VDIV from ADC                                                    Note: Through the Timer0 overflow interrupt and the Timer1
                      Buffer VDIV for LIN transmission                                                        compare A/B interrupts, the software supports generation
                                                                                                              of the 3 PWM outputs at 3 different/ independent frequencies
                                                     5ms?
                                                                                                                          LIN Transfer Complete
                                                                                                                        At LIN Transfer Complete Event
                      LIN_Periodic_Tasks(): Manage LIN slave stack
                                                                                                              Manage LIN Communication
                      Process Received LIN Messages
                      - If Set SBC Configuration Register Mesage: Update
                      SwitchLIN SBC Configuration Register
                      - If Set PWM Period and Duty Message: Update PWM
                      period and duty
                                                                                                                                    LIN Error
                      - If Set Watchdog Trigger Period Message: Update
                                                                                                                                At LIN Error Event
                      SwitchLIN SBC watchdog trigger period
                      - If Ambient Lighting Message: If for this node address
                      then recale and update PWM period and duty
                                                                                                              Manage LIN Communication Errors
                      DebounceCS4_Switch(): Read CS4 push button input
                                                   LIN Bus                       USwitch Lin Standalone Demo(): If CS4 push button
                                                    Active?                      pressed, update PWM1 - 3 duty cycles in sequence
                                                                                 AmbientLightingAddrUpdate(): If CS4 push button
                                                  Default SBC
                                                                                 pressed, update node address and address LED Indicators
                                                 Configuration?
                                                                                 Flash CS5 LED
                      Manage SwitchLIN SBC Watchdog Trigger
                                                                                                                   ATAN0063 [APPLICATION NOTE]                             43
                                                                                                                                                       9300D–AUTO–03/15


7. Tools
   In combination with the STK500 and JTAG ICE MkII, Atmel Studio is a powerful tool for programming and debugging the
   AVR® microcontroller family in general.
   Furthermore, Atmel® provides cost-effective software support for the development of a LIN network. These can easily be
   used together with the development board.
   A LIN1.3 ANSI C software library for the AVR microcontroller family is available. The software library allows programming of
   protocol handling for LIN slave nodes. This library can be downloaded at http://www.atmel.com/Images/doc1637.pdf
   Many OEMs demand that their suppliers use certified third-party LIN protocol stacks. To meet this requirement there are
   LIN2.0 as well as LIN2.1 protocol stacks available for the large number of AVR microcontrollers from Mentor Graphics®,
   Vector Informatik, Warwick Control Technologies, Dunasys, and from IHR.
   Warwick Control Technologies offers the NETGEN configuration and autocoder tool. For testing purposes and to provide a
   quick start to using Atmel products, there is a limited but free version available. The demo version is available at
   http://www.warwickcontrol.com/
   For more information about the certified LIN stacks, please contact the third-party suppliers directly.
44 ATAN0063 [APPLICATION NOTE]
   9300D–AUTO–03/15


8. Schematics of the Atmel ATAK43001-V1 Kit
   Figure 8-1. Schematics of the PC Interface Board
                                                    ATAN0063 [APPLICATION NOTE]      45
                                                                    9300D–AUTO–03/15


   Figure 8-2. Schematics of the Atmel ATAB664251A Board
46 ATAN0063 [APPLICATION NOTE]
   9300D–AUTO–03/15


9. Board Layout
   Figure 9-1. PC Interface Board Component Placement; Top Side, Top View
   Figure 9-2. PC Interface Board Component Placement; Bottom Side, Top View (as if PCB was Transparent)
                                                                    ATAN0063 [APPLICATION NOTE]          47
                                                                                        9300D–AUTO–03/15


   Figure 9-3. PC Interface Board; Top Side, Top View
   Figure 9-4. PC Interface Board; Middle Layer 1, Top View (as if PCB was Transparent)
48 ATAN0063 [APPLICATION NOTE]
   9300D–AUTO–03/15


Figure 9-5. PC Interface Board; Middle Layer 2, Top View (as if PCB was Transparent)
Figure 9-6. PC Interface Board; Bottom Side, Top View (as if PCB was Transparent)
                                                                     ATAN0063 [APPLICATION NOTE]      49
                                                                                     9300D–AUTO–03/15


   Figure 9-7. Atmel ATAB664251A Board Component Placement; Top Side, Top View
   Figure 9-8. Atmel ATAB664251A Board; Top Side, Top View
   Figure 9-9. Atmel ATAB664251A Board; Bottom Side, Top View (as if PCB is Transparent)
50 ATAN0063 [APPLICATION NOTE]
   9300D–AUTO–03/15


10.     Atmel ATA664251 Kit BOM
Table 10-1. PC Interface Board BOM
                                                                                                   Manufacturer and Part
  #    Designator     Quantity   Value Class Voltage Tolerance     Description       Footprint            Number
      C1, C2, C4, C6,
  1                      4      100nF                               CAP 0402          0402_C
      C11, C12, C16
  2         C3           1        1µF                               CAP 0603          0603_C
  3      C5, C17         1       10µF                               CAP 0603          0603_C
  5         C7           1      150pF                               CAP 0402          0402_C
  6         C8           1       15nF                               CAP 0402          0402_C
  7      C9, C10         2       22pF                               CAP 0402          0402_C
  8      C13, C15        2        1µF                               CAP 0402          0402_C
  9         C14          1       10nF                               CAP 0402          0402_C
                                                                                                    RS No: 508-282; Mfg
 11         D3           1                                            BAS516        SOD523_D
                                                                                                       P/N: BAS516
                                                                 Header, 3-Pin,   HDR2X3_CEN              Samtec -
 12        ISP1          1
                                                                     Dual Row         2.54mm          TSW-105-24-S-D
                                                                                    Jumper 1x3     Samtec - MTMS-103.51-
 13       J1, J2         2                                        Header, 3-Pin
                                                                                      1.27mm              S-S-130
                                                                                     HDR2X5_
 14       JTAG1          1                                     HDR 5X2 100MIL                             Samtec
                                                                                  JTAG 2.54mm
                                                                                                      Mouser No: 875-
 15          L1          1                                        IND 0603 EMI        0603_L
                                                                                                      MI0603J601R-10
 16          L2          1       10µH                                 Inductor        0603_L          Würth: 744 796 8
                                                                  Typical BLUE
 17         LD1          1                                                        0603_LED_BL         RS No: 700-8026
                                                                    GaAs LED
                                                                Typical YELLOW
 18         LD2          1                                                        0603_LED_GE
                                                                    GaAs LED
                                                               Typical RED GaAs
 19         LD3          1                                                         0603_LED_rt       RS No: 466-3728P
                                                                        LED
                                                                 Typical GREEN
 20         LD4          1                                                        0603_LED_gn        RS No: 466-3706P
                                                                    GaAs LED
                                                                Crystal Unit SMD
 21         Q1           1      16MHz                                                 CX2520        Kyocera - CX2520SB
                                                                    2.5×2.0mm
                                                                RES 0402 1k 5%
 22       R3, R4         2        22R                                                 0402_R
                                                                        0.1W
                                                                RES 0402 1k 5%
 23         R6           1         1k                                                 0402_R
                                                                        0.1W
                                                                RES 0402 1k 5%
 24     R7, R8, R9       3       825R                                                 0402_R
                                                                        0.1W
                                                                RES 0402 1k 5%
 25         R10          1       180R                                                 0402_R
                                                                        0.1W
                                                               RES 0402 0 5%
 26      R15, R16        2        47k                                                 0402_R
                                                                        0.1W
 27   R20, R21, R22      3         nc                                                 0603_R
                                                                   Tact Switch -
 28       S1, S2         2                                                          B3U-1000P         RS No: 682-1421
                                                                   Vertical SMD
                                                               Buzzer, e.g., BST-                     Mouser No: 665-
 29         Sp1          1                                                         Buzzer_BST
                                                                      5523SA                            SMT0540SR
                                                               High-Voltage NPN                    RS No: 545-0438P; Mfg
 30          T1          1                                                           SOT23-3
                                                                     Transistor                     P/N: MMBTA42LT1G
                                                                         ATAN0063 [APPLICATION NOTE]                   51
                                                                                               9300D–AUTO–03/15


Table 10-1. PC Interface Board BOM (Continued)
                                                                                                    Manufacturer and Part
  #    Designator      Quantity   Value  Class  Voltage   Tolerance     Description      Footprint          Number
                                                                       Header, 4-Pin,
 31       TFT1             1                                                           HDR2X4_CEN            Samtec
                                                                          Dual Row
                                                                            8-bit
                                                                       Microcontroller
 32         U1             1                                         with 64/128Kbytes  QFN64_5x5    Atmel - AT90USB1287
                                                                      of ISP Flash and
                                                                       USB Controller
                                                                                                    DigiKey No: 576-2768-1-
 33         U2             1                                         VREG, 3.3V, 500A    MLF 6-Pin
                                                                                                         ND; MIC5219
                                                                          Mini USB                          Samtec -
 34         X1             1                                                            USB-micro
                                                                          Connector                 UUSB_B_S_S_SM_TR
                                                                       Header, 9-Pin,  BCS-109-X-D-         Samtec -
 35         X2             1
                                                                          Dual Row          HE         BCS-109-X-D-HE
Table 10-2. Atmel ATAB664251A Board BOM
                                                                                                    Manufacturer and Part
  #     Designator       Quantity  Value  Class  Voltage   Tolerance      Description    Footprint         Number
                                                                                          QFN32
  1          U1             1         -                                   ATA664251                    Atmel ATA664251
                                                                                          5x5mm
                                                                        Surface-Mount
                                                                           Ceramic
  2          C3             4       47nF                                                 RC-0402
                                                                           Multilayer
                                                                           Capacitor
                                                                        Surface-Mount
       C7, C10, C11,                                                       Ceramic
  3                         4      100nF                                                 RC-0402
           C300                                                            Multilayer
                                                                           Capacitor
                                                                        Surface-Mount
                                                                           Ceramic
  4          C5             1      100nF           50V                                   RC-0603
                                                                           Multilayer
                                                                           Capacitor
                                                                        Surface-Mount
                                                                           Ceramic                      Mouser No: 81-
  5          C6             1      10µF    X7R     50V        10%                         R3225
                                                                           Multilayer               GRM32ER71H106KA2L
                                                                           Capacitor
                                                                        Surface-Mount
                                                                           Ceramic
  6          C8             1      2.2µF  COG                  5%                        RC-0603
                                                                           Multilayer
                                                                           Capacitor
                                                                        Surface-Mount
                                                   50V                     Ceramic
  7       C2, C4            2       10nF  COG                  5%                        RC-0402
                                                (C2 only)                  Multilayer
                                                                           Capacitor
                                                                        Surface-Mount
                                                                           Ceramic
  8          C1             1      220pF  COG      50V         5%                        RC-0402
                                                                           Multilayer
                                                                           Capacitor
  9       D1, D7            2                                               Diode        RC-1608            BAV302
 10         J12             1                                         Jumper 1x3 2mm        J12
 11         J16             1         -                               Jumper 1x3 2mm                        Samtec
                                                                                                           Samtec -
 12     J9, J10, J11        3         -                               Jumper 1x3 2mm
                                                                                                    MTMM-103-04-T-S-140
52      ATAN0063 [APPLICATION NOTE]
        9300D–AUTO–03/15


Table 10-2. Atmel ATAB664251A Board BOM (Continued)
                                                                                              Manufacturer and Part
  #      Designator      Quantity Value Class Voltage Tolerance   Description   Footprint           Number
 13       J1, J2, J3        3                                   Jumper 2x5 2mm                      Samtec
                                                                                                    Samtec -
 14   J4, J5, J6, J7, J8    5                                   Jumper 2x3 2mm
                                                                                              MTMM-103-04-T-D-140
                                                                   Header 2x9                       Samtec -
 15           X1
                                                                     2,54mm                    TSW-109-08-L-D-RA
                                                                   Header 2x4
 16           X2
                                                                     2.54mm
 17         LD34            1                                       LED Blue     RC-0603        RS No: 700-8026
       LD1, LD2, LD3,
 18    LD7, LD8, LD9,       9                                       LED Red      RC-0603        RS No: 466-3728P
     LD13, LD14, LD15,
          LD4, LD5,
      LD6,LD10, LD11,
     LD12, LD16, LD17,
     LD18, LD19, LD20,
 19 LD21, LD22, LD23,      25                                      LED Green     RC-0603        RS No: 466-3706P
     LD24, LD25, LD26,
     LD27, LD28, LD29,
     LD30, LD31, LD32,
         LD33, LD35
 20         LD36            1                                       RGB-LED      P-LCC-6        RS No: 708-0747P
 21         GND             1                                     Messbuegel
      VB, GND, CL15,                                              MessPin 1x2
 22                         2
             LIN                                                     2.54mm
                                                                  Chip Resistor
 23           R3            1      12k                                           RC-0402
                                                                 Surface Mount
                                                                  Chip Resistor
 24          R39            1     430R                                           RC-0402
                                                                 Surface Mount
                                                                  Chip Resistor
 25       R40, R41          1      10k                                           RC-0402
                                                                 Surface Mount
                                                                  Chip Resistor
 26          R42            1       1k                                            R2012
                                                                 Surface Mount
                                                                  Chip Resistor
 27       R36, R42          2      47k                                           RC-0402
                                                                 Surface Mount
                                                                  Chip Resistor
 28           R2            1      51k                                           RC-0402
                                                                 Surface Mount
                                                                  Chip Resistor
 29          R38            1       1k                                           RC-0402
                                                                 Surface Mount
                                                                  Chip Resistor
 30          R37            1      56R                                           RC-0402
                                                                 Surface Mount
     R4, R8, R12, R16,
                                                                  Chip Resistor
 31    R20, R27, R31,       8     820R                                           RC-0402
                                                                 Surface Mount
             R35
     R5, R9, R13, R17,
                                                                  Chip Resistor
 32    R21, R26, R30,       8     200R                                           RC-0402
                                                                 Surface Mount
             R34
        R6, R10, R14,
                                                                  Chip Resistor
 33    R18, R22, R25,       8     100R                                           RC-0402
                                                                 Surface Mount
          R29, R33
        R7, R11, R15,
                                                                  Chip Resistor
 34    R19, R23, R24,       8     390R                                           RC-0402
                                                                 Surface Mount
          R28, R32
                                                                       ATAN0063 [APPLICATION NOTE]               53
                                                                                          9300D–AUTO–03/15


Table 10-2. Atmel ATAB664251A Board BOM (Continued)
                                                                                          Manufacturer and Part
  #      Designator       Quantity Value Class Voltage Tolerance  Description   Footprint       Number
     S1, S3, S5, S7, S9,
                                                                  Tact Switch -               Mouser No:
 35    S11, S13, S15,        9                                                   TL1015
                                                                  Vertical SMD               612-TL1015AF
            S115
       S2, S4, S6, S8,
 36                          8                                    Rotary Switch SMR_SW      RS No:702-3381P
     S10, S12, S14,S16
 37       S20, S21           2                                   SMD DIP Switch
                                                                   Header 2x2
 38       X3a, X3b           2
                                                                    2.54mm
                                                                   Header 2x3
 39         ISP1             1
                                                                    2.54mm
54       ATAN0063 [APPLICATION NOTE]
         9300D–AUTO–03/15


11. Revision History
    Please note that the following page numbers referred to in this section refer to the specific revision mentioned, not to this
    document.
     Revision No.                      History
     9300D-AUTO-03/15                  Put document in the latest template
                                                                                 ATAN0063 [APPLICATION NOTE]                      55
                                                                                                          9300D–AUTO–03/15


                                                                                                                                             XXXXXX
Atmel Corporation              1600 Technology Drive, San Jose, CA 95110 USA                   T: (+1)(408) 441.0311          F: (+1)(408) 436.4200           |      www.atmel.com
© 2015 Atmel Corporation. / Rev.: 9300D–AUTO–03/15
Atmel®, Atmel logo and combinations thereof, Enabling Unlimited Possibilities®, AVR®, and others are registered trademarks or trademarks of Atmel Corporation in U.S.
and other countries. Other terms and product names may be trademarks of others.
DISCLAIMER: The information in this document is provided in connection with Atmel products. No license, express or implied, by estoppel or otherwise, to any intellectual property right
is granted by this document or in connection with the sale of Atmel products. EXCEPT AS SET FORTH IN THE ATMEL TERMS AND CONDITIONS OF SALES LOCATED ON THE
ATMEL WEBSITE, ATMEL ASSUMES NO LIABILITY WHATSOEVER AND DISCLAIMS ANY EXPRESS, IMPLIED OR STATUTORY WARRANTY RELATING TO ITS PRODUCTS
INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTY OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE, OR NON-INFRINGEMENT. IN NO EVENT
SHALL ATMEL BE LIABLE FOR ANY DIRECT, INDIRECT, CONSEQUENTIAL, PUNITIVE, SPECIAL OR INCIDENTAL DAMAGES (INCLUDING, WITHOUT LIMITATION, DAMAGES
FOR LOSS AND PROFITS, BUSINESS INTERRUPTION, OR LOSS OF INFORMATION) ARISING OUT OF THE USE OR INABILITY TO USE THIS DOCUMENT, EVEN IF ATMEL HAS
BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES. Atmel makes no representations or warranties with respect to the accuracy or completeness of the contents of this
document and reserves the right to make changes to specifications and products descriptions at any time without notice. Atmel does not make any commitment to update the information
contained herein. Unless specifically provided otherwise, Atmel products are not suitable for, and shall not be used in, automotive applications. Atmel products are not intended,
authorized, or warranted for use as components in applications intended to support or sustain life.
SAFETY-CRITICAL, MILITARY, AND AUTOMOTIVE APPLICATIONS DISCLAIMER: Atmel products are not designed for and will not be used in connection with any applications where
the failure of such products would reasonably be expected to result in significant personal injury or death (“Safety-Critical Applications”) without an Atmel officer's specific written
consent. Safety-Critical Applications include, without limitation, life support devices and systems, equipment or systems for the operation of nuclear facilities and weapons systems.
Atmel products are not designed nor intended for use in military or aerospace applications or environments unless specifically designated by Atmel as military-grade. Atmel products are
not designed nor intended for use in automotive applications unless specifically designated by Atmel as automotive-grade.


Mouser Electronics
Authorized Distributor
Click to View Pricing, Inventory, Delivery & Lifecycle Information:
Atmel:
 ATAK43001-V1
