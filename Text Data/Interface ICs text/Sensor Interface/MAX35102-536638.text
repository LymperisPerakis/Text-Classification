                                                                                                                                                                                                         EVALUATION KIT AVAILABLE
MAX35102                                                                                                                                                              Time-to-Digital Converter
                                                                                                                                                                                  Without RTC
General Description                                                                                                                Features and Benefits
The MAX35102 is a time-to-digital converter with built-in                                                                          ●● High-Accuracy Flow Measurement for Billing and
amplifier and comparator targeted as a low-cost, analog                                                                               Leak Detection
front-end solution for the ultrasonic heat meter and flow                                                                             • Time-to-Digital Accuracy Down to 20ps
meter markets. It is similar to the MAX35101, but with a                                                                              • Measurement Range Up to 8ms
reduced feature set and without a real-time clock (RTC).                                                                              • 2 Channels—Single-Stop Channel
The package size has been reduced to 4mm x 4mm x                                                                                   ●● High-Accuracy Temperature Measurement for
0.75mm with 0.4mm pin pitch.                                                                                                          Precise Heat and Flow Calculations
With a time measurement accuracy of 20ps and auto-                                                                                    • Up to Four 2-Wire Sensors
matic differential time-of-flight (ToF) measurement, this                                                                             • PT1000 and PT500 RTD Support
device makes for simplified computation of liquid flow.                                                                               • 40mK Accuracy
Power consumption is the lowest available with ultra-low                                                                           ●● Maximizes Battery Life with Low Device and Overall
5.5μA ToF measurement and < 125nA duty-cycled tem-                                                                                    System Power
perature measurement.                                                                                                                 • Ultra-Low 5.5μA ToF measurement and < 125nA
                                                                                                                                        Duty-Cycled Temperature Measurement
Applications                                                                                                                          • 2.3V to 3.6V Single-Supply Operation
●● Ultrasonic Heat Meters                                                                                                          ●● High-Integration Solution Minimizes Parts Count and
●● Ultrasonic Water Meters                                                                                                            Reduces BOM Cost
●● Ultrasonic Gas Meters                                                                                                              • Small, 4mm x 4mm, 32-Pin TQFN Package
Ordering Information appears at end of data sheet.
                                                                                                                                      • -40°C to +85°C Operation
System Block Diagram
                                                                                            CMP_OUT/UP_DN                                             GND
                                          STP_UP
                                                                                                                                                                       DATA AND
                                                          ANALOG SWITCHING                                  TIME-TO-DIGITAL                                                                         INTX
                                                                                                                                        PROGRAMMABLE ALU                STATUS
                                                          AND BIAS CONTROL                                    CONVERTER
                                          STP_DN                                                                                                                      REGISTERS
                                                                                                                                                                                                     RSTX
                                        3.6 V
                                                VCC
                                                                                                                                                                                                    SCK
                                                                                      INTERNAL
                                           BYPASS                                        LDO                                                                                                                  MICROCONTROLLER
                                                                                                                                        STATE MACHINE                                                DOUT
                                100 NF LOW ESR
                                                                                                                                         CONTROLLER                        4-WIRE
                                  LAUNCH_UP                                                                                                                              INTERFACE
                                                                     PULSE                                    CONFIGURATION                                                                         DIN
                                                                   LAUNCHER                                     REGISTERS
                                  LAUNCH_DN
                                                                                                                                                                                                   CEX
                        PIEZOELECTRIC
                        TRANSDUCERS
                                                                           HIGH SPEED AND 32 KHZ OSCILLATORS                                TEMPERATURE MEASUREMENT
                                                              X1       X2         32KX1           32KXO           32KOUT      T1            T2              T3   T4       TC
                                                                                                                                                                               1K (50 PPM)
                                                                                                                              PT 1000       PT 1000
                                                                                       32.768 KHZ                                                                              METAL FILM
                                                                   4 MHZ
                                                                              12 PF       12 PF       12 PF
                                                      12 PF                                                                                                                       100 NF COG (NP0) (30
                                                                                                                                                                                         PPM/C)
19-7442; Rev 0; 11/14


MAX35102                                                                                                                              Time-to-Digital Converter
                                                                                                                                                                  Without RTC
Absolute Maximum Ratings
(Voltages relative to ground.)                                                                        Operating Temperature Range............................ -40°C to +85°C
Voltage Range on VCC Pins.................................-0.5V to +4.0V                              Junction Temperature.......................................................+150°C
Voltage Range on All Other Pins                                                                       Storage Temperature Range............................. -55°C to +125°C
    (not to exceed 4.0V).............................. -0.5V to (VCC + 0.5V)                          Lead Temperature (soldering, 10s).................................. +300°C
Continuous Power Dissipation (TA = +70°C)                                                             Soldering Temperature (reflow)........................................+260°C
    TQFN (derate 29.40mW/ºC above +70°C)............2352.90mW                                         ESD Protection (All Pins, Human Body Model)...................±2kV
Stresses beyond those listed under “Absolute Maximum Ratings” may cause permanent damage to the device. These are stress ratings only, and functional operation of the device at these
or any other conditions beyond those indicated in the operational sections of the specifications is not implied. Exposure to absolute maximum rating conditions for extended periods may affect
device reliability.
Package Thermal Characteristics (Note 1)
TQFN
    Junction-to-Ambient Thermal Resistance (θJA)...........34°C/W                                     Junction-to-Case Thermal Resistance (θJC)......................3°C/W
Note 1: Package thermal resistances were obtained using the method described in JEDEC specification JESD51-7, using a four-layer
               board. For detailed information on package thermal considerations, refer to www.maximintegrated.com/thermal-tutorial.
Recommended Operating Conditions
(TA = -40°C to +85°C, unless otherwise noted.) (Notes 2, 3)
                    PARAMETER                             SYMBOL                                  CONDITIONS                                MIN          TYP           MAX         UNITS
  Supply Voltage                                              VCC                                                                            2.3          3.0            3.6           V
  Input Logic 1
                                                               VIH                                                                         VCC x 0.7             VCC + 0.3             V
  (RST, SCK, DIN, CE)
  Input Logic 0
                                                               VIL                                                                          -0.3                 VCC x 0.3             V
  (RST, SCK, DIN, CE)
  Input Logic 1 (32KX1)                                   VIH32KX1                                                                         VCC x 0.85            VCC + 0.3             V
  Input Logic 0 (32KX1)                                   VIL32KX1                                                                          -0.3               VCC x 0.15              V
Electrical Characteristics
(VCC = 2.3V to 3.6V, TA = -40°C to +85°C, unless otherwise noted. Typical values are at VCC = 3.0V and TA = +25°C.) (Notes 2, 3)
                    PARAMETER                              SYMBOL                                  CONDITIONS                               MIN          TYP           MAX         UNITS
  Input Leakage
                                                                 IL                                                                         -0.1                       +0.1           µA
  (RST, SCK, DIN, CE)
  Output Leakage
                                                                OL                                                                          -0.1                       +0.1           µA
  (INT, T1,T2,T3,T4)
  Output Voltage Low (32KOUT)                                VOL32K             2mA                                                                              0.2 x VCC            V
  Output Voltage High (32KOUT)                              VOH32K              -1mA                                                       0.8 x VCC                                  V
  Output Voltage High
                                                               VOH              -4mA                                                       0.8 x VCC                                  V
  (DOUT, CMP_OUT/UP_DN)
  Output Voltage High (TC)                                   VOHTC              VCC = 3.3V, IOUT = -4mA                                      2.9          3.1                         V
  Output Voltage High
                                                          VOHLAUCH              VCC = 3.3V, IOUT = -50mA                                     2.8          3.0                         V
  (Launch_UP, Launch_DN)
  Output Voltage Low (INT, DOUT,
                                                               VOL              4mA                                                                              0.2 x VCC            V
  CMP_OUT/UP_DN)
www.maximintegrated.com                                                                                                                                           Maxim Integrated │ 2


MAX35102                                                                                  Time-to-Digital Converter
                                                                                                             Without RTC
Electrical Characteristics (continued)
(VCC = 2.3V to 3.6V, TA = -40°C to +85°C, unless otherwise noted. Typical values are at VCC = 3.0V and TA = +25°C.) (Notes 2, 3)
            PARAMETER                   SYMBOL                     CONDITIONS                  MIN     TYP      MAX      UNITS
 Pulldown Resistance (TC)                    RTC                                               650     1000     1500        Ω
 Input Voltage Low (TC)                    VILTC                                                    0.36 x VCC              V
 Output Voltage Low
                                       VOLLAUCH      VCC = 3.3V, IOUT = 50mA                            0.2      0.4        V
 (Launch_UP, Launch_DN)
 Resistance (T1, T2, T3, T4)                RON                                                           1                 Ω
 Input Capacitance
                                              CIN    Not tested                                           7                pF
 (CE, SCK, DIN, RST)
 RST Low Time                               tRST                                                                 100        ns
 CURRENT
 Standby Current                            IDDQ     No oscillators running, TA = +25°C                 0.1        1       µA
 32kHz OSC Current                        I32KHZ     32kHz oscillator only (Note 4)                     0.5      0.9       µA
 4MHz OSC Current                          I4MHZ     4MHz oscillator only (Note 4)                       40       85       µA
 LDO Bias Current                        ICCLDO      ICCCPU = 0 (Note 4)                                 15       50       µA
 Time Measurement Unit Current           ICCTMU      (Note 4)                                           4.5        8       mA
 Calculator Current                      ICCCPU                                                        0.75      1.7       mA
                                                     TOF_DIFF = 2 per second (3 hits),
 Device Current Drain                       ICC3                                                        5.5                µA
                                                     temperature = 1 per 30s
 ANALOG RECEIVER
                                                                                                                 2x
 Analog Input Voltage
                                           VANA                                                 10      700     VCC x    mVP-P
 (STOP_UP, STOP_DN)
                                                                                                                (3/8)
 Input Offset Step Size                   VSTEP                                                           1                mV
 STOP_UP/STOP_DN Bias Voltage              VBIAS                                                    VCC x (3/8)             V
 Receiver Sensitivity                      VANA      Stop hit detect level (Note 5)             10                       mVP-P
 TIME MEASUREMENT UNIT
 Measurement Range                        tMEAS      Time of flight                              8              8000       µs
 Time Measurement Accuracy                  tACC     Differential time measurement                       20                 ps
 Time Measurement Resolution                tRES                                                        3.8                 ps
 EXECUTION TIMES
 Power-On-Reset Time                     tRESET      Reset to POR INT                                   275                µs
 INIT Command Time                           tINIT   Command received when INIT bit set                 2.5                ms
 CAL Command Time                           tCAL     Command received when CAL bit set                 1.25                ms
www.maximintegrated.com                                                                                      Maxim Integrated │ 3


MAX35102                                                                                       Time-to-Digital Converter
                                                                                                                   Without RTC
Electrical Characteristics (continued)
(VCC = 2.3V to 3.6V, TA = -40°C to +85°C, unless otherwise noted. Typical values are at VCC = 3.0V and TA = +25°C.) (Notes 2, 3)
            PARAMETER                    SYMBOL                     CONDITIONS                      MIN       TYP     MAX       UNITS
 SERIAL PERIPHERAL INTERFACE
 DIN to SCK Setup                            tDC                                                                        20         ns
 SCK to DIN Hold                           tCDH                                                                 2       20         ns
 SCK to DOUT Delay                         tCDD                                                                 5       20         ns
                                                       VCC ≥ 3.0V                                    25         4
 SCK Low Time                                tCL                                                                                   ns
                                                       VCC = 2.3V                                    50        30
 SCK High Time                               tCH                                                     25         4                  ns
                                                       VCC ≥ 3.0V                                                       20
 SCK Frequency                              tCLK                                                                                 MHz
                                                       VCC = 2.3V                                                       10
 CE to SCK Setup                             tCC                                                                5       40         ns
 SCK to CE Hold                            tCCH                                                                         20         ns
 CE Inactive Time                          tCWH                                                                 2       40         ns
 CE to DOUT High Impedance                  tCCZ                                                                5       20         ns
Recommended External Crystal Characteristics
           PARAMETER                   SYMBOL                      CONDITIONS                       MIN       TYP     MAX       UNITS
 32kHz Nominal Frequency                  f32K                                                              32.768                kHz
 32kHz Frequency Tolerance             Δf32K/f32K    TA = +25°C                                     -20                +20       ppm
 32kHz Load Capacitance                  CL32K                                                                12.5                 pF
 32kHz Series Resistance                 RS32K                                                                          70        kΩ
 4MHz Crystal Nominal Frequency           F4M                                                                4.000               MHz
 4MHz Crystal Frequency Tolerance       Δf4M/f4M     TA = +25°C                                     -30                +30       ppm
 4MHz Crystal Load Capacitance            CL4M                                                                12.0                 pF
 4MHz Crystal Series Resistance          RS4M                                                                          120         Ω
 4MHz Ceramic Nominal Frequency                                                                              4.000               MHz
 4MHz Ceramic Frequency
                                                     TA = +25°C                                     -0.5               +0.5        %
 Tolerance
 4MHz Ceramic Load Capacitance                                                                                 30                  pF
 4MHz Ceramic Series Resistance                                                                                         30         Ω
Note 2: All voltages are referenced to ground. Current entering the device are specified as positive and currents exiting the device
         are negative.
Note 3: Limits are 100% production tested at TA = +25°C. Limits over the operating temperature range and relevant supply voltage
         range are guaranteed by design and characterization.
Note 4: Currents are specified as individual block currents. Total current for a point in time can be calculated by taking the standby
         current and adding any block currents that are active at that time.
Note 5: Receiver sensitivity includes performance degradation contributed by STOP_UP and STOP_DN device pin input offset volt-
         age and common mode drift.
www.maximintegrated.com                                                                                            Maxim Integrated │ 4


MAX35102                                                                                            Time-to-Digital Converter
                                                                                                                        Without RTC
Timing Diagrams
Figure 1
                     tCC
              CE                                                                                                       tCWH
                                              tCDH
              SCK
                             tDC
              DIN                    MSB                                       LSB
                                                                                           tCDD                             tCCZ
              DOUT
                                                   HIGH IMPEDANCE                            MSB                LSB
Figure 1. SPI Timing Diagram Read
Figure 2
                 tCC
                                                                                                                  tCWH
         CE                                                           tCLK              tR
                                                                                                 tF    tCCH
                                         tCDH                              tCH
                                                                                    VIH
                                                                  tCL
         SCK
                                                                                   VIL
                         tDC
         DIN                     MSB                                                                        LSB
         DOUT                                         HIGH IMPEDANCE
Figure 2. SPI Timing Diagram Write
www.maximintegrated.com                                                                                                  Maxim Integrated │ 5


MAX35102                                                                                                                            Time-to-Digital Converter
                                                                                                                                                Without RTC
Typical Operating Characteristics
(VCC = 3.3V and TA = +25°C, unless otherwise noted.)
                                                     ABSOLUTE ToF ERROR                                                   ABSOLUTE ToF ERROR
                                                     vs. SUPPLY VOLTAGE             toc01                                   vs. TEMPERATURE               toc02
                                       34                                                                      34
                                       32                                                                      32
                                       30                                                                      30
                     ERROR (ns)        28                                                         ERROR (ns)   28
                                       26                                                                      26
                                       24                                                                      24
                                       22                                                                      22
                                            2.20 2.45 2.70 2.95 3.20 3.45 3.70 3.95                                 -10   15          40          65         90
                                                               VCC (V)                                                         TEMPERATURE (ºC)
                                                    AVERAGE ICC vs. ToF RATE
                                                                                     toc03
                                       45
                                                                                                               Average ICC vs. TOF Rate Configuration Settings
                                       40
                                                                                                                                                     3 HIT SETTINGS
                                       35                                                                    CONTOL BIT(S)                    VALUE           BIT SETTINGS
                                                           3 HITS
                                       30                                                        Clock Settling Time                           488µs      CLK_S[2:0] = 000
                    AVERAGE ICC (µA)
                                                                                                 Bias Charge Time                              61µs       CT[1:0] = 00
                                       25                                                        Pulse Launch Frequency                        1MHz       DPL[3:0] = 0001
                                                                                                 Pulse Launcher Size                             15       PL[7:0] = 00001111
                                       20                                                        TOF Duty Cycle                               19.97ms     TOF_CYC[2:0] = 111
                                                                                                 Stop Hits                                       3        STOP[1:0] = 010
                                       15                                                        T2 Wave Selector                             Wave 2      T2WV[5:0] = 000110
                                                                                                 Temperature Port Number                         4        TP[1:0] = 11
                                       10
                                                                                                 Preamble Temperature Cycle Number               1        PRECYC[2:0] = 001
                                        5                                                        Port Cycle Time                               256µs      PORTCYC[1:0] = 01
                                        0
                                             0         5            10     15               20   Notes
                                                 ToF MEASUREMENT RATE (TOFDIFF/s)                1. This data is valid for the ceramic resonator.
                                                                                                 2. Crystal oscillator startup adds ~0.5µA per TOFDiff.
                                                                                                 3. Since the TOF cycle time is long the 4MHz oscillator powers up twice.
www.maximintegrated.com                                                                                                                                              Maxim Integrated │ 6


MAX35102                                                                                                                            Time-to-Digital Converter
                                                                                                                                                Without RTC
Pin Configuration
                              TOP VIEW
                                                 32KX1   32KX0    GND   TC       T4          T3    T2          T1
                                                 24       23      22     21        20        19     18          17
                                     GND    25                                                                                 16   GND
                                 STOP_DN    26                                                                                 15   DNC
                                 STOP_UP    27                                                                                 14   RST
                                     GND    28                                                                                 13   DOUT
                                                                        MAX35102
                                      VCC   29                                                                                 12 DIN
                                     GND    30                                                                                 11 SCK
                                       X2   31                                                                                 10 CE
                                                         +
                                       X1   32                                                                                 9    INT
                                                   1        2      3       4         5        6       7             8
                                                 GND
                                                         BYPASS
                                                                  VCC
                                                                        32KOUT
                                                                                 LAUNCH_DN
                                                                                             VCC
                                                                                                   LAUNCH_UP
                                                                                                               CMP_OUT/UP_DN
                                                                     TQFN
                                                                   4mm x 4mm
Pin Description
    PIN            NAME                                                                            FUNCTION
 1, 16, 22,
                   GND        Device Ground
 25, 28, 30
                              Connect this pin to ground with a capacitor (100nF) to provide stability for the on-board low-dropout
     2            BYPASS
                              regulator. The effective series resistance of this capacitor needs to be in the 1Ω to 2Ω range.
  3, 6, 29          VCC       Main Supply. Typically sourced from a single lithium cell.
     4            32KOUT      CMOS Output. Repeats the 32kHz crystal oscillator frequency.
     5          LAUNCH_DN     CMOS Pulse Output Transmission in Downstream Direction of Water Flow
     7         LAUNCH _UP     CMOS Pulse Output Transmission in Upstream Direction of Water Flow
                              CMOS Output. Indicates the direction (upstream or downstream) of which the pulse launcher is
     8        CMP_OUT/UP_DN
                              currently launching pulses OR the comparator output.
                              Active-Low Open-Drain Interrupt Output. The pin is driven low when the device requires service
     9              INT
                              from the host microprocessor.
    10              CE        Active-Low CMOS Digital Input. Serial peripheral interface chip enable input.
www.maximintegrated.com                                                                                                                         Maxim Integrated │ 7


MAX35102                                                                           Time-to-Digital Converter
                                                                                                     Without RTC
Pin Description (continued)
   PIN              NAME                                             FUNCTION
    11               SCK  CMOS Digital Input. Serial peripheral interface clock input.
    12               DIN  CMOS Digital Input. Serial peripheral interface data input.
    13              DOUT  CMOS Output. Serial peripheral interface data output.
    14               RST  Active-Low CMOS Digital Reset Input
    15               DNC  Do Not Connect. This pin must be left unconnected.
    17                T1  Open-Drain Probe 1 Temperature Measurement
    18                T2  Open-Drain Probe 2 Temperature Measurement
    19                T3  Open-Drain Probe 3 Temperature Measurement
    20                T4  Open-Drain Probe 4 Temperature Measurement
    21                TC  Input/Output Temperature Measurement Capacitor Connection
    23              32KX0 Connections for 32.768kHz Quartz Crystal. An external CMOS 32.768kHz oscillator can also
                          drive the MAX35102. In this configuration, the 32KX1 pin is connected to the external oscillator
    24              32KX1 signal and the 32KX0 pin is left unconnected.
                          Downstream STOP Analog Input. Used for the signal that is received from the downstream
    26            STOP_DN
                          transmission of a time-of-flight measurement.
                          Upstream STOP Analog Input. Used for the signal that is received from the upstream
    27            STOP_UP
                          transmission of a time-of-flight measurement.
    31                X2
                          Connections for 4MHz Quartz Crystal. A ceramic resonator can also be used.
    32                X1
    —                 EP  Exposed Pad. Connect to GND.
www.maximintegrated.com                                                                              Maxim Integrated │ 8


MAX35102                                                                                        Time-to-Digital Converter
                                                                                                                    Without RTC
Block Diagram
                                                         CMP_OUT/UP_DN          GND       GND   GND  GND    GND    GND
             STOP_UP
                            ANALOG                              TIME-TO-                                   DATA AND
                                                                                  PROGRAMMABLE
                         SWITCHING AND                           DIGITAL                                    STATUS
             STOP_DN                                                                   ALU
                         BIAS CONTROL                          CONVERTER                                  REGISTERS
                                                                                                                         INT
                 VCC
                                                                                                                         RST
                 VCC
                                                                MAX35102
                 VCC
              BYPASS                      INTERNAL                                                                       SCK
                                             LDO
                                                                                    STATE                                DOUT
                                                                                   MACHINE                  4-WIRE
            LAUNCH_UP                                                            CONTROLLER               INTERFACE      DIN
                             PULSE                        CONFIGURATION
            LAUNCH_DN     LAUNCHER                           REGISTERS
                                                                                                                         CE
                                   4MHz AND 32kHZ OSCILLATORS                     TEMPERATURE MEASUREMENT
                               X1      X2      32KX1     32KX0    32KOUT          T1      T2   T3   T4    TC
Detailed Description                                                     For temperature measurement, the MAX35102 supports
The MAX35102 is a time-to-digital converter with built-in                up to four 2-wire PT1000/500 platinum resistive tempera-
amplifier and comparator targeted as a complete analog                   ture detectors (RTD).
front-end solution for the ultrasonic heat meter and flow                A simple opcode based 4-Wire SPI interface allows any
meter markets.                                                           microcontroller to effectively configure the device for its
With automatic differential time-of-flight (TOF) measure-                intended measurement.
ment, this device makes for simplified computation of liq-               Time-of-Flight (ToF) Measurement Operations
uid flow. Early edge detection ensures measurements are
                                                                         TOF is measured by launching pulses from one piezo-
made with consistent wave patterns to greatly improve
                                                                         electric transducer and receiving the pulses at a sec-
accuracy and eliminate erroneous measurements. Built-in
                                                                         ond transducer. The time between when the pulses are
arithmetic logic unit provides TOF difference measure-
                                                                         launched and received is defined as the time of flight. The
ments. A programmable receiver hit accumulator can be
                                                                         MAX35102 contains the functionality required to create
utilized to minimize the host microprocessor access.
                                                                         a string of pulses, sense the receiving pulse string, and
Multihit capability with stop-enable windowing allows                    measure the time of flight. The MAX35102 can measure
the device to be fine-tuned for the application. Internal                two separate TOFs, which are defined as TOF up and
analog switches, an autozero amplifier/comparator, and                   TOF down.
programmable receiver sensisitivity provide the analog
interface and control for a minimal electrical bill of mate-
rial solutions.
www.maximintegrated.com                                                                                             Maxim Integrated │ 9


MAX35102                                                                                                                  Time-to-Digital Converter
                                                                                                                                      Without RTC
Figure 3
                                                                        ToF MEASUREMENT SEQUENCE
                                                                ToF                                               HIT1
                        TIME OF FLIGHT MEASUREMENTS                                                   T1         T2
                                                                                                                  HIT2
                                                               START                                              HIT3      AVG = ∑(HIT[1:3]) ÷ 3
              LAUNCH PIN
                                                                                 COMPARATOR OFFSET
                                                                                                                            COMPARATOR OFFSET FORCED TO 0
              STOP PIN                                                                  WAVE
                                                                                                       0 1 2 3 4 5 6 7
                                                                                      NUMBER
              INT PIN
                                 (1)                 (2)                      (4)
                               4 MHZ                                                                                            (9)
                                                BIAS APPLIED                ENABLE
                              STARTUP                                                                                      CALCULATIONS
                                                TO STOP PIN                RECEIVER
                                                                                                                 (8)
                                                                                                            (7)
                                                                                                                STOP
                                                                 (3)                                  (6)   T2                                    (10)
                ToF COMMAND                                                                   (5)               HITS
                  RECEIVED
                                                               LAUNCH                              COMPARE WAVE                                    INT
                                                               PULSES                      T1 WAVE
                                                                                                    RETURN                                     ASSERTED
                                                                                      SELECTED WAVES FOR HITS:
              STOP HITS SELECTED = 3, STOP POLARITY = POSITIVE EDGE                   T2 = 4 HIT1 = 5 HIT2 = 6 HIT3 = 7
Figure 3. Time-of-Flight Sequence
A TOF up measurement has pulses launched from the                                                 erates a start signal for the time-to-digital converter
LAUNCH_UP pin, which is connected to the downstream                                               (TDC) and is considered to be time zero for the TOF
transducer. The ultrasonic pulse is received at the                                               measurement. This is denoted by the start signal in
upstream transducer, which is connected to the STOP_                                              the start/stop TDC timing (Figure 3).
UP pin. A TOF down measurement has pulses launched                                       4)       After a programmable delay time set in TOF
from the LAUNCH_DN pin, which is connected to the                                                 Measurement Delay register, the comparator and hit
upstream transducer. The ultrasonic pulse is received at                                          detector at the appropriate STOP pin are enabled.
the downstream transducer, which is connected to the                                              This delay allows the receiver to start recording hits
STOP_DN pin.                                                                                      when the received wave is expected, eliminating
TOF measurements can be initiated by sending either the                                           possible false hits from noise in the system.
TOF_UP, TOF_DN, or TOF_DIFF commands.                                                    5)       Stop hits are detected according to the programmed
The steps involved in a single TOF measurement are                                                preferred edge of the acoustic signal sequence
described here and shown in Figure 3.                                                             received at the STOP pin according to the setting
1)   The 4MHz oscillator and LDO is enabled with a pro-                                           of the STOP_POL bit in the TOF1 register. The first
     grammable settling delay time set by the CLK_S[2:0]                                          stop hit is detected when a wave received at the
     bits in Calibration and Control register.                                                    STOP pin exceeds the comparator offset voltage,
                                                                                                  which is set in the TOF6 and TOF7 registers. This
2)   A common-mode bias is enabled on the STOP pin.                                               first detected wave is wave number 0. The width of
     This bias charge time is set by the CT[1:0] bits in the                                      the wave’s pulse that exceeds the comparator offset
     TOF1 register.                                                                               voltage is measured and stored as the t1 time.
3)   Once the bias charge time has expired, the pulse                                    6)       The offset of the comparator then automatically and
     launcher drives the appropriate LAUNCH pin with                                              immediately switches to 0.
     a programmable sequence of pulses. The number
     of pulses launched is set by the PL[7:0] bits in the                                7)       The t2 wave is detected and the width of the t2 pulse
     TOF1 register. The frequency of these 50% duty-                                              is measured and stored as the t2 time. The wave
     cycle pulses is set by the DPL[3:0] bits, also in the                                        number for the measurement of the t2 wave width is
     TOF1 register. The start of these launch pulses gen-                                         set by the T2WV[5:0] bits in the TOF2 register.
www.maximintegrated.com                                                                                                                             Maxim Integrated │ 10


MAX35102                                                                                           Time-to-Digital Converter
                                                                                                                              Without RTC
8)     Following the t2 wave, 1 to 3 consecutive stop                       7FFFh or (215-1) x t4MHz or ~ 8.19 ms. The maximum size
       hits are then detected. For each hit, the measured                   of the fraction is:
       TOF is stored in the appropriate HITxUPINT and
       HITxUPFrac or HITxDNINT and HITxDNFRAC reg-                                             216 − 1
                                                                                   FFFFh or            × t 4MHz . or ~ 249.9961 ns.
       isters. The number of hits to detect is set by the                                       216
       STOP[1:0] bits in the TOF2 register.
9)     After receiving all of the programmed hits, the
       MAX35102 calculates the average of the recorded
       hits and stores this to AVGUPINT and AVGUPFrac
       or AVGDNInt and AVGDNFrac. The ratio of t1/t2 and                    Table 1. Two’s Complement TOF_DIFF
       t2/tideal are calculated and stored in the WVRUP or
       WVRDN register.                                                      Conversion Example
10) Once all of the hit data, wave ratios, and averages                              REGISTER VALUE                      CONVERTER VALUE
       become available in the Results registers, the TOF
                                                                               TOF_DIFFInt       TOF_DIFFFrac                TOF DIFF VALUE
       bit in the Interrupt Status register is set and the INT
                                                                                   (hex)              (hex)                           (ns)
       pin is asserted (if enabled) and remains asserted
       until the Interrupt Status register is accessed by the                      7FFF               FFFF                     8,191,999.9962
       microprocessor with a Read Register command.                                001C                0403                      7,003.9177
The computation of the total time of flight is performed                           0001               00A1                         250.6142
by counting the number of full and fractional 4MHz clock
cycles that elapsed between the launch start and a hit                             0000                0089                          0.5226
stop as shown in Figure 4.                                                         0000                0001                          0.0038
Each TOF measurement result is comprised of an integer                             0000                0000                          0.0000
portion and a fractional portion. The integer portion is a
                                                                                  FFFF                FFFF                          -0.0038
binary representation of the number of t4MHz periods that
contribute to the time results. The fractional portion is a                       FFFF                FFC0                          -0.2441
binary representation of one t4MHz period quantized to                            FFFE                 1432                       -480.2780
a 16-bit resolution. The maximum size of the integer is
                                                                                  FF1C                 8001                     -56,874.9962
                                                                                   8000                0000                   -8,192,000.0000
   Figure 4
                                                    INTEGER TOF RESULTS PORTION                  FRACTIONAL TOF RESULTS PORTION
                                                              1 LSB = T4MHZ                             1 LSB = T4MHz/(2^16)
                                  1            2            3               4                       N
                    4 MHz CLOCK
              START SIGNAL                                                                                                      STOP SIGNAL
   (INTERNALLY GENERATED                                                                                                        (GENERATED UPON
     WHEN ACOUSTIC SIGNAL                                                                                                       ACOUSTIC SIGNAL
           IS TRANSMITTED)                                                                                                      RECEPTION)
                                                   TOTAL TIME OF FLIGHT = INTEGER + FRACTIONAL
Figure 4.Start/Stop for Time-to-Digital Timing
www.maximintegrated.com                                                                                                      Maxim Integrated │ 11


MAX35102                                                                                                            Time-to-Digital Converter
                                                                                                                                      Without RTC
Early Edge Detect                                                                           the early edge detect wave. The selection of the t2 wave
This early edge detect method of measuring the TOF                                          is made with the T2WV[5:0] bits in the TOF2 register.
of acoustic waves is used for all of the TOF commands                                       With reference to Figure 5, the ratio t1/t2 is calculated and
including TOF_UP, TOF_DN, and TOF_DIFF. This meth-                                          registered for the user. This ratio allows determination of
od allows the MAX35102 to automatically control the                                         abrupt changes in flow rate, received signal strength, par-
input offset voltage of the receiver comparator so that it                                  tially filled tube detection, and empty tube. It also provides
can provide advanced measurement accuracy. The input                                        noise suppression to prevent erroneous edge detection.
offset of the receiver comparator can be programmed                                         Also, the ratio t2/tideal is calculated and registered for
with a range +31 LSBs if triggering on a positive edge                                      the user. For this calculation, tideal is1/2 the period of
and -32 LSBs if triggering on a negative edge, with 1 LSB                                   launched pulse. This ratio adds confirmation that the t2
= VCC/3072. Separate input offset settings are available                                    wave is a strong signal, which provides insight into the
for the upstream received signal and the downstream                                         common mode offset of the received acoustic wave.
received signal. The input offset for the upstream received
signal is programmed using the C_OFFSETUP[4:0] bits                                         TOF Error Handling
in the TOF6 register. The input offset for the down-                                        Any of the TOF measurements can result in an error. If an
stream received signal is programmed using the C_                                           error occurs during the measurement, all of the associ-
OFFSETDN[4:0] bits in the TOF7 register. Once the first                                     ated registers report FFFFh. If a TOF_DIFF is being per-
hit is detected, the time t1 equal to the width of the earliest                             formed, the TOF_DIFFInt and TOF_DIF_Frac registers
detectable edge is measured. The input offset voltage is                                    report 7FFFh and FFFFh, respectively. If the measure-
then automatically and immediately returned to 0.                                           ment error is caused by the time measurement exceed-
                                                                                            ing the timeout set by the TIMOUT[2:0] bits in the TOF2
The MAX35102 is now ready to measure the successive
                                                                                            register, then the TO bit in the Interrupt Status register is
hits. The next selected wave that is measured is the t2
                                                                                            set and the INT pin asserts (if enabled).
wave. In the example in Figure 5, this is the 7th wave after
Figure 5
                                    OFFSET RESETS AUTOMATICALLY TO 0
                                  TO DETECT SUBSEQUENT ZERO CROSSINGS
                                                                                            WAVE NUMBER
                                    0      1      2       3      4      5      6    7       8       9     10 11  12   13  14
    PROGRAMMABLE OFFSET DETECT:
      -32mV TO +31mV IN 1mV STEPS
                                                                                 HIT NO.: 1       2     3
                                    t1                                              t2
                                                      EXAMPLE: MEASURE WIDTH OF
                                                      7TH WAVE AFTER EARLY EDGE
                                                                DETECT
Figure 5. Early Edge Detect Received Wave Example
www.maximintegrated.com                                                                                                              Maxim Integrated │ 12


MAX35102                                                                                                         Time-to-Digital Converter
                                                                                                                                    Without RTC
Temperature Measurement Operations                                                       to maximize power efficiency by evaluating the tempera-
A temperature measurement is a time measurement of the                                   ture of the RTDs with a coarse measurement prior to a
RC circuit connected to the temperature port device pins                                 real measurement. The coarse measurement provides
T1 through T4 and TC. The TC device pin has a driver to                                  an approximation to the TDC converter. During the real
charge the timing capacitor. The ports that are measured                                 measurement, the TDC can then optimize its measurement
and the order in which the measurement is performed is                                   parameters to use power efficiently. These evaluate cycles
selected with the TP[1:0] bits in the Temperature register.                              are automatically inserted according to the order of ports
                                                                                         selected with the of the Temperature Port bits. The time
Figure 6 depicts a 1000Ω platinum RTD with a 100nF                                       from the start of one port’s temperature measurement to
NPO COG 30ppm/°C capacitor. It shows two dummy                                           the next port’s temperature measurement is set using with
cycles with 4 temperature port evaluation measurements                                   the PORTCYC[1:0] bits in the Temperature register.
and 4 real temperature port measurements. This occurs
when setting the TP[1:0] bits in the Temperature register                                Once all the temperature measurements are completed,
to 11b.                                                                                  the times measured for each port are reported in the cor-
                                                                                         responding TxInt and TxFrac Results registers. The TE bit
The dummy 1 and dummy 2 cycles represent preamble                                        in the Interrupt Status register is also set and the INT pin
measurements that are intended to eliminate the dielec-                                  asserts (if enabled).
tric absorption of the temperature measurement capaci-
tor. These dummy cycles are executed using a RTD                                         Actual temperature is determined by a ratiometric calcula-
Emulation resistor of 1000Ω internal to the MAX35102.                                    tion. If T1 and T2 are connected to platinum RTDs and T3
This dummy path allows the dielectric absorption effects                                 and T4 are connected to the same reference resistor (as
of the capacitor to be eliminated without causing any of                                 shown in the System Diagram), then the ratio of T1/T3 =
the RTDs to be unduly self-heated. The number of dummy                                   RRTD1/RREF and T2/T4 = RRTD2/RREF. The ratios RRTD1/
measurements to be taken ranges from 0 to 7. This                                        RREF and RRTD2/RREF can be determined by the host
parameter is configured by setting the PRECYC[2:0] bits                                  microprocessor and the temperature can be derived from
in the Temperature register.                                                             a look-up table of Temperature vs. Resistance for each of
                                                                                         the RTDs utilizing interpolation of table entries if required.
Following the dummy cycles, an evaluation, TXevaluate,
is performed. This measurement allows the MAX35102
   Figure 6        DRIVER TO CHANGE
               TC-CONNECTED CAPACITOR
                                                                              VTC
               3.5
               3.0
               2.5
               2.0
                                                                                                                                     PORTCYCLE TIME
     VOLTS (V)                                                                                                                       (PORTCYC1-PORTCYC0)
                                                                                                                                     SET TO “00” 128µs
               1.5
                                                                                                                                         VTC
               1.0
                     DUMMY1      DUMMY2   T1EVALUATE T3EVALUATE T2EVALUATE T4EVALUATE       T1       T3       T2       T4
               0.5
                 0
                             128        256        384        512        640         768        896     1,024    1,152    1,280  1,408
                                                                             TIME (µs)
Figure 6. Temperature Command Execution Cycle Example
www.maximintegrated.com                                                                                                            Maxim Integrated │ 13


MAX35102                                                                            Time-to-Digital Converter
                                                                                                        Without RTC
Temperature Error Handling                                    returned in the Calibration Results register. For all TDC
The temperature measurement unit can detect open and/         measurements, a gain value of 122.0703125/122.6806641
or short-circuit temperature probes. If the resultant tem-    = 0.995024876 would then be applied.
perature reading in less than 8µs, then the MAX35102          Calibration is performed when the Calibration command is
writes a value of 0000h to the corresponding Results          sent to the MAX35102. At the completion of this calibra-
registers to indicate a short-circuit temperature probe. If   tion, the CAL bit in the Interrupt Status register and the
the measurement process does not discharge the TC pin         INT pin asserts (if enabled).
below the threshold of the internal temperature compara-
tor within 2µs of the time set by the PORTCYC[1:0] bits       Error Handling During Calibration
in the Temperature register, then an open circuit tem-        Any errors that occur during the Calibrate command stop
perature probe error is declared. The MAX35102 writes a       the CalibrationInt and the CalibrationFrac Results regis-
value of FFFFh to the corresponding results registers to      ters from being updated with new calibration coefficients.
indicate an open circuit temperature probe, the TO bit in     The results for the previous Calibration data remain in
the Interrupt Status register is set, and the INT pin asserts these two registers and are used for scaling measured
(if enabled). If the temperature measurement error is         results. If the calibration error is caused by the internal
caused by any other problems, then the MAX35102 writes        calibration time measurement exceeding the time set by
a value of FFFFh to each of the temperature port results      the TIMOUT[2:0] bits in the TOF2 register, then the TO
registers indicating that all of the temperature port mea-    bit in the Interrupt Status register is set and the INT pin
surements are invalid.                                        asserts (if enabled).
Calibration Operation                                         Device Interrupt Operations
For more accurate results, calibration of the TDC can         The MAX35102 is designed to optimize the power effi-
be performed. Calibration allows the MAX35102 to per-         ciency of a flow metering application by allowing the
form a calibration measurement that is based upon the         host microprocessor to remain in a low-power sleep
32.768kHz crystal, which is the most accurate clock in the    mode, instead of requiring the microprocessor to keep
system. This calibration is used when a ceramic oscillator    track of complex real-time events being performed by
is used in place of an AT-cut crystal for the 4MHz refer-     the MAX35102. Upon completion of any command, the
ence. The MAX35102 automatically generates START              MAX35102 alerts the host microprocessor using the INT
and STOP signals based upon edges of the 32.768kHz            pin. The assertion of the INT pin can be used to awaken
clock. The number of 32.768kHz clock periods that are         the host microprocessor from its low power mode. Upon
used and then averaged are selected with the CAL_             receiving an interrupt on the INT pin, the host micropro-
PERIOD[3:0] bits in the Calibration and Control register.     cessor should read the Interrupt Status Register to deter-
The TDC measures the number of 4MHz clock pulses that         mine which tasks were completed.
occur during the 32.768kHz pulses. The measured time of       Interrupt Status Register
a 32.768kHz clock pulse is reported in the CalibrationInt
and CalibrationFrac Results registers.                        The interrupt status register contains flags for all for all
                                                              commands and events that occur within the MAX35102.
Following is a description of an example calibration. Each    These flags are set when the event occurs or at the
TDC measurement is a 15-bit fixed-point integer value         completion of the executing command. When the Interrupt
concatenated with a 16-bit fractional value binary represen-  Status Register is read, all asserted bits are cleared. If
tation of the number of t4MHz periods that contribute to the  another interrupt source has generated an interrupt dur-
time result, the actual period of t4MHz needs to be known.    ing the read, these new flags assert following the read.
If the CAL_PERIOD[3:0] bits in the Calibration and Control
register are set to 6, then 6 measurements of 32.768kHz       INT Pin
periods are measured by the TDC and then averaged. The        The INT pin asserts when any of the bits in the Interrupt
expected measured value would be 30.5176µs/250ns =            Status register are set. The INT pin remains asserted until
122.0703125 t4MHz periods. Assume that the 4MHz ceram-        the Interrupt Status register is read by the user and all bits
ic resonator is actually running at 4.02MHz. The TDC mea-     in this register are clear. In order for the INT pin to oper-
surement unit would then measure 30.5176µs/248.7562ns         ate, it must first be enabled by setting the INT_EN bit in
= 122.6806641 t4MHz periods and this result would be          the Calibration and Control register.
www.maximintegrated.com                                                                                Maxim Integrated │ 14


MAX35102                                                                             Time-to-Digital Converter
                                                                                                           Without RTC
Serial Peripheral Interface Operation                        Table 2. Opcode Commands
Four pins are used for SPI-compatible communications:
                                                                                                            OPCODE FIELD
DOUT (serial-data out), DIN (serial-data in), CE (chip             GROUP              COMMAND
                                                                                                                   (HEX)
enable), and SCK (serial clock). DIN and DOUT are
the serial data input and output pins for the devices,                           TOF_Up                  00h
respectively. The CE input initiates and terminates a data                       TOF_Down                01h
transfer. SCK synchronizes data movement between the                             TOF_Diff                02h
                                                                  Execution
master (microcontroller) and the slave (MAX35102). The
                                                                   Opcode        Temperature             03h
SCK, which is generated by the microcontroller, is active        Commands
only when CE is low and during opcode and data transfer                          Reset                   04h
to any device on the SPI bus. The inactive clock polarity                        Initialize              05h
is logic-low. DIN is latched on the falling edge of SCK.                         Calibrate               0Eh
There is one clock for each bit transferred. Opcode bits
are transferred in groups of eight, MSB first. Data bits are                                             B0h thru FFh.
transferred in groups of sixteen, MSB first.                                                             Each hex value
The serial peripheral interface is used to access the fea-                       Read Register           represents the
tures and memory of the MAX35102 using an opcode/                                                        location of a single
command structure.                                                                                       16-bit register
                                                              Register Opcode
Opcode Commands                                                  Commands
Table 2 shows the opcode/commands that are supported                                                     30h thru 43h.
by the device.                                                                                           Each hex value
                                                                                 Write Register          represents the
Execution Opcode Commands                                                                                location of a single
The device supports several single byte opcode com-                                                      16-bit register
mands that cause the MAX35102 to execute various
routines. All commands have the same SPI protocol
sequence as shown in Figure 7. Once all 8 bits of the
                                                             Figure 7
opcode are received by the MAX35102 and the CE device
pin is deasserted, the MAX35102 begins execution of                             EXECUTION OPCODE COMMANDS
the specified command as described in that Command’s
description.                                                      CE
TOF_UP Command (00h)
The TOF_UP command generates a single TOF measure-                                 0    1    2    3    4 5   6     7
ment in the upstream direction. Pulses launch from the
LAUNCH_UP pin and are received by the STOP_UP pin.               SCK
The measured hit results are reported in the HITxUPInt
and HITxUPFrac registers, with the calculated average
                                                                                 O                               O
of all the measured hits being reported in the AVGUPInt           DIN
and AVGUPFrac register. The t1/t2 and t2/tideal wave                             MSB            8 BITS
                                                                                                               LSB
ratios are reported in the WVRUP register. Once all these
results are stored, then the TOF bit in the Interrupt Status                                   OPCODE
register is set and the INT pin asserts (if enabled).
                                                                DOUT                      HIGH IMPEDANCE
Note: The TOF_UP command yields a result that is only
of use when used in conjunction with the TOF_DN com-
mand. Absolute TOF measurements include circuit delays       Figure 7. Execution Opcode Command Protocol
and cannot be considered accurate.
www.maximintegrated.com                                                                                   Maxim Integrated │ 15


MAX35102                                                                            Time-to-Digital Converter
                                                                                                       Without RTC
TOF_Down Command (01h)                                       Initialize Command (05h)
The TOF_DOWN command generates a single TOF                  The initialize command must be executed before any con-
measurement in the downstream direction. Pulses launch       figuration of the device is done. This initializes the time-to-
from the LAUNCH_DN pin and are received by the               digital converter so that TOF and temperature commands
STOP_DN pin. The measured hit results are reported in        can be executed. The MAX35102 sets the INIT bit in the
the HITxDnInt and HITxDnFrac registers, with the calcu-      Interrupt Status register and asserts the INT device pin (if
lated average of all the measured hits being reported in     enabled) to tell the host microprocessor that the initialize
the AVGDNInt and AVGDNFrac register. The t1/t2 and t2/       command has completed and the next desired command
tideal wave ratios are reported in the WVRDN register.       can be sent to the MAX35102.
Once all these results are stored, then the TOF bit in the
Interrupt Status register is set and the INT pin asserts (if Calibrate Command (0Eh)
enabled).                                                    The calibrate command performs the calibration routine
                                                             as described in the calibration operation section. When
Note: The TOF_Down command yields a result that is
                                                             the calibrate command has completed the measurement,
only of use when used in conjunction with the TOF_UP
                                                             the Calibration Results register contains the measured
command. Absolute TOF measurements include circuit
                                                             32kHz period measurement value, the MAX35102 sets
delays and cannot be considered accurate.
                                                             the calibration bit in the Interrupt Status register and then
TOF_DIFF Command (02h)                                       asserts the INT device pin (if enabled). The host micro-
The TOF_DIFF command performs back-to-back TOF_              processor reads the Interrupt Status register to determine
UP and TOF_DN measurements as required for a meter-          the interrupt source and then read the Calibration Results
ing application. The TOF_UP sequence is followed by the      register to be able to calculate the 4MHz ceramic oscilla-
TOF_DN sequence. The time between the start of the           tor gain factor.
TOF_UP measurement and the start of the TOF_DN mea-
surement is set by the TOF_CYC[2:0] bits in the TOF2         Register Opcode Commands
register. Upon completion of the TOF_DN measurement,         To manipulate the register memory, there are two com-
the results of AVGUP minus AVGDN is computed and             mands supported by the device: Read Register and Write
stored at the TOF_DIFFInt and TOF_DIFFFrac Results           register. Each register accessed with these commands is
register locations. Once these results are stored, then the  16 bits in length. These commands are used to access all
TOF bit in the Interrupt Status register is set and the INT  sections of the memory map including the Configuration
pin asserts (if enabled).                                    registers, Conversion Results registers, and Status regis-
                                                             ters. The Conversion Results registers and the Interrupt
Temperature Command (03h)                                    Status register of the Status registers are all read only.
The temperature command initiates a temperature mea-
surement sequence as described in the Temperature            Read Register Command
Measurement Operations section. The characteristics the      The opcode must be clocked into the DIN device pin
temperature measurement sequence depends upon the            before the DOUT device pin produces the register data.
settings in the Temperature register. Once all the mea-      The SPI protocol sequence is shown in Figure 8.
surements are completed, the times measured for each         The read register command can also be used to read
port are reported in the corresponding TxInt and TxFrac      consecutive addresses. In this case, the data bits are
Results registers. The TE bit in the Interrupt Status regis- continuously delivered in sequence starting with the MSB
ter also is set and the INT pin asserts (if enabled).        of the data register that is addressed in the opcode, and
                                                             continues with each SCK rising edge until the CE device
Reset Command (04h)
                                                             pin is deasserted as shown in Figure 9. The address
The reset command essentially performs the same func-        counter automatically increments.
tion as a power-on reset (POR), and causes all of the
Configuration registers to be set to their power-on reset
values and all of the Results registers and the Interrupt
Status register to be cleared and set to zero.
www.maximintegrated.com                                                                               Maxim Integrated │ 16


MAX35102                                                                                                  Time-to-Digital Converter
                                                                                                                                Without RTC
 Figure 8
                                                         READ REGISTER COMMAND
            CE
                              0     1   2    3    4     5   6    7    8    9    10             19    20  21    22   23
           SCK
                             O                                 O
            DIN
                             MSB          8 BITS              LSB
                                                                                       DATA 16 BITS
                                          OPCODE
                                       HIGH IMPEDANCE                D    D     D   D         D     D    D    D    D        HIGH IMPEDANCE
                                                                    MSB                                           LSB
          DOUT
Figure 8. Read Register Opcode Command Protocol
Figure 9
                                                       CONTINUOUS READ REGISTER COMMAND
     CE
                   0   1   2    3    4  5  6    7    8    9 10          19    20 21 22 23 24 25 26 27               39 40 41 42    43
    SCK
                  O                            O
     DIN
                  MSB         8 BITS         LSB
                             OPCODE                               DATA 16 BITS                      DATA 16 BITS
                         HIGH IMPEDANCE             D    D  D   D       D    D    D  D   D   D    D    D   D       D   D  D      HIGH IMPEDANCE
   DOUT
                                                  MSB                                   LSB MSB                   LSB
Figure 9. Continuous Read Register Opcode Command Protocol
www.maximintegrated.com                                                                                                        Maxim Integrated │ 17


MAX35102                                                                                                  Time-to-Digital Converter
                                                                                                                                   Without RTC
Write Register Command                                                         after each 16 bits of data if the SCK device pin is continu-
This command applies to all writable registers. See the                        ally clocked and the CE device pin remain asserted as
Register Memory Map for more detail. The SPI protocol                          shown in Figure 11.
sequence is shown in Figure 10.                                                Register Memory Map
The write register command can also be used to write                           These registers are accessed by the read register com-
consecutive addresses. In this case, the data bits are con-                    mand and the Write Register command: X represents a
tinuously received on the DIN device pin and bound for                         reserved bit. All addresses omitted are reserved
the initial starting address register that is addressed in the
                                                                               The Results, Interrupt Status, and Control registers are all
opcode. The address counter automatically increments
                                                                               0000h following a reset.
Figure 10
                                                            WRITE REGISTER COMMAND
        CE
                           0     1      2   3     4     5     6      7     8      9    10                19    20     21   22    23
      SCK
                          O                                        O     D     D      D    D           D      D     D    D      D
       DIN
                          MSB                                    LSB MSB                                                      LSB
                                          8 BITS
                                          OPCODE                                            DATA 16 BITS
    DOUT                                                                  HIGH IMPEDANCE
Figure 10. Write Register Opcode Command Protocol
Figure 11
                                                             CONTINUOUS WRITE REGISTER COMMAND
     CE
                     0  1    2   3    4   5   6    7   8    9   10             19   20  21  22   23   24   25   26   27      39
    SCK
                    O                            O   D    D    D    D        D     D   D   D    D   D    D    D    D        D    D  D
     DIN
                    MSB                         LSB MSB                                        LSB MSB                    LSB
                               8 BITS
                               OPCODE                                DATA 16 BITS                         DATA 16 BITS
   DOUT                                                                HIGH IMPEDANCE
Figure 11. Continuous Write Register Opcode Command Protocol
www.maximintegrated.com                                                                                                          Maxim Integrated │ 18


                            Table 3. Register Memory Map
                             READ     WRITE
                                                NAME                                    BITS[15:8]                                                   BITS[7:0]
                            OPCODE   OPCODE
                            CONFIGURATION REGISTERS                                                                                                                                                      MAX35102
                              B6h      36h                                                                             Reserved
                              B7h      37h                                                                             Reserved
www.maximintegrated.com
                                                                                                                                                          STOP
                              B8h      38h      TOF1         PL7         PL6    PL5     PL4    PL3      PL2    PL1    PL0    DPL3    DPL2   DPL1   DPL0              X      CT1      CT0
                                                                                                                                                          _POL
                                                            STOP        STOP    STOP   T2WV    T2WV    T2WV    T2WV   T2WV           TOF_   TOF_   TOF_   EN_U      TIM      TIM      TIM
                              B9h      39h      TOF2                                                                         T2WV0
                                                              2           1      0       5       4       3      2      1             CYC2   CYC1   CYC0   P_DN     OUT2     OUT1     OUT0
                                                            C_OF        C_OF    C_OF   C_OF    C_OF    C_OF    C_OF   C_OF   C_OF    C_OF   C_OF   C_OF   C_OF     C_OF     C_OF     C_OF
                              BDh      3Dh      TOF6        FSET        FSET    FSET   FSET    FSET    FSET    FSET   FSET   FSET    FSET   FSET   FSET   FSET     FSET     FSET     FSET
                                                            RUP7        RUP6    RUP5   RUP4    RUP3    RUP2    RUP1   RUP0    UP7    UP6    UP5    UP4    UP3      UP2      UP1      UP0
                                                            C_OF        C_OF    C_OF   C_OF    C_OF    C_OF    C_OF   C_OF   C_OF    C_OF   C_OF   C_OF   C_OF     C_OF     C_OF     C_OF
                              BEh      3Eh      TOF7        FSET        FSET    FSET   FSET    FSET    FSET    FSET   FSET   FSET    FSET   FSET   FSET   FSET     FSET     FSET     FSET
                                                            RDN7        RDN6    RDN5   RDN4    RDN3    RDN2    RDN1   RDN0   DN7     DN6    DN5    DN4    DN3      DN2      DN1      DN0
                                                                                                                                                   PREC   PREC     PREC     PORT     PORT
                              C0h      40h    Temperature     X          X       X      X       X       X       X      X      X      TP1    TP0
                                                                                                                                                   YC2    YC1      YC0      CYC1     CYC0
                                                 TOF
                              C1h      41h     Measure-     DLY15       DLY14   LY13   DLY12   DLY11   DLY10   DLY9   DLY8   DLY7    DLY6   DLY5   DLY4   DLY3     DLY2     DLY1     DLY0
                                              ment Delay
                                              Calibration                                      CMP_    CMP_    INT_   ET_    CONT    CLK_   CLK_   CLK_   Cal_P    Cal_P    Cal_P    Cal_P
                              C2h      42h                    X          X       X      X
                                              and Control                                       EN     SEL     EN     CONT   _INT     S2     S1     S0    eriod3   eriod2   eriod1   eriod0
                                                                                                                                     32K_   32K_
                              C3h      43h     Oscillator     X          X       X      X       X       X       X      X      X                     X       X        X        X        X
                                                                                                                                      BP    EN
                            CONVERSION RESULTS REGISTERS
                                      Read
                              C4h                           WVRUP
                                       Only
                                      Read
                              C5h                           Hit1UpInt
                                       Only
                                      Read
                              C6h                           Hit1UpFrac
                                                                                                                                                                                              Time-to-Digital Converter
                                       Only
                                      Read
                              C7h                           Hit2UpInt
                                       Only
                                      Read
                              C8h                           Hit2UpFrac
                                       Only
                                      Read
                              C9h                           Hit3UpInt
    Maxim Integrated │ 19                                                                                                                                                                                 Without RTC
                                       Only


                            Table 3. Register Memory Map (continued)
                             READ    WRITE
                                              NAME                  BITS[15:8]   BITS[7:0]
                            OPCODE   OPCODE
                                      Read
                              CAh                    Hit3UpFrac
                                      Only
                                                                                                        MAX35102
                                      Read
                              D1h                    AVGUPInt
                                      Only
www.maximintegrated.com
                                      Read
                              D2h                    AVGUPFrac
                                      Only
                                      Read
                              D3h                    WVRDN
                                      Only
                                      Read
                              D4h                    Hit1DnInt
                                      Only
                                      Read
                              D5h                    Hit1DnFrac
                                      Only
                                      Read
                              D6h                    Hit2DnInt
                                      Only
                                      Read
                              D7h                    Hit2DnFrac
                                      Only
                                      Read
                              D8h                    Hit3DnInt
                                      Only
                                      Read
                              D9h                    Hit3DnFrac
                                      Only
                                      Read
                              E0h                    AVGDNInt
                                      Only
                                      Read
                              E1h                    AVGDNFrac
                                      Only
                                      Read
                              E2h                    TOF_DIFFInt
                                      Only
                                      Read
                              E3h                    TOF_DIFFFrac
                                      Only
                                      Read
                              E7h                    T1Int
                                      Only
                                      Read
                              E8h                    T1Frac
                                                                                             Time-to-Digital Converter
                                      Only
                                      Read
                              E9h                    T2Int
                                      Only
    Maxim Integrated │ 20                                                                                Without RTC


                            Table 3. Register Memory Map (continued)
                                      Read
                              EAh                          T2Frac
                                      Only
                             READ     WRITE
                                               NAME                              BITS[15:8]                               BITS[7:0]
                            OPCODE   OPCODE
                                                                                                                                                                MAX35102
                                      Read
                              EBh                          T3Int
                                      Only
www.maximintegrated.com
                                      Read
                              ECh                          T3Frac
                                      Only
                                      Read
                              EDh                          T4Int
                                      Only
                                      Read
                              EEh                          T4Frac
                                      Only
                                      Read
                              F8h                          CalibrationInt
                                      Only
                                      Read
                              F9h                          CalibrationFrac
                                      Only
                                      Read
                              FAh                          Reserved
                                      Only
                                      Read
                              FBh                          Reserved
                                      Only
                                      Read
                              FCh                          Reserved
                                      Only
                                      Read
                              FDh                          Reserved
                                      Only
                            STATUS REGISTERS
                                      Read     Interrupt
                              FEh                           TO         X     X   TOF    TE    LDO   X   X   X   CAL   X   X     INIT   POR   X   X
                                      Only      Status
                                                                                                                                                     Time-to-Digital Converter
    Maxim Integrated │ 21                                                                                                                                        Without RTC


MAX35102                                                                                   Time-to-Digital Converter
                                                                                                               Without RTC
Configuration Register Descriptions
Table 4. TOF1 Register
        WRITE OPCODE             READ OPCODE                                      POWER-ON RESET VALUE
             38h                       B8h                                                  0010h
 Bit             15      14                13               12                 11            10               9              8
 Name           PL7     PL6               PL5              PL4               PL3            PL2              PL1            PL0
 Bit              7       6                5                4                   3             2               1              0
 Name          DPL3     DPL2             DPL1             DPL0           STOP_POL             X              CT1            CT0
    BIT         NAME                                                   DESCRIPTION
                        Pulse Launcher Size: This is a hex value that defines the number of pulses that will be launched
                        from the pulse launcher during transmission. The range of this hex value is 00h to FFh. When
   15:8         PL[7:0]
                        PL[7:0] is set to 00h, the Pulse Launcher is disabled. Up to 127 pulses can be launched. When PL7
                        is set, the pulse count is clamped at 127.
                        Pulse Launch Divider: This is a hex value that defines the divider ratio of the internal clock signal
                        used to drive the Pulse Launch signal. The 4MHz external reference oscillator is used as the source
                        for the internal clock reference. The internal reference clock is first divided by 2 to produce a 2MHz
                        clock. The range of this hex value is 1h to Fh, resulting in a range of division from ÷2 to ÷16 of the
                        2MHz clock. A value of 0h is not supported and should not be programmed
                        Pulse Launch Frequency = 2MHz/(1+DPL[3:0])
                                               DPL[3:0]                                    PULSE LAUNCH FREQUENCY
    7:4        DPL[3:0]
                                                 0000b                                               RESERVED
                                                 0001b                                                   1MHz
                                                 0002b                                                  666kHz
                                                  ….                                                       ….
                                                 1110b                                                133.33kHz
                                                 1111b                                                  125kHz
                        Stop Polarity: This bit defines the edge sensitivity of the STOP_UP and STOP_DN channel. The
                        signal received on the STOP_UP and STOP_DN device pins will generate a stop condition for the
     3       STOP_POL   internal TDC time count on the rising slope of this signal if this bit is set to 0. The signal received on
                        the STOP_UP and STOP_DN device pins will generate a stop condition for the internal TDC time
                        count on the falling slope of this signal if this bit is set to 1.
     2             X    Reserved
www.maximintegrated.com                                                                                       Maxim Integrated │ 22


MAX35102                                                                                  Time-to-Digital Converter
                                                                                                              Without RTC
Table 4. TOF1 Register (continued)
   BIT          NAME                                                   DESCRIPTION
                             Bias Charge Time: This is the time allotted for charging the external bias network on the STOP
                             pins to produce common mode biasing for the analog receiver/comparator. It is based upon the
                             32.768 KHz crystal:
                                                                                             DESCRIPTION
                                     CT1                  CT2           32kHz CLOCK CYCLES
    1:0         CT[1:0]                                                                                   TYPICAL TIME (µs)
                                                                                (decimal)
                                       0                   0                         2                             61
                                       0                   1                         4                            122
                                       1                   0                         8                            244
                                       1                   1                        16                            488
Table 5. TOF2 Register
        WRITE OPCODE                READ OPCODE                                  POWER-ON RESET VALUE
             39h                          B9h                                               0000h
 Bit             15            14             13              12              11             10              9             8
 Name             X         STOP1          STOP0            T2WV5          T2WV4           T2WV3          T2WV2         T2WV1
 Bit              7             6              5               4              3               2              1             0
 Name         T2WV0        TOF_CYC2       TOF_CYC1        TOF_CYC0            X          TIMOUT2         TIMOUT1       TIMOUT0
   BIT             NAME                                                   DESCRIPTION
     15              X            Reserved
                                  Stop Hits: These bits set the number of stop hits to be expected and measured.
                                             STOP1                            STOP0                        DESCRIPTION
                                                 0                                0                             1 Hit
  14:13          STOP[1:0]
                                                 0                                1                             2 Hits
                                                 1                                0                             3 Hits
                                                 1                                1                             3 Hits
                                  Wave Selector for t2: These bits determine the wave number for which t2 is measured. To
                                  ensure measurement accuracy, the first wave measurable after the early edge detect is wave
                                  2. Waves are numbered as depicted in Figure 5.
   12:7          T2WV[5:0]                   T2WV[5:0] (decimal)                                  DESCRIPTION
                                                   0 through 2                                        Wave 2
                                                        3                                             Wave 3
                                                        4                                             Wave 4
www.maximintegrated.com                                                                                     Maxim Integrated │ 23


MAX35102                                                                              Time-to-Digital Converter
                                                                                                           Without RTC
Table 5. TOF2 Register (continued)
   BIT             NAME                                               DESCRIPTION
                           TOF Duty Cycle: These bits determine the time delay between successive executions of
                           TOF measurements. It is the start-to-start time of automatic execution of the TOF_UP and the
                           TOF_DN and is applicable only for the TOF_DIFF command. It is based upon the 32.768kHz
                           crystal. If the actual TOF of the acoustic path exceeds the programmed start-to-start time in
                           this setting, then the TOF duty cycle performs as if the bit setting is 000b.
                                                                                   DESCRIPTION
                              TOF_CYC[2:0]             32kHz CLOCK
                                                                                                 4MHz ON BETWEEN TOF_
                                                           CYCLES            TYPICAL TIME
                                                                                                     UP and TOF_DOWN
                                                          (decimal)
   6:4        TOF_CYC[2:0]
                                    000b                       0                    0µs                       Yes
                                    001b                       4                  122µs                       Yes
                                    010b                       8                  244µs                       Yes
                                    011b                      16                  488µs                       Yes
                                    100b                      24                  732µs                       Yes
                                    101b                      32                  976µs                       Yes
                                    110b                     546                 16.65ms                      No
                                     111b                    655                 19.97ms                      No
    3                X     Reserved
                           Timeout: These bits force a timeout in the time-to-digital measurement block. If the hit
                           required to measure t1, t2, or Hit1 through Hit3 of the received signal does not occur in this
                           time, the TO bit in the Interrupt Status register is set and the INT pin is asserted (if enabled).
                           Additionally, any of the Conversion Results registers read FFFFh if the data for that register is
                           invalid.
                                 TIMOUT2                   TIMOUT1                   TIMOUT0             DESCRIPTION (µs)
                                       0                        0                        0                        128
   2:0         TIMOUT[2:0]             0                        0                        1                        256
                                       0                        1                        0                        512
                                       0                        1                        1                       1024
                                       1                        0                        0                       2048
                                       1                        0                        1                       4096
                                       1                        1                        0                       8192
                                       1                        1                        1                      16384
www.maximintegrated.com                                                                                   Maxim Integrated │ 24


MAX35102                                                                             Time-to-Digital Converter
                                                                                                         Without RTC
Table 6. TOF6 Register
        WRITE OPCODE           READ OPCODE                                  POWER-ON RESET VALUE
             3Dh                     BDh                                               0000h
 Bit             15       14              13              12             11             10              9              8
 Name            X        X                X              X               X              X              X              X
 Bit             7         6               5              4              3               2              1              0
                                                      C_OFFSET      C_OFFSET        C_OFFSET        C_OFFSET      C_OFFSET
 Name            X        X                X
                                                         UP4            UP3            UP2            UP1             UP0
   BIT             NAME                                              DESCRIPTION
   15:5               X      Reserved
                             Comparator Offset Upstream: These bits define an initial selected receive comparator offset
                             voltage for the analog receiver comparator front-end. This comparator offset is used to detect
                             the early edge wave, t1. The actual common-mode voltage is dependent upon and scales with
                             the voltage present at the VCC pins.
                             When the STOP_POL bit in the TOF1 register is set to zero indicating a rising edge detection of
                             the zero crossing of the received acoustic wave, then the comparator offset is a positive value.
                             When the STOP_POL bit in the TOF1 register is set to one indicating a falling edge detection of
                             the zero crossing of the received acoustic wave, then the comparator offset is a negative value.
              C_OFFSETUP     The following formulas define the comparator offset voltage setting
    4:0                                                                                           (1152 + C OFFSETUP )
                    [4:0]        STOP_POL  = 0 Comparator Offset Voltage        = VCC ×
                                                                                                           3072
                                                                                                 (1151- C OFFSETUP )
                                 STOP_POL  =        1  Comparator Offset Voltage=        VCC ×
                                                                                                          3072
                                                     VCC
                                 where 1 LSB =
                                                    3072
                                           C_OFFSETUP[4:0]                                   OFFSET (LSBs)
                                             00h through 1Fh                                   0 through 31
www.maximintegrated.com                                                                                 Maxim Integrated │ 25


MAX35102                                                                              Time-to-Digital Converter
                                                                                                         Without RTC
Table 7. TOF7 Register
         WRITE OPCODE           READ OPCODE                                 POWER-ON RESET VALUE
              3Eh                     BEh                                               0000h
 Bit             15       14               13              12            11               10            9               8
 Name            X        X                X                X             X               X             X               X
 Bit             7         6                5              4             3                2             1               0
                                                      C_OFFSET       C_OFFSET        C_OFFSET       C_OFFSET       C_OFFSET
 Name            X        X                 X
                                                         DN4            DN3             DN2            DN1            DN0
     BIT           NAME                                               DESCRIPTION
    15:5              X      Reserved
                             Comparator Offset Downstream: These bits define an initial selected receive comparator
                             offset voltage for the analog receiver comparator front-end. This comparator offset is used to
                             detect the early edge wave, t1. The actual common-mode voltage is dependent upon and scales
                             with the voltage present at the VCC pins.
                             When the STOP_POL bit in the TOF1 register is set to zero indicating a rising edge detection of
                             the zero crossing of the received acoustic wave, then the comparator offset is a positive value.
                             When the STOP_POL bit in the TOF1 register is set to one indicating a falling edge detection of
                             the zero crossing of the received acoustic wave, then the comparator offset is a negative value.
                             The following formulas define the comparator offset voltage setting:
               C_OFFSETDN                                                                         (1152 + C OFFSETDN )
     4:0                         STOP_POL  = 0 Comparator Offset Voltage          = VCC ×
                    [4:0]                                                                                  3072
                                                                                                 (1151- C OFFSETDN )
                                 STOP_POL  =        1   Comparator Offset Voltage=        VCC ×
                                                                                                          3072
                                                     VCC
                                 where 1 LSB =
                                                     3072
                                            C_OFFSETDN[4:0]                                   OFFSET (LSBs)
                                             00h through 1Fh                                    0 through 31
www.maximintegrated.com                                                                                 Maxim Integrated │ 26


MAX35102                                                                                Time-to-Digital Converter
                                                                                                             Without RTC
Table 8. Temperature Register
        WRITE OPCODE           READ OPCODE                                   POWER-ON RESET VALUE
             40h                      C0h                                                0000h
 Bit                 15         14            13            12              11             10              9              8
 Name                X          X             X              X              X              X               X              X
 Bit                  7          6             5             4              3               2              1              0
 Name                X         TP1           TP0       PRECYC2         PRECYC1         PRECYC0       PORTCYC1        PORTCYC0
     BIT          NAME                                                DESCRIPTION
     15:7            X     Reserved
                           Temperature Port: These bits set the number of temperature ports to stimulate during a
                           temperature measurement sequence and the sequence in which the temperature ports are
                           stimulated.
                               TP1           TP0                                    DESCRIPTION
      6:5         TP[1:0]
                                 0             0      Measure ports T1 and T3
                                 0             1      Measure ports T2 and T4
                                 1             0      Measure ports T1, T3, and T2
                                 1             1      Measure ports T1, T3, T2, and T4
                           Preamble Temperature Cycle: These 3 bits are used to set the number of cycles to use as
                           preamble for reducing dielectric absorption of the temperature measurement capacitor. Each cycle
                           comprises one temperature measurement sequence as defined by the TP[1:0] bits.
                                    PRECYC2            PRECYC1                 PRECYC0                      DESCRIPTION
                                        0                    0                      0                       0 dummy cycle
                                        0                    0                      1                      1 dummy cycles
      4:2      PRECYC[2:0]
                                        0                    1                      0                      2 dummy cycles
                                        0                    1                      1                      3 dummy cycles
                                        1                    0                      0                      4 dummy cycles
                                        1                    0                      1                      5 dummy cycles
                                        1                    1                      0                      6 dummy cycles
                                        1                    1                      1                      7 dummy cycles
                           Port Cycle Time: These two bits define the time interval between successive individual
                           temperature port measurements. It is a start-to-start time. These bits also define the timeout
                           function of the temperature measurement ports. See the Temperature Operation section for
                           timeout details.
      1:0     PORTCYC[1:0]         PORTCYC1                    PORTCYC0                          DESCRIPTION (µs)
                                        0                           0                                    128
                                        0                           1                                    256
                                        1                           0                                    384
                                        1                           1                                    512
www.maximintegrated.com                                                                                     Maxim Integrated │ 27


MAX35102                                                                                  Time-to-Digital Converter
                                                                                                                Without RTC
Table 9. ToF Measurement Delay Register
         WRITE OPCODE              READ OPCODE                                  POWER-ON RESET VALUE
              41h                        C1h                                               0000h
 Bit             15         14                13              12              11             10               9              8
 Name          DLY15      DLY14            DLY13            DLY12           DLY11          DLY10           DLY9           DLY8
 Bit             7           6                 5              4               3              2                1              0
 Name          DLY7        DLY6             DLY5            DLY4            DLY3           DLY2            DLY1           DLY0
     BIT         NAME                                                   DESCRIPTION
                            This is hexadecimal value ranging from 0000h to FFFFh (decimal 0 to 65535). It is a multiple of the
                            4MHz crystal period (250ns). Settings less than 0012h are reserved and should not be used. The
                            analog comparator driven by the STOP_UP and STOP_DN device pins does not generate a stop
    15:0        DLY[15:0]
                            condition until this delay, counted from the internally generated start pulse for the acoustic wave,
                            has expired. This delay applies to early edge detect wave. Care must be taken to set the TIMOUT
                            bits in the TOF2 register so that a timeout interrupt does not occur before this delay expires.
Table 10. Calibration and Control Register
         WRITE OPCODE              READ OPCODE                                   POWER-ON RESET VALUE
              42h                        C2h                                                0000h
 Bit             15         14                13              12              11             10                9             8
 Name             X          X                 X               X           CMP_EN        CMP_SEL          INT_EN             X
 Bit             7           6                 5              4               3               2                1             0
                                                                            CAL_           CAL_             CAL_           CAL_
 Name            X        CLK_S2          CLK_S1           CLK_S0
                                                                         PERIOD3         PERIOD2         PERIOD1         PERIOD0
     BIT         NAME                                                   DESCRIPTION
  15:12             X       Reserved
                            Comparator/UP_DN Output Enable:
     11         CMP_EN      1 = CMP_OUT/UP_DN output device pin is enabled.
                            0 = CMP_OUT/UP_DN output device pin is driven low.
www.maximintegrated.com                                                                                        Maxim Integrated │ 28


MAX35102                                                                               Time-to-Digital Converter
                                                                                                            Without RTC
Table 10. Calibration and Control Register (continued)
  BIT            NAME                                                  DESCRIPTION
                           Comparator/UP_DN Output Select: This bit selects the output function of the CMP_OUT/UP_DN
                           pin and is only used when CMP_EN = 1.
                           1 = CMP_EN: The output monitors the receiver front end comparator output.
   10          CMP_SEL
                           0 = UP_DN: The output monitors the launch direction of the pulse launcher.
                             High Output: Upstream measurement (Launch_UP to STOP_UP)
                             Low Output: Downstream measurement (Launch_DN to STOP_DN)
                           Interrupt Enable: This bit, when set, enables the INT pin. All interrupt sources are wire-ORed to
    9           INT_EN
                           the INT pin.
    8               X      Reserved
    7               X      Reserved
                           Clock Settling Time: These bits define the time interval that the MAX35102 waits after enabling
                           the 4MHz clock for it to stabilize before making any measurements of time or temperature.
                                                                                                  DESCRIPTION
                               CLK_S2             CLK_S1             CLK_S0
                                                                                   32kHz CLOCK CYCLES           TYPICAL TIME
                                   0                  0                 0                      16                   488µs
                                   0                  0                 1                      48                   1.46ms
   6:4        CLK_S[2:0]
                                   0                  1                 0                      96                   2.93ms
                                   0                  1                 1                     128                    3.9ms
                                   1                  0                 0                     168                   5.13ms
                                   1                  0                 1         4MHz oscillator on continuously
                                   1                  1                 0         4MHz oscillator on continuously
                                   1                  1                 1         4MHz oscillator on continuously
                           4MHz Ceramic Oscillator Calibration Period: These bits define the number of 32.768kHz
                           oscillator periods to measure for determination of the 4MHz ceramic oscillator period.
                           32kHz clock cycles = 1+ CAL_PERIOD[3:0]
                                                                                       DESCRIPTION
                            CAL_PERIOD[3:0] (decimal)              32kHz CLOCK CYCLES                32kHz CLOCK CYCLES
                                                                          (decimal)                            (µs)
   3:0     CAL_PERIOD[3:0]
                                            0                                 1                                30.5
                                            1                                 2                                 61
                                           ….                                ….                                 ….
                                           14                                15                               457.7
                                           15                                16                               488.0
www.maximintegrated.com                                                                                    Maxim Integrated │ 29


MAX35102                                                                                          Time-to-Digital Converter
                                                                                                                      Without RTC
Table 11. Oscillator Register
         WRITE OPCODE                    READ OPCODE                                    POWER-ON RESET VALUE
               43h                               C3h                                               0000h
 Bit              15               14                13                 12            11             10             9             8
 Name              X                X                 X                 X             X              X              X             X
 Bit              7                 6                  5                4            3               2              1             0
 Name             X            32K_BP             32K_EN             EOSC            X               X              X             X
     BIT          NAME                                                           DESCRIPTION
    15:7              X            Reserved
                                   32kHz Bypass: This bit, when set, allows an external CMOS-level 32.768kHz signal to be applied
      6          32K_BP            to the 32KX1 device pin. The internal 32.768kHz oscillator is bypassed and the external signal is
                                   driven into the MAX35102 core.
                                   32kHz Clock Output Enable: This bit enables the 32KOUT device pin to drive a CMOS-level
      5          32K_EN
                                   square wave representation of the 32kHz crystal.
                                   Enable Oscillator: This active-low bit when set to logic 0 starts the 32kHz oscillator. When this bit
      4           EOSC
                                   is set to logic 1, the oscillator is stopped.
     3:0              X            Reserved
Status Register Descriptions
Table 12. Interrupt Status Register
         WRITE OPCODE                     READ OPCODE                                   POWER-ON RESET VALUE
            Read Only                            FEh                                               0000h
 Bit               15               14                13               12            11             10              9             8
 Name             TO                X                  X              TOF           TE               X              X             X
 Bit                7                6                 5                 4            3              2             1              0
 Name              X               CAL                 X                 X          INIT           POR             X              X
 Note: This register is read only and bits are self-clearing upon a read to this register. See the Device Interrupt Operations section
 for more information.
     BIT          NAME                                                           DESCRIPTION
                                    Timeout: The TO bit is set if any one of the t1, t2, Hit1 through Hit3, or temperature measure-
     15              TO
                                    ments do not occur within the associated timeout window.
   14:13              X             Reserved
www.maximintegrated.com                                                                                             Maxim Integrated │ 30


MAX35102                                                                                       Time-to-Digital Converter
                                                                                                                    Without RTC
Table 12. Interrupt Status Register (continued)
   BIT           NAME                                                         DESCRIPTION
   12             TOF         Time of Flight: Set when the TOF_UP, TOF_DN, or TOF_DIFF command has completed.
   11              TE         Temperature: Set when the temperature command has completed.
  10:7              X         Reserved
                              Calibrate: Set after completion of the Calibrate command when the command is manually sent by
    6             CAL
                              the host microprocessor.
    5               X         Reserved
    4               X         Reserved
    3             INIT        Initialize: Set when the Initialize command has completed.
                              Power-On-Reset: Set when the MAX35102 has been successfully powered by application of
    2             POR
                              VCC. Upon application of power, the SPI port becomes inactive until this bit has been set.
   1:0              X         Reserved
Conversion Results Register Descriptions
The devices conversion results registers are all read-only volatile SRAM. The POR value for all registers is 0000h.
Table 13. Conversion Results Registers Description
 READ ONLY
                     NAME                                                      DESCRIPTION
  ADDRESS
                                Bit 15 through Bit 8 holds the 8-bit value of the pulse width ratio (t1 ÷ t2).for the upstream
                                measurement. Each bit is weighted as follows:
                                  BIT 15        BIT 14       BIT 13          BIT 12      BIT 11       BIT 10        BIT 9          BIT 8
                                     1            0.5         0.25           0.125       0.0625      0.03125      0.015625      0.0078125
                                Bit 7 thru bit 0 holds the 8-bit value of the pulse width ratio (t2 ÷ tideal) where tideal is equal
      C4h           WVRUP
                                to half the period of the Pulse Launch Frequency for the upstream measurement. Each bit is
                                weighted as follows:
                                   BIT 7         BIT 6       BIT 5           BIT 4        BIT 3        BIT 2        BIT 1          BIT 0
                                     1            0.5         0.25           0.125       0.0625      0.03125      0.015625      0.0078125
                                The maximum value of each of these ratios is 1.9921875.
                                15-bit fixed-point integer value of the first hit in the upstream direction. This integer portion is
      C5h          Hit1UPInt    a binary representation of the number of t4MHz periods that contribute to the time results. The
                                maximum size of the integer is 7FFFh or (215 - 1) x t4MHz.
                                16-bit fractional value of the first hit in the upstream direction. This fractional portion is a binary
      C6h         Hit1UPFrac    representation of one t4MHz period quantized to a 16-bit resolution. The maximum size of the
                                fraction is FFFFh or (216 - 1)/216 x t4MHz.
www.maximintegrated.com                                                                                            Maxim Integrated │ 31


MAX35102                                                                                   Time-to-Digital Converter
                                                                                                                  Without RTC
Table 13. Conversion Results Registers Description (continued)
 READ ONLY
                     NAME                                                   DESCRIPTION
  ADDRESS
                             15-bit fixed-point integer value of the second hit in the upstream direction. This integer portion
     C7h           Hit2UPInt is a binary representation of the number of t4MHz periods that contribute to the time results. The
                             maximum size of the integer is 7FFFh or (215 - 1) x t4MHz.
                             16-bit fractional value of the second hit in the upstream direction. This fractional portion is a
     C8h          Hit2UPFrac binary representation of one t4MHz period quantized to a 16-bit resolution. The maximum size of
                             the fraction is FFFFh or (216 - 1)/216 x t4MHz.
                             15-bit fixed-point integer value of the third hit in the upstream direction. This integer portion is
     C9h           Hit3UPInt a binary representation of the number of t4MHz periods that contribute to the time results. The
                             maximum size of the integer is 7FFFh or (215 - 1) x t4MHz.
                             16-bit fractional value of the third hit in the upstream direction. This fractional portion is a binary
     CAh          Hit3UPFrac representation of one t4MHz period quantized to a 16-bit resolution. The maximum size of the
                             fraction is FFFFh or (216 - 1)/216 x t4MHz.
                             15-bit fixed-point integer value of the average of the hits recorded in the upstream direction This
     D1h           AVGUPInt  integer portion is a binary representation of the number of t4MHz periods that contribute to the
                             time results. The maximum size of the integer is 7FFFh or (215 - 1) x t4MHz.
                             16-bit fractional value of the average of the hits recorded in the upstream direction. This
     D2h          AVGUPFrac  fractional portion is a binary representation of one t4MHz period quantized to a 16-bit resolution.
                             The maximum size of the fraction is FFFFh or (216 - 1)/216 x t4MHz.
                             Bit 15 through Bit 8 holds the 8 bit value of the pulse width ratio (t1/t2).for the downstream
                             measurement. Each bit is weighted as follows:
                               BIT 15        BIT 14       BIT 13          BIT 12      BIT 11        BIT 10        BIT 9         BIT 8
                                  1            0.5         0.25           0.125       0.0625       0.03125     0.015625     0.0078125
                             Bit 7 thru bit 0 holds the 8 bit value of the pulse width ratio (t2/tideal) where tideal is equal to half
     D3h            WVRDN
                             the period of the pulse launch frequency for the downstream measurement. Each bit is weighted
                             as follows:
                                BIT 7         BIT 6       BIT 5           BIT 4        BIT 3        BIT 2         BIT 1         BIT 0
                                  1            0.5         0.25           0.125       0.0625       0.03125     0.015625     0.0078125
                             The maximum value of each of these ratios is 1.9921875.
                             15-bit fixed-point integer value of the first hit in the downstream direction. This integer portion is
     D4h           Hit1DNInt a binary representation of the number of t4MHz periods that contribute to the time results. The
                             maximum size of the integer is 7FFFh or (215 - 1) x t4MHz.
                             16-bit fractional value of the first hit in the downstream direction. This fractional portion is a
     D5h          Hit1DNFrac binary representation of one t4MHz period quantized to a 16-bit resolution. The maximum size of
                             the fraction is FFFFh or (216 - 1)/216 x t4MHz.
                             15-bit fixed-point integer value of the second hit in the downstream direction. This integer portion
     D6h           Hit2DNInt is a binary representation of the number of t4MHz periods that contribute to the time results. The
                             maximum size of the integer is 7FFFh or (215 - 1) x t4MHz.
www.maximintegrated.com                                                                                          Maxim Integrated │ 32


MAX35102                                                                                  Time-to-Digital Converter
                                                                                                                Without RTC
Table 13. Conversion Results Registers Description (continued)
 READ ONLY
                     NAME                                                  DESCRIPTION
  ADDRESS
                             16-bit fractional value of the second hit in the downstream direction. This fractional portion is a
     D7h          Hit2DNFrac binary representation of one t4MHz period quantized to a 16-bit resolution. The maximum size of
                             the fraction is FFFFh or (216 - 1)/216 x t4MHz.
                             15-bit fixed-point integer value of the third hit in the downstream direction. This integer portion
     D8h           Hit3DNInt is a binary representation of the number of t4MHz periods that contribute to the time results. The
                             maximum size of the integer is 7FFFh or (215 - 1) x t4MHz.
                             16-bit fractional value of the third hit in the downstream direction. This fractional portion is a
     D9h          Hit3DNFrac binary representation of one t4MHz period quantized to a 16-bit resolution. The maximum size of
                             the fraction is FFFFh or (216 - 1)/216 x t4MHz.
                             15-bit fixed-point integer value of the average of the hit times recorded in the downstream
     E0h           AVGDNInt  direction. This integer portion is a binary representation of the number of t4MHz periods that
                             contribute to the time results. The maximum size of the integer is 7FFFh or (215 – 1) x t4MHz.
                             16-bit fractional value of the average of the hit times recorded in the downstream direction. This
     E1h          AVGDNFrac  fractional portion is a binary representation of one period quantized to a 16-bit resolution. The
                             maximum size of the fraction is FFFFh or (216 – 1)/216 x t4MHz.
                             16-bit fixed-point two’s-complement integer portion of the difference of the averages for the hits
                             recorded in both the upstream and downstream directions. It is computed as:
                                                                          AVGUP – AVGDN
     E2h         TOF_DIFFInt
                             This integer represents the number of t4MHz periods that contribute to computation. The
                             maximum size of the integer is 7FFFh or (215 – 1) x t4MHz. The minimum size of this integer is
                             8000h or -215 x t4MHz.
                             16-bit fractional portion of the two’s complement difference of the averages for the hits
                      TOF_   recorded in both the upstream and downstream directions. This fractional portion is a binary
     E3h
                   DIFFFrac  representation of one t4MHz period quantized to a 16-bit resolution. The maximum size of the
                             fraction is FFFFh or (216 - 1)/216 x t4MHz.
                             15-bit fixed-point integer value of the time taken to discharge the timing capacitor through
                             the RTD connected to the T1 device pin. This integer portion is a binary representation of the
     E7h              T1Int
                             number of t4MHz periods that contribute to the time results. The maximum size of the integer is
                             7FFFh or (215 - 1) x t4MHz.
                             16-bit fractional value of the time taken to charge the timing capacitor through the RTD
                             connected to the T1 device pin. This fractional portion is a binary representation of one t4MHz
     E8h             T1Frac
                             period quantized to a 16-bit resolution. The maximum size of the fraction is FFFFh or (216 -
                             1)/216 x t4MHz.
                             15-bit fixed-point integer value of the time taken to charge the timing capacitor through the RTD
                             connected to the T2 device pin. This integer portion is a binary representation of the number of
     E9h              T2Int
                             periods that contribute to the time results. The maximum size of the integer is 7FFFh or
                             (215 - 1) x t4MHz.
                             16-bit fractional value of the time taken to charge the timing capacitor through the RTD
                             connected to the T2 device pin. This fractional portion is a binary representation of one t4MHz
     EAh             T2Frac
                             period quantized to a 16-bit resolution. The maximum size of the fraction is FFFFh or (216 -
                             1)/216 x t4MHz.
www.maximintegrated.com                                                                                        Maxim Integrated │ 33


MAX35102                                                                                   Time-to-Digital Converter
                                                                                                               Without RTC
Table 19. Conversion Results Registers Description (continued)
 READ ONLY
                     NAME                                                  DESCRIPTION
  ADDRESS
                               15-bit fixed-point integer value of the time taken to charge the timing capacitor through the RTD
                               connected to the T3 device pin. This integer portion is a binary representation of the number of
     EBh              T3Int
                               t4MHz periods that contribute to the time results. The maximum size of the integer is 7FFFh or
                               (215 - 1) x t4MHz.
                               16-bit fractional value of the time taken to charge the timing capacitor through the RTD
                               connected to the T3 device pin. This fractional portion is a binary representation of one t4MHz
     ECh             T3Frac
                               period quantized to a 16-bit resolution. The maximum size of the fraction is FFFFh or (216 -
                               1)/216 x t4MHz.
                               15-bit fixed-point integer value of the time taken to charge the timing capacitor through the RTD
                               connected to the T4 device pin. This integer portion is a binary representation of the number of
     EDh              T4Int
                               t4MHz periods that contribute to the time results. The maximum size of the integer is 7FFFh or
                               (215 - 1) x t4MHz.
                               16-bit fractional value of the time taken to charge the timing capacitor through the RTD
                               connected to the T4 device pin. This fractional portion is a binary representation of one t4MHz
     EEh             T4Frac
                               period quantized to a 16-bit resolution. The maximum size of the fraction is FFFFh or (216 -
                               1)/216 x t4MHz.
                               15-bit fixed-point integer value of the time taken to measure the period of the 32.768kHz
                   Calibration crystal oscillator during execution of the calibrate command. This integer portion is a binary
     F8h
                       Int     representation of the number of t4MHz periods that contribute to the time results. The maximum
                               size of the integer is 7FFFh or (215 - 1) x t4MHz.
                               16-bit fractional value of the time taken to measure the period of the 32.768kHz crystal oscillator
                   Calibration during execution of the calibrate command. This fractional portion is a binary representation of
     F9h
                      Frac     one t4MHz period quantized to a 16-bit resolution. The maximum size of the fraction is FFFFh or
                               (216 - 1)/216 x t4MHz.
     FAh                       Reserved
     FBh                       Reserved
     FCh                       Reserved
     FDh                       Reserved
www.maximintegrated.com                                                                                       Maxim Integrated │ 34


MAX35102                                                                                                                 Time-to-Digital Converter
                                                                                                                                     Without RTC
Typical Application Circuit
                                                                                                               GND GND GND GND GND GND
                                                                            CMP_OUT/UP_DN
                       STOP_UP
                                                                                                                                                             3.6V
                                       ANALOG
                                                                                                                                DATA AND
                                     SWITCHING                                  TIME-TO-DIGITAL             PROGRAMMABLE
                                                                                                                                 STATUS
                                      AND BIAS                                    CONVERTER                     ALU
                                                                                                                               REGISTERS
                      STOP_DN         CONTROL
                                                                                                                                                INT
                     3.6V    VCC                                                                                                                RST
                           VCC
                                                                                     MAX35102
                           VCC                                                                                                                  SCK
                        BYPASS                       INTERNAL
                                                        LDO                                                                                     DOUT
                   100nF
                   LOW ESR                                                                  STATE MACHINE                        4-WIRE         DIN
                                                                                             CONTROLLER                        INTERFACE
                    LAUNCH_UP                                                                                                                   CE
                                            PULSE                 CONFIGURATION
                    LAUNCH_DN             LAUNCHER                  REGISTERS
            PIEZOELECTRIC
            TRANSDUCERS
                                            HIGH-SPEED AND 32kHz OSCILLATORS                                TEMPERATURE MEASUREMENT
                                           X1        X2         32KX1       32KX0   32KOUT             T1           T2   T3     T4     TC
                                                                                                  PT 1000      PT 1000
                                             4MHz               32.768kHz
                                                                                                                                       1k (50ppm)
                                   12pF                12pF      12pF        12pF                                                      METAL FILM
                                                                                                                                           100 nF COG
                                                                                                                                           (NP0) (30ppm/C)
                                                                               MICROCONTROLLER
www.maximintegrated.com                                                                                                                        Maxim Integrated │ 35


MAX35102                                                                        Time-to-Digital Converter
                                                                                                   Without RTC
Ordering Information                                 Package Information
      PART             TEMP RANGE        PIN-PACKAGE For the latest package outline information and land patterns
                                                     (footprints), go to www.maximintegrated.com/packages. Note
 MAX35102ETJ+          -40°C to +85°C    32 TQFN
                                                     that a “+”, “#”, or “-” in the package code indicates RoHS status
 MAX35102ETJ+T         -40°C to +85°C    32 TQFN     only. Package drawings may show a different suffix character, but
+Denotes a lead(Pb)-free/RoHS-compliant package.     the drawing pertains to the package regardless of RoHS status.
T = Tape and reel.
                                                        PACKAGE          PACKAGE          OUTLINE           LAND
                                                           TYPE             CODE             NO.       PATTERN NO.
Chip Information                                         32 TQFN          T3244+1C        21-0681          90-0428
PROCESS: CMOS
www.maximintegrated.com                                                                          Maxim Integrated │ 36


MAX35102                                                                                                            Time-to-Digital Converter
                                                                                                                                           Without RTC
Revision History
   REVISION             REVISION                                                                                                                   PAGES
                                                                              DESCRIPTION
    NUMBER                 DATE                                                                                                                 CHANGED
          0                11/14          Initial release                                                                                              —
For pricing, delivery, and ordering information, please contact Maxim Direct at 1-888-629-4642, or visit Maxim Integrated’s website at www.maximintegrated.com.
Maxim Integrated cannot assume responsibility for use of any circuitry other than circuitry entirely embodied in a Maxim Integrated product. No circuit patent licenses
are implied. Maxim Integrated reserves the right to change the circuitry and specifications without notice at any time. The parametric values (min and max limits)
shown in the Electrical Characteristics table are guaranteed. Other parametric values quoted in this data sheet are provided for guidance.
Maxim Integrated and the Maxim Integrated logo are trademarks of Maxim Integrated Products, Inc.                 © 2014 Maxim Integrated Products, Inc. │ 37


Mouser Electronics
Authorized Distributor
Click to View Pricing, Inventory, Delivery & Lifecycle Information:
Maxim Integrated:
 MAX35102ETJ+ MAX35102ETJ+T
