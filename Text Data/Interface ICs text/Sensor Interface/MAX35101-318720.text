                                                                                            EVALUATION KIT AVAILABLE
MAX35101                                     Time-to-Digital Converter with Analog Front-End
General Description                                          Benefits and Features
The MAX35101 is a time-to-digital converter with built-in    ●● High Accuracy Flow Measurement for Billing
amplifier and comparator targeted as a complete analog          and Leak Detection
front-end (AFE) solution for the ultrasonic heat meter and      • Time-to-Digital Accuracy Down to 20ps
flow meter markets.                                             • Measurement Range Up to 8ms
With a time measurement accuracy of 20ps and auto-              • Two Channels: Single-Stop Channel
matic differential time-of-flight (TOF) measurement, this    ●● High Accuracy Temperature Measurement for
device makes for simplified computation of liquid flow.         Precise Heat and Flow Calculations
Early edge detection ensures measurements are made              • Up to Four (4) 2-Wire Sensors
with consistent wave patterns to greatly improve accuracy       • PT1000 and PT500 RTD Support
and eliminate erroneous measurements.                        ●● Maximizes Battery Life with Low Device and
Multihit capability with stop-enable windowing allows           Overall System Power
the device to be fine-tuned for the application. Internal       • Low 10μA ToF measurement and < 125nA
analog switches, an autozero amplifier/comparator, real-           Duty-Cycled Temperature Measurement
time clock (RTC), and programmable receiver sensitivity         • Event Timing Mode Reduces Host μC
provide the analog interface and control for a minimal       ●● Overhead to Minimize System Power Consumption
electrical bill of material solution. The RTC provides an       • 2.3V to 3.6V Single-Supply Operation
event timing mode that is configurable and runs cyclic
                                                             ●● High-Integration Solution Minimizes Parts Count
algorithms to minimize microprocessor interactivity and
                                                                and Reduces BOM Cost
increase battery life.
                                                                • 8KB of Nonvolatile Flash Memory for Data Logging
Built-in arithmetic logic unit provides TOF difference mea-     • Built-in Real Time Clock
surements. A programmable receiver hit accumulator can          • Small, 5mm x 5mm, 32-Pin TQFP Package
be utilized to minimize the host microprocessor access          • -40°C to +85°C Operation
and thus minimize current consumption.
For temperature measurement, the MAX35101 supports
                                                             Applications
up to four (4) 2-wire PT1000/500 platinum resistive tem-     ●● Ultrasonic Heat Meters
perature detectors (RTD).                                    ●● Ultrasonic Water Meters
                                                             ●● Ultrasonic Gas Meters
A simple 4-wire SPI interface allows any microcon-
troller to effectively configure the device for its intended
measurement.
On-board 8KB user flash allows the MAX35101 to be
nonvolatile-configurable and provide nonvolatile energy
use data to be logged. Configuration can be recalled any-
time with a SPI command.
Ordering Information appears at end of data sheet.
19-6830; Rev 1; 1/15


MAX35101                                                                       Time-to-Digital Converter with Analog Front-End
Absolute Maximum Ratings
(Voltages relative to ground.)                                                                        Operating Temperature Range............................ -40°C to +85°C
Voltage Range on VCC Pins.................................-0.5V to +4.0V                              Junction Temperature.......................................................+150°C
Voltage Range on All Other Pins                                                                       Storage Temperature Range............................. -55°C to +125°C
    (not to exceed 4.0V).............................. -0.5V to (VCC + 0.5V)                          Lead Temperature (soldering, 10s).................................. +300°C
Continuous Power Dissipation (TA = +70°C)                                                             Soldering Temperature (reflow)........................................+260°C
    TQFP (derate 27.80mW/ºC above +70°C)............2222.20mW                                         ESD Protection (All Pins, Human Body Model)...................±2kV
Stresses beyond those listed under “Absolute Maximum Ratings” may cause permanent damage to the device. These are stress ratings only, and functional operation of the device at these
or any other conditions beyond those indicated in the operational sections of the specifications is not implied. Exposure to absolute maximum rating conditions for extended periods may affect
device reliability.
Package Thermal Characteristics (Note 1)
TQFP
    Junction-to-Ambient Thermal Resistance (θJA)...........36°C/W                                     Junction-to-Case Thermal Resistance (θJC)......................4°C/W
Note 1: Package thermal resistances were obtained using the method described in JEDEC specification JESD51-7, using a four-layer
               board. For detailed information on package thermal considerations, refer to www.maximintegrated.com/thermal-tutorial.
Recommended Operating Conditions
(TA = -40°C to +85°C, unless otherwise noted.) (Notes 2, 3)
                    PARAMETER                             SYMBOL                                  CONDITIONS                                MIN          TYP           MAX         UNITS
  Supply Voltage                                              VCC                                                                            2.3          3.0            3.6           V
  Input Logic 1
                                                               VIH                                                                         VCC x 0.7             VCC + 0.3             V
  (RST, CSW, SCK, DIN, CE)
  Input Logic 0
                                                               VIL                                                                          -0.3                 VCC x 0.3             V
  (RST, CSW, SCK, DIN, CE)
  Input Logic 1 (32KX1)                                   VIH32KX1                                                                         VCC x 0.85            VCC + 0.3             V
  Input Logic 0 (32KX1)                                   VIL32KX1                                                                          -0.3               VCC x 0.15              V
Electrical Characteristics
(VCC = 2.3V to 3.6V, TA = -40°C to +85°C, unless otherwise noted. Typical values are at VCC = 3.0V and TA = +25°C.) (Notes 2, 3)
                    PARAMETER                              SYMBOL                                  CONDITIONS                               MIN          TYP           MAX         UNITS
  Input Leakage
                                                                 IL                                                                         -0.1                       +0.1           µA
  (CSW, RST, SCK, DIN, CE)
  Output Leakage
                                                                                                                                            -0.1                       +0.1           µA
  (INT, WDO, T1,T2,T3,T4)
  Output Voltage Low (32KOUT)                                VOL32K             2mA                                                                              0.2 x VCC            V
  Output Voltage High (32KOUT)                              VOH32K              -1mA                                                       0.8 x VCC                                  V
  Output Voltage High
                                                               VOH              -4mA                                                       0.8 x VCC                                  V
  (DOUT, CMP_OUT/UP_DN)
  Output Voltage High (TC)                                   VOHTC              VCC = 3.3V, IOUT = -4mA                                      2.9          3.1                         V
www.maximintegrated.com                                                                                                                                           Maxim Integrated │ 2


MAX35101                                             Time-to-Digital Converter with Analog Front-End
Electrical Characteristics (continued)
(VCC = 2.3V to 3.6V, TA = -40°C to +85°C, unless otherwise noted. Typical values are at VCC = 3.0V and TA = +25°C.) (Notes 2, 3)
            PARAMETER                   SYMBOL                     CONDITIONS                  MIN     TYP      MAX      UNITS
 Output Voltage High
                                       VOHLAUCH      VCC = 3.3V, IOUT = -50mA                   2.8     3.0                 V
 (Launch_UP, Launch_DN)
 Output Voltage Low (WDO, INT,
                                             VOL     4mA                                                    0.2 x VCC       V
 DOUT, CMP_OUT/UP_DN)
 Pulldown Resistance (TC)                    RTC                                               650     1000     1500        Ω
 Input Voltage Low (TC)                    VILTC                                                    0.36 x VCC              V
 Output Voltage Low
                                       VOLLAUCH      VCC = 3.3V, IOUT = 50mA                            0.2      0.4        V
 (Launch_UP, Launch_DN)
 Resistance (T1, T2, T3, T4)                RON                                                           1                 Ω
 Input Capacitance
                                             CIN     Not tested                                           7                pF
 (CE, SCK, DIN, RST, CSW)
 RST Low Time                               tRST                                                                 100        ns
 CURRENT
 Standby Current                            IDDQ     No oscillators running, TA = +25°C                 0.1        1       µA
 32kHz OSC Current                        I32KHZ     32kHz oscillator only (Note 4)                     0.5      0.9       µA
 4MHz OSC Current                          I4MHZ     4MHz oscillator only (Note 4)                       40       85       µA
 LDO Bias Current                        ICCLDO      ICCCPU = 0 (Note 4)                                 15       35       µA
 Time Measurement Unit Current           ICCTMU      (Note 4)                                           4.5        8       mA
 Calculator Current                      ICCCPU                                                         2.5        5       mA
                                                     TOF_DIFF = 2 per second (3 hits),
                                            ICC3                                                         10
                                                     temperature = 1 per 30s
 Device Current Drain                                                                                                      µA
                                                     TOF_DIFF = 2 per second (6 hits),
                                            ICC6                                                         13
                                                     temperature = 1 per 30s
 FLASH Erase Current                      IFLASH                                                        0.5        1       mA
 ANALOG RECEIVER
                                                                                                                 2x
 Analog Input Voltage
                                            VANA                                                10      700     VCC x    mVP-P
 (STOP_UP, STOP_DN)
                                                                                                                (3/8)
 Input Offset Step Size                   VSTEP                                                           1                mV
 STOP_UP/STOP_DN Bias Voltage              VBIAS                                                    VCC x (3/8)             V
 Receiver Sensitivity                       VANA     Stop hit detect level (Note 5)             10                       mVP-P
 TIME MEASUREMENT UNIT
 Measurement Range                         tMEAS     Time of flight                              8              8000       µs
 Time Measurement Accuracy                  tACC     Differential time measurement                       20                 ps
 Time Measurement Resolution                tRES                                                        3.8                 ps
www.maximintegrated.com                                                                                      Maxim Integrated │ 3


MAX35101                                             Time-to-Digital Converter with Analog Front-End
Electrical Characteristics (continued)
(VCC = 2.3V to 3.6V, TA = -40°C to +85°C, unless otherwise noted. Typical values are at VCC = 3.0V and TA = +25°C.) (Notes 2, 3)
           PARAMETER                    SYMBOL                   CONDITIONS                    MIN     TYP      MAX      UNITS
 FLASH
 Data Retention                             DR       TA = +25°C                                100                        Years
 Flash Endurance                         NFLASH      TA = +25°C                                20k                       Cycles
 Block Flash Erase Time                  tERASE                                                                  50        ms
 LDO Stabilization Time                 tSTABLE                                                         135                µs
 Word Write Time                         tWRITE                                                          72     100        µs
 Transfer Configuration to Flash
                                        tCONFIG                                                          35                ms
 Command Time
 EXECUTION TIMES
 Power-On-Reset Time                     tRESET      Reset to POR INT                                   275                µs
 INIT Command Time                         tINIT     Command received when INIT bit set                 2.5                ms
 Case Switch Time                         tCSW       CSW pin logic-high until CSWI bit set               20                 ns
 CAL Command Time                          tCAL      Command received when CAL bit set                 1.25                ms
 SERIAL PERIPHERAL INTERFACE
 DIN to SCK Setup                           tDC                                                                  20         ns
 SCK to DIN Hold                          tCDH                                                            2      20         ns
 SCK to DOUT Delay                        tCDD                                                            5      20         ns
                                                     VCC ≥ 3.0V                                 25        4
 SCK Low Time                               tCL                                                                             ns
                                                     VCC = 2.3V                                 50       30
 SCK High Time                              tCH                                                 25        4                 ns
                                                     VCC ≥ 3.0V                                                  20
 SCK Frequency                             tCLK                                                                           MHz
                                                     VCC = 2.3V                                                  10
 CE to SCK Setup                            tCC                                                           5      40         ns
 SCK to CE Hold                           tCCH                                                                   20         ns
 CE Inactive Time                         tCWH                                                            2      40         ns
 CE to DOUT High Impedance                 tCCZ                                                           5      20         ns
www.maximintegrated.com                                                                                      Maxim Integrated │ 4


MAX35101                                               Time-to-Digital Converter with Analog Front-End
Recommended External Crystal Characteristics
            PARAMETER                   SYMBOL                      CONDITIONS                      MIN       TYP       MAX      UNITS
 32kHz Nominal Frequency                   f32K                                                             32.768                 kHz
 32kHz Frequency Tolerance              Δf32K/f32K   TA = +25°C                                     -20                  +20       ppm
 32kHz Load Capacitance                   CL32K                                                               12.5                  pF
 32kHz Series Resistance                  RS32K                                                                           70        kΩ
 4MHz Crystal Nominal Frequency            F4M                                                               4.000                MHz
 4MHz Crystal Frequency Tolerance        Δf4M/f4M    TA = +25°C                                     -30                  +30       ppm
 4MHz Crystal Load Capacitance            CL4M                                                                12.0                  pF
 4MHz Crystal Series Resistance           RS4M                                                                           120        Ω
 4MHz Ceramic Nominal Frequency                                                                              4.000                MHz
 4MHz Ceramic Frequency
                                                     TA = +25°C                                     -0.5                +0.5        %
 Tolerance
 4MHz Ceramic Load Capacitance                                                                                 30                   pF
 4MHz Ceramic Series Resistance                                                                                           30        Ω
Note 2: All voltages are referenced to ground. Current entering the device are specified as positive and currents exiting the device
          are negative.
Note 3: Limits are 100% production tested at TA = +25°C. Limits over the operating temperature range and relevant supply voltage
          range are guaranteed by design and characterization.
Note 4: Currents are specified as individual block currents. Total current for a point in time can be calculated by taking the standby
          current and adding any block currents that are active at that time.
Note 5: Receiver sensitivity includes performance degradation contributed by STOP_UP and STOP_DN device pin input offset volt-
          age and common mode drift.
Timing Diagrams
Figure 1             tCC
              CE                                                                                                   tCWH
                                              tCDH
              SCK
                            tDC
              DIN                   MSB                                    LSB
                                                                                       tCDD                             tCCZ
              DOUT
                                                   HIGH IMPEDANCE                        MSB                  LSB
Figure 1. SPI Timing Diagram Read
www.maximintegrated.com                                                                                              Maxim Integrated │ 5


MAX35101                                                                                     Time-to-Digital Converter with Analog Front-End
Timing Diagrams (continued)
   Figure 2
                           tCC
                                                                                                                                                                                      tCWH
        CE                                                                                                     tCLK                            tR
                                                                                                                                                           tF       tCCH
                                                                       tCDH                                           tCH
                                                                                                                            VIH
                                                                                                         tCL
        SCK
                                                                                                                            VIL
                                          tDC
        DIN                                             MSB                                                                                                                    LSB
        DOUT                                                                                 HIGH IMPEDANCE
Figure 2. SPI Timing Diagram Write
Typical Operating Characteristics
(VCC = 3.3V and TA = +25°C, unless otherwise noted.)
                                             ABSOLUTE TOF                                                                                                          ABSOLUTE TOF
                                        ERROR vs. SUPPLY VOLTAGE              toc01
                                                                                                                                                                ERROR vsTEMPERATURE               toc02
                             34                                                                                                                     34
                             32                                                                                                                     32
                             30                                                                                                                     30
              ERROR (ns)     28                                                                                                   ERROR (ns)        28
                             26                                                                                                                     26
                             24                                                                                                                     24
                             22                                                                                                                     22
                                  2.2    2.45   2.7     2.95    3.2   3.45    3.7     3.95                                                               -10       15           40           65           90
                                                      VCC (V)                                                                                                           TEMPERATURE (ºC)
www.maximintegrated.com                                                                                                                                                                       Maxim Integrated │ 6


MAX35101                                          Time-to-Digital Converter with Analog Front-End
Pin Configuration
                               TOP VIEW
                                              32KX1   32KX0    GND   TC       T4          T3    T2          T1
                                               24      23      22     21        20        19     18           17
                                 GND 25                                                                                     16 CSW
                              STOP_DN 26                                                                                    15 WDO
                              STOP_UP   27                                                                                  14 RST
                                 GND 28                         MAX35101                                                    13 DOUT
                                  VCC 29                                                                                    12 DIN
                                 GND    30                                                                                  11 SCK
                                   X2   31                                                                                  10 CE
                                                                                                      EP
                                   X1 32                                                                                    9   INT
                                              +
                                                  1     2      3       4         5         6      7             8
                                              GND
                                                      BYPASS
                                                               VCC
                                                                     32KOUT
                                                                              LAUNCH_DN
                                                                                          VCC
                                                                                                LAUNCH_UP
                                                                                                            CMP_OUT/UP_DN
                                                                  TQFP
                                                               (5mm x 5mm)
Pin Description
    PIN            NAME                                                                                FUNCTION
 1, 22, 25,
                   GND        Device Ground
  28, 30
                              Connect this pin to ground with a capacitor (100nF) to provide stability for the on-board low-
     2            BYPASS      dropout regulator that is used to supply the flash circuitry. The effective series resistance of this
                              capacitor needs to be in the 1Ω to 2Ω range.
  3, 6, 29          VCC       Main Supply. Typically sourced from a single lithium cell.
     4            32KOUT      CMOS Output. Repeats the 32kHz crystal oscillator frequency.
     5          LAUNCH_DN     CMOS Pulse Output Transmission in Downstream Direction of Water Flow
     7         LAUNCH _UP     CMOS Pulse Output Transmission in Upstream Direction of Water Flow
                              CMOS Output. Indicates the direction (upstream or downstream) of which the pulse launcher is
     8        CMP_OUT/UP_DN
                              currently launching pulses OR the comparator output.
                              Active-Low Open-Drain Interrupt Output. The pin is driven low when the device requires service
     9              INT
                              from the host microprocessor.
    10              CE        Active-Low CMOS Digital Input. Serial peripheral interface chip enable input.
www.maximintegrated.com                                                                                                               Maxim Integrated │ 7


MAX35101                                    Time-to-Digital Converter with Analog Front-End
Pin Description (continued)
   PIN              NAME                                             FUNCTION
    11               SCK  CMOS Digital Input. Serial peripheral interface clock input.
    12               DIN  CMOS Digital Input. Serial peripheral interface data input.
    13              DOUT  CMOS Output. Serial peripheral interface data output.
    14               RST  Active-Low CMOS Digital Reset Input
    15               WDO  Active-Low Open-Drain Watchdog Output
    16               CSW  CMOS Digital Input. Case Switch. Active-high tamper detect input.
    17                T1  Open-Drain Probe 1 Temperature Measurement
    18                T2  Open-Drain Probe 2 Temperature Measurement
    19                T3  Open-Drain Probe 3 Temperature Measurement
    20                T4  Open-Drain Probe 4 Temperature Measurement
    21                TC  Input/Output Temperature Measurement Capacitor Connection
    23              32KX0 Connections for 32.768kHz Quartz Crystal. An external CMOS 32.768kHz oscillator can also
                          drive the MAX35101. In this configuration, the 32KX1 pin is connected to the external oscillator
    24              32KX1 signal and the 32KX0 pin is left unconnected.
                          Downstream STOP Analog Input. Used for the signal that is received from the downstream
    26            STOP_DN
                          transmission of a time-of-flight measurement.
                          Upstream STOP Analog Input. Used for the signal that is received from the upstream
    27            STOP_UP
                          transmission of a time-of-flight measurement.
    31                X2
                          Connections for 4MHz Quartz Crystal. A ceramic resonator can also be used.
    32                X1
    —                 EP  Exposed Pad. Connect to GND.
www.maximintegrated.com                                                                              Maxim Integrated │ 8


MAX35101                                                 Time-to-Digital Converter with Analog Front-End
Block Diagram
                                                         CMP_OUT/UP_DN                      GND   GND  GND    GND    GND
             STOP_UP                                                                                                       CSW
                            ANALOG                               TIME-TO-                                    DATA AND
                                                                                    PROGRAMMABLE
                         SWITCHING AND                            DIGITAL                                     STATUS
             STOP_DN                                                                     ALU                               WDO
                         BIAS CONTROL                          CONVERTER                                    REGISTERS
                                                                                                                           INT
                 VCC
                                                                                                                           RST
                 VCC
                                                                 MAX35101
                 VCC
              BYPASS                       INTERNAL           8 KBYTES                                                     SCK
                                              LDO               FLASH
                                                                                      STATE                                DOUT
                                                                                     MACHINE                  4-WIRE
            LAUNCH_UP                                                             CONTROLLER                INTERFACE      DIN
                             PULSE                         CONFIGURATION
            LAUNCH_DN      LAUNCHER                          REGISTERS
                                                                                                                           CE
                                HIGH SPEED AND 32 KHZ OSCILLATORS
                                                                                    TEMPERATURE MEASUREMENT
                                        W/REAL TIME CLOCK
                               X1       X2     32KX1     32KX0     32KOUT           T1      T2   T3   T4    TC
Detailed Description                                                      The real-time clock (RTC) provides one programmable
The MAX35101 is a time-to-digital converter with built-in                 alarm and watchdog functionality.
amplifier and comparator targeted as a complete analog                    A simple opcode based 4-Wire SPI interface allows any
front-end solution for the ultrasonic heat meter and flow                 microcontroller to effectively configure the device for its
meter markets.                                                            intended measurement.
With automatic differential time-of-flight (TOF) measure-                 On-board user flash allows the MAX35101 to be nonvola-
ment, this device makes for simplified computation of liq-                tile configurable and provides nonvolatile energy use data
uid flow. Early edge detection ensures measurements are                   to be logged.
made with consistent wave patterns to greatly improve
accuracy and eliminate erroneous measurements. Built-in
                                                                          Time-of-Flight (TOF) Measurement Operations
arithmetic logic unit provides TOF difference measure-                    TOF is measured by launching pulses from one piezo-
ments. A programmable receiver hit accumulator can be                     electric transducer and receiving the pulses at a sec-
utilized to minimize the host microprocessor access.                      ond transducer. The time between when the pulses are
                                                                          launched and received is defined as the time of flight. The
For temperature measurement, the MAX35101 supports
                                                                          MAX35101 contains the functionality required to create
up to four (4) 2-wire PT1000/500 platinum resistive tem-
                                                                          a string of pulses, sense the receiving pulse string, and
perature detectors (RTD).
                                                                          measure the time of flight. The MAX35101 can measure
The MAX35101 offers an event timing mode that is con-                     two separate TOFs, which are defined as TOF up and
figurable and runs cyclic algorithms to minimize micropro-                TOF down.
cessor interactivity and increase battery life.
www.maximintegrated.com                                                                                               Maxim Integrated │ 9


MAX35101                                                           Time-to-Digital Converter with Analog Front-End
     Figure 3                                                     TOF MEASUREMENT SEQUENCE
                                                          TOF                                                    HIT1
                 TIME OF FLIGHT MEASUREMENTS
                                                                                                                 HIT2
                                                                                                 T1         T2
                                                                                                                 HIT3
                                                                                                                                   AVG = ∑(HIT[1:6]) ÷ 6
                                                                                                                 HIT4
                                                         START
                                                                                                                 HIT5
                                                                                                                 HIT6
       LAUNCH PIN
                                                                           COMPARATOR OFFSET
                                                                                                                                   COMPARATOR OFFSET RETURN
       STOP PIN                                                                    WAVE
                                                                                                  0 1 2 3 4 5 6 7 8 9 10 11
                                                                                 NUMBER
       INT PIN
                                                                        (4)
                          (1)                  (2)
                                                                       TOF
                        4 MHZ                 BIAS
                                                                   MEASUREMENT
                       STARTUP             CHARGE TIME
                                                                      DELAY             (4)
                                      (2)                                             ENABLE
                                 BIAS APPLIED                                        RECEIVER
                                 TO STOP PIN
              TOF                                          (3)                                   (6)                   (8)          (9)       (10)
            COMMAND                                      LAUNCH                          (5)                 (7)
                                                                                              COMPARE                 STOP      CALCULATIO     INT
            RECEIVED                                     PULSES                       T1 WAVE             T2 WAVE
                                                                                               RETURN                 HITS          NS     ASSERTED
                                                                                 SELECTED WAVES FOR HITS:
       STOP HITS SELECTED = 6, STOP POLARITY = POSITIVE EDGE                     T2 = 4 HIT1 = 6 HIT2 = 7 HIT3 = 8   HIT4 = 9   HIT5 = 10 HIT6 = 11
Figure 3. Time-of-Flight Sequence
A TOF up measurement has pulses launched from the                                           cycle pulses is set by the DPL[3:0] bits, also in the
LAUNCH_UP pin, which is connected to the downstream                                         TOF1 register. The start of these launch pulses gen-
transducer. The ultrasonic pulse is received at the                                         erates a start signal for the time-to-digital converter
upstream transducer, which is connected to the STOP_                                        (TDC) and is considered to be time zero for the TOF
UP pin. A TOF down measurement has pulses launched                                          measurement. This is denoted by the start signal in
from the LAUNCH_DN pin, which is connected to the                                           the start/stop TDC timing (Figure 3).
upstream transducer. The ultrasonic pulse is received at                             4)     After a programmable delay time set in TOF
the downstream transducer, which is connected to the                                        Measurement Delay register, the comparator and hit
STOP_DN pin.                                                                                detector at the appropriate STOP pin are enabled.
TOF measurements can be initiated by sending either the                                     This delay allows the receiver to start recording hits
TOF_UP, TOF_DN, or TOF_DIFF commands. TOF_DIFF                                              when the received wave is expected, eliminating
measurements can also be automatically executed using                                       possible false hits from noise in the system.
event timing mode commands EVTMG1 or EVTMG2.                                         5)     Stop hits are detected according to the programmed
The steps involved in a single TOF measurement are                                          preferred edge of the acoustic signal sequence
described here and shown in Figure 3.                                                       received at the STOP pin according to the setting
1)     The 4MHz oscillator and LDO is enabled with a pro-                                   of the STOP_POL bit in the TOF1 register. The first
       grammable settling delay time set by the CLK_S[2:0]                                  stop hit is detected when a wave received at the
       bits in Calibration and Control register.                                            STOP pin exceeds the comparator offset voltage,
                                                                                            which is set in the TOF6 and TOF7 registers. This
2)     A common-mode bias is enabled on the STOP pin.                                       first detected wave is wave number 0. The width of
       This bias charge time is set by the CT[1:0] bits in the                              the wave’s pulse that exceeds the comparator offset
       TOF1 register.                                                                       voltage is measured and stored as the t1 time.
3)     Once the bias charge time has expired, the pulse                              6)     The offset of the comparator then automatically and
       launcher drives the appropriate LAUNCH pin with                                      immediately switches to the comparator return off-
       a programmable sequence of pulses. The number                                        set, which is set in the TOF6 and TOF7 registers.
       of pulses launched is set by the PL[7:0] bits in the
       TOF1 register. The frequency of these 50% duty-
www.maximintegrated.com                                                                                                                     Maxim Integrated │ 10


MAX35101                                                Time-to-Digital Converter with Analog Front-End
7)     The t2 wave is detected and the width of the t2 pulse                portion is a binary representation of the number of
       is measured and stored as the t2 time. The wave                      t4MHz periods that contribute to the time results. The
       number for the measurement of the t2 wave width is                   fractional portion is a binary representation of one
       set by the T2WV[5:0] bits in the TOF2 register.                      t4MHz period quantized to a 16-bit resolution. The maxi-
8)     The preferred number of stop hits are then detect-                   mum size of the integer is 7FFFh or (215-1) x t4MHz
       ed. For each hit, the measured TOF is stored in                      or ~ 8.19 ms. The maximum size of the fraction is:
       the appropriate HITxUPINT and HITxUPFrac or                                      216 − 1
       HITxDNINT and HITxDNFRAC registers. The num-                         FFFFh or            × t 4MHz . or ~ 249.9961 ns.
                                                                                         216
       ber of hits to detect is set by the STOP[2:0] bits in
       the TOF2 register. The wave number to measure for                    Table 1. Two’s Complement TOF_DIFF
       each stop hit is set by the HITx wave select bits in
       the TOF3, TOF4, and TOF5 registers.                                  Conversion Example
9)     After receiving all of the programmed hits, the                               REGISTER VALUE                       CONVERTER VALUE
       MAX35101 calculates the average of the recorded
                                                                               TOF_DIFFInt       TOF_DIFFFrac                 TOF DIFF VALUE
       hits and stores this to AVGUPINT and AVGUPFrac
                                                                                   (hex)               (hex)                           (ns)
       or AVGDNInt and AVGDNFrac. The ratio of t1/t2 and
       t2/tideal are calculated and stored in the WVRUP or                         7FFF                FFFF                     8,191,999.9962
       WVRDN register.                                                             001C                0403                       7,003.9177
10) Once all of the hit data, wave ratios, and averages                            0001                00A1                         250.6142
       become available in the Results registers, the TOF
       bit in the Interrupt Status register is set and the INT                     0000                0089                           0.5226
       pin is asserted (if enabled) and remains asserted                           0000                0001                           0.0038
       until the Interrupt Status register is accessed by the
                                                                                   0000                0000                           0.0000
       microprocessor with a read register command.
                                                                                   FFFF                FFFF                          -0.0038
The computation of the total time of flight is performed
by counting the number of full and fractional 4MHz clock                           FFFF                FFC0                          -0.2441
cycles that elapsed between the launch start and a hit                             FFFE                1432                        -480.2780
stop as shown in Figure 4.
                                                                                   FF1C                8001                      -56,874.9962
Each TOF measurement result is comprised of an
integer portion and a fractional portion. The integer                              8000                0000                    -8,192,000.0000
   Figure 4
                                                    INTEGER TOF RESULTS PORTION                  FRACTIONAL TOF RESULTS PORTION
                                                              1 LSB = T4MHZ                              1 LSB = T4MHz/(2^16)
                                  1            2            3               4                        N
                    4 MHz CLOCK
              START SIGNAL                                                                                                       STOP SIGNAL
   (INTERNALLY GENERATED                                                                                                         (GENERATED UPON
     WHEN ACOUSTIC SIGNAL                                                                                                        ACOUSTIC SIGNAL
           IS TRANSMITTED)                                                                                                       RECEPTION)
                                                   TOTAL TIME OF FLIGHT = INTEGER + FRACTIONAL
Figure 4.Start/Stop for Time-to-Digital Timing
www.maximintegrated.com                                                                                                       Maxim Integrated │ 11


MAX35101                                                               Time-to-Digital Converter with Analog Front-End
Early Edge Detect                                                                      The MAX35101 is now ready to measure the successive
This early edge detect method of measuring the TOF                                     hits. The next selected wave that is measured is the t2
of acoustic waves is used for all of the TOF commands                                  wave. In the example in Figure 5, this is the 7th wave after
including TOF_UP, TOF_DN, and TOF_DIFF. This meth-                                     the early edge detect wave. The selection of the t2 wave
od allows the MAX35101 to automatically control the                                    is made with the T2WV[5:0] bits in the TOF2 register.
input offset voltage of the receiver comparator so that it                             With reference to Figure 5, the ratio t1/t2 is calculated and
can provide advanced measurement accuracy. The input                                   registered for the user. This ratio allows determination of
offset of the receiver comparator can be programmed with                               abrupt changes in flow rate, received signal strength, par-
a range +127 LSBs if triggering on a positive edge and                                 tially filled tube detection, and empty tube. It also provides
-127 LSBs if triggering on a negative edge, with 1 LSB                                 noise suppression to prevent erroneous edge detection.
= VCC/3072. Separate input offset settings are available                               Also, the ratio t2/tideal is calculated and registered for
for the upstream received signal and the downstream                                    the user. For this calculation, tideal is1/2 the period of
received signal. The input offset for the upstream received                            launched pulse. This ratio adds confirmation that the t2
signal is programmed using the C_OFFSETUP[6:0] bits                                    wave is a strong signal, which provides insight into the
in the TOF6 register. The input offset for the down-                                   common mode offset of the received acoustic wave.
stream received signal is programmed using the C_
OFFSETDN[6:0] bits in the TOF7 register. Once the first                                TOF Error Handling
hit is detected, the time t1 equal to the width of the earliest                        Any of the TOF measurements can result in an error.
detectable edge is measured. The input offset voltage is                               If an error occurs during the measurement, all of the
then automatically and immediately returned to a pre-                                  associated registers report FFFFh. If a TOF_DIFF is
programmed comparator offset value. This return offset                                 being performed, the TOF_DIFFInt and TOF_DIF_Frac
value has a range of +127 LSBs to -128 LSBs in 1 LSB                                   registers report 7FFFh and FFFFh, respectively. The
steps and is programmed into the C_OFFSETUPR[7:0]                                      TOF_DIFF_AVG Results registers do not include the error
bits in the TOF6 register for the upstream received signal                             measurement. If the measurement error is caused by
and programmed into the C_OFFSETDNR[7:0] bits in the                                   the time measurement exceeding the timeout set by the
TOF7 register. This preprogrammed comparator offset                                    TIMOUT[2:0] bits in the TOF2 register, then the TO bit in
return value is provided to allow for common-mode shifts                               the Interrupt Status register is set and the INT pin asserts
that can be present in the received acoustic wave.                                     (if enabled).
    Figure 5                        OFFSET RESETS AUTOMATICALLY TO A
                                PREPROGRAMMED VALUE (±127mV IN 1mV STEPS)
                                  TO DETECT SUBSEQUENT ZERO CROSSINGS
                                                                                      WAVE NUMBER
                                    0      1      2       3      4      5      6 7     8       9     10   11   12   13   14
    PROGRAMMABLE OFFSET DETECT:
        ±127mV IN 1mV STEPS
                                                                                    HIT NO.: 1     2    3    4    5    6
                                    t1                                           t2
                                                      EXAMPLE: MEASURE WIDTH OF
                                                      7TH WAVE AFTER EARLY EDGE
                                                                DETECT
Figure 5. Early Edge Detect Received Wave Example
www.maximintegrated.com                                                                                                         Maxim Integrated │ 12


MAX35101                                                             Time-to-Digital Converter with Analog Front-End
Temperature Measurement Operations                                                       to maximize power efficiency by evaluating the tempera-
A temperature measurement is a time measurement of                                       ture of the RTDs with a coarse measurement prior to a
the RC circuit connected to the temperature port device                                  real measurement. The coarse measurement provides
pins T1 through T4 and TC. The TC device pin has a                                       an approximation to the TDC converter. During the real
driver to charge the timing capacitor. The ports that are                                measurement, the TDC can then optimize its measure-
measured and the order in which the measurement is                                       ment parameters to use power efficiently. These evaluate
performed is selected with the TP[1:0] bits in the Event                                 cycles are automatically inserted according to the order of
Timing 2 register.                                                                       ports selected with the of the Temperature Port bits. The
                                                                                         time from the start of one port’s temperature measure-
Figure 6 depicts a 1000Ω platinum RTD with a 100nF                                       ment to the next port’s temperature measurement is set
NPO COG 30ppm/°C capacitor. It shows two dummy                                           using with the PORTCYC[1:0] bits in the Event Timing 2
cycles with 4 temperature port evaluation measurements                                   register.
and 4 real temperature port measurements. This occurs
when setting the TP[1:0] bits in the Event Timing 2 regis-                               Once all the temperature measurements are completed,
ter to 11b.                                                                              the times measured for each port are reported in the cor-
                                                                                         responding TxInt and TxFrac Results registers. The TE bit
The dummy 1 and dummy 2 cycles represent preamble                                        in the Interrupt Status register is also set and the INT pin
measurements that are intended to eliminate the dielec-                                  asserts (if enabled).
tric absorption of the temperature measurement capaci-
tor. These dummy cycles are executed using a RTD                                         Actual temperature is determined by a ratiometric calcu-
Emulation resistor of 1000Ω internal to the MAX35101.                                    lation. If T1 and T2 are connected to platinum RTDs and
This dummy path allows the dielectric absorption effects                                 T3 and T4 are connected to the same reference resistor
of the capacitor to be eliminated without causing any of                                 (as shown in the System Diagram), then the ratio of T1/
the RTDs to be unduly self-heated. The number of dummy                                   T3 = RRTD1/RREF and T2/T4 = RRTD2/RREF. The ratios
measurements to be taken ranges from 0 to 7. This                                        RRTD1/RREF and RRTD2/RREF can be determined by the
parameter is configured by setting the PRECYC[2:0] bits                                  host microprocessor and the temperature can be derived
in the Event Timing 2 register.                                                          from a look-up table of Temperature vs. Resistance for
                                                                                         each of the RTDs utilizing interpolation of table entries if
Following the dummy cycles, an evaluation, TXevaluate,                                   required.
is performed. This measurement allows the MAX35101
   Figure 6        DRIVER TO CHANGE
               TC-CONNECTED CAPACITOR
                                                                              VTC
               3.5
               3.0
               2.5
               2.0
                                                                                                                                    PORTCYCLE TIME
     VOLTS (V)                                                                                                                      (PORTCYC1-PORTCYC0)
                                                                                                                                    SET TO “00” 128µs
               1.5
                                                                                                                                        VTC
               1.0
                     DUMMY1      DUMMY2   T1EVALUATE T3EVALUATE T2EVALUATE T4EVALUATE      T1        T3       T2       T4
               0.5
                 0
                             128        256        384        512        640         768       896      1,024    1,152    1,280 1,408
                                                                             TIME (µs)
Figure 6. Temperature Command Execution Cycle Example
www.maximintegrated.com                                                                                                           Maxim Integrated │ 13


MAX35101                                             Time-to-Digital Converter with Analog Front-End
Temperature Error Handling                                    command continues to execute until a HALT command
The temperature measurement unit can detect open and/         is received by the MAX35101. If the ET_CONT bit is
or short-circuit temperature probes. If the resultant tem-    clear, automatic execution of event timing stops after the
perature reading in less than 8µs, then the MAX35101          completion of a full sequence of measurements.
writes a value of 0000h to the corresponding Results          Continuous Interrupt Timing Operation
registers to indicate a short-circuit temperature probe. If
                                                              When operating in event timing mode, the INT pin can be
the measurement process does not discharge the TC pin
                                                              asserted (if enabled) either after each TOF or tempera-
below the threshold of the internal temperature compara-
                                                              ture measurement, or at the completion of the sequence
tor within 2µs of the time set by the PORTCYC[1:0] bits
                                                              of measurements. If the CONT_INT bit in the Calibration
in the Event Timing 2 register, then an open circuit tem-
                                                              and Control register is set to a 1, then the INT pin asserts
perature probe error is declared. The MAX35101 writes a
                                                              (if enabled) at the completion of each TOF or temperature
value of FFFFh to the corresponding results registers to
                                                              command. This allows the host microcontroller to interro-
indicate an open circuit temperature probe, the TO bit in
                                                              gate the current event for accuracy of measurement. If the
the Interrupt Status register is set, and the INT pin asserts
                                                              CONT_INT bit is set to a 0, then the INT pin only asserts
(if enabled). If the temperature measurement error is
                                                              (if enabled) at the completion of a sequence of measure-
caused by any other problems, then the MAX35101 writes
                                                              ments. This allows the host microcontroller to remain in a
a value of FFFFh to each of the temperature port results
                                                              low-power sleep mode and only wake-up upon the asser-
registers indicating that all of the temperature port mea-
                                                              tion of the INT pin.
surements are invalid.
                                                              Error Handling During Event Timing Operation
Event Timing Operation
                                                              During execution of event timing modes, any error that
The event timing mode of operation is an advanced             occurs during a TOF_DIFF or temperature measurement
feature that allows the user to configure the MAX35101        are handled as described in the corresponding error
to perform automatic measurement cycles. This allows          handling sections. Calibration can be executed during
the host microcontroller to enter low-power mode and          event timing operation, if programmed to do so with the
only awaken upon assertion of the MAX35101 INT pin            calibration configuration bits in the Calibration and Control
(if enabled) when new measurement data is available.          register. If a calibration error occurs, this is handled as
By using the TOF_DIFF and temperature commands                described in the Error Handling During Calibration sec-
and configuring the appropriate TOFx registers and the        tion. If any of these errors occur, the event timing opera-
Event Timing registers, the event timing modes directs        tion does not terminate, but continues operation.
the MAX35101 to provide complete data for a sequence
of measurements captured on a cyclical basis. There are       When making TOF measurements in event timing mode,
three versions of the EVTMG commands.                         the MAX35101 provides additional data in the TOF_
                                                              Cycle_Count/TOF_Range register that can be used to
●● EVTMG2: Performs automatic TOF_DIFF measure-               check the validity of all of the TOF measurements. The
    ments. The parameters and operation of the TOF            TOF_Cycle_Count is the number of valid error-free TOF
    measurement are described in the Time-of-Flight           measurements that were recorded during an Event Timing
    (TOF) Measurement Operations section.                     Sequence. If a TOF error occurs, the TOF_Cycle_Count
●● EVTMG3: Performs automatic Temperature mea-                register will not be incremented. The TOF_Range is the
    surements. The parameters and operation of the            range of all valid TOF measurements that were captured
    Temperature measurements are described in the             during a sequence.
    Temperature Measurement Operations section.               When making temperature measurements in event tim-
●● EVTMG1: Performs automatic TOF_DIFF                   and  ing mode, the MAX35101 provides additional data in the
    Temperature measurements.                                 Temp_Cycle_Count register. This count increments after
                                                              every valid error-free temperature measurement and can
Continuous Event Timing Operation
                                                              be used to check the validity of all of the temperature
The MAX35101 can be configured to continue run-               measurements. Also, the Temperature Average Results
ning event timing sequences at the completion of any          registers, TxAVG, are not updated with the error measure-
sequence. If the ET_CONT bit in the Calibration and           ment if a temperature error occurs during event timing
Control register is set, the currently executing EVTMGx       operation.
www.maximintegrated.com                                                                               Maxim Integrated │ 14


MAX35101                                           Time-to-Digital Converter with Analog Front-End
Event Timing Mode 2                                         Event Timing Mode 3
The EVTMG2 command execution causes the TOF_DIFF            The EVTMG3 command execution causes the tem-
command to be executed automatically with program-          perature command to be executed automatically with
mable repetition rates and programmable total counts as     programmable repetition rates and programmable total
shown in Figure 7.                                          counts (Figure 9).
During execution of the EVTMG2 command, each TOF_           During execution of the EVTMG3 command, each
DIFF command execution cycle causes the MAX35101            Temperature command execution cycle computes the
to compute a TOF_DIFF measurement (AVGUP register           running average of the measurement of each tempera-
minus AVGDN register) as well as the running average of     ture port. The results are provided in the Tx_AVGInt and
TOF_DIFF measurements (TOFF_DIFF_AVG register).             TxAVGFrac Results registers.
The setting of the TDF[3:0] bits in the Event Timing 1 reg- The setting of the TMF[5:0] bits in the Event Timing 1 reg-
ister selects the rate at which TOF_DIFF commands are       ister selects the rate at which temperature commands are
executed. The setting of the TDM[4:0] bits in the Event     executed. The setting of the TMM[4:0] bits in the Event
Timing 1 register determines the number of TOF_DIFF         Timing 2 register determines the number of temperature
measurements to be taken during the sequence.               measurements to be taken during the sequence.
Once all of the TOF_DIFF measurements in the sequence       Once all of the temperature measurements in the sequence
are captured, the TOF_DIFF_AVG register contains the        are captured Tx_AVGInt and TxAVGFrac Results regis-
average of the differences of the resultant AVGDN and       ters contains the average of all the temperature measure-
AVGUP Results register content of each TOF_DIFF             ments in the sequence. After these registers are updated,
measurement. After the TOF_DIFF_AVG registers are           the Temp_EVTMG bit is set in the Interrupt Status register
updated, the TOF_EVTMG bit is set in the Interrupt Status   and the INT pin asserts (if enabled).
register and the INT pin asserts (if enabled).
www.maximintegrated.com                                                                            Maxim Integrated │ 15


MAX35101                                                               Time-to-Digital Converter with Analog Front-End
  Figure 7                           EVTMG2                                       Figure 8
                                    COMMAND
                            TIME OF FLIGHT EVENT                                                     HOST MICROCONTROLLER USE OF EVTMG2
                                                                                                               TIME OF FLIGHT EVENT
                                      START
                                                                                                 PROGRAM TOF
                             GET CONFIGURATION                                                     DIFFERENCE
                                REGISTER DATA
                                                                                                 MEASUREMENT                      PROGRAMMABLE IN
                                                                                                   FREQUENCY                      0.5 SECOND STEPS
                                                                                                   (TDF3-TDF0)                     UP TO 8 SECONDS
                                  START TIMER
                                                                                            (EG. EVERY 2 SECONDS)
                               IS TIMER > = NEXT NO                                       PROGRAM NUMBER OF TOF
                                    TDF3-TDF0                                                      DIFFERENCE                           UP TO 32
                                  INCREMENT?            ASSERT THE INT                                                           MEASUREMENTS CAN
                                                          DEVICE PIN
                                                                                                MEASUREMENTS
                                                                                          (TDM4-TDM0) TO BE TAKEN                      BE TAKEN
                                          YES                                                         (EG. 15)
                              PERFORM TOF_DIFF
                                    COMMAND
                                                                                            CONFIGURE REMAINING
                                                                                             MAX35101 REGISTERS
                        YES    IS TIMER > = NEXT
                                                                                           INCLUDING THE CONT_INT
                                    TDF3-TDF0
                                  INCREMENT?                                                   AND ET_CONT BITS
                                          NO
                                                                                               SEND THE EVTMG2
                              COMPUTE RUNNING
         SEE ERROR             AVG FOR TOF_DIFF                                                     COMMAND
          HANDLING           MEASUREMENTS AND
        DESCRIPTION                 STORE AT
                                 TOF_DIFF_AVG
                                                                                            WAIT FOR ASSERTION OF
                                                                                                 INT DEVICE PIN
                                   INCREMENT
                              TOF_CYCLE_COUNT
                                                      SETTING CONT_INT
                                                         ALLOWS HOST                       READ INTERRUPT STATUS
                                   INCREMENT
                                                     MICROCONTROLLER                                REGISTER
                                                       TO INTERROGATE
                               SEQUENCE CYCLE
                                                       MAX35101 AFTER
                                    COUNTER
                                                     EACH MEASUREMENT
                                                            CYCLE
                                                                                     NO          IS TOF_EVTMG
                               SEQUENCE CYCLE    NO
                               COUNTER = TDM4-                                                       BIT SET?
                                     TDM0 ?
                                          YES          IS THE CONT_INT  NO
                                                                                                           YES
                                                           BIT SET?
                                     SET THE                                                                                     AVERAGE OF 15 TOF
                               TOF_EVTMG BIT IN                                               READ TOF_DIFF_AVG,                      DIFFERENCE
                                THE INTERRUPT                                                                                    MEASUREMENTS ARE
                               STATUS REGISTER
                                                                 YES                           TOF_DIFF, AVGUP,
                                                                                            AVGDN, HITX REGISTERS                   READY FOR THE
                                                        ASSERT THE INT
                                                          DEVICE PIN                              FOR TOF DATA                           HOST
                                                                                                                                 MICROCONTROLLER
                                ASSERT THE INT
                                   DEVICE PIN
                                                        ASSERT THE INT
                                                          DEVICE PIN
    SETTING ET_CONT BIT
        CAUSES THE                                                                                                        NO             OTHER
      SEQUENCE TO BE                             YES                                            IS THE ET_CONT
        CONTINUOUS
                              IS THE ET_CONT BIT
                                                                                                     BIT SET?                          PROCESS
                                       SET?
                                          NO
                                                                                                           YES
                                       END
Figure 7. EVTMG2 Command                                                       Figure 8. EVTMG2 Pseudo Code
www.maximintegrated.com                                                                                                           Maxim Integrated │ 16


MAX35101                                                                Time-to-Digital Converter with Analog Front-End
   Figure 9                          EVTMG3                                       Figure 10
                                    COMMAND
                             TEMPERATURE EVENT
                                                                                                      HOST MICROCONTROLLER USE OF EVTMG3
                                      START
                                                                                                                TEMPERATURE EVENT
                             GET CONFIGURATION                                              PROGRAM TEMPERATURE
                                REGISTER DATA
                                                                                                   DIFFERENCE
                                                                                                  MEASUREMENT                   PROGRAMMABLE IN
                                                                                                    FREQUENCY                    1 SECOND STEPS
                                  START TIMER
           TEMPERATURE                                                                              (TDF5-TDF0)                 UP TO 64 SECONDS
          MEASUREMENT
         REPETITION RATE                                                                    (EG. EVERY 15 SECONDS)
                               IS TIMER > = NEXT NO                                           PROGRAM NUMBER OF
                                    TDF5-TDF0                                                     TEMPERATURE
                                  INCREMENT?                                                                                         UP TO 32
                                                                                                   DIFFERENCE
                                                                                                                               MEASUREMENTS CAN
                                                                                                MEASUREMENTS
                                          YES                                                                                        BE TAKEN
                                                                                           (TDM4-TDM0) TO BE TAKEN
                                    PERFORM                                                            (EG. 2)
                                 TEMPERATURE
                                    COMMAND
                                                                                             CONFIGURE REMAINING
                         YES
                                                                                              MAX35101 REGISTERS
                                 TEMPERATURE
                              COMMAND ERROR ?                                              INCLUDING THE CONT_INT
                                                                                               AND ET_CONT BITS
                                          NO
                              COMPUTE RUNNING                                                  SEND THE EVTMG3
                                 AVG FOR EACH
         SEE ERROR              MEASURED PORT                                                        COMMAND
          HANDLING               AND STORE AT
        DESCRIPTION             T1_AVG, T2_AVG,
                                T3_AVG, T4_AVG
                                    REGISERS                                                WAIT FOR ASSERTION OF
                                                       SETTING CONT_INT                           INT DEVICE PIN
                                   INCREMENT              ALLOWS HOST
                             TEMP_CYCLE_COUNT         MICROCONTROLLER
                              RESULTS REGISTER          TO INTERROGATE
                                                        MAX35101 AFTER
                                                     EACH MEASUREMENT                       READ INTERRUPT STATUS
                                                              CYCLE                                  REGISTER
                                   INCREMENT
                               SEQUENCE CYCLE
                                    COUNTER
                                                                                      NO         IS TEMP_EVTMG
                               SEQUENCE CYCLE    NO     IS THE CONT_INT  NO                           BIT SET?
                               COUNTER = TDM4-               BIT SET?
                                      TDM0 ?
                                          YES                      YES                                      YES
                                                                                                                                ACCUMULATION OF
                                     SET THE                 SET THE                         READ THE TXINT, TXFRAC,            TWO TEMPERATURE
                               TOF_EVTMG BIT IN           TE BIT IN THE
                                                                                             TX_AVGINT, TX_AVGFRAC             MEASUREMENTS ARE
                                THE INTERRUPT         INTERRUPT STATUS
                               STATUS REGISTER              REGISTER                              REGISTERS FOR                   READY FOR THE
                                                                                               TEMPERATURE DATA                        HOST
                                                                                                                                MICROCONTROLLER
                                ASSERT THE INT           ASSERT THE INT
                                   DEVICE PIN              DEVICE PIN
    SETTING ET_CONT BIT                                                                                                 NO            OTHER
                                                                                                IS THE ET_CONT
        CAUSES THE
                                                                                                      BIT SET?                       PROCESS
      SEQUENCE TO BE                             YES
                              IS THE ET_CONT BIT
        CONTINUOUS                     SET?
                                          NO                                                                YES
                                       END
Figure 9. EVTMG3 Command                                                        Figure 10. EVTMG3 Pseudo Code
www.maximintegrated.com                                                                                                          Maxim Integrated │ 17


MAX35101                                             Time-to-Digital Converter with Analog Front-End
Event Timing Mode 1
                                                              Figure 11
The EVTMG1 command execution causes the TOF_DIFF                                       HOST MICROCONTROLLER USE OF EVTMG1
                                                                                         TIME OF FLIGHT / TEMPERATURE EVENT
command and the temperature command to be executed
                                                                                   PROGRAM TOF
automatically with programmable repetition rates and pro-                           DIFFERENCE
                                                                                   MEASUREMENT                     PROGRAMMABLE IN
grammable total counts. In essence, both the EVTMG2                                  FREQUENCY                      0.5 SECOND STEPS
                                                                                                                    UP TO 8 SECONDS
and EVTMG3 commands are simultaneously executed in                                   (TDF3-TDF0)
                                                                              (EG. EVERY 2 SECONDS)
a synchronous manner.
Setting up the TOF measurements for automatic execu-                       PROGRAM NUMBER OF TOF
tion in event timing mode 1 is identical to setting these up                        DIFFERENCE
                                                                                 MEASUREMENTS
                                                                                                                          UP TO 32
                                                                                                                  MEASUREMENTS CAN
for execution with event timing mode 2. Likewise, setting                  (TDM4-TDM0) TO BE TAKEN                       BE TAKEN
                                                                                        (EG. 2)
up the temperature measurements is identical to setting
these up for execution using event timing mode 3.
                                                                            PROGRAM TEMPERATURE
                                                                                                                   PROGRAMMABLE IN
If the TOF_DIF command repetition rate and the tempera-                            MEASUREMENT
                                                                                                                     1 SECOND STEPS
                                                                             FREQUENCY (TMF5-TMF0)
ture command repetition rate cause both measurements                         (EG. EVERY 15 SECONDS)
                                                                                                                   UP TO 64 SECONDS
to be required at the same time, the TOFF_DIF command
takes precedent. Upon completion of the TOFF_DIFF                                  PROGRAM # OF
command, the pending temperature command is execut-                                TEMPERATURE
                                                                                 MEASUREMENTS
                                                                                                                          UP TO 32
                                                                                                                  MEASUREMENTS CAN
ed (Figure 12).                                                            (TMM4-TMM0) TO BE TAKEN
                                                                                        (EG. 2)
                                                                                                                         BE TAKEN
Once all of the TOF_DIFF measurements in the sequence
are complete, the TOF_EVTMG bit in the Interrupt Status                       CONFIGURE REMAINING
register is set and the INT pin asserts (if enabled).                          MAX35101 REGISTERS
                                                                            INCLUDING THE CONT_INT
Likewise, when all of the temperature measurements in                           AND ET_CONT BITS
the sequence are completed, the Temp_EVTMG bit in
the Interrupt Status register is set and the INT pin asserts                    SEND THE EVTMG3
                                                                                      COMMAND
(if enabled). It should be noted that depending upon the
selected rates and number of cycles, the TOF_DIFF and
temperature measurements can complete their sequenc-                         WAIT FOR ASSERTION OF
                                                                                   INT DEVICE PIN
es at different times. This causes the INT pin to assert (if                                                       AVERAGE OF 15 TOF
                                                                                                                        DIFFERENCE
enabled) before both sequences are complete.                                READ INTERRUPT STATUS
                                                                                                                  MEASUREMENTS ARE
                                                                                                                  READY FOR THE HOST
                                                                                      REGISTER
                                                                                                                   MICROCONTROLLER
                                                                                                                  READ TOF_DIFF_AVG,
                                                                                  IS TEMP_EVTMG                     TOF_DIFF, AVGUP,
                                                                                       BIT SET?                  AVGDN, HITX REGISTERS
                                                                                                                       FOR TOF DATA
                                                                        NO        IS TEMP_EVTMG
                                                                                       BIT SET?
                                                                                             YES
                                                                                                                    AVERAGE OF TWO
                                                                              READ THE TXINT, TXFRAC,                 TEMPERATURE
                                                                              TX_AVGINT, TX_AVGFRAC               MEASUREMENTS ARE
                                                                                   REGISTERS FOR                      READY FOR THE
                                                                                TEMPERATURE DATA                           HOST
                                                                                                                   MICROCONTROLLER
                                                                                                            NO             OTHER
                                                                                 IS THE ET_CONT
                                                                                       BIT SET?                          PROCESS
                                                                                             YES
                                                             Figure 11. EVTMG1 Pseudo Code
www.maximintegrated.com                                                                                                     Maxim Integrated │ 18


MAX35101                                                                            Time-to-Digital Converter with Analog Front-End
                                                                                                       EVTMG1
                                                                                      TIME OF FLIGHT / TEMPERATURE COMMAND
    Figure 12
                     START           GET CONFIGURATION REGISTER DATA      START TIMER
                            TOF_DIFF
                          MEASUREMENT
                           REPETITION
                              RATE                                     IS TIMER > = NEXT         YES                                  SET
                                                                            TDF3-TDF0                                          TOF_PENDING
                                                                          INCREMENT?
                                                                             NO
                                                                                                                                                        TEMPERATURE
                                                                                                                                                       MEASUREMENT
                                                                                                                                                     REPETITION RATE
                                                                                                                                      SET
                                                                       IS TIMER > = NEXT          YES
                                                                                                                              TEMPERATURE_
                                                                           TMF5–TMF0
                                                                                                                                  PENDING
                                                                          INCREMENT?
                                                                             NO
                                                                                                  YES
                                                                     IS TOF_PENDING SET?
                                                                             NO
                                                                 NO             IS                                          PERFORM TOF_DIFF
                                                                         TEMPERATURE_                                            COMMAND
                                                                          PENDING SET?
                                                                            YES
                                                                                                                       YES       TOF_DIFF
              CLEAR                                                         PERFORM
                                                                                                                             COMMAND ERROR?                                      CLEAR
          TEMPERATURE_                                                   TEMPERATURE
                                                                                                                                                                              TOF_PENDING
             PENDING                                                        COMMAND
                                                                                                                                          NO
                                                                                                                            COMPUTE RUNNING
                                                                                                                             AVG FOR TOF_DIFF
                                                                YES      TEMPERATURE                        SEE ERROR      MEASUREMENTS AND
                                                                       COMMAND ERROR?                        HANDLING            STORE AT
                                                                                                           DESCRIPTION         TOF_DIFF_AVG          SETTING CONT_INT
                                                                                                                                                        ALLOWS HOST
                                                                             NO                                                                     MICROCONTROLLER
                                                                                                                                                      TO INTERROGATE
                                                                      COMPUTE RUNNING                                           INCREMENT             MAX35101 AFTER
                                                                         AVG FOR EACH                                       TOF_CYCLE_COUNT        EACH MEASUREMENT
                                                                        MEASURED PORT                                                                       CYCLE
                                           SEE ERROR HANDLING            AND STORE AT
                                                DESCRIPTION             T1_AVG, T2_AVG,
                                                                        T3_AVG, T4_AVG                                          INCREMENT
                                                                            REGISERS                                         SEQUENCE CYCLE
                                                                                                                                 COUNTER
                             SETTING                                       INCREMENT
                            CONT_INT                                     TEMPERATURE
                          ALLOWS HOST                                   CYCLE COUNTER                                        SEQUENCE CYCLE     NO    IS THE CONT_INT  NO
                         MICROCONTROLL
                                                                                                                             COUNTER = TDM4-               BIT SET?
                              ER TO
                                                                                                                                    TDM0?
                          INTERROGATE
                         MAX35101 AFTER
                                                                           INCREMENT                                                      YES                    YES
                              EACH
                                                                       SEQUENCE CYCLE
                          MEASUREMENT
                                                                            COUNTER
                              CYCLE                                                                                                SET THE                 SET THE
                                                                                                                             TOF_EVTMG BIT IN           TOF BIT IN THE
                                                                                                                              THE INTERRUPT         INTERRUPT STATUS
                                                                                                                             STATUS REGISTER              REGISTER
                                        NO                       NO    SEQUENCE CYCLE
                                              IS THE CONT_INT
                                                                       COUNTER = TMM4–
                                                  BIT SET?
                                                                              TMM0?
                                                                                                                                       IS      YES            IS          YES
                                                  YES                       YES
                                                                                                                           TEMPERATURE_PEND            TEMPERATURE_
                                                                                                                                  ING SET?              PENDING SET?
                                                                             SET THE
                                                   SET THE
                                                                      TEMP_EVTMG BIT IN
                                           BIT IN THE INTERRUPT
                                                                         THE INTERRUPT                                                    NO                     NO
                                             STATUS REGISTER
                                                                       STATUS REGISTER
                                                                                                   SETTING ET_CONT BIT
                                                                                                         CAUSES THE           ASSERT THE INT           ASSERT THE INT
                                                                                                      SEQUENCE TO BE            DEVICE PIN               DEVICE PIN
                                               ASSERT THE INT           ASSERT THE INT
                                                 DEVICE PIN                DEVICE PIN                   CONTINUOUS
                                                                YES   IS THE ET_CONT BIT                                    IS THE ET_CONT BIT YES
                                                                               SET?                                                  SET?
                                                                             NO                                                           NO
                                                                               END                                                   END
Figure 12. EVTMG1 Command
www.maximintegrated.com                                                                                                                                                Maxim Integrated │ 19


MAX35101                                             Time-to-Digital Converter with Analog Front-End
Calibration Operation                                          Error Handling During Calibration
For more accurate results, calibration of the TDC can          Since calibration can be set to be automatic by configur-
be performed. Calibration allows the MAX35101 to per-          ing the CAL_CFG[2:0] bits in the Event Timing 2 register,
form a calibration measurement that is based upon the          any errors that occur during the Calibrate command stop
32.768kHz crystal, which is the most accurate clock in the     the CalibrationInt and the CalibrationFrac Results regis-
system. This calibration is used when a ceramic oscillator     ters from being updated with new calibration coefficients.
is used in place of an AT-cut crystal for the 4MHz refer-      The results for the previous Calibration data remain in
ence. The MAX35101 automatically generates START               these two registers and are used for scaling measured
and STOP signals based upon edges of the 32.768kHz             results. If the calibration error is caused by the internal
clock. The number of 32.768kHz clock periods that are          calibration time measurement exceeding the time set by
used and then averaged are selected with the CAL_              the TIMOUT[2:0] bits in the TOF2 register, then the TO
PERIOD[3:0] bits in the Calibration and Control register.      bit in the Interrupt Status register is set and the INT pin
The TDC measures the number of 4MHz clock pulses that          asserts (if enabled).
occur during the 32.768kHz pulses. The measured time of
a 32.768kHz clock pulse is reported in the CalibrationInt      RTC, Alarm, Watchdog, and Tamper Operation
and CalibrationFrac Results registers. These results can       RTC Operation
then be used as a gain factor for calculating actual time-     The MAX35101 contains a real-time clock that is driven
to-digital converter measurement if the CAL_USE bit in         by a 32kHz oscillator. The time and calendar information
the Event Timing 2 Register is set.                            is obtained by reading the appropriate register words.
Following is a description of an example calibration. Each     The time and calendar are set or initialized by writing
TDC measurement is a 15-bit fixed-point integer value          the appropriate register words. The contents of the time
concatenated with a 16-bit fractional value binary repre-      and calendar registers are in the Binary-Coded Decimal
sentation of the number of t4MHz periods that contribute       (BCD) format. The clock/calendar provides hundredths
to the time result, the actual period of t4MHz needs to be     of seconds, tenths of seconds, seconds, minutes, hours,
known. If the CAL_PERIOD[3:0] bits in the Calibration          day, date, month, and year information. The date at the
and Control register are set to 6, then 6 measurements         end of the month is automatically adjusted for months with
of 32.768kHz periods are measured by the TDC and               fewer than 31 days, including corrections for leap year
then averaged. The expected measured value would be            valid up to 2100. The clock operates in either the 24-hour
30.5176µs/250ns = 122.0703125 t4MHz periods. Assume            or 12-hour format with AM/PM indicator. The MAX35101
that the 4MHz ceramic resonator is actually running at         real-time clock can be programmed for either 12-hour or
4.02MHz. The TDC measurement unit would then mea-              24-hour formats. If using the 24-hour format, Bit6 (12 HR
sure 30.5176µs/248.7562ns = 122.6806641 t4MHz peri-            MODE) of the Mins_Hrs register should be cleared to 0
ods and this result would be returned in the Calibration       and then Bit5 represents the 20-hour indicator. If using the
Results register. For all TDC measurements, a gain value       12-hour format, Bit6 should be set to 1 and Bit5 represents
of 122.0703125/122.6806641 = 0.995024876 would then            AM (if 0) or PM (if 1). The day-of-week register increments
be applied.                                                    at midnight. Values that correspond to the day of week
Calibration is performed at the following events:              are user defined but must be sequential (i.e., if 0 equals
                                                               Sunday, then 1 equals Monday, and so on). Illogical time
●● When the Calibration command is sent to the
                                                               and date entries result in undefined operation.
    MAX35101. At the completion of this calibration, the
    CAL bit in the Interrupt Status register and the INT pin   Alarm Operation
    asserts (if enabled).                                      The MAX35101 real-time clock provides one program-
●● During event timing operation, automatic calibrations       mable alarm. The alarm is activated when either the AM1
    can be performed before executing TOF or tempera-          or AM2 bits in the Real-Time Clock register are set. Based
    ture measurements. This is selectable with the CAL_        upon these bits, an alarm can occur when either the
    CFG[2:0] bits in the Event Timing 2 register. Upon         minutes and/or hours programmed in the Alarm register
    completion of an automatic calibration during event        match the current value in the Mins_Hrs register. When
    timing, the result is updated in the Calibration Results   an alarm occurs, the AF bit in the Interrupt Status register
    register, but the CAL bit in the Interrupt Status register is set and the INT device pin asserts (if enabled).
    is not set and the INT pin does not assert.
www.maximintegrated.com                                                                                Maxim Integrated │ 20


MAX35101                                             Time-to-Digital Converter with Analog Front-End
For proper alarm function, programming of the ALARM             host microprocessor to remain in a low-power sleep
register HOURS bits must match the format (12- or               mode, instead of requiring the microprocessor to keep
24-hour modes) used in the Mins_Hrs register.                   track of complex real-time events being performed by
                                                                the MAX35101. Upon completion of any command, the
Watchdog Operation
                                                                MAX35101 alerts the host microprocessor using the INT
The MAX35101 also contains a watchdog alarm. The                pin. The assertion of the INT pin can be used to awaken
Watchdog Alarm Counter register is a 16-bit BCD coun-           the host microprocessor from its low power mode. Upon
ter that is programmable in 10ms intervals from 0.01s to        receiving an interrupt on the INT pin, the host micropro-
99.99s. A seed value may be written to this register repre-     cessor should read the Interrupt Status Register to deter-
senting the start value for the countdown. The watchdog         mine which tasks were completed.
counter begins decrementing when the WD_EN bit in the
RTC register is set.                                            Interrupt Status Register
An immediate read of Watchdog Alarm Counter register            The interrupt status register contains flags for all for all
returns the value just written. A read after a wait dura-       commands and events that occur within the MAX35101.
tion causes a value seed minus wait to be returned. For         These flags are set when the event occurs or at the
example if the seed value was 28.01s, an immediate read         completion of the executing command. When the Interrupt
returns 28.01. A read after a 4s returns 24.01s. The value      Status Register is read, all asserted bits are cleared. If
read out for any read operation is a snapshot obtained at       another interrupt source has generated an interrupt dur-
the instant of a serial read operation.                         ing the read, these new flags assert following the read.
A write operation to the Watchdog Alarm Counter register        INT Pin
causes a reload with the newly written seed.                    The INT pin asserts when any of the bits in the Interrupt
When the watchdog is enabled and a nonzero value is             Status register are set. The INT pin remains asserted until
written into the Watchdog Alarm Counter register, the           the Interrupt Status register is read by the user and all bits
Watchdog Alarm Counter register decrements every                in this register are clear. In order for the INT pin to oper-
1/100s, until it reaches zero. At this point, the WF bit in the ate, it must first be enabled by setting the INT_EN bit in
Real-Time Clock register is set and the WDO pin asserts         the Calibration and Control register.
low for typically 250ms. At the end of the pulse, the WDO       Serial Peripheral Interface Operation
pin becomes high impedance.
                                                                Four pins are used for SPI-compatible communications:
The WF flag remains set until cleared by writing WF to          DOUT (serial-data out), DIN (serial-data in), CE (chip
a logic 0 in the Real-Time Clock register. If the WF bit        enable), and SCK (serial clock). DIN and DOUT are
is cleared while the WDO device pin is being held low,          the serial data input and output pins for the devices,
the WDO device pin is immediately released to its high-         respectively. The CE input initiates and terminates a data
impedance state. Writing a seed value of 0 does not             transfer. SCK synchronizes data movement between the
cause the WF bit to assert.                                     master (microcontroller) and the slave (MAX35101). The
Tamper Detect Operation                                         SCK, which is generated by the microcontroller, is active
                                                                only when CE is low and during opcode and data transfer
The MAX35101 provides a single input that can be con-
                                                                to any device on the SPI bus. The inactive clock polarity
nected to a device case switch and used for tamper
                                                                is logic-low. DIN is latched on the falling edge of SCK.
detection. Upon detection of a case switch event the
                                                                There is one clock for each bit transferred. Opcode bits
CSWA in the Control register and the CSWI bit in the
                                                                are transferred in groups of eight, MSB first. Data bits are
Interrupt Status register is set and the INT device pin is
                                                                transferred in groups of sixteen, MSB first.
asserted (if enabled).
                                                                The serial peripheral interface is used to access the fea-
Device Interrupt Operations                                     tures and memory of the MAX35101 using an opcode/
The MAX35101 is designed to optimize the power effi-            command structure.
ciency of a flow metering application by allowing the
www.maximintegrated.com                                                                                  Maxim Integrated │ 21


MAX35101                                         Time-to-Digital Converter with Analog Front-End
Opcode Commands                                          Execution Opcode Commands
Table 2 shows the opcode/commands that are supported     The device supports several single byte opcode com-
by the device.                                           mands that cause the MAX35101 to execute various
Table 2. Opcode Commands                                 routines. All commands have the same SPI protocol
                                                         sequence as shown in Figure 13. Once all 8 bits of the
                                OPCODE       ADDRESS     opcode are received by the MAX35101 and the CE device
   GROUP       COMMAND
                              FIELD (HEX)      FIELD     pin is deasserted, the MAX35101 begins execution of
             TOF_Up         00h            N/A           the specified command as described in that Command’s
                                                         description.
             TOF_Down       01h            N/A
             TOF_Diff       02h            N/A           TOF_UP Command (00h)
             Temperature    03h            N/A           The TOF_UP command generates a single TOF measure-
             Reset          04h            N/A
                                                         ment in the upstream direction. Pulses launch from the
                                                         LAUNCH_UP pin and are received by the STOP_UP pin.
             Initialize     05h            N/A           The measured hit results are reported in the HITxUPInt
             Transfer                                    and HITxUPFrac registers, with the calculated average
  Execution  configuration  06h            N/A           of all the measured hits being reported in the AVGUPInt
   Opcode    to flash                                    and AVGUPFrac register. The t1/t2 and t2/tideal wave
 Commands    EVTMG1         07h            N/A           ratios are reported in the WVRUP register. Once all these
                                                         results are stored, then the TOF bit in the Interrupt Status
             EVTMG2         08h            N/A
                                                         register is set and the INT pin asserts (if enabled).
             EVTMG3         09h            N/A
                                                         Note: The TOF_UP command yields a result that is only
             HALT           0Ah            N/A
                                                         of use when used in conjunction with the TOF_DN com-
             LDO_Timed      0Bh            N/A           mand. Absolute TOF measurements include circuit delays
             LDO_ON         0Ch            N/A           and cannot be considered accurate.
             LDO_OFF        0Dh            N/A
             Calibrate      0Eh            N/A
                                                          Figure 13         EXECUTION OPCODE COMMANDS
                            B0h through
                            FFh. Each
                            hex value                         CE
             Read register  represents the N/A
                            location of a
                            single 16-bit                                     0  1    2    3    4 5  6    7
   Register                 register.
   Opcode                                                    SCK
 Commands                   30h through
                            43h. Each
                            hex value                                        O                          O
                                                              DIN
             Write register represents the N/A                               MSB                       LSB
                                                                                         8 BITS
                            location of a
                            single 16-bit
                                                                                        OPCODE
                            register.
                                                            DOUT                   HIGH IMPEDANCE
                                           0000h - 1FFFh
             Read flash     90h            8 Kbytes Even
                                           Only          Figure 13. Execution Opcode Command Protocol
    Flash
                                           0000h - 1FFFh
   Opcode
             Write flash    10h            8 Kbytes Even
 Commands
                                           Only
             Block erase
                            13h            0000h - 1FFFh
             flash
www.maximintegrated.com                                                                           Maxim Integrated │ 22


MAX35101                                            Time-to-Digital Converter with Analog Front-End
TOF_Down Command (01h)                                       Configuration registers to be set to their prior programmed
The TOF_DOWN command generates a single TOF                  values stored in flash and all of the Results registers and
measurement in the downstream direction. Pulses launch       the Interrupt Status register to be cleared and set to zero.
from the LAUNCH_DN pin and are received by the               Initialize Command (05h)
STOP_DN pin. The measured hit results are reported in
                                                             The initialize command must be executed after all con-
the HITxDnInt and HITxDnFrac registers, with the calcu-
                                                             figuration of the device is complete. This initializes the
lated average of all the measured hits being reported in
                                                             time-to-digital converter so that TOF and temperature
the AVGDNInt and AVGDNFrac register. The t1/t2 and t2/
                                                             commands can be executed. The MAX35101 sets the
tideal wave ratios are reported in the WVRDN register.
                                                             INIT bit in the Interrupt Status register and asserts the
Once all these results are stored, then the TOF bit in the
                                                             INT device pin (if enabled) to tell the host microprocessor
Interrupt Status register is set and the INT pin asserts (if
                                                             that the initialize command has completed and the next
enabled).
                                                             desired command can be sent to the MAX35101.
Note: The TOF_Down command yields a result that is
only of use when used in conjunction with the TOF_UP         Transfer Configuration to
command. Absolute TOF measurements include circuit           Flash Command (06h)
delays and cannot be considered accurate.                    This command causes the Configuration register map
                                                             to be transferred to flash for nonvolatile (NV) storage.
TOF_DIFF Command (02h)                                       The MAX35101 automatically turns on the LDO for the
The TOF_DIFF command performs back-to-back TOF_              duration of this transfer. Upon device reset, the content
UP and TOF_DN measurements as required for a meter-          of this flash restores the Configuration registers. This
ing application. The TOF_UP sequence is followed by the      flash is not part of the 8KB array, and is reserved solely
TOF_DN sequence. The time between the start of the           for the transfer configuration to the flash command. The
TOF_UP measurement and the start of the TOF_DN mea-          MAX35101 sets the flash bit in the Interrupt Status regis-
surement is set by the TOF_CYC[2:0] bits in the TOF2         ter and asserts the INT device pin (if enabled) to tell the
register. Upon completion of the TOF_DN measurement,         host microprocessor that the transfer configuration to the
the results of AVGUP minus AVGDN is computed and             flash command has completed and the next command
stored at the TOF_DIFFInt and TOF_DIFFFrac Results           can be sent to the device.
register locations. Once these results are stored, then the
TOF bit in the Interrupt Status register is set and the INT  EVTMG1 Command (07h)
pin asserts (if enabled).                                    The EVTMG1 command initiates the event timing mode
                                                             1 advanced automatic measurement feature. This timing
Temperature Command (03h)                                    mode performs automatic TOF_DIFF and Temperature
The temperature command initiates a temperature mea-         measurements as described in the Event Timing
surement sequence as described in the Temperature            Operation section. The duration of the automatic mea-
Measurement Operations section. The characteristics the      surements depends upon the settings in the Event Timing
temperature measurement sequence depends upon the            1 register, Event Timing 2 register, CONT_INT and ET_
settings in the Event Timing 1 register, and Event Timing    CONT bits in the Calibration and Control register.
2 register. Once all the measurements are completed, the
times measured for each port are reported in the corre-      EVTMG2 Command (08h)
sponding TxInt and TxFrac Results registers. The TE bit      The EVTMG2 command initiates the event timing mode
in the Interrupt Status register also is set and the INT pin 2 advanced automatic measurement feature. This timing
asserts (if enabled).                                        mode performs automatic TOF_DIFF measurements as
                                                             described in the Event Timing Operation section. The
Reset Command (04h)                                          duration of the automatic measurements depends upon
The reset command essentially performs the same func-        the settings in the Event Timing 1 register, CONT_INT
tion as a power-on reset (POR), and causes all of the        and ET_CONT bits in the Calibration and Control register.
www.maximintegrated.com                                                                              Maxim Integrated │ 23


MAX35101                                              Time-to-Digital Converter with Analog Front-End
EVTMG3 Command (09h)                                          LDO_ON Command (0Ch)
The EVTMG3 command initiates the event timing mode            To access the flash memory, the internal low-dropout
3 advanced automatic measurement feature. This timing         voltage regulator that powers the flash circuitry must
mode performs automatic temperature measurements              be enabled. By sending the LDO_ON command to the
as described in the Event Timing Operation section. The       MAX35101 prior to the desired flash access command
duration of the automatic measurements depends upon           (read, write, block erase), the internal regulator is enabled
the settings in the Event Timing 1 register, Event timing 2   and powers the flash circuitry. The LDO bit is set in the
register, CONT_INT and ET_CONT bits in the Calibration        Interrupt Status register and the INT device pin asserts
and Control register.                                         (if enabled) when the internal regulator has been turned
                                                              on and is stable which takes approximately tSTABLE.
HALT Command (0Ah)                                            The host microprocessor, upon detection of the asserted
The HALT command is sent to the MAX35101 to stop any          INT device pin, should read the Interrupt Status register
of the three EVTMG1/2/3 commands. All register data           LDO bit to determine that the internal regulator is stable
content is frozen and the SPI is then made available for      and the flash is now ready to be accessed. The internal
access by the host microcontroller for commands, mem-         regulator remains enabled for a continuous period until
ory access, and register access. The HALT command             the LDO_OFF command is received by the MAX35101.
takes time to execute. Since the EVTMGx commands are          The LDO_ON command is generally used when the host
comprised of multiple TOF_DIFF and Temperature com-           microprocessor needs to perform multiple-word writes to
mands, the HALT command causes the MAX35101 to                the MAX35101 since multiple-word writes require that
evaluate its own state and complete the currently execut-     the CE device pin be toggled after every word of data
ing TOF_DIFF or temperature command. Once the HALT            written. The LDO_ON command prevents the LDO from
command has completed, all registers update and the           automatically disabling itself after each transition of the
MAX35101 sets the halt bit in the Interrupt Status regis-     CE device pin.
ter and then asserts the INT device pin (if enabled). The
host microprocessor reads the Interrupt Status register to    LDO_OFF Command (0Dh)
determine the interrupt source.                               To access the flash memory, the internal low-dropout
                                                              voltage regulator that powers the flash circuitry must
LDO_Timed Command (0Bh)                                       be enabled. By sending the LDO_OFF command to the
To access the flash memory, the internal low-dropout          MAX35101, the internal regulator is disabled and the
voltage regulator that powers the flash circuitry must be     Interrupt Status register LDO bit is cleared. The INT
enabled. By sending the LDO_Timed command to the              device pin is not asserted. The LDO_OFF command is
MAX35101 prior to the desired flash access command            used in conjunction with the LDO_ON command.
(read, write, block erase), the internal regulator is enabled
and powers the flash circuitry. The LDO bit is set in the     Calibrate Command (0Eh)
Interrupt Status register and the INT device pin asserts      The calibrate command performs the calibration routine
(if enabled) when the internal regulator has been turned      as described in the calibration operation section. When
on and is stable which takes approximately tSTABLE. The       the calibrate command has completed the measurement,
host microprocessor, upon detection of the asserted INT       the Calibration Results register contains the measured
device pin, should read the Interrupt Status register LDO     32kHz period measuremnt value, the MAX35101 sets
bit to determine that the internal regulator is stable and    the calibration bit in the Interrupt Status register and then
the flash is now ready to be accessed. The internal regu-     asserts the INT device pin (if enabled). The host micro-
lator remains enabled for a continuous period until the CE    processor reads the Interrupt Status register to determine
device pin is deasserted after any flash command (read,       the interrupt source and then read the Calibration Results
write, block erase). The LDO_Timed command is used in         register to be able to calculate the 4MHz ceramic oscilla-
place of the LDO_ON command when a data access to             tor gain factor.
the flash is required in a short burst. This minimizes SPI
access since the LDO_OFF command is not required to
be sent to the MAX35101 to turn off the internal regulator.
www.maximintegrated.com                                                                                Maxim Integrated │ 24


MAX35101                                             Time-to-Digital Converter with Analog Front-End
Register Opcode Commands                                            of the data register that is addressed in the opcode, and
To manipulate the register memory, there are two com-               continues with each SCK rising edge until the CE device
mands supported by the device: Read Register and Write              pin is deasserted as shown in Figure 15. The address
register. Each register accessed with these commands is             counter automatically increments.
16 bits in length. These commands are used to access                Write Register Command
all sections of the memory map including the RTC and
                                                                    This command applies to all writable registers. See the
Watchdog registers, Configuration registers, Conversion
                                                                    Register Memory Map for more detail. The SPI protocol
Results registers, and Status registers. The Conversion
                                                                    sequence is shown in Figure 16.
Results registers and the Interrupt Status register of the
Status registers are all read only.                                 The write register command can also be used to write
                                                                    consecutive addresses. In this case, the data bits are con-
Read Register Command                                               tinuously received on the DIN device pin and bound for
The opcode must be clocked into the DIN device pin                  the initial starting address register that is addressed in the
before the DOUT device pin produces the register data.              opcode. The address counter automatically increments
The SPI protocol sequence is shown in Figure 14.                    after each 16 bits of data if the SCK device pin is continu-
The read register command can also be used to read                  ally clocked and the CE device pin remain asserted as
consecutive addresses. In this case, the data bits are              shown in Figure 17.
continuously delivered in sequence starting with the MSB
    Figure 14
                                                  READ REGISTER COMMAND
            CE
                            0  1     2    3   4  5   6    7   8   9   10            19   20 21  22   23
           SCK
                           O                            O
            DIN
                           MSB         8 BITS          LSB
                                                                            DATA 16 BITS
                                       OPCODE
                                    HIGH IMPEDANCE           D   D   D   D         D    D   D  D    D      HIGH IMPEDANCE
                                                            MSB                                    LSB
          DOUT
Figure 14. Read Register Opcode Command Protocol
www.maximintegrated.com                                                                                       Maxim Integrated │ 25


MAX35101                                                     Time-to-Digital Converter with Analog Front-End
  Figure 15
                                                        CONTINUOUS READ REGISTER COMMAND
      CE
                    0  1    2   3    4   5   6   7    8   9  10          19    20 21 22 23 24 25 26 27            39 40 41 42    43
    SCK
                   O                            O
     DIN
                  MSB         8 BITS           LSB
                              OPCODE                               DATA 16 BITS                   DATA 16 BITS
                          HIGH IMPEDANCE             D   D   D   D       D    D   D  D   D   D  D   D   D        D   D   D     HIGH IMPEDANCE
   DOUT
                                                   MSB                                  LSB MSB                 LSB
Figure 15. Continuous Read Register Opcode Command Protocol
  Figure 16
                                                             WRITE REGISTER COMMAND
       CE
                          0      1     2     3     4     5     6      7    8      9   10              19     20    21   22   23
     SCK
                         O                                          O    D      D   D     D          D     D     D     D    D
      DIN
                         MSB                                     LSB MSB                                                   LSB
                                           8 BITS
                                           OPCODE                                          DATA 16 BITS
   DOUT                                                                    HIGH IMPEDANCE
Figure 16. Write Register Opcode Command Protocol
www.maximintegrated.com                                                                                                      Maxim Integrated │ 26


MAX35101                                              Time-to-Digital Converter with Analog Front-End
   Figure 17                                           CONTINUOUS WRITE REGISTER COMMAND
    CE
                    0  1   2   3    4 5  6    7   8   9   10            19  20  21  22   23   24   25   26   27   39
   SCK
                   O                        O   D   D    D   D        D    D   D   D    D   D    D    D    D     D   D  D
    DIN
                   MSB                     LSB MSB                                     LSB MSB                  LSB
                             8 BITS
                             OPCODE                           DATA 16 BITS                        DATA 16 BITS
  DOUT                                                          HIGH IMPEDANCE
Figure 17. Continuous Write Register Opcode Command Protocol
Register Memory Map                                                     The factory-stored flash configuration for TOF1 is 0010h.
These registers are accessed by the read register com-                  After a transfer to configuration to flash command, the
mand and the Write Register command: “X” represents a                   new user configuration data is recalled from flash after
reserved bit. Following a reset, all configuration variables            a reset.
are recalled from flash. The factory-stored flash default               The RTC register, Results registers, Interrupt Status, and
value for all configuration registers except TOF1 is 0000h.             Control registers are all 0000h following a reset.
www.maximintegrated.com                                                                                               Maxim Integrated │ 27


                            Table 3. Register Memory Map
                             READ         WRITE
                                                       NAME                                        BITS[15:8]                                                                   BITS[7:0]
                            OPCODE      OPCODE
                            RTC AND WATCHDOG REGISTERS                                                                                                                                                                      MAX35101
                               B0h         30h        Seconds          Tenths of Seconds                          Hundredth Seconds                         10 Seconds                            Seconds
                               B1h         31h        Mins_Hrs             10-Minutes                                  Minutes                          0   12hr   20hr/AM/PM         10hr               Hours
www.maximintegrated.com
                               B2h         32h        Day_Date                                          Day                                                   10-Date                                 Date
                                                       Month_
                               B3h         33h                              10-Month                                   Month                                  10-Year                                 Year
                                                         Year
                                                      Watchdog
                               B4h         34h          Alarm          Tenths of Seconds                      Hundredths of Seconds                         10 Seconds                            Seconds
                                                       Counter
                               B5h         35h          Alarm              10-Minutes                                  Minutes                          0   12hr   20hr/AM/PM         10hr            Alarm Hours
                            CONFIGURATION REGISTERS
                            These registers are restored from flash memory upon device reset. These registers are written to flash memory upon the issuance of the transfer configuration to flash command.
                               B6h         36h                                                                                               Reserved
                               B7h         37h                                                                                               Reserved
                                                                                                                                                                                       STOP
                               B8h         38h          TOF1         PL7      PL6       PL5      PL4      PL3          PL2       PL1    PL0       DPL3      DPL2    DPL1       DPL0               X          CT1     CT0
                                                                                                                                                                                        _POL
                                                                    STOP     STOP       STOP    T2WV      T2WV        T2WV       T2WV   T2WV                TOF_    TOF_       TOF_    EN_U      TIM          TIM    TIM
                               B9h         39h          TOF2                                                                                     T2WV0
                                                                      2         1        0        5           4         3         2      1                  CYC2    CYC1       CYC0    P_DN     OUT2         OUT1    OUT0
                                                                                        Hit1     Hit1     Hit1         Hit1      Hit1   Hit1                            Hit2   Hit2     Hit2     Hit2         Hit2   Hit2
                              BAh          3Ah          TOF3          X         X                                                                   X         X
                                                                                        WV5     WV4       WV3         WV2        WV1    WV0                             WV5    WV4      WV3      WV2         WV1     WV0
                                                                                        Hit3     Hit3     Hit3         Hit3      Hit3   Hit3                            Hit4   Hit4     Hit4     Hit4         Hit4   Hit4
                              BBh          3Bh          TOF4          X         X                                                                   X         X
                                                                                        WV5     WV4       WV3         WV2        WV1    WV0                             WV5    WV4      WV3      WV2         WV1     WV0
                                                                                        Hit5     Hit5     Hit5         Hit5      Hit5   Hit5                            Hit6   Hit6     Hit6     Hit6         Hit6   Hit6
                              BCh          3Ch          TOF5          X         X                                                                   X         X
                                                                                        WV5     WV4       WV3         WV2        WV1    WV0                             WV5    WV4      WV3      WV2         WV1     WV0
                                                                    C_OF     C_OF       C_OF    C_OF      C_OF        C_OF       C_OF   C_OF      C_OF      C_OF    C_OF       C_OF    C_OF     C_OF         C_OF    C_OF
                              BDh          3Dh          TOF6        FSET      FSET      FSET    FSET      FSET        FSET       FSET   FSET      FSET      FSET    FSET       FSET     FSET    FSET         FSET    FSET
                                                                    RUP7     RUP6       RUP5    RUP4      RUP3        RUP2       RUP1   RUP0       UP7      UP6         UP5    UP4      UP3      UP2         UP1     UP0
                                                                    C_OF     C_OF       C_OF    C_OF      C_OF        C_OF       C_OF   C_OF      C_OF      C_OF    C_OF       C_OF    C_OF     C_OF         C_OF    C_OF
                              BEh          3Eh          TOF7        FSET      FSET      FSET    FSET      FSET        FSET       FSET   FSET      FSET      FSET    FSET       FSET     FSET    FSET         FSET    FSET
                                                                    RDN7     RDN6       RDN5    RDN4      RDN3        RDN2       RDN1   RDN0       DN7      DN6         DN5    DN4      DN3      DN2         DN1     DN0
                                                        Event
                               BFh         3Fh                      TDF3      TDF2      TDF1    TDF0      TDM4        TDM3       TDM2   TDM1      TDM0      TMF5    TMF4       TMF3     TMF2    TMF1         TMF0     X
                                                       Timing 1
                                                                                                                                                                                                                            Time-to-Digital Converter with Analog Front-End
    Maxim Integrated │ 28


                            Table 3. Register Memory Map (continued)
                             READ     WRITE
                                                NAME                                     BITS[15:8]                                                BITS[7:0]
                            OPCODE   OPCODE
                                                Event                                                  Cal_    Cal_   Cal_   Cal_                 PREC   PREC     PREC     PORT     PORT
                              C0h      40h                  TMM4        TMM3    TMM2   TMM1    TMM0                                 TP1    TP0
                                               Timing 2                                                 Use    AUTO   CFG1   CFG0                 YC2     YC1     YC0      CYC1     CYC0
                                                                                                                                                                                             MAX35101
                                                 TOF
                              C1h      41h     Measure-     DLY15       DLY14   LY13   DLY12   DLY11   DLY10   DLY9   DLY8   DLY7   DLY6   DLY5   DLY4   DLY3     DLY2     DLY1     DLY0
www.maximintegrated.com
                                              ment Delay
                                              Calibration                                      CMP_    CMP_    INT_   ET_    CONT   CLK_   CLK_   CLK_   Cal_P    Cal_P    Cal_P    Cal_P
                              C2h      42h                    X          X       X      X
                                              and Control                                       EN     SEL     EN     CONT   _INT    S2     S1     S0    eriod3   eriod2   eriod1   eriod0
                                              Real-Time                                                                             32K_   32K_                                     WD_
                              C3h      43h                    X          X       X      X        X      X       X      X      X                   EOSC    AM2     AM1       WF
                                                Clock                                                                               BP     EN                                        EN
                            CONVERSION RESULTS REGISTERS
                                      Read
                              C4h                           WVRUP
                                       Only
                                      Read
                              C5h                           Hit1UpInt
                                       Only
                                      Read
                              C6h                           Hit1UpFrac
                                       Only
                                      Read
                              C7h                           Hit2UpInt
                                       Only
                                      Read
                              C8h                           Hit2UpFrac
                                       Only
                                      Read
                              C9h                           Hit3UpInt
                                       Only
                                      Read
                              CAh                           Hit3UpFrac
                                       Only
                                      Read
                              CBh                           Hit4UpInt
                                       Only
                                      Read
                              CCh                           Hit4UpFrac
                                       Only
                                      Read
                              CDh                           Hit5UpInt
                                       Only
                                      Read
                              CEh                           Hit5UpFrac
                                       Only
                                      Read
                              CFh                           Hit6UpInt
                                       Only
                                                                                                                                                                                             Time-to-Digital Converter with Analog Front-End
    Maxim Integrated │ 29


                            Table 3. Register Memory Map (continued)
                             READ    WRITE
                                              NAME                BITS[15:8]   BITS[7:0]
                            OPCODE   OPCODE
                                      Read
                              D0h                    Hit6UpFrac
                                      Only
                                                                                           MAX35101
                                      Read
                              D1h                    AVGUPInt
                                      Only
www.maximintegrated.com
                                      Read
                              D2h                    AVGUPFrac
                                      Only
                                      Read
                              D3h                    WVRDN
                                      Only
                                      Read
                              D4h                    Hit1DnInt
                                      Only
                                      Read
                              D5h                    Hit1DnFrac
                                      Only
                                      Read
                              D6h                    Hit2DnInt
                                      Only
                                      Read
                              D7h                    Hit2DnFrac
                                      Only
                                      Read
                              D8h                    Hit3DnInt
                                      Only
                                      Read
                              D9h                    Hit3DnFrac
                                      Only
                                      Read
                              DAh                    Hit4DnInt
                                      Only
                                      Read
                              DBh                    Hit4DnFrac
                                      Only
                                      Read
                             DCh                     Hit5DnInt
                                      Only
                                      Read
                             DDh                     Hit5DnFrac
                                      Only
                                      Read
                              DEh                    Hit6DnInt
                                      Only
                                      Read
                              DFh                    Hit6DnFrac
                                      Only
                                      Read
                              E0h                    AVGDNInt
                                      Only
                                                                                           Time-to-Digital Converter with Analog Front-End
    Maxim Integrated │ 30


                            Table 3. Register Memory Map (continued)
                             READ    WRITE
                                              NAME                      BITS[15:8]   BITS[7:0]
                            OPCODE   OPCODE
                                      Read
                              E1h                    AVGDNFrac
                                      Only
                                                                                                 MAX35101
                                      Read
                              E2h                    TOF_DIFFInt
                                      Only
www.maximintegrated.com
                                      Read
                              E3h                    TOF_DIFFFrac
                                      Only
                                      Read
                              E4h                    TOF_Cycle_Count
                                      Only
                                      Read
                              E5h                    TOF_DIFF_AVGInt
                                      Only
                                      Read
                              E6h                    TOF_DIFF_AVGFrac
                                      Only
                                      Read
                              E7h                    T1Int
                                      Only
                                      Read
                              E8h                    T1Frac
                                      Only
                                      Read
                              E9h                    T2Int
                                      Only
                                      Read
                              EAh                    T2Frac
                                      Only
                                      Read
                              EBh                    T3Int
                                      Only
                                      Read
                              ECh                    T3Frac
                                      Only
                                      Read
                              EDh                    T4Int
                                      Only
                                      Read
                              EEh                    T4Frac
                                      Only
                                      Read
                              EFh                    Temp_Cycle_Count
                                      Only
                                      Read
                              F0h                    T1_AVGInt
                                      Only
                                      Read
                              F1h                    T1_AVGFrac
                                      Only
                                                                                                 Time-to-Digital Converter with Analog Front-End
    Maxim Integrated │ 31


                            Table 3. Register Memory Map (continued)
                             READ    WRITE
                                               NAME                               BITS[15:8]                                               BITS[7:0]
                            OPCODE   OPCODE
                                      Read
                              F2h                          T2_AVGInt
                                      Only
                                                                                                                                                                      MAX35101
                                      Read
                              F3h                          T2_AVGFrac
                                      Only
www.maximintegrated.com
                                      Read
                              F4h                          T3_AVGInt
                                      Only
                                      Read
                              F5h                          T3_AVGFrac
                                      Only
                                      Read
                              F6h                          T4_AVGInt
                                      Only
                                      Read
                              F7h                          T4_AVGFrac
                                      Only
                                      Read
                              F8h                          CalibrationInt
                                      Only
                                      Read
                              F9h                          CalibrationFrac
                                      Only
                                      Read
                              FAh                          Reserved
                                      Only
                                      Read
                              FBh                          Reserved
                                      Only
                                      Read
                              FCh                          Reserved
                                      Only
                                      Read
                              FDh                          Reserved
                                      Only
                            STATUS REGISTERS
                                      Read     Interrupt                                             TOF_    TEMP_
                              FEh                           TO        AF     X   TOF     TE    LDO                   FLASH   CAL   HALT   CSWI   INIT   POR   X   X
                                      Only      Status                                               EVTMG   EVTMG
                                      Read
                              FFh              Control       X         X     X   X       X      X     AFA    CSWA     X      X      X      X       X     X    X   X
                                      Only
                                                                                                                                                                      Time-to-Digital Converter with Analog Front-End
    Maxim Integrated │ 32


MAX35101                                               Time-to-Digital Converter with Analog Front-End
RTC and Watchdog Register Descriptions
Table 4. RTC Seconds Register
         WRITE OPCODE                READ OPCODE                    FLASH STORED                DEFAULT VALUE
              30h                            B0h                         No                           0000h
 Bit             15             14              13              12          11         10             9               8
 Name                           Tenths of Seconds                                    Hundredths of Seconds
 Bit              7              6               5               4           3          2             1               0
 Name             0                        10 Seconds                                      Seconds
    BIT                NAME                                                  DESCRIPTION
  15:12         Tenths of Seconds         Range 0 to 9
   11:8       Hundredths of Seconds       Range 0 to 9
      7                  0                This bit always returns 0
     6:4             10 Second            Range 0 to 5
     3:0              Seconds             Range 0 to 9
Table 5. RTC Mins_Hrs Register
         WRITE OPCODE                 READ OPCODE                   FLASH STORED                DEFAULT VALUE
              31h                            B1h                         No                           0000h
 Bit             15            14              13               12          11         10             9               8
 Name             0                        10 Minutes                                      Minutes
 Bit              7             6               5                4          3           2             1               0
 Name             0           12/24      20HR/AM/PM           10HR                          Hours
    BIT             NAME                                                   DESCRIPTION
     15                0            This bit always returns 0
  14:12          10 Minutes         Range 0 to 5
   11:8             Minutes         Range 0 to 9
      7                0            This bit always returns 0
www.maximintegrated.com                                                                                 Maxim Integrated │ 33


MAX35101                                      Time-to-Digital Converter with Analog Front-End
Table 5. RTC Mins_Hrs Register (continued)
   BIT              NAME                                          DESCRIPTION
                             1 = 12-hour mode
     6              12/24
                             0 = 24-hour mode
                             In 12-hour mode
                             1 = PM
     5         20HR/AM/PM
                             0 = AM
                             In 24-hour mode: 20-hour digit
     4              10HR     Range 0 to 1
    3:0             Hours    Range 0 to 9
Table 6. RTC Day_Date Register
        WRITE OPCODE            READ OPCODE                 FLASH STORED           DEFAULT VALUE
             32h                      B2h                        No                    0000h
 Bit             15       14            13              12          11        10       9              8
 Name             0        0             0               0          0                 Day
 Bit              7        6             5               4          3          2       1              0
 Name             0        0                 10 Date                             Date
   BIT             NAME                                           DESCRIPTION
  15:11               0      These bits always return 0
   10:8              Day     Range 0 to 7
    7:6               0      These bits always return 0
    5:4           10 Date    Range 0 to 3
    3:0             Date     Range 0 to 9
www.maximintegrated.com                                                                 Maxim Integrated │ 34


MAX35101                                             Time-to-Digital Converter with Analog Front-End
Table 7. RTC Month_Year Register
         WRITE OPCODE                READ OPCODE                FLASH STORED                 DEFAULT VALUE
              33h                          B3h                       No                           0000h
 Bit             15            14            13              12         11          10             9              8
 Name             0             0             0          10 Month                        Month
 Bit              7             6             5               4          3           2             1              0
 Name                               10 Year                                               Year
    BIT             NAME                                               DESCRIPTION
  15:13                0           These bits always return 0
     12            10 Month        Range 0 to 1
   11:8              Month         Range 0 to 9
     7:4            10 Year        Range 0 to 9
     3:0              Year         Range 0 to 9
Table 8. Watchdog Alarm Counter Register
         WRITE OPCODE                READ OPCODE                FLASH STORED                 DEFAULT VALUE
              34h                          B4h                       No                            0000h
 Bit             15            14            13              12         11          10             9               8
 Name                          Tenths of Seconds                                  Hundredths of Seconds
 Bit              7             6             5               4          3           2              1              0
 Name                             10 Seconds                                            Seconds
    BIT                NAME                                               DESCRIPTION
  15:12         Tenths of Seconds        Range 0 to 9
   11:8       Hundredths of Seconds      Range 0 to 9
     7:4             10 Second           Range 0 to 9
     3:0              Seconds            Range 0 to 9
www.maximintegrated.com                                                                              Maxim Integrated │ 35


MAX35101                                          Time-to-Digital Converter with Analog Front-End
Table 9. Alarm Register
        WRITE OPCODE                READ OPCODE                  FLASH STORED              DEFAULT VALUE
             35h                          B5h                         No                        0000h
 Bit             15          14             13             12            11         10          9              8
 Name            X                       10 Minutes                                    Minutes
 Bit             7           6               5              4             3         2           1              0
 Name            X         12/24       20HR/AM/PM         10HR                          Hours
   BIT             NAME                                                DESCRIPTION
     15              X           Reserved
  14:12         10 Minutes       Range 0 to 5
   11:8           Minutes        Range 0 to 9
      7              X           Reserved
                                 1 = 12-hour mode
      6            12/24
                                 0 = 24-hour mode
                                 In 12-hour mode
                                 1 = PM
      5        20HR/AM/PM
                                 0 = AM
                                 In 24-hour mode: 20-hour digit
      4            10HR          Range 0 to 1
    3:0            Hours         Range 0 to 9
Configuration Register Descriptions
Table 10. TOF1 Register
        WRITE OPCODE               READ OPCODE                  FLASH STORED       FACTORY-STORED FLASH VALUE
             38h                          B8h                        Yes                       0010h
 Bit             15          14              13             12            11        10           9             8
 Name           PL7         PL6             PL5             PL4          PL3       PL2          PL1           PL0
 Bit              7           6              5               4             3         2           1             0
 Name           DPL3        DPL2           DPL1           DPL0        STOP_POL       X         CT1           CT0
www.maximintegrated.com                                                                          Maxim Integrated │ 36


MAX35101                                         Time-to-Digital Converter with Analog Front-End
Table 10. TOF1 Register (continued)
   BIT          NAME                                                   DESCRIPTION
                        Pulse Launcher Size: This is a hex value that defines the number of pulses that will be launched
                        from the pulse launcher during transmission. The range of this hex value is 00h to FFh. When
  15:8          PL[7:0]
                        PL[7:0] is set to 00h, the Pulse Launcher is disabled. Up to 127 pulses can be launched. When PL7
                        is set, the pulse count is clamped at 127.
                        Pulse Launch Divider: This is a hex value that defines the divider ratio of the internal clock signal
                        used to drive the Pulse Launch signal. The 4MHz external reference oscillator is used as the source
                        for the internal clock reference. The internal reference clock is first divided by 2 to produce a 2MHz
                        clock. The range of this hex value is 1h to Fh, resulting in a range of division from ÷2 to ÷16 of the
                        2MHz clock. A value of 0h is not supported and should not be programmed
                        Pulse Launch Frequency = 2MHz/(1+DPL[3:0])
                                               DPL[3:0]                                    PULSE LAUNCH FREQUENCY
   7:4         DPL[3:0]
                                                 0000b                                               RESERVED
                                                 0001b                                                   1MHz
                                                 0002b                                                  666kHz
                                                  ….                                                       ….
                                                 1110b                                                133.33kHz
                                                 1111b                                                  125kHz
                        Stop Polarity: This bit defines the edge sensitivity of the STOP_UP and STOP_DN channel. The
                        signal received on the STOP_UP and STOP_DN device pins will generate a stop condition for the
    3        STOP_POL   internal TDC time count on the rising slope of this signal if this bit is set to 0. The signal received on
                        the STOP_UP and STOP_DN device pins will generate a stop condition for the internal TDC time
                        count on the falling slope of this signal if this bit is set to 1.
    2              X    Reserved
                        Bias Charge Time: This is the time allotted for charging the external bias network on the STOP
                        pins to produce common mode biasing for the analog receiver/comparator. It is based upon the
                        32.768 KHz crystal:
                                                                                            DESCRIPTION
                                 CT1                  CT2               32kHz CLOCK CYCLES
   1:0          CT[1:0]                                                                                     TYPICAL TIME (µs)
                                                                                 (decimal)
                                   0                    0                              2                             61
                                   0                    1                              4                            122
                                   1                    0                              8                            244
                                   1                    1                             16                            488
www.maximintegrated.com                                                                                       Maxim Integrated │ 37


MAX35101                                          Time-to-Digital Converter with Analog Front-End
Table 11. TOF2 Register
        WRITE OPCODE               READ OPCODE                  FLASH STORED               FACTORY-STORED FLASH VALUE
             39h                        B9h                          Yes                                 0000h
 Bit             15           14             13              12             11              10             9             8
 Name         STOP2         STOP1         STOP0           T2WV5          T2WV4            T2WV3         T2WV2          T2WV1
 Bit              7            6              5               4             3                2             1             0
 Name         T2WV0        TOF_CYC2     TOF_CYC1        TOF_CYC0            X           TIMOUT2       TIMOUT1       TIMOUT0
   BIT             NAME                                                 DESCRIPTION
                                 Stop Hits: These bits set the number of stop hits to be expected and measured.
                                       STOP2                    STOP1                   STOP0               DESCRIPTION
                                          0                       0                        0                     1 Hit
                                          0                       0                        1                    2 Hits
                                          0                       1                        0                    3 Hits
  15:13          STOP[2:0]
                                          0                       1                        1                    4 Hits
                                          1                       0                        0                    5 Hits
                                          1                       0                        1                    6 Hits
                                          1                       1                        0                    6 Hits
                                          1                       1                        1                    6 Hits
                                 Wave Selector for t2: These bits determine the wave number for which t2 is measured. To
                                 ensure measurement accuracy, the first wave measurable after the early edge detect is wave
                                 2. Waves are numbered as depicted in Figure 5.
                                            T2WV[5:0] (decimal)                                 DESCRIPTION
   12:7          T2WV[5:0]
                                                 0 through 2                                        Wave 2
                                                      3                                             Wave 3
                                                      4                                             Wave 4
                                                5 through 63                                   Wave 5 through 63
www.maximintegrated.com                                                                                   Maxim Integrated │ 38


MAX35101                                       Time-to-Digital Converter with Analog Front-End
Table 11. TOF2 Register (continued)
                           TOF Duty Cycle: These bits determine the time delay between successive executions of
                           TOF measurements. It is the start-to-start time of automatic execution of the TOF_UP and the
                           TOF_DN and is applicable only for the TOF_DIFF command. It is based upon the 32.768kHz
                           crystal. If the actual TOF of the acoustic path exceeds the programmed start-to-start time in
                           this setting, then the TOF duty cycle performs as if the bit setting is 000b.
                                                                                   DESCRIPTION
                              TOF_CYC[2:0]             32kHz CLOCK
                                                                                                 4MHz ON BETWEEN TOF_
                                                           CYCLES            TYPICAL TIME
                                                                                                     UP and TOF_DOWN
                                                          (decimal)
   6:4        TOF_CYC[2:0]
                                    000b                       0                    0µs                       Yes
                                    001b                       4                  122µs                       Yes
                                    010b                       8                  244µs                       Yes
                                    011b                      16                  488µs                       Yes
                                    100b                      24                  732µs                       Yes
                                    101b                      32                  976µs                       Yes
                                    110b                     546                 16.65ms                      No
                                     111b                    655                 19.97ms                      No
    3                X     Reserved
                           Timeout: These bits force a timeout in the time-to-digital measurement block. If the hit
                           required to measure t1, t2, or Hit1 through Hit6 of the received signal does not occur in this
                           time, the TO bit in the Interrupt Status register is set and the INT pin is asserted (if enabled).
                           Additionally, any of the Conversion Results registers read FFFFh if the data for that register is
                           invalid.
                                 TIMOUT2                   TIMOUT1                   TIMOUT0             DESCRIPTION (µs)
                                       0                        0                        0                        128
   2:0         TIMOUT[2:0]             0                        0                        1                        256
                                       0                        1                        0                        512
                                       0                        1                        1                       1024
                                       1                        0                        0                       2048
                                       1                        0                        1                       4096
                                       1                        1                        0                       8192
                                       1                        1                        1                      16384
www.maximintegrated.com                                                                                   Maxim Integrated │ 39


MAX35101                                         Time-to-Digital Converter with Analog Front-End
Table 12. TOF3 Register
        WRITE OPCODE             READ OPCODE                   FLASH STORED               FACTORY-STORED FLASH VALUE
             3Ah                       BAh                             Yes                                0000h
 Bit             15         14             13               12               11            10              9              8
 Name            X          X          HIT1WV5           HIT1WV4        HIT1WV3         HIT1WV2        HIT1WV1       HIT1WV0
 Bit              7          6               5               4               3              2              1              0
 Name            X           X          HIT2WV5          HIT2WV4        HIT2WV3        HIT2WV2         HIT2WV1       HIT2WV0
    BIT             NAME                                                 DESCRIPTION
  15:14               X        Reserved
                               Hit1 Wave Select: These bits select the wave number for which the Hit1 stop time is
                               measured. Wave numbers are depicted in Figure 5. The Hit1 wave select value must be at
                               least 1 greater than the wave selected for t2, which is configured in the TOF2 register. For
                               example, if the wave selector for t2 is set to wave number 7, then the Hit1 wave select must be
                               set to delect wave number 8 or greater. The earliest wave for which Hit1 can be measured is
                               wave 3.
   13:8         HIT1WV[5:0]
                                           HIT1WV[5:0] (decimal)                                 DESCRIPTION
                                                  0 through 3                                         Wave 3
                                                       4                                              Wave 4
                                                       5                                              Wave 5
                                                 6 through 63                                  Wave 6 through 63
    7:6               X        Reserved
                               Hit2 Wave Select: These bits select the wave number for which the Hit2 stop time is
                               measured. Wave numbers are depicted in Figure 5. The Hit2 wave select value must be at
                               least 1 greater than the Hit1 wave select value. For example, if Hit1 wave select value is set to
                               measure wave number 9, then the Hit2 wave select must be set to detect wave number 10 or
                               greater. The earliest wave for which Hit2 can be measured is Wave 4.
    5:0         HIT2WV[5:0]                HIT2WV[5:0] (decimal)                                 DESCRIPTION
                                                  0 through 4                                         Wave 4
                                                       5                                              Wave 5
                                                       6                                              Wave 6
                                                 7 through 63                                  Wave 7 through 63
www.maximintegrated.com                                                                                    Maxim Integrated │ 40


MAX35101                                         Time-to-Digital Converter with Analog Front-End
Table 13. TOF4 Register
        WRITE OPCODE             READ OPCODE                   FLASH STORED              FACTORY-STORED FLASH VALUE
             3Bh                        BBh                           Yes                                0000h
 Bit             15         14              13              12             11             10              9              8
 Name             X         X           HIT3WV5         HIT3WV4        HIT3WV3        HIT3WV2         HIT3WV1        HIT3WV0
 Bit             7           6               5               4             3               2              1              0
 Name            X          X            HIT4WV5        HIT4WV4        HIT4WV3        HIT4WV2         HIT4WV1        HIT4WV0
   BIT             NAME                                                 DESCRIPTION
  15:14              X         Reserved
                               Hit3 Wave Select: These bits select the wave number for which the Hit3 stop time is
                               measured. Wave numbers are depicted in Figure 5. The Hit3 wave select value must be at
                               least 1 greater than the Hit2 wave select value. For example, if the Hit2 wave select value is
                               set to measure wave number 10, then the Hit3 wave select must be set to detect wave number
                               11 or greater. The earliest wave for which Hit3 can be measured is wave 5.
   13:8         HIT3WV[5:0]               HIT3WV[5:0] (decimal)                                  DESCRIPTION
                                                 0 through 5                                        Wave 5
                                                      6                                             Wave 6
                                                      7                                             Wave 7
                                                8 through 63                                  Wave 8 through 63
    7:6              X         Reserved
                               Hit4 Wave Select: These bits select the wave number for which the Hit4 stop time is
                               measured. Wave numbers are depicted in Figure 5. The Hit4 wave select value must be at
                               least 1 greater than the Hit3 wave select value. For example, if the Hit3 wave select value is
                               set to measure wave number 11, then the Hit4 wave select must be set to detect wave number
                               12 or greater. The earliest wave for which Hit4 can be measured is wave 6.
    5:0         HIT4WV[5:0]
                                          HIT4WV[5:0] (decimal)                                  DESCRIPTION
                                                 0 through 6                                        Wave 6
                                                      7                                             Wave 7
                                                      8                                             Wave 8
                                                9 through 63                                  Wave 9 through 63
www.maximintegrated.com                                                                                    Maxim Integrated │ 41


MAX35101                                         Time-to-Digital Converter with Analog Front-End
Table 14. TOF5 Register
        WRITE OPCODE             READ OPCODE                   FLASH STORED              FACTORY-STORED FLASH VALUE
             3Ch                        BCh                          Yes                                 0000h
 Bit             15         14              13              12             11             10              9              8
 Name             X         X           HIT5WV5          HIT5WV4       HIT5WV3        HIT5WV2         HIT5WV1        HIT5WV0
 Bit             7           6               5               4             3               2              1              0
 Name            X          X            HIT6WV5         HIT6WV4       HIT6WV3        HIT6WV2         HIT6WV1        HIT6WV0
   BIT             NAME                                                DESCRIPTION
  15:14              X         Reserved
                               Hit5 Wave Select: These bits select the wave number for which the Hit5 stop time is
                               measured. Wave numbers are depicted in Figure 5. The Hit5 wave select value must be at
                               least 1 greater than the Hit4 wave select value. For example, if the Hit4 wave select value is
                               set to measure wave number 12, then the Hit5 wave select must be set to detect wave number
                               13 or greater. The earliest wave for which Hit5 can be measured is wave 7.
   13:8         HIT5WV[5:0]               HIT5WV[5:0] (decimal)                                  DESCRIPTION
                                                 0 through 7                                        Wave 7
                                                       8                                            Wave 8
                                                       9                                            Wave 9
                                                10 through 63                                Wave 10 through 63
    7:6              X         Reserved
                               Hit6 Wave Select: These bits select the wave number for which the Hit6 stop time is
                               measured. Wave numbers are depicted in Figure 5. Hit6 wave select value must at least
                               1 greater than the Hit5 wave select value. For example, if Hit5 wave select value is set to
                               measure wave number 13, then the Hit6 wave select must be set to detect wave number 14 or
                               greater. The earliest wave for which Hit6 can be measured is wave 8.
    5:0         HIT6WV[5:0]
                                          HIT6WV[5:0] (decimal)                                  DESCRIPTION
                                                 0 through 8                                        Wave 8
                                                       9                                            Wave 9
                                                      10                                            Wave 10
                                                11 through 63                                 Wave 11 through 63
www.maximintegrated.com                                                                                    Maxim Integrated │ 42


MAX35101                                            Time-to-Digital Converter with Analog Front-End
Table 15. TOF6 Register
        WRITE OPCODE               READ OPCODE                     FLASH STORED                FACTORY-STORED FLASH VALUE
             3Dh                          BDh                             Yes                                  0000h
 Bit             15           14              13                12             11               10              9             8
             C_OFFSET     C_OFFSET        C_OFFSET          C_OFFSET        C_OFFSET        C_OFFSET        C_OFFSET      C_OFFSET
 Name
               UPR7         UPR6             UPR5             UPR4            UPR3            UPR2            UPR1          UPR0
 Bit             7             6               5                4              3                2               1             0
                          C_OFFSET         C_OFFSET        C_OFFSET        C_OFFSET        C_OFFSET         C_OFFSET      C_OFFSET
 Name            X
                             UP6              UP5              UP4            UP3              UP2             UP1           UP0
   BIT             NAME                                                     DESCRIPTION
                                 Comparator Return Offset Upstream: When the device is measuring the t2 wave, the
                                 programmed receive comparator offset is returned to a common-mode voltage automatically
                                 after the early edge, t1, is detected. The actual offset return voltage is dependent upon and
                                 scales with the voltage present at the VCC pins. The following formula defines the comparator
                                 return offset voltage setting, where C_OFFSETUPR is a two’s-complement number:
                                                                                      (1152+C_OFFSETUPR)
                                  Comparator Return Offset Voltage   =        VCC ×
             C_OFFSETUPR                                                                          3072
   15:8
                    [7:0]                            VCC
                                  where 1 LSB =
                                                     3072
                                              C_OFFSETUPR[7:0]                                       OFFSET (LSBs)
                                                 7Fh through 01h                                       127 through 1
                                                       00h                                                   0
                                                 80h through FFh                                      -128 through -1
     7                X          Reserved
www.maximintegrated.com                                                                                         Maxim Integrated │ 43


MAX35101                                           Time-to-Digital Converter with Analog Front-End
Table 15. TOF6 Register (continued)
     BIT           NAME                                                  DESCRIPTION
                                 Comparator Offset Upstream: These bits define an initial selected receive comparator offset
                                 voltage for the analog receiver comparator front-end. This comparator offset is used to detect
                                 the early edge wave, t1. The actual common-mode voltage is dependent upon and scales with
                                 the voltage present at the VCC pins.
                                 When the STOP_POL bit in the TOF1 register is set to zero indicating a rising edge detection of
                                 the zero crossing of the received acoustic wave, then the comparator offset is a positive value.
                                 When the STOP_POL bit in the TOF1 register is set to one indicating a falling edge detection of
                                 the zero crossing of the received acoustic wave, then the comparator offset is a negative value.
               C_OFFSETUP        The following formulas define the comparator offset voltage setting
     6:0
                    [6:0]                                                                             (1152 + C OFFSETUP )
                                     STOP_POL  =        0   Comparator Offset Voltage
                                                                                    =         VCC ×
                                                                                                               3072
                                                                                                     (1151- C OFFSETUP )
                                     STOP_POL  =        1  Comparator Offset Voltage=        VCC ×
                                                                                                              3072
                                                         VCC
                                     where 1 LSB =
                                                        3072
                                               C_OFFSETUP[6:0]                                   OFFSET (LSBs)
                                                 00h through 7Fh                                   0 through 127
Table 16. TOF7 Register
         WRITE OPCODE              READ OPCODE                   FLASH STORED              FACTORY-STORED FLASH VALUE
              3Eh                         BEh                          Yes                                 0000h
 Bit             15           14              13              12             11             10              9              8
             C_OFFSET     C_OFFSET       C_OFFSET         C_OFFSET      C_OFFSET        C_OFFSET        C_OFFSET     C_OFFSET
 Name
               DNR7         DNR6            DNR5            DNR4           DNR3           DNR2            DNR1           DNR0
 Bit             7             6               5              4              3               2              1              0
                          C_OFFSET        C_OFFSET        C_OFFSET     C_OFFSET        C_OFFSET         C_OFFSET     C_OFFSET
 Name            X
                             DN6              DN5            DN4           DN3             DN2             DN1            DN0
www.maximintegrated.com                                                                                     Maxim Integrated │ 44


MAX35101                                      Time-to-Digital Converter with Analog Front-End
Table 16. TOF7 Register (continued)
  BIT              NAME                                              DESCRIPTION
                          Comparator Return Offset Downstream: When the MAX35101 is measuring the t2 wave, the
                          programmed receive comparator offset is returned to a common-mode voltage automatically
                          after the early edge, t1, is detected. The actual offset return voltage is dependent upon and
                          scales with the voltage present at the VCC pins. The following formula defines the comparator
                          return offset voltage setting, where C_OFFSETDNR is a two’s-complement number:
                                                                                (1152+C_OFFSETDNR)
                           Comparator Return Offset Voltage   =        VCC ×
             C_OFFSETDNR                                                                    3072
  15:8
                    [7:0]                      VCC
                           where 1 LSB =
                                               3072
                                        C_OFFSETDNR[7:0]                                       OFFSET (LSBs)
                                          7Fh through 01h                                       127 through 1
                                                 00h                                                  0
                                          80h through FFh                                      -128 through -1
    7                 X   Reserved
                          Comparator Offset Downstream: These bits define an initial selected receive comparator
                          offset voltage for the analog receiver comparator front-end. This comparator offset is used to
                          detect the early edge wave, t1. The actual common-mode voltage is dependent upon and scales
                          with the voltage present at the VCC pins.
                          When the STOP_POL bit in the TOF1 register is set to zero indicating a rising edge detection of
                          the zero crossing of the received acoustic wave, then the comparator offset is a positive value.
                          When the STOP_POL bit in the TOF1 register is set to one indicating a falling edge detection of
                          the zero crossing of the received acoustic wave, then the comparator offset is a negative value.
              C_OFFSETDN  The following formulas define the comparator offset voltage setting:
   6:0
                    [6:0]                                                                          (1152 + C OFFSETDN )
                              STOP_POL  =         0    Comparator Offset Voltage =         VCC ×
                                                                                                           3072
                                                                                                  (1151- C OFFSETDN )
                              STOP_POL  =        1     Comparator Offset Voltage =        VCC ×
                                                                                                          3072
                                                   VCC
                              where 1 LSB =
                                                  3072
                                         C_OFFSETDN[6:0]                                       OFFSET (LSBs)
                                          00h through 7Fh                                       0 through 127
www.maximintegrated.com                                                                                  Maxim Integrated │ 45


MAX35101                                      Time-to-Digital Converter with Analog Front-End
Table 17. Event Timing 1 Register
         WRITE OPCODE           READ OPCODE                   FLASH STORED                FACTORY-STORED FLASH VALUE
              3Fh                    BFh                             Yes                                   0000h
 Bit             15       14              13              12                11             10               9             8
 Name           TDF3     TDF2           TDF1            TDF0             TDM4            TDM3            TDM2           TDM1
 Bit             7         6               5              4                3               2                1             0
 Name          TDM0      TMF5           TMF4            TMF3            TMF2             TMF1            TMF0             X
     BIT         NAME                                                DESCRIPTION
                          TOF Difference Measurement Frequency: These bits define the rate at which TOF_DIFF
                          measurements are executed when the EVTMG1 or EVTMG2 command is executed.
                          Rate = 0.5s + (TDF[3:0] x 0.5s)
                                         TDF[3:0] (decimal)                                          RATE
  15:12         TDF[3:0]                          0                                                   0.5 s
                                                  1                                                   1.0s
                                                ….                                                     ….
                                                 14                                                   7.5 s
                                                 15                                                   8.0 s
                          TOF Difference Measurements: These bits define the number of TOF_DIFF measurement cycles
                          to be executed when the EVTMG1 or EVTMG2 command is executed.
                          Cycles = 1+ TDM[4:0]
                                         TDM[4:0] (decimal)                                         CYCLES
    11:7        TDM[4:0]                           0                                                     1
                                                   1                                                     2
                                                 ….                                                     ….
                                                  30                                                    31
                                                  31                                                    32
                          Temperature Measurement Frequency: These bits define the time delay between temperature
                          cycle measurements. It is a start-cycle to start-cycle time duration at which temperature
                          measurement cycles are executed when the EVTMG1 or EVTMG3 command is executed.
                          Rate = 1.0s + (TMF[3:0] x 1.0s)
                                         TMF[5:0] (decimal)                                           RATE
     6:1        TMF[5:0]
                                                   0                                                    1s
                                                   1                                                    2s
                                                 ….                                                     ….
                                                  62                                                   63 s
                                                  63                                                   64 s
      0             X     Reserved
www.maximintegrated.com                                                                                     Maxim Integrated │ 46


MAX35101                                            Time-to-Digital Converter with Analog Front-End
Table 18. Event Timing 2 Register
         WRITE OPCODE              READ OPCODE                    FLASH STORED             FACTORY-STORED FLASH VALUE
              40h                         C0h                            Yes                              0000h
 Bit             15          14               13              12               11           10             9              8
 Name          TMM4        TMM3             TMM2            TMM1             TMM0        CAL_USE     CAL_CFG2       CAL_CFG1
 Bit             7            6                5              4                3            2              1              0
 Name        CAL_CFG0       TP1               TP0         PRECYC2         PRECYC1       PRECYC0      PORTCYC1 PORTCYC0
     BIT         NAME                                                    DESCRIPTION
                             Temperature Measurements: These bits define the number of temperature measurement cycles to
                             be executed when the EVTMG1 or EVTMG3 command is executed.
                             Cycles = 1+ TMM[4:0]
                                             TMM[4:0] (decimal)                                     CYCLES
  15:11         TMM[4:0]                               0                                                1
                                                       1                                                2
                                                      ….                                              ….
                                                      30                                               31
                                                      31                                               32
                             Calibration Usage: This bit, when set, causes the MAX35101 to use the calibration data in the
                             CalibrationInt and CalibrationFrac registers during measurement, averaging and accumulation
     10        CAL_USE
                             of data while executing the EVTMG commands. All time measurements are scaled using the
                             calibration factors as described by the calibrate command.
                             Calibration Configuration: These bits define the point in the EVTMGx cycle/sequence where the
                             automatic calibration command is executed.
                                                                                      DESCRIPTION
                                    CAL_CFG[2:0]              DURING EVTMGX SEQUENCES, AUTOMATIC EXECUTION OF
                                                                         THE CALIBRATE COMMAND OCCURS AT:
                                  000b through 011b         Autocalibration disabled
     9:7      CAL_CFG[2:0]                                  The beginning of each TOF_DIFF cycle
                                          100b
                                                            The beginning of each temperature cycle
                                                            The beginning of each TOF_DIFF cycle
                                          101b
                                                            The beginning of each temperature sequence
                                                            The beginning of each TOF_DIFF sequence
                                          110b
                                                            The beginning of each temperature cycle
                                                            The beginning of each TOF_DIFF sequence
                                          111b
                                                            The beginning of each temperature sequence
www.maximintegrated.com                                                                                    Maxim Integrated │ 47


MAX35101                                      Time-to-Digital Converter with Analog Front-End
Table 18. Event Timing 2 Register (continued)
  BIT            NAME                                               DESCRIPTION
                         Temperature Port: These bits set the number of temperature ports to stimulate during a
                         temperature measurement sequence and the sequence in which the temperature ports are
                         stimulated.
                             TP1            TP0                                    DESCRIPTION
   6:5          TP[1:0]
                               0             0        Measure ports T1 and T3
                               0             1        Measure ports T2 and T4
                               1             0        Measure ports T1, T3, and T2
                               1             1        Measure ports T1, T3, T2, and T4
                         Preamble Temperature Cycle: These 3 bits are used to set the number of cycles to use as
                         preamble for reducing dielectric absorption of the temperature measurement capacitor. Each cycle
                         comprises one temperature measurement sequence as defined by the TP[1:0] bits.
                                PRECYC2                   PRECYC1                    PRECYC0                DESCRIPTION
                                     0                        0                          0                   0 dummy cycle
                                     0                        0                          1                  1 dummy cycles
   4:2       PRECYC[2:0]
                                     0                        1                          0                  2 dummy cycles
                                     0                        1                          1                  3 dummy cycles
                                     1                        0                          0                  4 dummy cycles
                                     1                        0                          1                  5 dummy cycles
                                     1                        1                          0                  6 dummy cycles
                                     1                        1                          1                  7 dummy cycles
                         Port Cycle Time: These two bits define the time interval between successive individual
                         temperature port measurements. It is a start-to-start time. These bits also define the timeout
                         function of the temperature measurement ports. See the Temperature Operation section for timeout
                         details.
   1:0      PORTCYC[1:0]           PORTCYC1                           PORTCYC0                       DESCRIPTION (µs)
                                          0                                 0                                 128
                                          0                                 1                                 256
                                          1                                 0                                 384
                                          1                                 1                                 512
www.maximintegrated.com                                                                                   Maxim Integrated │ 48


MAX35101                                           Time-to-Digital Converter with Analog Front-End
Table 19. TOF Measurement Delay Register
         WRITE OPCODE              READ OPCODE                   FLASH STORED               FACTORY-STORED FLASH VALUE
              41h                        C1h                            Yes                                 0000h
 Bit             15         14                13              12              11             10               9              8
 Name          DLY15      DLY14            DLY13            DLY12           DLY11          DLY10           DLY9           DLY8
 Bit             7           6                 5              4               3              2                1              0
 Name          DLY7        DLY6             DLY5            DLY4            DLY3           DLY2            DLY1           DLY0
     BIT         NAME                                                   DESCRIPTION
                            This is hexadecimal value ranging from 0000h to FFFFh (decimal 0 to 65535). It is a multiple of the
                            4MHz crystal period (250ns). Settings less than 0012h are reserved and should not be used. The
                            analog comparator driven by the STOP_UP and STOP_DN device pins does not generate a stop
    15:0        DLY[15:0]
                            condition until this delay, counted from the internally generated start pulse for the acoustic wave,
                            has expired. This delay applies to early edge detect wave. Care must be taken to set the TIMOUT
                            bits in the TOF2 register so that a timeout interrupt does not occur before this delay expires.
Table 20. Calibration and Control Register
         WRITE OPCODE              READ OPCODE                    FLASH STORED              FACTORY-STORED FLASH VALUE
              42h                        C2h                            Yes                                  0000h
 Bit             15         14                13              12              11             10                9             8
 Name             X          X                 X               X           CMP_EN        CMP_SEL          INT_EN         ET_CONT
 Bit             7           6                 5              4               3               2                1             0
                                                                            CAL_           CAL_             CAL_           CAL_
 Name        CONT_INT     CLK_S2          CLK_S1           CLK_S0
                                                                         PERIOD3         PERIOD2         PERIOD1         PERIOD0
     BIT         NAME                                                   DESCRIPTION
  15:12             X       Reserved
                            Comparator/UP_DN Output Enable:
     11         CMP_EN      1 = CMP_OUT/UP_DN output device pin is enabled.
                            0 = CMP_OUT/UP_DN output device pin is driven low.
www.maximintegrated.com                                                                                        Maxim Integrated │ 49


MAX35101                                        Time-to-Digital Converter with Analog Front-End
Table 20. Calibration and Control Register (continued)
  BIT            NAME                                                DESCRIPTION
                         Comparator/UP_DN Output Select: This bit selects the output function of the CMP_OUT/UP_DN
                         pin and is only used when CMP_EN = 1.
                         1 = CMP_EN: The output monitors the receiver front end comparator output.
   10          CMP_SEL
                         0 = UP_DN: The output monitors the launch direction of the pulse launcher.
                           High Output: Upstream measurement (Launch_UP to STOP_UP)
                           Low Output: Downstream measurement (Launch_DN to STOP_DN)
                         Interrupt Enable: This bit, when set, enables the INT pin. All interrupt sources are wire-ORed to
    9           INT_EN
                         the INT pin.
                         Event Timing Continuous Operation: This bit, when set, causes the currently executing EVTMGx
                         command to continuously execute until the HALT command is received by the MAX35101.
                         This bit, when cleared, causes:
                               •    The currently executing EVTMG1 command to run one sequence of TOF_DIFF
    8          ET_CONT              measurement cycles and/or one sequence of temperature measurement.
                               •    The currently executing EVTMG2 command to run one sequence of TOF_DIFF
                                    measurements cycles.
                               •    The currently executing EVTMG3 command to run one sequence of temperature
                                    measurement cycles.
                         Continuous Interrupt: This bit, when set, causes the currently executing EVTMGx command to
                         assert the INT pin (if enabled) after every TOF_DIFF or temperature measurement cycle. This
                         allows the host microprocessor to interrogate the current event for accuracy of measurements and
    7          CONT_INT
                         hit data.
                         When this bit is cleared, the currently executing EVTMGx command interrupt generation behavior
                         is controlled only by the setting of the ET_CONT bit.
                         Clock Settling Time: These bits define the time interval that the MAX35101 waits after enabling
                         the 4MHz clock for it to stabilize before making any measurements of time or temperature.
                                                                                                DESCRIPTION
                              CLK_S2            CLK_S1             CLK_S0
                                                                                32kHz CLOCK CYCLES            TYPICAL TIME
                                 0                  0                 0                      16                   488µs
                                 0                  0                 1                      48                   1.46ms
   6:4        CLK_S[2:0]
                                 0                  1                 0                      96                   2.93ms
                                 0                  1                 1                     128                    3.9ms
                                 1                  0                 0                     168                   5.13ms
                                 1                  0                 1        4MHz oscillator on continuously
                                 1                  1                 0        4MHz oscillator on continuously
                                 1                  1                 1        4MHz oscillator on continuously
www.maximintegrated.com                                                                                  Maxim Integrated │ 50


MAX35101                                              Time-to-Digital Converter with Analog Front-End
Table 20. Calibration and Control Register (continued)
     BIT         NAME                                                         DESCRIPTION
                             4MHz Ceramic Oscillator Calibration Period: These bits define the number of 32.768kHz
                             oscillator periods to measure for determination of the 4MHz ceramic oscillator period.
                             32kHz clock cycles = 1+ CAL_PERIOD[3:0]
                                                                                           DESCRIPTION
                              CAL_PERIOD[3:0] (decimal)                  32kHz CLOCK CYCLES            32kHz CLOCK CYCLES
                                                                                 (decimal)                        (µs)
     3:0    CAL_PERIOD[3:0]
                                                0                                     1                           30.5
                                                1                                     2                            61
                                               ….                                    ….                            ….
                                               14                                    15                          457.7
                                               15                                    16                          488.0
Table 21. Real-Time Clock Register
         WRITE OPCODE              READ OPCODE                        FLASH-STORED           FACTORY-STORED FLASH VALUE
              43h                          C3h                                Yes                           0000h
 Bit             15          14                 13                12               11         10              9               8
 Name             X           X                  X                 X                X         X              X                X
 Bit             7            6                   5                4               3          2               1               0
 Name            X         32K_BP            32K_EN            EOSC              AM1        AM0             WF            WD_EN
     BIT         NAME                                                         DESCRIPTION
    15:7            X        Reserved
                             32kHz Bypass: This bit, when set, allows an external CMOS-level 32.768kHz signal to be applied
      6         32K_BP       to the 32KX1 device pin. The internal 32.768kHz oscillator is bypassed and the external signal is
                             driven into the MAX35101 core.
                             32kHz Clock Output Enable: This bit enables the 32KOUT device pin to drive a CMOS-level
      5         32K_EN
                             square wave representation of the 32kHz crystal.
                             Enable Oscillator: This active-low bit when set to logic 0 starts the real-time clock oscillator. When
      4          EOSC
                             this bit is set to logic 1, the oscillator is stopped.
www.maximintegrated.com                                                                                       Maxim Integrated │ 51


MAX35101                                                  Time-to-Digital Converter with Analog Front-End
Table 21. Real-Time Clock Register (continued)
   BIT            NAME                                                             DESCRIPTION
                                   Alarm Control: The MAX35101 contains a time-of-day alarm. The alarm is activated when either
                                   the AM1 or AM2 bits are set. When the RTC’s hours or minutes value increments to a value equal
                                   to the alarm settings in Alarm registers, the AF bit in the Interrupt Status register is set and the
                                   INT device pin is asserted (if enabled) and remains asserted until the Interrupt Status register is
                                   accessed by the microprocessor with a read register command.
    3:2           AM[1:0]                 AM1              AM0                                  ALARM FUNCTION
                                           0                  0         No alarm
                                           0                  1         Alarm when minutes match
                                           1                  0         Alarm when hours match
                                           1                  1         Alarm when hours and minutes match
                                   Watchdog Flag: This bit is set when the watchdog counter reaches zero. This bit must be written
      1              WF            to a zero to clear the bit. Writing this bit to a zero when the WDO pin is asserted low releases the
                                   WDO pin to its inactive high-impedance state.
                                   Watchdog Enable:
      0          WD_EN             1 = Watchdog timer is enabled.
                                   0 = Watchdog time is disabled, and the WDO pin is high impedance.
Status Register Descriptions
Table 22. Interrupt Status Register
        WRITE OPCODE                      READ OPCODE                     FLASH STORED                        DEFAULT VALUE
            Read Only                           FEh                                No                               0000h
 Bit               15               14              13                12                11           10               9               8
                                                                                                                   TOF_           TEMP_
 Name             TO               AF                X               TOF               TE           LDO
                                                                                                                  EVTMG           EVTMG
 Bit                7                6               5                 4                 3            2              1                0
 Name           FLASH              CAL             HALT              CSWI              INIT         POR              X               X
 Note: This register is read only and bits are self-clearing upon a read to this register. See the Device Interrupt Operations section
 for more information.
   BIT            NAME                                                             DESCRIPTION
                                    Timeout: The TO bit is set if any one of the t1, t2, Hit1 through Hit6, or temperature measure-
     15              TO
                                    ments do not occur within the associated timeout window.
                                    Alarm Flag: Set when the RTC’s hours or minutes value increments to a value equal to the alarm
     14              AF
                                    settings in Alarm registers.
     13               X             Reserved
www.maximintegrated.com                                                                                               Maxim Integrated │ 52


MAX35101                                     Time-to-Digital Converter with Analog Front-End
Table 22. Interrupt Status Register (continued)
  BIT            NAME                                                DESCRIPTION
                        Time of Flight: Set when the TOF_UP, TOF_DN, or TOF_DIFF command has completed.
                        During execution of The EVTMG1 or EVTMG2 command, this bit is set and the INT pin asserts
   12             TOF
                        (if enabled) upon completion of each of the cycles of the event defined by the TOF difference
                        measurements setting if the CONT_INT bit in the Calibration and Control register has been set.
                        Temperature: Set when the temperature command has completed. During execution of The
                        EVTMG1 or EVTMG3 command, this bit is set and the INT pin asserts (if enabled) upon
   11               TE
                        completion of each of the cycles of the event defined by the temperature measurements setting if
                        the CONT_INT bit in the Calibration and Control register has been set.
                        Internal LDO Stabilized: Set when the internal low-dropout regulator is turned on by either the
   10             LDO   LDO_Timed or LDO_ON and has stabilized. Once asserted, a flash command can be sent to the
                        MAX35101.
                        Event Timing TOF Completed: Set when either the EVTMG1 or EVTMG2 commands have
    9         TOF_EVTMG completed its last TOF_DIFF measurement cycle. This indicates that the data in the TOF_DIFF,
                        TOF_DIFF_AVG, AVGUP, and AVGDN Results registers is valid.
                        Event Timing Temperature Completed: Set when the EVTMG1 or EVTMG3 commands have
    8        TEMP_EVTMG completed its last temperature measurements. This indicates that the data in the T1, T2, T3, T4,
                        T1_AVG, T2AVG, T3AVG, and T4_AVG Results registers is valid.
                        Flash Ready: Set when the flash memory is ready to be accessed. During execution of any
                        command that requires write access to the flash memory (write flash, transfer configuration
    7            FLASH  to flash, block erase, initialize), the SPI port is inactive and should not be exercised. The host
                        microprocessor is interrupted by the assertion of the INT pin (if enabled) once the command has
                        been completed and the SPI of the MAX35101 is available for access.
                        Calibrate: Set after completion of the Calibrate command when the command is manually sent
                        by the host microprocessor. When calibration occurs as a result of the setting of the Cal_Use,
    6             CAL   Cal_AUTO and Cal_CFGx bits in the Event Timing 2 register and the MAX35101 is automatically
                        executing calibration commands as required during execution of any of the EVTMGx commands,
                        this bit is not set.
    5             HALT  HALT: Set when the HALT command has completed.
    4             CSWI  Case Switch: Set when a high logic level is detected on the CSW device pin.
    3              INIT Initialize: Set when the Initialize command has completed.
                        Power-On-Reset: Set when the MAX35101 has been successfully powered by application of
    2             POR
                        VCC. Upon application of power, the SPI port becomes inactive until this bit has been set.
   1:0              X   Reserved
www.maximintegrated.com                                                                                   Maxim Integrated │ 53


MAX35101                                       Time-to-Digital Converter with Analog Front-End
Table 23. Control Register
        WRITE OPCODE          READ OPCODE                   FLASH STORED                           DEFAULT VALUE
             FFh                     7Fh                            No                                   0000h
 Bit             15     14                13             12               11             10               9              8
 Name             X     X                 X              X                 X              X             AFA            CSWA
 Bit              7      6                 5              4                3              2               1              0
 Name             X      X                X               X                X              X              X               X
    BIT          NAME                                               DESCRIPTION
  15:10             X   Reserved
                        Alarm Flag Arm: This bit is set when the RTC’s hours and/or minutes value matched the alarm
                        settings in the RTC register. This bit is set at the same time as the AF bit in the Interrupt Status
     9            AFA
                        register. After resetting the RTC alarm settings, a 0 must be written to this bit to rearm the RTC
                        Alarm. This bit can only be written to a 0.
                        Case Switch Arm: This bit is set when the CSW pin detects a logic-high, indicating the
                        MAX35101 has detected a tamper condition. This bit is set at the same time as the CSWI bit in
     8           CSWA   the Interrupt Status register. Once set, this bit must be written to a 0 to rearm the case switch
                        detection. The case switch detection must be rearmed before the CSWI interrupt can be set
                        again. This bit can only be written to a 0.
    7:0             X   Reserved
www.maximintegrated.com                                                                                    Maxim Integrated │ 54


MAX35101                                              Time-to-Digital Converter with Analog Front-End
Conversion Results Register Descriptions
The devices conversion results registers are all read-only volatile SRAM. Values are not stored in the flash memory and
the POR value for all registers is 0000h.
Table 24. Conversion Results Registers Description
  READ ONLY
                     NAME                                                      DESCRIPTION
   ADDRESS
                                 Bit 15 through Bit 8 holds the 8-bit value of the pulse width ratio (t1 ÷ t2).for the upstream
                                 measurement. Each bit is weighted as follows:
                                  BIT 15        BIT 14      BIT 13        BIT 12       BIT 11      BIT 10          BIT 9           BIT 8
                                     1            0.5        0.25          0.125       0.0625     0.03125        0.015625       0.0078125
                                 Bit 7 thru bit 0 holds the 8-bit value of the pulse width ratio (t2 ÷ tideal) where tideal is equal to half
     C4h            WVRUP
                                 the period of the Pulse Launch Frequency for the upstream measurement. Each bit is weighted
                                 as follows:
                                   BIT 7        BIT 6       BIT 5          BIT 4        BIT 3       BIT 2          BIT 1           BIT 0
                                     1            0.5        0.25          0.125       0.0625      0.03125       0.015625       0.0078125
                                 The maximum value of each of these ratios is 1.9921875.
                                 15-bit fixed-point integer value of the first hit in the upstream direction. This integer portion is
     C5h           Hit1UPInt     a binary representation of the number of t4MHz periods that contribute to the time results. The
                                 maximum size of the integer is 7FFFh or (215 - 1) x t4MHz.
                                 16-bit fractional value of the first hit in the upstream direction. This fractional portion is a binary
     C6h          Hit1UPFrac     representation of one t4MHz period quantized to a 16-bit resolution. The maximum size of the
                                 fraction is FFFFh or (216 - 1)/216 x t4MHz.
                                 15-bit fixed-point integer value of the second hit in the upstream direction. This integer portion
     C7h           Hit2UPInt     is a binary representation of the number of t4MHz periods that contribute to the time results. The
                                 maximum size of the integer is 7FFFh or (215 - 1) x t4MHz.
                                 16-bit fractional value of the second hit in the upstream direction. This fractional portion is a
     C8h          Hit2UPFrac     binary representation of one t4MHz period quantized to a 16-bit resolution. The maximum size of
                                 the fraction is FFFFh or (216 - 1)/216 x t4MHz.
                                 15-bit fixed-point integer value of the third hit in the upstream direction. This integer portion is
     C9h           Hit3UPInt     a binary representation of the number of t4MHz periods that contribute to the time results. The
                                 maximum size of the integer is 7FFFh or (215 - 1) x t4MHz.
                                 16-bit fractional value of the third hit in the upstream direction. This fractional portion is a binary
     CAh          Hit3UPFrac     representation of one t4MHz period quantized to a 16-bit resolution. The maximum size of the
                                 fraction is FFFFh or (216 - 1)/216 x t4MHz.
                                 15-bit fixed-point integer value of the fourth hit in the upstream direction. This integer portion is
     CBh           Hit4UPInt     a binary representation of the number of t4MHz periods that contribute to the time results. The
                                 maximum size of the integer is 7FFFh or (215 - 1) x t4MHz.
                                 16-bit fractional value of the fourth hit in the upstream direction. This fractional portion is a binary
     CCh          Hit4UPFrac     representation of one t4MHz period quantized to a 16-bit resolution. The maximum size of the
                                 fraction is FFFFh or (216 - 1)/216 x t4MHz.
www.maximintegrated.com                                                                                              Maxim Integrated │ 55


MAX35101                                          Time-to-Digital Converter with Analog Front-End
Table 24. Conversion Results Registers Description (continued)
 READ ONLY
                     NAME                                                   DESCRIPTION
  ADDRESS
                             15-bit fixed-point integer value of the fifth hit in the upstream direction. This integer portion is
     CDh           Hit5UPInt a binary representation of the number of t4MHz periods that contribute to the time results. The
                             maximum size of the integer is 7FFFh or (215 - 1) x t4MHz.
                             16-bit fractional value of the fifth hit in the upstream direction. This fractional portion is a binary
     CEh          Hit5UPFrac representation of one t4MHz period quantized to a 16-bit resolution. The maximum size of the
                             fraction is FFFFh or (216 - 1)/216 x t4MHz.
                             15-bit fixed-point integer value of the sixth hit in the upstream direction. This integer portion is
     CFh           Hit6UPInt a binary representation of the number of t4MHz periods that contribute to the time results. The
                             maximum size of the integer is 7FFFh or (215 - 1) x t4MHz.
                             16-bit fractional value of the sixth hit in the upstream direction. This fractional portion is a binary
    D0Fh          Hit6UPFrac representation of one t4MHz period quantized to a 16-bit resolution. The maximum size of the
                             fraction is FFFFh or (216 - 1)/216 x t4MHz.
                             15-bit fixed-point integer value of the average of the hits recorded in the upstream direction This
     D1h           AVGUPInt  integer portion is a binary representation of the number of t4MHz periods that contribute to the
                             time results. The maximum size of the integer is 7FFFh or (215 - 1) x t4MHz.
                             16-bit fractional value of the average of the hits recorded in the upstream direction. This
     D2h          AVGUPFrac  fractional portion is a binary representation of one t4MHz period quantized to a 16-bit resolution.
                             The maximum size of the fraction is FFFFh or (216 - 1)/216 x t4MHz.
                             Bit 15 through Bit 8 holds the 8 bit value of the pulse width ratio (t1/t2).for the downstream
                             measurement. Each bit is weighted as follows:
                               BIT 15       BIT 14      BIT 13         BIT 12       BIT 11      BIT 10         BIT 9           BIT 8
                                 1            0.5        0.25           0.125       0.0625     0.03125       0.015625       0.0078125
                             Bit 7 thru bit 0 holds the 8 bit value of the pulse width ratio (t2/tideal) where tideal is equal to half
     D3h            WVRDN
                             the period of the pulse launch frequency for the downstream measurement. Each bit is weighted
                             as follows:
                               BIT 7        BIT 6       BIT 5           BIT 4        BIT 3       BIT 2         BIT 1           BIT 0
                                 1            0.5        0.25           0.125       0.0625     0.03125       0.015625       0.0078125
                             The maximum value of each of these ratios is 1.9921875.
                             15-bit fixed-point integer value of the first hit in the downstream direction. This integer portion is
     D4h           Hit1DNInt a binary representation of the number of t4MHz periods that contribute to the time results. The
                             maximum size of the integer is 7FFFh or (215 - 1) x t4MHz.
                             16-bit fractional value of the first hit in the downstream direction. This fractional portion is a
     D5h          Hit1DNFrac binary representation of one t4MHz period quantized to a 16-bit resolution. The maximum size of
                             the fraction is FFFFh or (216 - 1)/216 x t4MHz.
                             15-bit fixed-point integer value of the second hit in the downstream direction. This integer portion
     D6h           Hit2DNInt is a binary representation of the number of t4MHz periods that contribute to the time results. The
                             maximum size of the integer is 7FFFh or (215 - 1) x t4MHz.
www.maximintegrated.com                                                                                          Maxim Integrated │ 56


MAX35101                                          Time-to-Digital Converter with Analog Front-End
Table 24. Conversion Results Registers Description (continued)
 READ ONLY
                     NAME                                                   DESCRIPTION
  ADDRESS
                             16-bit fractional value of the second hit in the downstream direction. This fractional portion is a
     D7h          Hit2DNFrac binary representation of one t4MHz period quantized to a 16-bit resolution. The maximum size of
                             the fraction is FFFFh or (216 - 1)/216 x t4MHz.
                             15-bit fixed-point integer value of the third hit in the downstream direction. This integer portion
     D8h           Hit3DNInt is a binary representation of the number of t4MHz periods that contribute to the time results. The
                             maximum size of the integer is 7FFFh or (215 - 1) x t4MHz.
                             16-bit fractional value of the third hit in the downstream direction. This fractional portion is a
     D9h          Hit3DNFrac binary representation of one t4MHz period quantized to a 16-bit resolution. The maximum size of
                             the fraction is FFFFh or (216 - 1)/216 x t4MHz.
                             15-bit fixed-point integer value of the fourth hit in the downstream direction. This integer portion
     DAh           Hit4DNInt is a binary representation of the number of t4MHz periods that contribute to the time results. The
                             maximum size of the integer is 7FFFh or (215 - 1) x t4MHz.
                             16-bit fractional value of the fourth hit in the downstream direction. This fractional portion is a
     DBh          Hit4DNFrac binary representation of one t4MHz period quantized to a 16-bit resolution. The maximum size of
                             the fraction is FFFFh or (216 - 1)/216 x t4MHz.
                             15-bit fixed-point integer value of the fifth hit in the downstream direction. This integer portion is
     DCh           Hit5DNInt a binary representation of the number of t4MHz periods that contribute to the time results. The
                             maximum size of the integer is 7FFFh or (215 - 1) x t4MHz.
                             16-bit fractional value of the fifth hit in the downstream direction. This fractional portion is a
     DDh          Hit5DNFrac binary representation of one t4MHz period quantized to a 16-bit resolution. The maximum size of
                             the fraction is FFFFh or (216 - 1)/216 x t4MHz.
                             15-bit fixed-point integer value of the sixth hit in the downstream direction This integer portion is
     DEh           Hit6DNInt a binary representation of the number of t4MHz periods that contribute to the time results. The
                             maximum size of the integer is 7FFFh or (215 - 1) x t4MHz.
                             16-bit fractional value of the sixth hit in the downstream direction. This fractional portion is a
     DFh          Hit6DNFrac binary representation of one t4MHz period quantized to a 16-bit resolution. The maximum size of
                             the fraction is FFFFh or (216 - 1)/216 x t4MHz.
                             15-bit fixed-point integer value of the average of the hit times recorded in the downstream
     E0h           AVGDNInt  direction. This integer portion is a binary representation of the number of t4MHz periods that
                             contribute to the time results. The maximum size of the integer is 7FFFh or (215 – 1) x t4MHz.
                             16-bit fractional value of the average of the hit times recorded in the downstream direction. This
     E1h          AVGDNFrac  fractional portion is a binary representation of one period quantized to a 16-bit resolution. The
                             maximum size of the fraction is FFFFh or (216 – 1)/216 x t4MHz.
www.maximintegrated.com                                                                                        Maxim Integrated │ 57


MAX35101                                           Time-to-Digital Converter with Analog Front-End
Table 24. Conversion Results Registers Description (continued)
 READ ONLY
                     NAME                                                DESCRIPTION
  ADDRESS
                              16-bit fixed-point two’s-complement integer portion of the difference of the averages for the hits
                              recorded in both the upstream and downstream directions. It is computed as:
                                                                        AVGUP – AVGDN
     E2h          TOF_DIFFInt
                              This integer represents the number of t4MHz periods that contribute to computation. The
                              maximum size of the integer is 7FFFh or (215 – 1) x t4MHz. The minimum size of this integer is
                              8000h or -215 x t4MHz.
                              16-bit fractional portion of the two’s complement difference of the averages for the hits
                     TOF_     recorded in both the upstream and downstream directions. This fractional portion is a binary
     E3h
                    DIFFFrac  representation of one t4MHz period quantized to a 16-bit resolution. The maximum size of the
                              fraction is FFFFh or (216 - 1)/216 x t4MHz.
                              Bit 15 through bit 8 holds the 8-bit value of the TOF_Range. The TOF_Range is an 8-bit binary
                              integer that indicates the range of valid error-free TOF_DIFF measurements that were made
                              during execution of either of the EVTMG1 or EVTMG2 commands. The maximum value of
                              TOF_Range is equal to 2 times the actual pulse launch period as configured by the pulse launch
                              divider bits in the TOF1 register.
                                BIT 15        BIT 14       BIT 13      BIT 12       BIT 11        BIT 10       BIT 9         BIT 8
                                 MSB                              TOF_Range 8-bit binary integer                             LSB
                              The formulas to calculate the range and resolution of the TOF_Range integer for a given
                              DPL[3:0] bit setting are shown below:
                              Maximum range (µs) = DPL[3:0] + 1 Resolution = Maximum range/256
                                                                LAUNCH              MAXIMUM RANGE                RESOLUTION
                                      DPL[3:0]
                                                              FREQUENCY                     (µs)                       (ns)
                                        0001b                     1MHz                        2                       7.8175
                  TOF_Cycle_            0002b                   666.6kHz                      3                      11.7185
     E4h             Count               ….                         ….                       ….                         ….
                  /TOF_Range
                                        1110b                   133.3kHz                     15                     58.59375
                                        1111b                    125kHz                      16                        62.5
                              Bit 7 through bit 0 holds the 8-bit value of the TOF cycle count. The TOF cycle count is an 8-bit
                              binary integer that indicates the number of valid error-free cycles that either of the EVTMG1 or
                              EVTMG2 commands has executed. It also represents the number of TOF_DIFF cycles that have
                              been totaled for the purpose of averaging, which affects the results provided in the TOF_DIFF_
                              AVGFrac and TOF_DIFF_AVGInt registers. It is incremented every time an error-free TOF_DIFF
                              command is executed by either the EVTMG1 or EVTMG2 sequence. Because of this internal
                              error checking, once the complete number of cycles defined by the TOF difference masurements
                              bits in the Event Timing 1 register has been completed and the TOF_EVTMG bit has been set
                              in the Interrupt Status register causing the INT device pin to be asserted (if enabled), the TOF
                              Cycle Count may not be equal to the setting of the TOF difference measurements bits in the
                              Event Timing 1 register.
                                 BIT 7         BIT 6        BIT 5       BIT 4        BIT 3        BIT 2        BIT 1         BIT 0
                                 MSB                            TOF cycle count 8-bit binary integer                         LSB
www.maximintegrated.com                                                                                       Maxim Integrated │ 58


MAX35101                                         Time-to-Digital Converter with Analog Front-End
Table 24. Conversion Results Registers Description (continued)
 READ ONLY
                     NAME                                               DESCRIPTION
  ADDRESS
                            16-bit fixed-point two’s-complement integer portion of the average of the accumulated TOF_DIFF
                            measurements. It is computed as:
                                                               TOF_Cycle_Count
                                                               n=1             TOF_DIFFn
                  TOF_DIFF_
     E5h
                     AVGInt                                        TOF_Cycle_Count
                            This integer represents the number of t4MHz periods that contribute to the computation. The
                            maximum size of the integer is 7FFFh or (215 - 1) x t4MHz. The minimum size of this integer is
                            8000h or -215 x t4MHz.
                            16-bit fractional portion of the two’s-complement average of the accumulated TOF_DIFF
                  TOF_DIFF_
     E6h                    measurements. This fractional portion is a binary representation of one t4MHz period quantized
                    AVGFrac
                            to a 16-bit resolution. The maximum size of the fraction is FFFFh or (216 - 1)/216 x t4MHz.
                            15-bit fixed-point integer value of the time taken to discharge the timing capacitor through
                            the RTD connected to the T1 device pin. This integer portion is a binary representation of the
     E7h              T1Int
                            number of t4MHz periods that contribute to the time results. The maximum size of the integer is
                            7FFFh or (215 - 1) x t4MHz.
                            16-bit fractional value of the time taken to charge the timing capacitor through the RTD
                            connected to the T1 device pin. This fractional portion is a binary representation of one t4MHz
     E8h             T1Frac
                            period quantized to a 16-bit resolution. The maximum size of the fraction is FFFFh or (216 -
                            1)/216 x t4MHz.
                            15-bit fixed-point integer value of the time taken to charge the timing capacitor through the RTD
                            connected to the T2 device pin. This integer portion is a binary representation of the number of
     E9h              T2Int
                            periods that contribute to the time results. The maximum size of the integer is 7FFFh or
                            (215 - 1) x t4MHz.
                            16-bit fractional value of the time taken to charge the timing capacitor through the RTD
                            connected to the T2 device pin. This fractional portion is a binary representation of one t4MHz
     EAh             T2Frac
                            period quantized to a 16-bit resolution. The maximum size of the fraction is FFFFh or (216 -
                            1)/216 x t4MHz.
                            15-bit fixed-point integer value of the time taken to charge the timing capacitor through the RTD
                            connected to the T3 device pin. This integer portion is a binary representation of the number of
     EBh              T3Int
                            t4MHz periods that contribute to the time results. The maximum size of the integer is 7FFFh or
                            (215 - 1) x t4MHz.
                            16-bit fractional value of the time taken to charge the timing capacitor through the RTD
                            connected to the T3 device pin. This fractional portion is a binary representation of one t4MHz
     ECh             T3Frac
                            period quantized to a 16-bit resolution. The maximum size of the fraction is FFFFh or (216 -
                            1)/216 x t4MHz.
                            15-bit fixed-point integer value of the time taken to charge the timing capacitor through the RTD
                            connected to the T4 device pin. This integer portion is a binary representation of the number of
     EDh              T4Int
                            t4MHz periods that contribute to the time results. The maximum size of the integer is 7FFFh or
                            (215 - 1) x t4MHz.
www.maximintegrated.com                                                                                    Maxim Integrated │ 59


MAX35101                                          Time-to-Digital Converter with Analog Front-End
Table 24. Conversion Results Registers Description (continued)
 READ ONLY
                     NAME                                                DESCRIPTION
  ADDRESS
                             16-bit fractional value of the time taken to charge the timing capacitor through the RTD
                             connected to the T4 device pin. This fractional portion is a binary representation of one t4MHz
     EEh             T4Frac
                             period quantized to a 16-bit resolution. The maximum size of the fraction is FFFFh or (216 -
                             1)/216 x t4MHz.
                             The temp cycle count is an 8-bit binary integer that indicates the number of valid error-free
                             cycles that either of the EVTMG1 or EVTMG3 commands has executed. It also represents
                             the number of temperature cycles that have been totaled for the purpose of averaging, which
                             affects the results provided in the Tx_AVGFrac and Tx_AVGInt registers. It is incremented
                             every time an error-free temperature command is executed by either the EVTMG1 or EVTMG3
                             sequence. Because of this internal error checking, once the complete number of cycles defined
                             by the temperature measurements bits in the Event Timing 2 register has been completed and
                             the Temp_EVTMG bit has been set in the Interrupt Status register causing the INT device pin
                 Temp_Cycle_
     EFh                     to be asserted (if enabled), the temperature cycle count may not be equal to the setting of the
                     Count
                             temperature measurements bits in the Event Timing 2 register.
                               BIT 15        BIT 14       BIT 13       BIT 12          BIT 11  BIT 10        BIT 9       BIT 8
                                  X             X            X            X              X         X           X            X
                               BIT 7         BIT 6         BIT 5        BIT 4          BIT 3    BIT 2        BIT 1       BIT 0
                                MSB                 Temp Cycle Count                                                      LSB
                             15-bit fixed-point integer value of the average of the T1 port measurements. It is computed as:
                                                                   Temp_Cycle_Count
                                                                   n=1               T1n
     F0h           T1_AVGInt
                                                                 Temp_Cycle_Count
                             This integer portion is a binary representation of the number of t4MHz periods that contribute to
                             the time results. The maximum size of the integer is 7FFFh or (215 - 1) x t4MHz.
                             16-bit fractional portion of the average of the T1 port measurements. This fractional portion is a
     F1h          T1_AVGFrac binary representation of one t4MHz period quantized to a 16-bit resolution. The maximum size of
                             the fraction is FFFFh or (216 - 1)/216 x t4MHz.
                             15-bit fixed-point integer value of the average of the T2 port measurements. It is computed as:
                                                                    Temp_Cycle_Count
                                                                    n=1               T2n
     F2h           T2_AVGInt
                                                                  Temp_Cycle_Count
                             This integer portion is a binary representation of the number of t4MHz periods that contribute to
                             the time results. The maximum size of the integer is 7FFFh or (215 - 1) x t4MHz.
www.maximintegrated.com                                                                                     Maxim Integrated │ 60


MAX35101                                            Time-to-Digital Converter with Analog Front-End
Table 24. Conversion Results Registers Description (continued)
 READ ONLY
                     NAME                                                   DESCRIPTION
  ADDRESS
                               16-bit fractional portion of the average of the T2 port measurements. This fractional portion is a
     F3h          T2_AVGFrac   binary representation of one t4MHz period quantized to a 16-bit resolution. The maximum size of
                               the fraction is FFFFh or (216 - 1)/216 x t4MHz.
                               15-bit fixed-point integer value of the average of the T3 port measurements. It is computed as:
                                                                   Temp_Cycle_Count
                                                                   n=1              T3n
     F4h           T3_AVGInt
                                                                 Temp_Cycle_Count
                               This integer portion is a binary representation of the number of periods that contribute to the
                               time results. The maximum size of the integer is 7FFFh or (215 -1) x t4MHz.
                               16-bit fractional portion of the average of the T3 port measurements. This fractional portion is a
     F5h          T3_AVGFrac   binary representation of one t4MHz period quantized to a 16-bit resolution. The maximum size of
                               the fraction is FFFFh or (216 - 1)/216 x t4MHz.
                               15-bit fixed-point integer value of the average of the T4 port measurements. It is computed as:
                                                                   Temp_Cycle_Count
                                                                   n=1              T4n
     F6h           T4_AVGInt
                                                                 Temp_Cycle_Count
                               This integer portion is a binary representation of the number of t4MHz periods that contribute to
                               the time results. The maximum size of the integer is 7FFFh or (215 - 1) x t4MHz.
                               16-bit fractional portion of the average of the T4 port measurements. This fractional portion is a
     F7h          T4_AVGFrac   binary representation of one t4MHz period quantized to a 16-bit resolution. The maximum size of
                               the fraction is FFFFh or (216 - 1)/216 x t4MHz.
                               15-bit fixed-point integer value of the time taken to measure the period of the 32.768kHz
                   Calibration crystal oscillator during execution of the calibrate command. This integer portion is a binary
     F8h
                       Int     representation of the number of t4MHz periods that contribute to the time results. The maximum
                               size of the integer is 7FFFh or (215 - 1) x t4MHz.
                               16-bit fractional value of the time taken to measure the period of the 32.768kHz crystal oscillator
                   Calibration during execution of the calibrate command. This fractional portion is a binary representation of
     F9h
                      Frac     one t4MHz period quantized to a 16-bit resolution. The maximum size of the fraction is FFFFh or
                               (216 - 1)/216 x t4MHz.
     FAh                       Reserved
     FBh                       Reserved
     FCh                       Reserved
     FDh                       Reserved
www.maximintegrated.com                                                                                       Maxim Integrated │ 61


MAX35101                                              Time-to-Digital Converter with Analog Front-End
Flash Opcode Commands                                                Write Flash Command
To access the flash memory, the internal low-dropout                 The flash is written in the MAX35101 in a word-only man-
voltage regulator that powers the flash circuitry must               ner. The architecture allows a single 16-bit word to be
be enabled. This can be done two ways: sending the                   written to the array supporting the maximum access SPI
LDO_Timed command prior to the desired flash access or               clock speed of tSCK. The location to be programmed must
sending the LDO_ON command to the MAX35101 prior to                  have previously been erased with the block erase flash
desired flash access. See the LDO_Timed and LDO_ON                   command.
command descriptions for details. To manipulate the flash            To perform a write flash command, the starting flash
memory, there are three commands supported by the                    memory address must fall on an even flash memory
device: read flash, write flash, and block erase flash.              address (i.e., the least significant bit of the address (A15–
Read Flash Command                                                   A0) must be 0). The 16-bit address word and at least one
                                                                     16-bit word of data must be clocked into the device before
The read flash command is used to sequentially read                  the CE pin is deasserted. If more than 16 bits of data are
a continuous stream of data from the internal 8KB of                 clocked into the device during a single CE assertion, only
flash using a built-in autoincrement address counter. For            the last bounded 16-bit data word is written. This is not a
8KB, 13 address bits are needed to indicate the starting             FIFO register. Any fraction of a 16-bit word is ignored, and
address in memory to begin the read stream. Since the                the previous whole 16-bit word is written.
memory array is organized in X16 fashion, the starting
address must fall on any even number address. The read               Once the 16 bits of data are clocked into the device,
stream continues until the CE signal is deasserted. Once             the host microprocessor deasserts the CE device pin
the automatic internal address counter has been incre-               and then waits. The MAX35101 sets the flash bit in the
mented to the last memory location in the array, it wraps            Interrupt Status register and assert the INT device pin
around to the bottom of the memory array and the data                (if enabled) to tell the host microprocessor that the next
for the first memory location of the array is read. Figure 18        write flash command can be sent to the MAX35101.
illustrates the serial peripheral interface signaling associ-        The host microprocessor can then read the Interrupt
ated with the read flash command.                                    Status register after the INT device pin is asserted.
                                                                     Figure 19 illustrates the serial peripheral interface signal-
                                                                     ing associated with the write flash command.
                                                     READ FLASH COMMAND
     CE
    SCK
                  O                        O   A                          A
     DIN
                  MSB       8 BITS        LSB MSB        16 BITS        LSB
                            OPCODE                       ADDRESS                       DATA
                                       HIGH IMPEDANCE                        D  D   D   D   D  D  D    D   D  D     HIGH IMPEDANCE
   DOUT
                                                                            MSB                       LSB MSB
Figure 18. Read Flash Opcode Command Protocol
www.maximintegrated.com                                                                                        Maxim Integrated │ 62


MAX35101                                                     Time-to-Digital Converter with Analog Front-End
Block Erase Flash Command                                                        (if enabled) to tell the host microprocessor that the next
A block of 128 words (256 bytes) can be erased in a                              block erase flash command can be sent. The host micro-
single operation. For the 8KB array, there are 32 such                           processor can read the Interrupt Status register after the
128 word (256 Byte) blocks. The block to be erased is                            INT device pin is asserted instead of waiting for tERASE.
selected by the 16-bit address word in the block erase                           Flash Memory Map
flash SPI protocol sequence as illustrated in Figure 20.
                                                                                 This memory is accessed by the read flash, write flash,
The erased block is the block that contains the specified                        and the block erase flash commands. All flash memory
address. The time from CE deassert to CE assert for the                          is erased when the MAX35101 leaves the factory. This
next block erase flash command needs to be approxi-                              means that each flash location has a value of FFFFh until
mately tERASE. Also, the device sets the flash bit in the                        written by a user to a different value.
Interrupt Status register and asserts the INT device pin
                                                                     WRITE FLASH COMMAND
          CE
                         0    1 2   3    4    5   6    7     8   9    10        20   21 22    23   24 25 26          36 37 38   39
         SCK
                        O                            O     A                                 A    D                            D
          DIN
                        MSB        D7-D0            LSB    MSB         A15-A0 16 BITS      LSB    MSB          16 BITS        LSB
                                  OPCODE                                 ADDRESS                               DATA
        DOUT                                                       HIGH IMPEDANCE
Figure 19. Write Flash Opcode Command Protocol
                                                              BLOCK ERASE FLASH COMMAND
                            CE
                                            0   1   2    3     4   5    6    7    8   9  10        20 21 22    23
                           SCK
                            DIN            O                               O    A                             A
                                           MSB         8 BITS             LSB   MSB         16 BITS         LSB
                                                      OPCODE                                ADDRESS
                          DOUT                                         HIGH IMPEDANCE
Figure 20. Block Erase Flash Opcode Command Protocol
www.maximintegrated.com                                                                                                            Maxim Integrated │ 63


MAX35101                                                            Time-to-Digital Converter with Analog Front-End
Table 25. Flash Memory Map
     FLASH ADDRESS (evens only)                                         BLOCK (decimal)                                                  DESCRIPTION
             0000h to 00FFh                                                         0                                                          User flash
             0100h to 01FFh                                                         1                                                          User flash
             0200h to 02FFh                                                         2                                                          User flash
                    ….                                                              ….                                                         User flash
            1D00h to 1DFFh                                                          29                                                         User flash
            1E00h to 1EFFh                                                          30                                                         User flash
            1F00h to 1FFFh                                                          31                                                         User flash
Typical Application Circuit
                                                                                                                         GND GND GND GND GND                       3.6V
                                                                            CMP_OUT/UP_DN
                                                                                                                                                    CSW
                       STOP_UP
                                                                                                                                                            3.6V    3.6V
                                       ANALOG
                                                                                                                                    DATA AND
                                     SWITCHING                                  TIME-TO-DIGITAL             PROGRAMMABLE
                                                                                                                                     STATUS
                                      AND BIAS                                    CONVERTER                      ALU                                WDO
                                                                                                                                   REGISTERS
                      STOP_DN         CONTROL
                                                                                                                                                    INT
                     3.6V    VCC                                                                                                                    RST
                            VCC                                                             MAX35101
                            VCC                                                                                                                     SCK
                         BYPASS                      INTERNAL                8KB
                                                        LDO                 FLASH                                                                   DOUT
                   100nF
                   LOW ESR                                                                  STATE MACHINE                            4-WIRE         DIN
                                                                                             CONTROLLER                            INTERFACE
                    LAUNCH_UP                                                                                                                       CE
                                            PULSE                 CONFIGURATION
                    LAUNCH_DN             LAUNCHER                  REGISTERS
            PIEZOELECTRIC
            TRANSDUCERS
                                            HIGH-SPEED AND 32kHz OSCILLATORS
                                                                                                            TEMPERATURE MEASUREMENT
                                                  WITH REAL-TIME CLOCK
                                           X1        X2         32KX1       32KX0   32KOUT             T1           T2      T3     T4      TC
                                                                                                  PT 1000      PT 1000
                                             4MHz               32.768kHz
                                                                                                                                           1k (50ppm)
                                   12pF                12pF      12pF        12pF                                                          METAL FILM
                                                                                                                                               100 nF COG
                                                                                                                                               (NP0) (30ppm/C)
                                                                               MICROCONTROLLER
www.maximintegrated.com                                                                                                                              Maxim Integrated │ 64


MAX35101                                         Time-to-Digital Converter with Analog Front-End
Ordering Information                                     Package Information
      PART             TEMP RANGE        PIN-PACKAGE     For the latest package outline information and land patterns
                                                         (footprints), go to www.maximintegrated.com/packages. Note
 MAX35101EHJ+          -40°C to +85°C    32 TQFP-EP*
                                                         that a “+”, “#”, or “-” in the package code indicates RoHS status
 MAX35101EHJ+T         -40°C to +85°C    32 TQFP-EP*     only. Package drawings may show a different suffix character, but
+Denotes a lead(Pb)-free/RoHS-compliant package.         the drawing pertains to the package regardless of RoHS status.
T = Tape and reel.
                                                            PACKAGE          PACKAGE          OUTLINE           LAND
*EP = Exposed pad.
                                                               TYPE             CODE             NO.       PATTERN NO.
Chip Information                                           32 TQFP-EP          H32E+6         21-0079          90-0326
PROCESS: CMOS
www.maximintegrated.com                                                                              Maxim Integrated │ 65


MAX35101                                                           Time-to-Digital Converter with Analog Front-End
Revision History
   REVISION             REVISION                                                                                                                   PAGES
                                                                              DESCRIPTION
    NUMBER                 DATE                                                                                                                 CHANGED
          0                 2/14          Initial release                                                                                              —
          1                 1/15          Updated Benefits and Features section and Figure 12                                                       1, 19
For pricing, delivery, and ordering information, please contact Maxim Direct at 1-888-629-4642, or visit Maxim Integrated’s website at www.maximintegrated.com.
Maxim Integrated cannot assume responsibility for use of any circuitry other than circuitry entirely embodied in a Maxim Integrated product. No circuit patent licenses
are implied. Maxim Integrated reserves the right to change the circuitry and specifications without notice at any time. The parametric values (min and max limits)
shown in the Electrical Characteristics table are guaranteed. Other parametric values quoted in this data sheet are provided for guidance.
Maxim Integrated and the Maxim Integrated logo are trademarks of Maxim Integrated Products, Inc.                 © 2015 Maxim Integrated Products, Inc. │ 66


Mouser Electronics
Authorized Distributor
Click to View Pricing, Inventory, Delivery & Lifecycle Information:
Maxim Integrated:
 MAX35101EHJ+ MAX35101EHJ+T
