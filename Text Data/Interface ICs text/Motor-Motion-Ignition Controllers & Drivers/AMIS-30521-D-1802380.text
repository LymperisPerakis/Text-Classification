AMIS-30521, NCV70521
Micro-Stepping Motor Driver
Introduction
  The AMIS−30521/NCV70521 is a micro−stepping stepper motor
driver for bipolar stepper motors. The chip is connected through I/O
pins and a SPI interface with an external microcontroller. The
AMIS−30521/NCV70521 contains a current−translation table. It takes                                      www.onsemi.com
the next micro−step depending on the clock signal on the “NXT” input
pin and the status of the “DIR” (= direction) register or input pin. The                                            PINOUT
chip provides a so−called “Speed and Load Angle” output. This allows
the creation of stall detection algorithms and control loops based on                             VDD   DO           TSTO         VBB   MOTXP   MOTXP
load−angle to adjust torque and speed. It is using a proprietary PWM                              32    31    30     29      28   27    26      25
algorithm for reliable current control.
                                                                                       GND    1                                                         24 GND
  The AMIS−30521/NCV70521 is implemented in I 2 T100
                                                                                         DI   2                                                         23 GND
technology, enabling both high voltage analog circuitry and digital
                                                                                       CLK    3                                                         22 MOTXN
functionality on the same chip. The chip is fully compatible with the
                                                                                       NXT    4                                                         21 MOTXN
automotive voltage requirements.
  The 521 is ideally suited for general purpose stepper motor                           DIR   5                                                         20 MOTYN
                                                                                       ERR
applications in the automotive, industrial, medical and marine                                6                                                         19 MOTYN
environment. The AMIS−30521 is intended for use in industrial                          SLA    7                                                         18 GND
applications. The NCV70521 version is qualified for use in                                    8                                                         17 GND
automotive applications.                                                                          9     10    11     12      13   14    15      16
                                                                                                  CPN                CLR          VBB
                                                                                                                                        MOTYP
                                                                                                        CPP   VCP
                                                                                                                                                MOTYP
                                                                                                                             CS
Features
• Dual H−Bridge for 2 Phase Stepper Motors                                                                                                      PC20070309.2
• Programmable Peak−Current Up to 1.2 A Continuous (1.5 A Short
    Time), Using a 5−Bit Current DAC
                                                                                                  ORDERING INFORMATION
•   On−Chip Current Translator                                                      See detailed ordering and shipping information in the package
•   SPI Interface                                                                   dimensions section on page 26 of this data sheet.
•   Speed and Load−Angle Output
•   7 Step Modes from Full Step−up to 32 Micro−Steps
•   Fully Integrated Current−Sense
•   PWM Current Control with Automatic Selection of Fast and Slow
    Decay
•   Low EMC PWM with Selectable Voltage Slopes
•   Active Flyback Diodes
•   Full Output Protection and Diagnosis
•   Thermal Warning and Shutdown
•   Digital IO’s Compatible with 5 V and 3.3 V Microcontrollers
•   NCV Prefix for Automotive and Other Applications Requiring Site
    and Control Changes
•   These are Pb−Free Devices*
*For additional information on our Pb−Free strategy and soldering details, please
 download the ON Semiconductor Soldering and Mounting Techniques
 Reference Manual, SOLDERRM/D.
© Semiconductor Components Industries, LLC, 2009                       1                                                    Publication Order Number:
April, 2019 − Rev. 3                                                                                                                   AMIS−30521/D


                                                                        AMIS−30521, NCV70521
                          Table of Contents
                                                                                    Page
Introduction . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1
Features . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1
Block Diagram . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 3
Pin Description . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 3
Absolute Maximum Ratings . . . . . . . . . . . . . . . . . . . . . . . . . 4
Thermal Resistance . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 4
Equivalent Schematics . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 4
Package Thermal Characteristics . . . . . . . . . . . . . . . . . . . . 5
Electrical Specification . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 5
Recommended Operation Conditions . . . . . . . . . . . . . . . . 5
Typical Application Schematic . . . . . . . . . . . . . . . . . . . . . . 10
Functional Description . . . . . . . . . . . . . . . . . . . . . . . . . . . . 10
SPI Interface . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 19
Ordering Information . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 26
Package Outline . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 27
                                                                                   www.onsemi.com
                                                                                             2


                                                  AMIS−30521, NCV70521
                                                                VDD         CPN CPP VCP                VBB
                 CLK                            Timebase                       Charge Pump
                                                                 POR                      EMC                     MOTXP
                   CS
                                                                 OTP                                 PWM
                   DI             SPI
                                                                            TRANSLATOR
                                                                                         I−sense                  MOTXN
                   DO
                 NXT
                                                 Logic &
                                                Registers       Load                      EMC                     MOTYP
                 DIR                                            Angle
                 SLA                                                                                 PWM
                                                                Temp.                    I−sense                  MOTYN
                                                                Sense
                 CLR
                                                                Band−   AMIS−30521/NCV70521
                 ERR                                             gap
                         HV20081114.3            TST0                                                GND
                                        Figure 1. Block Diagram AMIS−30521/NCV70521
Table 1. PIN DESCRIPTION
 Name      Pin                                  Description                                        Type      Equivalent Schematic
 GND        1           Ground                                                             Supply
  DI        2           SPI Data In                                                        Digital Input            Type 2
 CLK        3           SPI Clock Input                                                    Digital Input            Type 2
 NXT        4           Next Micro−Step Input                                              Digital Input            Type 2
  DIR       5           Direction Input                                                    Digital Input            Type 2
 ERR        6           Error Output (Open Drain)                                          Digital Output           Type 4
  SLA       7           Speed Load Angle Output                                            Analog Output            Type 5
   /        8           No Function (to be Tied to Ground)
 CPN        9           Negative Connection of Charge Pump Capacitor                       High Voltage
 CPP       10           Positive Connection of Charge Pump Capacitor                       High Voltage
 VCP       11           Charge−Pump Filter−Capacitor                                       High Voltage
 CLR       12           “Clear” = Chip Reset Input                                         Digital Input            Type 1
  CS       13           SPI Chip Select Input                                              Digital Input            Type 2
 VBB       14           High Voltage Supply Input                                          Supply                   Type 3
MOTYP     15, 16        Positive End of Phase Y Coil Output                                Driver Output
 GND      17, 18        Ground                                                             Supply
MOTYN     19, 20        Negative End of Phase Y coil Output                                Driver Output
MOTXN     21, 22        Negative End of Phase X coil Output                                Driver Output
 GND      23, 24        Ground                                                             Supply
MOTXP     25, 26        Positive End of Phase X Coil Output                                Driver Output
 VBB       27           High Voltage Supply Input                                          Supply                   Type 3
   /       28           No Function (Has to be Left Open in Normal Condition)
 TST0      29           Test pin input (to be Tied to Ground in Normal Operation)          Digital Input
   /       30           No Function (to be Tied to Ground)
  DO       31           SPI Data Output (Open Drain)                                       Digital Output           Type 4
 VDD       32           Logic Supply Input (Needs External Decoupling Capacitor)           Supply                   Type 3
                                                            www.onsemi.com
                                                                  3


                                                       AMIS−30521, NCV70521
  Table 2. ABSOLUTE MAXIMUM RATINGS
         Symbol                                            Parameter                                   Min           Max           Unit
           VBB                Analog DC Supply Voltage (Note 1)                                        −0.3           +40            V
           VDD                Logic Supply Voltage                                                     −0.3          +7.0            V
            TST               Storage Temperature                                                       −55          +160           °C
             TJ               Junction Temperature (Note 2)                                             −50          +175           °C
          VESD                Electrostatic Discharges on Component Level, All Pins (Note 3)             −2           +2            kV
          VESD                Electrostatic Discharges on Component Level, HiV Pins (Note 4)             −8           +8            kV
Stresses exceeding those listed in the Maximum Ratings table may damage the device. If any of these limits are exceeded, device functionality
should not be assumed, damage may occur and reliability may be affected.
1. For limited time < 0.5s
2. Circuit functionality not guaranteed.
3. Human Body Model (100 pF via 1.5 kW, according to JEDEC EIA−JESD22−A114−B)
4. HiV = High Voltage Pins MOTxx, VBB, GND; Human Body Model (100 pF via 1.5 kW, according to JEDEC EIA−JESD22−A114−B)
  Table 3. THERMAL RESISTANCE
                                                                  Thermal Resistance
                                                                                            Junction−to−Ambient
       Package                        Junction−to−Exposed Pad                      1S0P Board                 2S2P Board             Unit
      NQFP−32                                     0.95                                  60                         30                K/W
                                                      EQUIVALENT SCHEMATICS
The following figure gives the equivalent schematics of the user relevant inputs and outputs. The diagrams are simplified
representations of the circuits used.
                                            4k
                 IN
                                                                                                                          OUT
                                      Rpd
                       TYPE 1: CLR Input                                                 TYPE 4: DO and ERR Open
                                                                                         Drain Outputs
                                    4k                                                                  Rout
                 IN
                                                                                                                          SLA
                       TYPE 2: CLK, DI, CS, NXT, DIR Inputs                              TYPE 5: SLA Analog Output
                                     VDD                             VBB
              VDD                                  VBB
                       TYPE 3: VDD and VBB Power Supply Inputs
                                             Figure 2. In− and Output Equivalent Diagrams
                                                             www.onsemi.com
                                                                     4


                                                   AMIS−30521, NCV70521
                                       PACKAGE THERMAL CHARACTERISTICS
   The AMIS−30521/NCV70521 is available in an                         The Rthja for 2S2P is simulated conform JEDEC JESD−51
NQFP−32 package. For cooling optimizations, the NQFP                as follows:
has an exposed thermal pad which has to be soldered to the          • A 4−layer printed circuit board with inner power planes
PCB ground plane. The ground plane needs thermal vias to               and outer (top and bottom) signal layers is used
conduct the heat to the bottom layer. Figure 3 gives an             • Board thickness is 1.46 mm (FR4 PCB material)
example for good power distribution solutions.
                                                                    • The 2 signal layers: 70 mm thick copper with an area of
   For precise thermal cooling calculations the major
                                                                       5500 mm2 copper and 20% conductivity
thermal resistances of the device are given. The thermal
media to which the power of the devices has to be given are:        • The 2 power internal planes: 36 mm thick copper with
• Static environmental air (via the case)                              an area of 5500 mm2 copper and 90% conductivity
• PCB board copper area (via the exposed pad)                       The Rthja for 1S0P is simulated conform JEDEC JESD−51
   The thermal resistances are presented in Table 5: DC             as follows:
Parameters.                                                         • A 1−layer printed circuit board with only 1 layer
   The major thermal resistances of the device are the Rth          • Board thickness is 1.46 mm (FR4 PCB material)
from the junction to the ambient (Rthja) and the overall Rth        • The layer has a thickness of 70 mm copper with an area
from the junction to exposed pad (Rthjp). In Table 3 one can           of 5500 mm2 copper and 20% conductivity
find the values for the Rthja simulated according to
                         ÎÎÎÎÎÎÎÎÎÎÎÎÎÎÎÎÎÎÎ
JESD−51.
                         ÎÎÎÎÎÎÎÎÎÎÎÎÎÎÎÎÎÎÎ
                         ÎÎÎÎÎÎÎÎÎÎÎÎÎÎÎÎÎÎÎ
                         ÎÎÎÎÎÎÎÎÎÎÎÎÎÎÎÎÎÎÎ
                         ÎÎÎÎÎÎÎÎÎÎÎÎÎÎÎÎÎÎÎ     ÎÎÎÎÎÎÎÎÎÎ
                         ÎÎÎÎÎÎÎÎÎÎÎÎÎÎÎÎÎÎÎ     ÎÎÎÎÎÎÎÎÎÎ
                                                 ÎÎÎÎÎÎÎÎÎÎ
                                                              NQFP−32
                         ÎÎÎÎÎÎÎÎÎÎÎÎÎÎÎÎÎÎÎ
                         ÎÎÎÎÎÎÎÎÎÎÎÎÎÎÎÎÎÎÎ     ÎÎÎÎÎÎÎÎÎÎ
                         ÎÎÎÎÎÎÎÎÎÎÎÎÎÎÎÎÎÎÎ
     Figure 3. Example of NQFP−32 PCB Ground Plane Layout in Top View (Preferred Layout at Top and Bottom)
                                                  ELECTRICAL SPECIFICATION
Recommended Operation Conditions                                    ranges is not guaranteed. Operating outside the
   Operating ranges define the limits for functional                recommended operating ranges for extended periods of time
operation and parametric characteristics of the device. Note        may affect device reliability.
that the functionality of the chip outside these operating
  Table 4. OPERATING RANGES
     Symbol                                    Parameter                               Min             Max            Unit
       VBB        Analog DC supply                                                      +6             +30              V
       VDD        Logic supply voltage                                                 4.75            5.25             V
        TJ        Junction temperature                                                 −40         +172 (Note 5)       °C
  5. No more than 100 cumulative hours in life time above Ttw
                                                          www.onsemi.com
                                                                 5


                                                      AMIS−30521, NCV70521
Table 5. DC PARAMETERS
(DC Parameters are Given for VBB and Temperature in Their Operating Ranges Unless Otherwise Specified)
Convention: Currents Flowing in the Circuit are Defined as Positive
   Symbol          Pin(s)                    Parameter                   Remark/Test Conditions        Min        Typ       Max      Unit
SUPPLY INPUTS
       VBB                    Nominal Operating Supply Range                                            6                    30       V
       IBB          VBB       Total Current Consumption                 Unloaded Outputs                                      8      mA
      IBBS                    Sleep Current in VBB (Note 7)             Unloaded Outputs                                     100      mA
      VDD                     Logic Supply Voltage                                                     4.75        5        5.25      V
      IDDD          VDD       Dynamic Current (Note 6)                                                            7.5        10      mA
      IDDS                    Sleep Current in VDD (Note 7)                                                                  100      mA
POWER ON RESET (POR) (Note 10)
     VDDH                     Internal POR Comparator Threshold         VDD Rising                     3.85      4.20       4.55      V
     VDDL           VDD       Internal POR Comparator Threshold         VDD Falling                              3.85                 V
    VDDHYS                    Hysteresis Between VDDH and VDDL                                         0.10      0.35       0.60      V
MOTOR DRIVER
 IMDmax,Peak                  Max Peak Current Through Motor Coil      TJ = −40°C                                1600                mA
    IMDabs                    Absolute Error on Coil Current            TJ = 125°C                     −10                   10       %
     IMDrel                   Error On Current Ratio Icoilx/Icoily                                      −7                    7       %
                              Temperature Coefficient of Coil Current
   ISET_TC1                                                             TJ v 160°C                               −240               ppm/K
                              Set−Level, CUR[4:0] = 0...27
                              Temperature Coefficient of Coil Current
   ISET_TC2                                                             TJ v 160°C                               −490               ppm/K
                              Set−Level, CUR[4:0] = 28...31
                              On−Resistance High−Side Driver,           VBB = 12 V, TJ = 27°C                    0.45       0.56      W
      RHS
                  MOTXP       (Note 9) CUR[4:0] = 0...31                VBB = 12 V, TJ = 160°C                   0.94       1.25      W
                  MOTXN
                  MOTYP       On−Resistance Low−Side Driver,            VBB = 12 V, TJ = 27°C                    0.45       0.56      W
     RLS3         MOTYN       (Note 9) CUR[4:0] = 23...31               VBB = 12 V, TJ = 160°C                   0.94       1.25      W
                              On−Resistance Low−Side Driver,            VBB = 12 V, TJ = 27°C                    0.90        1.2      W
     RLS2
                              (Note 9) CUR[4:0] = 16...22               VBB = 12 V, TJ = 160°C                    1.9        2.5      W
                              On−Resistance Low−Side Driver,            VBB = 12 V, TJ = 27°C                     1.8        2.3      W
     RLS1
                              (Note 9) CUR[4:0] = 9...15                VBB = 12 V, TJ = 160°C                    3.8        5.0      W
                              On−Resistance Low−Side Driver,            VBB = 12 V, TJ = 27°C                     3.6        4.5      W
     RLS0
                              (Note 9) CUR[4:0] = 0...8                 VBB = 12 V, TJ = 160°C                    7.5        10       W
      IMpd                    Pulldown Current                          HiZ Mode                                   1                 mA
DIGITAL INPUTS
      Ileak                   Input Leakage (Note 8)                    TJ = 160°C                                           0.5      mA
                  DI, CLK
       VIL       NXT, DIR     Logic Low Threshold                                                       0                   0.75      V
                 CLR, CS
       VIH                    Logic High Threshold                                                     2.20                 VDD       V
   Rpd_CLR          CLR       Internal Pulldown Resistor                                               120                   280     kW
   Rpd_TST         TST0       Internal Pulldown Resistor                                                3                     8      kW
6. Current with oscillator running, all analogue cells active, SPI communication and NXT pulses applied. No floating inputs. Guaranteed by
    design.
7. Current with all analogue cells in power down. Logic is powered but no clocks running. All outputs unloaded, no inputs floating.
8. Not valid for pins with internal Pulldown resistor
9. Characterization Data Only
10. POR is derived from VDD. For proper POR operation VBB needs to be minimal VBB_min.
                                                              www.onsemi.com
                                                                      6


                                                   AMIS−30521, NCV70521
Table 5. DC PARAMETERS
(DC Parameters are Given for VBB and Temperature in Their Operating Ranges Unless Otherwise Specified)
Convention: Currents Flowing in the Circuit are Defined as Positive
   Symbol        Pin(s)                   Parameter                     Remark/Test Conditions  Min      Typ     Max  Unit
DIGITAL OUTPUTS
     VOL        DO, ERR     Logic Low Level Open Drain                IOL = 5 mA                                 0.30   V
THERMAL WARNING AND SHUTDOWN
      Ttw                   Thermal Warning                                                     138      145     152   °C
     Ttsd
                            Thermal Shutdown                                                           Ttw + 20        °C
(Notes 11, 12)
CHARGE PUMP
                                                                                                       2 * VBB
                                                                      6 V v VBB v 14 V
                                                                                                        − 2.5
      Vcp                   Output Voltage                                                                              V
                  VCP                                                                          VBB +            VBB +
                                                                      14 V < VBB v 30 V
                                                                                                10                15
    Cbuffer                 External Buffer Capacitor                                           180      220     470   nF
    Cpump      CPP CPN      External Pump Capacitor                                             180      220     470   nF
PACKAGE THERMAL RESISTANCE VALUES
                            Thermal Resistance                        Simulated Conform JEDEC
     Rthja                                                                                                30          K/W
                            Junction−to−Ambient                       JESD−51, (2S2P)
                 NQFP
                            Thermal Resistance
     Rthjp                                                                                               0.95         K/W
                            Junction−to−Exposed Pad
SPEED AND LOAD ANGLE OUTPUT
                                                                                                                VDD −
     Vout                   Output Voltage Range                                                0.2                     V
                                                                                                                 0.2
                                                                      SLAG = 0                  −50               50  mV
      Voff                  Output Offset SLA Pin
                                                                      SLAG = 1                  −30               30  mV
                  SLA                                                                                     0.5
                                                                     SLAG = 0
     Gsla                   Gain of SLA Pin = VBEMF / VCOIL
                                                                     SLAG = 1                            0.25
     Rout                   Output Resistance SLA Pin                                                    0.23     1   kW
     Cload                  Load Capacitance SLA Pin                                                              50   pF
11. No more than 100 cumulative hours in life time above Ttw
12. Thermal shutdown is derived from Thermal Warning
                                                          www.onsemi.com
                                                                    7


                                                    AMIS−30521, NCV70521
Table 6. AC PARAMETERS (AC Parameters are Given for VBB and Temperature in Their Operating Ranges)
  Symbol      Pin(s)                 Parameter                        Remark/Test Conditions  Min  Typ  Max   Unit
INTERNAL OSCILLATOR
      fosc             Frequency of Internal Oscillator                                       3.6   4   4.4   MHz
MOTORDRIVER
                       PWM Frequency                                                          20.8 22.8 24.8  kHz
    fPWM                                                           Frequency Depends Only on
             MOTxx     Double PWM Frequency                                                   41.6 45.6 49.6  kHz
                                                                   Internal Oscillator
       fd              PWM Jitter Depth (Note 13)                                                   10       % fPWM
                                                                   EMC[1:0] = 00                   150        V/ms
                       Turn−On Voltage Slope, 10% to 90%           EMC[1:0] = 01                   100        V/ms
    Tbrise   MOTxx
                       (Note 13)                                   EMC[1:0] = 10                    50        V/ms
                                                                   EMC[1:0] = 11                    25        V/ms
                                                                   EMC[1:0] = 00                   150        V/ms
                       Turn−off Voltage Slope, 90% to 10%          EMC[1:0] = 01                   100        V/ms
    Tbfall   MOTxx
                       (Note 13)                                   EMC[1:0] = 10                    50        V/ms
                                                                   EMC[1:0] = 11                    25        V/ms
DIGITAL OUTPUTS
               DO                                                  Capacitive Load 400 pF and
    TH2L               Output Falltime from VinH to VinL                                                 50    ns
               ERR                                                 Pullup Resistor of 1.5 kW
CHARGE PUMP
               CPN
      fCP              Charge Pump Frequency                                                       250        kHz
               CPP
    TCPU     MOTxx     Startup Time of Charge Pump (Note 14) Spec External Components                    5     ms
CLR FUNCTION
     tCLR      CLR     Minimum Time for Hard Reset                                            100              ms
NXT FUNCTION
   tNXT_HI             NXT Minimum, High Pulse Width               See Figure 4               2.0              ms
  tNXT_LO              NXT Minimum, Low Pulse Width                See Figure 4               2.0              ms
               NXT     NXT Hold Time, Following Change of
  tDIR_SET                                                         See Figure 4                    2.0         ms
                       DIR
 tDIR_HOLD             NXT Hold Time, Before Change of DIR         See Figure 4                    2.0         ms
13. Characterization Data Only
14. Guaranteed by design.
                                                              tNXT_HI           tNXT_LO
                                                              0.5 VCC
                                 NXT
                                              tDIR_SET   tDIR_HOLD
                                   ÌÌÌ
                                   ÌÌÌ
                                 DIR                 VALID
                                                                   ÌÌÌÌÌÌÌÌÌÌ
                                                                   ÌÌÌÌÌÌÌÌÌÌ
                                   ÌÌÌ                             ÌÌÌÌÌÌÌÌÌÌ
                                               Figure 4. NXT−Input Timing Diagram
                                                          www.onsemi.com
                                                                      8


                                                     AMIS−30521, NCV70521
Table 7. SPI TIMING PARAMETERS
   Symbol                                             Parameter                                     Min Typ Max Unit
     tCLK      SPI Clock Period                                                                      1           ms
 tCLK_HIGH     SPI Clock High Time                                                                  100          ns
 tCLK_LOW      SPI Clock Low Time                                                                   100          ns
   tSET_DI     DI Setup Time, Valid Data Before Rising Edge of CLK                                  50           ns
  tHOLD_DI     DI Hold Time, Hold Data After Rising Edge of CLK                                     50           ns
 tCSB_HIGH     CS High Time                                                                         2.5          ms
  tSET_CSB     CS Setup Time, CS Low Before Rising Edge of CLK                                      100          ns
  tSET_CLK     CLK Setup Time, CLK High Before Rising Edge of CS                                    100          ns
                             CS                  0.2 VCC                                    0.2 VCC
                                  tSET_CSB                      tCLK           tSET_CLK
                                                                     0.8 VCC
                            CLK          0.2 VCC                                        0.2 VCC
                                                        tCLK_HI     tCLK_LO
                                          tSET_DI         tHOLD_DI
                               ÌÌ                                  ÌÌÌÌÌÌÌÌ
                               ÌÌ                                  ÌÌÌÌÌÌÌÌ
                                            0.8 VCC
                            DI
                                                 VALID
                                                             Figure 5. SPI Timing
                                                                www.onsemi.com
                                                                             9


                                                  AMIS−30521, NCV70521
                                            TYPICAL APPLICATION SCHEMATIC
                                                         100 nF       100 nF 100 nF                         D1
        VDD                                                                                                          VBAT
                                                                                                        +
                       C5
                                                         C4        C2        C3             C6     C1 100 mF
               100 nF               R2        R3
                                                                 VDD       VBB        VBB
                                                                                               220 nF
                                                                32        14       27
                                                                                         VCP
                                                                                     11
                                                                                      9 CPN
                                                      DIR                                       C7
                                                              5
                                                     NXT                                        220 nF
                                                              4                      10
                                                                                         CPP
                                                      DO
                                                              31                         MOTXP
                                                        DI                       25,26
                                                              2     AMIS−30521/
                         mC                          CLK             NCV70521            MOTXN
                                                              3                  21,22
                                                       CS
                                                              13                                          M
                                                     CLR                                 MOTYP
                                                              12                 15,16
                                                     ERR
                                                              6                          MOTYN
                                                 R1 SLA                          19,20
                                                              7
                                                               1, 17, 23,                  HV20081114.1
                                                C8             8 18 24 30 28 29
                                                                                     TSTO
                                                                GND
                               Figure 6. Typical Application Schematic AMIS−30521/NCV70521
  Table 8. EXTERNAL COMPONENTS LIST AND DESCRIPTION
    Component                                 Function                                 Typ. Value            Tolerance        Unit
        C1            VBB Buffer Capacitor (Low ESR < 1 W)                                100                −20 +80%          mF
      C2, C3          VBB Decoupling Block Capacitor                                      100                −20 +80%          nF
        C4            VDD Buffer Capacitor                                                220                 $20%             nF
        C5            VDD Buffer Capacitor                                                100                 $20%             nF
        C6            Charge−Pump Buffer Capacitor                                        220                 $20%             nF
        C7            Charge−Pump Pumping Capacitor                                       220                 $20%             nF
        C8            Low Pass Filter SLA                                                   1                 $20%             nF
        R1            Low Pass Filter SLA                                                  5.6                 $1%             kW
      R2, R3          Pullup Resistor Open Drain Output                                    4.7                 $1%             kW
        D1            Reverse Protection Diode                                         MURD530
                                                 FUNCTIONAL DESCRIPTION
H−Bridge Drivers                                                      limited. Secondly, when excessive voltage is sensed across
   A full H−bridge is integrated for each of the two stator           the transistor, the transistor is switched−off.
windings. Each H−bridge consists of two low−side and two                 In order to reduce the radiated/conducted emission,
high−side N−type MOSFET switches. Writing logic ’0’ in                voltage slope control is implemented in the output switches.
bit <MOTEN> disables all drivers (High−Impedance).                    The output slope is defined by the gate−drain capacitance of
Writing logic ’1’ in this bit enables both bridges and current        output transistor and the (limited) current that drives the
can flow in the motor stator windings.                                gate. There are two trimming bits for slope control (See
   In order to avoid large currents through the H−bridge              Table 12 SPI Control Parameter Overview EMC[1:0]).
switches, it is guaranteed that the top− and bottom switches             The power transistors are equipped with so−called “active
of the same half−bridge are never conductive                          diodes”: when a current is forced trough the transistor switch
simultaneously (interlock delay).                                     in the reverse direction, i.e. from source to drain, then the
   A two−stage protection against shorts on motor lines is            transistor is switched on. This ensures that most of the
implemented. In a first stage, the current in the driver is           current flows through the channel of the transistor instead of
                                                         www.onsemi.com
                                                                  10


                                                    AMIS−30521, NCV70521
through the inherent parasitic drain−bulk diode of the                       To further reduce the emission, an artificial jitter can be
transistor.                                                                added to the PWM frequency. (see Table 12, SPI Control
   Depending on the desired current range and the                          Register 1). The PWM frequency will not vary with changes
micro−step position at hand, the RDS(on) of the low−side                   in the supply voltage. Also variations in motor−speed or
transistors will be adapted such that excellent current−sense              load−conditions of the motor have no effect. There are no
accuracy is maintained. The RDS(on) of the high−side                       external components required to adjust the PWM frequency.
transistors remain unchanged, see also the DC−parameter
table for more details.                                                    Automatic Forward & Slow−Fast Decay
                                                                             The PWM generation is in steady−state using a
PWM Current Control                                                        combination of forward and slow−decay. The absence of
   A PWM comparator compares continuously the actual                       fast−decay in this mode, guarantees the lowest possible
winding current with the requested current and feeds back                  current−ripple “by design”. For transients to lower current
the information to a digital regulation loop. This loop then               levels, fast−decay is automatically activated to allow
generates a PWM signal, which turns on/off the H−bridge                    high−speed response. The selection of fast or slow decay is
switches. The switching points of the PWM duty−cycle are                   completely transparent for the user and no additional
synchronized to the on−chip PWM clock.                                     parameters are required for operation.
   The frequency of the PWM controller can be doubled to
reduce the over−all current−ripple with a factor of two.
                  Icoil
                          Set value
                                                                                   Actual value
                   0                                                                                                              t
                          T PWM
                                       Forward & Slow Decay                                 Forward & Slow Decay
                                                      Fast Decay & Forward
                                                                                                                PC20070604.1
                                          Figure 7. Forward & Slow/Fast Decay PWM
Automatic Duty Cycle Adaptation                                            maintain the requested average current in the coils. This
   In case the supply voltage is lower than 2*Bemf, then the               process is completely automatic and requires no additional
duty cycle of the PWM is adapted automatically to >50% to                  parameters for operation.
                 Icoil
                         Duty Cycle
                           < 50 %                  Duty Cycle > 50 %                            Duty Cycle < 50 %
                                      Actual value
                                                                                                                Set value
                                                                                                                                t
                                                                                                                     PC20070604.2
                         TPWM
                                          Figure 8. Automatic Duty Cycle Adaptation
                                                             www.onsemi.com
                                                                       11


                                               AMIS−30521, NCV70521
Step Translator and Step Mode                                     remaining in the same Step Mode, subsequent translator
   The Step Translator provides the control of the motor by       positions are all in the same column and increased or
means of SPI register Stepmode: SM[2:0], SPI register             decreased with 1. Table 10 lists the output current vs. the
DIRCNTRL, and input pins DIR and NXT. It is translating           translator position.
consecutive steps in corresponding currents in both motor            As shown in Figure 9 the output current−pairs can be
coils for a given stepmode.                                       projected approximately on a circle in the (Ix,Iy) plane.
   One out of 7 possible stepping modes can be selected           There are however two exceptions: uncompensated half step
through SPI−bits SM[2:0] (Table 12).                              and full step. In these stepmodes the two currents are not
   After power−on or hard reset, the coil−current translator      regulated to a fraction of Imax but are in all intermediate steps
is set to the default 1/32 micro−stepping at position ’0’.        regulated at 100%. In the (Ix,Iy) plane the current−pairs are
Upon changing the Step Mode, the translator jumps to              projected on a square. Table 9 list the output current vs. the
position 0* of the corresponding stepping mode. When              translator position for these cases.
  Table 9. SQUARE TRANSLATOR TABLE FOR FULL STEP AND UNCOMPENSATED HALF STEP
                                          Stepmode ( SM[2:0] )                                         % of Imax
                                   101                            110
       MSP[6:0]         Uncompensated Half−Step                Full−Step                      Coil x                  Coil y
       000 0000                     0*                              −                           0                      100
       001 0000                     1                               1                          100                     100
       010 0000                     2                               −                          100                      0
       011 0000                     3                               2                          100                    −100
       100 0000                     4                               −                           0                     −100
       101 0000                     5                               3                         −100                    −100
       110 0000                     6                               −                         −100                      0
       111 0000                     7                               0                         −100                     100
                                                     www.onsemi.com
                                                             12


                                  AMIS−30521, NCV70521
Table 10. CIRCULAR TRANSLATOR TABLE
                                  Stepmode (SM[2:0])                % of Imax
                   000       001        010          011 100
   MSP[6:0]        1/32      1/16        1/8         1/4 1/2 Coil x           Coil y
   000 0000         ’0’       0*         0*           0*  0*   0               100
   000 0001          1         −          −           −   −   3.5              98.8
   000 0010          2         1          −           −   −   8.1              97.7
   000 0011          3         −          −           −   −   12.7             96.5
   000 0100          4         2          1           −   −   17.4             95.3
   000 0101          5         −          −           −   −   22.1             94.1
   000 0110          6         3          −           −   −   26.7              93
   000 0111          7         −          −           −   −   31.4             91.8
   000 1000          8         4          2           1   −   34.9             89.5
   000 1001          9         −          −           −   −   38.3             87.2
   000 1010         10         5          −           −   −    43              84.9
   000 1011         11         −          −           −   −   46.5             82.6
   000 1100         12         6          3           −   −    50               79
   000 1101         13         −          −           −   −   54.6             75.5
   000 1110         14         7          −           −   −   58.1             72.1
   000 1111         15         −          −           −   −   61.6             68.6
   001 0000         16         8          4           2   1   65.1             65.1
   001 0001         17         −          −           −   −   68.6             61.6
   001 0010         18         9          −           −   −   72.1             58.1
   001 0011         19         −          −           −   −   75.5             54.6
   001 0100         20        10          5           −   −    79               50
   001 0101         21         −          −           −   −   82.6             46.5
   001 0110         22        11          −           −   −   84.9              43
   001 0111         23         −          −           −   −   87.2             38.3
   001 1000         24        12          6           3   −   89.5             34.9
   001 1001         25         −          −           −   −   91.8             31.4
   001 1010         26        13          −           −   −    93              26.7
   001 1011         27         −          −           −   −   94.1             22.1
   001 1100         28        14          7           −   −   95.3             17.4
   001 1101         29         −          −           −   −   96.5             12.7
   001 1110         30        15          −           −   −   97.7             8.1
   001 1111         31         −          −           −   −   98.8             3.5
   010 0000         32        16          8           4   2   100               0
   010 0001         33         −          −           −   −   98.8             −3.5
   010 0010         34        17          −           −   −   97.7             −8.1
   010 0011         35         −          −           −   −   96.5            −12.7
   010 0100         36        18          9           −   −   95.3            −17.4
   010 0101         37         −          −           −   −   94.1            −22.1
   010 0110         38        19          −           −   −    93             −26.7
   010 0111         39         −          −           −   −   91.8            −31.4
   010 1000         40        20         10           5   −   89.5            −34.9
   010 1001         41         −          −           −   −   87.2            −38.3
   010 1010         42        21          −           −   −   84.9             −43
   010 1011         43         −          −           −   −   82.6            −46.5
   010 1100         44        22         11           −   −    79              −50
   010 1101         45         −          −           −   −   75.5            −54.6
   010 1110         46        23          −           −   −   72.1            −58.1
   010 1111         47         −          −           −   −   68.6            −61.6
   011 0000         48        24         12           6   3   65.1            −65.1
   011 0001         49         −          −           −   −   61.6            −68.6
   011 0010         50        25          −           −   −   58.1            −72.1
   011 0011         51         −          −           −   −   54.6            −75.5
   011 0100         52        26         13           −   −    50              −79
   011 0101         53         −          −           −   −   46.5            −82.6
   011 0110         54        27          −           −   −    43             −84.9
   011 0111         55         −          −           −   −   38.3            −87.2
   011 1000         56        28         14           7   −   34.9            −89.5
   011 1001         57         −          −           −   −   31.4            −91.8
   011 1010         58        29          −           −   −   26.7             −93
   011 1011         59         −          −           −   −   22.1            −94.1
   011 1100         60        30         15           −   −   17.4            −95.3
   011 1101         61         −          −           −   −   12.7            −96.5
   011 1110         62        31          −           −   −   8.1             −97.7
                                       www.onsemi.com
                                              13


                                  AMIS−30521, NCV70521
Table 10. CIRCULAR TRANSLATOR TABLE
                                  Stepmode (SM[2:0])                % of Imax
                   000       001        010          011 100
   MSP[6:0]        1/32      1/16        1/8         1/4 1/2 Coil x           Coil y
   011 1111         63         −          −           −   −   3.5             −98.8
   100 0000         64        32         16           8   4    0              −100
   100 0001         65         −          −           −   −   −3.5            −98.8
   100 0010         66        33          −           −   −   −8.1            −97.7
   100 0011         67         −          −           −   −  −12.7            −96.5
   100 0100         68        34         17           −   −  −17.4            −95.3
   100 0101         69         −          −           −   −  −22.1            −94.1
   100 0110         70        35          −           −   −  −26.7             −93
   100 0111         71         −          −           −   −  −31.4            −91.8
   100 1000         72        36         18           9   −  −34.9            −89.5
   100 1001         73         −          −           −   −  −38.3            −87.2
   100 1010         74        37          −           −   −   −43             −84.9
   100 1011         75         −          −           −   −  −46.5            −82.6
   100 1100         76        38         19           −   −   −50              −79
   100 1101         77         −          −           −   −  −54.6            −75.5
   100 1110         78        39          −           −   −  −58.1            −72.1
   100 1111         79         −          −           −   −  −61.6            −68.6
   101 0000         80        40         20          10   5  −65.1            −65.1
   101 0001         81         −          −           −   −  −68.6            −61.6
   101 0010         82        41          −           −   −  −72.1            −58.1
   101 0011         83         −          −           −   −  −75.5            −54.6
   101 0100         84        42         21           −   −   −79              −50
   101 0101         85         −          −           −   −  −82.6            −46.5
   101 0110         86        43          −           −   −  −84.9             −43
   101 0111         87         −          −           −   −  −87.2            −38.3
   101 1000         88        44         22          11   −  −89.5            −34.9
   101 1001         89         −          −           −   −  −91.8            −31.4
   101 1010         90        45          −           −   −   −93             −26.7
   101 1011         91         −          −           −   −  −94.1            −22.1
   101 1100         92        46         23           −   −  −95.3            −17.4
   101 1101         93         −          −           −   −  −96.5            −12.7
   101 1110         94        47          −           −   −  −97.7            −8.1
   101 1111         95         −          −           −   −  −98.8            −3.5
   110 0000         96        48         24          12   6  −100               0
   110 0001         97         −          −           −   −  −98.8             3.5
   110 0010         98        49          −           −   −  −97.7             8.1
   110 0011         99         −          −           −   −  −96.5            12.7
   110 0100        100        50         25           −   −  −95.3            17.4
   110 0101        101         −          −           −   −  −94.1            22.1
   110 0110        102        51          −           −   −   −93             26.7
   110 0111        103         −          −           −   −  −91.8            31.4
   110 1000        104        52         26          13   −  −89.5            34.9
   110 1001        105         −          −           −   −  −87.2            38.3
   110 1010        106        53          −           −   −  −84.9             43
   110 1011        107         −          −           −   −  −82.6            46.5
   110 1100        108        54         27           −   −   −79              50
   110 1101        109         −          −           −   −  −75.5            54.6
   110 1110        110        55          −           −   −  −72.1            58.1
   110 1111        111         −          −           −   −  −68.6            61.6
   111 0000        112        56         28          14   7  −65.1            65.1
   111 0001        113         −          −           −   −  −61.6            68.6
   111 0010        114        57          −           −   −  −58.1            72.1
   111 0011        115         −          −           −   −  −54.6            75.5
   111 0100        116        58         29           −   −   −50              79
   111 0101        117         −          −           −   −  −46.5            82.6
   111 0110        118        59          −           −   −   −43             84.9
   111 0111        119         −          −           −   −  −38.3            87.2
   111 1000        120        60         30          15   −  −34.9            89.5
   111 1001        121         −          −           −   −  −31.4            91.8
   111 1010        122        61          −           −   −  −26.7             93
   111 1011        123         −          −           −   −  −22.1            94.1
   111 1100        124        62         31           −   −  −17.4            95.3
   111 1101        125         −          −           −   −  −12.7            96.5
   111 1110        126        63          −           −   −   −8.1            97.7
   111 1111        127         −          −           −   −   −3.5            98.8
                                       www.onsemi.com
                                              14


                                                   AMIS−30521, NCV70521
                            IY                                    IY                                     IY
                 Start = 0  Step 1                     Start = 0        Step 1          Start = 0               Step 1
                                  Step 2
                                      Step 3
                                             IX                            Step 2 I                                       IX
                                                                                    X
                                                                             Step 3   Step 3                       Step 2
                   1/4th Micro Step                 Uncompensated Half Step                         Full Step
                    SM[2:0] = 011                         SM[2:0] = 101                           SM[2:0] = 110        PC20071116.1
                                         Figure 9. Translator Table: Circular and Square
Direction                                                             Synchronization of Step Mode and NXT Input
   The direction of rotation is selected by means of following           When step mode is re−programmed to another resolution,
combination of the DIR input pin and the SPI−controlled               (Figure 11), this is put in effect immediately upon the first
direction bit <DIRCTRL> as illustrated in Table 12.                   arriving “NXT” input. If the micro−stepping resolution is
                                                                      increased, the coil currents will be regulated to the nearest
NXT Input                                                             micro−step, according to the fixed grid of the increased
   Changes on the NXT input will move the motor current               resolution. If however the micro−stepping resolution is
one step up/down in the translator table (even when the               decreased, then it is possible to introduce an offset (or phase
motor is disabled). Depending on the NXT−polarity bit                 shift) in the micro−step translator table.
<NXTP> (see Table 12), the next step is initiated either on              If the step resolution is decreased at a translator table
the rising edge or the falling edge of the NXT input.                 position that is shared both by the old and new resolution
Translator Position                                                   setting, then the offset is zero and micro−stepping proceeds
   The translator position can be read in SPI Status Register         according to the translator table.
3. This is a 7−bit number equivalent to the 1/32th micro−step            If the translator position is not shared both by the old and
from Table 10: “Circular Translator Table” above. The                 new resolution setting, then the micro−stepping proceeds
translator position is updated immediately following a NXT            with an offset relative to the translator table (See Figure 11
trigger.                                                              right hand side).
   NXT
               Update                           Update
          Translator Position            Translator Position
     Figure 10. Translator Position Timing Diagram
                                                         www.onsemi.com
                                                                   15


                                                               AMIS−30521, NCV70521
                Change from lower to higher resolution                                            Change from higher to lower resolution
                     IY                                       IY                                      IY                              IY
                                  DIR                                      DIR                                  DIR                               DIR
                                                        NXT2                                                                    NXT1
                         endpos                    NXT3          NXT1                                    endpos                          startpos
                                               NXT4                   startpos                                           NXT2
                                       IX                                      IX                                  IX  NXT3                          IX
               Halfstep                              1/4th step                                 1/8th step                       Halfstep
                                                    Figure 11. NXT−Step−Mode Synchronization
 Left: change from lower to higher resolution. The left−hand side depicts the ending half−step position during which a new step mode res-
 olution was programmed. The right−hand side diagram shows the effect of subsequent NXT commands on the micro−step position.
 Right: change from higher to lower resolution. The left−hand side depicts the ending micro−step position during which a new step mode
 resolution was programmed. The right−hand side diagram shows the effect of subsequent NXT commands on the half−step position.
 NOTE:     It is advised to reduce the micro−stepping resolution only at micro−step positions that overlap with desired micro−step positions
           of the new resolution.
Programmable Peak−Current                                                             parameter is changed, the coil−currents will be updated
   The amplitude of the current waveform in the motor coils                           immediately at the next PWM period. Figure 12 presents the
(coil peak current = Imax) is adjusted by means of an SPI                             Peak−Current and Current Ranges in conjunction to the
parameter “CUR[4:0]” (Table 13). Whenever this                                        Current setting (CUR[4:0]).
                                          Peak Current
            Ipeak (CUR[4:0] = 11111)
                                                                                      Current Range 3
                                                                                      CUR = 23 −> 31
           Ipeak (CUR[4:0] = 10110]
                                                                    Current Range 2
                                                                     CUR = 16 −> 22
            Ipeak (CUR[4:0] = 01111)
                                           Current Range 1
                                            CUR = 9 −> 15
           Ipeak (CUR[4:0] = 01000)
                                            Current Range 0
                                              CUR = 0 −> 8
                                     0                       8                  15             22                   31      CUR[4:0]
                                                Figure 12. Programmable Peak−Current Overview
Speed and Load−Angle Output                                                           current zero crossings”. Per coil, 2 zero−current positions
   The SLA−pin provides an output voltage that indicates the                          exist per electrical period, yielding in total 4 zero−current
level of the Back−e.m.f. voltage of the motor. This                                   observation points per electrical period.
Back−e.m.f. voltage is sampled during every so−called ”coil
                                                                        www.onsemi.com
                                                                                   16


                                                 AMIS−30521, NCV70521
                                                ICOIL                         VBEMF
                                                                                                  t
                                                              ZOOM
                                  Previous          Coil Current Zero Crossing            Next
                                 Micro−Step                                            Micro−Step
                        ICOIL                     Current Decay
                                                                   Zero Current
                                                                                                      t
                       VCOIL
                                                                Voltage Transient
                         VBB
                                                                                        |VBEMF|
                                                                                                      t
                                         Figure 13. Principle of Bemf measurement
   Because of the relatively high re−circulation currents in           SLA−pin. Because the transient behavior of the coil voltage
the coil during current decay, the coil voltage VCOIL shows            is not visible anymore, this mode generates smoother Back
a transient behavior. As this transient is not always desired          e.m.f. input for post−processing, e.g. by software.
in application software, two operating modes can be selected              In order to bring the sampled Back e.m.f. to a descent
by means of the bit <SLAT> (see ”SLA−transparency” in                  output level (0 V to 5 V), the sampled coil voltage VCOIL is
Table 12). The SLA pin shows in ”transparent mode” full                divided by 2 or by 4. This divider is set through a SPI bit
visibility of the voltage transient behavior. This allows a            <SLAG>. (See Table 12)
sanity−check of the speed−setting versus motor operation                  The following drawing illustrates the operation of the
and characteristics and supply voltage levels. If the bit              SLA−pin and the transparency−bit. ”PWMsh” and ”ICOIL =
“SLAT” is cleared, then only the voltage samples at the end            0” are internal signals that define together with SLAT the
of each coil current zero crossing are visible on the                  sampling and hold moments of the coil voltage.
                                                         www.onsemi.com
                                                                  17


                                                            AMIS−30521, NCV70521
                                             Ssh                      Sh
                      V COIL     div2
                                                                                             buf           SLA−Pin
                                 div4
                                                           Csh                      Ch
                       ICOIL = 0                                                         SLAT
                         PWMsh                                                           NOT (ICOIL = 0)
                  PWMsh
                ICOIL = 0
                    SLAT
                   VCOIL
                                                                                                                                                          t
                 SLA−Pin                                              last sample
                                                                       is retained   V BEMF
                                                                                                                                      retain last sample
                                                                                          previous output is kept at SLA pin
                                                                                                                                                         t
                           SLAT = 1 => SLA−pin is transparent during                    SLAT = 0 => SLA−pin is not “transparent” during
                           VBEMF sampling @ coil current zero crossing.                 VBEMF sampling @ coil current zero crossing.
                           SLA−pin is updated “real−time”.                              SLA−pin is updated when leaving current−less state.
                                                       Figure 14. Timing Diagram of SLA−Pin
Warning, Error Detection and Diagnostics Feedback
Thermal Warning and Shutdown                                                            Note: Successive reading the SPI Status Registers 1 and 2 in
   When Junction temperature rises above TTW, the thermal                               case of a short circuit condition, may lead to damage to the
warning bit <TW> is set (Table 15 SPI Status Register 0). If                            drivers.
junction temperature increases above thermal shutdown
level, then the circuit goes in “Thermal Shutdown” mode                                 Open Coil/Current Not Reached Detection
(<TSD>) and all driver transistors are disabled (high                                      Open coil detection is based on the observation of 100%
impedance) (Table 15 SPI Status Register 2). The conditions                             duty cycle of the PWM regulator. If in a coil 100% duty cycle
to reset flag <TSD> is to be at a temperature lower than TTW                            is detected for longer than 32 ms the appropriate status bit in
and to clear the <TSD> flag by reading it using any SPI read                            the SPI status register is set (<OPENX> or <OPENY>).
command.                                                                                (Table 15: SPI Status Register 0)
                                                                                           When the resistance of a motor coil is very large and the
Overcurrent Detection                                                                   battery voltage is low, it can happen that the motor driver is
   The overcurrent detection circuit monitors the load                                  not able to deliver the requested current to the motor. Under
current in each activated output stage. If the load current                             these conditions the PWM controller duty cycle will be
exceeds the overcurrent detection threshold, then the                                   100% and after 32 ms, the error pin and <OPENX>,
overcurrent flag is set and the drivers are switched off to                             <OPENY> will flag this situation (motor current is kept
reduce the power dissipation and to protect the integrated                              alive). This feature can be used to test if the operating
circuit. Each driver transistor has an individual detection bit                         conditions (supply voltage, motor coil resistance) still allow
in the Table 15 SPI status registers 1 and SPI Status Register                          reaching the requested coil−current or else the coil−current
2 (<OVCXij> and <OVCYij>). Error condition is latched                                   should be reduced.
and the microcontroller needs to clear the status bits to
reactivate the drivers.
                                                                      www.onsemi.com
                                                                                   18


                                                  AMIS−30521, NCV70521
Charge Pump Failure                                                digital, charge pump remains active. Logic 0 on CLR pin
  The charge pump is an important circuit that guarantees          resumes normal operation again.
low RDS(on) for all drivers, especially for low supply
voltages. If the supply voltage is too low or external             Sleep Mode
components are not properly connected to guarantee RDS(on)         The bit <SLP> in SPI control register 2 is provided to enter
of the drivers, then the bit <CPFAIL> is set in the SPI status     a so−called “sleep mode”. This mode allows reduction of
register 0. Also after power−on−reset the charge pump              current−consumption when the motor is not in operation.
voltage will need some time to exceed the required                 The effect of sleep mode is as follows:
threshold. During that time <CPFAIL> will be set to “1”.           • The Drivers are Put in HiZ
Error Output
                                                                   • All Analog Circuits are Disabled and in Low−Power
  This is an open drain digital output to flag a problem to the       Mode
external microcontroller. The signal on this output is active      • All Internal Registers are Maintaining Their Logic
low and the logic combination of:                                     Content
NOT(ERR) = <TW> OR <TSD> OR <OVCXij> OR <                          • NXT and DIR Inputs are Ignored
OVCYij> OR <OPENi> OR <CPFAIL>                                     • SPI Communication Remains Possible (Slight Current
                                                                      Increase During SPI Communication)
CLR Pin (=Hard Reset)
                                                                   • Oscillator and Digital Clocks are Silent, Except During
  Logic 0 on CLR pin allows normal operation of the chip.
                                                                      SPI Communication
To reset the complete digital inside the AMIS−30521/
                                                                      Normal operation is resumed after writing logic ’0’ to bit
NCV70521, the input CLR needs to be pulled to logic 1
                                                                   <SLP>. A startup time is needed for the charge pump to
during minimum time given by tCLR. (See AC Parameters)
                                                                   stabilize. After this time, NXT commands can be issued.
This reset function clears all internal registers without the
                                                                   When the device is in sleep mode and VBB becomes lower
need of a power−cycle except in sleep mode. The operation
                                                                   than VBB_min the device might reset.
of all analog circuits is depending on the reset state of the
                                                        SPI INTERFACE
  The serial peripheral interface (SPI) allows an external         DO signal is the output from the Slave
microcontroller (Master) to communicate with the                   (AMIS−30521/NCV70521), and DI signal is the output
AMIS−30521/NCV70521. The implemented SPI block is                  from the Master. A chip select line (CS) allows individual
designed to interface directly with numerous microcontrollers      selection of a Slave SPI device in a multiple−slave system.
from several manufacturers. The AMIS−30521/NCV70521                The CS line is active low. If the AMIS−30521/NCV70521
acts always as a Slave and cannot initiate any transmission.       is not selected, DO is pulled up with the external pull up
The operation of the device is configured and controlled by        resistor. Since AMIS−30521/NCV70521 operates as a Slave
means of SPI registers which are observable for read and/or        in MODE 0 (CPOL = 0; CPHA = 0) it always clocks data out
write from the Master.                                             on the falling edge and samples data in on rising edge of
                                                                   clock. The Master SPI port must be configured in MODE 0
SPI Transfer Format and Pin Signals                                too, to match this operation. The SPI clock idles low
  During a SPI transfer, data is simultaneously transmitted        between the transferred bytes.
(shifted out serially) and received (shifted in serially). A          The diagram below is both a Master and a Slave timing
serial clock line (CLK) synchronizes shifting and sampling         diagram since CLK, DO and DI pins are directly connected
of the information on the two serial data lines (DO and DI).       between the Master and the Slave.
                                                        www.onsemi.com
                                                                19


                                                                  AMIS−30521, NCV70521
                                  #CLK Cycle        1          2         3          4          5         6          7      8
                              CS
                             CLK
                                                                                                                         ÌÌÌÌ
                                                                                                                         ÌÌÌÌ
                               DI             MSB       6           5          4          3         2          1       LSB
                              DO              MSB       6           5          4          3         2          1         ÌÌÌ
                                                                                                                         ÌÌÌ
                                                                                                                       LSB
                                                      Figure 15. Timing Diagram of a SPI Transfer
NOTE:     At the falling edge of the eighth clock pulse the data−out shift register is updated with the content of the addressed internal SPI
          register. The internal SPI registers are updated at the first rising edge of the AMIS−30521/NCV70521 system clock when
          CS = High.
Transfer Packet
  Serial data transfer is assumed to follow MSB first rule.
The transfer packet contains one or more bytes.
                                             BYTE 1                                                                          BYTE 2
                               Command and SPI Register Address                                                                Data
               MSB                                                                LSB          MSB                                                         LSB
              CMD2     CMD1     CMD0     ADDR4 ADDR3 ADDR2 ADDR1 ADDR0                           D7        D6        D5     D4      D3      D2      D1      D0
                                                                                                                                                      PC20080630.6
                     Command                        SPI Register Address
                                                                 Figure 16. SPI Transfer Packet
  Byte 1 contains the Command and the SPI Register                                               READ Operation
Address and indicates to the AMIS−30521/NCV70521 the                                                If the Master wants to read data from Status or Control
chosen type of operation and addressed register. Byte 2                                          Registers, it initiates the communication by sending a
contains data, or sent from the Master in a WRITE operation,                                     READ command. This READ command contains the
or received from the AMIS−30521/NCV70521 in a READ                                               address of the SPI register to be read out. At the falling edge
operation.                                                                                       of the eighth clock pulse the data−out shift register is
  Two command types can be distinguished in the                                                  updated with the content of the corresponding internal SPI
communication between Master and                                                                 register. In the next 8−bit clock pulse train this data is shifted
AMIS−30521/NCV70521:                                                                             out via DO pin. At the same time the data shifted in from DI
• READ from SPI Register with address ADDR[4:0]:                                                 (Master) should be interpreted as the following successive
   CMD[2:0] = “000”                                                                              command or the same command.
• WRITE to SPI Register with address ADDR[4:0]:
   CMD[2:0] = “100”
                                  Registers are updated with the internal status at the rising edge of the internal AMIS−30521/NCV70521 clock when CS = 1
               CS
                                                             COMMAND
                 DI                                   READ Data from ADDR1                                     COMMAND
  DATA from previous command or NOT VALID
                        after POR or RESET                       DATA                                             DATA
                DO                                    OLD DATA or NOT VALID                                DATA from ADDR1
       Figure 17. Single READ Operation where DATA from SPI Register with Address 1 is Read by the Master
                                                                            www.onsemi.com
                                                                                          20


                                                   AMIS−30521, NCV70521
   All 4 Status Registers (see SPI Registers) contain 7 data        operation. For the same reason it is recommended to keep
bits and an even parity check bit. The most significant bit         the CS line high always when the SPI bus is idle.
(D7) represents a parity of D[6:0]. If the number of logical
ones in D[6:0] is odd, the parity bit D7 equals “1”. If the         WRITE Operation
number of logical ones in D[6:0] is even then the parity bit           If the Master wants to write data to a Control Register it
D7 equals “0”. This simple mechanism protects against               initiates the communication by sending a WRITE
noise and increases the consistency of the transmitted data.        command. This contains the address of the SPI register to
If a parity check error occurs it is recommended to initiate        write to. The command is followed with a data byte. This
an additional READ command to obtain the status again.              incoming data will be stored in the corresponding Control
   Also the Control Registers can be read out following the         Register after CS goes from low to high!
same routine. Control Registers don’t have a parity check.          AMIS−30521/NCV70521 responds on every incoming byte
   The CS line is active low and may remain low between             by shifting out via DO the data stored in the last received
successive READ commands as illustrated in Figure 19.               address.
There is however one exception. In case an error condition             It is important that the writing action (command − address
is latched in one of Status Registers (see SPI Registers) the       and data) to the Control Register is exactly 16 bits long. If
ERR pin is activated. (See the “Error Output” Section). This        more or less bits are transmitted the complete transfer packet
signal flags a problem to the external microcontroller. By          is ignored.
reading the Status Registers information, the root cause of            A WRITE command executed for a read−only register
the problem can be determined. After this READ operation            (e.g. Status Registers) will not affect the addressed register
the Status Registers are cleared. Because the Status                and the device operation.
Registers and ERR pin (see SPI Registers) are only updated             Because after a power−on−reset the initial address is
by the internal system clock when the CS line is high, the          unknown the data shifted out via DO is not valid.
Master should force CS high immediately after the READ
                                                                       The NEW DATA is written into the corresponding
                                                                               internal register at the rising edge of CS
               CS
                                                 COMMAND                              DATA
                 DI                         Write DATA to ADDR3               NEW DATA for ADDR3
             DATA from previous command or
             NOT VALID after POR or RESET
                                                    DATA                              DATA
                DO                         OLD DATA or NOT VALID               DATA from ADDR3
      Figure 18. Single WRITE Operation Where DATA from the Master is Written in SPI Register with Address 3
                                                           www.onsemi.com
                                                                 21


                                                                 AMIS−30521, NCV70521
Examples of Combined READ and WRITE Operations                                              by writing a control byte in Control Register at ADDR2.
   In the following examples successive READ and WRITE                                      Note that during the write command (in Figures 18 and 19)
operations are combined. In Figure 19 the Master first reads                                the old data of the pointed register is returned at the moment
the status from Register at ADDR4 and at ADDR5 followed                                     the new data is shifted in.
                                     Registers are updated with the internal status at the
                                     rising edge of the internal AMIS−30521/NCV70521                            The NEW DATA is written into the corresponding
                                     clock when CS = 1                                                                   internal register at the rising edge of CS
                 CS
                                                COMMAND                        COMMAND                   COMMAND                         COMMAND
                   DI                          READ DATA                      READ DATA                 WRITE DATA                       NEW DATA
                                               from ADDR4                     from ADDR5                  to ADDR2                       for ADDR2
                    DATA from previous
               command or NOT VALID
                   after POR or RESET              DATA                           DATA                       DATA                            DATA
                  DO                            OLD DATA                          DATA                       DATA                        OLD DATA
                                              or NOT VALID                    from ADDR4                from ADDR5                      from ADDR2
                          Figure 19. Two Successive READ Commands Followed by a WRITE Command
   After the write operation the Master could initiate a read                               transmitted. This rule also applies when the master device
back command in order to verify if the data is correctly                                    wants to initiate an SPI transfer to read the Status Registers.
written, as illustrated in Figure 20. During reception of the                               Because the internal system clock updates the Status
READ command the old data is returned for a second time.                                    Registers only when CS line is high, the first read out byte
Only after receiving the READ command the new data is                                       might represent old status information.
                                                                                                        Registers are Updated with the Internal Status at the
                                Registers are Updated with the Internal Status at the
                                                                                                        Rising Edge of the Internal 521 Clock when CS = 1
                                Rising Edge of CS
                  CS
                                                 COMMAND                           DATA                 COMMAND
                    DI                          WRITE DATA                       NEW DATA                READ DATA                        COMMAND
                                                  to ADDR2                       for ADDR2               from ADDR2
                                                    DATA                           DATA                      DATA                             DATA
                   DO                             OLD DATA                      OLD DATA                  OLD DATA                          NEW DATA
                                                or NOT VALID                   from ADDR2               from ADDR2                         from ADDR2
  Figure 20. A WRITE Operation Where DATA From the Master is Written in SPI Register with Address 2 Followed
                                     by a READ Back Operation to Verify a Correct WRITE Operation
NOTE:     The internal data−out shift buffer of the AMIS−30521/NCV70521 is updated with the content of the selected SPI register only at
          the last (every eighth) falling edge of the CLK signal (see SPI Transfer Format and Pin Signals). As a result, new data for
          transmission cannot be written to the shift buffer at the beginning of the transfer packet and the first byte shifted out might
          represent old data.
  Table 11. SPI CONTROL REGISTERS (All SPI Control Registers have Read/Write Access and default to ”0” after Power−on or
  hard reset)
                                                                                                              Structure
                                               Content               Bit 7            Bit 6     Bit 5       Bit 4         Bit 3             Bit 2          Bit 1    Bit 0
                                               Access                R/W               R/W       R/W        R/W           R/W               R/W            R/W      R/W
               Address                           Reset                 0                 0        0           0             0                  0             0        0
              CR0 (01h)                           Data                           SM[2:0]                                              CUR[4:0]
              CR1 (02h)                           Data            DIRCTRL             NXTP        −           −         PWMF              PWMJ                EMC[1:0]
              CR2 (03h)                           Data             MOTEN               SLP      SLAG       SLAT             −                  −             −        −
Where:
R/W: Read and Write access
Reset: Status after Power−On or hard reset
                                                                          www.onsemi.com
                                                                                        22


                                                     AMIS−30521, NCV70521
 Table 12. SPI CONTROL PARAMETER OVERVIEW
        Symbol                             Description                                   Status                         Value
                                                                                            <DIRCTRL> = 0           CW Motion
                                                                             <DIR> = 0
                          Controls the Direction of Rotation (in                            <DIRCTRL> = 1           CCW Motion
       DIRCTRL
                          Combination with Logic Level on Input DIR)                        <DIRCTRL> = 0           CCW Motion
                                                                             <DIR> = 1
                                                                                            <DIRCTRL> = 1           CW Motion
                                                                                 00         Very Fast
                                                                                 01         Fast
       EMC[1:0]           Turn On− and Turn−off Slopes (Note 15)
                                                                                 10         Slow
                                                                                 11         Very Slow
                                                                          <MOTEN> = 0       Drivers Disabled
        MOTEN             Activates the Motor Driver Outputs
                                                                          <MOTEN> = 1       Drivers Enabled
                          Selects if NXT triggers on Rising or Falling     <NXTP> = 0       Trigger on Rising Edge
         NXTP
                          Edge                                             <NXTP> = 1       Trigger on Falling Edge
                          Enables Doubling of the PWM Frequency            <PWMF> = 0       Default Frequency
         PWMF
                          (Note 15)                                        <PWMF> = 1       Double Frequency
                                                                           <PWMJ> = 0       Jitter Disabled
         PWMJ             Enables Jitter PWM
                                                                           <PWMJ> = 1       Jitter Enabled
                                                                                000         1/32       Micro Step
                                                                                001         1/16       Micro Step
                                                                                010         1/8        Micro Step
                                                                                011         1/4 Micro Step
        SM[2:0]           Stepmode
                                                                                100         Compensated Half Step
                                                                                101         Uncompensated half Step
                                                                                110         Full Step
                                                                                111         n.a.
                                                                           <SLAG> = 0       Gain = 0.5
         SLAG             Speed Load Angle Gain Setting
                                                                           <SLAG> = 1       Gain = 0.25
                                                                            <SLAT> = 0      SLA is NOT Transparent
         SLAT             Speed Load Angle Transparency Bit
                                                                            <SLAT> = 1      SLA is Transparent
                                                                            <SLP> = 0       Active Mode
          SLP             Enables Sleep Mode
                                                                            <SLP> = 1       Sleep Mode
15. The typical values can be found in Table 5: DC Parameters and Table 6: AC Parameters
                                                            www.onsemi.com
                                                                       23


                                                       AMIS−30521, NCV70521
CUR[4:0] Selects IMCmax peak. This is the peak or amplitude of the regulated current waveform in the motor coils.
 Table 13. SPI CONTROL PARAMETER OVERVIEW: CURRENT AMPLITUDE CUR[4:0]
       Current Range                  Index            Current (mA)              Current Range                 Index            Current (mA)
          (Note 17)                CUR[4:0]             (Note 16)                   (Note 17)                CUR[4:0]             (Note 16)
                                    0    00000              33                                              16   10000                365
                                    1    00001              64                                              17   10001                400
                                    2    00010              95                                              18   10010                440
                                    3    00011             104                           2                  19   10011                485
               0                    4    00100             115                                              20   10100                530
                                    5    00101             126                                              21   10101                585
                                    6    00110             138                                              22   10110                630
                                    7    00111             153                                              23   10111                750
                                    8    01000             166                                              24   11000                825
                                    9    01001             190                                              25   11001                895
                                  10     01010             205                                              26   11010                975
                                   11    01011             230                           3                  27   11011               1065
               1                  12     01100             250                                              28   11100               1155
                                  13     01101             275                                              29   11101               1245
                                  14     01110             300                                              30   11110               1365
                                  15     01111             325                                              31   11111               1480
16. Typical current amplitude at TJ = 125.
17. Reducing the current over different current ranges might trigger overcurrent detection, please refer to dedicated application note for solutions.
SPI Status Register Description
All 4 SPI Status Registers have Read Access and are default to ”0” after Power−on or hard reset.
  Table 14. SPI STATUS REGISTERS
                                                                                     Structure
                   Content          Bit 7        Bit 6           Bit 5           Bit 4            Bit 3             Bit 2          Bit 1     Bit 0
                    Access             R           R               R               R                R                 R             R          R
  Address            Reset             0           0               0               0                0                 0             0          0
  SR0 04h          Data Not         PAR           TW             CPfail            −             OPENX             OPENY            −          −
                   Latched
  SR1 05h           Data is         PAR        OVCXPT          OVCXPB         OVCXNT            OVCXNB                −             −          −
                   Latched
  SR2 06h           Data is         PAR        OVCYPT          OVCYPB         OVCYYNT           OVCYNB              TSD             −          −
                   Latched
  SR3 07h          Data Not         PAR                                                    MSP[6:0]
                   Latched
Where:
R                     Read only mode access
Reset                 Status after Power−On or hard reset
PAR                   Parity check
                                                              www.onsemi.com
                                                                        24


                                          AMIS−30521, NCV70521
Table 15. SPI STATUS FLAGS OVERVIEW
                                 Length     Related
Mnemonic            Flag          (bit)   SPI Register                             Comment                          Reset State
                                                           ’0’ = no failure
  CPFail    Charge Pump Failure     1   Status Register 0  ’1’ = failure: indicates that the charge pump does            ’0’
                                                           not reach the required voltage level.
 MSP[6:0]    Micro Step Position    7   Status Register 3  Translator micro step position                            ’0000000’
 OPENX          OPEN Coil X         1   Status Register 0  ’1’ = Open coil detected                                      ’0’
 OPENY          OPEN Coil Y         1   Status Register 0  ’1’ = Open coil detected                                      ’0’
               Overcurrent at                              ’0’ = no failure
 OVCXNB      MOTXN Terminal;        1   Status Register 1  ’1’ = failure: indicates that over current is detected        ’0’
             Bottom Transistor                             at bottom transistor XN−terminal
               Overcurrent at                              ’0’ = no failure
 OVCXNT    MOTXN Terminal; Top      1   Status Register 1  ’1’ = failure: indicates that over current is detected        ’0’
                 Transistor                                at top transistor XN−terminal
               Overcurrent at                              ’0’ = no failure
 OVCXPB      MOTXP Terminal;        1   Status Register 1  ’1’ = failure: indicates that overcurrent is detected at      ’0’
             Bottom Transistor                             bottom transistor XP−terminal
               Overcurrent at                              ’0’ = no failure
 OVCXPT    MOTXP Terminal; Top      1   Status Register 1  ’1’ = failure: indicates that overcurrent is detected at      ’0’
                 Transistor                                top transistor XP−terminal
               Overcurrent at                              ’0’ = no failure
 OVCYNB      MOTYN Terminal;        1   Status Register 2  ’1’ = failure: indicates that overcurrent is detected at      ’0’
             Bottom Transistor                             bottom transistor YN−terminal
               Overcurrent at                              ’0’ = no failure
 OVCYNT    MOTYN Terminal; Top      1   Status Register 2  ’1’ = failure: indicates that overcurrent is detected at      ’0’
                 Transistor                                top transistor YN−terminal
               Overcurrent at                              ’0’ = no failure
 OVCYPB      MOTYP Terminal;        1   Status Register 2  ’1’ = failure: indicates that overcurrent is detected at      ’0’
             Bottom Transistor.                            bottom transistor YP−terminal
               Overcurrent at                              ’0’ = no failure
 OVCYPT    MOTYP Terminal; Top      1   Status Register 2  ’1’ = failure: indicates that overcurrent is detected at      ’0’
                 Transistor.                               top transistor YP−terminal
   TSD       Thermal Shutdown       1   Status Register 2                                                                ’0’
   TW         Thermal Warning       1   Status Register 0                                                                ’0’
                                                 www.onsemi.com
                                                          25


                                                    AMIS−30521, NCV70521
 DEVICE ORDERING INFORMATION
                                                                                                 Peak
         Part Number                Temperature Range                Package Type               Current               Shipping†
  AMIS30521C5212RG                      −40°C − 125°C                   NQFP−32                1600 mA               Tape & Reel
                                                                        (Pb−Free)
  AMIS30521C5212G                       −40°C − 125°C                   NQFP−32                1600 mA                Tube / Tray
                                                                        (Pb−Free)
  NCV70521MN003R2G*                     −40°C − 125°C                   NQFP−32                1600 mA               Tape & Reel
                                                                        (Pb−Free)
  NCV70521MN003G*                       −40°C − 125°C                   NQFP−32                1600 mA                Tube / Tray
                                                                        (Pb−Free)
†For information on tape and reel specifications, including part orientation and tape sizes, please refer to our Tape and Reel Packaging
 Specifications Brochure, BRD8011/D.
*Qualified for automotive applications.
                                                           www.onsemi.com
                                                                     26


AMIS−30521, NCV70521
 PACKAGE DIMENSIONS
      QFN32, 7x7
     CASE 560AA
       ISSUE A
    www.onsemi.com
          27


                                                                          AMIS−30521, NCV70521
                                                                                        QFN32, 7x7
                                                                                       CASE 560AA
                                                                                           ISSUE A
  ON Semiconductor and            are trademarks of Semiconductor Components Industries, LLC dba ON Semiconductor or its subsidiaries in the United States and/or other countries.
  ON Semiconductor owns the rights to a number of patents, trademarks, copyrights, trade secrets, and other intellectual property. A listing of ON Semiconductor’s product/patent
  coverage may be accessed at www.onsemi.com/site/pdf/Patent−Marking.pdf. ON Semiconductor reserves the right to make changes without further notice to any products herein.
  ON Semiconductor makes no warranty, representation or guarantee regarding the suitability of its products for any particular purpose, nor does ON Semiconductor assume any liability
  arising out of the application or use of any product or circuit, and specifically disclaims any and all liability, including without limitation special, consequential or incidental damages.
  Buyer is responsible for its products and applications using ON Semiconductor products, including compliance with all laws, regulations and safety requirements or standards,
  regardless of any support or applications information provided by ON Semiconductor. “Typical” parameters which may be provided in ON Semiconductor data sheets and/or
  specifications can and do vary in different applications and actual performance may vary over time. All operating parameters, including “Typicals” must be validated for each customer
  application by customer’s technical experts. ON Semiconductor does not convey any license under its patent rights nor the rights of others. ON Semiconductor products are not
  designed, intended, or authorized for use as a critical component in life support systems or any FDA Class 3 medical devices or medical devices with a same or similar classification
  in a foreign jurisdiction or any devices intended for implantation in the human body. Should Buyer purchase or use ON Semiconductor products for any such unintended or unauthorized
  application, Buyer shall indemnify and hold ON Semiconductor and its officers, employees, subsidiaries, affiliates, and distributors harmless against all claims, costs, damages, and
  expenses, and reasonable attorney fees arising out of, directly or indirectly, any claim of personal injury or death associated with such unintended or unauthorized use, even if such
  claim alleges that ON Semiconductor was negligent regarding the design or manufacture of the part. ON Semiconductor is an Equal Opportunity/Affirmative Action Employer. This
  literature is subject to all applicable copyright laws and is not for resale in any manner.
PUBLICATION ORDERING INFORMATION
LITERATURE FULFILLMENT:                                                     N. American Technical Support: 800−282−9855 Toll Free               ON Semiconductor Website: www.onsemi.com
 Literature Distribution Center for ON Semiconductor                         USA/Canada
 19521 E. 32nd Pkwy, Aurora, Colorado 80011 USA                             Europe, Middle East and Africa Technical Support:                   Order Literature: http://www.onsemi.com/orderlit
 Phone: 303−675−2175 or 800−344−3860 Toll Free USA/Canada                    Phone: 421 33 790 2910
 Fax: 303−675−2176 or 800−344−3867 Toll Free USA/Canada                                                                                         For additional information, please contact your local
 Email: orderlit@onsemi.com                                                                                                                     Sales Representative
 ◊                                                                                 www.onsemi.com                                                                           AMIS−30521/D
                                                                                               28


Mouser Electronics
Authorized Distributor
Click to View Pricing, Inventory, Delivery & Lifecycle Information:
ON Semiconductor:
 AMIS30521C5212G AMIS30521C5212RG
