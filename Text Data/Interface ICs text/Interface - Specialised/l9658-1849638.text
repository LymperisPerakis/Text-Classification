                                                                                                 L9658
                                      Octal squib driver and quad sensor interface
                                                                 ASIC for safety application
Features
■  8 deployment drivers sized to deliver 1.2 A
   (min) for 2 ms (min) and 1.75 A (min) for 1 ms
   (min)
■  Independently controlled high-side and low-
   side MOS for diagnosis
                                                                               LQFP64
■  Analog output available for resistance
■  Squib short to ground, short to battery and         ■   Hall effect sensor support on satellite channels
   MOS diagnostic available on SPI register                3 and 4.
■  Capability to deploy the squib with 1.2 A (min)     ■   Low voltage internal reset
   or 1.75 A under 35 V load-dump condition and
                                                       ■   2 kV ESD capability on all pins
   the low side MOS is shorted to ground
                                                       ■   Package: 64 leads LQFP
■  Capability to deploy the squib with 1.2 A (min)
   at 6.9 V VRES and 1.75 A at 12 V VRES               ■   Technology: ST proprietary BCD5s (0.57 µm)
■  Interface with 4 satellite sensors
■  Programmable independent current trip points        Description
   for each satellite channel                          L9658 is intended to deploy up to 8 squibs and to
■  Support Manchester protocol for satellite           interface up to 4 satellites. 2 satellite interfaces
   sensors                                             can be used to interface Hall sensors.
■  Supports for variable bit rate detection            Squib drivers are sized to deploy 1.2 A minimum
■  Independent current limit and fault timer           for 2 ms minimum during load dump and 1.75 A
   shutdown protection for each satellite output       minimum for 1ms minimum during load dump.
■  Short to ground and short to battery detection      Diagnostic of squib driver and squib resistance
   and reporting for each satellite channel            measurement is controlled by micro controller.
■  5.5 MHz SPI interface                               Satellite interfaces support Manchester decoder
■  Satellite message error detection                   with variable bit rate.
Table 1.      Device summary
             Order code                          Package                               Packing
               L9658                             LQFP64                                  Tray
              L9658TR                            LQFP64                             Tape and reel
September 2013                              Doc ID 14219 Rev 3                                             1/64
                                                                                                      www.st.com 1


Contents                                                                                                                   L9658
Contents
1        Block diagram and application schematic . . . . . . . . . . . . . . . . . . . . . . . 7
         1.1    Block diagram . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 7
         1.2    Application schematic . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 7
2        Pin description . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 8
         2.1    Thermal data . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 9
3        Electrical specification . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 10
         3.1    Maximum ratings . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 10
         3.2    Absolute maximum ratings . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 10
         3.3    Electrical characteristics . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 11
                3.3.1    DC characteristics . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 11
                3.3.2    AC characteristics . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 14
4        Functional description . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 18
         4.1    Overview . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 18
         4.2    Power on reset (POR) . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 18
         4.3    RESETB . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 18
         4.4    MSG . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 18
         4.5    IREF . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 19
         4.6    Loss of ground . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 19
         4.7    Deployment and reset . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 19
         4.8    Serial peripheral interface (SPI) . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 19
                4.8.1    Chip select (CS_A, CS_D, CS_S) . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 21
                4.8.2    Serial clock (SCLK, SCLK_A) . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 21
                4.8.3    Serial data output (MISO, MISO_A) . . . . . . . . . . . . . . . . . . . . . . . . . . . . 21
                4.8.4    Serial data input (MOSI, MOSI_A) . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 22
         4.9    Deployment drivers . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 22
                4.9.1    Arming interface . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 23
         4.10   DEPEN . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 25
                4.10.1   Deployment driver diagnostic . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 26
                4.10.2   Continuity diagnostic . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 27
                4.10.3   Short to battery . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 27
2/64                                       Doc ID 14219 Rev 3


L9658                                                                                                              Contents
           4.10.4    Short to ground and open circuit . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 27
           4.10.5    Resistance measurement . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 28
           4.10.6    MOS diagnostics . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 28
           4.10.7    Low side MOS diagnostic . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 28
           4.10.8    High side MOS diagnostic . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 30
           4.10.9    Loss of ground . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 30
      4.11 Deployment driver SPI bit definition . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 32
           4.11.1    Deployment driver MOSI bit definition . . . . . . . . . . . . . . . . . . . . . . . . . . 32
           4.11.2    Deployment driver register mode . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 33
           4.11.3    Deployment driver command mode . . . . . . . . . . . . . . . . . . . . . . . . . . . . 34
           4.11.4    Deployment driver diagnostic mode . . . . . . . . . . . . . . . . . . . . . . . . . . . . 35
           4.11.5    Example of short between loops diagnostic . . . . . . . . . . . . . . . . . . . . . 38
           4.11.6    Deployment driver monitor mode . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 39
           4.11.7    Deployment driver MISO bit definition . . . . . . . . . . . . . . . . . . . . . . . . . . 41
           4.11.8    Deployment driver register mode response . . . . . . . . . . . . . . . . . . . . . . 41
      4.12 MISO register mode response summary . . . . . . . . . . . . . . . . . . . . . . . . . 42
           4.12.1    Deployment driver command mode response . . . . . . . . . . . . . . . . . . . . 43
           4.12.2    Deployment driver diagnostic mode response . . . . . . . . . . . . . . . . . . . . 44
           4.12.3    Deployment driver status response . . . . . . . . . . . . . . . . . . . . . . . . . . . . 45
           4.12.4    Deployment driver SPI fault response . . . . . . . . . . . . . . . . . . . . . . . . . . 46
      4.13 Arming SPI bit definition . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 46
           4.13.1    Arming MOSI_A bit definition . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 46
           4.13.2    ARM[01..67] . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 46
           4.13.3    ARM[01..67]* . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 47
           4.13.4    Arming MISO_A bit definition . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 47
           4.13.5    ARM[01..67] . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 47
      4.14 Satellite sensor interface . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 47
           4.14.1    Current sensor . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 48
           4.14.2    Manchester decoding . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 48
           4.14.3    Communication protocols . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 50
           4.14.4    "A" protocol . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 50
           4.14.5    "B" variable length protocol . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 50
           4.14.6    FIFO buffer . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 51
           4.14.7    Satellite continuity check . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 51
           4.14.8    (IFx/Vx) hall effect support mode . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 51
           4.14.9    (IFx/Vx) raw data out mode . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 51
           4.14.10 Message waiting . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 52
                                   Doc ID 14219 Rev 3                                                                        3/64


Contents                                                                                                          L9658
               4.14.11 Satellite serial data input (MOSI) . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 52
               4.14.12 Satellite MOSI bits definition . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 52
               4.14.13 Satellite module configuration register (CH1 only) . . . . . . . . . . . . . . . . 53
               4.14.14 Channel configuration registers (CCR1, CCR2, CCR3, CCR4) . . . . . . . 54
               4.14.15 SPI MISO Bits layout for configuration report . . . . . . . . . . . . . . . . . . . . 58
5        Package information . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 62
6        Revision history . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 63
4/64                                 Doc ID 14219 Rev 3


L9658                                                                                                                          List of tables
List of tables
Table 1.  Device summary . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1
Table 2.  Pin function . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 8
Table 3.  Thermal Data . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 9
Table 4.  Maximum operating conditions . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 10
Table 5.  Absolute maximum ratings . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 10
Table 6.  DC specification general . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 11
Table 7.  DC Specification: deployment drivers . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 12
Table 8.  Satellite interface DC specifications . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 13
Table 9.  AC specification: deployment drivers . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 14
Table 10. AC specifications: satellite . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 16
Table 11. SPI timing . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 17
Table 12. SPI transmission during a deployment . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 25
Table 13. Deployment driver SPI response . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 32
Table 14. MOSI bit layout . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 32
Table 15. MOSI mode bits definition. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 32
Table 16. MOSI register mode message definition. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 33
Table 17. Pulse stretch timer . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 34
Table 18. MOSI command mode message definition . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 34
Table 19. MOSI diagnostic mode message definition . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 35
Table 20. Channel selection decoding . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 37
Table 21. MOSI monitor mode message definition. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 39
Table 22. MISO bit layout . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 41
Table 23. MISO mode bits definition. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 41
Table 24. MISO register mode response definition . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 41
Table 25. MISO register mode response summary . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 42
Table 26. MISO command mode response definition. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 43
Table 27. MISO diagnostic mode response definition . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 44
Table 28. MISO status response definition . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 45
Table 29. MISO SPI fault response . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 46
Table 30. Arming MOSI_A bit definition . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 46
Table 31. Arming MISO_A bit definition . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 47
Table 32. Satellite MOSI bits layout . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 52
Table 33. MOSI satellite interface registers map . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 52
Table 34. Master configuration register definition (CH1 Only) . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 53
Table 35. Channel configuration register definition . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 54
Table 36. Current ranges supported are given in following table . . . . . . . . . . . . . . . . . . . . . . . . . . . . 55
Table 37. Satellite/decoder control . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 55
Table 38. "B" protocol configuration . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 56
Table 39. Bit time selection. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 56
Table 40. Mode select . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 56
Table 41. SPI mode selects reply for satellite channels . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 57
Table 42. Satellite MISO bits definition . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 57
Table 43. SPI MISO bits layout when reporting FIFO data. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 58
Table 44. MISO Manchester message data definition . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 58
Table 45. Status bits definition . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 58
Table 46. Satellites fault codes definition supporting “A” protocol . . . . . . . . . . . . . . . . . . . . . . . . . . . 58
Table 47. Satellites fault codes definition supporting “B” protocol . . . . . . . . . . . . . . . . . . . . . . . . . . . 60
Table 48. Hall effect fault codes definition (CH3 and CH4) only. . . . . . . . . . . . . . . . . . . . . . . . . . . . . 60
Table 49. Document revision history . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 63
                                                    Doc ID 14219 Rev 3                                                                         5/64


List of figures                                                                                                                            L9658
List of figures
Figure 1.    Block diagram . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 7
Figure 2.    Application schematic . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 7
Figure 3.    MOS settling time and turn-on time 1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 15
Figure 4.    MOS settling time and turn-on time 2 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 15
Figure 5.    SPI timing diagram . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 17
Figure 6.    SPI timing measurement . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 17
Figure 7.    SPI block diagram. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 20
Figure 8.    Arming daisy-chain configuration . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 20
Figure 9.    Arming SPI transmission . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 21
Figure 10.   Deployment drivers diagram . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 22
Figure 11.   Deployment sequence . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 23
Figure 12.   Deployment flow chart . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 24
Figure 13.   Deployment driver diagnostic diagram . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 26
Figure 14.   Continuity diagnostic flow chart . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 27
Figure 15.   Resistance measurement flow chart. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 28
Figure 16.   Low side diagnostic flow chart . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 29
Figure 17.   High side driver diagnostic flow chart . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 31
Figure 18.   Satellite interface block diagram . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 47
Figure 19.   Manchester decoding . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 48
Figure 20.   Manchester decoding using satellite protocol as an example . . . . . . . . . . . . . . . . . . . . . . 49
Figure 21.   "A" satellite protocol . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 50
Figure 22.   "B" satellite protocol . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 50
Figure 23.   LQFP64 mechanical data and package dimensions . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 62
6/64                                                Doc ID 14219 Rev 3


L9658                                                                     Block diagram and application schematic
1     Block diagram and application schematic
1.1   Block diagram
      Figure 1. Block diagram
                                                                                             VRES0
                                    CS_A                                                     SQH0
                                 SCLK_A                  Arming                              SQL0
                                 MOSI_A                Interface                             GND0
                                 MISO_A                                                      VRES1
                                                                                             SQH1
                                                                                             SQL1
                                    CS_D                                                     GND1
                                    CS_S                                                     VRES2
                                    SCLK                    SPI                              SQH2
                                    MOSI                                                     SQL2
                                    MISO                                                     GND2
                                                                                             VRES3
                                     IREF                                                    SQH3
                                      VCC                                                    SQL3
                                                                                             GND3
                                    TEST                                   Deployment        VRES4
                                  DEPEN                                      Driver          SQH4
                                 V8BUCK                                                      SQL4
                                  RESET                                                      GND4
                                                                                             VRES5
                                    AOUT
                                                                                             SQH5
                                                                                             SQL5
                                     ICH1
                                                                                             GND5
                                     ICH2                                                    VRES6
                                                                                             SQH6
                                     ICH3
                                                          Sensor                             SQL6
                                   IF3/V3                                                    GND6
                                                        Interface                            VRES7
                                     ICH4
                                                                                             SQH7
                                   IF4/V4                                                    SQL7
                                                                                             GND7
                                     MSG
                                                                                             AGND
                                                                                             DGND
1.2   Application schematic
      Figure 2. Application schematic
                                                                                SQH0
                            VRES                                   VRES0              0.1µF   0.01µF
                                       0.1µF  3000µF
                                                                   VRES1
                                                                   VRES2        SQL0
                                                                                      0.1µF   0.01µF
                                                                   VRES3
                                                                   VRES4        SQH1
                                                                                      0.1µF   0.01µF
                                                                   VRES5
                                                                   VRES6        SQL1
                                                                                      0.1µF   0.01µF
                                                                   VRES7
                                                            12.5k               SQH2
                                                                   IREF
                                                                                      0.1µF   0.01µF
                                             VDD                   VDD
                                                            0.01µF              SQL2
                                                                                      0.1µF   0.01µF
                                V8BUCK                             V8BUCK
                                                  0.01µF    220µF               SQH3
                                                                                      0.1µF   0.01µF
                                      Reset pin of Power Supply    RESETB       SQL3
                                                                   CS_D               0.1µF   0.01µF
                                                                   CS_S         SQH4
                                                                   SCLK               0.1µF   0.01µF
                                                                   MOSI
                                                                                SQL4
                                                                   MISO               0.1µF   0.01µF
                                              Processor I/O
                                                                   CS_A
                                                                   SCLK_A       SQH5
                                                                                      0.1µF   0.01µF
                                                                   MOSI_A
                                                                   MISO_A       SQL5
                                                                                      0.1µF   0.01µF
                                                                   DEPEN
                                                                   IF3/V3       SQH6
                                                         10nF                         0.1µF   0.01µF
                                 ADC Input                         IF4/V4       SQL6
                                                         10nF                         0.1µF   0.01µF
                                                           12.5k                SQH7
                                                                   AOUT               0.1µF   0.01µF
                                                          220µF
                                                                   AOUT_GND
                                                                                SQL7
                                                                   TEST               0.1µF   0.01µF
                                                                   GND0
                                                                   GND1          ICH1
                                                                                      1000pF       Satellite Sensor
                                                                   GND2
                                                                   GND3          ICH2
                                                                                                   Satellite Sensor
                                                                   GND4               1000pF
                                                                   GND5          ICH3              Satellite Sensor
                                                                   GND6               1000pF       OR
                                                                                                   Hall Effect Switch
                                                                   GND7
                                                                                 ICH4              Satellite Sensor
                                                                   GND                1000pF       OR
                                                                                                   Hall Effect Switch
                                    Doc ID 14219 Rev 3                                                                7/64


Pin description                                                                                L9658
2           Pin description
Table 2.    Pin function
     Pin #       Pin name                       Description                     I/O type Reset state
       1            MSG   Message waiting                                        Output   Pull-down
       2            MISO  SPI data out                                           Output     Hi-Z
       3          MISO_A  Arming SPI data out                                    Output     Hi-Z
       4             NC   No connect                                                -          -
       5         RESETB   Reset pin                                               Input    Pull-up
       6            GND   Signal ground (analog & digital)                          -          -
       7            VDD   VDD supply voltage                                      Input        -
       8             NC   No connect                                                -          -
       9            CS_A  SPI chip select for arming interface                    Input   Pull-down
      10            CS_S  SPI chip select for satellite interface                 Input   Pull-down
      11            CS_D  SPI chip select for deployment driver                   Input   Pull-down
      12          DEPEN   Deployment enable                                       Input   Pull-down
      13            MOSI  SPI data in                                             Input     Hi-Z
      14          MOSI_A  Arming SPI data in                                      Input     Hi-Z
      15          SCLK_A  Arming SPI Clock                                        Input     Hi-Z
      16            SCLK  SPI clock                                               Input     Hi-Z
      17           GND4   Power ground for loop channel 4                           -          -
      18            SQL4  Low side driver output for channel 4                   Output   Pull-down
      19           SQH4   High side driver output for channel 4                  Output     Hi-Z
      20          VRES4   Reserve voltage for loop channel 4                      Input        -
      21          VRES5   Reserve voltage for loop channel 5                      Input        -
      22           SQH5   High side driver output for channel 5                  Output     Hi-Z
      23            SQL5  Low side driver output for channel 5                   Output   Pull-down
      24           GND5   Power ground for loop channel 5                           -          -
      25           GND6   Power ground for loop channel 6                           -          -
      26            SQL6  Low side driver output for channel 6                   Output   Pull-down
      27           SQH6   High side driver output for channel 6                  Output     Hi-Z
      28          VRES6   Reserve voltage for loop channel 6                      Input        -
      29          VRES7   Reserve voltage for loop channel 7                      Input        -
      30           SQH7   High side driver output for channel 7                  Output     Hi-Z
      31            SQL7  Low side driver output for channel 7                   Output   Pull-down
      32           GND7   Power ground for loop channel 7                           -          -
      33             NC   No connect                                                -          -
                          Current feedback for channel 4 raw or raw data output
      34           IF4/V4                                                        Output     Hi-Z
                          for channel 4
                          Current feedback for channel 3 raw or data output for
      35           IF3/V3                                                        Output     Hi-Z
                          channel 3
8/64                                     Doc ID 14219 Rev 3


L9658                                                                                      Pin description
Table 2.   Pin function (continued)
     Pin #      Pin name                          Description                      I/O type    Reset state
      36             NC      No Connect                                                -             -
      37           TEST      Test pin                                                Input      Pull-down
                             Supply voltage for satellite interface and resistance
      38         V8BUCK                                                              Input           -
                             measurement
      39             NC      No Connect                                                -             -
      40           ICH4      Current sense output for channel 4                     Output        Hi-Z
      41           ICH3      Current sense output for channel 3                     Output        Hi-Z
      42           ICH2      Current sense output for channel 2                     Output        Hi-Z
      43           ICH1      Current sense output for channel 1                     Output        Hi-Z
      44             NC      No connect                                                -             -
      45           IREF      External current reference resistor                    Output           -
      46       AOUT_GND Ground reference for AOUT                                      -             -
      47          AOUT       Analog output for loop diagnostics                     Output        Hi-Z
      48             NC      No Connect                                                -             -
      49          GND3       Power ground for loop channel 3                           -             -
      50           SQL3      Low side driver output for channel 3                   Output      Pull-down
      51          SQH3       High side driver output for channel 3                  Output        Hi-Z
      52          VRES3      Reserve voltage for loop channel 3                      Input           -
      53          VRES2      Reserve voltage for loop channel 2                      Input           -
      54          SQH2       High side driver output for channel 2                  Output        Hi-Z
      55           SQL2      Low side driver output for channel 2                   Output      Pull-down
      56          GND2       Power ground for loop channel 2                           -             -
      57          GND1       Power ground for loop channel 1                           -             -
      58           SQL1      Low side driver output for channel 1                   Output      Pull-down
      59          SQH1       High Side Driver Output for Channel 1                  Output        Hi-Z
      60          VRES1      Reserve voltage for loop channel 1                      Input           -
      61          VRES0      Reserve voltage for loop channel 0                      Input           -
      62          SQH0       High side driver output for channel 0                  Output        Hi-Z
      63           SQL0      Low side driver output for channel 0                   Output      Pull-down
      64          GND0       Power ground for loop channel 0                           -             -
2.1        Thermal data
           Table 3.       Thermal Data
                Symbol                                Parameter                         Value.      Unit
                Rth j-amb    Thermal resistance junction-to-ambient                      68        °C/W
                                            Doc ID 14219 Rev 3                                         9/64


Electrical specification                                                                         L9658
3            Electrical specification
3.1          Maximum ratings
             The device may not operate properly if maximum operating condition is exceeded.
Table 4.     Maximum operating conditions
  Symbol                                      Parameter                              Value       Unit
     VDD     Supply voltage                                                        4.9 to 5.1      V
   V8BUCK    V8BUCK voltage                                                         7 to 8.5       V
             VRES voltage (VRES0, VRES1, VRES2, VRES3, VRES4, VRES5,
    VRES                                                                               35          V
             VRES6, VRES7)
             Discrete input voltage (RESETB, DEPEN, CS_A, CS_D, CS_S, SCLK,
      VI                                                                      -0.3 to (VDD +0.3)   V
             SCLK_A, MOSI, MOSI_A, MISO, MISO_A)
      Tj     Junction temperature                                                 -40 to 150      °C
3.2          Absolute maximum ratings
Caution:     Maximum ratings are absolute ratings; exceeding any one of these values may cause
             permanent damage to the integrated circuit.
Table 5.     Absolute maximum ratings
  Symbol                                      Parameter                              Value       Unit
     VDD     Supply voltage                                                       -0.3 to 5.5      V
   V8BUCK    V8BUCK voltage                                                       -0.3 to 40       V
             VRES Voltage (VRES0, VRES1, VRES2, VRES3, VRES4, VRES5,
    VRES                                                                          -0.3 to 40       V
             VRES6, VRES7)
             Squib high and low side drivers (SQH0, SQH1, SQH2, SQH3, SQH4,
   SQL-H     SQH5, SQH6, SQH7,                                                    -0.3 to 40       V
             SQL0, SQL1, SQL2, SQL3, SQL4, SQL5, SQL6, SQL7)
             Discrete input voltage (RESETB, DEPEN, CS_A, CS_D, CS_S, SCLK,
      VI                                                                          -0.3 to 5.5      V
             SCLK_A, MOSI, MOSI_A, MISO, MISO_A)
    ICHx     Satellite input voltage (ICH1, ICH2, ICH3, ICH4)                       -3 to 40       V
      -      Analog/digital outputs voltage (AOUT, IREF, MSG, IF3V3, IF4V4)       -0.3 to 5.5      V
             Ground pins voltage (GND, AOUT_GND, GND0, GND1, GND2, GND3,
   GNDx                                                                           -0.3 to 5.5      V
             GND4, GND5, GND6, GND7)
      Tj     Maximum steady-state junction temperature                                150         °C
    Tamb     Ambient temperature                                                   -40 to 95      °C
     Tstg    Storage temperature                                                  -65 to 150      °C
10/64                                           Doc ID 14219 Rev 3


L9658                                                                                    Electrical specification
3.3              Electrical characteristics
3.3.1            DC characteristics
                 VRES = 6.5 to 35 V, VDD = 4.9 to 5.1 V, V8BUCK = 7.0 V to 8.5 V, Tamb = -40 °C to +95 °C
Table 6.         DC specification general
   Symbol                  Parameter                    Test condition              Min.     Typ    Max.    Unit
   VRST(1)                                    VDD drops until deployment drivers     4.0      -      4.5
                Internal voltage reset VDD                                                                   V
  VRST_L    (2)                               are disabled                           2.1      -      3.0
                                              Normal operation; ICH1-4 = 0 A         6.2      -      8.6
                                              Short to –0.3 V on SQH; ICH1-4 = 0 A   5.5      -      9.5
       IDD      Input current VDD                                                                           mA
                                              Short to –0.3 V on SQL; ICH1-4 = 0A    5.5      -      9.5
                                              Deployment; ICH1-4 = 0 A               5.5      -      9.5
   RIREF_H                                    -                                     20.0      -     60.0    k
                Resistance threshold IREF
   RIREF_L                                    -                                      2.0      -      9.0    k
 VIH_RESETB                                   -                                        -      -      2.0     V
                Input voltage threshold
 VIL_RESETB                                   -                                      0.8      -        -     V
                RESETB
     VHYS                                     -                                      100      -      400    mV
  VIH_DEPEN Input voltage threshold           -                                               -      2.0     V
  VIL_DEPEN DEPEN                             -                                      0.8      -        -     V
                Input pull-down current
       IPD                                    VIN = VIL to VDD                       10       -       50    A
                DEPEN
   VIH_TEST                                   -                                        -      -      3.6     V
                Input voltage threshold TEST
   VIL_TEST                                   -                                      0.8      -        -     V
     ITEST      Input pull-down current TEST TEST = 5 V                              1.0      -      2.5    mA
       IPU      Input pull-up current RESETB RESETB = VIH to GND                     10       -       60    A
                Current consumption
   IV8BUCK                                    -                                      25       -       40    µA
                V8BUCK
       VIH                                    Input logic = 1                          -      -      2.0     V
                Input voltage threshold MOSI,
       VIL      MOSI_A, SCLK, SCLK_A,         Input logic = 0                        0.8      -        -     V
                CS_S, CS_D, CS_A
     VHYS                                     -                                      100      -      400    mV
                Input leakage current MOSI,   VIN = VDD                                -      -        1    A
      ILKG
                MOSI_A, SCLK, SCLK_A          VIN = 0 to VIH                          -1      -        -    A
                Input pull-down current
       IPD                                    VIN = VIL to VDD                       10       -       50    A
                CS_S, CS_D, CS_A
      VOH       Output voltage MISO,          IOH = -800 A                        VDD–0.8    -              V
      VOL       MISO_A, MSG                   IOL = 1.6 mA                             -      -      0.4     V
                Tri-state current MISO,       MISO = VDD                               -      -        1    A
      IHI_Z
                MISO_A,                       MISO = 0 V                              -1      -        -    A
1. VRST shall have a POR de-glitch timer.
2. VRST L shall have no timer.
                                                 Doc ID 14219 Rev 3                                         11/64


Electrical specification                                                                             L9658
               VRES = 6.5 to 35 V, VDD = 4.9 to 5.1 V, V8BUCK = 7.0 V to 8.5 V, Tamb = -40 °C to +95 °C
Table 7.       DC Specification: deployment drivers
    Symbol              Parameter                      Test conditions              Min. Typ Max.    Units
                                            High saturation voltage;                VDD-
      VOH                                                                                 -     -      V
                                            IAOUT = -500 A                          0.4
               Output voltage AOUT
                                            Low saturation voltage;
       VOL                                                                            -   -   0.3      V
                                            IAOUT = +500 A
                                            AOUT = VDD                                -   -    1      A
         IZ    Tri-state current AOUT
                                            AOUT = 0 V                               -1   -     -     A
                                            V8BUCK = VDD = 0, VRES = 36 V,
      ILKG                                                                            -   -    50     A
                                            VSQH = 0V
               Leakage current SQH
                                            V8BUCK = 18 V; VDD = 5 V;
      ISTG                                                                           -5   -     -     mA
                                            VSQH = -0.3 V
                                            V8BUCK = 18 V; VDD = 5 V;
      ILKG     Bias current VRES(1)                                                   -   -    10     A
                                            VRES = 36 V; SQH shorted to SQL
      ILKG                                  V8BUCK = VDD = 0, VSQL = 18 V           -10   -    10     A
      ISTG     Leakage current SQL          V8BUCK = 18 V; VDD = 5 V; VSQL = -0.3 V  -5   -           mA
       ISTB                                 V8BUCK = 18 V; VDD = 5 V; VSQL = 18 V         -    5      mA
        IPD    Pull-down current SQL        VSQL = 1.8 V to VDD                     900   -  1300     A
    IPD_SQH    Pull-down current SQH        VSQH = SBTH to VRES                     900   -  1300     A
     VBIAS     Diagnostics Bias Voltage ISQH = -1.5 mA (nominal: 2.0 V)             1.80  -  2.20      V
      IBIAS    Diagnostics Bias Current VSQH = 0 V                                   -7   -           IPD
      VSTB     Short to battery threshold (Nominal 3.0 V)                           2.70  -  3.30      V
      VSTG     Short to ground threshold (Nominal 1.0 V)                            0.90  -  1.10      V
               MOS test load voltage
      VI_th                                 -                                       100   -   300     mV
               detection
               Resistance measurement
      ISRC                                  VDD = 5.0 V; V8BUCK = 7.0 V to 26.5 V    38   -    42     mA
               current source
               Resistance measurement
      ISINK                                 -                                        45   -    55     mA
               current sink
               Total high and low side      High side MOS + Low Side
     RDSon                                                                            -   -   2.0      
               MOS On resistance            MOS VRES = 6.9 V; I = 1.2 A @95 °C
               High side MOS on
     RDSon                                  VRES = 35V; IVRES = 1.2A; Tamb = 95°C     -   -   0.8      
               resistance
               Low side MOS on
     RDSon                                  VRES = 35V; IVRES = 1.2A; Tamb = 95°C     -   -   1.2      
               resistance
                                            MOSI register mode bit D10=”0”
   IDEPL_12A                                                                        1.20  -  1.47      A
                                            RLOAD = 1.7 VRES = 6.9 to 35 V
               Deployment current
                                            MOSI register mode bit D10=”1”
  IDEPL_175A                                                                        1.75  -  2.14      A
                                            RLOAD = 1.7 VRES = 12 to 35 V
       ILIM    Low side MOS current limit RLOAD = 1.7                              2.15  -   3.5      A
   RL RANGE    Load resistance    range(2)  -                                         0   -  10.0      
1. Not applicable during a diagnostic.
2. Test conditions for load resistance measurements
12/64                                              Doc ID 14219 Rev 3


L9658                                                                              Electrical specification
            VDD = 4.9 to 5.1V, V8BUCK = 7.0 V to 8.5 V, Tamb = -40 °C to +95 °C
Table 8.    Satellite interface DC specifications
 Symbol              Parameter                     Test conditions            Min     Typ     Max     Unit
                                         High side short to -0.3 V           (-)75     -     (-)150   mA
                                         High side short to Battery             -      -         5    mA
   I_Lim  Current limit
                                         V8BUCK =Vcc=0
                                                                                -      -        -1    mA
                                         measured @ V8BUCK
                                         I=50 mA @105 °C; V8BUCK=7.0 V          -      -         1     V
   Vhdp   High side voltage drop
                                         I=25 mA @105 °C; V8BUCK=7.0 V          -      -       0.5     V
                                         Iout = -50mA                         460      -      540     A
     IFr  IF/Iout CH3 & CH4
                                         Iout = -5mA                           46      -       54     A
                                         SPI channel configuration
                                         Bit <2:0111                        54.00     -     66.00    mA
                                         Bit <2:0110                        43.65     -     53.35    mA
                                         Bit <2:0101                        35.10     -     42.90    mA
          Low to high transition current
      Itr                                Bit <2:0100                        28.80     -     34.20    mA
          threshold
                                         Bit <2:0011                        24.85     -     29.15    mA
                                         Bit <2:0010                        20.25     -     24.75    mA
                                         Bit <2:0001                        17.10     -     20.90    mA
                                         Bit <2:0000                        14.85     -     18.15    mA
          IF/Vx CH3 & CH4 clamp          Rext=33.3 k; CHx is shorted to     0.95*           1.05*
  VCLAMP                                                                               -               V
          voltage                        GND                                  Vdd             Vdd
                                         Sink current = Ithr at the output
                                         (ICHX).
    Ihyst Current threshold hysteresis                                      0.05*Itr   -    0.15*Itr  mA
                                         Ihyst=trip point high – trip point
                                         low
     Vos  Short to BAT feedback current  V(ICHX)-V8BUCK<50mV                    -      -       25     mA
    Olkg  Output leakage current ICHX    V=18 V @ pin under test                -      -         1    A
                                           Doc ID 14219 Rev 3                                         13/64


Electrical specification                                                                               L9658
3.3.2           AC characteristics
                VRES = 6.5 to 35 V, VDD = 4.9 to 5.1 V, V8BUCK = 7.0 V to 8.5 V, Tamb = -40 °C to +95 °C
Table 9.        AC specification: deployment drivers
   Symbol                Parameter                          Test conditions          Min  Typ  Max      Unit
       tPOR    POR de-glitch timer               Timer for VRST                       10   -    25        s
    TGLITCH    De-glitch timer                   -                                     5   -    20        s
                                                 DEPEN pins asserted; Measured at
        ION    Diagnostic current                150 s from falling edge CS_D or    0.90  -     -     IFINAL
                                                 CS_A; See Figure 4
     tPULSE    Pulse stretch timer               See Table 17                          0   -    60       ms
     tP_ACC    Pulse stretch timer accuracy -                                        -20   -    20        %
 tDEPLOY-2ms Deployment time                     VRES = 6.9 to 35 V(1)                 2   -    2.5      ms
 tDEPLOY-1ms Deployment time                     VRES = 12 to 40 V(1)                  1   -   1.15      ms
   tFLT_DLY    Fault detection filter(2)         -                                    10   -    50        s
                                                                                                        mA-
      ISLEW    Rmeas current di/dt               10 % - 90 % of ISRC                   2   -     8      --------
                                                                                                         s
                                                 From the falling edge of CS to 10 %
     tR_DLY    Rmeas current delay                                                     -   -    15        s
                                                 of ISRC
                                                 Wait time before AOUT voltage is
    tR_WAIT    Rmeas wait time(2)                                                      -   -   100        s
                                                 stable for ADC reading
   tTIMEOUT    MOS diagnostic on-time            -                                     -   -    2.5      ms
               SQL high current protection
       tILIM                                     -                                    90   -   110        s
               timer
                                                 Time is measured from the valid
               LS/HS MOS turn off
  tPROP_DLY                                      LS/HS MOS fault to the LS/HS turn     -   -    10        s
               propagation delay(2)
                                                 off
1. Application Information; Test is not performed at high voltage.
2. Design Information Only
14/64                                                 Doc ID 14219 Rev 3


L9658                                                         Electrical specification
      Figure 3.         MOS settling time and turn-on time 1
                                IPEAK
                          110% IFINAL
                               IFINAL
                           90% IFINAL
                                                    tsettle
                                          tON
      Figure 4.         MOS settling time and turn-on time 2
          110% IFINAL
          IPEAK= IFINAL
            90% IFINAL
                                      tsettle = tON
                                           Doc ID 14219 Rev 3                    15/64


Electrical specification                                                                                 L9658
             VDD = 4.9 to 5.1 V; V8BUCK = 7.0 V to 8.5 V, Tamb = -40 °C to +95 °C
Table 10.    AC specifications: satellite
  Symbol               Parameter                       Test conditions             Min   Typ  Max       Unit
    Osc     Internal oscillator frequency     Tested with 12.5k 1% Iref resistor   4.45       5.55      MHz
                                              Manchester Protocol Excluding
                                              Osc tolerance
            De-glitch filter as a function of Bit<8:7 00
    Mdf                                                                           11.76   -   23.53
            protocol speed                    Bit<8:7 01
                                                                                  %*Bit-     % *Bit-     s
                                              Bit<8:7 10
                                                                                  Time        Time
                                              Bit<8:7 11
                                              Channel configurations
                                              Bit<8:7 00
                                              Test at frq = 52.33 kHz             13.32   -   52.33     kHz
                                              Test at frq =13.32 kHz
            Minimum frequency operating
            range                             Bit<8:701
                                              Test at frq =110.74 kHz             26.32   -  110.74     kHz
    Bitr    (Incoming messages fall           Test at frq = 26.32 kHz
            within this operating range is Bit<8:710
            guaranteed to be accepted by Test at frq =164.20 kHz                  43.50   -  164.20     kHz
            the IC)
                                              Test at frq = 43.50 kHz
                                              Bit<8:711
                                              Test at frq =250.63 kHz             62.66   -  250.63     kHz
                                              Test at frq = 62.66 kHz
                                              Channel configurations
                                              Bit<8:7 00
                                              Test at frq > 59.14 kHz             11.99   -   59.14     kHz
                                              Test at frq <11.99 kHz
            Maximum frequency
            operating range                   Bit<8:701
                                              Test at frq>128.37 kHz              23.57   -  128.37     kHz
    Bitr    (Incoming messages fall           Test at frq <23.57 kHz
            outside this operating range is Bit<8:710
            guaranteed to be rejected by Test at frq>194.93 kHz                   38.71   -  194.93     kHz
            the IC)
                                              Test at frq <38.71 kHz
                                              Bit<8:711
                                              Test at frq>309.6 kHz               55.37   -   309.6     kHz
                                              Test at frq <55.37 kHz
    Idle    Idle time                         Manchester                             2    -     -    Bit Times
                                              Test with12.5k 1% Iref resistor
                                              check response from changing
                                              between the following current
 Tdl & Tdh  IFx/Vx delay                      levels.                                -    1     -        s
                                              High =0-15 mA,
                                              Low = 66 to 150 mA
                                              ICHX outputs with a 500 s
  Tdl - Tdh IFx/Vx delay time differential                                           -    -    0.3       s
                                              symmetrical pulse in and 500s out.
     Flt    Output fault timer                I_sensor > I_lim                     300    -    500       s
16/64                                            Doc ID 14219 Rev 3


L9658                                                                                                              Electrical specification
              VRES = 6.5 to 35 V, VDD = 4.9 to 5.1 V. V8BUCK = 7.0 V to 8.5 V, Tamb = -40° C to +95 °C
              All SPI timing is performed with a 200 pF load on MISO unless otherwise noted.
Table 11.     SPI timing
    No.       Symbol                                    Parameter                                            Min       Typ       Max  Unit
      -           fop       Transfer frequency                                                                dc          -      5.50 MHz
      1          tSCK       SCLK, SCLK_A Period                                                              181          -        -   ns
      2         tLEAD       Enable lead time                                                                  65          -        -   ns
      3          tLAG       Enable lag time                                                                   50          -        -   ns
      4        tSCLKHS      SCLK, SCLK_A high time                                                            65          -        -   ns
      5        tSCLKLS      SCLK, SCLK_A low time                                                             65          -        -   ns
      6          tSUS       MOSI, MOSI_A input setup time                                                     20          -        -   ns
      7           tHS       MOSI, MOSI_A input hold time                                                      20          -        -   ns
      8            tA       MISO, MISO_A access time                                                            -         -       60   ns
      9           tDIS      MISO, MISO_A disable time (1)                                                       -         -      100   ns
     10           tVS       MISO, MISO_A output valid time                                                      -         -       66   ns
                                                                         (1)
     11           tHO       MISO, MISO_A output hold time                                                       0         -        -   ns
     12           tRO       Rise Time (Design Information)                                                      -         -       30   ns
     13           tFO       Fall Time (Design Information)                                                      -         -       30   ns
     14          tCSN       CS_A, CS_D, CS_S negated time                                                    640          -        -   ns
1. Parameters tDIS and tHO shall be measured with no additional capacitive load beyond the normal test fixture capacitance on
   the MISO pin. Additional capacitance during the disable time test erroneously extends the measured output disable time,
   and minimum capacitance on MISO is the worst case for output hold time.
              Figure 5.        SPI timing diagram
                                                                                                            tLAG            tCSN
                                     CS
                                                  tLEAD    tSCLKHS                              fOP
                                   SCLK
                                                                            tSCLKLS
                                                                                                                     tDIS
                                                                       tVS                  tHO
                                          tA
                                   MISO                 MSB OUT                   DATA           LSB OUT          DON'T
                                                                                                                  CARE
                                                                                                   tRO, tFO
                                             tSUS               tHS
                                   MOSI              MSB IN                      DATA           LSB IN
              Figure 6.        SPI timing measurement
                                                    VDD             +5 V
                                                                                     4.0 V
                                                                                                                  MISO
                                                        1k
                                         MISO                                         1.0 V
                                                                      0V
                                                        1k                                   tDIS
                                                                    CS
                                                         Doc ID 14219 Rev 3                                                            17/64


Functional description                                                                                L9658
4           Functional description
4.1         Overview
            L9658 is an integrated circuit to be used in air bag systems. Its main functions include
            deployment of air bags, switched-power sources to satellite sensors, diagnostics of SDM
            (Sensing Deployment Module) and arming inputs. L9658 supports 8 deployment loops, 4
            satellite-sensor interfaces, and SPI arming inputs.
4.2         Power on reset (POR)
            L9658 has a power on reset (POR) circuit, which monitors VDD voltage. When VDD voltage
            falls below VRST for longer than or equal to tPOR, all outputs are disabled and all internal
            registers are reset to their default condition.
            When VDD falls below VRST_L, all outputs are disabled and all internal registers are reset to
            their default condition. No delay filter shall be used along with VRST_L threshold.
            If VDD voltage falls below VRST for less than tPOR, operation shall not be interrupted.
            When VDD rises above VRST, the outputs are enabled. Before VDD reaches VRST, and during
            tPOR, none of the outputs turn on.
4.3         RESETB
            RESETB pin is active low. The effects of RESETB are similar to those of a POR event,
            except during a deployment. When L9658 has a deployment in-progress, it ignores
            RESETB signal.
            However, it shall shut itself down as soon as it detects a POR condition. When the
            deployment is completed and RESETB signal is asserted, the device disables its outputs
            and reset its internal registers to their default states.
            A de-glitch timer is provided to RESETB pin. The timer protects this pin against spurious
            glitches. UT48 neglects RESETB signal if it is asserted for shorter than tGLITCH. RESETB
            has an internal pull-up in case of an open circuit. This pin has a de-glitch timer
4.4         MSG
            MSG pin is used to reflect FIFO status. Its polarity can be configured and also the strategy
            of activation.
            Polling mode: Message pin shall be active as soon as one of the 4 FIFO will be not empty
            and it will be inactive when all 4 FIFO will be empty. A microcontroller can periodically
            monitor the status of line to understand there are data received from satellite. Interrupt
            mode: Message pin shall be active as soon one of the 4 FIFO will be not empty and it will be
            inactive when a spi communication on CS_S interface starts. At the end of the SPI
            communication it shall be active if one of the 4 FIFO will be not empty. Otherwise shall be
            kept inactive. A microcontroller can wait until an edge is present on the line and manage the
            data available in the FIFO.
18/64                                        Doc ID 14219 Rev 3


L9658                                                                        Functional description
4.5   IREF
      IREF pin shall be connected to VDD supply through a resistor, RIREF. When the device
      detects the resistor on IREF pin is larger than RIREF_H or smaller than RIREF_L, it goes in
      reset condition. All outputs are disabled and all internal registers are reset to their default
      conditions.
4.6   Loss of ground
      When GND pin is disconnected from PC-board ground, L9658 goes in reset condition. All
      outputs are disabled and all internal registers are reset to their default conditions. A loss of
      power-ground (GND0 – GND7) pin/s disables the respective channel/s. In other words, the
      channel that loses its power ground connection will not be able to deploy. The rest of the
      device is not affected by a loss of power-ground condition.
      AOUT_GND pin is a reference for AOUT pin. When AOUT_GND loses its connection the reset
      as well.
4.7   Deployment and reset
      The following conditions reset and terminate deployments:
      ●     Power On Reset (POR)
      ●     IREF resistance is larger than RIREF_H or smaller than RIREF_L
      ●     Loss of ground condition on GND pin
      The following conditions are ignored when it has a deployment in-progress:
      ●     RESETB
      ●     Valid soft reset sequences
4.8   Serial peripheral interface (SPI)
      The device contains a serial peripheral interface consisting of Serial Clock (SCLK,
      SCLK_A), Serial Data Out (MISO, MISO_A), Serial Data In (MOSI, MOSI_A), and two Chip
      Selects (CS_A, CS_D and CS_S). This device is configured as an SPI slave. The idle state
      of the communication, Serial Clock (SCLK, SCLK_A) should be low state.
                                      Doc ID 14219 Rev 3                                          19/64


Functional description                                                                               L9658
            Figure 7.     SPI block diagram
                                                              Status Bits
                                                                                   cs
                                            vdd
                                 SCLK                   Output Shift Register           MISO
                                                                                    vss
                                 MOSI                    Input Shift Register
                                 CS_D
                                 CS_S
                                      30µA         LSB                        MSB
                                                             Control Bits
                                           30µA
                                                              Status Bits
                                                                                   cs
                                            vdd
                               SCLK_A                                                   MISO_A
                               MOSI_A                      Shift Register           vss
                                 CS_A
                                      30µA         LSB                        MSB
                                                             Control Bits
            L9658 has a counter to verify the number of clocks in SCLK and SCLK_A. If the number of
            clocks in SCLK is not equal to 16 clocks while CS_D is asserted, it ignores the SPI message
            and send a SPI fault response. If the number of clocks in SCLK is not equal to 64 clocks
            while CS_S is asserted, it ignores the entire SPI message and push the Bad SPI Bit Count
            fault code into the FIFO. If the number of clocks in SCLK_A is not a multiple of 8, it ignores
            the command in the arming shift register. Otherwise, the device latch-in the command.
            Figure 8.     Arming daisy-chain configuration
                                                       CS_A                 CS_A          CS_A
                               CS
                                                      IC_1                 IC_2          IC_3
                               µP
                                   MOSI            MOSI_A                 MOSI_A        MOSI_A
                                                       MISO_A               MISO_A         MISO_A
                                   MISO
                                                     SCLK_A                SCLK_A        SCLK_A
                                   SCLK
            Arming SPI interface is based on 8-bit data transfer. The device is capable to receive a
            multiple of 8-bit commands. The first byte of data coming out of MISO_A will be the arming
            status bits. The subsequent bits will be the arming command bits received through MOSI_A
            pin. Refer to below figure for an example of arming SPI transmission. This is an example of
            arming SPI transmission based on the daisy-chain configuration.
            In case of daisy chain connection for Arming SPI, device works as following:
            All devices IC_1, IC_2, IC_3 shifted out data on the falling edge of SCLK_A for the first 8 bits
            and shifted out data on the rising edge of SCLK_A for the bits after 8bits. therefore µP, IC_3,
            IC_2 shall strobe 24bits on rising edge of SCLK_A, the first 8 bits are produced (by IC_3,
            IC_2, IC_1 respectively) on the falling edge of SCLK_A. the remaining 16 bits are shifted out
            on the rising edge.
20/64                                         Doc ID 14219 Rev 3


L9658                                                                                    Functional description
      Figure 9.        Arming SPI transmission
                             µP CS,
                         IC CS_A
                           µP MOSI,
                                                Command #1       Command #2         Command #3
                     IC_1 MOSI_A
                    IC_1 MISO_A,
                                               IC_1 Status       Command #1         Command #2
                     IC_2 MOSI_A
                    IC_2 MISO_A,
                                               IC_2 Status      IC_1 Status         Command #1
                     IC_3 MOSI_A
                    IC_3 MISO_A,
                                               IC_3 Status      IC_2 Status        IC_1 Status
                            µP MOSI
                                             MSB                                               LSB
4.8.1 Chip select (CS_A, CS_D, CS_S)
      Chip-select inputs select L9658 for serial transfers. CS_A is independent to CS_D and
      CS_S.
      CS_A can be asserted regardless of CS_D and CS_S. However, either CS_D or CS_S can
      be asserted at any given time. If both CS_D and CS_S inputs are selected simultaneously,
      the device ignores MOSI command. When chip-select is asserted, the respective
      MISO/MISO_A pin is released from tri-state mode, and all status information is latched in
      the SPI shift register. While chip-select is asserted, register data is shifted into
      MOSI/MOSI_A pin and shifted out of MISO/MISO_A pin on each subsequent
      SCLK/SCLK_A. When chip-select is negated, MISO/MISO_A pin is tri-stated. To allow
      sufficient time to reload the registers; chip-select pin shall remain negated for at least tCSN.
      Chip-select is also immune to spurious pulses of 50 ns or shorter (MISO/MISO_A may
      come out of tri-state, but no status bits is cleared and no control bits is changed).
      Chip-select inputs have current sinks on the pins, which pull these pins to the negated state
      when an open circuit condition occur. These pins have TTL level compatible input voltages
      allowing proper operation with microprocessors using a 3.3 to 5.0 V supply.
4.8.2 Serial clock (SCLK, SCLK_A)
      SCLK/SCLK_A input is the clock signal input for synchronization of serial data transfer. This
      pin has TTL level compatible input voltages allowing proper operation with microprocessors
      using a 3.3 to 5.0 V supply. When chip select is asserted, both the SPI master and this
      device shall latch input data on the rising edge of SCLK/SCLK_A. L9658 shift data out on
      the falling edge of SCLK/SCLK_A. The SCLK/SCLK_A must be taken in idle state (LOW)
      when the CS_A,CS_D,CS_S are in idle state (LOW). (a)
4.8.3 Serial data output (MISO, MISO_A)
      MISO/MISO_A output pin shall be in a tri-state condition when chip select is negated. When
      chip select is asserted, the MSB is the first bit of the word/byte transmitted on
      MISO/MISO_A and the LSB is the last bit of the word/byte transmitted. This pin supplies a
      rail to rail output, so if interfaced to a microprocessor that is using a lower VDD supply, the
      appropriate microprocessor input pin shall not sink more than IOH (min) and shall not clamp
      the MISO/MISO_A output voltage to less than VOH (min) while MISO/MISO_A pin is in a
      logic “1” state.
      a. Only in daisy chain, it is needed to guarantee on SCLK_A a clock skew of 3ns maximum between any devices.
                                             Doc ID 14219 Rev 3                                             21/64


Functional description                                                                              L9658
4.8.4       Serial data input (MOSI, MOSI_A)
            MOSI/MOSI_A input takes data from the master processor while chip select is asserted.
            The MSB shall be the first bit of each word/byte received on MOSI/MOSI_A and the LSB
            shall be the last bit of each word/byte received. This pin has TTL level compatible input
            voltages allowing proper operation with microprocessors using a 3.3 to 5.0 V supply.
4.9         Deployment drivers
            The on-chip deployment drivers are designed to deliver 1.2 A (min) at 6.9 V VRES.
            Deployment current is be 1.2 A (min) for 2 ms (min). The high side driver survives
            deployment with 1.47 A, 35 V at VRES and SQL is shorted to ground for 2.5ms. Minimum
            load resistance is 1.7. At the end of a deployment, a deploy success flag is asserted via SPI.
            Each VRES and GND connection are used to accommodate 8 loops that can be deployed
            simultaneously.
            Upon receiving a valid deployment condition, the respective SQH and SQL drivers are
            turned on. SQH and SQL drivers are also turned on momentarily during a MOS diagnostic.
            Otherwise, SQH and SQL are inactive under any normal, fault, or transient conditions. Upon
            a successful deployment of the respective SQH and SQL drivers, a deploy command
            success flag is asserted via SPI. Refer to "deployment sequence" figure for the valid
            condition and the deploy success flagh timing.
            Figure 10. Deployment drivers diagram
                                                               spi       por
                                           test                                        DEPEN
                                        vbuck8                                         AOUT
                                                                   Logic
                                            iref
                                       VRES0                                           VRES2
                                                          HSD               HSD
                                                       Isense                   Isense
                                         SQH0                                          SQH2
                                                       Diagnostic         Diagnostic
                                         SQL0                                          SQL2
                                                           LSD              LSD
                                                       Isense                   Isense
                                         GND0                                          GND2
                                         arm01            ARM01             ARM23      arm23
                                       VRES1                                           VRES3
                                                          HSD               HSD
                                                       Isense                   Isense
                                         SQH1                                          SQH3
                                                       Diagnostic         Diagnostic
                                         SQL1                                          SQL3
                                                           LSD              LSD
                                                       Isense                   Isense
                                         GND1                                          GND3
                                       VRES4                                           VRES6
                                                          HSD               HSD
                                                       Isense                   Isense
                                         SQH4                                          SQH6
                                                       Diagnostic         Diagnostic
                                         SQL4                                          SQL6
                                                           LSD              LSD
                                                       Isense                   Isense
                                         GND4                                          GND6
                                         arm45            ARM45             ARM67      arm67
                                       VRES5                                           VRES7
                                                          HSD               HSD
                                                       Isense                   Isense
                                         SQH5                                          SQH7
                                                       Diagnostic         Diagnostic
                                         SQL5                                          SQL7
                                                           LSD              LSD
                                                       Isense                   Isense
                                         GND5                                          GND7
22/64                                            Doc ID 14219 Rev 3


L9658                                                                                                                                                           Functional description
      The following power-up conditions is considered as normal operations. VRES input can be
      connected to either a power supply output or an ignition voltage. VDD is connected to 5 V
      output of power supply. When VRES is connected to the power supply, VDD voltage will
      reach its regulation voltage before VRES voltage is stabilized. In this condition, the device
      has the control o f its internal logic and that prevent an inadvertent turn-on of the drivers.
      When VRES is connected to the ignition, VRES voltage will be stabilized before VDD
      reaches its regulation voltage. In this condition, all drivers are inactive. A pull-down on the
      gates of high side drivers (SQH) is provided to prevent these drivers from momentarily
      turning-on. Any loop driver fault conditions do not turn on the SQH and SQL drivers. Only a
      valid deployment condition can turn on the respective SQH and SQL drivers. Refer to
      section for valid deployment conditions.
4.9.1 Arming interface
      The arming interface is used as a fail-safe to prevent inadvertent airbag deployment. Along
      with deployment command, these signals provide redundancy. Pulse stretch timer is
      provided for each channel/loop. Either ARM signal or deployment command shall start the
      pulse stretch timer.
      Arming interface has a dedicated 8-bit SPI interface.
      When CS_A is negated, L9658 latch ARM signal from the shift register and start the pulse
      stretch timer for the respective channel/s. The device can deploy a channel, ONLY when
      DEPEN is asserted and any of the following conditions are satisfied:
                 –          the respective deployment command is sent during a valid pulse stretch timer,
                            which initiated by ARM signal
                 –          the respective SPI ARM command is sent during a valid pulse stretch timer, which
                            initiate by deployment command
      During a deployment, the device turn on the respective high side (SQH) and low side (SQL)
      drivers for duration of tDEPLOY. When a deployment is initiated, it cant be terminated, except
      during a reset event.
      Figure 11. Deployment sequence
                          CS_A       A          B              A        A                 B                 A            B                     A       B                              A          B
          Pulse Stretch Timer               tPULSE                 t<tPULSE tPULSE                              tPULSE                t<tPULSE  tPULSE                    t < t PULSE     t<tPULSE
             ARM Status Flag
                         CS _D                 1       3                      1       3             2     1     1                1          1                2       1              3
                         Deploy                    tDEPLOY                                                       tDEPLOY
        SPI Deploy Command
                    Status Flag
         Deploy Success Flag
           Deploy Status Flag
         Monitor Mode Command bit
                           D8 = 0
           Deploy Status Flag
         Monitor Mode Command bit
                           D8 = 1
                                            Valid                                                               Valid                                                       Valid          Valid
                                         Deployment                                                          Deployment                                                 Deployment      Deployment
                                           Window                                                              Window                                                     Window         Window
                SPI CS_D Notes:                                                                                            ARMEN Notes:
                1: Deployment-enable Command 2: Clear Deploy Success Flag         3: Deployment-disable Command            A: Arming-enable Command     B: Arming-disable Command
                DEPEN input is assumed to be active in this sequence.
      When a deployment-enable command is sent through SPI, the pulse stretcher shall be
      initiated immediately following the falling edge of CS_D. When another deployment-enable
                                                                              Doc ID 14219 Rev 3                                                                                                   23/64


Functional description                                                                                                                      L9658
            command is sent before the timer for the previous command expired, the timer is refreshed.
            Sending a deployment-disable command will terminate the pulse stretch timer operation.
            ONLY a timer operation started by a deployment-enable command can be terminated. A
            deployment-en/disable command does not affect the timer operation started by arming
            signal.
            When an arming-enable command is sent through SPI, the pulse stretcher is initiated
            immediately following the falling edge of CS_A. When another arming-enable command is
            sent before the timer for the previous command expired, the timer is refreshed. Sending an
            arming disable command terminate the pulse stretch timer operation. ONLY a timer
            operation started by an arming-enable command can be terminated. An arming-en/disable
            command does not affect the timer operation started by a valid deployment command.
Figure 12. Deployment flow chart
                                            BEGIN                                                                           BEGIN
                                          Arming SPI        N           SPI MOSI         N                        N        SPI MOSI
                                         Transmission               Command Mode                                         Monitor Mode
                                                  Y                            Y                                                 Y
                                  N                                                      N                        N
              MISO_A.Arm.St = 0        MOSI_A.Arm = 1                MOSI.Depl = 1         MISO.Depl.Cmd.St = 0      MOSI.Clr.Scs.Flg = 1
                                                  Y                            Y                                                 Y
                                       MISO.Arm.Flg = 1           MISO.Depl.Cmd.St = 1                              Deploy Success Flag = 0
                                      MISO_A.Arm.St = 1
                                         Start/Refresh
                                      Pulse Stretch Timer                                N
                                                                    MISO.Depen = 1
                                  Y   Pulse Stretch Timer                      Y
                MISO.Arm.Flg = 0
                                            Expired                   Start/Refresh
                                                                   Pulse Stretch Timer
                                                  N
                                  N        SPI MOSI                                      Y
                                       Command Mode                Pulse Stretch Timer
                                                                         Expired
                                                  Y                            N
                                  N                                    Arming SPI        N
             MISO.Depl.Cmd.St = 0       MOSI.Depl = 1
                                                                      Transmission
                                                  Y                            Y
           N       Arming SPI        MISO.Depl.Cmd.St = 1
                  Transmission                                                           N
                                                                    MOSI_A.Arm = 1          MISO_A.Arm.St = 0
                          Y
                                                            N                  Y
                                       MISO.Depen = 1
           Y                                                                                      SPI MOSI      N
                MOSI_A.Arm = 1                                     MISO_A.Arm.St = 1
                                                                                               Command Mode
                                                  Y
                          N                                                                             Y
                MISO.Arm.Flg = 0        Deploy Success      Y  N
              MISO_A.Arm.St = 0             Flag = 1                MISO.Depen = 1
                                                                                                                Y
                                                                                                MOSI.Depl = 1
                   Terminate                      N                            Y
              Pulse Stretch Timer       Deploy Flag = 1                                                 N
                                                               Y     Deploy Success
                                                                         Flag = 1          MISO.Depl.Cmd.St = 0
                                    Turn on LS and HS FET
                                                                               N                  Terminate
                                                                     Deploy Flag = 1        Pulse Stretch Timer
                                  N
               Ignore SPI MOSI1         tDEPLOY Expired
                                                                 Turn on LS and HS FET
                                                  Y
              Ignore Arming SPI
                                    Deploy Success Flag = 1
                                                                                         N
                                                                     tDEPLOY Expired          Ignore SPI MOSI1
                                                                               Y
                                                                                             Ignore Arming SPI
                                                                 Deploy Success Flag = 1
Note:       MOSI Register Mode: ignored. Next MISO: SPI fault response
            MOSI Command Mode: execute for channels NOT in deployment, NO effect to deploying
            channel. Next MISO: Command mode response
            MOSI Diagnostic Mode: ignored. Next MISO: SPI fault response
            MOSI Monitor Mode: execute for all channels. Next MISO: Status response
24/64                                                         Doc ID 14219 Rev 3


L9658                                                                             Functional description
      During the deployment, L9658 turn on the respective high (SQH) and low side (SQL) drivers
      for tDEPLOY. Once deployment is initiated it can not be terminated. When a channel is in
      deployment, this particular channel shall only act upon certain SPI messages. These SPI
      messages and their responses are summarized in below table. The rest of the channels
      shall resume their operations and respond to specific SPI commands.
      During a deployment, the device ignores arming commands. and does not refresh or
      terminate the pulse stretch timer when it receives an arming command.
      Table 12.     SPI transmission during a deployment
              SPI MOSI                  SPI MISO(1)                            Notes
       Register mode             SPI fault response      MOSI register mode message shall be ignored
                                                         Execute for channels not in deployment; no effect
       Command mode              Command mode
                                                         to deploying channel
       Diagnostic mode           SPI fault response      MOSI diagnostic mode message shall be ignored
       Monitor mode              Status response         Execute for all channels
      1. SPI MISO sent in the next SPI transmission.
4.10  DEPEN
      DEPEN is a deployment enable input, which is an active high input. When this pin is
      asserted, L9658 is able to turn on its high and low side drivers upon receiving a valid
      deployment command or a MOS diagnostic request. DEPEN can not interrupt a deployment
      that is already in-progress.
      When DEPEN is negated, it inhibits the low side and the high side MOS from turning on
      (inhibit the deployment). When a MOS diagnostic is requested, the device executes the
      diagnostic even without the ability to turn on the MOS. It set the proper SPI threshold bits.
      SPI remains functional while this pin is pulled low.
      When DEPEN is negated, SPI deploy command is prevented from initiating the pulse stretch
      timer. Regardless of DEPEN, SPI deploy command status bits reports the state of SPI
      deploy command bits sent in the previous SPI transfer. This feature is required so that the
      processor can diagnose SPI deploy command bits with DEPEN negated.
      Regardless of DEPEN, arming signal is able to initiate the pulse stretch timer. This feature
      will be used for the processor to diagnose the arming signal.
      When the pulse stretch timer has been running, changes in the state of DEPEN does not
      affect the pulse stretch timer. The pulse stretch timer is not affected regardless of the pulse
      stretch timer being started by an arming signal or a SPI deploy command.
      A de-glitch timer is provided to DEPEN pin. The timer protects this pin against spurious
      glitches. The device neglects DEPEN signal if it is asserted/negated for shorter than
      tGLITCH.
                                          Doc ID 14219 Rev 3                                          25/64


Functional description                                                                                      L9658
4.10.1      Deployment driver diagnostic
            L9658 is able to perform a short to battery, a short to ground, a resistance measurement
            and a MOS diagnostics on its deployment drivers. A short to ground and an open circuit
            conditions are distinguished using a resistance measurement. Here below is shown the
            diagram of deployment driver diagnostic.
            The diagnostic is performed when a valid SPI command is received. Each current sources
            (ISRC and IBIAS) and current sinks (ISINK, IPD_SQH) are turn on or off by a SPI command.
            IPD_SQH is turned on when IBIAS is turned on. This pull-down (IPD_SQH) is used to deplete
            the charge left on the SQH and SQL capacitors. IPD is permanently connected to SQL. This
            current sink pull-down SQL pin during an open circuit condition.
            Diagnostic current source or sink and comparator or amplifier are independent. It is possible
            to turn on or off the current source or sink on a specific channel, while monitoring the
            comparator or amplifier on a different channel. This feature is used to run a short between
            loop diagnostic.
            Figure 13. Deployment driver diagnostic diagram
                                                      AMP            v8buck     VBIAS
                        AOUT        AMux           Resistance            ISRC       IBIAS         VRESx
                                                Measurement
                                                         SBth
                                                                                                  SQHx
                          CS
                                                        SGth
                        SCLK                                                              IPD_SQH
                                     SPI                                                          SQLx
                        MISO                        CMP1
                                                 Over-current  VI_TH
                        MOSI
                                                     Detection            ISINK      IPD
                                  Diagnostic                                                       GNDx
                                    Logic       Gate Drive
                                                                                                    AC00211
26/64                                        Doc ID 14219 Rev 3


L9658                                                                                              Functional description
4.10.2 Continuity diagnostic
       A continuity diagnostic includes a short to battery, a short to ground and an open circuit
       diagnostics.
       During a continuity diagnostic, IBIAS is switched on. On a normal loading condition, SQH
       voltage is below SBTH threshold and SQL voltage will be above SGTH threshold.
       Figure 14. Continuity diagnostic flow chart
                                      BEGIN
                                 SPI Command:
                                   Connect IBIAS
                                    SQH > SBth        N         SQH < SBth     N
                                   during tFLT_DLY             during tFLT_DLY
                                       Y                           Y
                                Set SPI.Diag.SBTH          Clear SPI.Diag.SBTH
                                                                SQL < SGth     N      SQL > SGth
                                                               during tFLT_DLY       during tFLT_DLY
                                                                   Y                     Y
                                                            Set SPI.Diag.SGTH     Clear SPI.Diag.SGTH
                           N
                                SPI Transmission
                                       Y                Note:
                                  SPI Response:           tFLT_DLY= 20μs
                             Send SBth and SGth bits
                                                         SPI Transmission and SPI
                                                         Command can be sent in
                             Clear SBth and SGth bits    the same CS_D.
                           N     SPI Command:
                                 Disconnect IBIAS
                                       Y
                                 Disconnect IBIAS
                                        END
4.10.3 Short to battery
       A short to battery condition will be detected when the voltage on SQH is greater than SBTH
       threshold voltage.
4.10.4 Short to ground and open circuit
       A short to ground or an open circuit conditions are detected when the voltage on SQL is less
       than SGTH threshold voltage. A resistance measurement is utilized to differentiate between
       a short to ground or an open circuit conditions.
                                                Doc ID 14219 Rev 3                                                  27/64


Functional description                                                                               L9658
4.10.5      Resistance measurement
            During a resistance measurement, both ISRC and ISINK are switched on. An analog
            voltage on AOUT pin is provided. AOUT pin is a 5 V analog pin, which will be connected to the
            ADC input of a processor. This pin provides the resistance-measurement voltage, which
            correspond to the voltage difference across SQH and SQL. According to the following
            formula:
                                           Vaout = VDD/10 + Rsquib · Isrc · 10
            The accuracy in the range of Rsquib is classified as followings:
                     0 < Rsquib  3.5         ±95 mV
                     3.5 < Rsquib  10        ±5 %
            A low pass filter (10 k + 330 pF) is recommended in order to cancel noise caused by
            internal offset compensation.
            Figure 15. Resistance measurement flow chart
                                                             BEGIN
                                                         SPI Command:
                                                         Enable AOUT,
                                                       Turn on ISRC & ISINK
                                                   N     SPI Command:
                                                       Turn off ISRC & ISINK
                                                             Y
                                                       Turn off ISRC & ISINK
                                                              END
4.10.6      MOS diagnostics
            During diagnostic, IBIAS is connected to SQH pin. In a normal condition, SQH voltage is
            below SBTH and SQL voltage will be higher than SGTH. Prior to turning on the MOS, the
            processor is expected to check for a short to battery and a short to ground fault. This step is
            intended to prevent a large amount of current flowing through the MOS. Also, this step is
            intended to precondition SQH and SQL pins prior to diagnostics. DEPEN pin is asserted in
            order to turn on the low or high side driver. If DEPEN is negated during diagnostic, the MOS
            is not turned on and a fail MOS diagnostic is expected.
4.10.7      Low side MOS diagnostic
            When L9658 receives a SPI command to initiate the low side driver diagnostic, verification
            of following conditions are done before turning on the low side driver:
                  –    VSQL greater than SGTH threshold voltage
                  –    VSQH less than SBTH threshold voltage
            If both conditions above are satisfied, execution of low side driver diagnostic is performed.
            Otherwise, the low side MOS diagnostic request is ignored and both bit D13 and bit D7 in
            SPI diagnostic mode response are set. Upon detection of the following conditions, the
28/64                                       Doc ID 14219 Rev 3


L9658                                                                                                                                Functional description
      device turns the low side driver off and terminate the diagnostic within the specified time,
      tPROP_DLY.
           –    VSQL less than SGTH threshold voltage
           –    (VSQHx – VSQLx) greater than VI_TH
           –    VSQH greater than SBTH threshold voltage
      The state of each comparator above is reported through SPI. When the device detects one
      of the above conditions, the respective SPI status bit to indicate the condition is set. Any of
      the above conditions will be considered as normal in a low side MOS diagnostic.
      The low side driver is turned off when tTIMEOUT is expired. A fault detection filter, tFLT_DLY, is
      provided to protect against short-transients on SQH and SQL pins.
      Figure 16. Low side diagnostic flow chart
                                                      BEGIN
                                                  SPI Command:
                                                   Connect IBIAS
                                                    SQH > SBth        N           SQH < SBth      N
                                                   during tFLT_DLY               during tFLT_DLY
                                                      Y                              Y
                                                Set SPI.Diag.SBTH            Clear SPI.Diag.SBTH
                                                                                  SQL < SGth      N      SQL > SGth
                                                                                 during tFLT_DLY       during tFLT_DLY
                                                                                     Y                      Y
                                                                              Set SPI.Diag.SGTH     Clear SPI.Diag.SGTH
                                         N
                                                SPI Transmission
                                                      Y
                                                                          Note:
                                                  SPI Response:
                                            Send SBth and SGth bits         tFLT_DLY= 20μs
                                                                           tTIMEOUT = 2ms
                                            Clear SBth and SGth bits       SPI Transmission and SPI
                                                                           Command can be sent in
                                                                           the same CS_D.
                                         Y        SPI Command:
                                                 Disconnect IBIAS
                                                      N
                                         N        SPI Command:
                                                   LS FET Test
                     Set SPI.Diag.SBTH                      Y
                            AND
                                         N        SPI Command:
                     Set SPI.Diag.SGTH          D6..D4 == D2..D0
                            AND
                      Set SPI.Diag.VI_TH                    Y
                                         N         SQH < SBTH
                                                        AND
                                                    SQL > SGTH
                                                            Y
                     Set SPI.Diag.SBTH           Turn on LS FET
                            AND
                     Set SPI.Diag.SGTH
                                                                                                                            N
                                               (SQH-SQL) > VI_TH
                                                        OR            N                                                SPI Command
                                                   SQH > SBTH                                                        Diag Mode D11=0  Y
                                                   during tFLT_DLY                                                          OR
                                                                                                                    Cmd Mode Message
                                                                                SQL < SGTH       N
                                                       Y                       during tFLT_DLY
                                                Set SPI.Diag.VI_TH                                    t > tTIMEOUT
                                                                                                                          N
                                                        OR
                                                                                   Y
                                                Set SPI.Diag.SBTH           Set SPI.Diag.SGTH                  Y
                                               Switch OFF LS FET
                                         N
                                                SPI Transmission
                                                      Y
                                                  SPI Response:
                                         Send VI_TH, SBTH and SGTH bits
                                         Clear VI_TH, SBTH, and SGTH bits
                                         N        SPI Command:
                                                 Disconnect IBIAS
                                                      Y
                                                 Disconnect IBIAS
                                                        END
                                                       Doc ID 14219 Rev 3                                                                             29/64


Functional description                                                                                  L9658
4.10.8      High side MOS diagnostic
            When L9658 receives a SPI command to initiate the high side MOS diagnostic, the following
            conditions are verified before turning on the high side MOS:
                  –    VSQL greater than SGTH threshold voltage
                  –    VSQH less than SBTH threshold voltage
            If both conditions above are satisfied, the high side MOS diagnostic is executed. Otherwise,
            it ignored and both bit D13 and bit D7 in SPI diagnostic are set.
            Upon detection of the following conditions, the high side driver is turned off and the
            diagnostic, within the specified time, tPROP_DLY, is terminated
                  –    VSQH greater than SBTH threshold voltage
                  –    (VSQHx – VSQLx) greater than VI_TH
                  –    VSQL less than SGTH threshold voltage
            The state of each comparator above is reported through SPI. When L9658 detects one of
            the above conditions, it set the respective SPI status bit to indicate the condition. Any of the
            above conditions will be considered as normal in a high side MOS diagnostic.
            The high side driver is turned off when tTIMEOUT is expired. A fault detection filter, tFLT_DLY, is
            provided to protect against short-transients on SQH and SQL pins.
4.10.9      Loss of ground
            When any of the power grounds (GND0 – 7) are lost, no deployment can occur to the
            respective deployment channels. A loss of ground condition on one or several channels will
            not affect the operation of the remaining channels.
            When a loss of ground condition occurs, the source of the low side MOS will be floating. In
            this case, no current will flow through the low side driver.
            This condition will be detected as a fault by a low side MOS diagnostic. Also, the resistance
            measurement result will be on the low end of the resistance range.
30/64                                        Doc ID 14219 Rev 3


L9658                                                                                                      Functional description
      Figure 17. High side driver diagnostic flow chart
                                                  BEGIN
                                              SPI Command:
                                               Connect IBIAS
                                                SQH > SBth        N           SQH < SBth      N
                                               during tFLT_DLY               during tFLT_DLY
                                                   Y                             Y
                                            Set SPI.Diag.SBTH            Clear SPI.Diag.SBTH
                                                                              SQL < SGth      N      SQL > SGth
                                                                             during tFLT_DLY       during tFLT_DLY
                                                                                 Y                      Y
                                                                          Set SPI.Diag.SGTH     Clear SPI.Diag.SGTH
                                     N
                                             SPI Transmission
                                                   Y                  Note:
                                              SPI Response:             tFLT_DLY= 20μs
                                        Send SBth and SGth bits
                                                                       tTIMEOUT = 2ms
                                        Clear SBth and SGth bits       SPI Transmission and SPI
                                                                       Command can be sent in
                                                                       the same CS_D.
                                     Y        SPI Command:
                                              Disconnect IBIAS
                                                  N
                                     N        SPI Command:
                                               HS FET Test
                  Set SPI.Diag.SBTH                   CY
                        AND
                                     N        SPI Command:
                  Set SPI.Diag.SGTH          D6..D4 == D2..D0
                        AND
                  Set SPI.Diag.VI_TH                    Y
                                     N          SQH < SBTH
                                                    AND
                                                SQL > SGTH
                                                        Y
                  Set SPI.Diag.SBTH          Turn on HS FET
                        AND
                  Set SPI.Diag.SGTH
                                                                                                                        N
                                            (SQH-SQL) > VI_TH
                                                    OR            N                                                SPI Command
                                                SQL < SGTH                                                       Diag Mode D11=0 Y
                                               during tFLT_DLY                                                          OR
                                                                                                                Cmd Mode Message
                                                                            SQH > SBTH       N
                                                                           during tFLT_DLY
                                                   Y
                                            Set SPI.Diag.VITH                  Y                  t > tTIMEOUT
                                                                                                                      N
                                                    OR
                                           Set SPI.Diag.SGTH            Set SPI.Diag.SBTH
                                                                                                     Y
                                           Switch OFF HS FET
                                     N
                                             SPI Transmission
                                                   Y
                                              SPI Response:
                                     Send VI_TH, SBTH and SGTH bits
                                     Clear VI_TH, SBTH, and SGTH bits
                                     N        SPI Command:
                                              Disconnect IBIAS
                                                   Y
                                              Disconnect IBIAS
                                                    END
                                             Doc ID 14219 Rev 3                                                                    31/64


Functional description                                                                            L9658
4.11        Deployment driver SPI bit definition
            The SPI provides access to read/write to the registers internal to the device, which
            responses to various deployment driver commands summarized in table below.
            L9658 response to the previous command is sent in the next valid CS_D.
            Table 13.    Deployment driver SPI response
                Mode bits                                    Mode bits
                                  MOSI command                                      MISO response
              D15      D14                              D15     D14     D13
               0         0    Register Mode               0       0      0    Register Mode
               0         1    Command Mode                0      1       0    Command Mode
               1         0    Diagnostic Mode             1      0       X    Diagnostic Mode
               1         1    Monitor Mode                1      1       0    Status Response
               X         X    SPI Transmission Fault      1       1      1    SPI Fault Response
4.11.1      Deployment driver MOSI bit definition
Table 14.   MOSI bit layout
 MSB                                                                                               LSB
  D15   D14    D13    D12   D11    D10    D9     D8   D7     D6     D5     D4     D3     D2    D1   D0
            MOSI mode bits are defined as shown in below table.
            Table 15.    MOSI mode bits definition
                   Bit D15                 Bit D14                           Description
                       0                      0            Register Mode
                       0                      1            Command Mode
                       1                      0            Diagnostic Mode
                       1                      1            Monitor Mode
32/64                                     Doc ID 14219 Rev 3


L9658                                                                           Functional description
4.11.2 Deployment driver register mode
       Register Mode message are defined here below.
       Table 16.      MOSI register mode message definition
                    Bit                       State                           Description
                   D15                          0
                                                             Mode bits
                   D14                          0
                   D13                                       Odd parity
                                                0            Read (default)
                   D12
                                                1            Write
                                                0            Pulse Stretch Timer Period
                   D11
                                                1            Soft Reset Sequence
                                                             Deployment Condition: IDEPLOY_12A and
                                                0
                                                             tDEPLOY_2ms
                   D10
                                                             Deployment Condition: IDEPLOY_175A and
                                                1
                                                             tDEPLOY_1ms
                    Bit                       State          Description
                    D9                          -
                                                             Pulse Stretch timer (see table 17)
                    D8                          -
                    D7                          -
                    D6                          -
                    D5                          -
                    D4                          -
                                                             Soft Reset Sequence
                    D3                          -
                    D2                          -
                    D1                          -
                    D0                          -
       Odd parity check includes all 16 bits. “Don’t care” bit is included in the parity check as well.
       When bit D12 is set to ‘0,’ device ignores bit D11 through bit D0. This is a read request. In
       the next valid CS_D, a register mode response will contain the pulse stretch timer register.
       If bit D12 is set to ‘1,’ bit D11 determines whether the message is intended to program the
       duration of the pulse stretch timer or to address the soft reset sequence.
       When bit D11 is set to ‘0,’ device ignores bit D7 through bit D0. When bit D11 is set to ‘1,’ bit
       D9 and bit D8 will be ignored.
       Bit D10 is used to select between two deployment conditions. When bit D10 is set to 0,
       deployment events on all channels shall have the deployment current of IDEPL_12A and the
       deployment period of tDEPL_2ms. When bit D10 is set to 1, deployment events on all channels
       shall have the deployment current of IDEPL_175A and the deployment period of tDEPL_1ms. The
       default state of this bit shall be %0.
                                          Doc ID 14219 Rev 3                                        33/64


Functional description                                                                                L9658
            Bit D9 and bit D8 are used to set the period of pulse stretch timer.
            The device have 8 independent timers. Either a valid arming signal or a SPI deployment
            command is able to start the pulse stretch timer. These bits will set the timer duration. These
            values default to %00 after a POR event.
            Table 17.     Pulse stretch timer
                       Bit D9                   Bit D8                        Stretch period (ms)
                          0                        0                                  7.5
                          0                        1                                   15
                          1                        0                                   30
                          1                        1                                   60
            Bit D7 through bit D0 will be used for a soft reset sequence. The soft reset for the
            deployment driver is achieved by writing $AA and $55 within two subsequent 16-bit SPI
            transmissions. If he sequence is broken, the processor will be required to re-transmit the
            sequence.
            L9658 does not reset if the sequence is not completed within two subsequent 16-bit SPI
            transmissions. This soft reset function is available only to deployment drivers.
            When soft reset command is received, the deice reset its deployment driver’s internal logic
            and timer. The effects of soft reset to the deployment driver is the same as ones of POR
            event, except MISO response.
            During a deployment, soft reset sequence is ignored.
4.11.3      Deployment driver command mode
            Command Mode message is defined as shown below.
            Table 18.     MOSI command mode message definition
                    Bit                State                                Description
                    D15                  0
                                                     Mode Bits
                    D14                  1
                    D13                              Odd Parity
                    D12                  -           Don’t Care
                    D11                  -           Don’t Care
                    D10                  -           Don’t C are
                    D9                   -           Don’t Care
                    D8                   -           Don’t Care
                                         0           Channel 7 Idle (default)
                    D7
                                         1           Deploy Channel 7
                                         0           Channel 6 Idle (default)
                    D6
                                         1           Deploy Channel 6
34/64                                       Doc ID 14219 Rev 3


L9658                                                                            Functional description
       Table 18.     MOSI command mode message definition (continued)
                Bit               State                                 Description
                                     0           Channel 5 Idle (default)
                D5
                                     1           Deploy Channel 5
                                     0           Channel 4 Idle (default)
                D4
                                     1           Deploy Channel 4
                                     0           Channel 3 Idle (default)
                D3
                                     1           Deploy Channel 3
                                     0           Channel 2 Idle (default)
                D2
                                     1           Deploy Channel 2
                D1                   0           Channel 1 Idle (default)
                                     1           Deploy Channel 1
                                     0           Channel 0 Idle (default)
                D0
                                     1           Deploy Channel 0
       Odd parity check includes all 16 bits. “Don’t care” bit is included in the parity check as well.
       Bit D7 to bit D0 are used to start the deployment or the pulse stretch timer. L9658 provides
       an independent timer for each channel. When any of these bits are set to ‘1,’ device starts
       the deployment or the pulse stretch timer for the respective channels.
       If any of these bits are set to ‘0’ when the pulse stretch timer is still active, the pulse stretch
       timer for the respective channels is terminated. Once deployment is initiated, can not be
       terminated.
       During a deployment, any commands directed to the channel that are in deployment are
       ignored.
4.11.4 Deployment driver diagnostic mode
       Diagnostic mode message are defined as shown here below.
       Table 19.     MOSI diagnostic mode message definition
              Bit          State                                 Description
              D15            1
                                   Mode Bits
              D14            0
              D13                  Odd Parity
                             0     Read Diagnostic Mode Response (default)
              D12
                             1     Write Diagnostic Mode Command
                             0     MOS Diagnostic Disable (default)
              D11
                             1     MOS Diagnostic Enable
                             0     LS MOS Diagnostic Enable
              D10
                             1     HS MOS Diagnostic Enable
                                         Doc ID 14219 Rev 3                                           35/64


Functional description                                                                                   L9658
            Table 19.     MOSI diagnostic mode message definition (continued)
                   Bit          State                                  Description
                                  0     Diagnostic Current Disable (default)
                   D9
                                  1     Diagnostic Current Enable
                                  0     Diagnostic Bias Current, IBIAS, Enable
                   D8
                                  1     Resistance Measurement Current, ISRC, Enable
                                  0     AOUT Disable (default)
                   D7
                                  1     AOUT Enable
                   D6              -
                   D5              -    AOUT/Comparator Channel Select
                   D4              -
                                  0     AOUT: Resistance Measurement (default)
                   D3
                                  1     AOUT: Calibration
                   D2              -
                   D1              -    Diagnostic Current: Channel Select
                   D0              -
            Odd parity check includes all 16 bits. “Don’t care” bit is included in the parity check as well.
            When bit D12 is set to ‘1,’ device executes bit D12 through bit D0. Otherwise, bit D12
            through bit D0 is ignored. Diagnostic Mode Response is sent in the subsequent SPI
            transmission regardless of bit D12.
            The diagnostic currents comprise of diagnostic bias current (IBIAS) and resistance
            measurement current (ISRC). Diagnostic bias current is used to run continuity tests, e.g.
            short to battery, short to ground, and open circuit tests. During a resistance measurement,
            ISRC and ISINK is turned on.
            ISRC and ISINK are turned on when bit D8 is ‘1,’ bit D9 is ‘1,’ bit D11 is ‘0,’ and bit D12 is ‘1.’
            Otherwise, ISRC and ISINK are off. When bit D11 is set to ‘1,’ MOS diagnostic is enabled.
            Depending upon the state of bit D10, either a low side MOS or a high side MOS will be
            switched on. When bit D 11 is set to ‘0,’ MOS diagnostic is disabled and bit D10 ignored.
            When bit D9 is set to ‘1,’ a diagnostic current source is enabled. Bit D8 determine if IBIAS or
            ISRC will be switched on. When bit D9 is set to ‘0,’ the diagnostic current sources is disabled
            and bit D8 ignored. Bit D2 through bit D0 selects a specific channel, which will be
            connected. The decoding scheme of this channel selection is shown ahead.
            Continuity tests and MOS diagnostics are performed through comparators which set proper
            bits on diagnostic register.
            Differential amplifier used for squib resistance measure reflects the scaled voltage across
            SQH and SQL pins. AOUT is connected to the differential amplifier.
            Externally, AOUT pin will be connected to an ADC input of a processor. When bit D7 is set to
            '1,' AOUT output is enabled. Otherwise, AOUT is in a high impedance state. Multiple devices
            may be connected to a single ADC input of a processor. If an AOUT is driven, the rest of
            AOUT shall be driven to the high-impedance state.
36/64                                        Doc ID 14219 Rev 3


L9658                                                                         Functional description
      The current sources (IBIAS and ISRC) and the AOUT/Comparators multiplexers are
      independently selectable. These multiplexers can address the same channel or individual
      channels. They cannot address multiple channels concurrently. It is not possible to source
      diagnostic current to more than one channel at a time. The AOUT multiplexer also selects
      the measurement channel for the short to ground SGth and short to battery SBth
      comparators. Please see Figure 13 for the deployment driver diagnostic block diagram.
      This flexibility in multiplexer addressing permits the detection of short between loops. To
      detect a short, enable the diagnostic current, direct it to channel X and monitor the MISO
      Diagnostic Mode Response bit D7 on the other channels. If no short exists between channel
      X and the channel under measurement, the MISO Diagnostic Mode Response will report a
      SQL voltage below SGth threshold (D7=1). If a short exists between channel X and the
      channel under measurement, the MOSI Diagnostic Mode Response will report a SQL
      voltage above SGth threshold (D7=0).
      Diagnostic of multiple device, requires the ability to turn on a current source in one device,
      while reading AOUT voltage of another device.
      Use the MOSI Diagnostic Mode Message to configure the device and the MISO Diagnostic
      Mode Response to measure the results. Table 19 and 20 define the MOSI Diagnostic Mode
      Message and MISO Diagnostic Mode Response bits respectively.
      Bit D6 through bit D4 selects a specific channel, which will be monitored. If AOUT output is
      enabled, AOUT shall reflect the voltage on the selected channel. Also, SBTH and SGTH
      status bits shall report the status of the respective channel. The decoding scheme of this
      channel selection is shown in the following table. The default states of these bits are ‘0’
      (channel 0 selected).
      Table 20.       Channel selection decoding
               Bit D6                     Bit D5                   Bit D4
                                                                                   Channel Selected
               Bit D2                     Bit D1                   Bit D0
                  0                         0                        0                     0
                  0                         0                        1                     1
                  0                         1                        0                     2
                  0                         1                        1                     3
                  1                         0                        0                     4
                  1                         0                        1                     5
                  1                         1                        0                     6
                  1                         1                        1                     7
      Bit D3 is used to calibrate AOUT. If this bit is set to ‘1,’ AOUT pin contains the calibration
      voltage. The processor can use this calibration voltage to make adjustment to the
      subsequent resistance measurement reading. This is intended to improve the accuracy of
      the resistance measurement. When this bit is set to ‘0,’ AOUT pin contains the resistance
      measurement results.
      The default state of this bit is ‘0.’
                                        Doc ID 14219 Rev 3                                         37/64


Functional description                                                                              L9658
4.11.5      Example of short between loops diagnostic
            The following SPI frame sequence is an example how to detect a short between channel 0
            and the other channels. The symbol % designates the bit to be tested. This bit is cleared to
            a 0 when there is a short between the selected channels. Bits D13 (Short to battery) and D3
            (Over current on Squib) are relevant too. Both of them must be at 0 for no fault. It may
            happens that after leakage test on channel Y, channel Y is shorted to battery, so when X is
            biased and Y monitored for shorts between channels, D7=D3=0 while D13=1. This will
            highlight a short to battery.
            1.   Enable the diagnostic current; select IBIAS current; set the IBIAS/ISRC multiplexer to
                 channel 0; set the AOUT/Comparators multiplexer to channel 1. The MISO read will
                 depend on the previous MOSI message.
                      D15 D14 D13 D12 D11 D10 D9             D8  D7    D6   D5   D4   D3   D2     D1  D0
             MISO       1    0     1      1  0     0    1    0    0    0     0    1   0     0     0    0
             MOSI       X    X     X      X  X     X    X    X   X     X     X    X   X     X     X   X
            2.   Set the AOUT/Comparators multiplexer to channel 2. The MISO read will be the results
                 of the channel 0 to channel 1 test.
                      D15 D14 D13 D12 D11 D10 D9             D8  D7    D6   D5   D4   D3   D2     D1  D0
             MISO       1    0     1      1  0     0    1    0    0    0     1    0   0     0     0    0
             MOSI       1    0     0      0  0     0    1    0   %     0     0    1   0     0     0    0
            3.   Set the AOUT/Comparators multiplexer to channel 3. The MISO read will be the results
                 of the channel 0 to channel 2 test.
                      D15 D14 D13 D12 D11 D10 D9             D8  D7    D6   D5   D4   D3   D2     D1  D0
             MISO       1    0     0      1  0     0    1    0    0    0     1    1   0     0     0    0
             MOSI       1    0     0      0  0     0    1    0   %     0     1    0   0     0     0    0
            4.   Set the AOUT/Comparators multiplexer to channel 4. The MISO read will be the results
                 of the channel 0 to channel 3 test.
                      D15 D14 D13 D12 D11 D10 D9             D8  D7    D6   D5   D4   D3   D2     D1  D0
             MISO       1    0     1      1  0     0    1    0    0    1     0    0   0     0     0    0
             MOSI       1    0     0      0  0     0    1    0   %     0     1    1   0     0     0    0
            5.   Set the AOUT/Comparators multiplexer to channel 5. The MISO read will be the results
                 of the channel 0 to channel 4 test.
                      D15 D14 D13 D12 D11 D10 D9             D8  D7    D6   D5   D4   D3   D2     D1  D0
             MISO       1    0     0      1  0     0    1    0    0    1     0    1   0     0     0    0
             MOSI       1    0     0      0  0     0    1    0   %     1     0    0   0     0     0    0
38/64                                       Doc ID 14219 Rev 3


L9658                                                                       Functional description
       6.   Set the AOUT/Comparators multiplexer to channel 6. The MISO read will be the results
            of the channel 0 to channel 5 test.
                 D15 D14 D13 D12 D11 D10 D9            D8    D7    D6   D5   D4   D3    D2    D1  D0
        MISO       1    0    0    1    0     0     1    0     0    1     1    0    0     0    0    0
        MOSI       1    0    0    0    0     0     1    0    %     1     0    1    0     0    0    0
       7.   Set the AOUT/Comparators multiplexer to channel 7. The MISO read will be the results
            of the channel 0 to channel 6 test.
                 D15 D14 D13 D12 D11 D10 D9            D8    D7    D6   D5   D4   D3    D2    D1  D0
        MISO       1    0    1    1    0     0     1    0     0    1     1    1    0     0    0    0
        MOSI       1    0    0    0    0     0     1    0    %     1     1    0    0     0    0    0
       8.   MOSI message will configure the device to test for a short between channel 1 and the
            remaining channels. Previously verified is the integrity of channel 0 to 1. Set the
            IBIAS/ISRC multiplexer to channel 2; set the AOUT/Comparators multiplexer to channel
            3. The MISO read will be the results of the channel 0 to channel 7 test.
                 D15 D14 D13 D12 D11 D10 D9            D8    D7    D6   D5   D4   D3    D2    D1  D0
        MISO       1    0    1    1    0     0     1    0     0    0     1    0    0     0    0    1
        MOSI       1    0    0    0    0     0     1    0    %     1     1    1    0     0    0    0
       Clearing the MOSI Diagnostic Mode Message D7 places the AOUT pin in high impedance.
       This feature allows the connection of multiple AOUT pins to a single A/D input. Only one
       AOUT pin should enabled at any given time.
4.11.6 Deployment driver monitor mode
       Monitor Mode message is defined as shown in the following table.
       Table 21.     MOSI monitor mode message definition
              Bit             State                               Description
              D15               1
                                         Mode Bits
              D14               1
              D13               -        Odd Parity
              D12               -        Don’t Care
              D11               -        Don’t Care
              D10               -        Don’t Care
               D9               -        Don’t Care
                                0        Report Deploy Success Flag (default)
               D8
                                1        Report Deployment OR Deploy Success Flag
                                0        Keep Deploy Success Flag Channel 7 (default)
               D7
                                1        Clear Deploy Success Flag Channel 7
                                     Doc ID 14219 Rev 3                                          39/64


Functional description                                                                                     L9658
            Table 21.      MOSI monitor mode message definition (continued)
                    Bit                State                                 Description
                                         0           Keep Deploy Success Flag Channel 6 (default)
                    D6
                                         1           Clear Deploy Success Flag Channel 6
                                         0           Keep Deploy Success Flag Channel 5 (default)
                    D5
                                         1           Clear Deploy Success Flag Channel 5
                                         0           Keep Deploy Success Flag Channel 4 (default)
                    D4
                                         1           Clear Deploy Success Flag Channel 4
                                         0           Keep Deploy Success Flag Channel 3 (default)
                    D3
                                         1           Clear Deploy Success Flag Channel 3
                                         0           Keep Deploy Success Flag Channel 2 (default)
                    D2
                                         1           Clear Deploy Success Flag Channel 2
                                         0           Keep Deploy Success Flag Channel 1 (default)
                    D1
                                         1           Clear Deploy Success Flag Channel 1
                                         0           Keep Deploy Success Flag Channel 0 (default)
                    D0
                                         1           Clear Deploy Success Flag Channel 0
            Odd parity check includes all 16 bits. “Don’t care” bit is included in the parity check as well.
            Bit D8 is used to select the meaning of bit D7 through bit D0 in the status response
            message.
            When this bit is set to ‘1,’ bit D7 through D0 in the status response message report the
            deployment status OR the deploy success flag. Once the deployment starts, bit D7 through
            bit D0 report ‘1’ until the deploy success flag is cleared. Bit D7 through bit D0 shall not report
            ‘0’ before the deploy success flag is cleared.
            The default state of this bit is ‘0.’ When this bit is ‘0,’ bit D7 through bit D0 in the status
            response message report the deploy success flag. Deploy success flags are cleared by bit
            D7 through bit D0 in the monitor mode command. Deployment status bits report the
            deployment state. If the deployment is active during a rising edge of CS_D, deployment
            status bits is set to ‘1.’ Otherwise, is set to ‘0.’
            If bit D8 in the monitor mode command changes state, bit D7 through bit D0 report the
            proper states of the internal signals/flags. Deploy command success bit indicates if the
            corresponding channel has finished its deployment sequence. This bit is set when
            deployment period, tDEPLOY, has expired.
            Once this bit is set, it will inhibit the subsequent deployment command until a SPI command,
            to clear this deployment success flag, is received. Bit D7 through bit D0 is used to
            clear/keep the deploy success flag. When these bits are set to ‘1,’ the flag can be cleared.
            Otherwise, the state of these flags is not affected.
40/64                                           Doc ID 14219 Rev 3


L9658                                                                       Functional description
4.11.7 Deployment driver MISO bit definition
       Table 22.    MISO bit layout
         MSB                                                                                  LSB
         D15    D14  D13 D12 D11 D10       D9    D8     D7    D6    D5    D4  D3    D2    D1   D0
       MISO mode bits are defined as below table.
       Table 23.    MISO mode bits definition
            Bit D15         Bit D14                              Description
               0               0       Register mode response
               0               1       Command mode response
               1               0       Diagnostic mode response
               1               1       Status response/SPI fault response
4.11.8 Deployment driver register mode response
       Register Mode Response is the default response to the processor. After POR event,
       RESETB negated, and loss of GND, the device send $0000 in MISO for the first SPI
       transmission. Register Mode Response is defined as shown in the following table.
       Table 24.    MISO register mode response definition
              Bit            State                               Description
             D15                0
                                       Mode Bits
             D14                0
             D13                0      Don’t Care
             D12                -      Echo of MOSI Read/Write Bit
                                0      Pulse Stretch Timer Duration
             D11
                                1      Soft Reset Sequence
                                0      Deployment Condition: IDEPLOY_12A and tDEPLOY_2ms
             D10
                                1      Deployment Condition: IDEPLOY_175A and tDEPLOY_1ms
              D9                -
                                       Pulse Stretch timer (see Table 17)
              D8                -
              D7                0      Don’t Care
              D6                0      Don’t Care
              D5                0      Don’t Care
              D4                0      Don’t Care
              D3                0      Don’t Care
              D2                0      Don’t Care
              D1                -      Hard Reset Status
              D0                -      Soft Reset Sequence Status
                                    Doc ID 14219 Rev 3                                       41/64


Functional description                                                                                 L9658
            Bit D12 used to reflect the status of MOSI Read/Write bit.
            Bit D11 used to reflect the MOSI bit D11 in the previous command.
            Bit D10 is used to indicate the deployment condition set in L9658. Refer to section 5.10.2 for
            deployment condition bit in MOSI register mode message.
            Bit D9 and bit D8 used to report the period of the pulse stretch timer.
            Bit D1 shall be used to indicate a "hard-reset" event. This bit shall be de-asserted ('0'), when
            POR is detected, RESETB is asserted, RIREF is out-of-range, or GND connection is lost.
            This bit shall be set to '1,' after the bit has been read. A soft reset sequence shall not affect
            this bit.
            Bit D0 used to report the soft reset sequence status. If valid soft reset sequences are
            received, bit D0 is set to ‘1.’ Otherwise, bit D0 is set to ‘0.’
            When L9658 receives valid soft reset sequences, it will send MISO register mode response
            containing $0001 in the next SPI transmission.
4.12        MISO register mode response summary
            Table 24 below summarizes the MISO register mode response of various events and MOSI
            messages. The MOISO response shown here is the one received in the next valid SPI
            transmission after each event or MOSI write.
            Table 25.      MISO register mode response summary
                           Event/MOSI message                                  MISO response
             POR                                               $0000
             RESETB                                            $0000
             LOSS OF gnd                                       $0000
             RIREF out of range                                $0000
             MOSI Write Soft Reset: $AA                        $1X02
             MOSI Write Soft Reset: $55 (after $AA)            $0003
             MOSI Write Pulse Stretch Timer                    $1X02
42/64                                          Doc ID 14219 Rev 3


L9658                                                                            Functional description
4.12.1 Deployment driver command mode response
       Command mode response is defined as shown here after.
       Table 26.     MISO command mode response definition
               Bit               State                               Description
               D15                 0
                                              Mode Bits
               D14                 1
               D13                 -          Don’t Care
                                   0          DEPEN Negated
               D12
                                   1          DEPEN Asserted
                                   0          ARM67 Negated
               D11
                                   1          ARM67 Asserted
                                   0          ARM45 Negated
               D10
                                   1          ARM45 Asserted
                                   0          ARM23 Negated
               D9
                                   1          ARM23 Asserted
                                   0          ARM01 Negated
               D8
                                   1          ARM01 Asserted
               D7                  -          SPI Deploy Command Status: Channel 7
               D6                  -          SPI Deploy Command Status: Channel 6
               D5                  -          SPI Deploy Command Status: Channel 5
               D4                  -          SPI Deploy Command Status: Channel 4
               D3                  -          SPI Deploy Command Status: Channel 3
               D2                  -          SPI Deploy Command Status: Channel 2
               D1                  -          SPI Deploy Command Status: Channel 1
               D0                  -          SPI Deploy Command Status: Channel 0
       DEPEN status flag (bit D12) indicates the state of DEPEN pin.
       ARM status flag (bit D11 through bit D8) indicates the state of the respective arming signal,
       including the pulse stretch timer. If the pulse stretch timer is initiated by a deployment
       command, it shall not assert the arming status flag. This flag will be negated as soon as the
       de-glitch timer is expired. ARM status flag is an OR-function of arming states from two
       channels.
       SPI deploy command status flag indicates the SPI deployment status for the respective
       channel. These flags reflects bit D7 through bit D0 of the most recent SPI command mode
       message. These bits do not include the status of pulse stretch timer. These bits will be
       overwritten by the most recent SPI command mode message.
                                       Doc ID 14219 Rev 3                                         43/64


Functional description                                                                               L9658
4.12.2      Deployment driver diagnostic mode response
            Diagnostic Mode Response is defined as shown in table.
            Table 27.    MISO diagnostic mode response definition
                    Bit            State                                  Description
                   D15                1
                                                Mode Bits
                   D14                0
                                      0         SQH voltage below SBTH threshold
                   D13
                                      1         SQH voltage above SBTH threshold
                                      0         DEPEN Negated
                   D12
                                      1         DEPEN Asserted
                                      0         MOS Diagnostic Completed
                   D11
                                      1         MOS Diagnostic In-progress
                                      0         LS MOS Diagnostic selected
                   D10
                                      1         HS MOS Diagnostic selected
                                      0         Diagnostic Current OFF
                    D9
                                      1         Diagnostic Current ON
                                      0         Diagnostic Bias Current, IBIAS selected
                    D8
                                      1         Resistance Measurement Current, ISRC selected
                                      0         SQL voltage above SGTH threshold
                    D7
                                      1         SQL voltage below SGTH threshold
                    D6                -
                    D5                -         AOUT/Comparator Channel Selection
                    D4                -
                                      0         Squib Current below VI_TH threshold
                    D3
                                      1         Squib Current above VI_TH threshold
                    D2                -
                    D1                -         Diagnostic Current: Channel Selection
                    D0                -
            SBTH threshold status flag (bit D13) indicates the state of SBTH comparator. SBTH
            comparator monitors the voltage on SQH pin.
            DEPEN status flag (bit D12) indicates the state of DEPEN pin.
            MOS Diagnostic status flag (bit D11) report the status of a driver diagnostic. This bit is not
            latched. When a MOS diagnostic has already completed, this bit is cleared. Low side or
            High side MOS diagnostic status flag (D10) indicates if there is an on-going low or high side
            driver diagnostic. This bit shall be use in conjunction with bit D11.
            Diagnostic current status flag (D9) indicates the state of diagnostic current. Bit D8 indicates
            which diagnostic current is selected. This bit shall be used along with bit D9 to indicate if a
            diagnostic bias current or resistance measurement current is on or off.
            SGTH threshold status flag (bit D7) indicates the state of SGTH comparator. SGTH
            comparator monitors the voltage on SQL pin.
44/64                                        Doc ID 14219 Rev 3


L9658                                                                        Functional description
       AOUT/Comparator channel select bits (bit D6..4) indicate which channel is being monitored
       by AOUT or SBTH, SGTH, VI_TH comparators.
       VI_TH threshold status flag (bit D3) indicates the state of VI_TH comparator. VI_TH comparator
       monitors the voltage across SQH and SQL pins.
       Diagnostic current channel select bits (bit D2..0) indicate which channel is being applied by
       the diagnostic current.
4.12.3 Deployment driver status response
       Status Response is defined as in following table.
       Table 28.    MISO status response definition
             Bit          State                                  Description
            D15             1
                                     Mode Bits
            D14             1
            D13             0        Always 0
                            0        DEPEN Negated
            D12
                            1        DEPEN Asserted
                            0        ARM67 Negated
            D11
                            1        ARM67 Asserted
                            0        ARM45 Negated
            D10
                            1        ARM45 Asserted
                            0        ARM23 Negated
             D9
                            1        ARM23 Asserted
                            0        ARM01 Negated
             D8
                            1        ARM01 Asserted
                            0        No Deployment Event: Channel 7
             D7
                            1        Deploy Status: Channel 7
                            0        No Deployment Event: Channel 6
             D6
                            1        Deploy Status: Channel 6
                            0        No Deployment Event: Channel 5
             D5
                            1        Deploy Status: Channel 5
                            0        No Deployment Event: Channel 4
             D4
                            1        Deploy Status: Channel 4
                            0        No Deployment Event: Channel 3
             D3
                            1        Deploy Status: Channel 3
                            0        No Deployment Event: Channel 2
             D2
                            1        Deploy Status: Channel 2
                            0        No Deployment Event: Channel 1
             D1
                            1        Deploy Status: Channel 1
                            0        No Deployment Event: Channel 0
             D0
                            1        Deploy Status: Channel 0
                                        Doc ID 14219 Rev 3                                      45/64


Functional description                                                                                                L9658
            DEPEN status flag (bit D12) indicates the state of DEPEN pin.
            ARM status flag indicates the state of the respective arming signal, including the pulse
            stretch timer. If the pulse stretch timer is initiated by a deployment command, it does not
            assert the arming status flag. This flag is de/asserted as soon as the de-glitch timer is
            expired.
            Deploy status bits (bit D7 through bit D0) report the status of internal deployment. Bit D8 in
            the monitor mode command determines which status information device needs to be
            reported in D7 through bit D0.
4.12.4      Deployment driver SPI fault response
            This SPI fault response indicates a fault in the last MOSI transmission. The device uses the
            parity bit to determine the integrity of the MOSI command transmission. This response is
            defined as shown in the following table.
            Table 29.        MISO SPI fault response
                     Bit              State                                      Description
                    D15                  1           Always ‘1’
                    D14                  1           Always ‘1’
                    D13                  1           Always ‘1’
                                         0           Parity error or message error during a deployment(1)
                    D12
                                         1           Incorrect number of clocks/bits
                D11 – D0                 0           Don’t Care
            1. When a parity error is detected, the L9658 reports E000h. During a deployment, when an invalid message
                is detected, he L9658 reports also E000h. Refer to Table 12 for the description of an invalid message
                during a deployment. Bit D12 reports an incorrect number of clocks/bits. When an incorrect number of
                clocks/bits is detected, bit D12 is asserted (F000h).
4.13        Arming SPI bit definition
4.13.1      Arming MOSI_A bit definition
            Arming MOSI_A is defined as shown in figure below.
            Table 30.        Arming MOSI_A bit definition
                   7             6             5             4           3            2             1               0
              ARM67          ARM45          ARM23         ARM01       ARM67*      ARM45*        ARM23*           ARM01*
4.13.2      ARM[01..67]
            Arming command. These bits are used to enable/disable arming signal. A value of 1
            enables the arming signal for the respective loop-pair. A value of 0 disables the arming
            signal for the respective loop-pair. When device is in reset, all arming signals are disabled.
46/64                                               Doc ID 14219 Rev 3


L9658                                                                                  Functional description
4.13.3 ARM[01..67]*
       Arming-command complement. These bits are the complements of ARM[01..67] bits and
       will be used to confirm the transmission of arming signals. If L9658 does not receive valid
       complement bits, it will ignore the arming command.
4.13.4 Arming MISO_A bit definition
       Arming MISO_A is defined in table below.
       Table 31.     Arming MISO_A bit definition
             7          6           5                 4              3   2                1          0
         ARM67       ARM45       ARM23             ARM01       ARM67   ARM45           ARM23       ARM01
4.13.5 ARM[01..67]
       Arming status. These bits are used to echo arming bits sent in the previous arming
       command. A value of 1 indicates that arming signal is enabled for the respective loop-pair. A
       value of 0 indicates that arming signal is disabled for the respective loop-pair.
       The default state of these arming signals is ‘0’ (disabled).
4.14   Satellite sensor interface
       The device provide four currents limited to 60mA each through outputs ICH1, ICH2, ICH3
       and ICH4. The voltage at these four channels is supplied by the V8BUCK input. Channels 1,
       2, 3 and 4 serves as switched power sources to remote mounted satellite sensors, each will
       draw 2 current levels. The L9658 will monitor the current flow from its output pin and
       “demodulate” the current to be decoded using Manchester protocol. Decoded satellite
       message is communicated to an external microprocessor via SPI.
       Figure 18. Satellite interface block diagram
                                ICHX    Current     Current
                                      Sense with     Limit   V8BUCK
                                         STB         (STG
                                       blocking     Protect)
                                         FET                              Configurati
                                                                               on
                                                                          Register
                                                                          CCRx/MCR
                                                                SPI IN
                                        Control
                                                                         Manchester
                                                                          Decode &
                                                                           CRC Or
                                                                         Parity Check
                                                                 FIFO
                                        Satellite
                                       Status Bits                                    MSG
                                                              SPI OUT
                                          Doc ID 14219 Rev 3                                            47/64


Functional description                                                                                  L9658
4.14.1      Current sensor
            Each output channel senses the current drawn by the remote satellite sensor; the circuit
            modulates the load current into logic voltage levels for post processing by a manchester
            decoder. Each channel has an internal comparator with a programmable currents trip points
            selectable through the appropriate setting in the CCR Register for each of the 4 satellite
            channels. The current sense comparator provides a hysteresis, which can be enabled
            through appropriate setting in the CCR Register. Each comparator output have a de-glitch
            filter as a function of the protocol speed as defined in the AC characteristic table. Each
            current is limited to 150 mA maximum and includes a fault timer.
            If the output for a given channel is in current limited for a period of time exceeding the output
            fault timer, the IC will report an over current fault via SPI and latch off the affected channel,
            the channel will remain in latch off mode until the user send a SPI command to re-activate
            the channel. When the output is shorted to battery, an internal comparator senses the
            output voltage level then turn off an internal series transistor to provide blocking diode for
            the current going through the output channel, the output will resume normal operation once
            the fault condition is removed. The comparator have 20 to 50 mV input offset to prevent
            turning off the output under an open circuit condition. In case of loss of VCC all output will
            remain off.
4.14.2      Manchester decoding
            The L9658 decodes satellite massages based on Manchester decoding, each of the four
            satellite channels have a Manchester decoder that can be enabled or disabled through the
            CCR register. An example of Manchester decoding is given below; logic 0 is defined as a
            signal transition from 0 to 1 at 50 % Duty cycle, logic 1 is defined as a signal transition from
            1 to 0 at 50 % duty cycle.
            The IC starts decoding the satellite message after it receives two SYNC bits defined as logic
            00, the SYNC bits are used to determine the bit rate of the incoming message and are used
            as the time base in decoding the following bits; different bit rates ranges are programmable
            via SPI, in case the measured bit rate obtained using the 2 SYNC bits doesn’t fall within the
            range selected by he SPI as defined, the device declares a bit time error, revert to the
            minimum bit time of the selected range, and wait for idle.
            Figure 19. Manchester decoding
                              I d le    0        1     1       0        0       1      0
48/64                                         Doc ID 14219 Rev 3


L9658                                                                                                      Functional description
      Figure 20. Manchester decoding using satellite protocol as an example
                                   sync2       sync1           D16          D15                    D0         IMS > or   sync1
                                                                                                               =2N1
                 IF/V
                                  sync2=0 sync1=0             D16=1        D15=1                  D0=1       IMS > or    sync1=0
          Sattelite Current                                                                                   =2N1
                Level
                                                   sync0=0      D16=1       D15=1                               IMS > or
                                     sync1=0                                              D1=0       D0=1                 sync1=0
                                                                                                                 =2N1
                FILT_DATA
                                                                                                                 150% N1
                                                                   1.25 N1      1.25 N1     1.25 N1     1.25 N1
                                                 N1             N2           N3         N11         N12
                                                        0.75 N1      0.75 N1                 0.75 N1    0.75 N13
          Bit_Time_Counter<TBD>
              75 % to Bit Center
                    All Transitions
        Bit Center Transitions =
        All Transitions after 75%
                    IMS_Detect
                                      0        1             2           3            4        18                19            0
            Bit_Count<TBD>
         Bit_Time_Register<6:0>              -----         N1           N1          N1           N1               N1        -------
      The decoder uses a counter to track the high to low and low to high transitions at the bit
      center. A transition is considered a bit center only when an edge is detected 75 % to 125 %
      of the reference bit time. When a single edge occurs below 75% of the reference bit time it is
      considered to be a bit edge but it is ignored. When the decoder detects a second edge
      below 75 % of the reference bit time the device declares a bit time error via SPI, revert to the
      minimum bit time of the selected range, and wait for idle. When a valid bit center is detected
      the counter will reset and start counting again until another edge is detected. If the message
      is not complete and no edge is detected in the range of 75 % to 125 % of measured bit time,
      the device declares a bit time error via SPI, revert to the minimum bit time of the selected
      range, and wait for idle. The idle time is defined as 150 % of the minimum bit time of the
      selected protocol speed range. If there is no bit transition detected for that period of time
      and the correct number of bits was received, the message is considered complete.
      Bit time error and too many bits faults are stored directly into the FIFO once they are
      selected without the need to wait till an idle time. Since a bit time error is reported directly
      once it is detected before Idle time, too few bits error may never be reported since bit time
      error is detected first.
      Bit time errors and too many bits errors will cause the decoder to revert to the minimum bit
      time of the selected range, and discard the message. In case of a message containing
      multiple errors only one error code is reported per message, errors detected in the decoding
      phase have the following reporting priority; bit time errors, too many bits errors then
      communication errors (CRC/Parity).
                                                        Doc ID 14219 Rev 3                                                          49/64


Functional description                                                                                        L9658
            Upon power up or after a reset, the device requires at least 1.5 Idle bit-time based on
            52.33khz protocol speed or 28.65us before starting to decode the first message, bit-time
            shall adapt to the period obtained based on the two sync bits there after.
4.14.3      Communication protocols
            The L9658 supports two different communication protocols that are widely used by different
            automotive manufactures. One is based on the protocol used by "A" satellite sensors and
            the other is "B" protocol that supports variable length messages based on BOSH, PAS3 and
            PAS4 protocols. Bits D11D12 in the CCR Register are used to configure the device in order
            to use any of these protocols.
4.14.4      "A" protocol
            The Delphi sensors satellites protocol supported by this device is shown below. The
            message consists of 5 bits CRC cyclic redundancy check error, 12 bit of data and two sync
            bits. This information could be sensor’s trace-ability data, or crash severity or velocity data.
            The two most significant bits in the data field sent by the sensor can identify these data
            types.
            Figure 21. "A" satellite protocol
                    SYNC2 SYNC1                            DATA                        CRC                 IDLE
                                MSB                                                             LSB
                      18   17    16  15  14 13  12  11   10    9    8   7   6  5 4  3   2  1     0     IDLE2   IDLE1
            The CRC error detection code is based on the polynomial x5 + x2+ 1. The L9658 processes
            all incoming message through the CRC verification and report an error message via SPI in
            case of a CRC mismatch. CRC is performed after a complete message is received, and in
            case of CRC error, he device sets a fault code via SPI.
4.14.5      "B" variable length protocol
            Figure 22. "B" satellite protocol
                                                                                               IDLE
                                                               DATA                MSB
                            SYNC2 SYNC1 LSB
                               13   12  11  10    9    8    7    6    5   4   3  2  1    0 IDLE2    IDLE1
            The L9658 IC shall supports "B" satellite protocol, which is based on Bosch sensors
            PAS3\PAS4 protocols (In Figure 22 bit order is opposite to PAS3/PAS4 protocol in which
            LSB is sent first and MSB last) with added flexibility that the message length in the data field
            can be programmed to accept any number of bits between 8 and 11. The protocol consists
            of a parity bit, a data field (configurable between 8 to 11 bits) and two sync bits. The IC can
            be enabled to use this protocol through the appropriate setting in the MCR register. Once
            the protocol is enabled for a specific channel, the protocol speed is configured by setting the
            appropriate bits in the CCR register for that particular channel. A parity check is performed
            after a complete message is received, and in case of a parity error, the device sets a fault
            code via SPI.
50/64                                          Doc ID 14219 Rev 3


L9658                                                                          Functional description
4.14.6 FIFO buffer
       The IC includes 4 internal FIFO buffers; one for each output channel, each one is 12 bits
       and two levels deep. When D1 in the MCR register is set to 0 (default condition), MSG pin is
       asserted and remain asserted as long as there is a message in any of the 4 internal FIFO
       buffers.
       The FIFO provides error flag via SPI in case of buffer data loss. When writing to a full FIFO
       the old data is lost. For example if the FIFO content at the bottom of the stack is $0AA, an
       incoming message of $090 will occupy the upper level of the FIFO stack, at this stage the
       FIFO is full, but the Data lost flag is not set. When writing another message to the FIFO, for
       example $066, the Data lost flag is set and the final FIFO content is $066 (top of stack) and
       $090(bottom of stack). When a FIFO read operation is performed via SPI, The FIFO content
       $090 is carried over by MISO and Data lost flag is unset. The Data lost flag is also unset
       when the FIFO is flushed via SPI command.
4.14.7 Satellite continuity check
       Each output has a short circuit protection by independent current limit. When a short circuit
       occurs the output becomes current limited, a fault timer latch the output off and a fault
       condition bit is reported via SPI.
       That output returns to normal operation when it is re-enabled via SPI and the current limit
       condition was removed, this fault condition does not interfere with the operation of any of the
       other output channels
4.14.8 (IFx/Vx) hall effect support mode
       Channels 3 and 4 of the L9658 can by used to provide an analog feed back current as a
       1/100th ratio of the sense current in this mode internal FIFO and decoder are bypassed.
       This will allow the IF3/V3 and IF4/V4 pins to be connected to a resistor to ground and
       provide an analog voltage equivalent to the sense current to be read by an A/D port. These
       two pins have an internal clamp as protection.
       This mode of operation is accessed by the setting of D4 and D5 in the MCR register. When
       D4 and D5 are set to 1, pins IF3/V3 and IF4V4 is configured as analog current output with
       1/100th ratio of the sense current. This feature is available for Channels 3 and 4.
4.14.9 (IFx/Vx) raw data out mode
       When D4 and D5 in the MCR register are set to 0 the IF3/V3 and IF4/V4 pins are configured
       as discrete output pins that provide logic level output voltage of the sensed current based on
       the internal current threshold set by the user through the CCR Register, which when used in
       conjunction with satellite sensors connected to channels 3 and 4 it can provide raw data out
       of the satellite message bypassing the internal decoder.
       The output voltage has a reversed polarity to the satellite current such that when the current
       drawn by the satellite is below the current detection threshold, the IFx/Vx signal level
       transitions into a high state, on the other hand if the current drawn by the satellite exceed the
       current detection threshold, IFx/Vx signal transitions into a low state. Bits D6 and D7 in the
       MCR register is used to disable this output if it is not used.
                                         Doc ID 14219 Rev 3                                        51/64


Functional description                                                                                 L9658
4.14.10     Message waiting
            The MSG pin is asserted when there is a message in any of the 4 internal FIFO buffers. This
            pin is TTL level and is configurable to be either active high or active low signal.
            The Pin shall also be programmable via SPI to either remain active during CS_S once is set
            or inactive during CS. IF the pin is configured to remain active during CS_S and there is a
            message in any of the internal FIFO it remains active even if CS_S is de-asserted. However
            if there are no messages in any of the internal 4 FIFOs the pin will be forced to inactive
            state.
4.14.11     Satellite serial data input (MOSI)
            The MOSI input takes data from the master microprocessor while CS_S is asserted. The
            MSB is the first bit of each word received on MOSI and the LSB is the last bit of each word
            received on MOSI. This pin has TTL level compatible input voltages allowing proper
            operation with microprocessors using a 3.3 to 5.0 volt supply. MOSI Bits layout is provided
            here below.
4.14.12     Satellite MOSI bits definition
            Table 32.     Satellite MOSI bits layout
               15    14   13     12    11   10     9      8    7     6     5     4      3     2      1    0
                P    S                                       DATA (12:0)
            There are total of 5 internal registers that are used to configure all of the satellite channels.
            These registers are addressed by setting MOSI bit 14 according to this table and by sending
            the SPI commands sequentially in the correct order such that CH1 command is the first
            significant word and CH4 command is the Last word.
            Table 33.     MOSI satellite interface registers map
                    Bit              State                               Description
                    D15                          SPI Odd Parity
                                       0         MCR Master Configuration Register (CH1 Only)
                                       1         CCR1 Channel Configuration Register for CH1
                    D14                1         CCR2 Channel Configuration Register for CH2
                                       1         CCR3 Channel Configuration Register for CH3
                                       1         CCR4 Channel Configuration Register for CH4
            The SPI command sequence is such that the first word communicates with channel 1, the
            second SPI word communicates with channel 2, the third SPI word is in communication with
            channel 3 and the 4th word with channel 4.
52/64                                       Doc ID 14219 Rev 3


L9658                                                                             Functional description
4.14.13 Satellite module configuration register (CH1 only)
        This register define global configuration to the satellite module, in able to be executed
        correctly it has to be written for CH1 as the first word after the rising edge of CS_S. When an
        MCR command is written to any other channel than CH1, the IC ignores this command and
        reply with SPI message $E000.
        Table 34.      Master configuration register definition (CH1 Only)
             Bit        State                                      Description
            D13            0      Not Used                                                          -
                           0      "B" protocol setup for even parity                            (default)
            D12
                           1      "B" protocol setup for odd parity                                 -
                           0      CH4 "A" Protocol Mode                                         (default)
            D11
                           1      CH4 "B" Protocol Mode                                             -
                           0      CH3 "A" Protocol Mode                                         (default)
            D10
                           1      CH3 "B" Protocol Mode                                             -
                           0      CH2 "A" Protocol Mode                                         (default)
             D9
                           1      CH2 "B" Protocol Mode                                             -
                           0      CH1 "A" Protocol Mode                                         (default)
             D8
                           1      CH1 "B" Protocol Mode                                             -
                           0      Disable IF4/V4 pin                                                -
             D7
                           1      Enable IF4/V4 pin                                                 -
                           0      Disable IF3/V3 pin                                                -
             D6
                           1      Enable IF3/V3 pin                                                 -
                           0      IF4/V4 operating in Satellite sensor Mode                     (default)
             D5
                           1      IF4/V4 operating in Hall effect sensor Mode                       -
                           0      IF4/V3 operating in Satellite sensor Mode                     (default)
             D4
                           1      IF4/V3 operating in Hall effect sensor Mode                       -
             D3            0      Not USED                                                          -
             D2            0      Not USED                                                          -
                           0      MSG Output remains active when CS_S asserted (default)            -
             D1
                           1      MSG Output inactive when CS_S asserted                            -
                           0      MSG Output Active High                                        (default)
             D0
                           1      MSG Output Active Low                                             -
        Bits[1:0]
        These bits configure the polarity and the behavior of the MSG
        Bits[7:4]
        These bits are used to enable CH3 and CH4 to operate in Hall effect sensor mode, disabled
        by default
                                          Doc ID 14219 Rev 3                                          53/64


Functional description                                                                                        L9658
            Bits[11:8]
            These bits are used configure the output channels for either sensor protocols. In the “B”
            protocol mode a parity bit is used to verify communication between the satellite sensors and
            the IC.
            The L9658 calculates the parity of the incoming massage based on either odd parity or even
            parity, which is determined by the setting of bit D12. In case of communication parity
            mismatch a communication parity error shall be reported via SPI.
            If none of the channels is configured for the “B” protocol a write operation to this bit is
            ignored.
            Bit [12]
            This Bit controls the parity calculation for incoming sensor messages to either even or odd
            parity; the selected setting apply to all channels operating in “B” protocol node.
            The setting of this bit is ignored by the IC for the channels configured for “A” protocol. the
            MCR register have to written at least once in order for the device to be configured correctly,
            however it can be superseded with a CCR command.
4.14.14     Channel configuration registers (CCR1, CCR2, CCR3, CCR4)
            This register is used to configure individual channels for proper satellite communication as
            required by the application please refer to below table 33 for bits definition.
            Table 35.     Channel configuration register definition
                 Bit         State                                       Description
                               0         Don’t Flush FIFO (Default)
                 D13
                               1         Flush FIFO
                                         Write to bits <D9-D0>, D12 and D13 only. All other CCR
                               0
                                         D12 bits shall keep previous setting.
                 D12
                                         Write to D4, D5, D10, D11, D12 and D13 only. All other
                               1
                                         CCR bits shall keep previous setting.
                 D11            -
                                         Mode Select (refer to Table 40)
                 D10            -
                 D9             -
                                         Bit Time Selection (refer to Table 39)
                 D8             -
                 D7            0         "B" Protocols configuration bits (refer to Table 38) Only applies when CHx
                                         is configured to use "B" Only applies when CHx is configured to use "B"
                 D6            1         protocol through MCR otherwise treated as DON’TCARE
                 D5             -
                                         Satellite/Decoder Control (refer to Table 37)
                 D4             -
                               0         Current Trip Point Hysteresis Disabled (default)
                 D3
                               1         Current Trip Point Hysteresis Enabled
54/64                                          Doc ID 14219 Rev 3


L9658                                                                               Functional description
      Table 35.      Channel configuration register definition
            Bit        State                                       Description
            D2            -
            D1            -        Current Trip Point threshold (refer to Table 36)
            D0            -
      Bits[2:0]
      These bits program the threshold for the current demodulation affecting each individual
      channel. The current ranges supported are given inTable 36.
       .
      Table 36.      Current ranges supported are given in following table
            Bit D2            Bit D1            Bit D0                    Current Threshold (mA)
               0                 0                 0                            16.50(default)
               0                 0                 1                                19.00
               0                 1                 0                                22.50
               0                 1                 1                                26.50
               1                 0                 0                                32.00
               1                 0                 1                                39.00
               1                 1                 0                                48.50
               1                 1                 1                                60.00
      All incoming satellite signals are processed through deglitch filter before reaching the
      decoder. D3 enables a hysteresis around the current threshold for added noise immunity.
      Bits[5:4]
      These bits are used to enable the satellite channels and the internal decoders to be
      commanded on or off according to following table. Suggested sequence to avoid spurious
      error code inside FIFO is to switch on the channel first, and enable decoder only once
      satellite is powered.
      Table 37.      Satellite/decoder control
                                                                                Definition
                Bit D5                   Bit D4
                                                                    Satellite                  Decoder
                   0                        0                    OFF (default)             OFF (default)
                   0                        1                          ON                        OFF
                   1                        0                          ON                        ON
                   1                        1                         OFF                        OFF
      Bits[7:6]
      These bits are used to configure the number of bits in the "B" protocol data field. For these
      bits to execute on any given channel, the channel has to be configured for "B" protocol
      through bits <11:8> in the MCR register.
                                        Doc ID 14219 Rev 3                                               55/64


Functional description                                                                                 L9658
            Table 38.       "B" protocol configuration
                     Bit D7                    Bit D6                          Protocol Data Field
                         0                        0            8bits(default)
                         0                        1            9bits
                         1                        0            10bits
                         1                        1            11bits
            Bits[9:8]
            These bits shall configure speed selection for any of the satellite channels and they apply to
            both “A” and the "B" Manchester protocol. Upon power up or reset the protocol configuration
            shall initialize to the default speed as in shown in below table.
            Table 39.       Bit time selection
                    Bit D9                Bit D8                Guaranteed Frequency operating range (Hz)
                       0                      0           13.3k to 52.33k (default)
                       0                      1           26.32k to 110.74k
                       1                      0           43.50k to 164.20k
                       1                      1           62.66k to 250k
            Bits[11:10]
            These bits will be used to determine the requested information from each of the satellite
            channels internal registers. At power up or incase of POR condition these bits are initialized
            to 00 by the IC and MISO bits <12:0> shall default to the content of the MCR register.
            Table 40.       Mode select
                Bit D11         Bit D10                                     Definition
                                            Report This on Next MISO
                        00/01/10            Bit 13 = SPI odd parity
                                            Bits<15:1411 (Configuration Reports Mode)
                                            If the previous command is a write to the MCR
                                            Register (default)
                                            Report <12:0> Table 35 (MCR) only for CH1
                   0               0
                                            If previous command is a write to the CCRx
                                            Register
                                            Report <12:0> Table 36 (CCR)
                   0               1        Report <12:0>Table 35 (MCR) (CH1 Only)
                   1               0        Report <12:0>Table 36 (CCR)
                                            Report This on Next MISO
                           11               Bit 13 = SPI odd parity
                                            Bits<15:14 (Satellite Status 00,01 or 10)
                   1               1        Report FIFO data
56/64                                           Doc ID 14219 Rev 3


L9658                                                                         Functional description
      In the auto reply mode where D11 D10 are set to 00,the IC will test every incoming MOSI
      command, If the command is a write command to a CCRx register then during the following
      CS_S the device reports back the content of the respective CCRx channel register. If the
      incoming command is a write to the MCR register for CH1 then in the following CS_S the
      device reports back the content of the MCR register.
      If the MOSI command is a write to the CCRx register with bits <11:10> are set to 11 the IC
      reports the content of the FIFO. MISO bits layout when reporting FIFO data is provided, The
      MISO layout when reporting configuration report is provided in previous figure.
      When reporting a configuration report for either the MCR or the CCR register MOSI
      bits<15:14> are set to 11 to indicate a configuration report. Otherwise they will report the
      status of the satellite channel.
      In some cases the user may request a configuration report for either the MCR or CCRx
      registers without first performing the write operation mentioned above. In this condition if bits
      <11:10> are set to 01 by the user, device reports the content of the MCR register on the
      subsequent chip select. If bits <11:10> are set to 10 the IC reports the content of the CCR
      register.
      In case of an SPI command to CH2, CH3 or CH4 with bits D11D10 are set to 00 while D14
      is set to 0, or if D11D10 are set to 01 with D14 is set to either 0 or 1, the affected channel
      reports $E000.
      Table 41.      SPI mode selects reply for satellite channels
        D11    D10             CH1                 CH2                 CH3                   CH4
                      Reply with CCR1     Reply with CCR2     Reply with CCR3       Reply with CCR4
                      if D14 is 1         if D14 is 1         if D14 is 1           if D14 is 1
          0     0
                      Reply with MCR      Reply with $E000    Reply with $E000      Reply with $E000
                      if D14 is 0         if D14 is 0         if D14 is 0           if D14 is 0
          0     1     Reply with MCR      Reply with $E000    Reply with $E000      Reply with $E000
          1     0     Reply with CCR1     Reply with CCR2     Reply with CCR3       Reply with CCR4
          1     1     Report FIFO         Report FIFO         Report FIFO           Report FIFO
      Bit[12]
      This Bit is used to Control the write operation for the CCR Register. When it is set to 0 the
      user can modify bits <D9-D0>, D12 and D13 only, all other CCR bits keep previous setting.
      When it is set to 1 the user can only modify the following bits D4, D5, D10, D11, D12 and
      D13, all other CCR bits keep previous setting
      Bit[13]
      This Bit is used to Flush FIFO content, when set to 1 the IC flushes the available two FIFO
      locations for the specified channel, all FIFO connect is lost in this case.
      Table 42.      Satellite MISO bits definition
         15    14    13      12    11  10     9       8  7      6     5     4     3      2      1   0
        M1    M0       P    DL                                FIFO Data
                                       Doc ID 14219 Rev 3                                         57/64


Functional description                                                                                       L9658
            Table 43.      SPI MISO bits layout when reporting FIFO data
              15     14    13    12    11     10     9      8     7      6       5     4       3    2      1     0
              M1     M0     P                                  Configuration Report
4.14.15     SPI MISO Bits layout for configuration report
            Status bits <15:14> indicate the status ofL9658 output channels, status bits are updated at
            the falling edge of CS_S and defined by bits <15:14>. Fault codes are pushed into the and
            then removed form FIFO on rising edge of CS_S and reported through MISO.
            Global and channels faults are encoded in the hexadecimal range between $001 to $01F.
            “Global faults” covers all satellite channels. “Channel Fault” covers only a particular channel.
            Channel Fault codes are pushed into the FIFO once each time they occur while global faults
            are pushed into the FIFO once even if the fault is still present. Bit 13 is set by the IC to
            satisfy an odd parity for each of the transmitted word, therefore it will be set to 1 if the total
            number of 1’s for bits is even and to 0 if the total number of 1’s for bits is odd.
            Table 44.      MISO Manchester message data definition
                       Bit                State                                   Description
                      D15                    -
                                                          Status Bits (refer to Table 45)
                      D14                    -
                      D13                    -            Odd Parity
                                             0            No FIFO Data has been lost
                      D12
                                             1            FIFO Data has been lost
                     D11:0                                FIFO Contents
            Table 45.      Status bits definition
                    Bit D15              Bit D14                                   Definition
                        0                    0            Current Channel is Off
                        0                    1            Channel ON, Message processing Disabled
                        1                    0            Channel ON, Message processing Enabled
                        1                    1            Configuration report
            Table 46.      Satellites fault codes definition supporting “A” protocol
              Bit D11:0 value                   Fault definition                               Function
                      $0         No Faults (FIFO empty value)
                      $1         Unassigned
                                                                                    Global Fault Codes Definition
                      $2         Bad MOSI Bit Count                                (Reported back for CH1 only &
                   $3 - $F       Unassigned                                               latched only once)
58/64                                         Doc ID 14219 Rev 3


L9658                                                                        Functional description
      Table 46.      Satellites fault codes definition supporting “A” protocol
        Bit D11:0 value                   Fault definition                        Function
               $10          High side current limit exceeded
               $11          Unassigned
               $12          SPI Odd Parity Communication error
            $13 - $17       Unassigned
               $18          Reserved message received
                            Manchester Bit Time Error OR                    Channel fault codes
               $19
                            Too Few Bits
                            Too many bits (No Idle Condition after 19th
               $1A
                            bit)
               $1B          Reserved
               $1C          CRC error
            $1D - $1F       Unassigned
           $020 - $FFF      Manchester sensor’s data range                    Manchester data
      Buffer data values from $0 to $1F are reserved and not transmitted by the "A" Manchester
      data sensor. All "A" satellite sensors use values between $020 and $FFF, therefore values
      falls within this range will be interpreted by system software as satellite only data. If a
      satellite data is found to be in the range between $00 to $01F the IC asserts the reserved
      message error flag or fault code. In case there is no fault condition present, the device
      returns $000.
      Data is lost when a data word is written to a full buffer. To alarm the user for this condition
      the DL (buffer data lost) flag shall be set.
                                        Doc ID 14219 Rev 3                                        59/64


Functional description                                                                                      L9658
            Table 47.      Satellites fault codes definition supporting “B” protocol
             Bit D11:0 value                   Fault Definition                            Function
                     $0        No Faults (FIFO empty value)
                     $1        Unassigned                                         Global fault codes definition
                                                                                (Reported back for CH1 only &
                     $2        Bad MOSI Bit Count                                     latched only once)
                  $3 - $F      Unassigned
                    $10        High Side Current Limit Exceeded
                    $11        Unassigned
                    $12        SPI Odd Parity Communication error
                $13 - $17      Unassigned
                    $18        Unassigned
                                                                                     Channel fault codes
                               Manchester Bit Time Error OR
                    $19
                               Too Few Bits
                    $1A        Too Many Bits
                    $1B        Reserved
                    $1C        Satellite Communication Parity error
                               Manchester sensor’s data range D11 shall be
                               set to 1 by the IC when receiving sensor data.
               $800 - $FFF                                                             Manchester data
                               When reporting faults D11 shall be set
                               internally by the IC to 0
            As mentioned earlier the L9658 supports a "B" Manchester data protocol, the data field for
            this protocol can be configured to any number of bits between 8 to 11 bits. Incoming data
            from the sensor using a "B" protocol shall be right justified by the IC. For example if the
            incoming message has only 8bits in the data filed. The device will transmit this message on
            MISO such that it occupies bits <7:0> bits 8,9 and 10 are set to 000.
            Unlike DELPHI protocol, LSB will be the first bit on MISO.
            Too Many Bits and Too Few Bits faults can be calculated based on the number of bits in the
            data field. So if we consider the 8 bit "B" protocol example discussed above a message with
            9 bits in the data field should set the too many bits fault flag, on the other hand a message
            with 7 bits in the data field should set the too few bits fault flag.
            When the L9658 is configured to use a the Manchester "B" protocol, the device set SPI
            MOSI D11 to 0 when reporting fault data and to 1 when reporting satellite data. This
            operation should allow both sensors "A" based or Generic based to use the same fault
            codes.
            Table 48.      Hall effect fault codes definition (CH3 and CH4) only
              Bit D11:0 value                 Fault definition                           Function
                      $0         No Faults (FIFO empty value)                            No Faults
                   $1 - $F       Unassigned
                    $010         High Side Current Limit Exceeded                      Fault Codes
                     $12         SPI Odd Parity Communication error
60/64                                          Doc ID 14219 Rev 3


L9658                                                                       Functional description
      When either CH3 or CH4 is configured to interface with hall-effect sensor, MISO data
      reported VIA SPI for that specific channel will be as outlined in proper table. Global faults
      are not reported for channels configured in Hall effect sensor mode since they are only
      reported for CH1 while Hall effect sensor configuration is only possible for CH3 and CH4.
      Upon power on or after a reset or POR conditions the MISO data will be initialized as
      follows; CH1 returns MCR configuration in report mode with parity bit is set accordingly.
      CH2, CH3, and CH4 return $E000
                                     Doc ID 14219 Rev 3                                         61/64


Package information                                                                                                                                         L9658
5         Package information
          In order to meet environmental requirements, ST offers these devices in different grades of
          ECOPACK® packages, depending on their level of environmental compliance. ECOPACK®
          specifications, grade definitions and product status are available at: www.st.com.
          ECOPACK® is an ST trademark.
          Figure 23. LQFP64 mechanical data and package dimensions
                                              mm                         inch
                  DIM.
                              MIN.         TYP.        MAX.     MIN.    TYP.       MAX.
                                                                                                              OUTLINE AND
                                                                                                            MECHANICAL DATA
                      A                                1.60                        0.063
                   A1         0.05                     0.15    0.002               0.006
                   A2         1.35         1.40        1.45    0.053    0.055      0.057
                      B       0.17         0.22        0.27    0.0066 0.0086 0.0106
                      C       0.09                     0.20    0.0035              0.0079
                      D   11.80           12.00        12.20   0.464    0.472      0.480
                   D1         9.80        10.00        10.20   0.386    0.394      0.401
                   D3                      7.50                         0.295
                      e                    0.50                         0.0197
                      E   11.80           12.00        12.20   0.464    0.472      0.480
                   E1         9.80        10.00        10.20   0.386    0.394      0.401
                   E3                      7.50                         0.295
                      L       0.45         0.60        0.75    0.0177 0.0236 0.0295
                   L1                      1.00                         0.0393
                      K                   0˚ (min.), 3.5˚ (min.), 7˚(max.)                             LQFP64 (10 x 10 x 1.4mm)
                   ccc                                 0.080                       0.0031
                                                               D
                                                               D1
                                                                                                                                            A
                                                               D3
                                                                                                                                            A2
                                                                                                                                    A1
                                          48                                       33
                                     49                                                 32
                                                                                                                       0.08mm ccc
                                                                                                                    Seating Plane
                                                                                                                                    B
                          B
                                                                                             E3   E1   E
                                 64                                                     17
                                          1                                        16
                                                                                                                                        C
                                                   e
                                                                                                       L1
                                                                                                            L
                                                                                                                K
                                                                          TQFP64
                                                                                                                                                0051434 F
62/64                                                               Doc ID 14219 Rev 3


L9658                                                                          Revision history
6     Revision history
      Table 49.   Document revision history
            Date     Revision                              Changes
        28-Nov-2007     1      Initial release.
                               Document status promoted from preliminary data to datasheet.
        10-Dec-2010     2      Add Section 4.11.5: Example of short between loops diagnostic on
                               page 38.
        20-Sep-2013     3      Updated disclaimer
                                 Doc ID 14219 Rev 3                                         63/64


                                                                                                                                       L9658
                                                             Please Read Carefully:
Information in this document is provided solely in connection with ST products. STMicroelectronics NV and its subsidiaries (“ST”) reserve the
right to make changes, corrections, modifications or improvements, to this document, and the products and services described herein at any
time, without notice.
All ST products are sold pursuant to ST’s terms and conditions of sale.
Purchasers are solely responsible for the choice, selection and use of the ST products and services described herein, and ST assumes no
liability whatsoever relating to the choice, selection or use of the ST products and services described herein.
No license, express or implied, by estoppel or otherwise, to any intellectual property rights is granted under this document. If any part of this
document refers to any third party products or services it shall not be deemed a license grant by ST for the use of such third party products
or services, or any intellectual property contained therein or considered as a warranty covering the use in any manner whatsoever of such
third party products or services or any intellectual property contained therein.
UNLESS OTHERWISE SET FORTH IN ST’S TERMS AND CONDITIONS OF SALE ST DISCLAIMS ANY EXPRESS OR IMPLIED
WARRANTY WITH RESPECT TO THE USE AND/OR SALE OF ST PRODUCTS INCLUDING WITHOUT LIMITATION IMPLIED
WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE (AND THEIR EQUIVALENTS UNDER THE LAWS
OF ANY JURISDICTION), OR INFRINGEMENT OF ANY PATENT, COPYRIGHT OR OTHER INTELLECTUAL PROPERTY RIGHT.
ST PRODUCTS ARE NOT DESIGNED OR AUTHORIZED FOR USE IN: (A) SAFETY CRITICAL APPLICATIONS SUCH AS LIFE
SUPPORTING, ACTIVE IMPLANTED DEVICES OR SYSTEMS WITH PRODUCT FUNCTIONAL SAFETY REQUIREMENTS; (B)
AERONAUTIC APPLICATIONS; (C) AUTOMOTIVE APPLICATIONS OR ENVIRONMENTS, AND/OR (D) AEROSPACE APPLICATIONS
OR ENVIRONMENTS. WHERE ST PRODUCTS ARE NOT DESIGNED FOR SUCH USE, THE PURCHASER SHALL USE PRODUCTS AT
PURCHASER’S SOLE RISK, EVEN IF ST HAS BEEN INFORMED IN WRITING OF SUCH USAGE, UNLESS A PRODUCT IS
EXPRESSLY DESIGNATED BY ST AS BEING INTENDED FOR “AUTOMOTIVE, AUTOMOTIVE SAFETY OR MEDICAL” INDUSTRY
DOMAINS ACCORDING TO ST PRODUCT DESIGN SPECIFICATIONS. PRODUCTS FORMALLY ESCC, QML OR JAN QUALIFIED ARE
DEEMED SUITABLE FOR USE IN AEROSPACE BY THE CORRESPONDING GOVERNMENTAL AGENCY.
Resale of ST products with provisions different from the statements and/or technical features set forth in this document shall immediately void
any warranty granted by ST for the ST product or service described herein and shall not create or extend in any manner whatsoever, any
liability of ST.
                            ST and the ST logo are trademarks or registered trademarks of ST in various countries.
                           Information in this document supersedes and replaces all information previously supplied.
            The ST logo is a registered trademark of STMicroelectronics. All other names are the property of their respective owners.
                                                 © 2013 STMicroelectronics - All rights reserved
                                                     STMicroelectronics group of companies
   Australia - Belgium - Brazil - Canada - China - Czech Republic - Finland - France - Germany - Hong Kong - India - Israel - Italy - Japan -
       Malaysia - Malta - Morocco - Philippines - Singapore - Spain - Sweden - Switzerland - United Kingdom - United States of America
                                                                   www.st.com
64/64                                                        Doc ID 14219 Rev 3


Mouser Electronics
Authorized Distributor
Click to View Pricing, Inventory, Delivery & Lifecycle Information:
STMicroelectronics:
 L9658 L9658TR
