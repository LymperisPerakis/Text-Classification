NCN5120
Transceiver for KNX
Twisted Pair Networks
Introduction
   NCN5120 is a receiver−transmitter IC suitable for use in KNX
twisted pair networks (KNX TP1−256). It supports the connection of                          www.onsemi.com
actuators, sensors, microcontrollers, switches or other applications in
a building network.
   NCN5120 handles the transmission and reception of data on the bus.
It generates from the unregulated bus voltage stabilized voltages for its                                         QFN40
own power needs as well as to power external devices, for example, a                                           MN SUFFIX
microcontroller.                                                                                              CASE 485AU
                                                                                     1 40
   NCN5120 assures safe coupling to and decoupling from the bus.
Bus monitoring warns the external microcontroller in case of loss of
power so that critical data can be stored in time.
Key Features                                                                              MARKING DIAGRAM
•  Replaced by NCN5121
•  9600 baud KNX Communication Speed
                                                                                                   NCN5120
•  Supervision of KNX Bus Voltage                                                                 21245−002
•  Supports Bus Current Consumption up to 13 and 26 mA                                           AWLYYWWG
•  Selectable KNX Bus Current (0.5 mA/ms and 1.0 mA/ms)
•  High Efficient DC−DC Converters                                                    A      = Assembly Location
    ♦ 3.3 V Fixed                                                                     WL     = Wafer Lot
    ♦ 3.3 V to 21 V Selectable                                                        YY     = Year
                                                                                      WW     = Work Week
•  Control and Monitoring of Power Regulators                                         G      = Pb−Free Package
•  Linear 20 V Regulator
•  Prepared for Sleep Mode
•  Buffering of Sent Data Frames (Extended Frames Supported)                          ORDERING INFORMATION
•  Selectable UART or SPI Interface to Host Controller                    See detailed ordering and shipping information in the package
                                                                          dimensions section on page 54 of this data sheet.
•  Selectable UART and SPI baud Rate to Host Controller
•  Optional CRC on UART to the Host
•  Optional Received Frame−end with MARKER Service
•  Optional Direct Coupling of RxD and TxD to Host (analog mode)
•  Operates with Industry Standard Low Cost 16 MHz Quartz
•  Generates Clock of 8 or 16 MHz for External Devices
•  Auto Acknowledge (optional)
•  Auto Polling (optional)
•  Temperature Monitoring
•  Operating Temperature Range −25°C to +85°C
•  These Devices are Pb−Free and are RoHS Compliant
 © Semiconductor Components Industries, LLC, 2015              1                                        Publication Order Number:
 January, 2019 − Rev. 7                                                                                                   NCN5120/D


                                                                              NCN5120
                                                          BLOCK DIAGRAM
                    CEQ1      CEQ2       VFILT                                                   VDDA          VSSA                VDDD      VSSD
                     Bus Coupler
      CAV                                                                                                                                                   SCK/UC2
                                                                                                                    UART
    VBUS1            Impedance                                                                                                                              SDI/RXD
                       Control                                                       KNX                                                  Interface
                                                                                     DLL                                                                    SDO/TXD
                      Receiver                                                                                                            Controller
                                                                                                                                                            CSB/UC1
                                                                                                                    SPI
      CCP                                                                                                                                                   TREQ
                                                                                                                                                            MODE1
                                                                                                                                        Mode
      TXO             Transmitter                                                                                                                           MODE2
    VBUS2
             VAUX
                                                                                                                                                            VIN
                                                                             NCN5120                                                                        VSW1
FANIN/WAKE          Wake−Up                                                                                                          DC/DC
                                                                                                                                   Converter 1              VDD1M
                                                                                                                                                            VDD1
                    Fan−In
                    Control                                                                                                                                 VSS1
      V20V          20V LDO                                                 POR                        RC
                                                                                                       OSC
                                                                                                                                                            VSW2
     XTAL1                            OSC
                     OSC                                                             TW                                              DC/DC                  VDD2MC
     XTAL2                                                                                              UVD                        Converter 2
                                                                                     TSD                                                                    VDD2MV
     XSEL                                                                                                                                                   VDD2
                                                                               Diagnostics                                                                  VSS2
     XCLK
                                     TESTOUT                            SAVEB                RESETB
                                      Figure 1. Block Diagram NCN5120
                                                                                PIN OUT
                                                     TESTOUT   FANIN/WAKE   RESETB
                                            VDDA                                     SAVEB   XTAL1   XTAL2   XSEL   XCLK   VSSD
                                            40        39        38           37      36      35      34      33     32     31
                     VSSA        1                                                                                                      30        VDDD
                    VBUS2        2                                                                                                      29        SCK/UC2
                      TXO        3                                                                                                      28        SDO/TXD
                      CCP        4                                                                                                      27        SDI/RXD
                      CAV        5                                                                                                      26        CSB/UC1
                    VBUS1        6
                                                                            NCN5120                                                     25        TREQ
                     CEQ1        7                                                                                                      24        MODE2
                     CEQ2        8                                                                                                      23        MODE1
                     VFILT       9                                                                                                      22        NC
                      V20V    10                                                                                                        21        NC
                                            11        12        13           14      15      16      17      18     19     20
                                                                                             VIN
                                                               VDD2         VSS2     VSW2            VSW1    VSS1   VDD1
                                            VDD2MV   VDD2MC
                                                                                                                           VDD1M
                                     Figure 2. Pin Out NCN5120 (Top View)
                                                               www.onsemi.com
                                                                                             2


                                                            NCN5120
                                                      PIN DESCRIPTION
Table 1. PIN LIST AND DESCRIPTION
                                                                                                             Equivalent
    Name          Pin                                 Description                                Type        Schematic
    VSSA            1     Analog Supply Voltage Ground                                          Supply
   VBUS2            2     Ground for KNX Transmitter                                            Supply
     TX0            3     KNX Transmitter Output                                            Analog Output      Type 1
     CCP            4     AC coupling external capacitor connection                           Analog I/O       Type 2
     CAV            5     Capacitor connection to average bus DC voltage                      Analog I/O       Type 3
   VBUS1            6     KNX power supply input                                                Supply         Type 5
    CEQ1            7     Capacitor connection 1 for defining equalization pulse              Analog I/O       Type 4
    CEQ2            8     Capacitor connection 2 for defining equalization pulse              Analog I/O       Type 4
    VFILT           9     Filtered bus voltage                                                  Supply         Type 5
    V20V           10     20V supply output                                                     Supply         Type 5
  VDD2MV           11     Voltage monitor of Voltage Regulator 2                             Analog Input      Type 8
  VDD2MC           12     Current monitor input 1 of Voltage Regulator 2                     Analog Input      Type 9
    VDD2           13     Current monitor input 2 of Voltage Regulator 2                     Analog Input      Type 8
    VSS2           14     Voltage Regulator 2 Ground                                            Supply
   VSW2            15     Switch output of Voltage Regulator 2                              Analog Output      Type 6
     VIN           16     Voltage Regulator 1 and 2 Power Supply Input                          Supply         Type 5
   VSW1            17     Switch output of Voltage Regulator 1                              Analog Output      Type 6
    VSS1           18     Voltage Regulator 1 Ground                                            Supply
    VDD1           19     Current Input 2 and Voltage Monitor Input of Voltage Regulator 1   Analog Input      Type 8
   VDD1M           20     Current Monitor Input 1 of Voltage Monitor 1                       Analog Input      Type 9
     NC          21, 22   Not connected (do not connect)
   MODE1           23     Mode Selection Input 1                                             Digital Input    Type 12
   MODE2           24     Mode Selection Input 2                                             Digital Input    Type 12
    TREQ           25     Transmit Request Input                                             Digital Input    Type 12
  CSB/UC1          26     Chip Select Output (SPI) or Configuration Input (UART)           Digital Output or Type 13 or
                                                                                             Digital Input       14
  SDI/RXD          27     Serial Data Input (SPI) or Receive Input (UART)                    Digital Input    Type 14
 SDO/TXD           28     Serial Data Output (SPI) or Transmit Output (UART)                Digital Output    Type 13
  SCK/UC2          29     Serial Clock Output (SPI) or Configuration Input (UART)          Digital Output or Type 13 or
                                                                                             Digital Input       14
   VDDD            30     Digital Supply Voltage Input                                          Supply         Type 7
    VSSD           31     Digital Supply Voltage Ground                                         Supply
    XCLK           32     Oscillator Clock Output                                           Digital Output    Type 13
    XSEL           33     Clock Selection (Quartz or Digital Clock)                          Digital Input    Type 12
   XTAL2           34     Clock Generator Output (Quartz) or Input (Digital Clock)         Analog Output or  Type 10 or
                                                                                             Digital Input       14
   XTAL1           35     Clock Generator Input (Quartz)                                     Analog Input     Type 10
   SAVEB           36     Save Signal (open drain with pull−up)                             Digital Output    Type 15
  RESETB           37     Reset Signal (open drain with pull−up)                            Digital Output    Type 15
FANIN/WAKE         38     Fan−In and Wake−Up Input                                           Digital Input    Type 11
 TESTOUT           39     Test Output (do not connect)                                      Analog Output
    VDDA           40     Analog Supply Voltage Input                                           Supply         Type 7
NOTE:    Type of CSB/UC1 and SCK/UC2 is depending on status MODE1 − MODE2 pin
         Type of XTAL1 and XTAL2 pin is depending on status XSEL pin.
                                                       www.onsemi.com
                                                                 3


                                                                             NCN5120
                                                                EQUIVALENT SCHEMATICS
  Following figure gives the equivalent schematics of the user relevant inputs and outputs. The diagrams are simplified
representations of the circuits used.
                                                     CCP
                                                                 60V
      TXO                                                                                      CAV                              CEQx
                     60V                                         60V                                         7V                                60V
               Type 1: TXO−pin                            Type 2: CCP−pin                          Type 3: CAV−pin            Type 4: CEQ1 and CEQ2−pin
                                                                                                                                                   VIN
                                VBUS1                     VFILT                  V20V                    VIN
                                                                                                                                                 60V
                    VBUS1                VFILT                     V20V                    VIN
                                                                                                                                  VSWx
                                60V                      60V                    60V                     60V
                                       Type 5: VBUS1−, VFILT−, V20V and VIN−pin                                             Type 6: VSW1 and VSW2−pin
                           VDDD                  VDDA
        VDDD                      VDDA                                    VDD1                          VDD2                 VDD2MV
                         7V                    7V                                       7V                         60V                        7V
                  Type 7: VDDD− and VDDA−pin                                                   Type 8: VDD1−, VDD2− and VDD2MV−pin
            VDD1                            VDD2                               VDDD                           VDDD
                                                                                                                                              Vaux
                                                                                                                                                   R UP
                 7V                              7V
 VDD1M                          VDD2MC                               XTAL2                       XTAL1                 FANIN/WAKE
                 7V                              60V                                                                                      7V
            Type 9: VDD1M− and VDD2MC−pin                                    Type 10: XTAL1− and XTAL2−pin                       Type 11: FANIN/WAKE−pin
                                                                                                                                         VDDD
              VDDD                                       VDDD                                      VDDD
                                                                                                                                                   RUP
       IN                                      OUT                                          IN                                OUT
                          RDOWN
     Type 12: MODE1−, MODE2−,                         Type 13: CSB/UC1−,                         Type 14: CSB/UC1−,                Type 15: RESETB− and
          TREQ− and XSEL−pin                         SDO/TXD−, SCK/UC2−                          SDI/RXD−, SCK/UC2                       SAVEB−pin
                                                            and XCLK−pin                             and XTAL2−pin
NOTE:      Type of CSB/UC1 and SCK/UC2 is depending on status MODE1 − MODE2 pin
           Type of XTAL1 and XTAL2 pin is depending on status XSEL pin.
                                                    Figure 3. In− and Output Equivalent Diagrams
                                                                        www.onsemi.com
                                                                                      4


                                                                 NCN5120
                                                   ELECTRICAL SPECIFICATION
  Table 2. ABSOLUTE MAXIMUM RATINGS (Notes 1 and 2)
   Symbol                                           Parameter                                            Min           Max          Unit
     VTXO       KNX Transmitter Output Voltage                                                           −0.3          +45             V
      ITXO      KNX Transmitter Output Current (Note 3)                                                                250           mA
     VCCP       Voltage on CCP−pin                                                                      −10.5         +14.5            V
     VCAV       Voltage on CAV−pin                                                                       −0.3          +3.6            V
    VBUS1       Voltage on VBUS1−pin                                                                     −0.3          +45             V
     IBUS1      Current Consumption VBUS1−pin                                                             0              60          mA
     VCEQ       Voltage on pins CEQ1 and CEQ2                                                            −0.3          +45             V
     VFILT      Voltage on VFILT−pin                                                                     −0.3          +45             V
      V20V      Voltage on V20V−pin                                                                      −0.3          +25             V
   VDD2MV       Voltage on VDD2MV−pin                                                                    −0.3          +3.6            V
   VDD2MC       Voltage on VDD2MC−pin                                                                    −0.3          +45             V
     VDD2       Voltage on VDD2−pin                                                                      −0.3          +45             V
      VSW       Voltage on VSW1− and VSW2−pin                                                            −0.3          +45             V
       VIN      Voltage on VIN−pin                                                                       −0.3          +45             V
     VDD1       Voltage on VDD1−pin                                                                      −0.3          +3.6            V
   VDD1M        Voltage on VDD1M−pin                                                                     −0.3          +3.6            V
      VDIG      Voltage on pins MODE1, MODE2, TREQ, CSB/UC1, SDI/TXD, SDO/RXD, SCK/                      −0.3          +3.6            V
                UC2, XCLK, XSEL, SAVEB, RESETB and FANIN/WAKE
      VDD       Voltage on VDDD− and VDDA−pin                                                            −0.3          +3.6            V
    VXTAL       Voltage on XTAL1− and XTAL2−pin                                                          −0.3          +3.6            V
       TST      Storage temperature                                                                      −55           +150           °C
        TJ      Junction Temperature (Note 4)                                                            −25           +155           °C
     VHBM       Human Body Model electronic discharge immunity (Note 5)                                   −2            +2            kV
Stresses exceeding those listed in the Maximum Ratings table may damage the device. If any of these limits are exceeded, device functionality
should not be assumed, damage may occur and reliability may be affected.
1. Convention: currents flowing in the circuit are defined as positive.
2. VBUS2, VSS1, VSS2, VSSA and VSSD form the common ground. They are hard connected to the PCB ground layer.
3. Room temperature, 27 W shunt resistor for transmitter, 250 mA over temperature range.
4. Normal performance within the limitations is guaranteed up to the Thermal Warning level. Between Thermal Warning and Thermal Shutdown
    temporary loss of function or degradation of performance (which ceases after the disturbance ceases) is possible.
5. According to JEDEC JESD22−A114.
                                                             www.onsemi.com
                                                                        5


                                                                 NCN5120
Recommend Operation Conditions
   Operating ranges define the limits for functional operation and parametric characteristics of the device. Note that the
functionality of the chip outside these operating ranges is not guaranteed. Operating outside the recommended operating ranges
for extended periods of time may affect device reliability.
  Table 3. OPERATING RANGES
   Symbol                                          Parameter                                          Min       Max     Unit
    VBUS1       VBUS1 Voltage (Note 6)                                                                +20        +33      V
     VDD        Digital and Analog Supply Voltage (VDDD− and VDDA−pin)                               +3.13      +3.47     V
      VIN       Input Voltage DC−DC Converter 1 and 2 (Note 7)                                       +8.47       +33      V
    VCCP        Input Voltage at CCP−pin                                                             −10.5      +14.5     V
     VDD1       Input Voltage on VDD1−pin                                                            +3.13      +3.47     V
    VDD1M       Input Voltage on VDD1M−pin                                                           +3.13      +3.57     V
     VDD2       Input Voltage on VDD2−pin                                                             +3.1       +21      V
   VDD2MC       Input Voltage on VDD2MC−pin                                                           +3.1      +21.1     V
   VDD2MV       Input Voltage on VDD2MV−pin                                                           +1.2      VDD       V
     VDIG       Input Voltage on pins MODE1, MODE2, TREQ, CSB/UC1, SDI/RXD, SCK/UC2,                   0        VDD       V
                and XSEL
    VWAKE       Input Voltage on FANIN/WAKE−pin                                                        0         3.6      V
      fclk      Clock Frequency External Quartz                                                             16          MHz
      TA        Ambient Temperature                                                                   −25        +85     °C
       TJ       Junction Temperature (Note 8)                                                         −25       +125     °C
6. Voltage indicates DC value. With equalization pulse bus voltage must be between 11 V and 45 V.
7. Minimum operating voltage on VIN−pin should be equal to the highest value of VDD1 and VDD2.
8. Higher junction temperature can result in reduced lifetime.
 Table 4. DC PARAMETERS The DC parameters are given for a device operating within the Recommended Operating Conditions
 unless otherwise specified. Convention: currents flowing in the circuit are defined as positive.
   Symbol           Pin(s)                  Parameter                  Remark/Test Conditions      Min     Typ     Max  Unit
 POWER SUPPLY
                                                                    Excluding active and
    VBUS1                        Bus DC voltage                                                     20              33    V
                                                                    equalization pulse
                                                                    Normal operating mode. No
                                                                    external load, DC1 and DC2
                                                                    enabled, continuous trans−
   IBUS1_Int                     Bus Current Consumption                                                    5           mA
                                                                    mission of ‘0’ on the KNX bus
                                                                    by another KNX device (50%
                   VBUS1                                            bus load), based on Figure 14
                                 Sleep Mode Current
    ISLEEP                                                                                                 1.35    1.8  mA
                                 Consumption
    VBUSH                        Undervoltage release level         VBUS1 rising, see Figure 4     17.1    18.0    18.9   V
    VBUSL                        Undervoltage trigger level         VBUS1 falling, see Figure 4    15.9    16.8    17.7   V
  VBUS_Hyst                      Undervoltage hysteresis                                           0.6                    V
     VDDD           VDDD         Digital Power Supply                                              3.13    3.3     3.47   V
     VDDA           VDDA         Analog Power Supply                                               3.13    3.3     3.47   V
     VAUX                        Auxiliary Supply                   Internal supply, for info only 2.8     3.3     3.6    V
 KNX BUS COUPLER
                                                                    FANIN/WAKE = 1, VFILT >
                                                                                                    13              30  mA
                                                                    VFILTH
  Icoupler_lim     VBUS1         Bus Coupler Current Limitation
                                                                    FANIN/WAKE = 0, VFILT >
                                                                                                    26              60  mA
                                                                    VFILTH
                                                            www.onsemi.com
                                                                       6


                                                                NCN5120
Table 4. DC PARAMETERS The DC parameters are given for a device operating within the Recommended Operating Conditions
unless otherwise specified. Convention: currents flowing in the circuit are defined as positive.
  Symbol           Pin(s)                 Parameter                    Remark/Test Conditions       Min  Typ  Max   Unit
KNX BUS COUPLER
                                                                     IBUS1 = 12 mA
                                                                                                    3.5        6.5    V
                                                                     Vcoupler_drop = VBUS1 − VFILT
                  VBUS1,
Vcoupler_drop                  Coupler Voltage Drop
                   VFILT                                             IBUS1 = 24 mA
                                                                                                    4.5         8     V
                                                                     Vcoupler_drop = VBUS1 − VFILT
    VFILTH                     Undervoltage release level          VFILT rising, see Figure 5      10.1 10.6  11.2    V
                   VFILT
    VFILTL                     Undervoltage trigger level          VFILT falling, see Figure 5      8.4  8.9   9.4    V
FIXED DC−DC CONVERTER
      VIN           VIN        Input Voltage                                                       8.47        33     V
     VDD1          VDD1        Output Voltage                                                      3.13  3.3  3.47    V
  VDD1_rip                     Output Voltage Ripple               VIN = 25 V, IDD1 = 40 mA              40         mV
   IDD1_lim                    Overcurrent Threshold               R2 = 1 W, see Figure 14         −100       −200  mA
                                                                   Vin = 25 V, IDD1 = 35 mA,
                               Power Efficiency
    hVDD1                                                          L1 = 220 mH (1.26 W ESR),             90           %
                               (DC Converter Only)
                                                                   see Figure 13
 RDS(on)_p1                    RDS(on) of power switch             See Figure 17                                8     W
 RDS(on)_n1                    RDS(on) of flyback switch           See Figure 17                                4     W
    VDD1M         VDD1M        Input voltage VDD1M−pin                                                        3.57    V
ADJUSTABLE DC−DC CONVERTER
      VIN           VIN        Input Voltage                                                       VDD2        33     V
     VDD2                      Output Voltage                      VIN ≥ VDD2                       3.3        21     V
                                                                                                        0.9 x
    VDD2H                      Undervoltage release level          VDD2 rising, see Figure 6                          V
                   VDD2                                                                                 VDD2
                                                                                                        0.8 x
    VDD2L                      Undervoltage trigger level          VDD2 falling, see Figure 6                         V
                                                                                                        VDD2
                                                                   VIN = 25 V, VDD2 = 3.3 V,
  VDD2_rip                     Output Voltage Ripple                                                     40         mV
                                                                   IDD2 = 40 mA
   IDD2_lim                    Overcurrent Threshold               R3 = 1 W, see Figure 14         −100       −200  mA
                                                                   Vin = 25 V, VDD2 = 3.3 V,
                               Power Efficiency
    hVDD2                                                          IDD2 = 35 mA, L2 = 220 mH             90           %
                               (DC Converter Only)
                                                                   (1.26 W ESR), see Figure 14
 RDS(on)_p2                    RDS(on) of power switch             See Figure 17                                8     W
 RDS(on)_n2                    RDS(on) of flyback switch           See Figure 17                                4     W
    VDD2M        VDD2MC        Input voltage VDD2MC−pin                                                       21.1    V
   RVDD2M        VDD2MV        Input Resistance VDD2MV−pin                                          60  100   140    kW
  Ileak,vsw2                   Half−bridge leakage                                                             20    mA
V20V REGULATOR
     V20V                      V20V Output Voltage                 I20V < 4 mA, VFILT ≥ 21 V        18   20    22     V
     I20V                      V20V Output Current                                                   0         −4   mA
   I20V_lim                    V20V Output Current Limitation                                                  −11  mA
                   V20V        V20V Undervoltage release
    V20VH                                                          V20V rising, see Figure 7       12.6 13.4  14.2    V
                               level
                               V20V Undervoltage trigger
    V20VL                                                          V20V falling, see Figure 7      11.8 12.6  13.4    V
                               level
  V20V_hyst                    V20V Undervoltage hysteresis        V20V_hyst = V20VH – V20VL             0.8          V
                                                           www.onsemi.com
                                                                       7


                                                                NCN5120
Table 4. DC PARAMETERS The DC parameters are given for a device operating within the Recommended Operating Conditions
unless otherwise specified. Convention: currents flowing in the circuit are defined as positive.
  Symbol           Pin(s)                Parameter                    Remark/Test Conditions      Min   Typ  Max    Unit
XTAL OSCILLATOR
   VXTAL      XTAL1, XTAL2 Voltage on XTAL−pin                                                               VDDD     V
FAN−IN AND WAKE−UP CONTROL
  VWAKE_H                      FANIN/WAKE−pin release level See Figure 8                          1.5   1.8   2.1     V
  VWAKE_L                      FANIN/WAKE−pin active level         See Figure 8                   0.9   1.2   1.4     V
                  FANIN/       Hysteresis on FANIN/WAKE−
 VWAKE_hyst       WAKE                                             See Figure 8                         0.6           V
                               pin
                               Pull−Up Resistor FANIN/
   RWAKE                                                           Pull−up connected to VAUX       80   165   270     W
                               WAKE−pin
DIGITAL INPUTS
     VIL        SCK/UC2,       Logic Low Threshold                                                 0          0.7     V
     VIH         SDI/RXD,      Logic High Threshold                                               2.65       VDDD     V
                CSB/UC1,
                  TREQ,                                            SCK/UC2−, SDI/RXD− and
   RDOWN         MODE1,        Internal Pull−Down Resistor         CSB/UC1 pin excluded. Only      5     10   28     kW
              MODE2, XSEL                                          valid in Normal State.
DIGITAL OUTPUTS
    VOL         SCK/UC2,       Logic low output level                                              0          0.4     V
                SDO/TXD,
                CSB/UC1,                                                                         VDDD −
    VOH                        Logic high output level                                                       VDDD     V
                   XCLK                                                                           0.45
                SCK/UC2,
                                                                                                               8    mA
                   XCLK
      IL                       Load Current
                SDO/TXD,
                                                                                                               4    mA
                 CSB/UC1
    VOL           SAVEB,       Logic low level open drain          IOL = 4 mA                                 0.4     V
    Rup          RESETB        Internal Pull−up Resistor                                           20    40   80     kW
TEMPERATURE MONITOR
                                                                   Rising temperature
    TTW                        Thermal Warning                                                    105   115   135    °C
                                                                   See Figure 9
                                                                   Rising temperature
    TTSD                       Thermal shutdown                                                   125   140   155    °C
                                                                   See Figure 9
    THyst                      Thermal Hysteresis                  See Figure 9                    5     11   15     °C
     DT                        Delta TTSD and TTW                  See Figure 9                          25          °C
PACKAGE THERMAL RESISTANCE VALUE
                                                                   Simulated Conform
                                                                                                         30         K/W
                                                                   JEDEC JESD−51, (2S2P)
                               Thermal Resistance
    Rthja
                               Junction−to−Ambient                 Simulated Conform
                                                                                                         60         K/W
                                                                   JEDEC JESD−51, (1S0P)
                               Thermal Resistance
    Rthjp                                                                                               0.95        K/W
                               Junction−to−Exposed Pad
                                                           www.onsemi.com
                                                                      8


                                                         NCN5120
Table 5. AC PARAMETER The AC parameters are given for a device operating within the Recommended Operating Conditions
unless otherwise specified.
     Symbol       Pin(s)               Parameter               Remark/Test Conditions      Min     Typ       Max     Unit
POWER SUPPLY
tBUS_FILTER       VBUS1     VBUS1 filter time              See Figure 4                              2                ms
FIXED DC−DC CONVERTER
  tVSW1_rise                Rising slope at VSW1−pin                                               0.45              V/ns
                  VSW1
   tVSW1_fall               Falling slope at VSW1−pin                                               0.6              V/ns
ADJUSTABLE DC−DC CONVERTER
  tVSW2_rise                Rising slope at VSW2−pin                                               0.45              V/ns
                  VSW2
   tVSW2_fall               Falling slope at VSW2−pin                                               0.6              V/ns
XTAL OSCILLATOR
        fXTAL XTAL1, XTAL2 XTAL Oscillator Frequency                                                16               MHz
FAN−IN AND WAKE−UP CONTROL
                  FANIN/    Debounce Time on FANIN/
       tWAKE                                               See Figure 8                                      100      ms
                  WAKE      WAKE−pin
WATCHDOG
                            Prohibited Watchdog
      tWDPR                                                See Watchdog, p19                 2                33      ms
                            Acknowledge Delay
      tWDTO                 Watchdog Timeout Interval      Selectable over UART or SPI      33               524      ms
                            Watchdog Timeout Interval
  tWDTO_acc                                                                                        =Xtal accuracy
                            Accuracy
      tWDRD                 Watchdog Reset Delay                                                     0                ns
      tRESET                Reset Duration                                                           8                ms
MASTER SERIAL PERIPHERAL INTERFACE (MASTER SPI)
                                                                                                     2                ms
         tsck               SPI Clock period
                                                           SPI Baudrate depending on                 8                ms
                   SCK                                     configuration input bits (see
  tSCK_HIGH                 SPI Clock high time            Interface Mode, p24). Tolerance       tSCK / 2
   tSCK_LOW                 SPI Clock low time             is equal to Xtal oscillator           tSCK / 2
                                                           tolerance.
    tSDI_SET                SPI Data Input setup time      See also Figure 11               125                       ns
                   SDI
  tSDI_HOLD                 SPI Data Input hold time                                        125                       ns
 tSDO_VALID        SDO      SPI Data Output valid time     CL = 20 pF, See Figure 11                         100      ns
                                                                                           0.5 x
    tCS_HIGH                SPI Chip Select high time
                                                                                           tSCK
                                                                                           0.5 x
     tCS_SET       CSB      SPI Chip Select setup time     See Figure 11                   tSCK
                                                                                           0.5 x
   tCS_HOLD                 SPI Chip Select hold time
                                                                                           tSCK
 tTREQ_LOW                  TREQ low time                                                   125                       ns
 tTREQ_HIGH                 TREQ high time                                                  125                       ns
                  TREQ                                     See Figure 12
  tTREQ_SET                 TREQ setup time                                                 125                       ns
tTREQ_HOLD                  TREQ hold time                                                  125                       ns
UNIVERSAL ASYNCHRONOUS RECEIVER/TRANSMITTER (UART)
                                                           Baudrate depending on
                                                                                                  19200              Baud
                                                           configuration input pins (see
       fUART    TXD, RXD    UART Interface Baudrate        Interface Mode, p24).
                                                           Tolerance is equal to tolerance        38400              Baud
                                                           of Xtal oscillator tolerance.
                                                       www.onsemi.com
                                                               9


                                               NCN5120
   VBUS
    VBUSH
    VBUSL
                                                    t BUS_FILTER                       t BUS_FILTER
                                                                                                    t
  <VBUS>
Comments:
<VBUS> is an internal signal which can be verified with the Internal State Service.
                   Figure 4. Bus Voltage Undervoltage Threshold
         VFILT
          VFILTH
          VFILTL
                                                                                               t
       <VFILT>
     Comments:
     <VFILT> is an internal signal which can be verified with the System State Service
                         Figure 5. VFILT Undervoltage Threshold
           VDD2
           VDD2H
           VDD2L
                                                                                               t
    <VDD2>
     Comments:
     <VDD2> is an internal signal which can be verified with the System State Service
                        Figure 6. VDD2 Undervoltage Thresholds
                                        www.onsemi.com
                                                      10


                                                 NCN5120
        V20V
       V20VH
       V20VL
                   V20V_hyst
                                                                                                                         t
   <V20V>
 Comments:
 <V20V> is an internal signal which can be verified with the System State Service.
               Figure 7. V20V Undervoltage Threshold levels
V FANIN/WAKE
    V WAKE_H
                                                                                                          V WAKE_Hyst
    V WAKE_L
                                                                                                                         t
               ≤ t WAKE                                                                t WAKE
    <WAKE>
     Comments:
      −<WAKE> is an internal signal indicating a wake up
      −Wake functionality only possible when FANIN/WAKE−pin is high during normal operation
             Figure 8. Wake−Up Threshold Levels and Timing
         T                                                                     THyst
      TTSD
                                                                                                  THyst
       TTW                 nT
                                                                                                                t
      <TW>
    SAVEB
  RESETB
                                    Stand-By                             Stand-By
                           Normal                Reset
                                                              Start-Up                          Normal
                                                                                                              Analog State
      Comments:
       - <TW> is an internal signal which can be verified with the System State Service.
       - No SPI/UART communication possible when RESETB is low!
       - It's assumed all voltage supplies are within their operating condition.
                   Figure 9. Temperature Monitoring Levels
                                               www.onsemi.com
                                                         11


                                                                         NCN5120
       RESETB
                                                                                                                                    t reset     t
                      Enable                                             Re−enable
                     Watchdog                                             Watchdog
       <WDEN>
                                                                                                                                                t
                                      > t WDPR and < t WDTO                        vt WDPR and wt WDTO                  t WDRD
      WD Timer
             t WDTO
             t WDPR
                                                                                                                                                t
      Remarks:
        − WD Timer is an internal timer
        − t WDTO = <WDT[3:0]>
        − <WDEN> and <WDT[3:0]> are Watchdog Register bits
                                                   Figure 10. Watchdog Timing Diagram
        CS
          ÉÉÉÉÉÉ                                                   ÉÉÉÉÉÉÉÉÉÉÉÉÉÉÉÉ
      CLK
          ÉÉÉÉÉÉ
          ÉÉÉÉÉÉ                                                   ÉÉÉÉÉÉÉÉÉÉÉÉÉÉÉÉ
                                                                   ÉÉÉÉÉÉÉÉÉÉÉÉÉÉÉÉ
                                                                             ÉÉÉÉÉÉÉÉÉÉÉÉÉÉ
         DI
       DO
          ÉÉÉÉÉÉ
          ÉÉÉÉÉÉ                              tSDI_SET   tSDI _HOLD
                                                                             ÉÉÉÉÉÉÉÉÉÉÉÉÉÉ
                                                                             ÉÉÉÉÉÉÉÉÉÉÉÉÉÉ                                    tCS _HIGH
                                                                                  t SDO_VALID
                                         tCS _SET             tSCK _HIGH       tSCK _LOW
                                                                         tSCK                          tCS_HOLD
                                                     Figure 11. SPI Bus Timing Diagram
  CS
 CLK
    ÉÉÉÉÉ                                                                                                              ÉÉÉÉÉÉÉÉÉ
    ÉÉÉÉÉ
   DI                         LSB                         1                         2                    7
                                                                                                                       ÉÉÉÉÉÉÉÉÉ
    ÉÉÉÉÉ                                                                                                                    ÉÉÉÉÉÉÉÉ
  DO
    ÉÉÉÉÉ                     Dummy                         Dummy                     Dummy                Dummy
                                                                                                                             ÉÉÉÉÉÉÉÉ
TREQ
         tTREQ _SET                                                                                                                  tTREQ_HOLD
                                       tTREQ _LOW                                                            tTREQ_HIGH
                                                       Figure 12. TREQ Timing Diagram
                                                                       www.onsemi.com
                                                                                12


                                                                                           NCN5120
                                          TYPICAL APPLICATION SCHEMATICS
                                                                                                                                                                                                                                     RESETb
                                                                                                                                                                                                                                     SAVEb
                                                                                                                                                                                                                                     uC CLK
                                                                                                                    C8                                        C9
                                                                                                                                                                                                                           3.3
                                                                    3.3
                                                                                                                                                              X1
                                                       C5                                                                                                                                                                             VCC
                                                                             TESTOUT     FANIN/WAKE      RESETB
                                                                                                                                                                                                                                      GND
                                                                  VDDA                                                  SAVEB     XTAL1      XTAL2     XSEL       XCLK    VSSD                               3.3
                                                                      40            39           38                37        36         35        34         33      32         31                                   C6
                                                 VSSA                                                                                                                                       VDDD
                                                             1                                                                                                                        30
                                                 VBUS2                                                                                                                                      SCK/UC2
                 D1         R1                               2                                                                                                                        29
                                                     TXO                                                                                                                                    SDO/TXD                                   TxD
    A                                                        3                                                                                                                        28
                                                     CCP                                                                                                                                    SDI/RXD
                                                             4                                                                                                                        27
                                C1                   CAV                                                                                                                                    CSB/UC1                                    RxD
                                                             5                                                                                                                        26
                                                 VBUS1
                                                             6
                                                                                                        NCN5120                                                                       25
                                                                                                                                                                                            TREQ
                                                 CEQ1                                                                                                                                       MODE2
                                                             7                                                                                                                        24
                                            C2   CEQ2                                                                                                                                       MODE1
            D2                                               8                                                                                                                        23
                                                 VFILT                                                                                                                                      NC
                                                             9                                                                                                                        22
                                                     V20V                                                                                                                                   NC
                                                             10                                                                                                                       21
                           C3        C4    C7                         11            12           13                14        15         16        17         18      19         20
                                                                  VDD2MV     VDD2MC
                                                                                                                        VSW2                 VSW1                         VDD1M
                                                                                         VDD2            VSS2                                          VSS1       VDD1
                                                                                                                                  VIN
                                                     3.3
    B                                                                                                                                                                                     3.3
                                                                                                                                                                                                       C10
                                                                                                                                        L1                                           R2
Figure 13. Typical Application Schematic NCN5120, 9−bit UART Mode (19200bps), Single Supply
                                                                                                                                                                                                                                       RESETb
                                                                                                                                                                                                                                       SAVEb
                                                                  S1
                                                                                                                                                                                                                                       uC CLK
                                                                                                                             C8                                      C9
                                                                                                                                                                                                                               3.3
                                                                             3.3
                                                                                                                                                                     X1                                                   V2
                                                            C5                                                                                                                                                                           VCC
                                                                                       TESTOUT        FANIN/WAKE
                                                                                                                                                                                                                                        VCC2
                                                                                                                    RESETB      SAVEB     XTAL1      XTAL2
                                                                                                                                                                                                               3.3
                                                                           VDDA                                                                               XSEL       XCLK     VSSD                               C6                 GND
                                                                               40           39               38          37        36         35        34         33       32       31
                                                      VSSA                                                                                                                                        VDDD
                                                                    1                                                                                                                      30                                           SCK
                                                     VBUS2                                                                                                                                        SCK/UC2
                      D1        R1                                  2                                                                                                                      29
                                                       TXO                                                                                                                                        SDO/TXD                               SDO
        A                                                           3                                                                                                                      28
                                                       CCP                                                                                                                                        SDI/RXD
                                                                    4                                                                                                                      27                                               SDI
                                 C1                    CAV                                                                                                                                        CSB/UC1
                                                                    5                                                                                                                      26
                                                     VBUS1
                                                                    6
                                                                                                                    NCN5120                                                                25
                                                                                                                                                                                                  TREQ                                  SCB
                                                      CEQ1                                                                                                                                        MODE2
                                                                    7                                                                                                                      24                                            TREQ
                                                C2    CEQ2                                                                                                                                        MODE1
                 D2                                                 8                                                                                                                      23
                                                      VFILT                                                                                                                                       NC
                                                                    9                                                                                                                      22
                                                       V20V                                                                                                                                       NC
                                                                    10                                                                                                                     21
                            C3        C4    C7                                 11           12               13          14        15         16        17         18       19       20
                                                                           VDD2MV      VDD2MC
                                                                                                                                                                                  VDD1M
                                                                                                      VDD2          VSS2        VSW2                 VSW1     VSS1       VDD1
                                                                                                                                          VIN
        B                                                                                                                                                                                       3.3
                                                                                                                                                                                                         C10
                                                                                                                                               L1                                          R2
                                                                                                                          L2
                                                       R5
                                                                    R4
                                                                                                                                  R3                                      V2
                                                                                                                                                                                          C11
 Figure 14. Typical Application Schematic NCN5120, SPI (500 kbps), Dual Supply and Wake−up
                                                                    www.onsemi.com
                                                                                                                         13


                                                                       NCN5120
                                   TYPICAL APPLICATION SCHEMATICS
                                                                                                                                                                          RESETb
                                                                                                                                                                          SAVEb
                                                                                                                                                                    3.3
                                                       3.3
                                           C5                                                                                                                              VCC
                                                             TESTOUT           RESETB
                                                                                                                                                                           GND
                                                    VDDA               FANIN            SAVEB   XTAL1    XTAL2    XSEL   XCLK   VSSD                     3.3
                                                        40       39       38       37      36      35        34     33     32      31                          C6
                                        VSSA                                                                                                   VDDD
                                                1                                                                                       30
                                        VBUS2                                                                                                  SCK/UC2
         D1         R1                          2                                                                                       29
                                         TXO                                                                                                   SDO/TXD                     TxD
A                                               3                                                                                       28
                                         CCP                                                                                                   SDI/RXD
                                                4                                                                                       27
                        C1               CAV                                                                                                   CSB/UC1                      RxD
                                                5                                                                                       26
                                        VBUS1
                                                6
                                                                                 NCN5120                                                25
                                                                                                                                               TREQ
                                        CEQ1                                                                                                   MODE2
                                                7                                                                                       24
                                   C2   CEQ2                                                                                                   MODE1
        D2                                      8                                                                                       23
                                        VFILT                                                                                                  NC
                                                9                                                                                       22
                                         V20V                                                                                                  NC
                                                10                                                                                      21
                   C3        C4   C7                    11       12       13       14      15      16        17     18     19      20
                                                    VDD2MV   VDD2MC
                                                                                                                                VDD1M
                                                                       VDD2    VSS2     VSW2             VSW1     VSS1   VDD1
                                          3.3                                                   VIN
B                                                                                                                                            3.3
                                                                                                                                                      C10
                                                                                                        L1                              R2
Figure 15. Typical Application Schematic NCN5120, Analog Mode, Single Supply, 1.0 mA/ms Current Slope
                                   (FANIN/WAKE−pin Pulled to Ground)
                                                        www.onsemi.com
                                                                                   14


                                                                   NCN5120
  Table 6. EXTERNAL COMPONENTS LIST AND DESCRIPTION
  Comp.                       Function                    Min        Value      Max       Unit               Remarks                   Notes
     C1        AC coupling capacitor                      38           47        56        nF      50 V, Ceramic                          9
     C2        Equalization capacitor                     4.2         4.7       5.2        nF      25 V, Ceramic                          9
     C3        Capacitor to average bus DC voltage        80          100       120        nF      50 V, Ceramic                          9
     C4        Storage and filter capacitor VFILT         80          100      1000        mF      35 V                                   9
     C5        VDDA HF rejection capacitor                80          100                  nF      6.3 V, Ceramic
     C6        VDDD HF rejection capacitor                80          100                  nF      6.3 V, Ceramic
     C7        Load Capacitor V20V                                     1                   mF      35 V, Ceramic, ESR < 2 W            14, 15
  C8, C9       Parallel capacitor X−tal                    8           10        12        pF      6.3 V, Ceramic                        10
     C10       Load capacitor VDD1                         8           10                  mF      6.3 V, Ceramic, ESR < 0.1 W
     C11       Load capacitor VDD2                         8           10                  mF      Ceramic, ESR < 0.1 W                  11
     R1        Shunt resistor for transmitting           19.8          22       24.2       W       1W                                     9
     R2        DC1 sensing resistor                      0.47          1         10        W       1/16 W
     R3        DC2 sensing resistor                      0.47          1         10        W       1/16 W
     R4        Voltage divider to specify VDD2                         10                 kW       1/16 W, see p17 for calculat-
                                                                                                   ing the exact value
     R5                                                                27       100       kW
   L1, L2      DC1/DC2 inductor                                       220                 mH
     D1        Reverse polarity protection diode                     SS16                                                                12
     D2        Voltage suppressor                                1SMA40CA
     X1        Crystal oscillator                                  FA−238                                                                13
     S1        Push Button
9. Component must be between minimum and maximum value to fulfill the KNX requirement.
10. Actual capacitor value depends on X1. If an crystal oscillator is chosen, the capacitors need to be chosen in such a way that the frequency
    equals 16 MHz. Capacitors are not required if external clock signal is supplied.
11. Voltage of capacitor depends on VDD2 value defined by R4 and R5. See p16 for more details on defining VDD2 voltage value.
12. Reverse polarity diode is mandatory to fulfill the KNX requirement.
13. A clock signal of 16 MHz (50 ppm or less) is mandatory to fulfill the KNX requirements. Or a crystal oscillator of 16 MHz, 50 ppm is used
    (C8 and C9 need to be of the correct value based on the crystal datasheet), or an external 16 MHz clock is used.
14. It’s allowed to short this pin to VFILT−pin.
15. High capacitor value might affect the start up time.
                                                              www.onsemi.com
                                                                         15


                                                                 NCN5120
                                         ANALOG FUNCTIONAL DESCRIPTION
   Because NCN5120 follows the KNX standard only a brief                         The active pulse is produced by the transmitter and is
description of the KNX related blocks is given in this                         ideally rectangular. It has a duration of 35 ms and a depth
datasheet. Detailed information on the KNX Bus can be                          between 6 and 9 V (Vact). Each active pulse is followed by
found on the KNX website (www.knx.org) and in the KNX                          an equalization pulse with a duration of 69 ms. The latter is
standards.                                                                     an abrupt jump of the bus voltage above the DC level
                                                                               followed by an exponential decay down to the DC level. The
KNX Bus Interfacing                                                            equalization pulse is characterized by its height Veq and the
   Each bit period is 104 ms. Logic 1 is simply the DC level                   voltage Vend reached at the end of the equalization pulse.
of the bus voltage which is between 20 V and 33 V. Logic 0                       See the KNX Twisted Pair Standard (KNX TP1−256) for
is encoded as a drop in the bus voltage with respect to the DC                 more detailed KNX information.
level. Logic 0 is known as the active pulse.
                       VBUS
                         Veq                                                    V end
                  DC Level
                         Vact
                                       Active Pulse      Equalization Pulse                                                    t
                                          35 ms                69ms
                                                      104 ms                                        104 ms
                             1
                             0
                                     Figure 16. KNX Bus Voltage versus Digital Value
KNX Bus Transmitter                                                            current steps are absorbed by the filter capacitor. Long−term
  The purpose of the transmitter is to produce an active                       stability requires that the average bus coupler input current
pulse (see Figure 16) between 6 V and 9 V regardless of the                    is equal to the average (bus coupler) load current.
bus impedance (Note 1). In order to do this the transmitter                       There are 4 conditions that determine the dimensioning of
will sink as much current as necessary until the bus voltage                   the VFILT capacitor. First, the capacitor value should be
drops by the desired amount.                                                   between 12.5 mF and 4000 mF to garantuee proper operation
                                                                               of the part.
KNX Bus Receiver
                                                                                  The next requirement on the VFILT capacitor is
  The receiver detects the beginning and the end of the
                                                                               determined by the startup time of the system. According to
active pulse. The detection threshold for the start of the
                                                                               the KNX specification, the total startup time must be below
active pulse is −0.45 V (typ.) below the average bus voltage.
                                                                               10 s. This time is comprised of the time to charge the VFILT
The detection threshold for the end of the active pulse is
                                                                               capacitor to 12 V (where the DCDC convertor becomes
−0.2 V (typ.) below the average bus voltage giving a
                                                                               operatonal) and the startup time of the rest of the system
hysteresis of 0.25 V (typ.).
                                                                               tstartup,system. This gives the following formula:
Bus Coupler                                                                                                                 I coupler_Ilim,startup
   The role of the bus coupler is to extract the DC voltage                             C t ǒ10 s * t startup,systemǓ
                                                                                                                                   V FILTH
from the bus and provide a stable voltage supply for the
                                                                                 The third limit on VFILT capacitor value is the required
purpose of powering the NCN5120. This stable voltage
                                                                               capacitor value to filter out current steps DIstep of the system
supplied by the bus coupler will follow the average bus
                                                                               without going into reset.
voltage. The bus coupler also makes sure that the current
                                                                                                                DI step 2
drawn from the bus changes very slowly. For this a large                                Cu
filter capacitor is used on the VFILT−pin. Abrupt load                                       ǒ2 @ (VBUS1 * Vcoupler_drop * VFILTL) @ IslopeǓ
      1. Maximum bus impedance is specified in the KNX Twisted Pair Standard
                                                         www.onsemi.com
                                                                          16


                                                                    NCN5120
   The last condition on the size of VFILT is the desired                    KNX bus power consumption stays within the KNX
warning time twarning between SAVEB and RESETB in case                       specification. The maximum allowed current for the DC−DC
the bus voltage drops away. This is determined by the current                converters and V20V regulator can be estimated as next:
consumption of the system Isystem.                                                             V BUS     ǒIBUS * I20VǓ
                                ǒtwarning ) tbusfilterǓ                                                                         w1
                                                                                                                                     (eq. 2)
      C u I system                                                                    2    ƪǒVDD1     I DD1Ǔ ) ǒV DD2   I DD2Ǔƫ
                       ǒVBUS1 * Vcoupler_drop * VFILTLǓ
                                                                                IBUS will be limited by the KNX standard and should be
   The bus coupler is implemented as a linear voltage                        lower or equal to Icoupler (see Table 4). Minimum VBUS is
regulator. For efficiency purpose, the voltage drop over the                 20 V (see KNX standard). VDD1 and VDD2 can be found back
bus coupler is kept minimal (see Table 4).                                   in Table 4. IDD1, IDD2 and I20V must be chosen in a correct
                                                                             way to be in line with the KNX specification (Note 2).
KNX Impedance Control                                                           Although DC2 can operate up to 21V, it will not be
   The impedance control circuit defines the impedance of                    possible to generate this 21V under all operating conditions.
the bus device during the active and equalization pulses. The                For relay applications this could give certain limitations. See
impedance can be divided into a static and a dynamic                         application note AND9149 for more info on draving relays.
component, the latter being a function of time. The static                      See application note AND9135 for defining the optimum
impedance defines the load for the active pulse current and                  inductor and capacitor of the DC-DC converters. When
the equalization pulse current. The dynamic impedance is                     using low series resistance output capacitors on DC2, it is
produced by a block, called an equalization pulse generator,                 advised to split the the current sense resistor as shown in
that reduces the device current consumption (i.e. increases                  Figure 12 to reduce ripple current for low load conditions.
the device impedance) as a function of time during the
equalization phase so as to return energy to the bus.                        V20V Regulator
                                                                                This is the 20 V low drop linear voltage regulator used to
Fixed and Adjustable DC−DC Converter                                         supply external devices. As it draws current from VFILT,
   The device contains two DC−DC buck converters, both                       this current is seen without any power conversion directly at
supplied from VFILT.                                                         the VBUS1 pin.
   DC1 provides a fixed voltage of 3.3 V. This voltage is used                  The V20V regulator starts up by default but can be
as an internal low voltage supply (VDDA and VDDD) but can                    disabled by a command from the host controller
also be used to power external devices (VDD1−pin). DC1 is                    (<V20VEN>, see Analog Control Register 0, p51). When
automatically enabled during the power−up procedure (see                     the V20V regulator is not used, no load capacitor needs to
Analog State Diagram, p20).                                                  be connected (see C7 of Figures 13, 14 and 15). Connect
   DC2 provides a programmable voltage by means of an                        V20V−pin with VFILT−pin in this case.
external resistor divider. It is not used as an internal voltage                V20V regulator will only be enabled when VFILT−bit is
supply making it not mandatory to use this DC−DC                             set (<VFILT>, see System Status Service, p34). The host
converter (if not needed, tie the VDD2MV pin to VDD1, see                    controller can also monitor the status of the regulator
also Figure 13).                                                             (<V20V>, see System Status Service, p34).
   DC2 can be monitored (<VDD2>, see System Status
Service, p34), and/or disabled by a command from the host                    Xtal Oscillator
controller (<DC2EN>, see Analog Control Register 0, p51).                       An analog oscillator cell generates the main clock of
DC2 will only be enabled when VFILT−bit is set (<VFILT>,                     16 MHz. This clock is directly provided to the digital block
see System Status Service, p34). The status of DC2 can be                    to generate all necessary clock domains.
monitored (<VDD2>, see System Status Service, p34).                             An input pin XSEL is foreseen to enable the use of a quartz
The voltage divider can be calculated as follows:                            crystal (see Figure 18) or an external clock generator (see
                                                                             Figure 19) to generate the main clock.
               R5     R VDD2M       V DD2 * 3.3
        R4 +                                                                    The XCLK−pin can be used to supply a clock signal of
               R 5 ) R VDD2M             3.3                  (eq. 1)        8 MHz to the host controller. The frequency of this clock
   Both DC−DC converters make use of slope control to                        signal can be doubled or switched off by a command from
improve EMC performance (see Table 5).                                       the host controller (<XCLKFREQ> and <XCLKEN>, see
   To operate DC1 and DC2 correctly, the voltage on the                      Analog Control Register 0, p51).
VIN−pin should be higher than the highest value of DC1 and                      After power−up, a 4 MHz (Note 3) clock signal will be
DC2.                                                                         present on the XCLK−pin during Stand−By. When Normal
   Although both DC−DC converters are capable of                             State is entered, a 8 or 16 MHz clock signal will be present
delivering 100 mA, the maximum current capability will not                   on the XCLK−pin. See also Figure 21.
always be usable. One always needs to make sure that the
      2. The formula is for a typical KNX application. It‘s only given as guidance and does not guarantee compliance with the KNX standard.
      3. The 4 MHz clock signal is internally generated and will be less accurate as the crystal generated clock signal of 8 or 16 MHz.
                                                               www.onsemi.com
                                                                        17


                                                            NCN5120
   When Normal State is left and Stand−By State is entered               When using the FANIN/WAKE−pin, timings must be
due to an issue different than an Xtal issue, the 8 or 16 MHz         respected (see Table 5 and Figure 8).
clock signal will still be present on the XCLK−pin during the
Stand−By State. If however Stand−By is entered from                   RESETB− and SAVEB−pin
Normal State due to an Xtal issue, the 4 MHz clock signal                The RESETB signal can be used to keep the host
will be present on the XCLK−pin. See also Table 7.                    controller in a reset state. When RESETB is low this
                                                                      indicates that the bus voltage is too low for normal operation
FANIN/WAKE−pin                                                        and that the fixed DC−DC converter has not started up. It
   The FANIN/WAKE−pin has a double purpose. First of all              could also indicate a Thermal Shutdown (TSD). The
it defines the maximum allowed bus current and bus current            RESETB signal also indicates if communication between
slopes. If the FANIN/WAKE−pin is kept floating or pulled              host and NCN5120 is possible.
high, NCN5120 will limit the KNX bus current slopes to                   The SAVEB signal indicates correct operation. When
0.5 mA/ms at all times. NCN5120 will also limit the KNX               SAVEB goes low, this indicates a possible issue (loss of bus
bus current to 30mA during start−up. During normal                    power or too high temperature) which could trigger the host
operation, NCN5120 is capable of taking up to 13 mA (=                controller to save critical data or go to a save state. SAVEB
Icoupler) from the KNX bus for supplying external loads               goes low immediately when VFILT goes below 14 V (due
(DC1, DC2 and V20V). Because NCN5120 will not limit the               to sudden large current usage) or after 2 ms when VBUS
KNX bus current to 13 mA during normal operation, it’s up             goes below 20 V. RESETB goes low when VFILT goes
to the user to make sure that the Icoupler bus current does not       below 12 V.
go above 13 mA (for FANIN/WAKE−pin floating or high).                    RESETB− and SAVEB−pin are open−drain pins with an
   If the FANIN/WAKE−pin is pulled to ground the                      internal pull−up resistor to VDDD.
operation is similar as above with the exception that the
KNX bus current slopes will be limited to 1 mA/ms at all              Voltage Supervisors
times, the KNX bus current will be limited to 60 mA during               NCN5120 has different voltage supervisors monitoring
start−up and the up to 26 mA (Icoupler) can be taken from             VBUS, VFILT, VDD2 and V20V. The general function of a
the KNX bus during normal operation. Definitions for                  voltage supervisor is to detect when a voltage is above or
Start−Up and Normal Operation (as given above) can be                 below a certain level. The levels for the different voltages
found in the KNX Specification.                                       monitored can be found back in Table 4 (see also Figures 4,
   The FANIN/WAKE−pin can also be used to exit from                   5, 6 and 7).
Sleep Mode (see p19). When in Sleep Mode, a low level on                 The status of the voltage supervisors can be monitored by
the FANIN/WAKE−pin initiates the power−up procedure of                the host controller (see System Status Service, p34).
the device. Because FANIN/WAKE−pin has an internal                       Depending on the voltage supervisor outputs, the device
pull−up a simple push button can be used to exit Sleep Mode           can enter different states (see Analog State Diagram, p20).
(see also Figure 14). This functionality is not available when
the FANIN/Wake−pin is pulled to ground.
                                              VIN
                                                        From VFILT
                                          P1           L1         1Ω
                            Switch            VSW1
                                                                                   VDD1 = 3.3V
                          Controller
                                         N1                                     10μF
                                              VSS1
                                              VDD1M
                                              VDD1
                          COMP
                                          P2          L2        0.47Ω       0.47Ω
                           Switch             VSW2
                                                                                             VDD2 = 3.3V – 20V
                          Controller
                                          N2                                            10μ F
                                              VSS2                          R4
                                              VDD2MV
                                               VDD2MC
                                               VDD2
                          COMP
                                                                            R5
                                     NCN5120
                              Figure 17. Fixed (VDD1) and Adjustable (VDD2) DC−DC Converter
                                                        www.onsemi.com
                                                                  18


                                                                 NCN5120
                                                                                    3.3V
             16MHz
                       XTAL2
                                                                                   VCC
                                                                                                      XTAL2
                       XTAL1
                                    Osc                                             CLKOUT
                                                                                                                    Osc
                                                                                   Micro−             XTAL1
                        XCLK                                                      controller
              8 MHz
            or 16 MHz                                                                        8MHz or   XCLK
                                             Rdown                                            16MHz
                        XSEL
                                                                                    GND                XSEL                  R down
                                                                                                3.3V
                              NCN5120
                                                                                                            NCN5120
                       Figure 18. XTAL Oscillator                                   Figure 19. External Clock Generator
  Table 7. STATUS OF SEVERAL BLOCKS DURING THE DIFFERENT (ANALOG) STATES
                         State                            Osc          XCLK           VDD1          VDD2/V20V        SPI/UART          KNX
                         Reset                            Off            Off            Off             Off           Inactive       Inactive
                       Start−Up                           Off            Off        Start−up            Off           Inactive       Inactive
                  Stand−By (Note 16)                      Off          4 MHz            On           Start−Up           Active       Inactive
                                                                                                                                    (Note 21)
                  Stand−By (Note 17)                      On             On             On         On (Note 20)         Active       Inactive
                                                       (Note 19)     (Note 19)                                                      (Note 21)
                        Normal                            On             On             On              On              Active        Active
                                                                     (Note 18)
                         Sleep                            Off            Off            Off             Off           Inactive       Inactive
16. Only valid when entering Stand−By from Start−Up State.
17. Only valid when entering Stand−By from Normal State.
18. 8 MHz
19. 4 MHz signal if Stand−By state was entered due to oscillator issue. Otherwise 8 MHz clock signal.
20. Only operational if Stand−By state was not entered due to VDD2 or V20V issue.
21. Under certain conditions KNX bus is (partly) active. See Digital State Diagram for more details.
Temperature Monitor                                                         entered. SAVEB will go high and KNX communication is
   The device produces an over−temperature warning (TW)                     again possible.
and a thermal shutdown warning (TSD). Whenever the                            The TW−bit will be reset at the moment the junction
junction temperature rises above the Thermal Warning level                  temperature drops below TTW. The TSD−bit will only be
(TTW), the SAVEB−pin will go low to signal the issue to the                 reset when the junction temperature is below TTSD and the
host controller. Because the SAVEB−pin will not only go                     <TSD> bit is read (see Analog Status Register, p52).
low on a Thermal Warning (TW), the host controller needs                      Figure 9 gives a better view on the temperature monitor.
to verify the issue by requesting the status (<TW>, see
System Status Service, p34). When the junction temperature                  Sleep Mode
is above TW, the host controller should undertake actions to                  Sleep Mode can be entered by setting the SLP−bit
reduce the junction temperature and/or store critical data.                 (<SLP>, see Analog Control Register 1, p52). Leaving
   When the junction temperature reaches Thermal                            Sleep Mode can only be done by means of a (wake) pulse on
Shutdown (TTSD), the device will go to the Reset State. The                 the FANIN/WAKE−pin (or a POR). An exit from Sleep
Thermal Shutdown will be stored (<TSD>, see Analog                          Mode can be verified by the host controller (<SLP>, see
Status Register, p52) and the analog and digital power                      Analog Status Register, p52).
supply will be stopped (to protect the device). The device                    It’s not possible to enter Sleep Mode when the
will stay in the Reset State as long as the temperature stays               FANIN/WAKE−pin is pulled low (see p18).
above TTSD.                                                                   See Table 7 for the status of several blocks during Sleep
   If the temperature drops below TTSD, Start−Up State will                 Mode.
be entered (see also Figure 20). At the moment VDD1 is
                                                                            Watchdog
back up and the OTP memory is read, Stand−By State will                       NCN5120 provides a Watchdog function to the host
be entered and RESETB will go high. The Xtal oscillator                     controller. The Watchdog function can be enabled by means
will be started. Once the temperature has dropped below                     of the WDEN−bit (<WDEN>, see Watchdog Register, p51).
TTW and all voltages are high enough, Normal State will be
                                                            www.onsemi.com
                                                                       19


                                                               NCN5120
Once this bit is set to ‘1’, the host controller needs to re−write    Analog State Diagram
this bit to clear the internal timer before the Watchdog                The analog state diagram of NCN5120 is given in
Timeout Interval expires (Watchdog Timeout Interval =                 Figure 20. The status of the oscillator, XCLK−pin, DC−DC
<WDT>, see Watchdog Register, p51).                                   converters, V20V regulator, serial and KNX
   In case the Watchdog is acknowledged too early (before             communication during the different (analog) states is given
tWDPR) or not within the Watchdog Timeout Interval                    in Table 7.
(tWDTO), the RESETB−pin will be made low (= reset host                  Figure 21 gives a detailed view on the start−up behavior
controller).                                                          of NCN5120. After applying the bus voltage, the filter
   Table 8 gives the Watchdog timings tWDTO and tWDPR.                capacitor starts to charge. During this Reset State, the
Details on <WDT> can be found in the Watchdog Register,               current drawn from the bus is limited to Icoupler (for details
p51.                                                                  see the KNX Standards). Once the voltage on the filter
                                                                      capacitor reaches 10 V (typ.), the fixed DC−DC converter
  Table 8. WATCHDOG TIMINGS                                           (powering VDDA) will be enabled and the device enters the
      WDT[3:0]              tWDTO [ms]            tWDPR [ms]          Start−Up State. When VDD1 gets above 2.8 V (typ.), the
        0000                     33                    2
                                                                      OTP memory is read out to trim some analog parameters
                                                                      (OTP memory is not accessible by the user). When done, the
        0001                     66                    4
                                                                      Stand−By State is entered and the RESETB−pin is made
        0010                     98                    6              high. If at this moment VBUS is above VBUSH, the VBUS−bit
        0011                    131                    8              will be set (<VBUS>, see System Status Service, p34). After
                                                                      aprox. 2 ms the Xtal oscillator will start. When VFILT is
        0100                    164                   10
                                                                      above VFILTH DC2 and V20V will be started. When the Xtal
        0101                    197                   12              oscillator has started, no Thermal Warning (TW) or Thermal
        0110                    229                   14              Shutdown (TSD) was detected and the VBUS−, VFILT−,
        0111                    262                   16              VDD2− and V20V−bits are set, the Normal State will be
                                                                      entered and SAVEB−pin will go high.
        1000                    295                   18
                                                                        Figure 22 gives a detailed view on the shut−down
        1001                    328                   20              behavior. If the KNX bus voltage drops below VBUSL for
        1010                    360                   23              more than tbus_filter, the VBUS−bit will be reset (<VBUS>,
                                                                      see System Status Service, p34) and the Standy−By State is
        1011                    393                   25
                                                                      entered. SAVEB will go low to signal this. When VFILT
        1100                    426                   27              drops below VFILTL, DC2 and the V20V regulator will be
        1101                    459                   29              switched off. When VFILT drops below 6.5 V (typ), DC1
        1110                    492                   30              will be switched off and VDD1 drops below 2.8 V (typ.) the
                                                                      device goes to Reset State (RESETB low).
         1111                   524                   31
                                                            www.onsemi.com
                                                                   20


                                                                                NCN5120
                                                                              Reset
                                                                              RESETB = ‘0’
                                                                               SAVEB = ‘0’
                                                          V FILT > 10 V
                                                                   and
                                                        Temp < TSD
                                                              Enable DC 1                  Disable DC 1
VFILT < 6.5 V
                                                                                               V FILT < 6.5 V
                                                                           Start−Up
                                                                              RESETB = ‘0’
                                                                               SAVEB = ‘0’
                                                                                                                                              Disable DC1, DC2 and V20V
                                                                     VDDA OK
                           Enable DC 1                                    and
                                                            OTP read done
                                                                          and
                                                               clock present
              Wake
              Pulse
                                       Enable DC2 and V20V                                             Disable DC2 and V20V
                                                                                                                 V FILT < V FILTL
                                         VFILT > VFILTH
      Sleep                                                                Stand−By
      RESETB = ‘0’                                                            RESETB = ‘1’                                        <TSD> = ‘1’
       SAVEB = ‘0’                                                             SAVEB = ‘0’                                        or
                                          VFILT < 6.5 V
                                                                                                                                  VDDA nOK
                                                 Disable DC1
                                                                                                                                                <TSD> = ‘1’
                                      <TW> = ‘0’ and <TSD> = ‘0’ and
                                                                                              <TW> = ‘1’ or <XTAL> = ‘0’ or                     or
                                   <XTAL> = ‘1’ and <VBUS> = ‘1’ and
                                                                                              <VBUS> = ‘0’ or <VFILT> = ‘0’                     V DDA nOK
                                                           <VFILT> = ‘1’
       Disable DC1, DC2 and V20V
                                       Sleep Command and
                                          WAKE−pin = ‘1’
                                                                            Normal
                                                                              RESETB = ‘1’
                                                                               SAVEB = ‘1’
Remarks:
 − <TW>, <TSD>, <XTAL, <VBUS> and <VFILT> are internal status bits which can be verified with the
   System State Service (with exception of <TSD> for which Internal Register Read should be used).
 − Although Reset State could be entered from Normal State on a TSD, Stand−By State will be
   entered first due to a TW.
 − Enabling of DC2 and V20V will depend on the <DC2EN> and <V20VEN> bits in Analog Control Register 0.
                                                         Figure 20. Analog State Diagram
                                                                        www.onsemi.com
                                                                                        21


                                                                   NCN5120
           VBUS
           VFILT
            VBUSH
            VFILTH
              10V
            IBUS                                                                 Maximum 30 mA (FANIN/WAKE−pin = high) or 60mA (FANIN/WAKE−pin = low)
         Icoupler_lim                                                                         Should be limited to 13 mA (FANIN/Wake−pin = high)
                                                                                                      or 26 mA (FANIN/WAKe−pin = low)
                                               Slope maximum 0.5mA/ms (FANIN/WAKE−pin = high)
                                               or 1mA/ms (FANIN/WAKE−pin = low)
           VDD1
             2.8V
          VXTAL
Xtal Oscillator
                                                                                        ±3ms
     <VBUS>
     <VFILT>
           VDD2
      0.9 x V DD2
     <VDD2>
            V20V
            V20VH
     <V20V>
    RESETB
      SAVEB
        XCLK
                                         Reset                            Start-Up          Stand-By                   Normal                t
        Remarks:
        VDD1 directly connected to VDDA.
                                                      Figure 21. Start−Up Behavior
                                                              www.onsemi.com
                                                                        22


                                                                  NCN5120
           VBUS
           VFILT
           VBUSH
           VBUSL
           VFILTL
            6.5V
            IBUS
           VDD1
            2.8V
         VXTAL
Xtal Oscillator
                                                     tbus_filter              tbus_filter
     <VBUS>
     <VFILT>
           VDD2
      0.9 x VDD2
     <VDD2>
           V20V
     <V20V>
    RESETB
      SAVEB
        XCLK
                                                                                                         t
        Remarks:
                                         Normal                  Stand-By Normal          Stand-By Reset
        VDD1 directly connected to VDDA.
                                                Figure 22. Shut−Down Behavior
                                                         www.onsemi.com
                                                                       23


                                                                    NCN5120
Interface Mode                                                                  selection of the interface is done by the pins MODE1,
   The device can communicate with the host controller by                       MODE2, TREQ, SCK/UC2 and CSB/UC1.
means of a UART interface or an SPI interface. The
  Table 9. INTERFACE SELECTION
    TREQ        MODE2         MODE1           SCK/UC2          CSB/UC1           SDI/RXD         SDO/TXD                     Description
      0             0              0               0                 0                                            9−bit UART−Mode, 19200 bps
      0             0              0               0                 1                                            9−bit UART−Mode, 38400 bps
                                                                                    RXD              TXD
      0             0              0               1                 0                                            8−bit UART−Mode, 19200 bps
      0             0              0               1                 1                                            8−bit UART−Mode, 38400 bps
      1             0              0               X                 X             Driver         Receiver        Analog Mode
    TREQ            0              1                                                                              SPI Master, 125 kbps
                                              SCK (out)        CSB (out)             SDI             SDO
    TREQ            1              0                                                                              SPI Master, 500 kbps
NOTE:    X = Don‘t Care
UART Interface                                                                  where the parity bit is meaningless and should be ignored).
   The UART interface is selected by pulling pins TREQ,                         In 8−bit mode one extra service is available
MODE1 and MODE2 to ground. Pin UC2 is used to select                            (U_FrameState.ind). The SDI/RXD−pin is the NCN5120
the UART Mode (‘0’ = 9−bit, ‘1’ = 8−bit) and pin UC1 is                         UART receive pin and is used to send data from the host
used to select the baudrate (‘0’ = 19200 bps, ‘1’ =                             controller to the device. Pin SDO/TXD is the NCN5120
38400 bps). The UART interface allows full duplex,                              UART transmit pin and is used to transmit data between the
asynchronous communication.                                                     device and the host controller. Figure 13 gives an UART
   The difference between 8−bit mode and 9−bit mode is that                     application example (9−bit, 19200 bps). Data is transmitted
in 9−bit an additional even parity bit is transmitted (with                     LSB first.
exception of the internal register read and write services
                       Start                                                                                              Stop
                                   Bit 0     Bit 1       Bit 2      Bit 3      Bit 4     Bit 5       Bit 6     Bit 7
                       (= 0)                                                                                              (= 1)
                                                        Figure 23. 8−bit UART Mode
                 Start                                                                                                          Stop
                             Bit 0     Bit 1      Bit 2       Bit 3     Bit 4      Bit 5       Bit 6     Bit 7     Parity
                 (= 0)                                                                                                          (= 1)
                                                        Figure 24. 9−bit UART Mode
   One special UART Mode is foreseen called Analog Mode.                        the SDI/RXD− and SDO/TXD−pin are inverted. Figure 15
When this mode is selected (TREQ = ‘1’, MODEx = ‘0’) an                         gives an Analog Mode application example. When using the
immediate connection is made with the KNX transmitter                           device in Analog Mode, no clock needs to be provided to the
receiver (see Figure 25). Bit level coding/decoding has to be                   device.
done by the host controller. Keep in mind that the signals on
                                             CEQ1 CEQ2 VFILT           VDDA VSSA VDDD VSSD
                                   CAV        Bus Coupler                                                   SCK/UC2
                                               Impedance                                                    SDI/RXD
                                 VBUS1
                                                 Control
                                                                                                            SDO/TXD
                                               Receiver                                                     CSB/UC1
                                   CCP                                                                      TREQ (TREQ = 1)
                                                                          NCN5120                           MODE1
                                   TXO        Transmitter                                                   MODE2
                                 VBUS2
                                         VAUX
                                                                                                           VIN
                                                                                                           VSW1
                           FANIN/WAKE         Wake−Up                                DC/DC                 VDD1M
                                                                                   Converter 1             VDD1
                                                Fan−In                                                     VSS1
                                                Control
                                  V20V         20V LDO            POR        RC
                                                                            Osc
                                                                                                           VSW2
                                 XTAL1                    OSC
                                               OSC                   TW/             DC/DC                 VDD2MC
                                 XTAL2                               TSD    UVD    Converter 2             VDD2MV
                                  XSEL                                                                     VDD2
                                                                   Diagnostics                             VSS2
                                  XCLK
                                                      TESTOUT     SAVEB RESETB
                                                      Figure 25. Analog UART Mode
                                                               www.onsemi.com
                                                                          24


                                                                     NCN5120
SPI Interface                                                                    The SPI interface allows full duplex synchronous
  The SPI interface is selected by MODE1− and                                  communication between the device and the host controller.
MODE2−pin. The baudrate is determined by which                                 The interface operates in Mode 0 (CPOL and CPHA = ‘0’)
MODE−pin is pulled high (MODE1 pulled high = 125 kbps,                         meaning that the data is clocked out on the falling edge and
MODE2 pulled high = 500 kbps).                                                 sampled on the rising edge. The LSB is transmitted first.
                                   0              1           2        3          4        5           6         7
                 CSB
                                                                                                                   ÉÉ
                 SCK
                                                                                                                   ÉÉ
                                                                                                                   ÉÉ
                  SDI          LSB                1           2        3          4        5           6       MSB
                 SDO           LSB                1           2        3          4        5           6       MSB
                                                                                                                   ÉÉ
                                                             Figure 26. SPI Transfer
  During SPI transmission, data is transmitted (shifted out                    and SDO−pin. The speed of this clock signal is selectable
serially) on the SDO/TXD−pin and received (shifted in                          (see Table 9). The slave select line (CSB/UC1−pin) will go
serially) on the SDI/RXD−pin simultaneously. SCK/UC2 is                        low during each transmission allowing to selection the host
set as output and is used as the serial clock (SCK) to                         controller (CSB−pin is high when SPI is in idle state).
synchronize shifting and sampling of the data on the SDI−
                                                             SDO/TXD                 MOSI
                                                             SDI/RXD                 MISO       Shift Register
                                      Shift Register
                                                             SCK/UC2                 SCLK
                                              Control        CSB/UC1                   SS     Control
                                                NCN5120                                   Host Controller
                                                              Figure 27. SPI Master
  In an SPI network only one SPI Master is allowed (in this                    edge on TREQ, the device will issue dummy transmission
case NCN5120). To allow the host controller to                                 of 8 bits which will result in a transmission of data byte from
communicate with the device the TREQ−pin can be used                           the host controller to the device. See Figure 12 for details on
(Transmit Request). When NCN5120 detects a negative                            the timings. See Figure 14 for an SPI application example.
                    CSB
                    SCK
                     SDI                 0       1     2   3      4  5   6   7                        0     1  2   3  4
                           Dummy
                    SDO                  D       D     D   D     D   D   D   D                        D     D  D   D  D
                              Start dummy transmission
                   TREQ
                                                       Figure 28. Transmission Request
                                                                  www.onsemi.com
                                                                          25


                                                                   NCN5120
                                             DIGITAL FUNCTIONAL DESCRIPTION
   The implementation of the Data Link Layer as specified in the KNX standard is divided in two parts. All functions related
to communication with the Physical Layer and most of the Data Link Layer services are inside NCN5120, the rest of the
functions and the upper communication layers are implemented into the host controller (see Figure 29).
The host controller is responsible for handling:
• Checksum
• Parity
• Addressing
• Length
The NCN5120 is responsible for handling:
• Checksum
•  Parity
•  Acknowledge
•  Repetition
•  Timing
Digital State Diagram
   The digital state diagram is given in Figure 30.
   The current mode of operation can be retrieved by the host controller at any time (when RESETB−pin is high) by issuing
the U_SystemStat.req service and parsing back U_SystemStat.ind service (see System Status Service, p34).
  Table 10. NCN5120 DIGITAL STATES
         State                                                               Explanation
        RESET            Entered after Power On Reset (POR) or in response to a U_Reset.req service issued by the host controller. In
                         this state NCN5120 gets initialized, all features disabled and services are ignored and not executed.
    POWER−UP /           Entered after Reset State or when VBUS, VFILT or Xtal are not operating correctly (operation of VBUS, VFILT
  POWER−UP STOP          and XTAL can be verified by means of the System Status Service, p34). Communication with KNX bus is not
                         allowed.
                         U_SystemStat.ind can be used to verify this state (code 00).
        SYNC             NCN5120 remains in this state until it detects silence on the KNX bus for at least 40 Tbits. Although the receiver
                         of NCN5120 is on, no frames are transmitted to the host controller.
                         U_SystemStat.ind can be used to verify this state (code 01).
        STOP             This state is useful for setting−up NCN5120 safely or temporarily interrupting reception from the KNX bus.
                         U_SystemStat.ind can be used to verify this state (code 10).
      NORMAL             In this state the device is fully functional. Communication with the KNX bus is allowed.
                         U_SystemStat.ind can be used to verify this state (code 11).
                                                              www.onsemi.com
                                                                        26


                                                                  NCN5120
                                         7                  Application Layer
                                         6                Presentation Layer
                                                                                                     Host Controller
                                         5                     Session Layer
                                         4                   Transport Layer
                                         3                     Network Layer
                                                                Logic Link Control
                                         2                   Data Link Layer
                                                                                                     NCN5120
                                                             Media Access Control
                                         1                     Physical Layer
                                     Figure 29. OSI Model Reference
             POR or U_Reset.req                  Reset
                                               Initialize device
                                             Deactivate all features
                                                                                                                       Send U_StopMode.ind
                                                                                                                             to host
                                                                              U_StopMode .req
                                         Power−Up                                       U_ExitStopMode .req            Power−Up Stop
                                                  Code: 00                                                                   Code: 00
                                                KNX Rx = off                                                               KNX Rx = off
                                                KNX Tx = off                                                               KNX Tx = off
                            < XTAL > = ‘1’                             <XTAL> = ‘0’                 <XTAL > = ‘1’                         <XTAL> = ‘0’
                                     and                               or                                    and                          or
                            <VBUS> = ‘1’                               <VBUS> = ‘0’                 <VBUS> = ‘1’                          <VBUS> = ‘0’
                                     and                               or                                    and                          or
                            <VFILT > = ‘1’                             <VFILT > = ‘0’               <VFILT > = ‘1’                        <VFILT> = ‘0’
<XTAL> = ‘0’
            or                                    Sync                                  U_ExitStopMode.req                  Stop
<VBUS> = ‘0’                                      Code: 01                                                                   Code: 10
            or                                  KNX Rx = on                                                                KNX Rx = off
                                                KNX Tx = off                                                               KNX Tx = off
<VFILT > = ‘0’
                      KNX bus idle for w40 Tbits                                              U_StopMode.req
                                         Send U _Reset .ind                                                            Send U_StopMode.ind
                                              to host                                                                        to host
                                                                                          U_StopMode.req and
                                               Normal                                    no activity for w30 Tbits
                                                  Code: 11
                                                KNX Rx = on
                                                KNX Tx = on
                                     Figure 30. Digital State Diagram
                                                        www.onsemi.com
                                                                            27


                                                                  NCN5120
Services
  Execution of services depends on the digital state (Figure 30). Certain services are rejected if received outside the Normal
State. The following table gives a view of all services and there acceptance during the different digital states.
 Table 11. ACCEPTANCE OF SERVICES
                                                                                          State
                Service                         Normal                 Stop               Sync             Power−Up          Bus Monitor
  U_Reset.req                                       E                    E                  E                    E                 E
  U_State.req                                       E                    E                  E                    E                  I
  U_SetBusy.req                                     E                    E                  E                    E                  I
  U_QuitBusy.req                                    E                    E                  E                    E                  I
  U_Busmon.req                                      E                    E                  E                    E                  I
  U_SetAddress.req                                  E                    E                  E                    E                  I
  U_SetRepetition.req                               E                    E                  E                    E                  I
  U_L_DataOffset.req                                E                    E                  E                    E                  I
  U_SystemStat.req                                  E                    E                  E                    E                  I
  U_StopMode.req                                    E                     I                 E                    E                 E
  U_ExitStopMode.req                                I                    E                   I                    I                E
  U_Ackn.req                                        E                    R                  R                    R                  I
  U_Configure.req                                   E                    E                  E                    E                  I
  U_IntRegWr.req                                    E                    E                  E                    E                 E
  U_IntRegRd.req                                    E                    E                  E                    E                 E
  U_L_DataStart.req                                 E                    R                  R                    R                  I
  U_L_DataCont.req                                  E                    R                  R                    R                  I
  U_L_DataEnd.req                                   E                    R                  R                    R                  I
  U_PollingState.req                                E                    E                  E                    E                  I
NOTE:
            Bus Monitor state is not a separate state. It is applied on top of Normal, Stop, Sync or Power−Up State.
            Legend: E = service is executed
                      I = service is ignored (not executed and no feedback sent to the host controller)
                      R = service is rejected (not executed, protocol error is sent back to the host controller through U_State.ind)
            See Internal Register Read Service (p36) for limitations of U_IntRegRd.req
                                                             www.onsemi.com
                                                                      28


                                                        NCN5120
 Table 12. SERVICES FROM HOST CONTROLLER
              Control Field
                                                                                               Extra Following    Total
 7    6    5     4    3     2 1    0       Service Name         Hex           Remark                 Bytes        Bytes
 INTERNAL COMMANDS – DEVICE SPECIFIC
 0    0    0     0    0     0 0    1    U_Reset.req              01                                                 1
 0    0    0     0    0     0 1    0    U_State.req              02                                                 1
 0    0    0     0    0     0 1    1    U_SetBusy.req            03                                                 1
 0    0    0     0    0     1 0    0    U_QuitBusy.req           04                                                 1
 0    0    0     0    0     1 0    1    U_Busmon.req             05                                                 1
 1    1    1     1    0     0 0    1    U_SetAddress.req         F1                         AddrHigh                4
                                                                                            AddrLow
                                                                                            X (don’t care)
 1    1    1     1    0     0 1    0    U_SetRepetition.req      F2                         RepCntrs                4
                                                                                            X (don’t care)
                                                                                            X (don’t care)
 0    0    0     0    1     i i    i    U_L_DataOffset.req     08−0C    iii = MSB byte                              1
                                                                        index (0…4)
 0    0    0     0    1     1 0    1    U_SystemState.req        0D                                                 1
 0    0    0     0    1     1 1    0    U_StopMode.req           0E                                                 1
 0    0    0     0    1     1 1    1    U_ExitStopMode.req       0F                                                 1
 0    0    0     1    0     n b    a    U_Ackn.req             10−17    n = nack                                    1
                                                                        b = busy
                                                                        a = addressed
 0    0    0     1    1     p c    m    U_Configure.req        18−1F    p = auto−polling                            1
                                                                        c = CRC−CCITT
                                                                        m = frame end
                                                                        with MARKER
 0    0    1     0    1     0 a    a    U_IntRegWr.req         28−2B    aa = address of     Data to be written      2
                                                                        internal register
 0    0    1     1    1     0 a    a    U_IntRegRd.req         38−3B                                                1
 1    1    1     0    s     s s    s    U_PollingState.req     E0−EE    s = slot number     PollAddrHigh            4
                                                                        (0 … 14)            PollAddrLow
                                                                                            PollState
 KNX TRANSMIT DATA COMMANDS
 1    0    0     0    0     0 0    0    U_L_DataStart.req        80                         Control Octet (CTRL)    2
 1    0     i    i     i    i i    i    U_L_DataCont.req       81−BF    i = index (1…63)    Data octet (CTRLE,      2
                                                                                            SA, DA, AT, NPCI, LG,
                                                                                            TPDU)
 0    1     l    l     l    l l    l    U_L_DataEnd.req        47−7F    l = last index + 1  Check Octet (FCS)       2
                                                                        (7 … 63)
With respect to command length, there are two types of services from the host controller:
• Single−byte commands: the control byte is the only data sent from the host controller to NCN5120.
• Multiple−byte commands: the following data byte(s) need to be handled according to the already received control byte.
With respect to command purpose there are two types of services from the host controller:
• Internal command: does not initiate any communication on the KNX bus.
• KNX transmit data command: initiates KNX communication
                                                    www.onsemi.com
                                                            29


                                                                              NCN5120
 Table 13. SERVICES TO HOST CONTROLLER
                  Control Field                                                                                                              Extra
                                                                                                                                           Following     Total
  7     6     5     4      3        2         1         0           Service Name                                  Remark                     Bytes       Bytes
 DLL (LAYER 2) SERVICES (DEVICE IS TRANSPARENT)
  1     0     r     1     p1        p0        0         0       L_Data_Standard.ind               r = not repeated (‘1’) or                               n
                                                                                                  repeated L_Data frame (‘0’)
  0     0     r     1     p1        p0        0         0       L_Data_Extended.ind               p1, p0 = priority                                       n
  1     1     1     1      0        0         0         0       L_Poll_Data.ind                                                                           n
 ACKNOWLEDGE SERVICES (DEVICE IS TRANSPARENT IN BUS MONITOR MODE)
  x     x     0     0      x        x         0         0       L_Ackn.ind                        x = acknowledge frame                                   1
  z     0     0     0      1        0         1         1       L_Data.con                        z = positive (‘1’) or negative                          1
                                                                                                  (‘0’) confirmation
 CONTROL SERVICES – DEVICE SPECIFIC
  0     0     0     0      0        0         1         1       U_Reset..ind                                                                              1
 sc    re    te     pe    tw        1         1         1       U_State.ind                       sc = slave collision                                    1
                                                                                                  re = receive error
                                                                                                  te = transmit error
                                                                                                  pe = protocol error
                                                                                                  tw = temperature warning
 re    ce    te     1     res       0         1         1       U_FrameState.ind                  re = parity or bit error                                1
                                                                                                  ce = checksum or length
                                                                                                  error
                                                                                                  te = timing error
                                                                                                  res = reserved
  0     b    aa     ap     c        m         0         1       U_Configure.ind                   b = reserved                                            1
                                                                                                  aa = auto−acknowledge
                                                                                                  ap = auto−polling
                                                                                                  c = CRC−CCITT
                                                                                                  m = frame end with
                                                                                                  MARKER
  1     1     0     0      1        0         1         1       U_FrameEnd.ind                                                                            1
  0     0     1     0      1        0         1         1       U_StopMode.ind                                                                            1
  0     1     0     0      1        0         1         1       U_SystemStat.ind                                                          V20V, VDD2,     2
                                                                                                                                          VBUS, VFILT,
                                                                                                                                           XTAL, TW,
                                                                                                                                             Mode
   Each data byte received from the KNX bus is transparently transmitted to the host controller. An exception is the
Acknowledge byte which is transmitted to the host controller only in bus monitoring mode. Other useful information can be
transmitted to the host controller by request using internal control services.
   A detailed description of the services is given on the next pages. For all figures, the MSB bit is always given on the left side
no matter how the arrow is drawn.
                                  Host Ctrl                                       NCN5120                                       KNX Bus
                                              MSB   6   5   4   3   2   1   LSB
                                                                                            MSB   6   5   4   3   2   1   LSB
                                                                                            MSB   6   5   4   3   2   1   LSB
                                              MSB
                                                    6   5   4   3   2   1   LSB
                                                            Figure 31. Bit Order of Services
                                                                        www.onsemi.com
                                                                                    30


                                                                 NCN5120
Reset Service
Reset the device to the initial state.
                               Host Ctrl                          NCN5120                  KNX Bus
                                               U_Reset.req
                                         0   0   0 0    0   0 0 1
                                               U_Reset.ind
                                         0   0   0 0    0   0 1 1
                                                         Figure 32. Reset Service
Remark: U_Reset.Ind will be send when entering Normal State (see Digital State Diagram, p26).
State Service
Get internal communication state of the device.
                               Host Ctrl                          NCN5120                  KNX Bus
                                               U_State.req
                                         0   0   0 0    0   0 1 0
                                               U_State.ind
                                         sc re  te pe  tw   1 1 1
                                                          Figure 33. State Service
sc (slave collision):    ‘1’ if collision is detected during transmission of polling state
re (receive error):      ‘1’ if corrupted bytes were sent by the host controller. Corruption involves incorrect parity (9−bit
                         UART only) and stop bit of every byte as well as incorrect control octet, length or checksum of frame
                         for transmission.
te (transceiver error): ‘1’ if error detected during frame transmission (sending ‘0’ but receiving ‘1’).
pe (protocol error):     ‘1’ if an incorrect sequence of commands sent by the host controller is detected.
tw (thermal warning): ‘1’ if thermal warning condition is detected.
Set Busy Service
Activate BUSY mode.
   During this time and when autoacknowledge is active (see Set Address Service p32), NCN5120 rejects the frames whose
destination address corresponds to the stored physical address by sending the BUSY acknowledge. This service has no effect
if autoacknowledge is not active.
                               Host Ctrl                          NCN5120                  KNX Bus
                                              U_SetBusy.req
                                         0   0   0 0    0   0 1 1
                                                      Figure 34. Set Busy Service
Remark: BUSY mode is deactivated immediately if the host controller confirms a frame by sending U_Ackn.req service.
Quit Busy Service
Deactivate the BUSY mode.
   Restores back to the normal autoacknowledge behavior with ACK sent on the bus in response to addressing frame (only if
autoacknowledge is active). This service has no effect if autoacknowledge is not active or BUSY mode was not set.
                               Host Ctrl                          NCN5120                  KNX Bus
                                             U_QuitBusy.req
                                         0   0   0 0    0   1 0 0
                                                     Figure 35. Quit Busy Service
                                                              www.onsemi.com
                                                                     31


                                                              NCN5120
Bus Monitor Service
Activate bus monitoring state.
  In this mode all data received from the KNX bus is sent to the host controller without performing any filtering on Data Link
Layer. Acknowledge Frames are also transmitted transparently. This state can only be exited by the Reset Service (see p31).
                              Host Ctrl                        NCN5120                     KNX Bus
                                             U_Busmon.req
                                        0  0   0  0  0  1 0  1
                                                                           KNX Message
                                                                       x x  x  x x  x  x x
                                             KNX Message
                                        x  x   x   x x  x  x x
                                                                           KNX Message
                                                                       x x  x  x x  x  x x
                                             KNX Message
                                        x  x   x   x x  x  x x
                                                                           Acknowledge
                                                                       x x  0  0 x  x  0 0
                                              Acknowledge
                                        x  x   0  0  x  x 0  0
                                              U_Reset.req
                                        0  0   0  0  0  0 0  1
                                              U_Reset.ind
                                        0  0   0  0  0  0 1  1
                                                  Figure 36. Bus Monitor Service
Remark:
x = don‘t care
Set Address Service
Sets the physical address of the device and activates the auto−acknowledge function.
  NCN5120 starts accepting all frames whose destination address corresponds to the stored physical address or whose
destination address is the group address by sending IACK on the bus. In case of an error detected during such frame reception,
NCN5120 sends NACK instead of IACK.
  When issued several times after each other, the first call will set the physical address and activate the auto−acknowledge.
Following calls will only set the physical address because auto−acknowledge is already activated.
  NCN5120 confirms activation of auto−acknowledge function by sending the U_Configure.ind service to the host controller.
                              Host Ctrl                        NCN5120                     KNX Bus
                                          U_SetAddress.req
                                        1  1   1   1 0  0  0 1
                                          Address High Byte
                                        x  x   x   x x  x  x x
                                          Address Low Byte
                                        x  x   x   x x  x  x x
                                                 Dummy
                                        x  x   x   x x  x  x x
                                           U_Configure.ind
                                        0  b   aa ap c m   0 1
                                                  Figure 37. Set Address Service
                                                          www.onsemi.com
                                                                 32


                                                               NCN5120
b (busy mode):            ‘1’ if busy mode is active. Can be enabled with U_SetBusy.req (see Set Busy Service, p31) and
                          disabled with U_QuitBusy.req service (see Quit Busy Service, p31) or U_Ackn.req service
                          (see Receive Frame Service, p44).
aa (auto−acknowledge):‘1’ if auto−acknowledge feature is active. Can be enabled with U_SetAddress.req service
                          (see Set Address Service, p32).
ap (auto−polling):        ‘1’ if auto−polling feature is active. This feature can be enabled with U_Configure.req service
                          (see Configure Service, p35).
c (CRC−CCITT):            ‘1’ if CRC−CCITT feature is active. This feature can be enabled with U_Configure.req service
                          (see Configure Service, p35).
m (frame end with MARKER): ‘1’ when feature is active. This feature can be enabled with U_Configure.req service
                          (see Configure Service, p35).
Remarks:
• Set Address Service can be issued any time but the new physical address and the autoacknowledge function will only
    get active after the KNX bus becomes idle.
•   Autoacknowledge can only be deactivated by a Reset Service (p31)
• x = don’t care
• Dummy byte can be anything. NCN5120 completely disregards this information.
Set Repetition Service
Specifies the maximum repetition count for transmitted frames when not acknowledged with IACK.
   Separate counters can be set for NACK and BUSY frames. Initial value of both counters is 3.
   If the acknowledge from remote Data Link Layer is BUSY during frame transmission, NCN5120 tries to repeat after at least
150 bit times KNX bus idle. The BUSY counter determines the maximum amount of times the frame is repeated. If the BUSY
acknowledge is still received after the last try, an L_Data.con with a negative conformation is sent back to the host controller.
   For all other cases (NACK acknowledgment received, invalid/corrupted acknowledge received or time−out after 30 bit
times) NCN5120 will repeat after 50 bit times of KNX bus idle. The NACK counter determines the maximum retries.
L_Data.con with a negative confirmation is send back to the host controller when the maximum retries were reached.
   In worst case, the same request is transmitted (NACK + BUSY + 1) times before NCN5120 stops retransmission.
                               Host Ctrl                         NCN5120                    KNX Bus
                                           U_SetRepetition.req
                                         1  1  1  1  0   0  1  0
                                           Maximum Repetitions
                                         0  b  b  b  0   n  n  n
                                                 Dummy
                                         x  x  x   x x   x  x  x
                                                 Dummy
                                         x  x  x   x x   x  x  x
                                                 Figure 38. Set Repetition Service
bbb: BUSY counter (a frame will be retransmitted bbb−times if acknowledge with BUSY).
nnn: NACK counter (a frame will be retransmitted nnn−times if acknowledge with NACK).
Remark: Bit 3 and 7 of the second byte need to be zero (‘0’)!
                                                           www.onsemi.com
                                                                   33


                                                                                                NCN5120
System Status Service
Request the internal system state of the device.
                              Host Ctrl                                                             NCN5120             KNX Bus
                                                 U_SystemStat .req
                                           0      0      0       0       1      1    0          1
                                                 U_SystemStat .ind
                                           0      1      0       0       1      0    1          1
                                                               2nd byte
                                          V20V   VDD2   VBUS    VFILT   XTAL   TW        Mode
                                                               Figure 39. System State Service
V20V:             ‘1’ if V20V linear voltage regulator is within normal operating range
VDD2:             ‘1’ if DC2 regulator is within normal operating range
VBUS:             ‘1’ if KNX bus voltage is within normal operating range
VFILT:            ‘1’ if voltage on tank capacitor is within normal operating range State Service
XTAL:             ‘1’ if crystal oscillator frequency is within normal operating range
TW:               ‘1’ if thermal warning condition is present (can also be verified with U_State.ind service (see State Service,
                  p31)
Mode:             Operation mode (see also Digital State Diagram, p26).
                                                                               Bit
                                                 1                                                    0        Mode
                                                 0                                                    0       Power−Up
                                                 0                                                    1         Sync
                                                 1                                                    0         Stop
                                                 1                                                    1        Normal
Note: SAVEB−pin is low if any of bits 3 to 7 is ‘0’ (zero) or bit 2 is ‘1’.
Stop Mode Service
  Go to Stop State. A confirmation is sent to indicate that device has switched to the Stop State. See also Digital State Diagram,
p26
                              Host Ctrl                                                             NCN5120             KNX Bus
                                                  U_StopMode.req
                                           0      0      0       0       1      1    1          0
                                                  U_StopMode.ind
                                           0      0      1       0       1      0    1          1
                                                                   Figure 40. Stop Mode Service
                                                                                    www.onsemi.com
                                                                                                      34


                                                                 NCN5120
Exit Stop Mode Service
   Request transition from Stop to Sync State. An acknowledge service is send later to confirm that device has switched from
Sync to Normal State. See also Digital State Diagram, p26.
                               Host Ctrl                          NCN5120                       KNX Bus
                                            U_ExitStopMode .req
                                          0  0  0   0   1 1  1  1
                                               U_Reset.ind
                                          0  0  0   0   0 0  1  1
                                                 Figure 41. Exit Stop Mode Service
Configure Service
Activate additional features (which are disabled after reset).
   U_Configure.ind service is send back to the host controller at the exact moment when the new features get activated. This
is done during bus idle or outside the Normal State. It confirms the execution of the request service.
                               Host Ctrl                          NCN5120                       KNX Bus
                                             U_Configure.req
                                          0  0  0   1   1 p  c  m
                                              U_Configure.ind
                                          0  b  aa ap   c m  0  1
                                                      Figure 42. Configure Service
p (auto polling):                   when active, NCN5120 automatically fills in corresponding poll slot of polling telegrams.
                                    Host controller is responsible to provide appropriate polling information with the
                                    U_PollingState.req service (See Slave Polling Frame Service and Master Polling Frame
                                    Service, p47 and 48).
c (CRC−CCITT):                      when active, NCN5120 accompanies every received frame with a 2−byte CRC−CCITT
                                    value. CRC−CCITT is also known as CRC−16−CCITT.
m (frame end with MARKER): End of received frames is normally reported with a silence of 2.6 ms on the Tx line to the host
                                    controller. With this feature active, NCN5120 marks end of frame with U_FrameEnd.ind +
                                    U_FrameState.ind services (See Send Frame Service and Receive Frame Service, p36 and 44).
b:                                  ‘1’ if busy mode is active. Can be enabled with U_SetBusy.req (see Set Busy Service, p31)
                                    and disabled with U_QuitBusy.req service (see Quit Busy Service, p31) or U_Ackn.req
                                    service (see Receive Frame Service, p44).
aa:                                 ‘1’ if auto−acknowledge feature is active. Can be enabled with U_SetAddress.req service
                                    (see Set Address Service, p32).
ap (auto−polling):                  ‘1’ if auto−polling feature is active. This feature can be enabled with U_Configure.req service.
c (CRC−CCITT):                      ‘1’ if CRC−CCITT feature is active. See p50 for info on CRC−CCITT.
                                    This feature can be enabled with U_Configure.req service.
m (frame end with MARKER): ‘1’ when feature is active. This feature can be enabled with U_Configure.req service.
Remark:
   Activation of the additional features is done by setting the corresponding bit to ‘1’. Setting the bit to ‘0’ (zero) has no effect
(will not deactivate feature). Features can only be deactivated by a reset. Set all bits (m, c and p) to ‘0‘ (zero) to poll the current
configuration status.
                                                            www.onsemi.com
                                                                    35


                                                                 NCN5120
Internal Register Write Service
   Write a byte to an internal device−specific register (see Internal Device−Specific Registers, p51). The address of the register
is specified in the request. The data to be written is transmitted after the request.
                               Host Ctrl                           NCN5120                  KNX Bus
                                            U_IntRegWr .req
                                         0 0   1   0 1  0   a   a
                                               Data Byte
                                         x x   x   x x  x   x   x
                                           Figure 43. Internal Register Write Service
aa: address of the internal register
Remark: x = don’t care (in line with Internal Device−Specific Registers, p51).
NOTE: Internal Register Write is not synchronized with other services. One should only use this service when all
           previous services are ended. When using communication over SPI, it is recommended to go to stop mode when
           performing a register write. When communicating over UART, this is not required.
Internal Register Read Service
   Read a byte from an internal device−specific register (see Internal Device−Specific Registers, p51). The address of the
register is specified in the request. The next byte returns the data of the addressed register.
                      Host Ctrl                                   NCN5120                          KNX Bus
                                      U_IntRegRd.req
                                 0    0  1   1   1   0   a    a
                                          Data Byte
                                  x   x  x   x   x   x   x    x
                                           Figure 44. Internal Register Read Service
aa: address of the internal register
Remarks:
• x = don’t care (in line with Internal Device−Specific Registers, p51).
• It’s advised to only use this service in Stop, Power−Up Stop or Power−Up State. In the other state erroneous behavior
    could occur.
NOTE: Internal Register Read is not synchronized with other services. One should only use this service when all
           previous services are ended. When using communication over SPI or UART, it is recommended to go to stop
           mode when performing a register write.
Send Frame Service
Send data over the KNX bus.
   The U_L_DataStart.req is used to start transmission of a new frame. The byte following this request is the control byte of
the KNX telegram.
   The different bytes following the control byte are assembled by using U_L_DataCont.req. The byte following
U_L_DataCont.req is the data byte of the KNX telegram. U_L_DataCont.req contains the index which specifies the position
of the data byte inside the KNX telegram. It‘s allowed to transmit bytes in random order and even overwrite bytes (= write
several times into the same index). It‘s up to the host controller to correctly populate all data bytes of the KNX telegram.
   U_L_DataEnd.req is used to finalize the frame and start the KNX transfer. The byte following U_L_DataEnd.req is the
checksum of the KNX telegram. If the checksum received by the device corresponds to the calculated checksum, the device
starts the transmission on the KNX bus. If not, the device returns U_State.ind message to the host controller with Receive Error
flag set (see State Service p31 for U_State.ind).
   U_L_DataStart/DataCont/DataEnd only provides space for 6 index bits. Because an extended frame can consist out of
                                                           www.onsemi.com
                                                                     36


                                                                      NCN5120
263 bytes, an index of 9 bits long is needed. U_DataOffset.req provides the 3 most significant bits of the data byte index. The
value is stored internally until a new offset is provided with another call.
  Each transmitted data octet on the KNX bus will also be transmitted back to the host controller.
  Each transmission is ended with a L_Data.con service where the MSB indicates if an acknowledgment was received or not.
When operating in SPI or UART 8−bit Mode, L_Data.con is preceded with U_FrameState.ind.
  Depending on the activated features, a CRC−CCITT service and/or a MARKER could be included.
  Next figures give different examples of send frames.
                                        Host Ctrl                           NCN5120                      KNX Bus
                                                      U_L_DataStart.req
                                                   1   0  0  0   0  0 0  0
                                                         Control Byte
                                                   x   x   x x   x  x x  x
                                                      U_L_DataCont.req
                                                   1   0   i i   i  i  i i
                                                         Data Octet 1
                                                   x   x   x x   x  x x  x
                                                     U_L_DataOffSet .req
                                                   0   0  0  0   1  i  i i
                                                      U_L_DataCont.req
                                                   1   0   i i   i  i  i i
                                                         Data Octet N
                                                   x   x   x x   x  x x  x
                                                      U_L_DataEnd .req
                                                   0   1   l l   l  l  l l
                                                          Checksum
                                                   x   x   x x   x  x x  x
                                                                                        Control Byte
                                                                                    x x  x  x   x  x x x
                                                          L_Data.ind
                                                   x   0   r 1  p1 p0 0  0
                                                                                        Data Octet 1
                                                                                    x x  x  x   x  x x x
                                                         Data Octet 1
                                                   x   x   x x   x  x x  x
                                                                                        Data Octet N
                                                                                    x x  x  x   x  x x x
                                                         Data Octet N
                                                   x   x   x x   x  x x  x
                                                                                         Checksum
                                                                                    x x  x  x   x  x x x
                                                          Checksum
                                                   x   x   x x   x  x x  x
                                                                                      Immediate Ackn
                                                                                    x x  x  x   x  x x x
                          w2.6ms silence
                                                      U_FrameState .ind
                                                  re  ce  te 1  res 0 1  1
                                                         L_Data.con
                                                   x   0  0  0   1  0 1  1
              Figure 45. Send Frame, SPI or 8−bit UART Mode, Frame End with Silence, No CRC−CCITT
                                                                 www.onsemi.com
                                                                           37


                                                  NCN5120
                     Host Ctrl                          NCN5120                      KNX Bus
                                  U_L_DataStart.req
                               1   0  0  0   0  0 0  0
                                     Control Byte
                               x   x  x  x   x  x x  x
                                  U_L_DataCont.req
                               1   0  i  i   i  i  i i
                                     Data Octet 1
                               x   x  x  x   x  x x  x
                                 U_L_DataOffSet .req
                               0   0  0  0   1  i  i i
                                  U_L_DataCont.req
                               1   0  i  i   i  i  i i
                                     Data Octet N
                               x   x  x  x   x  x x  x
                                  U_L_DataEnd .req
                               0   1  l  l   l  l  l l
                                      Checksum
                               x   x  x  x   x  x x  x
                                                                    Control Byte
                                                                x x  x  x   x  x x x
                                      L_Data.ind
                               x   0  r  1  p1 p0 0  0
                                                                    Data Octet 1
                                                                x x  x  x   x  x x x
                                     Data Octet 1
                               x   x  x  x   x  x x  x
                                                                    Data Octet N
                                                                x x  x  x   x  x x x
                                     Data Octet N
                               x   x  x  x   x  x x  x
                                                                     Checksum
                                                                x x  x  x   x  x x x
                                      Checksum
                               x   x  x  x   x  x x  x
                                                                  Immediate Ackn
                                                                x x  x  x   x  x x x
       w2.6ms silence
                                     L_Data.con
                               x   0  0  0   1  0 1  1
Figure 46. Send Frame, 9−bit UART Mode, Frame End with Silence, No CRC−CCITT
                                             www.onsemi.com
                                                       38


                                                    NCN5120
                       Host Ctrl                         NCN5120                      KNX Bus
                                    U_L_DataStart.req
                                 1   0  0  0   0  0  0 0
                                       Control Byte
                                 x   x  x  x   x  x  x x
                                    U_L_DataCont.req
                                 1   0  i  i   i  i  i i
                                       Data Octet 1
                                 x   x  x  x   x  x  x x
                                   U_L_DataOffSet .req
                                 0   0  0  0   1  i  i i
                                    U_L_DataCont.req
                                 1   0  i  i   i  i  i i
                                       Data Octet N
                                 x   x  x  x   x  x  x x
                                    U_L_DataEnd.req
                                 0   1  l  l   l  l  l l
                                        Checksum
                                 x   x  x  x   x  x  x x
                                                                     Control Byte
                                                                 x x  x  x   x  x x x
                                        L_Data.ind
                                 x   0  r  1  p1 p0  0 0
                                                                     Data Octet 1
                                                                 x x  x  x   x  x x x
                                       Data Octet 1
                                 x   x  x  x   x  x  x x
                                                                     Data Octet N
                                                                 x x  x  x   x  x x x
                                       Data Octet N
                                 x   x  x  x   x  x  x x
                                                                      Checksum
                                                                 x x  x  x   x  x x x
                                        Checksum
                                 x   x  x  x   x  x  x x
                                 CRC−CCITT High Byte
                                 x   x  x  x   x  x  x x
                                  CRC−CCITT Low Byte
                                 x   x  x  x   x  x  x x
                                                                   Immediate Ackn
        w2.6 ms silence                                          x x  x  x   x  x x x
                                       L_Data.con
                                 x   0  0  0   1  0  1 1
Figure 47. Send Frame, 9−bit UART Mode, Frame End with Silence, with CRC−CCITT
                                              www.onsemi.com
                                                        39


                                                        NCN5120
                          Host Ctrl                           NCN5120                      KNX Bus
                                        U_L_DataStart.req
                                     1   0  0  0   0  0 0  0
                                           Control Byte
                                     x   x   x x   x  x x  x
                                        U_L_DataCont.req
                                     1   0   i i   i  i  i i
                                           Data Octet 1
                                     x   x   x x   x  x x  x
                                       U_L_DataOffSet .req
                                     0   0  0  0   1  i  i i
                                        U_L_DataCont.req
                                     1   0   i i   i  i  i i
                                           Data Octet N
                                     x   x   x x   x  x x  x
                                        U_L_DataEnd .req
                                     0   1   l l   l  l  l l
                                            Checksum
                                     x   x   x x   x  x x  x
                                                                          Control Byte
                                                                      x x  x  x   x  x x x
                                            L_Data.ind
                                     x   0   r 1  p1 p0 0  0
                                                                          Data Octet 1
                                                                      x x  x  x   x  x x x
                                           Data Octet 1
                                     x   x   x x   x  x x  x
                                                                          Data Octet N
                                                                      x x  x  x   x  x x x
                                           Data Octet N
                                     x   x   x x   x  x x  x
                                                                           Checksum
                                                                      x x  x  x   x  x x x
                                            Checksum
                                     x   x   x x   x  x x  x
                                     CRC−CCITT High Byte
                                     x   x   x x   x  x x  x
                                      CRC−CCITT Low Byte
                                     x   x   x x   x  x x  x
                                                                        Immediate Ackn
           w 2.6ms silence                                            x x  x  x   x  x x x
                                        U_FrameState .ind
                                    re  ce  te 1  res 0 1  1
                                           L_Data.con
                                     x   0  0  0   1  0 1  1
Figure 48. Send Frame, SPI or 8−bit UART Mode, Frame End with Silence, with CRC−CCITT
                                                   www.onsemi.com
                                                             40


                                            NCN5120
          Host Ctrl                           NCN5120                      KNX Bus
                        U_L_DataStart .req
                    1    0   0 0   0   0  0 0
                           Control Byte
                     x   x   x x   x   x  x x
                        U_L_DataCont .req
                    1    0   i i   i   i  i i
                           Data Octet 1
                     x   x   x x   x   x  x x
                       U_L_DataOffSet .req
                    0    0   0 0   1   i  i i
                        U_L_DataCont .req
                    1    0   i i   i   i  i i
                           Data Octet N
                     x   x   x x   x   x  x x
                        U_L_DataEnd.req
                    0    1   l l   l   l  l l
                            Checksum
                     x   x   x x   x   x  x x
                                                          Control Byte
                                                      x x  x  x   x  x x x
                            L_Data.ind
                     x   0   r 1  p1  p0  0 0
                                                          Data Octet 1
                                                      x x  x  x   x  x x x
                           Data Octet 1
                     x   x   x x   x   x  x x
                                                          Data Octet N
                                                      x x  x  x   x  x x x
                           Data Octet N
                     x   x   x x   x   x  x x
                                                           Checksum
                                                      x x  x  x   x  x x x
                            Checksum
                     x   x   x x   x   x  x x
                         U_FrameEnd.ind
                    1    1   0 0   1   0  1 1
                                                        Immediate Ackn
                                                      x x  x  x   x  x x x
                        U_FrameState .ind
                    re  ce  te 1  res  0  1 1
                           L_Data.con
                     x   0   0 0   1   0  1 1
Figure 49. Send Frame, All Modes, Frame End with MARKER, No CRC−CCITT
                                         www.onsemi.com
                                                41


                                              NCN5120
            Host Ctrl                           NCN5120                      KNX Bus
                          U_L_DataStart .req
                      1    0   0 0   0   0  0 0
                             Control Byte
                       x   x   x x   x   x  x x
                          U_L_DataCont .req
                      1    0   i i   i   i  i i
                             Data Octet 1
                       x   x   x x   x   x  x x
                         U_L_DataOffSet .req
                      0    0   0 0   1   i  i i
                          U_L_DataCont .req
                      1    0   i i   i   i  i i
                             Data Octet N
                       x   x   x x   x   x  x x
                          U_L_DataEnd.req
                      0    1   l l   l   l  l l
                              Checksum
                       x   x   x x   x   x  x x
                                                            Control Byte
                                                        x x  x  x  x   x x x
                              L_Data.ind
                       x   0   r 1  p1  p0  0 0
                                                            Data Octet 1
                                                        x x  x  x  x   x x x
                             Data Octet 1
                       x   x   x x   x   x  x x
                                                            Data Octet N
                                                        x x  x  x  x   x x x
                             Data Octet N
                       x   x   x x   x   x  x x
                                                             Checksum
                                                        x x  x  x  x   x x x
                              Checksum
                       x   x   x x   x   x  x x
                          U_FrameEnd.ind
                      1    1   0 0   1   0  1 1
                                                          Immediate Ackn
                                                        x x  x  x  x   x x x
                          U_FrameState .ind
                      re  ce  te 1  res  0  1 1
                       CRC−CCITT High Byte
                       x   x   x x   x   x  x x
                        CRC−CCITT Low Byte
                       x   x   x x   x   x  x x
                             L_Data.con
                       x   0   0 0   1   0  1 1
Figure 50. Send Frame, All Modes, Frame End with MARKER and with CRC−CCITT
                                           www.onsemi.com
                                                  42


                                                            NCN5120
re (receive error):                 ‘1’ if newly received frame contained corrupted bytes (wrong parity, wrong stop bit or
                                    incorrect bit timings)
ce (checksum or length error):      ‘1’ if newly received frame contained wrong checksum or length which does not correspond
                                    to the number of received bytes
te (timing error):                  ‘1’ if newly received frame contained bytes whose timings do not comply with the KNX
                                    standard
res (reserved):                     Reserved for future use (will be ‘0’).
Remarks:
− If the repeat flag is not set (see Set Repetition Service p33), the device will only perform one attempt to send the KNX
   telegram.
− Sending of the KNX telegram over the KNX bus is only started after all data bytes are received and the telegram is
   assembled.
− When starting transmission of a new frame with U_L_DataStart.req, the device automatically resets the internal offset of
   the data index to zero.
− Data offsets of 5, 6 and 7 are forbidden (U_L_DataOffset.req)!
Remarks on Figures 45 to 50:
− x = don‘t care (in respect with KNX standard)
− See Tables 12 and 13 for more details on all the bits
− Code of U_FrameEnd.ind (0xCB) can also be part of the KNX frame content (Data Octet). When NCN5120 transmits
   the data octet (0xCB) on the KNX bus, 2 bytes (2 times 0xCB) will be transmitted back to the host controller to make it
   possible for the host controller to distinguish between a data octet (0xCB) and U_FrameEnd.ind. This remark is only
   valid if frame end with MARKER is enabled.
− See p50 for info on CRC−CCITT.
                                                        www.onsemi.com
                                                                43


                                                                      NCN5120
Receive Frame Service
  Receive data over the KNX bus.
  Upon reception from the control byte, the control byte is checked by the device. If correct, the control byte is transmitted
back to the host (L_Data_Standard.ind or L_Data_Extended.ind depending if standard or extended frame type is received).
After the control byte, all data bytes are transparently transmitted back to the host controller. Handling of this data is a task
for the Data Link Layer which should be implemented in the host controller.
  The host controller can indicate if the device is addressed by setting the NACK, BUSY or ACK flag (U_Ackn.req).
  When working in SPI or 8−bit UART Mode, each frame is ended with an U_FrameState.ind. Depending on the activated
features, a CRC−CCITT or MARKER could be added to the complete frame.
  Below figures give different examples of receive frames.
                                         Host Ctrl                         NCN5120                      KNX Bus
                                                                                       Control Byte
                                                                                   x x  x  x   x  x x x
                                                          L_Data .ind
                                                    x  0   r 1 p1 p0   0 0
                                                                                       Data Octet 1
                                                                                   x x  x  x   x  x x x
                                                         Data Octet 1
                                                    x  x   x x  x   x  x x
                                                         U_Ackn .req
                                                    0  0  0  1  0   n  b a
                                                                                       Data Octet N
                                                                                   x x  x  x   x  x x x
                                                         Data Octet N
                                                    x  x   x x  x   x  x x
                                                                                        Checksum
                                                                                   x x  x  x   x  x x x
                                                          Checksum
                                                    x  x   x x  x   x  x x
                                                                                     Immediate Ackn
                                                                                   x x  x  x   x  x x x
                          w2.6 ms silence
                                                      U_FrameState .ind
                                                   re ce  te 1  0   0  1 1
             Figure 51. Receive Frame, SPI or 8−bit UART Mode, Frame End with Silence, No CRC−CCITT
                                                                www.onsemi.com
                                                                          44


                                                     NCN5120
                        Host Ctrl                          NCN5120                                  KNX Bus
                                                                           Control Byte
                                                                    x   x    x   x   x   x   x   x
                                        L_Data .ind
                                  x  0   r 1  p1 p0   0  0
                                                                           Data Octet 1
                                                                    x   x    x   x   x   x   x   x
                                       Data Octet 1
                                  x  x  x  x   x   x  x  x
                                        U_Ackn .req
                                  0  0  0  1   0  n   b  a
                                                                           Data Octet N
                                                                    x   x    x   x   x   x   x   x
                                       Data Octet N
                                  x  x  x  x   x   x  x  x
                                                                            Checksum
                                                                    x   x    x   x   x   x   x   x
                                        Checksum
                                  x  x  x  x   x   x  x  x
                                                                        Immediate Ackn
                                                                    x   x    x   x   x   x   x   x
         w2.6 ms silence
 Figure 52. Receive Frame, 9−bit UART Mode, Frame End with Silence, No CRC−CCITT
                        Host Ctrl                          NCN5120                                 KNX Bus
                                                                          Control Byte
                                                                   x  x    x   x   x   x   x   x
                                        L_Data.ind
                                  x  0  r  1 p1 p0   0  0
                                                                          Data Octet 1
                                                                   x  x    x   x   x   x   x   x
                                       Data Octet 1
                                  x  x  x  x  x   x  x  x
                                       U_Ackn.req
                                  0  0  0  1  0   n  b  a
                                                                          Data Octet N
                                                                   x  x    x   x   x   x   x   x
                                       Data Octet N
                                  x  x  x  x  x   x  x  x
                                                                           Checksum
                                                                   x  x    x   x   x   x   x   x
                                        Checksum
                                  x  x  x  x  x   x  x  x
                                  CRC−CCITT High Byte
                                  x  x  x  x  x   x  x  x
                                                                      Immediate Ackn
                                                                   x  x    x   x   x   x   x   x
                                   CRC−CCITT Low Byte
                                  x  x  x  x  x   x  x  x
          w2.6ms silence
Figure 53. Receive Frame, 9−bit UART Mode, Frame End with Silence, with CRC−CCITT
                                              www.onsemi.com
                                                          45


                                                                       NCN5120
                          Host Ctrl                                           NCN5120                                KNX Bus
                                                                                               Control Byte
                                                                                        x   x   x   x   x   x   x  x
                                                  L_Data.ind
                                       x     0     r     1    p1 p0     0  0
                                                                                              Data Octet 1
                                                                                        x   x   x   x   x   x   x  x
                                                 Data Octet 1
                                       x     x     x     x     x    x   x  x
                                                 U_Ackn.req
                                       0     0    0      1     0    n   b  a
                                                                                              Data Octet N
                                                                                        x   x   x   x   x   x   x  x
                                                Data Octet N
                                       x     x     x     x     x    x   x  x
                                                                                                Checksum
                                                                                        x   x   x   x   x   x   x  x
                                                  Checksum
                                       x     x     x     x     x    x   x  x
                                       CRC−CCITT High Byte
                                       x     x     x     x     x    x   x  x
                                                                                            Immediate Ackn
                                                                                        x   x   x   x   x   x   x  x
                                        CRC−CCITT Low Byte
                                       x     x     x     x     x    x   x  x
             w2.6ms silence
                                            U_FrameState.ind
                                      re    ce    te     1    res   0   1  1
Figure 54. Receive Frame, SPI or 8−bit UART Mode, Frame End with Silence, with CRC−CCITT
                  Host Ctrl                                              NCN5120                                  KNX Bus
                                                                                         Control Byte
                                                                                   x  x   x   x   x   x   x   x
                                         L_Data.ind
                                x   0     r    1     p1    p0     0   0
                                                                                         Data Octet 1
                                                                                   x  x   x   x   x   x   x   x
                                       Data Octet 1
                                x   x     x    x      x     x     x   x
                                        U_Ackn.req
                               0    0     0    1      0     n     b   a
                                                                                        Data Octet N
                                                                                   x  x   x   x   x   x   x   x
                                      Data Octet N
                                x   x     x    x      x     x     x   x
                                                                                          Checksum
                                                                                   x  x   x   x   x   x   x   x
                                         Checksum
                                x   x     x    x      x     x     x   x
                                   U_FrameEnd.ind
                               1    1     0    0      1     0     1   1
                                                                                      Immediate Ackn
                                                                                   x  x   x   x   x   x   x   x
                                  U_FrameState.ind
                               re ce     te    1     res    0     1   1
       Figure 55. Receive Frame, All Modes, Frame End with MARKER, No CRC−CCITT
                                                               www.onsemi.com
                                                                             46


                                                                NCN5120
                               Host Ctrl                          NCN 5120                      KNX Bus
                                                                               Control Byte
                                                                           x x  x  x   x  x x x
                                                 L_Data.ind
                                           x  0   r 1 p1  p0  0 0
                                                                               Data Octet 1
                                                                           x x  x  x   x  x x x
                                                Data Octet 1
                                           x  x   x x  x   x  x x
                                                U_Ackn .req
                                          0   0   0 1  0   n  b a
                                                                               Data Octet N
                                                                           x x  x  x   x  x x x
                                                Data Octet N
                                           x  x   x x  x   x  x x
                                                                                Checksum
                                                                           x x  x  x   x  x x x
                                                 Checksum
                                           x  x   x x  x   x  x x
                                              U_FrameEnd .ind
                                          1   1   0 0  1   0  1 1
                                                                             Immediate Ackn
                                                                           x x  x  x   x  x x x
                                             U_FrameState .ind
                                          re ce  te 1 res  0  1 1
                                           CRC −CCITT High Byte
                                           x  x   x x  x   x  x x
                                            CRC −CCITT Low Byte
                                           x  x   x x  x   x  x x
                    Figure 56. Receive Frame, All Modes, Frame End with MARKER, with CRC−CCITT
re (receive error):                 ‘1’ if newly received frame contained corrupted bytes (wrong parity, wrong stop bit or
                                    incorrect bit timings)
ce (checksum or length error):      ‘1’ if newly received frame contained wrong checksum or length which does not correspond
                                    to the number of received bytes
te (timing error) :                 ‘1’ if newly received frame contained bytes whose timings do not comply with the KNX
                                    standard
res (reserved) :                    Reserved for future use (will be ‘0’).
Remarks on Figures 51 to 56:
− x = don‘t care (in respect with KNX standard)
− See Tables 12 and 13 for more details on all the bits
− Code of U_FrameEnd.ind (0xCB) can also be part of the KNX frame content (Data Octet). To make a distinguish
   between a data octet and U_FrameEnd.ind, NCN5120 duplicates the data content (if 0xCB). This will result in 2 bytes
   transmitted to the host controller (two times 0xCB) corresponding to 1 byte received on the KNX bus.
   Above is only valid if frame end with MARKER is enabled.
− See p50 for info on CRC−CCITT.
Slave Polling Frame Service
   Upon reception and consistency check of the polling control byte, the control byte is send back to the host controller
(L_Poll_Data.ind). The host controller will send the slot number to the device (U_PollingState.req), followed by the polling
address and the polling state. At the same time the source address, polling address, slot count and checksum is received over
the KNX bus. If the polling address received from the KNX bus is equal to the polling address received from the host controller,
NCN5120 will send the polling data in the slot as define by U_PollingState.req (only if the slotcount is higher as the define
slot).
   U_PollingState.req can be sent at any time (not only during a transmission of a polling telegram). The information is stored
internally in NCN5120 and can be reused for further polling telegrams if auto−polling function gets activated.
                                                             www.onsemi.com
                                                                    47


                                                              NCN5120
                             Host Ctrl                         NCN5120                      KNX Bus
                                                                           Control Byte
                                                                       1 1  1   1  0 0  0 0
                                           L_Poll_Data.ind
                                       1  1   1   1  0  0  0 0
                                                                          Source Address
                                                                       x x  x   x  x x  x x
                                         U_PollingState .req
                                       1  1   1   0  s  s  s s
                                                                          Source Address
                                                                       x x  x   x  x x  x x
                                             PollAddrHigh
                                       x  x   x   x  x  x  x x
                                                                           Poll Address
                                                                       x x  x   x  x x  x x
                                             PollAddrLow
                                       x  x   x   x  x  x  x x
                                                                           Poll Address
                                                                       x x  x   x  x x  x x
                                               PollState
                                       x  x   x   x  x  x  x x
                                                                            Slot Count
                                                                       x x  x   x  x x  x x
                                                                            Checksum
                                                                       x x  x   x  x x  x x
                                                                              Slot 0
                                                                       x x  x   x  x x  x x
                                                                              Slot N
                                                                       x x  x   x  x x  x x
                                            Figure 57. Slave Polling Frame Service
Remarks:
                 x = don’t care (in respect with KNX standard)
                 ssss = slot number
Master Polling Frame Service
  When NCN5120 receives the polling frame from the host controller, the polling frame will be transmitted over the KNX bus.
                                                          www.onsemi.com
                                                                 48


                                                      NCN5120
                      Host Ctrl                         NCN5120                       KNX Bus
                                     Control Byte
                                1  1  1   1   0  0  0 0
                                    Source Address
                                x  x  x   x   x  x  x x
                                    Source Address
                                x  x  x   x   x  x  x x
                                     Poll Address
                                x  x  x   x   x  x  x x
                                     Poll Address
                                x  x  x   x   x  x  x x
                                      Slot Count
                                x  x  x   x   x  x  x x
                                      Checksum
                                x  x  x   x   x  x  x x
                                                                    Control Byte
                                                                1 1  1   1  0  0 0  0
                                    L_Poll_Data.ind
                                1  1  1   1   0  0  0 0
                                                                   Source Address
                                                                x x  x   x  x  x  x x
                                    Source Address
                                x  x  x   x   x  x  x x
                                  U_PollingState .req
                                1  1  1   0   s  s  s s
                                                                   Source Address
                                                                x x  x   x  x  x  x x
                                    Source Address
                                x  x  x   x   x  x  x x
                                                                    Poll Address
                                                                x x  x   x  x  x  x x
                                     PollAddrHigh
                                x  x  x   x   x  x  x x
                                     Poll Address
                                x  x  x   x   x  x  x x
                                                                    Poll Address
                                                                x x  x   x  x  x  x x
                                     PollAddrLow
                                x  x  x   x   x  x  x x
                                     Poll Address
                                x  x  x   x   x  x  x x
                                                                     Slot Count
                                                                x x  x   x  x  x  x x
                                       PollState
                                x  x  x   x   x  x  x x
                                      Slot Count
                                x  x  x   x   x  x  x x
                                                                     Checksum
                                                                x x  x   x  x  x  x x
                                      Checksum
                                x  x  x   x   x  x  x x
                                                                       Slot 0
                                                                x x  x   x  x  x  x x
                                         Slot 0
                                x  x  x   x   x  x  x x
                                                                       Slot N
                                                                x x  x   x  x  x  x x
                                         Slot N
                                x  x  x   x   x  x  x x
                                  Figure 58. Master Polling Frame Service
Remarks:
         x = don‘t care (in respect with KNX standard)
         ssss = slot number
                                                   www.onsemi.com
                                                          49


                                                         NCN5120
CRC−CCITT
CRC order - 16 bit
CRC polynom (hex) - 1021
Initial value (hex) − FFFF
Final XOR value (hex) − 0
No reverse on output CRC
Test string „123456789“ is 29B1h
CRC−CCITT value over a buffer of bytes can be calculated with following code fragment in C, where
          pBuf is pointer to the start of frame buffer
          uLength is the frame length in bytes
unsigned short calc_CRC_CCITT(unsigned char* pBuf, unsigned short uLength)
{
          unsigned short u_crc_ccitt;
          for (u_crc_ccitt = 0xFFFF; uLength−−; p++)
          {
                   u_crc_ccitt = get_CRC_CCITT(u_crc_ccitt, *p);
          }
          return u_crc_ccitt;
}
unsigned short get_CRC_CCITT(unsigned short u_crc_val, unsigned char btVal)
{
          u_crc_val = ((unsigned char)(u_crc_val >> 8)) | (u_crc_val << 8);
          u_crc_val ^= btVal;
          u_crc_val ^= ((unsigned char)(u_crc_val & 0xFF)) >> 4;
          u_crc_val ^= u_crc_val << 12;
          u_crc_val ^= (u_crc_val & 0xFF) << 5;
          return u_crc_val;
}
                                                       www.onsemi.com
                                                             50


                                                               NCN5120
Internal Device−Specific Registers
  In total 4 device-specific register are available:
•  Watchdog Register (0x00)
•  Analog Control Register 0 (0x01)
•  Analog Control Register 1 (0x02)
•  Analog Status Register 0 (0x03)
Watchdog Register
  The Watchdog Register is located at address 0x00 and can be used to enable the watchdog and set the watchdog time.
 Table 14. WATCHDOG REGISTER
                                                      ExtWatchdogCtrl (ExtWR)
   Address                         Bit 7        Bit 6          Bit 5         Bit 4       Bit 3          Bit 2       Bit 1  Bit 0
                    Access         R/W          R/W            R/W           R/W         R/W            R/W         R/W     R/W
     0x00            Reset          0            0               0             0           1              1          1       1
                     Data         WDEN            -              -             -                                WDT
 Table 15. WATCHDOG REGISTER PARAMETERS
  Parameter             Value                                               Description                                   Info
                  0        Disable
    WDEN                                                          Enables/disables the watchdog
                  1         Enable
                0000        33 ms
                0001        66 ms
                0010        98 ms
                0011       131 ms
                0100       164 ms
                0101       197 ms
                0110       229 ms
                                                                                                                          p19
                0111       262 ms         Defines the watchdog time. The watchdog needs to be re-enabled (WDEN)
    WDT
                1000       295 ms                     within this time or a watchdog event will be triggered.
                1001       328 ms
                1010       360 ms
                1011       393 ms
                1100       426 ms
                1101       459 ms
                1110       492 ms
                1111       524 ms
Remark: Bit 4 … 6 are reserved.
Analog Control Register 0
  The Analog Control Register 0 is located at address 0x01 and can be used to enable Sleep Mode, to disable the V20V and
the DC2 regulator, to disable the XCLK-pin and to set the frequency of the XCLK output signal.
 Table 16. ANALOG CONTROL REGISTER 0
                                               Analog Control Register 0 (AnaCtrl0)
   Address                         Bit 7        Bit 6           Bit 5        Bit 4         Bit 3           Bit 2    Bit 1   Bit 0
                    Access         R/W          R/W             R/W          R/W            R/W            R/W      R/W     R/W
     0x01            Reset           0            1               1            1              0             0         0      0
                      Data        SLPEN       V20VEN          DC2EN         XCLKEN      XCLKFREQ             -        -       -
                                                          www.onsemi.com
                                                                     51


                                                                NCN5120
 Table 17. ANALOG CONTROL REGISTER 0 PARAMETERS
  Parameter          Value                                                    Description                                 Info
                 0       Disable                                      Enables/disables Sleep Mode
    SLPEN                                                                                                                 p 19
                 1       Enable                                         (≠ going to Sleep Mode)
                 0       Disable
   V20VEN                                                        Enables/disables the V20V regulator                      p 17
                 1       Enable
                 0       Disable
    DC2EN                                                         Enables/disables the DC2 converter                      p 17
                 1       Enable
                 0       Disable
   XCLKEN                                                      Enables/disables the XCLK output signal
                 1       Enable
                                                                                                                          p 17
                 0       8 MHz
  XCLKFREQ                                            Sets the frequency of the XCLK output signal (if enabled)
                 1       16 MHz
Remark: Bit 0 … 2 are reserved.
Analog Control Register 1
  The Analog Control Register 1 is located at address 0x02 and can be used to put the device in Sleep Mode.
 Table 18. ANALOG CONTROL REGISTER 1
                                                 Analog Control Register 1 (AnaCtrl1)
   Address                       Bit 7            Bit 6          Bit 5         Bit 4        Bit 3       Bit 2     Bit 1   Bit 0
                 Access          R/W              R/W            R/W           R/W          R/W         R/W       R/W     R/W
     0x02         Reset            0                0               0            0           0            0         0       0
                  Data            SLP               -               -            -            -           -         -       -
 Table 19. ANALOG CONTROL REGISTER 1 PARAMETERS
  Parameter          Value                                                    Description                                 Info
                 0       Disable       If ‘1’, device goes to Sleep Mode (if SLPEN = ‘1’). Once in Sleep Mode, only way p 18 and
     SLP
                 1       Enable                        to get out is a Wake-Up Event on the FANIN/WAKE-pin.                19
Remark: Bit 0 … 6 are reserved.
Analog Status Register
  The Analog Status Register is located at address 0x03 and can be used to verify the Sleep Mode, voltage monitors, Xtal and
thermal status.
 Table 20. ANALOG STATUS REGISTER
                                                   Analog Status Register (AnaStat)
   Address                         Bit 7           Bit 6         Bit 5         Bit 4        Bit 3       Bit 2     Bit 1   Bit 0
                 Access             R                 R            R             R           R            R         R       R
     0x03         Reset              0                0             0            0           0            0         0       0
                  Data         SLPMODE             V20V         VDD2          VBUS         VFILT        XTAL       TW     TSD
                                                           www.onsemi.com
                                                                      52


                                                  NCN5120
Table 21. ANALOG STATUS REGISTER PARAMETERS
 Parameter    Value    Value                                         Description                       Info
                0    Disabled
 SLPMODE                            Contains information about the previous Sleep Mode of the device   p 19
                1     Enabled
                0      nOK
   V20V                               ‘1’ if voltage on V20V-pin is above the V20V undervoltage level  p 17
                1       OK
                0      nOK
   VDD2                              ‘1’ if voltage on VDD2-pin is above the VDD2 undervoltage level   p 17
                1       OK
                0      nOK
   VBUS                                     ‘1’ if bus voltage is above the VBUS undervoltage level    P 16
                1       OK
                0      nOK
   VFILT                             ‘1’ if voltage on VFILT-pin is above the VFILT undervoltage level p 16
                1       OK
                0      nOK
   XTAL                                                     ‘1’ if XTAL is up and running              p 17
                1       OK
                0     No TW
    TW                                                    ‘1’ if Thermal Warning detected
                1       TW
                                                                                                       p 19
                0     No TSD
    TSD                            Contains information about the previous Thermal Shutdown situation
                1      TSD
                                           www.onsemi.com
                                                       53


                                                               NCN5120
                                        PACKAGE THERMAL CHARACTERISTICS
   The NCN5120 is available in a QFN40 package. For cooling optimizations, the QFN40 has an exposed thermal pad which
has to be soldered to the PCB ground plane. The ground plane needs thermal vias to conduct the heat to the bottom layer.
   Figure 59 gives an example of good heat transfer. The exposed thermal pad is soldered directly on the top ground layer (left
picture of Figure 59). It‘s advised to make the top ground layer as large as possible (see arrows Figure 59). To improve the heat
transfer even more, the exposed thermal pad is connected to a bottom ground layer by using thermal vias (see right picture of
Figure 59). It‘s advised to make this bottom ground layer as large as possible and with as less as possible interruptions.
   For precise thermal cooling calculations the major thermal resistances of the device are given (Table 4). The thermal media
to which the power of the devices has to be given are:
− Static environmental air (via the case)
− PCB board copper area (via the exposed pad)
   The major thermal resistances of the device are the Rth from the junction to the ambient (Rthja) and the overall Rth from
the junction to exposed pad (Rthjp). In Table 4 one can find the values for the Rthja and Rthjp, simulated according to JESD−51.
The Rthja for 2S2P is simulated conform JEDEC JESD−51 as follows:
− A 4−layer printed circuit board with inner power planes and outer (top and bottom) signal layers is used
− Board thickness is 1.46 mm (FR4 PCB material)
− The 2 signal layers: 70 mm thick copper with an area of 5500 mm2 copper and 20% conductivity
− The 2 power internal planes: 36 mm thick copper with an area of 5500 mm2 copper and 90% conductivity
The Rthja for 1S0P is simulated conform to JEDEC JESD−51 as follows:
− A 1−layer printed circuit board with only 1 layer
− Board thickness is 1.46 mm (FR4 PCB material)
− The layer has a thickness of 70 mm copper with an area of 5500 mm2 copper and 20% conductivity
  Figure 59. PCB Ground Plane Layout Condition (left picture displays the top ground layer, right picture displays
                                                      the bottom ground layer)
 ORDERING INFORMATION
         Device Number                 Temperature Range                     Package                            Shipping†
  NCN5120MNG                              −25°C to 85°C                      QFN−40                           50 Units / Tube
                                                                            (Pb−Free)                        100 Tubes / Box
  NCN5120MNTWG                            −25°C to 85°C                      QFN−40                         3000 / Tape & Reel
                                                                            (Pb−Free)
†For information on tape and reel specifications, including part orientation and tape sizes, please refer to our Tape and Reel Packaging
  Specification Brochure, BRD8011/D.
                                                           www.onsemi.com
                                                                     54


                                                                                            NCN5120
                                                                              PACKAGE DIMENSIONS
                                                                                       QFN40 6x6, 0.5P
                                                                                          CASE 485AU
                                                                                             ISSUE O
                                                                                                                                        NOTES:
                              ÉÉ
                                                  D                    A B                                   L                 L         1. DIMENSIONING AND TOLERANCING PER
                                                                                                                                            ASME Y14.5M, 1994.
                              ÉÉ
                                                                                                                                         2. CONTROLLING DIMENSIONS: MILLIMETERS.
                 PIN ONE                                                                                                                 3. DIMENSION b APPLIES TO PLATED
                LOCATION                                                                L1                                                  TERMINAL AND IS MEASURED BETWEEN
                                                                                                                                            0.15 AND 0.30mm FROM TERMINAL TIP.
                                                                                                       DETAIL A                          4. COPLANARITY APPLIES TO THE EXPOSED
                                                                                                                                            PAD AS WELL AS THE TERMINALS.
                                                                            E                           OPTIONAL
                                                                                                   CONSTRUCTIONS
                                                                                                                                                   MILLIMETERS
                                                                                                                                             DIM    MIN      MAX
                                                                                                     ÉÉÉ
                                                                                                                                              A     0.80      1.00
                  0.15 C                                                                  EXPOSED Cu              MOLD CMPD                  A1     0.00      0.05
                                                                                                     ÉÉÉ
                                                                                                                                             A3      0.20 REF
                                                                                                                                              b     0.18      0.30
                                         TOP VIEW                                                                                             D      6.00 BSC
                       0.15 C
                                                                                                                                             D2     3.10      3.30
                                                                                                                                              E      6.00 BSC
                                        DETAIL B                (A3)                                    DETAIL B                              E2    3.10      3.30
                  0.10 C                                                                                 OPTIONAL                              e     0.50 BSC
                                                                                                    CONSTRUCTIONS                             K       0.20 MIN
                                                                             A
                                                                                                                                              L     0.30      0.50
                  0.08 C                                                                                                                      L1     −−−      0.15
                                                              A1
           NOTE 4                                                                      SEATING
                                        SIDE VIEW                                 C    PLANE
                                                                0.10 C A B                                                SOLDERING FOOTPRINT*
                           DETAIL A
                                                 D2                                                                                         6.30
                                                                     K                                                                                                  40X
                                    11                     20
                                                                                                                                           3.32                        0.63
                              10                                 21
                          E2                                                                                              1
                                                                          L
        0.10 C A B             1                                 30                                                   3.32                                              6.30
                                   40                      31
                               e                                              40X   b
                                    BOTTOM VIEW                                       0.10 C A B
                                                                                      0.05 C                   PACKAGE
                                                                                                                OUTLINE                                           40X
                                                                                                                       0.50 PITCH                                 0.28
                                                                                                                                                  DIMENSIONS: MILLIMETERS
                                                                                                        *For additional information on our Pb−Free strategy and soldering
                                                                                                          details, please download the ON Semiconductor Soldering and
                                                                                                          Mounting Techniques Reference Manual, SOLDERRM/D.
KNX and the KNX Logos are trademarks of KNX Association.
  ON Semiconductor and the            are registered trademarks of Semiconductor Components Industries, LLC (SCILLC) or its subsidiaries in the United States and/or other countries.
  SCILLC owns the rights to a number of patents, trademarks, copyrights, trade secrets, and other intellectual property. A listing of SCILLC’s product/patent coverage may be accessed
  at www.onsemi.com/site/pdf/Patent−Marking.pdf. SCILLC reserves the right to make changes without further notice to any products herein. SCILLC makes no warranty, representation
  or guarantee regarding the suitability of its products for any particular purpose, nor does SCILLC assume any liability arising out of the application or use of any product or circuit, and
  specifically disclaims any and all liability, including without limitation special, consequential or incidental damages. “Typical” parameters which may be provided in SCILLC data sheets
  and/or specifications can and do vary in different applications and actual performance may vary over time. All operating parameters, including “Typicals” must be validated for each
  customer application by customer’s technical experts. SCILLC does not convey any license under its patent rights nor the rights of others. SCILLC products are not designed, intended,
  or authorized for use as components in systems intended for surgical implant into the body, or other applications intended to support or sustain life, or for any other application in which
  the failure of the SCILLC product could create a situation where personal injury or death may occur. Should Buyer purchase or use SCILLC products for any such unintended or
  unauthorized application, Buyer shall indemnify and hold SCILLC and its officers, employees, subsidiaries, affiliates, and distributors harmless against all claims, costs, damages, and
  expenses, and reasonable attorney fees arising out of, directly or indirectly, any claim of personal injury or death associated with such unintended or unauthorized use, even if such claim
  alleges that SCILLC was negligent regarding the design or manufacture of the part. SCILLC is an Equal Opportunity/Affirmative Action Employer. This literature is subject to all applicable
  copyright laws and is not for resale in any manner.
PUBLICATION ORDERING INFORMATION
LITERATURE FULFILLMENT:                                                       N. American Technical Support: 800−282−9855 Toll Free          ON Semiconductor Website: www.onsemi.com
 Literature Distribution Center for ON Semiconductor                           USA/Canada
 19521 E. 32nd Pkwy, Aurora, Colorado 80011 USA                               Europe, Middle East and Africa Technical Support:              Order Literature: http://www.onsemi.com/orderlit
 Phone: 303−675−2175 or 800−344−3860 Toll Free USA/Canada                      Phone: 421 33 790 2910
 Fax: 303−675−2176 or 800−344−3867 Toll Free USA/Canada                       Japan Customer Focus Center                                    For additional information, please contact your local
 Email: orderlit@onsemi.com                                                    Phone: 81−3−5817−1050                                         Sales Representative
                                                                                       www.onsemi.com                                                                         NCN5120/D
                                                                                                  55


Mouser Electronics
Authorized Distributor
Click to View Pricing, Inventory, Delivery & Lifecycle Information:
ON Semiconductor:
 NCN5120MNTWG
