                                                                 SPI EXCHANGE 2 x SPI-3 TO SPI-4
                                                                              Issue 1.0                                                         IDT88P8342
FEATURES                                                                                           - Number of errors
   •  Functionality                                                                                - Number of bytes
                                                                                          •    Green parts available, see ordering information
      - Low speed to high speed SPI exchange device
      - Logical port (LP) mapping (SPI-3 <-> SPI-4) tables per direction
      - Per LP configurable memory allocation                                          APPLICATIONS
      - Maskable interrupts for fatal errors                                              •   Ethernet transport
      - Fragment and burst length configurable per interface: min 16 bytes,               •   SONET / SDH packet transport line cards
     max 256 bytes                                                                        •   Broadband aggregation
   • Standard Interfaces                                                                  •   Multi-service switches
      - Two OIF SPI-3: 8 or 32 bit, 19.44-133 MHz, 256 address range, 64                  •   IP services equipment
    concurrently active LPs per interface
      - One OIF SPI-4 phase 2: 80 - 400 MHz, 256 address range, 128                    DESCRIPTION
       concurrently active LPs                                                            The IDT88P8342 is a SPI (System Packet Interface) Exchange with two SPI-
      - SPI-4 FIFO status channel options:                                             3 interfaces and one SPI-4 interface. The data that enter on the low speed
              • LVDS full-rate                                                         interface (SPI-3) are mapped to logical identifiers (LIDs) and enqueued for
              • LVTTL eighth-rate                                                      transmission over the high speed interface (SPI-4). The data that enter on the
      - Compatible with Network Processor Streaming Interface (NPSI)                   high speed interface (SPI-4) are mapped to logical identifiers (LIDs) and
      NPE-Framer mode of operation                                                     enqueued for transmission over a low speed interface (SPI-3). A data flow
      - SPI-4 ingress LVDS automatic bit alignment and lane de-skew over               between SPI-3 and SPI-4 interfaces is accomplished with LID maps. The logical
      the entire frequency range                                                       port addresses and number of entries in the LID maps may be dynamically
      - SPI-4 egress LVDS programmable lane pre-skew 0.1 to 0.3 cycle                  configured. Various parameters of a data flow may be configured by the user
      - IEEE 1149.1 JTAG                                                               such as buffer memory size and watermarks. In a typical application, the
      - Serial or parallel microprocessor interface for control and monitoring         IDT88P8342 enables connection of two SPI-3 devices to a SPI-4 network
   • Full Suite of Performance Monitoring Counters                                     processor. In other applications a SPI-3 or SPI-4 device may be connected to
              - Number of packets                                                      a SPI-3 network processor or traffic manager.
              - Number of fragments
   FUNCTIONAL BLOCK DIAGRAM
                                                                              SPI-3 to SPI-4 PFP
                                                              SPI-3 A
                                                        64 Logical Ports
                                                                              SPI-4 to SPI-3 PFP
                                                                                                                         SPI-4
                                                                                                                       128 Logical
                                                                                                                          Ports
                                                                              SPI-3 to SPI-4 PFP
                                                              SPI-3 B
                                                        64 Logical Ports
                                                                              SPI-4 to SPI-3 PFP
                                                           JTAG IF                    Uproc IF              Clock Generator
                                                       Control Path           Data Path         PFP = Packet Fragment Processor
                                                                                                                                 6371 drw01
IDT and the IDT logo are trademarks of Integrated Device Technology, Inc
INDUSTRIAL TEMPERATURE RANGE                                                                                                                    APRIL 2006
                                                                                     1
2006 Integrated Device Technology, Inc. All rights reserved. Product specifications subject to change without notice.                                    DSC-6371/9


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                                                                      INDUSTRIAL TEMPERATURE RANGE
                                                                        Table of Contents
Features ........................................................................................................................................................................................................................ 1
Applications .................................................................................................................................................................................................................. 1
1. Introduction ............................................................................................................................................................................................................. 8
2. Pin description ......................................................................................................................................................................................................... 9
3. External interfaces ................................................................................................................................................................................................. 13
     3.1 SPI-3 ............................................................................................................................................................................................................... 13
          3.1.1 SPI-3 ingress ........................................................................................................................................................................................ 13
          3.1.2 SPI-3 egress ........................................................................................................................................................................................ 15
     3.2 SPI-4 ............................................................................................................................................................................................................... 17
          3.2.1 SPI-4 ingress ........................................................................................................................................................................................ 17
          3.2.2 SPI-4 egress ........................................................................................................................................................................................ 20
          3.2.3 SPI-4 startup handshake ....................................................................................................................................................................... 20
     3.3 Microprocessor interface .................................................................................................................................................................................. 22
4. Datapath and flow control .................................................................................................................................................................................... 23
     4.1 SPI-3 to SPI-4 datapath and flow control .......................................................................................................................................................... 25
     4.2 SPI-4 to SPI-3 datapath and flow control .......................................................................................................................................................... 30
     4.3 SPI-3 ingress to SPI-3 egress datapath ............................................................................................................................................................ 33
     4.4 Microprocessor interface to SPI-3 datapath ...................................................................................................................................................... 34
          4.4.1 SPI-3 to ingress microprocessor interface datapath ................................................................................................................................ 34
          4.4.2 Microprocessor insert to SPI-3 egress datapath ..................................................................................................................................... 35
          4.4.3 Microprocessor interface to SPI-4 egress datapath ................................................................................................................................ 36
          4.4.4 SPI-4 ingress to microprocessor interface datapath ................................................................................................................................ 37
5. Performance monitor and diagnostics ................................................................................................................................................................. 38
     5.1 Mode of operation ............................................................................................................................................................................................ 38
     5.2 Counters ......................................................................................................................................................................................................... 38
          5.2.1 LID associated event counters ............................................................................................................................................................... 38
          5.2.2 Non - LID associated event counters ..................................................................................................................................................... 38
     5.3 Captured events .............................................................................................................................................................................................. 38
          5.3.1 Non LID associated events .................................................................................................................................................................... 38
          5.3.2 LID associated events ........................................................................................................................................................................... 38
                5.3.2.1 Non critical events ...................................................................................................................................................................... 38
                5.3.2.2 Critical events ............................................................................................................................................................................. 38
          5.3.3 Timebase .............................................................................................................................................................................................. 38
                5.3.3.1 Internally generated timebase ..................................................................................................................................................... 38
                5.3.3.2 Externally generated timebase .................................................................................................................................................... 38
6. Clock generator ...................................................................................................................................................................................................... 39
7. Loopbacks .............................................................................................................................................................................................................. 40
     7.1 SPI-3 Loopback ............................................................................................................................................................................................... 40
8. Operation guide ..................................................................................................................................................................................................... 41
     8.1 Hardware operation ........................................................................................................................................................................................ 41
          8.1.1 System reset ......................................................................................................................................................................................... 41
          8.1.2 Power on sequence .............................................................................................................................................................................. 41
          8.1.3 Clock domains ...................................................................................................................................................................................... 41
     8.2 Software operation ........................................................................................................................................................................................... 41
          8.2.1 Chip configuration sequence ................................................................................................................................................................. 41
          8.2.2 Logical Port activation and deactivation .................................................................................................................................................. 42
          8.2.3 Buffer segment modification .................................................................................................................................................................... 42
          8.2.4 Manual SPI-4 ingress LVDS bit alignment .............................................................................................................................................. 42
          8.2.5 SPI-4 status channel software ............................................................................................................................................................... 43
          8.2.6 IDT88P8342 layout guidelines .............................................................................................................................................................. 43
          8.2.7 Software Eye-Opening Check on SPI-4 Interface .................................................................................................................................. 44
9. Register description .............................................................................................................................................................................................. 46
     9.1 Register access summary ................................................................................................................................................................................ 46
          9.1.1 Direct register format ............................................................................................................................................................................. 46
          9.1.2 Indirect register format ........................................................................................................................................................................... 46
     9.2 Direct access registers ..................................................................................................................................................................................... 50
                                                                                                              2                                                                                         APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                                                                     INDUSTRIAL TEMPERATURE RANGE
                                            Table of Contents (Continued)
     9.3 Indirect registers for SPI-3A and SPI-3B modules ............................................................................................................................................. 56
           9.3.1 Block base 0x0000 registers ................................................................................................................................................................. 57
           9.3.2 Block base 0x0200 registers ................................................................................................................................................................. 57
           9.3.3 Block base 0x0500 registers ................................................................................................................................................................. 58
           9.3.4 Block base 0x0700 registers ................................................................................................................................................................. 59
           9.3.5 Block base 0x0A00 registers ................................................................................................................................................................. 61
           9.3.6 Block base 0x0C00 registers ................................................................................................................................................................. 61
           9.3.7 Block base 0x0100 registers ................................................................................................................................................................. 64
           9.3.8 Block base 0x1100 registers .................................................................................................................................................................. 64
           9.3.9 Block base 0x1200 registers ................................................................................................................................................................. 64
           9.3.10 Block base 0x1300 registers ............................................................................................................................................................... 65
           9.3.11 Block base 0x1600 registers ................................................................................................................................................................ 66
           9.3.12 Block base 0x1700 registers ............................................................................................................................................................... 66
           9.3.13 Block base 0x1800 registers ............................................................................................................................................................... 66
           9.3.14 Block base 0x1900 registers ............................................................................................................................................................... 67
     9.4 Common module indirect registers (Module_base 0x8000) ............................................................................................................................... 68
           9.4.1 Common module block base 0x0000 registers ....................................................................................................................................... 69
           9.4.2 Common module block base 0x0100 registers ....................................................................................................................................... 69
           9.4.3 Common module block base 0x0200 registers ....................................................................................................................................... 69
           9.4.4 Common module block base 0x0300 registers ....................................................................................................................................... 69
           9.4.5 Common module block base 0x0400 registers ....................................................................................................................................... 72
           9.4.6 Common module block base 0x0500 registers ....................................................................................................................................... 72
           9.4.7 Common module block base 0x0600 registers ....................................................................................................................................... 73
           9.4.8 Common module block base 0x0700 registers ....................................................................................................................................... 73
           9.4.9 Common module block base 0x0800 registers ....................................................................................................................................... 75
10. JTAG interface ....................................................................................................................................................................................................... 79
11. Electrical and Thermal Specifications ................................................................................................................................................................ 79
     11.1 Absolute maximum ratings ............................................................................................................................................................................... 79
     11.2 Recommended Operating Conditions .............................................................................................................................................................. 79
     11.3 Terminal Capacitance ..................................................................................................................................................................................... 80
     11.4 Thermal Characteristics .................................................................................................................................................................................. 80
     11.5 DC Electrical characteristics ............................................................................................................................................................................ 81
     11.6 AC characteristics ........................................................................................................................................................................................... 82
           11.6.1 SPI-3 I/O timing ................................................................................................................................................................................... 82
           11.6.2 SPI-4 LVDS Input / Output ................................................................................................................................................................... 83
           11.6.3 SPI-4 LVTTL Status AC characteristics ................................................................................................................................................. 84
           11.6.4 REF_CLK clock input .......................................................................................................................................................................... 84
           11.6.5 MCLK internal clock and OCLK[3:0] clock outputs ................................................................................................................................ 84
           11.6.6 Microprocessor interface ..................................................................................................................................................................... 84
                11.6.6.1 Microprocessor parallel port AC timing specifications .................................................................................................................. 85
                11.6.6.2 Serial microprocessor interface (serial peripheral interface mode) .............................................................................................. 89
12. Mechanical characteristics .................................................................................................................................................................................. 90
     12.1 Device overview ........................................................................................................................................................................................... 90
     12.2 Pin name/ball location table ............................................................................................................................................................................ 91
     12.3 Device package ............................................................................................................................................................................................. 94
13. Glossary ................................................................................................................................................................................................................ 96
14. Datasheet Document Revision History .............................................................................................................................................................. 97
15. Ordering information ........................................................................................................................................................................................... 98
                                                                                                           3                                                                                          APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                                                              INDUSTRIAL TEMPERATURE RANGE
                                                                       List of Figures
Figure 1. Typical application: optical port and two NPUs ................................................................................................................................................... 8
Figure 2. Data Path Diagram ........................................................................................................................................................................................... 8
Figure 3. Link mode SPI-3 ingress interface ................................................................................................................................................................... 14
Figure 4. PHY mode SPI-3 ingress interface .................................................................................................................................................................. 14
Figure 5. Link mode SPI-3 egress interface .................................................................................................................................................................... 16
Figure 6. PHY mode SPI-3 egress interface ................................................................................................................................................................... 16
Figure 7. Data sampling diagram ................................................................................................................................................................................... 18
Figure 8. SPI-4 ingress state diagram ............................................................................................................................................................................ 19
Figure 9. SPI-4 egress status state diagram ................................................................................................................................................................... 21
Figure 10. Interrupt scheme ........................................................................................................................................................................................... 22
Figure 11. Definition of data flows ................................................................................................................................................................................... 23
Figure 12. Logical view of datapath configuration using PFPs ......................................................................................................................................... 24
Figure 13. SPI-3 ingress to SPI-4 egress packet fragment processor ............................................................................................................................. 25
Figure 14. SPI-3 ingress LP to LID map ........................................................................................................................................................................ 27
Figure 15. SPI-4 egress LID to LP map ......................................................................................................................................................................... 28
Figure 16. SPI-3 ingress to SPI-4 egress datapath ........................................................................................................................................................ 28
Figure 17. SPI-3 ingress to SPI-4 egress flow control path ............................................................................................................................................. 29
Figure 18. SPI-4 ingress to SPI-3 egress packet fragment processor ............................................................................................................................. 30
Figure 19. SPI-4 ingress to SPI-3 egress datapath ........................................................................................................................................................ 31
Figure 20. SPI-4 ingress to SPI-3 egress flow control ..................................................................................................................................................... 32
Figure 21. SPI-3 ingress to SPI-3 egress datapath ........................................................................................................................................................ 33
Figure 22 . Microprocessor data capture buffer .............................................................................................................................................................. 34
Figure 23. SPI-3 ingress to microprocessor capture interface datapath ........................................................................................................................... 34
Figure 24 . Microprocessor data insert buffer ................................................................................................................................................................. 35
Figure 25. Microprocessor interface to SPI-3 egress detailed datapath diagram .............................................................................................................. 35
Figure 26. Microprocessor data insert buffer .................................................................................................................................................................. 36
Figure 27. Microprocessor data insert interface to SPI-4 egress datapath ....................................................................................................................... 36
Figure 28. Microprocessor data capture buffer ............................................................................................................................................................... 37
Figure 29. SPI-4 ingress to microprocessor data capture interface path .......................................................................................................................... 37
Figure 30. Clock generator ............................................................................................................................................................................................ 39
Figure 31. SPI-3 Loopback diagram .............................................................................................................................................................................. 40
Figure 32. Power-on-Reset Sequence .......................................................................................................................................................................... 41
Figure 33. DDR interface and eye opening check through over sampling ....................................................................................................................... 44
Figure 34. Direct & indirect access ................................................................................................................................................................................. 46
Figure 35. SPI-3 I/O timing diagram ............................................................................................................................................................................... 82
Figure 36. SPI-4 I/O timing diagram ............................................................................................................................................................................... 83
Figure 37. Microprocessor parallel port Motorola read timing diagram ............................................................................................................................ 85
Figure 38. Microprocessor parallel port Motorola write timing diagram ............................................................................................................................ 86
Figure 39. Microprocessor parallel port Intel mode read timing diagram .......................................................................................................................... 87
Figure 40. Microprocessor parallel port Intel mode write timing diagram .......................................................................................................................... 88
Figure 41. Microprocessor serial peripheral interface timing diagram .............................................................................................................................. 89
Figure 42. IDT88P8342 820PBGA package, bottom view .............................................................................................................................................. 94
Figure 43. IDT88P8342 820PBGA package, top and side views .................................................................................................................................... 95
                                                                                                      4                                                                                         APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                                                                    INDUSTRIAL TEMPERATURE RANGE
                                                                              List of Tables
Table 1 – I/O types .......................................................................................................................................................................................................... 9
Table 2 – SPI-3 ingress interface pin definition .................................................................................................................................................................. 9
Table 3 – SPI-3 egress interface pin definition ................................................................................................................................................................ 10
Table 4 – SPI-3 status interface pin definition .................................................................................................................................................................. 10
Table 5 – SPI-4 ingress interface definition ..................................................................................................................................................................... 11
Table 6 – SPI-4 egress interface definition ...................................................................................................................................................................... 11
Table 7 – Parallel microprocessor interface .................................................................................................................................................................... 12
Table 8 – Serial microprocessor interface (serial peripheral interface mode) ................................................................................................................... 12
Table 9 – Miscellaneous ................................................................................................................................................................................................ 12
Table 10 – Both attached devices start from reset status .................................................................................................................................................. 20
Table 11 – Ingress out of synch, egress in synch ........................................................................................................................................................... 20
Table 12 – Ingress in synch, egress out of synch ........................................................................................................................................................... 20
Table 13 - DIRECTION code assignment ...................................................................................................................................................................... 26
Table 14 – CK_SEL[3:0] input pin encoding ................................................................................................................................................................... 39
Table 15 - Zero margin SPI-3 timing budget ................................................................................................................................................................... 43
Table 16 - Margin check for SPI-3 timing ........................................................................................................................................................................ 43
Table 17 - Bit order within an 8-Bit data register ............................................................................................................................................................. 46
Table 18 - Bit order within a 32-Bit data register ............................................................................................................................................................. 46
Table 19 - Bit order within an 8-Bit data register ............................................................................................................................................................. 46
Table 20 - Bit order within a 16-Bit address register ....................................................................................................................................................... 47
Table 21 - Bit order within an 8-Bit control register .......................................................................................................................................................... 47
Table 22 - Module base address (Module_base) ........................................................................................................................................................... 47
Table 23 - Indirect access block bases for Module A and Module B ................................................................................................................................. 47
Table 24 - Indirect access block bases for common module ............................................................................................................................................ 48
Table 25 - Indirect access data registers (direct accessed space) at 0x30 to 0x33 .......................................................................................................... 48
Table 26 - Indirect access address register (direct accessed space) at 0x34 to 0x35 ...................................................................................................... 48
Table 27 - Indirect access control register (direct accessed space) at 0x3F ..................................................................................................................... 48
Table 28 - Error coding table ......................................................................................................................................................................................... 49
Table 29 - Direct mapped Module A and Module B registers .......................................................................................................................................... 50
Table 30 - Direct mapped other registers ....................................................................................................................................................................... 50
Table 31 - SPI-3 data capture control register (registers 0x00 and 0x08) ....................................................................................................................... 50
Table 32 - SPI-3 data capture register (registers 0x01 and 0x09) .................................................................................................................................. 50
Table 33 - SPI-4 data insert control register (registers 0x02 and 0x0A) .......................................................................................................................... 51
Table 34 - SPI-4 data insert register (registers 0x03 and 0x0B) ..................................................................................................................................... 51
Table 35 - SPI-4 data capture control registers (registers 0x04 and 0x0C) ..................................................................................................................... 51
Table 36 - SPI-3 data insert control register (registers 0x05 and 0x0D) .......................................................................................................................... 51
Table 37 - SPI-4 data capture register (registers 0x06 and 0x0E) .................................................................................................................................. 51
Table 38 - SPI-3 data insert register (registers 0x07 and 0x0F) ..................................................................................................................................... 51
Table 39 - Software reset register (0x20 in the direct accessed space) ........................................................................................................................... 52
Table 40 - SPI-4 status register (0x22 in the direct accessed space) ............................................................................................................................... 52
Table 41 - SPI-4 enable register (0x23 in the direct accessed space) ............................................................................................................................. 52
Table 42 - Module status register (0x24 and 0x25 in the direct accessed space) ............................................................................................................ 53
Table 43 - Module enable register (0x28 and 0x29 in the direct accessed space) .......................................................................................................... 53
Table 44 - Primary interrupt status register (0x2C in the direct accessed space) ............................................................................................................. 54
Table 45 - Secondary interrupt status register (0x2D in the direct accessed space) ........................................................................................................ 54
Table 46 - Primary interrupt enable register (0x2E in the direct accessed space) ............................................................................................................ 55
Table 47 - Secondary interrupt enable register (0x2F in the direct accessed space) ....................................................................................................... 55
Table 48 - Module A/B indirect register ........................................................................................................................................................................... 56
Table 49 - SPI-3 ingress LP to LID map ......................................................................................................................................................................... 57
Table 50 - SPI-3 general configuration register (register_offset=0x00) ............................................................................................................................ 57
Table 51 - SPI-3 ingress configuration register (register_offset=0x01) ............................................................................................................................. 58
Table 52 - SPI-3 ingress fill level register (register_offset=0x02) ..................................................................................................................................... 58
Table 53 - SPI-3 ingress max fill level register (register_offset=0x03) .............................................................................................................................. 58
Table 54 - SPI-3 egress LID to LP map ......................................................................................................................................................................... 58
Table 55 - SPI-3 egress configuration register (register_offset=0x00) ............................................................................................................................. 59
Table 56 - SPI-4 ingress to SPI-3 egress flow control register (register_offset=0x01) ...................................................................................................... 59
                                                                                                          5                                                                                          APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                                                          INDUSTRIAL TEMPERATURE RANGE
                                             List of Tables (Continued)
Table 57 - SPI-3 egress test register (register_offset=0x02) ............................................................................................................................................ 59
Table 58 - SPI-3 egress fill level register (register_offset=0x03) ...................................................................................................................................... 60
Table 59 - SPI-3 egress max fill level register (register_offset=0x04) .............................................................................................................................. 60
Table 60 - LID associated event counters (0x000-0x17F) .............................................................................................................................................. 61
Table 61 - Non LID associated event counters (0x00 - 0x0B) ........................................................................................................................................ 61
Table 62 - Non LID associated interrupt indication register (register_offset 0x0c) ............................................................................................................. 62
Table 63 - Non LID associated interrupt enable register(register_offset 0x0D) ................................................................................................................ 62
Table 64 - LID associated interrupt indication register (register_offset 0x0E) .................................................................................................................... 62
Table 65 - LID associated interrupt enable register (register_offset 0x0F) ....................................................................................................................... 62
Table 66 - Non critical LID associated capture table (register_offset 0x10-0x15) ............................................................................................................. 63
Table 67 - SPI-3 to SPI-4 critical LID interrupt indication registers (register_offset 0x16-0x17) ......................................................................................... 63
Table 68 - SPI-3 to SPI-4 critical LID interrupt enable registers (register_offset 0x18-0x19) ............................................................................................ 63
Table 69 - SPI-4 to SPI-3 critical LID interrupt indication registers (register_offset 0x1A-0x1B) ........................................................................................ 63
Table 70 - SPI-4 to SPI-3 critical LID interrupt enable registers (register_offset 0x1C-0x1D) ........................................................................................... 63
Table 71 - Critical events source indication register (register_offset 0x1E) ....................................................................................................................... 63
Table 72 - SPI-3 ingress packet length configuration register .......................................................................................................................................... 64
Table 73 - SPI-4 egress port descriptor table (64 entries) ............................................................................................................................................... 64
Table 74 - SPI-4 egress DIRECTION code assignment ................................................................................................................................................. 64
Table 75 - SPI-3 ingress port descriptor table (Block_base 0x1200) ............................................................................................................................... 64
Table 76 - SPI-3 to SPI-4 PFP register (register_offset 0x00) ......................................................................................................................................... 65
Table 77 - NR_LID field encoding .................................................................................................................................................................................. 65
Table 78 - SPI-3 to SPI-4 flow control register (register_offset 0x01) ............................................................................................................................... 65
Table 79 - SPI-4 ingress packet length configuration (64 entries configurable) ................................................................................................................ 66
Table 80 - SPI-3 egress port descriptor table (64 entries) .............................................................................................................................................. 66
Table 81 - SPI-3 egress DIRECTION code assignment ................................................................................................................................................. 66
Table 82 - SPI-4 ingress port descriptor tables (64 entries) ............................................................................................................................................ 66
Table 83 - SPI-4 to SPI-3 PFP register (0x00) ............................................................................................................................................................... 67
Table 84 - NR_LID field encoding .................................................................................................................................................................................. 67
Table 85 -Common Module (Module_base 0x8000) indirect register table ...................................................................................................................... 68
Table 86 - SPI-4 ingress LP to LID map (256 entries, one per LP) ................................................................................................................................. 69
Table 87 - SPI-4 ingress calendar_0 (256 entries) ......................................................................................................................................................... 69
Table 88 - SPI-4 ingress calendar_1 (256 entries) ......................................................................................................................................................... 69
Table 89 - SPI-4 ingress configuration register (0x00) .................................................................................................................................................... 69
Table 90 - SPI-4 ingress status configuration register (register_offset 0x01) .................................................................................................................... 70
Table 91 - SPI-4 ingress status register (register_offset 0x02) ........................................................................................................................................ 70
Table 92 - SPI-4 ingress inactive transfer port (register_offset 0x03) ............................................................................................................................... 70
Table 93 - SPI-4 ingress calendar configuration register (0x04 to 0x05) ......................................................................................................................... 71
Table 94 – SPI-4 ingress watermark register (register_offset 0x06) ............................................................................................................................... 71
Table 95 - SPI-4 ingress fill level register (0x07 to 0x08) ............................................................................................................................................... 71
Table 96 - SPI-4 ingress max fill level register (0x0B and 0x0C) ................................................................................................................................... 71
Table 97 - SPI-4 ingress diagnostics register (register_offset 0x0F) ................................................................................................................................ 71
Table 98 - SPI-4 ingress DIP-4 error counter (register_offset 0x10) .............................................................................................................................. 72
Table 99 - SPI-4 ingress bit alignment control register (register_offset 0x11) ................................................................................................................... 72
Table 100 - SPI-4 ingress start up training threshold register (register_offset 0x12) ........................................................................................................ 72
Table 101 - SPI-4 egress LID to LP map (128 entries) ................................................................................................................................................... 72
Table 102 - SPI-4 egress calendar_0 (256 locations) .................................................................................................................................................... 72
Table 103 - SPI-4 egress calendar_1 (256 locations) .................................................................................................................................................... 73
Table 104 – SPI-4 egress configuration register_0 (register_offset 0x00) ........................................................................................................................ 73
Table 105 - SPI-4 egress configuration register_1 (register_offset 0x01) ........................................................................................................................ 73
Table 106 - SPI-4 egress status register (register_offset 0x02) ....................................................................................................................................... 74
Table 107 - SPI-4 egress calendar configuration register (Register_offset 0x03 - 0x04) .................................................................................................. 74
Table 108 – SPI-4 egress diagnostics register (register_offset 0x05) .............................................................................................................................. 74
Table 109 - SPI-4 egress DIP-2 error counter (register_offset 0x06) ............................................................................................................................. 74
Table 110 - SPI-4 ingress bit alignment window register (register_offset 0x00) ................................................................................................................ 75
Table 111 - SPI-4 ingress lane measure register (register_offset 0x01) .......................................................................................................................... 75
                                                                                                  6                                                                                         APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                                                              INDUSTRIAL TEMPERATURE RANGE
                                              List of Tables (Continued)
Table 112 - SPI-4 ingress bit alignment counter register (0x02 to 0x0B) ......................................................................................................................... 75
Table 113 - SPI-4 ingress manual alignment phase/result register (0x0C to 0x1F) .......................................................................................................... 75
Table 114 - SPI-4 egress data lane timing register (register_offset 0x2A) ........................................................................................................................ 75
Table 115 - SPI-4 egress Control Lane Timing register (Register_offset 0x2B) ............................................................................................................... 76
Table 116 - SPI-4 egress data clock timing register (register_offset 0x2C) ....................................................................................................................... 76
Table 117 - SPI-4 egress status timing register (register_offset 0x2D) ............................................................................................................................ 76
Table 118 - SPI-4 egress status clock timing register (register_offset 0x2E) .................................................................................................................... 76
Table 119 - PMON timebase control register (register_offset 0x00) ................................................................................................................................. 77
Table 120 - Timebase register (register_offset 0x01) ...................................................................................................................................................... 77
Table 121 - Clock generator control register (register_offset 0x10) ................................................................................................................................. 77
Table 122 - OCLK and MCLK frequency select encoding ............................................................................................................................................... 77
Table 123 - GPIO register (register_offset 0x20) ............................................................................................................................................................ 78
Table 124 - GPIO monitor table (5 entries 0x21-0x25 for GPIO[0] through GPIO[4]) ....................................................................................................... 78
Table 125 - Version number register (register_offset 0x30) ............................................................................................................................................. 78
Table 126 – JTAG instructions ........................................................................................................................................................................................ 79
Table 127 – Absolute maximum ratings ........................................................................................................................................................................... 79
Table 128 – Recommended Operating Conditions .......................................................................................................................................................... 79
Table 129 – Terminal Capacitance ................................................................................................................................................................................. 80
Table 130 – Thermal Characteristics .............................................................................................................................................................................. 80
Table 131 – DC Electrical characteristics ........................................................................................................................................................................ 81
Table 132 – SPI-3 AC Input / Output timing specifications ................................................................................................................................................ 82
Table 133 – SPI-4.2 LVDS AC Input / Output timing specifications .................................................................................................................................... 84
Table 134 – SPI-4 LVTTL status AC Characteristics ....................................................................................................................................................... 84
Table 135 – REF_CLK clock input ................................................................................................................................................................................. 84
Table 136 – OCLK[3:0] clock outputs and MCLK internal clock ....................................................................................................................................... 84
Table 137 – Microprocessor interface ............................................................................................................................................................................ 84
Table 138 – Microprocessor parallel port Motorola read timing ....................................................................................................................................... 85
Table 139 – Microprocessor parallel port Motorola write timing ....................................................................................................................................... 86
Table 140 – Microprocessor parallel port Intel mode read timing ..................................................................................................................................... 87
Table 141 – Microprocessor parallel port Intel mode write timing ..................................................................................................................................... 88
Table 142 – Microprocessor serial peripheral interface timing ......................................................................................................................................... 89
                                                                                                    7                                                                                          APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                                INDUSTRIAL TEMPERATURE RANGE
 TYPICAL APPLICATION
 Exchange between optical ports and two NPU/Traffic Managers
                                                                                                       SPI-3                              Control
                    OC-48/                                                                                                NPU            Processor
                    4xOC-12/
                    16xOC-3            Multi-Rate         SPI-4       IDT88P8342
                                         SONET
                                         Framer                                                                                            PCI
                                                                                                       SPI-3
                                                                                                                          NPU
                                                                                                                                             6371 drw02
                                                Figure 1. Typical application: optical port and two NPUs
1. INTRODUCTION                                                                     In the SPI-3 ingress to SPI-4 egress path, data enter in fragments on the SPI-
   The IDT88P8342 device is a dual SPI-3 to single SPI-4 exchange                3 interface   and are received by the SPI-3 interface block. The fragments are
intended for use in optical line cards, Ethernet transport, and multi-service    mapped     to a SPI-4 address and stored in memory allocated at the SPI-3 level
switches. The SPI-3 and SPI-4 interfaces are defined by the Optical              until such  a time that the Packet Fragment Processor determines that they are to
Interworking Forum.                                                              be transmitted    on the SPI-4 interface. The data is transferred in bursts, in line with
   The device can be used as a rate adapter, a switch, or an aggregation         the OIF   SPI-4  implementation       agreement, to the SPI-4 interface block, and are
device between network processor units, multi-gigabit framers and PHYs, and      transmitted    on the  SPI-4   interface.
switch fabric interface devices.                                                    In the SPI-4 ingress to SPI-3 egress path, data enter in bursts on the SPI-4
                                                                                 interface and are received by the SPI-4 interface block. The SPI-4 address is
DATA PATH OVERVIEW                                                               translated to a SPI-3 address, and the data contained in the bursts are stored
                                                                                 in memory allocated at the SPI-3 level until such a time that the Packet Fragment
   Figure 1. Data Path Diagram shows an overview of the data path through Processor determines that they are to be transmitted on the SPI-3 interface. The
the device.                                                                      data is transferred in packet fragments, in line with the OIF SPI-3 implementation
   In normal operation, there are two paths through the IDT88P8342 device: agreement, to the SPI-3 interface block, and are transmitted on the SPI-3
the dual SPI-3 ingress to SPI-4 egress path, and the SPI-4 ingress to dual SPI- interface.
3 egress path. SPI-3 and SPI-4 burst sizes are separately configurable.
                                                             SPI-3 ingress to SPI-4 egress
                                       SPI-3
                                                       I/F      Memory
                                                                                                                   SPI-4
                                                                                                       I/F
                                       SPI-3
                                                       I/F      Memory
                                                                                                        6371 drw03
                                                             SPI-4 ingress to SPI-3 egress
                                                                      Figure 2. Data Path Diagram
                                                                                8                                                                     APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                             INDUSTRIAL TEMPERATURE RANGE
2. PIN DESCRIPTION                                                                    configurable for either Link or PHY mode. This configuration holds for both the
                                                                                      ingress and egress paths. The device pin is given a generic name, and
SPI-3 (two instantiations)
                                                                                      mapped to the standard pin name according to the mode of the interface (Link
   For the SPI-3 interfaces, each pin is used differently depending whether the
                                                                                      or PHY).
SPI-3 is in Link mode or in PHY mode. Each of the SPI-3 interfaces is separately
TABLE 1 – I/O TYPES
    I/O type                               Function
    I_ST             Input with Schmitt trigger with weak pull up
    I-PU            Input with weak pull up
    B-PU             Bidirectional I/O with weak pull up
    I_PD             Input with pull down
    I                Input
    O                Output
    O-Z              Output with tri-state
    OD               Output with open drain
TABLE 2 – SPI-3 INGRESS INTERFACE PIN DEFINITION
  Generic Name          Specific Name           I/O type          Description                             Mode
                                                                                                Link                 PHY
   I_FCLK           SPI3A_I_FCLK                   I-ST     Ingress SPI-3 write clock        RFCLK               TFCLK
                     SPI3B_I_FCLK                 LVTTL
   RVAL              SPI3A_I_RVAL                  B-PU     Receive data valid               RVAL (I)            RVAL (O)
                     SPI3B_I_RVAL                 LVTTL
   I_ENB             SPI3A_I_ENB                   B-PU     Ingress read enable              RENB (O)            TENB (I)
                     SPI3B_I_ENB                  LVTTL
   I_DAT[31:0]       SPI3A_I_DAT[31:0]             I-PU     Ingress data bus                 RDAT [31:0]         TDAT [31:0]
                     SPI3B_I_DAT[31:0]            LVTTL
   I_MOD[1:0]        SPI3A_I_MOD[1:0]              I-PU     Ingress word modulus             RMOD [1:0]          TMOD [1:0]
                     SPI3B_I_MOD[1:0]             LVTTL
   I_PRTY           SPI3A_I_PRTY                   I-PU     Ingress parity                   RPRTY               TPRTY
                     SPI3B_I_PRTY                 LVTTL
   I_SOP             SPI3A_I_SOP                   I-PU     Ingress start of packet          RSOP                TSOP
                     SPI3B_I_SOP                  LVTTL
   I_EOP             SPI3A_I_EOP                   I-PU     Ingress end of packet            REOP                TEOP
                     SPI3B_I_EOP                  LVTTL
   I_ERR            SPI3A_I_ERR                    I-PU     Ingress EOP error                RERR                TERR
                     SPI3B_I_ERR                  LVTTL
   I_SX              SPI3A_I_SX                    I-PU     Ingress start of transfer        RSX                 TSX
                     SPI3B_I_SX                   LVTTL
                                                                                  9                                                              APRIL 10, 2006


IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                  INDUSTRIAL TEMPERATURE RANGE
TABLE 3 – SPI-3 EGRESS INTERFACE PIN DEFINITION
Generic Name    Specific Name     I/O type       Description                     Mode
                                                                          Link            PHY
  E_FCLK      SPI3A_E_FCLK           I-ST  Egress SPI-3 write clock     TFCLK          RFCLK
              SPI3B_E_FCLK         LVTTL
  E_ENB       SPI3A_E_ENB           B-PU   Egress read enable           TENB (O)       RENB (I)
              SPI3B_E_ENB          LVTTL
  E_DAT[31:0] SPI3A_E_DAT[31:0]      O-Z   Egress data bus              TDAT [31:0]    RDAT [31:0]
              SPI3B_E_DAT[31:0]    LVTTL
  E_MOD[1:0]  SPI3A_E_MOD[1:0]       O-Z   Egress word modulus          TMOD [1:0]     RMOD [1:0]
              SPI3B_E_MOD[1:0]     LVTTL
  E_PRTY      SPI3A_E_PRTY           O-Z   Egress parity                TPRTY          RPRTY
              SPI3B_E_PRTY         LVTTL
  E_SOP       SPI3A_E_SOP            O-Z   Egress start of packet       TSOP           RSOP
              SPI3B_E_SOP          LVTTL
  E_EOP       SPI3A_E_EOP            O-Z   Egress end of packet         TEOP           REOP
              SPI3B_E_EOP          LVTTL
  E_ERR       SPI3A_E_ERR            O-Z   Egress EOP error             TERR           RERR
              SPI3B_E_ERR          LVTTL
  E_SX        SPI3A_E_SX             O-Z   Egress start of transfer     TSX            RSX
              SPI3B_E_SX           LVTTL
TABLE 4 – SPI-3 STATUS INTERFACE PIN DEFINITION
Generic Name    Specific Name   I/O type               Description                     Mode
                                                                                  Link       PHY
  DTPA[3:0]   SPI3A_DTPA[3:0]     B-PU Direct transmit packet available          DTPA (I) DTPA (O)
              SPI3B_DTPA[3:0]    LVTTL
  STPA        SPI3A_STPA          B-PU Selected-PHY transmit packet available    STPA (I) STPA (O)
              SPI3B_STPA         LVTTL
  PTPA        SPI3A_PTPA          B-PU Polled-PHY transmit packet available      PTPA (I) PTPA (O)
              SPI3B_PTPA         LVTTL
  ADR[7:0]    SPI3A_ADR[7:0]      B-PU Polled transmit PHY address               ADR (O) ADR (I)
              SPI3B_ADR[7:0]     LVTTL
                                                                 10                                          APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                                 INDUSTRIAL TEMPERATURE RANGE
SPI-4 (one instantiation)                                                                 in the Name column, and mapped to the OIF standard pin name according to
   For the SPI-4 interface, each pin is used differently depending whether the            the mode of operation of the interface (Link to PHY).
SPI-4 is in Link mode or in PHY mode. The pin is given a generic name, shown
TABLE 5 – SPI-4 INGRESS INTERFACE DEFINITION
   Generic Name           Specific Name             I/O type                Description                           Mode
                                                                                                            Link            PHY
   I_DCLK (P & N) SPI4_I_DCLK_P                      I LVDS      Ingress data clock                        RDCLK TDCLK
                       SPI4_I_DCLK_N
   I_DAT[15:0]         SPI4_I_DAT_P[15:0]            I LVDS      Ingress data bus                          RDAT          TDAT
  (P & N)              SPI4_I_DAT_N[15:0]
   I_CRTL (P & N) SPI4_I_CTRL_P                      I LVDS      Ingress control word                      RCTL          TCTL
                       SPI4_I_CTRL_N
   I_SCLK_L            SPI4_I_SCLK_P                O LVDS Ingress status clock                            RSCLK         TSCLK
  (P & N)              SPI4_I_SCLK_N
   I_STAT_L[1:0] SPI4_I_STAT_P[1:0]                 O LVDS Ingress status info                             RSTAT         TSTAT
  (P & N)              SPI4_I_STAT_N[1:0]
   I_SCLK_T            SPI4_I_SCLK_T                O LVTTL Ingress status clock                           RSCLK         TSCLK
   I_STAT_T[1:0] SPI4_I_STAT_T[1:0]                 O LVTTL Ingress status info                            RSTAT         TSTAT
   BIAS                BIAS                           Analog Use an external 3K Ohm                        ----------    ----------
                                                                 1% resistor to VSS
   LVDS_STA            LVDS_STA                        I-PU      LVDS(high)/LVTTL (low) status             ----------    ----------
                                                                 selection (See note below)
NOTE:
1. A hardware reset or software reset must be performed after changing the level of this pin.
TABLE 6 – SPI-4 EGRESS INTERFACE DEFINITION
   Generic Name           Specific Name             I/O type                Description                       Mode
                                                                                                        Link             PHY
   E_DCLK (P & N) SPI4_E_DCLK_P                     O LVDS Egress data clock                        TDCLK           RDCLK
                       SPI4_E_DCLK_N
   E_DAT[15:0]         SPI4_E_DAT_P[15:0] O LVDS Egress data bus                                    TDAT[15:0] RDAT[15:0]
  (P & N)              SPI4_E_DAT_N[15:0]
   E_CRTL (P & N) SPI4_E_CTRL_P                     O LVDS Egress control word                      TCTL            RCTL
                       SPI4_E_CTRL_N
   E_SCLK_L            SPI4_E_SCLK_P                 I LVDS Egress status clock                     TSCLK           RSCLK
  (P & N)              SPI4_E_SCLK_N
   E_STAT_L[1:0] SPI4_E_STAT_P[1:0] I LVDS Egress status info                                       TSTAT[1:0] RSTAT[1:0]
  (P & N)              SPI4_E_STAT_N[1:0]
   E_SCLK_T            SPI4_E_SCLK_T              I-ST LVTTL Egress status clock                    TSCLK           RSCLK
   E_STAT_T[1:0] SPI4_E_STAT_T[1:0] I-PU LVTTL Egress status info                                   TSTAT           RSTAT[1:0]
                                                                                      11                                                         APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                              INDUSTRIAL TEMPERATURE RANGE
Parallel microprocessor Interface
   The Parallel microprocessor interface is configurable to work in Intel or Motorola modes. Be sure to connect SPI_EN to a logic low when
using the parallel microprocessor interface mode.
TABLE 7 – PARALLEL MICROPROCESSOR INTERFACE
      Name               I/O type                                                        Description
   MPM                 I-PU CMOS Microprocessor mode: 0=Motorola Mode, 1=Intel mode (sampled after reset)
   CSB                 I-ST CMOS Chip select; active low
   RDB                 I-ST CMOS RDB: Read control, active low (in Intel mode), or
                                        DSB: Data strobe, active low (in Motorola mode)
   WRB                 I-ST CMOS WRB: Write control; active low; (in Intel mode), or
                                        R/WB: Read/write control; when high, read is active; when low, write is active; (in Motorola mode)
   ADD[5:0]            I-PU CMOS Address bus
   DBUS[7:0]           B-PU CMOS Data bus
   INTB                 OD CMOS Interrupt, active low, open drain
   SPI_EN              I-PU CMOS Logic low selects parallel microprocessor interface (internally pulled up, sampled after reset)
TABLE 8 – SERIAL MICROPROCESSOR INTERFACE (SERIAL PERIPHERAL INTERFACE MODE)
   Four Pins Multiplexed with Parallel microprocessor Pins. Be sure to connect SPI_EN to a logic high when using the serial microprocessor
interface mode.
   Name              I/O type Parallel microprocessor                          Serial Peripheral Interface Pin Use Description
                                            pin used
   SDI             I-ST CMOS                   WRB                 Serial data in, rise edge sampling
   SDO            B-PU CMOS                 DBUS[0]                Serial data out, falling edge driving
   CSB             I-ST CMOS                   CSB                 Chip select, active low. SDO is tri-stated when CSB is high
   SCLK            I-ST CMOS                   RDB                 Input clock
   INTB             OD CMOS                  ----------            Interrupt, active low, open drain
   SPI_EN          I-PU CMOS                 ----------            Dedicated input. High selects SPI microprocessor interface (internally pulled up)
TABLE 9 – MISCELLANEOUS
       Name              I/O type                                                        Description
   REF_CLK             I-ST CMOS         Master clock input
   OCLK[3:0]             O LVTTL         Clock outputs that can be used for SPI-3, phase-shifted to avoid simultaneously switching outputs
   CLK_SEL[3:0]        I-PU CMOS         Clock select inputs for internal PLL, internal MCLK, and OCLK[3:0] outputs
   TIMEBASE            B-PU CMOS         Timeout signal for counters
   GPIO[4:0]           B-PU CMOS         General purpose I/O or internal state monitor pins
   TDI                 I-PU CMOS         JTAG data in (internally pulled up)
   TDO                  O-Z CMOS         JTAG data out
   TCK                 I-ST CMOS         JTAG clock
   TMS                 I-PU CMOS         JTAG mode (internally pulled up)
   TRSTB               I-PU CMOS         JTAG reset, active low (internally pulled up). Pull down for normal operation.
   RESETB              I-PD CMOS         Master hardware reset, active low
NOTE:
1. Inputs with internal pull-ups do not need external pull-ups unless connected to PCB trace (except TRSTB).
                                                                                        12                                                         APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                                  INDUSTRIAL TEMPERATURE RANGE
3. EXTERNAL INTERFACES                                                                  Maximum packet length
    The external interfaces provided on the IDT88P8342 device are two SPI-                  - Packets longer than the maximum length will be optionally counted in the
3 interfaces, one SPI-4 interface, a serial or parallel microprocessor interface,       long packet counter.
a JTAG interface, and a set of GPIO pins. Each of the interfaces is defined in the          - Range 0 – 16,383 in 1 byte increments
relevant standard.
    The following information contains a set of the highlights of the features          Backpressure threshold
supported from the relevant standards, and a description of additional features             - Number of free segments allocated below which backpressure will be
implemented to enhance the usability of these interfaces for the system                 triggered for the LP
architect.
                                                                                        SPI-3 ingress interface
3.1 SPI-3                                                                                   Multiple independent data streams can be transmitted over the physical SPI-
    Refer to OIF SPI-3 document (see 13.Glossary for a reference) for full details      3 port. Each of those data streams is identified by a SPI-3 logical port ( LP ). Data
of the implementation agreement.                                                        from a transfer on a SPI-3 logical port and the associated descriptor fields are
    - Two instantiations of SPI-3 interface; each interface independently               synchronized to the configurable internal buffer segment pool.
configurable
    - Device supports a 8-bit and 32-bit data bus structure.                            Normal operation
    - Clock rate is minimum 19.44 to maximum 133 MHz                                        Refer to [13. Glossary] for details about the SPI-3 interface.
    - Link, single port PHY, and single device multi port PHY modes supported              •  A SPI-3 interface ( a physical port ) is enabled by the SPI-3_ENABLE flag
    - Byte level and packet level transfer control mechanisms supported                       in the SPI-3 configuration register. A disabled interface tri-states all output
       • Four DTPA signals supported, mapped to LP addresses 0 – 3, for STPA                  pins and does not respond to any input signals.
           in byte-level mode                                                              • The interface is configured in PHY or Link layer mode by the LINK flag
       • Eight ADR signals supported for PTPA in packet-level mode                            in the SPI-3 general configuration register.
    - Address range 0 to 255 with support for 64 simultaneously active logical ports       • The interface supports a SPI-3 logical port number range [0..255], note that
    - Fragment length (section) configurable from 16 to 256 bytes in 16 byte                  at most 64 logical ports can be configured.
     multiples                                                                             • The SPI-3 interface supports data transport over either a 32 bit data
    - Configurable standard and non-standard bit ordering                                     interface or over one single 8 bit interface (data[7:0] ) only. The selection
                                                                                              is defined by the BUSWIDTH flag in the SPI-3 general configuration register.
SPI-3 implementation features                                                              • The SPI-3 interface is configured in byte mode or packet mode by the
    The following are implemented per SPI-3 interface, and there are two                      PACKET flag in the SPI-3 general configuration register.
instantiations per device.                                                                 • The SPI-3 interface supports over-clocking.
    - Link / PHY layer device                                                              • Parity checking over data[31:0] is enabled by the PARITY_EN flag in the
    - Packet / byte level FIFO status information                                             Table 50, SPI-3 general configuration register (register_offset=0x00). The
    - Physical port enable                                                                    parity type is defined by the EVEN_PARITY flag. Parity check results over
    - Width of data bus (32 bit or 8 bit)                                                     the in-band port address and the data of a transfer are forwarded towards
    - Parity selection (odd or even)                                                          the packet fragment processor.
    - Enable parity check                                                                  • SPI Exchange supports zero clock interval spacing between transfers.
3.1.1 SPI-3 ingress                                                                     SPI-3 ingress interface errors
    The following are implemented per SPI-3 interface, and there are 4                      Given an I_FCLK within specification, the SPI-3 will not dead lock due to any
instantiations per device.                                                              combination or sequence on the SPI-3 interface. The SPI Exchange detects for
    - SPI-3 LP to Link Identifier (LID) map                                             incorrect SOP / EOP sequences on a logical port. The following sequences are
    - 256 entries, one per SPI-3 LP address                                             detected:
    - LP enable control                                                                     Successive SOP ( SOP- SOP sequence rather than SOP –EOP –SOP-EOP )
    - Only 64 of these entries are to be in the active state simultaneously                 Successive EOP ( EOP- EOP sequence rather than SOP –EOP –SOP-EOP )
                                                                                            Detection of an illegal sequence results in the generation of an SPI-3 illegal
Backpressure enable                                                                     SOP sequence event or SPI-3 illegal EOP sequence even generated. The
    - Link mode only                                                                    event is associated to the physical port. The event is directed towards the PMON
    - Enables the assertion of the I_ENB when at least one active LID can not           & DIAG module.
accept data                                                                                 A clock available process detects a positive I_FCLK within a 64 MCLK clock
    - If not enabled, the I_ENB signal will never be asserted in Link mode, possibly    cycle period. The result of this process is reported in the I_FCLK_AV flag in the
leading to fragments being discarded.                                                   Table 52 SPI-3 ingress fill level register (Block_base 0x0200 + Register_offset
                                                                                        0x02).
Minimum packet length                                                                       A status change from the clock available status to the clock not available status
    - Packets shorter than the minimum length will be optionally counted in the         generates a maskable SPI-3 ingress clock unavailable interrupt indication,
short packet counter.                                                                   SPI3_ICLK_UN, in Table 62-Non LID associated interrupt indication register
    - Range 0 – 255 in 1 byte increments                                                (Block_Base 0x0C00 + Register_offset 0x0C).
                                                                                     13                                                                 APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                                 INDUSTRIAL TEMPERATURE RANGE
SPI-3 ingress Link mode                                                                       active LID can not accept data. This feature is enabled by the
   Refer to [Glossary] for details about the SPI-3 interface.                                 BACKPRESSURE_EN flag in the SPI-3 ingress configuration register
  •  The PHY pushes data into the device in blocks from 1 up to 256 bytes.               (register_offset = 0x01). When the flag is cleared the I_ENB signal will not be
  • The SPI Exchange provides backpressure for the SPI-3 ingress physical                asserted, hence no backpressure can be generated.
     interface by the I_ENB signal. The I_ENB is asserted when at least one
                                                                                      I_ERR
                                                                                      I_Data[31:0]
                                                                                      I_PRTY
                                                                                      RVAL
                                                    PHY                               I_SOP
                                                                                                          IDT88P8342
                                                                                      I_EOP
                                                                                                         (LINK MODE)
                                                                                      I_RSX
                                                                                      I_MOD[1:0]
                                                                                      I_ENB
                                                                                                                                   6370 drw25
                                                                                    I_FCLK
                                                         Figure 3. Link mode SPI-3 ingress interface
SPI-3 ingress PHY mode
   The SPI Exchange indicates to the Link layer it has buffer space available              •  In packet mode the device responds to polling (by Link layer device)
by proper response to either Link layer polling (packet mode ) or direct indication        •  In byte mode the direct status indication is limited to 4 addresses (fixed ports
on DTPA signals (byte mode). The selection is made by the PACKET flag in                      [3:0])
the SPI-3 configuration register.
                                                                                     DTPA[3:0]
                                                                                                          byte mode
                                                                                     STPA
                                                                                     PTPA                 packet mode
                                                                                     ADDR[7:0]
                                                                                     I_ERR
                                                                                     I_Data[31:0]
                                                                                     I_PRTY
                                                                                                        IDT88P8342
                                                    LINK
                                                                                                       (PHY MODE)
                                                                                     I_SOP
                                                                                     I_EOP
                                                                                     I_RSX
                                                                                     I_MOD[1:0]
                                                                                     I_ENB
                                                                                                                             6370 drw26
                                                                                    I_FCLK
                                                         Figure 4. PHY mode SPI-3 ingress interface
                                                                                    14                                                                    APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                           INDUSTRIAL TEMPERATURE RANGE
3.1.2 SPI-3 egress                                                                 SPI-3 egress interface configuration
     - All fragments will be of a programmable equal length with the exception       • SPI Exchange allows for a pause at least two cycles of E_FCLK between
of EOP fragment which may be shorter                                               successive transfers.
                                                                                     • SPI Exchange allows for over clocking for a higher clock frequency
LID to LP map                                                                      supported as opposed to the one defined by the SPI-3 implementation
   - 64 entries, one per LID, for each SPI-3 egress port                           agreement.
   - LP enable control                                                               • The Link mode is selected by the Link flag in the SPI-3 general configuration
                                                                                   register.
Multiple burst enable                                                                • The interface operates in PACKET mode or BYTE mode as defined by
   - Allows more than one burst to be sent to an LP.                               the PACKET flag in the SPI-3 general configuration register.
                                                                                     • SPI Exchange generates even or odd parity over E_DATA[7/31:0] on
Poll length                                                                        the E_PRTY signal as defined by the EVEN flag in the Table 50, SPI-3 general
   - For use when in Link mode and when using the packet level mode                configuration register (register_offset=0x00).
   - Causes polling of the PHY for the logical ports associated to LIDs ranging      • SPI Exchange optionally generates two dummy cycles after assertion of
from [0 up to POLL_LENGTH] to find logical ports that can accept data              the STX signal. The option is enabled by the STX_SPACING flag in the Table
   - Range is 0-63                                                                 50, SPI-3 general configuration register (register_offset=0x00).
                                                                                     • SPI Exchange optionally generates two dummy cycles after assertion of
Loopback enable                                                                    an EOP signal. The option is enabled by the EOP_SPACING flag in the Table
   - Enables loopback from SPI-3 physical interface to same SPI-3 physical         50, SPI-3 general configuration register (register_offset=0x00).
interface for test purposes
                                                                                   SPI-3 egress interface errors
Data memory egress control                                                           A clock available process detects an E_FCLK cycle within a 64 MCLK clock
   The SPI-3 egress port descriptor table (block_base 0x1700) for both paths       cycle period. The result of this process is reported in the E_FCLK_AV flag in
out of the data memory. The function of the SPI-3 egress port descriptor table     Table 58, SPI-3 egress Fill Level Register (Block_base 0x0700 +
(block_base 0x1700) is to define where data goes after exiting the main data       Register_offset=0x03).
memory. There are four options configurable:                                         A status change from the clock available status to the clock not available status
   - SPI-3                                                                         generates a maskable SPI-3 egress clock unavailable interrupt indication,
   - SPI-4                                                                         SPI3_ECLK_UN, in Table 62-Non LID associated interrupt indication register
   - Capture                                                                       (Block_Base 0x0C00 + Register_offset 0x0C).
   - Discard
Maximum number of memory segments
   - Defines the largest BUFFER available to a LP / LID
   - Each segment is 256 bytes
   - Range 1 – 508 in increments of one segment
                                                                                15                                                               APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                                         INDUSTRIAL TEMPERATURE RANGE
SPI-3 egress Link mode                                                                         can accept data. The POLL_LENGTH field is defined in the SPI-3 egress
   The SPI Exchange receives status information from the PHY. The PHY                          configuration register.
indicates its ability to receive data. Status information for all logical ports is directed          • In byte mode the SPI Exchange allows for direct status detection.
towards the packet fragment processor.                                                               This status information is directly forwarded to the packet fragment proces-
   Status information is received from the PHY.                                                sor if enabled by the BURST_EN flag. When the BURST_EN flag is cleared
     • In packet mode, the SPI Exchange polls the PHY for the logical ports                    the only one packet fragment per LP is allowed into the SPI-3 egress buffers.
associated to LIDs ranging from 0 up to POLL_LENGTH to find logical ports that
                                                                                           DTPA[3:0]
                                                                                                                 byte mode
                                                                                           STPA
                                                                                           PTPA                  packet mode
                                                                                           ADDR[7:0]
                                                                                           E_ERR
                                                                                           E_Data[31:0]
                                                                                           E_PRTY
                                                                                                               IDT88P8342
                                                     PHY
                                                                                                             (LINK MODE)
                                                                                           E_SOP
                                                                                           E_EOP
                                                                                           E_RSX
                                                                                           E_MOD[1:0]
                                                                                           E_ENB
                                                                                                                                     6370 drw38
                                                                                          E_FCLK
                                                                Figure 5. Link mode SPI-3 egress interface
SPI-3 egress PHY mode
   In PHY mode, the SPI Exchange sends data to the attached Link-mode device
as long as the E_ENB signal is asserted. The SPI-3 packet fragment processor
transfers data to the SPI-3 egress buffers.
                                                                                           E_ERR
                                                                                           E_Data[31:0]
                                                                                           E_PRTY
                                                                                           RVAL
                                                                                           E_SOP
                                                   LINK                                    E_EOP
                                                                                                               IDT88P8342
                                                                                           E_RSX              (PHY MODE)
                                                                                           E_MOD[1:0]
                                                                                           E_ENB
                                                                                                                                       6370 drw39
                                                                                          E_FCLK
                                                                Figure 6. PHY mode SPI-3 egress interface
                                                                                            16                                                                APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                          INDUSTRIAL TEMPERATURE RANGE
3.2 SPI-4                                                                          SPI-4 ingress configurable parameters
   Refer to OIF SPI-4 document (see Glossary) for full details of the implemen-    SPI-4 LID map
tation agreement.                                                                     - 256 entries, one per SPI-4 LP
   - Clock rate is 80 - 400 MHz (160 - 800MHz DDR)                                    - SPI-3 physical interface identifier
   - Link and PHY modes supported                                                     - Physical port enable
   - Address range 0 to 255 with support for 128 simultaneously active logical
     ports                                                                         Word / bit synchronization
   - MAXBURST parameters configurable 16-256 bytes in 16 byte multiples               - LVDS clock data alignment and LVDS data de-skew
   - 256 entry calendar
   - LVTTL and LVDS status signals supported                                       Minimum packet length
   The following are implemented for the SPI-4 interface:                             - Packets shorter than the minimum length will be optionally counted in the
   - Link / PHY layer device                                                       short packet counter.
   - Physical port active                                                             - Range 0 – 255 in 1 byte increments
3.2.1 SPI-4 ingress                                                                Maximum packet length
   The SPI-4 ingress includes                                                         - Packets longer than the maximum length will be optionally counted in the
   • Bit alignment                                                                 long packet counter.
   • Word alignment/ de-skew                                                          - Range 0 – 16,383 in 1 byte increments
   • Transfer decode and dispatch
   • PFP interface                                                                 Free segment backpressure threshold
   • Status frame generation                                                          - Number of free buffer segments allocated to trigger backpressure for the LP
                                                                                17                                                              APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                           INDUSTRIAL TEMPERATURE RANGE
Data sampling                                                                        rate. The current samples c(n) and the previously generated samples provide
   The I_LOW field in the Table 89 SPI-4 ingress configuration register              samples for the eye computation. The optimized sampling point will be selected
(Block_base 0x0300 + Register_offset 0x00) selects an operating mode                 based on the eye computation. The tap selector is updated if necessary at the
between 80 MHz and 200 MHz or between 200 MHz and 400 MHz.                           end of the eye pattern measurement interval. The tap selector moves no more
   Each lane is over-sampled by a factor of five. The over-sampled data is           than one tap at a time as a result of the eye pattern measurement.
generated by a locked tapped delay line and clocked in to a register at the clock
                                  d0        d1       d2       d3          d4       d5        d6        d7       d8          d9
                           CLK
                             Data
                                            FF       FF       FF          FF       FF        FF        FF       FF          FF      FF
                             CLK          D0                D2        D3         D4        D5                                     D9
                                                   D1                                               D6        D7        D8
                                                                   R(t)
                                          D0       D1       D2        D3         D4        D5       D6        D7        D8        D9
                                                                      R(t+1)
                                                              Figure 7. Data sampling diagram
Eye measurement
   C[0]= Rt.D2^Rt.D3
   C[1]= Rt.D3^Rt.D4
   …..
   C[7]= Rt.D9^Rt+1.D0
   C[8]= Rt+1.D0^Rt+1.D1
   C[9]= Rt+1.D1^Rt+1.D2
   Accumulation results during a window defined by W are stored in the
diagnostics table.
   The latest result can be read out for diagnostic purposes.
Output tap selection
   The sampling tap is automatically selected based on the eye measurement.
                                                                                  18                                                            APRIL 10, 2006


IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                                     INDUSTRIAL TEMPERATURE RANGE
Manual phase selection                                                                         A number of consecutive error free DIP-4 ingress bursts will lead to a transition
   The automatic phase adjustment can be overruled by the processor when                   to the IN_SYNCH. The number is defined by the I_INSYNC_THR field in Table
the FORCE flag is set see Table 99, SPI-4 ingress bit alignment control register           89-SPI-4 ingress configuration register (Block_base 0x0300 + Register_offset
(register_offset 0x11). The PHASE_ASSIGN field see Table 113, SPI-4                        0x00).
ingress manual alignment phase/result register (0x0C to 0x1F) now defines the                  In the IN_SYNCH state, the PFP decodes the status transfer, check the DIP-
selected phase.                                                                            4, and dispatches the data.
                                                                                               A number of consecutive DIP-4 errors will lead to the OUT_OF_SYNCH
Word alignment                                                                             state. The number is defined by the I_OUTSYNC_THR field in Table 89-SPI-
   The de-skew block searches for the Training Control Word 0x0FFF. If the                 4 ingress configuration register (Block_base 0x0300 + Register_offset 0x00).
Training Control Word is found, then training data is expected to follow the                    A number of consecutive training patterns will lead to OUT_OF_SYNCH.
Training Control Word. The orthogonal training data will be used to align the              The number is defined by the STRT_TRAIN field in the Table 100 SPI-4 ingress
word.                                                                                      start up training threshold register (Block_base 0x0300 + Register_offset 0x12).
   A de-skew control bit (I_DSC in Table 89-SPI-4 ingress configuration register           This feature is disabled if STRT_TRAIN=0.
at Block_base 0x0300 + Register_offset 0x00) is used to protect against a
random data error during de-skew. If I_DSC=1, then two consecutive de-skew                 Control word and data
results are required. It is recommended to set I_DSC to a logic 1.                           A control word is distinguished by the SPI-4 RTCL signal. (logic one = control
   For diagnostics, an out of range offset between lines is provided. If the offset        word).
is more than two bits between the earliest and latest samples, I_DSK_OOR is
set to a logic one. I_DSK_OOR is cleared to a logic zero when the offset is in             DIP-4 check
range.                                                                                        For the DIP-4 check algorithm refer to the OIF SPI-4 document [Glossary].
                                                                                           In both IN_SYNCH and OUT_OF_SYNCH states, only control word previous
Transfer decode and dispatch                                                               and following data is checked. Any transition on synch status will be captured.
  In the OUT_OF_SYNCH state, the de-skew block will decode the transfer,                   In IN_SYNCH state, each DIP-4 error is captured and counted.
and check the DIP-4 for validation.
                                                                           OUT_OF_SYNCH
                                                               A                                                 B
                                                                                IN_SYNCH
                                     A= A number of consecutive DIP-4 error or reset or interface disabled
                                        or a number of consecutive training pattern received
                                     B= A number of consecutive DIP-4 error free
                                                                                                                                  6370 drw35
                                                              Figure 8. SPI-4 ingress state diagram
Transfer decode                                                                            generated. A SPI-4 inactive transfer event with it's associated LP will be captured
   The SPI-4 ingress control word contains various fields. Refer to the OIF SPI-           in the Table 40, SPI-4 status register (0x22 in the direct accessed space).
4 document [Glossary] for details. If reserved control word, BIT[15:12]=0011,
0001, 0101, or 0111 is detected, a BUS_ERROR event is generated. If a                      SPI-4 ingress status channel
payload control word is not followed by a data word, or a data word does not               Calendar structure and swapping
follow a payload control word, a BUS_ERROR event is generated. If abort is                    The SPI Exchange supports one or two sets of calendars. If I_CSW_EN field
detected, the next packet will be tagged with an error.                                    in the Table 89, SPI-4 ingress configuration register (0x00)=1, two sets of
                                                                                           calendars are supported. A calendar selection word must be placed following
Data dispatch                                                                              the framing bit. Refer to the OIF SPI-4 document [see Glossary] for more details.
    The port address field of a payload control word is extracted as a search key.
The search key is used to search the dispatch info in Table 86, SPI-4 ingress              SPI-4 ingress status channel frame generation
LP to LID map (256 entries, one per LP). If the searched port is active, transfer           The status frame can be one of the following cases:
data is sent to the associated PFP with SOP, EOP, LENGTH, PACKET_ERROR.                     • All ‘11’ when LVTTL is in the out of synch state
If the searched port is inactive, a SPI4_INACTIVE_TRANSFER event is                         • Training pattern when LVDS is in the out of synch state or in periodic training
                                                                                      19                                                                   APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                            INDUSTRIAL TEMPERATURE RANGE
    • Normal status information when in the IN_SYNCH state                           SPI-4 egress configurable parameters
    The normal status information is generated based on ingress buffer full             All parameters as listed in the 0IF SPI-4 document [see Glossary]
information and PFP buffer segment fill level.                                          CALENDAR_LEN: 4 to 1,024 in increments of 4
    For information on DIP-2 generation and training pattern refer to the OIF SPI-      CALENDAR_M: 1 to 256 in increments of 1
4 document [Glossary].                                                                  MaxBurst1 (MaxBurst_S): 16 to 256 in increments of 16
                                                                                        MaxBurst2 (MaxBurst_H): 16 to 256 in increments of 16
DIP-2 error insertion                                                                   Alpha: 1 to 256 in increments of 1
    A number of consecutive DIP-2 errors can be generated. The I_ DIP_E_NUM             DATA_MAX_T: 1 to 4,294,967,040 in increments of 1
field in Table 97, SPI-4 ingress diagnostics register (register_offset 0x0F)            FIFO_MAX_T: 1 to 16,777,215 in increments of 1
specifies the number of errors to be generated. A logic one written to
I_ERROR_INS will activate the I_DIP_E_NUM field and trigger error insertion.         Calendar and shadow calendar
The I_ERROR_INS field self clears when the number of errors have been                   - 256 entries
generated.                                                                              - E_CSW_EN field in Table 104, SPI-4 egress configuration register_0
                                                                                     (register_offset 0x00) bit for manual reconfiguration swap
LVTTL and LVDS status interface selection
    The LVDS_STA pin selects which FIFO status interface is being used for SPI-      Multiple burst enable
4. HIGH = LVDS status interface, LOW = LVTTL status interface.
                                                                                        - Allows more than one burst to be sent to an LP. Feature included to relieve
                                                                                     systems with long latency between updates.
3.2.2 SPI-4 egress
    The SPI-4 egress includes
    • Status channel synchronization
                                                                                     SPI-4 egress LID to LP map
    • Status updating
                                                                                        - 256 entries, one per SPI-4 LP
    • Data transfer
                                                                                        - Enable bit
    • Periodic training
    • PFP interface
3.2.3 SPI-4 startup handshake
TABLE 10 – BOTH ATTACHED DEVICES START FROM RESET STATUS
              Ingress                                    egress
   Out of synch, send status training      Out of synch, send data training
   In synch, send status frame             Out of synch, send data training
   In synch, send status frame             In synch, send data/idle
TABLE 11 – INGRESS OUT OF SYNCH, EGRESS IN SYNCH
              Ingress                                   Egress
   Out of synch, send status training      In synch, send data/idle
   Out of synch, send status training      Out of synch, send data training
   In synch, send status frame             Out of synch, send data training
   In synch, send status frame             In synch, send data/idle
TABLE 12 – INGRESS IN SYNCH, EGRESS OUT OF SYNCH
              Ingress                                   Egress
   In synch, send status frame             Out of synch, send data training
   Out of synch, send status training      Out of synch, send data training
   In synch, send status frame             Out of synch, send data training
   In synch, send status frame             In synch, send data/idle
                                                                                   20                                                            APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                               INDUSTRIAL TEMPERATURE RANGE
SPI-4 egress status channel                                                           Status channel de-skew
Status channel bit alignment                                                             The LVDS status channel deskew uses the same algorithm as the as the data
   The bit alignment algorithm for the status channel is the same as was described    channel.
for the data channel.
Status Channel Frame synchronization
                                                                          C
                                                                                                     A
                                                                                    Validate
                                                           HUNT                                             IN_SYNCH
                                                                           D
                                                                                     B
                                                 A= a number of consecutive error free DIP-2s received
                                                 B= a number of consecutive DIP-2 errors, in training,
                                                    port disabled, or reset
                                                                                                                         6370 drw30
                                                            Figure 9. SPI-4 egress status state diagram
   The status channel frame module has 3 states: HUNT, VALIDATE and                   LVTTL or LVDS status channel option
IN_SYNCH.                                                                                The LVDS_STA pin selects the interface type. A logic high enables the LVDS
   In the HUNT state, the status channel frame module searches for status             status interface. A logic low enables the LVTTL status interface.
frame, status clear and status freeze.
   In the VALIDATE state, the status channel frame module checks DIP-2.               Data channel
   In the IN_SYNCH state, the status channel frame module checks DIP-2, and           Data transfer and training
updates status.                                                                          At any cycle, the contents on the interface can be one of the following:
                                                                                         • Control word: Payload control word, or idle control word or training control
HUNT state                                                                                  word.
   • In the HUNT state, per Link status is fixed to ‘satisfied’.                         • Data word: Payload data word or training data word.
   • In HUNT state, the PFP searches frame continuously. It transitions to the
VALIDATE state if a single frame is found accompanied by a single valid training         In the HUNT or the VALIDATE state, the training pattern is sent.
pattern. A frame is considered to be found if : 1) only one frame word is at the         In the IN_SYNCH state, data from is taken from the buffer segments and
beginning of a frame, 2) the calendar selection word, if enabled, is matched, and     egressed to the SPI-4 interface. The switch between data burst, IDLE, and
3) the DIP-2 calculation matched the received DIP-2.                                  training must obey the following rules:
                                                                                         • Send IDLE if no data to transmit
VALIDATE state                                                                           • SOP must not occur less than 8 cycles apart.
   In the validate state, based on the frame found while in the HUNT state,              • periodic training after current transfer finished
the DIP-2 is checked.
   If a single DIP-2 error is found, transition to the HUNT state.                       Payload control word generation:
   After a number of consecutive DIP-2 calculations proves to be error free,             •  Bit 15, Control word type=1
transition to the IN_SYNCH state. The number is defined by the E_INSYNC_THR              •  Bit [14:13] EOPS per [see Glossary: SPI-4]. If an error tag is in the
field in Table 104-SPI-4 egress configuration register_0 (Block_base 0x0700                 descriptor, abort.
+ Register_offset 0x00).                                                                 • Bit [12] SOP refer to [see Glossary: SPI-4]
   In the validate state, the training pattern is not checked.                           • Eight Bit Address. Mapping table defined in Table 101, SPI-4 egress LID
                                                                                            to LP map (128 entries)
IN_SYNCH state                                                                           • DIP-4 bit refer to [see Glossary]
   In the IN_SYNCH state, training frame and status frame are checked.
   DIP-2 is checked for status frame. Each mismatched DIP-2 will generate a              Payload data word
DIP-2 error event, each event will be captured and counted.                              •  Bit order refer to [see Glossary: SPI-4]
   After a number of consecutive DIP-2 errors, transition to the HUNT state.             •  If only one byte is valid, 8 LSB (B7 to B0) is set to 0x00.
(Clear status in HUNT mode). The number is defined by the E_OUTSYNC_THR
field in Table 104-SPI-4 egress configuration register_0 (Block_base 0x0700           No status channel option
+ Register_offset 0x00).                                                                 Once the NOSTAT bit is set, the status channel is ignored. Refer to Table 104,
   The reception of twelve consecutive training patterns forces a transition to       SPI-4 egress configuration register_0 (register_offset 0x00).
HUNT mode. If less than twelve consecutive training patterns are received,               Status in default value.
synch will not be lost, and status frame starts at the end of training.                  No DIP error check.
   Twelve consecutive ‘11’ patterns force a transition to the HUNT state.                No status updating, the received status fixed to STARVING.
   Status updating occurs without waiting for the end of a status frame.                 Data channel works same as in IN_SYNCH state.
                                                                                   21                                                              APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                                INDUSTRIAL TEMPERATURE RANGE
3.3 Microprocessor interface                                                          (0x20)). The logical level on a pin is controlled by the LEVEL field in the GPIO
   - Parallel microprocessor interface                                                register if DIR_OUT=1, or sensed if DIR_OUT=0. The LEVEL bit monitors the
     • 8 bit data bus for parallel operation                                          logic level of any bit selected from the indirect access space if MONITOR_EN
     • Byte access                                                                    is set high. A bit in the indirect access space can be selected for monitoring by
     • Direct accessed space                                                          the by the ADDRESS and BIT fields in the GPIO Link table (Table 124, GPIO
     • Indirect access space is used for most registers                               Monitor Table (5 entries 0x21-0x25 for GPIO[0] through GPIO[4])).
     • Read operations to a reserved address or reserved bit fields return 0              All GPIO pins must be programmed into or out of monitor mode at the same
     • Write operations to reserved addresses or bit fields are ignored               time.
   - Serial microprocessor interface
     • Compliance to Motorola serial processor interface (SPI) specification          Interrupt scheme
     • Byte access                                                                        Events are captured in interrupt status registers. Interrupt status flags are
     • Direct accessed space                                                          cleared by an microprocessor write cycle. A logical one must be written to clear
     • Indirect access space is used for most registers                               the flag(s) targeted. A two level interrupt scheme is provided comprising a
     • Read operations to a reserved address or reserved bit fields return 0          primary level and a secondary level.
     • Write operations to reserved addresses or bit fields are ignored                   The primary level identifies the secondary interrupts sources with a pending
                                                                                      interrupt. This information is reflected in the primary interrupt register. Interrupt
General purpose I/O                                                                   status can be enabled by associated flags both in the primary and secondary
   Five general purpose I/O pins are provided. The direction is independently         level of the interrupt scheme.
controlled by the DIR_OUT field in the GPIO register (Table 123 GPIO Register
                                                              interrupted status
                                                                                                                                model status
                                                                                         |
                        event
                                                    interrupted status
                                   captured event                         &
                                                                                                                 &
                                                                                                                                                     INTB
                                                           enable                                   enable
                                                                                                                                           |
                                                                                                                                          6370 drw22
                            primary interrupt level                                       secondary interrupt level
                                                                      Figure 10. Interrupt scheme
                                                                                    22                                                                APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                            INDUSTRIAL TEMPERATURE RANGE
4. DATAPATH AND FLOW CONTROL                                                       Those logical flows are identified by logical port addresses on the physical port
   The following sections describe the datapaths through the device. The           and by a Link identification (LID) map in the core of the IDT88P8342.
datapaths shown are as follows:
   - SPI-3A <-> SPI-4                                                              DATA BUFFER ALLOCATION
   - SPI-3B <-> SPI-4                                                                 Flexibility has been provided to the user for data buffer allocation. The device
   - SPI-3A <-> SPI-3B                                                             has 128 KByte of on chip memory per SPI-3 port per direction – a total of 1MByte
   - SPI-3A <-> microprocessor interface                                           of on-chip data memory.
   - SPI-3B <-> microprocessor interface
   - SPI-4 <-> microprocessor interface                                               The 128 KByte SPI-3 buffers (four instantiations per device) are divided into
   Where <-> indicates a bidirectional data path.                                  256 byte segments. The segments are controlled by a packet fragment
                                                                                   processor. The user configures the maximum number of segments per LP to
   The IDT88P8342 supports two SPI-3 interfaces and a single SPI-4 interface.      allocate to a port and the number of segments allocated from the buffer segment
Both SPI-3 interfaces can operate independently in a PHY or Link mode. Refer       pool that will trigger the flow control mechanism. There is no limitation on the
to Figure 11, Definition of Data Flows for the main data flows in the device.      reallocation of freed segments among logical ports, as would be present if the
Independent logical data flows are transported over each of the physical ports.    memory had been allocated by a simple address mechanism.
                                                      from SPI-3                                    to SPI-4
                                                     SPI-3 ingress                                SPI-4 egress
                                                                                            SPI-3 extract
                                                               SPI-4 insert
                                                                              SPI-3-4 path
                           SPI-3A physical port                                                                              SPI-4
                                                                                                                             physical
                           SPI-3B physical port                               SPI-4-3 path                                      port
                                                                   SPI-4 extract                  SPI-3 insert
                                                        to SPI-3                                    from SPI-4
                                                     SPI-3 egress                                  SPI-4 ingress
                                                                                                                           6371 drwXA
                                                             Figure 11. Definition of data flows
                                                                                23                                                                 APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                                    INDUSTRIAL TEMPERATURE RANGE
DATAPATH CONFIGURATION                                                                   egress. Logical ports are mapped internally into Logical Identifiers (“LIDs”, “LID
   A logical view of datapath configuration using Packet Fragment Processors             Map”) for the control of each per-LID data flow to each physical port, logical port,
is shown in Figure 12, Logical View of Datapath Configuration Using PFPs.                memory queue size, and backpressure threshold (watermark), by program-
Two PFPs are associated with each SPI-3 port, one for ingress and one for                ming the LID register files.
                             SPI-3 INGRESS DATA                                                                              SPI-4 EGRESS DATA
                                                                              PFP AND MEMORY
                                                                               PFP AND MEMORY
                                                                           (ONEPFPOF AND
                                                                                 PFP
                                                                                         MEMORY
                                                                                     FOUR: ABCD)
                                                   [LP] = LID | EN | BRV     (ONE  OFAND  MEMORY
                                                                                      FOUR: ABCD)
                                                                              (ONE OF FOUR: ABCD)           [LID] = LP | EN
                   LID               EN   BRV                                                                                               LP                    EN
        256 LPs                                                                                                                                                           256 LIDs
     SPI-3 Ingress LP to LID Map                                                                                                   SPI-4 Egress LID to LP Map
                                                 [LID] = LP | EN | BRV     PFP AND MEMORY
                                                                             PFP AND MEMORY               [LP] = LID | PPE | EN
                                                                         (ONEPFPOF AND
                                                                               PFP
                                                                                       MEMORY
                                                                                   FOUR: ABCD)
                                                                          (ONE   OFAND  MEMORY
                                                                                    FOUR:  ABCD)                                            LID                A/B       EN
                 LP                EN   BRV                                 (ONE OF FOUR: ABCD)
                                                                                                                                                                             256 LPs
      64 LIDs
                                                                                                                                       SPI-4 Ingress LP to LID Map
  SPI-3 Egress LID to LP Map
                             SPI-3 EGRESS DATA                                                                                         SPI-4 INGRESS DATA
                                                                                                                                                                 6371 drwXB
                                                Figure 12. Logical view of datapath configuration using PFPs
LID - Logical Identifier
EN - LID enable flag
BRV - Bit reversal
LP - Logical port
PFP - Packet fragment processor
                                                                                      24                                                                      APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                                INDUSTRIAL TEMPERATURE RANGE
4.1 SPI-3 to SPI-4 datapath and flow control                                           to produce SPI-3 ingress FIFO status towards the attached device. Packets or
   Two packet fragment processor modules from SPI-3 to SPI-4 are provided.             packet fragments received on one SPI-3 ingress logical port can be forwarded
One packet fragment processor module is associated with one SPI-3 ingress              to any one of:
interface. Both packet fragment processor modules connect to a single SPI-4               A logical port on the egress SPI-4 interface.
interface.                                                                                A logical port on an associated SPI-3 interface (between physical port
   Packet fragments from the SPI-3 ingress are received into the SPI-3 ingress         interfaces A and B only).
port buffers. A packet fragment processor transfers complete packet fragments             The microprocessor interface, using the capture buffer.
from the SPI-3 ingress port buffers to memory segments previously reserved                The connection on the logical port level is performed through an intermediate
on a per-LP basis in the buffer segment pool. The SPI-3 ingress port buffer            mapping to a Link Identification number (LID).
watermark and the per-LP free buffer segment threshold information is combined
                                                                                                                 Associated
                                                                                                           uP
                                                                                                                 egress PFP
                                                 PMON & DIAG                                                                 SPI-3
                                                                                                capture                     redirect
                                                                                                 buffer                     buffers
                            uP
                            insert buffer                                                                                        SPI4 Egress
                           SPI3 Ingress
                                               SPI3 ingress port                                          SPI3 egress port         FIFO status
                                                    buffers                                                   buffers
                                          FIFO status                      buffer segment pool
                                                                                                                                 6370 drw27
                                             Figure 13. SPI-3 ingress to SPI-4 egress packet fragment processor
SPI-3 ingress PFP functions                                                            Normal operation
   The packet fragment processor(PFP) receives status information about the               In loopback mode, all of the SPI-3 ingress buffers of a physical SPI-3 port are
SPI-3 ingress buffers and the microprocessor insert buffer. The PFP processes          copied into the SP-3 egress buffers of that same port. This is a test mode only,
SPI-3 ingress buffers in high priority and the insert buffer with low priority. The    as no non-loopback traffic can be transferred at this time.
PFP copies data into the buffer segment , requests new buffer segments, and               In non – loop back mode (normal operation) the SPI-3 ingress buffers are
generates entries in the SPI4-egress queue.                                            forwarded to the LID process by the PFP.
                                                                                          The LID process generates a set of events for an associated LID. The events
SPI-3 ingress buffer processing                                                        that are directed towards the PMON&DIAG module are:
   The PFP verifies whether a SPI-3 ingress buffer is occupied. If the SPI-3              • SPI-3 error tagged packet event (errored packets)
ingress buffer is not occupied the PFP processes the insert buffer.                       • SPI-3 EOP event (all packets)
                                                                                          • SPI-3 fragment event (all fragments) with an associated length field
                                                                                    25                                                               APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                              INDUSTRIAL TEMPERATURE RANGE
Erroneous operation                                                                   needed to control latency. Modifications of the buffer size allocated to a LID are
    SPI-3 ingress buffers marked with an address parity error are always              supported only when the logical port associated to the LID is disabled. Attempts
immediately flushed. A SPI-3 flush event is generated.                                to allocate more memory than available will generate an allocation error event.
                                                                                      The indirect access module will discard the attempt.
Store process
    The process parameters are stored in a descriptor table. One entry in the         Free buffer segment pool
table is required for each of the SPI-3 logical ports. Refer to Table 49, SPI-3       Storage
ingress LP to LID Map.                                                                    The buffer segment pool is divided into 508 segments. The device holds a
    • Fragments tagged with an SOP indication trigger the buffer segment request      pool of free buffer segments. The buffer segment pool keeps track of the number
process. The internal Packet_length variable is initialized. The copy process         of segments assigned to each LID and holds a list of free segments.
is triggered.
    • Fragments tagged with an EOP indication will trigger the packet length check    Buffer segment requests
process and the queue process.                                                            A new segment for a logical Link (LID) can be requested from the buffer
    • Non marked (EOP or SOP) buffers are subject to the copy process.                segment pool for that SPI-3 ingress physical port by the SPI-3 ingress packet
                                                                                      fragment processor associated to that SPI-3 physical port. A request may be
Buffer segment request process                                                        accepted immediately or rejected. When the request is accepted a buffer
    A new buffer segment is requested for the logical port from the buffer segment    segment ID is returned immediately.
pool.
    The request can be accepted or rejected by the buffer pool.                       Buffer segment pool returned segments
    When accepted, the Current_Seg and current Seg_Length variables are                   A buffer segment can be returned to the buffer segment pool when the egress
updated.                                                                              module releases it. This allows the segment to be used once more by the SPI-
    When rejected, the SPI-3 ingress buffer is flushed. An SPI-3 flush event is       3 ingress.
generated and directed towards the Table 61, Non LID associated event
counters (0x00 - 0x0B). The buffer data is not copied into the SPI3-4 buffer.         SPI-4 egress queues
                                                                                      Normal operation
Copy process                                                                              508 SPI-4 egress queue entries are provided. They are evenly allocated
    Data is retrieved from the buffer and stored in the current segment. The data     to the number of logical ports as defined by the static NR_LID configuration. One
parity error status is stored in the Pack_Err variable. The Packet_Length             entry in the queue corresponds to a packet or a packet fragment to be forwarded
variables and Seg_Length variables are updated. The queue and request                 to the SPI-4 egress interface.
processes are triggered when the number of bytes in the buffer segment equals
the SPI-3 packet fragment size programmed for that physical interface, or an          SPI-3 ingress Backpressure
EOP is reached.                                                                           The module directs status signals for each of the 64 LIDs associated with a
                                                                                      SPI-3 physical interface towards the SPI-3 ingress interface. The status signals
Queue process                                                                         request to transfer more data on the logical port associated to the LID. The
    The current segment is entered into the SPI-4 egress queue.                       available status is defined by the function (if free segments [LID] > Threshold,
                                                                                      status =available).
Packet length check
    The length of the packet is compared to the MIN_LENGTH and MAX_LENGTH             SPI-4 egress direction control
parameters in the ingress SPI-3 Port descriptor table. If the packet length is less       The SPI-4 egress traffic can be captured by the microprocessor, directed to
than the programmed field MIN_LENGTH a “SPI-3 too short packet event” is              an associated SPI-3 egress port (SPI-3 port A to B, or port C to D, only), to the
generated. If the packet length is greater than the programmed field MAX_LENGTH       SPI-4 egress port, or discarded. The selection is defined for each of the 64 LIDs
a “SPI-3 too long packet event” is generated. The events are directed towards         by the associated DIRECTION field in the Table 13, Direction code assignment.
the Table 61, Non LID associated event counters (0x00 - 0x0B).
SPI-3 to SPI-4 buffer management                                                      TABLE 13 - DIRECTION CODE ASSIGNMENT
    A 128 KB SPI-3 to SPI-4 buffer segment pool is assigned to each physical               DIRECTION                               Path
SPI-3 ingress port. A configurable part of this buffer segment pool is assigned                 00               SPI-4
to buffers associated to each of the up to 64 LIDs. The buffer size for a LID can               01               Associated SPI-3
be configured in multiples (M) of 256 bytes. Fewer LIDs allow larger buffers per                10               Capture to microprocessor
LID, conversely a large number of LIDs will require smaller buffers per LID.                    11               Discard
Within this restriction, the buffer size of each LID can be further restricted as
                                                                                    26                                                              APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                                  INDUSTRIAL TEMPERATURE RANGE
SPI-4 egress data bursts                                                                 SPI-3 ingress logical port mapping
    The PFP produces fragments of up to N*16 bytes. N is defined by the                     Each of the two SPI-3 interfaces has an associated SPI-3 ingress LP to LID
MAX_BURST_H or MAX_BURST_S parameter associated with each LID. For                       map, (See Table 49) for the purpose of directing the packet fragments from its
a high priority (starving) LID the MAX_BURST_S parameter is used. For a low              SPI-3 ingress to its associated SPI-3 ingress main memory buffer segment pool.
priority (hungry) LID the MAX_BURST_H parameter is used. The PFP may                     The SPI-3 LID map has 256 entries, one per SPI-3 LP, but only 64 LPs are
not fill the buffers to the level granted when a new segment needs to be used            supported on any SPI-3 interface at any one time. Each SPI-3 interface has
in the SPI3-4 buffer memory or when the last fragment of a packet is copied into         an enable bit, as well as the ability to reverse the bit ordering of the interface.
the buffer. The information received over the FIFO status channel is interpreted         The packet fragment length is associated with a SPI-3 interface. The allowed
as status or credit information as selected by the CREDIT_EN flag in Table 78,           range is 0 to 255 bytes per packet fragment. The last fragment of a packet can
SPI-3 to SPI-4 flow control register (0x01). If the status mode is used, data will       be shorter than the programmed fragment size. Each SPI-3 port can be
be egressed until the status is changed. If the credit mode is used, the SPI-4           independently set for either Link or PHY mode of operation.
egress will issue only one credit’s worth data burst and then wait for another credit
from the status channel before issuing another LID burst.                                SPI-3 ingress LID associated control
                                                                                            Each LID on a SPI-3 interface has the ability to be programmed for minimum
SPI-4 egress FIFO status channel updates                                                 and maximum packet length. The minimum packet length can be set from 0 to
    The SPI-4 egress FIFO Status Channel Module continuously verifies the                255 bytes in one byte increments. The maximum packet length can be set from
status information for the LIDs associated to SPI-4 logical ports. The PFP               0 to 16,383 bytes in one byte increments. Each LID can be enabled and disabled
searches and selects a LID, fetches the associated information and queues data           independently.
to the SPI-4 egress. The obsolete buffer segment is returned to the free buffer
segment pool (unless the repeat test feature is enabled). Searching the LID to
be served is performed for both a high priority and a low priority LID. The priority
is defined by the status received from the SPI-4 egress module.
                                  [LP] = LID | EN | BRV
                                                                                   LID                      EN       BRV
                                                                                                                                256 LPs
                                   LID: Logical Identifier                                                                        6370 drwXC
                                   EN: LID Enable
                                   BRV: Bit Reversal
                                                              Figure 14. SPI-3 ingress LP to LID map
                                                                                      27                                                                APRIL 10, 2006


IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                                                INDUSTRIAL TEMPERATURE RANGE
SPI-4 egress interface port associated control                                              SPI-4 egress LID associated control
   The SPI-4 interface has an associated LID to LP map (See Table 101 - SPI-                   Each of the 256 entries in the SPI-4 egress LID to LP map (See Table 101
4 egress LID to LP Map Block_base 0x0400 = Register_offset 0x00 - 0xFF)                     - SPI-4 egress LID to LP Map (256 entries)) is used to control the pulling of bursts
for the purpose of directing the packet fragments from the selected SPI-3 ingress           out of the buffer segment pool and into the SPI-4 egress interface. Each LID can
main memory buffer segment pool to the SPI-4 egress interface. The SPI-4 LID                be enabled and disabled independently.
map has 256 entries, one per LID. The SPI-4 interface has an enable bit. The
burst length is associated with the SPI-4 interface. The allowed burst range is
16 to 256 bytes per burst. The last burst of a packet can be shorter than the
programmed burst size.
                                      [LID] = LP | EN
                                                                                       LP                            EN
                                                                                                                                         256 LIDs
                                    LP: Logical Port
                                    EN: LP Enable                                                                                         6370 drwXD
                                                                      Figure 15. SPI-4 egress LID to LP map
   The diagram below shows the datapath through the device from a SPI-3
ingress interface to the SPI-4 egress interface.
                                                                JTAG           uproc         Chip Counters Memory
                                                                                                                       Interface Block
                           2 x SPI-3
                                                                  LID Counters Memory
                          8 bit / 32 bit
                                                                                                               …                                 SPI-4.2
                                                    Interface Block
                         Min: 19.44MHz                                          Main                                                           Min: 80 MHz
                         Max: 133MHz                                                                                                           Max:400 MHz
                                                                               Memory
                                                                                 A
                                                                       …
                                                                               SPI-3 /                       SPI-4 /
                                                                               LID map                       LID map
                                                                                                                           6371 drw12
                                                         Figure 16. SPI-3 ingress to SPI-4 egress datapath
                                                                                        28                                                                   APRIL 10, 2006


IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                                                 INDUSTRIAL TEMPERATURE RANGE
SPI-3 ingress to SPI-4 egress flow control                                                  SPI-3 ingress flow control registers
    For control information there are two separate cases to consider: The case                 The following are implemented per SPI-3 interface, and there are two
that the SPI-3 physical interface port is configured in Link mode, and the case             instantiations per device.
that the SPI-3 is configured in PHY mode. Note that since the SPI-3 physical
interfaces are configured separately, the device is able to deal with the case that         Backpressure enable
some of the LP fragments have been received on a Link layer device SPI-3                       Link mode only
interface and some have been received on a PHY layer device SPI-3 interface.                   Enables the assertion of the I_ENB pin when at least one active LID can not
    For a device in Link mode the Link device can only control the flow of data             accept data
through the RENB signal. Two modes of operation are implemented and                            If not enabled, the I_ENB signal will never be asserted in Link mode, possibly
configurable for flow control on this interface – either the data can be allowed            leading to fragments being discarded.
to flow freely into the device or the RENB signal will be asserted if a condition
arises that one of the LPs is unable to receive another fragment. The first of these        SPI-4 egress flow control configurable parameters
modes is considered to have no Link layer device flow control, and the second                 All parameters as listed in SPI-4 implementation agreement:
has Link layer device flow control.                                                           CALENDAR_LEN: 4 to 1,024 in increments of 4
    For the no Link flow control mode, any data sent to an LP unable to receive               CALENDAR_M: 1 to 256 in increments of 1
another fragment will cause an LP overflow.                                                   MaxBurst1 (MaxBurst_S): 16 to 256 in increments of 16
    For a device in Link mode the Link has complete knowledge of the fill level               MaxBurst2 (MaxBurst_H): 16 to 256 in increments of 16
of the data buffers in each of the LPs in the PHY. This knowledge is attained either          Alpha: 1 to 256 in increments of 1
through byte level polling or packet level polling.                                           DATA_MAX_T: 1 to 4,294,967,040 in increments of 1
    Both in Link and PHY modes, the data is collected to buffer segments                      FIFO_MAX_T: 1 to 16,777,215 in increments of 1
associated with an LP. The SPI-4 PFP is updated with the number of free
segments available to the LP. The SPI-4 PFP determines which LP to service                  SPI-4 egress flow control calendar and shadow calendar
based on two factors: whether the LP contains enough data for a burst, and the                256 entries
starving / hungry / satisfied state of the LP. For details on the mapping of LPs
to LIDs, refer to Table 101 - SPI-4 egress LID to LP Map Block_base 0x0400                  SPI-4 egress flow control multiple burst enable
= Register_offset 0x00 - 0xFF.                                                                  Allows more than one burst to be sent to an LP. This feature was included
                                                                                            to increase throughput in systems with long latency between updates.
   The diagram below shows the SPI-3 ingress to SPI-4 egress flow control Path
through the IDT88P8342 device.
                                                                      JTAG        uproc          Chip Counters Memory
                                                                                                                         Interface Block
                                 2 x SPI-3                              LID Counters Memory                                                       STATUS
                                8 bit / 32 bit
                               Min: 19.44MHz
                                                                                                   STATUS
                                                                                                                  …                              SPI-4.2
                                                          Interface Block
                               Max: 133MHz
                                                                                   Main                                                        Min: 80 MHz
                                                                                                                                               Max:400 MHz
                                     STATUS                                       Memory
                                                                                    A
                        DATA PATH                                           …
                                                                                  SPI-3 /                       SPI-4 /
                                                                                  LID map                       LID map
                                                                                                                         6371 drw12a
                                                  Figure 17. SPI-3 ingress to SPI-4 egress flow control path
                                                                                       29                                                                    APRIL 10,4 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                             INDUSTRIAL TEMPERATURE RANGE
4.2 SPI-4 to SPI-3 datapath and flow control                                            If the number of free segments available to a LP exceeds the starving
   Two Packet Fragment Processor modules from SPI4 ingress to SPI-3 egress           threshold, the SPI-4 status is moved to starving for that LP. If the number of free
are provided, all connected to one SPI-4 ingress interface.                          segments available to a LP exceeds the hungry but not the starving threshold,
   Packet bursts from the SPI-4 ingress are received into the SPI-4 ingress port     the SPI-4 status is moved to hungry for that LP. If the hungry threshold is not
buffers. A packet fragment processor transfers complete packet bursts from the       exceeded, the SPI-4 FIFO status channel will indicate satisfied for that LP.
SPI-4 ingress port buffers to memory segments previously reserved on a per-
LP basis in the buffer segment pool. The SPI-4 ingress port buffer watermarks        SPI-4 ingress to SPI-3 egress datapath
and the per-LP free buffer segment threshold information is combined to produce         The following is a description of the path taken by a burst of data through the
SPI-4 ingress FIFO status (per-LP starving, hungry, or satisfied) towards the        device from the SPI-4 ingress to a SPI-3 egress.
attached SPI-4 device. Per-LP buffer segment threshold information is used to           Data enters on the SPI-4 ingress interface in bursts. Bursts are normally of
produce FIFO status information for the attached SPI-3 device. Packets or            equal length except the last burst of a packet which may be shorter. The control
packet fragments are forwarded to the SPI-3 interface when a packet is complete      word is in-band with the data. Burst data enters a SPI-4 ingress buffer. SPI-4
or a predefined number of bytes have been received. Packets or packet                LP address, error information, SOP, EOP are stored with the burst data. A SPI-
fragments received on one SPI4 logical port are cross connected to an SPI3           4 LP address is mapped to a Logical IDentifier (LID). The burst is stored in per
logical port through an intermediate mapping to a Link identification, or LID. Its   LID allocated buffer segments reserved from the buffer segment pool.
mode of operation is similar to the SPI-3 ingress to SPI-4 egress packet fragment       The appropriate SPI-3 egress control register (Table 80 - SPI-3 egress Port
processor, with the following differences:                                           Descriptor Table (64 entries)) is consulted, and it determines to send this LID
   1) The PFP4-3 data input has three sources, listed in descending priority:        to a prescribed SPI-3 egress port.
SPI-4 buffers, redirect buffers, and insert buffers.                                    The selection of which LP is to be transmitted next is dependent on the status
   2) The PFP3-4 data output has only three destinations. There is no SPI-3          of the LP and the availability of a complete fragment. Data is moved to the
to SPI-4 redirect path.                                                              appropriate SPI-3 egress buffer along with the LP address. SPI-3 LP address,
   Each SPI-3 interface feeds ingress buffer available or ingress buffer             error information, SOP, and EOP information is stored with the packet fragment.
unavailable status information to its packet fragment processor.                     Next, data is transmitted in packet fragments over the selected SPI-3 interface.
                                                                                                                           Associated
                                                                                                               uP         ingress PFP
                                               uP
                                                                                                                                        SPI-3
                                                      capture                                        insert
                                                                                                                                       redirect
                                                       buffer                                        buffer
                                                                                                                                       buffers
              SPI-3 Egress                                                                                                                SPI4 Ingress
                                        SPI-3 egress port                                                    SPI-4 ingress port
                                               buffers                                                              buffers
                                                                            buffer segment pool
                            FIFO Status                                                                                            FIFO Status
                                                                                                                                                6370 drw37
                                            Figure 18. SPI-4 ingress to SPI-3 egress packet fragment processor
                                                                                   30                                                                APRIL 10, 2006


IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                                              INDUSTRIAL TEMPERATURE RANGE
SPI-4 ingress interface configurable parameters:                                            SPI-3 egress per-LID configurable parameters
    The IDT88P8342 can interface to either a Link or a PHY layer device. The                   Many parameters to control the flow of data are programmable per LID. The
SPI-4 port can be enabled or disabled.                                                      following paragraphs describe these parameters.
    The SPI-4 ingress bits are aligned with the ingress clock. In addition, the SPI-
4 words are then aligned among each other to produce valid words. This is                   SPI-3 egress LID to LP map
performed both on the data channel and the status channel. The bit alignment                 one map per SPI-3 physical port
algorithm runs as long as the interface is active. The word alignment algorithm              64 entries per map, one per LID
is run during training intervals.                                                            LP enable bit per LP
                                                                                             Bit reversal enable per LP
SPI-4 ingress per-LID configurable parameters
SPI-4 to SPI-3 LID map                                                                      SPI-3 egress multiple burst enable
 256 entries, one per SPI-4 LP                                                                 Multiple Burst Enable allows more than one burst to be sent to an LP. This
 SPI-3 physical interface identifier                                                        feature is included to relieve systems with long latency between updates. When
 SPI-3 LID                                                                                  this feature is not enabled, only one burst per LP is allowed into the round robin
 Enable bit per LID                                                                         SPI-3 egress buffers at a time.
SPI-4 ingress packet length check                                                           SPI-4 ingress to SPI-3 egress data memory
   Each LID on the SPI-4 ingress interface has the ability to be programmed for             SPI-3 egress control
minimum and maximum packet length. The minimum packet length can be set                       There is a SPI-3 egress port descriptor table for the paths out of the data
from 0 to 255 bytes in one byte increments. The maximum packet length can                   memory. The function a SPI-3 egress port descriptor table is to define where
be set from 0 to 16,383 bytes in one byte increments. Packets shorter or longer             data goes after leaving the main data memory. There are three configurable
than set by these parameters will be optionally counted in the short or long packet         options:
counter for that LID.                                                                         SPI-3 egress
                                                                                              Microprocessor Interface Capture
SPI-3 egress configurable parameters                                                          Discard
Length of SPI-3 packet fragment
  All packet fragments from a particular SPI-3 physical interface are program-              Maximum number of memory segments
mable to an equal length with the possible exception of an EOP fragment which                  Defines the largest Buffer available to an LP / LID
may be shorter.                                                                                Each segment is 256 bytes
                                                                                               Range 1 – 508 in increments of one segment
SPI-3 egress poll length                                                                       The figure below shows the datapath through the device from the SPI-4
   Applies when the SPI-3 interface is acting as a Link layer device when using             interface to the SPI-3 interface.
the packet level polling mode
   Causes polling of the PHY for the logical ports associated with LIDs ranging
from [0 up to POLL_LENGTH] to find logical ports that can accept data
   Poll range is 0-63 LPs.
                                                                  JTAG        uproc          Chip Counters Memory
                                                                                                                      Interface Block
                             2 x SPI-3
                                                                    LID Counters Memory
                            8 bit / 32 bit
                                                                                                               …
                                                      Interface Block
                           Min: 19.44MHz                                       Main                                                         SPI-4.2
                           Max: 133MHz                                                                                                    Min: 80 MHz
                                                                              Memory                                                      Max:400 MHz
                                                                                A
                                                                        …
                                                                              SPI-3 /                       SPI-4 /
                                                                              LID map                       LID map
                                                                                                                         6371 drw13
                                                        Figure 19. SPI-4 ingress to SPI-3 egress datapath
                                                                                       31                                                                APRIL 10, 2006


IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                                            INDUSTRIAL TEMPERATURE RANGE
SPI-4 ingress to SPI-3 egress flow control                                               to PHY mode. Note that since the SPI-3 physical interfaces are configured
   The SPI-4 control information is transmitted to the adjacent device. The              separately, the IDT88P8342 device is able to deal with the case that some of
adjacent device determines which LP to service next according to the status              the LP fragments are to be transmitted on a Link SPI-3 interface and some are
information it receives from the IDT88P8342. The SPI-4 ingress data arrive in            to be transmitted on a PHY SPI-3 interface
bursts that are of equal length except for the last burst of a packet which may             When in PHY mode, the data is sent according the availability of the data in
be shorter.                                                                              the buffer segment pool. In the Link mode an extra consideration is taken to
   The SPI-4 burst data is transferred to the per LID allocated buffer segments.         account – that of the fill level of the ingress FIFOs in the adjacent device.
The addition of the data may cause an update of the SPI-4 status information
(starving, hungry, satisfied), and may change the SPI-3 STPA, DTPA, or PTPA              Backpressure threshold
signals when in PHY mode.                                                                  - Number of free segments allocated to trigger backpressure for the LP
   For the control information there are two separate cases to consider: the case          The diagram below shows the SPI-4 to SPI-3 flow control path through the
that the SPI-3 is configured to Link mode, and the case that the SPI-3 is configured     IDT88P8342 device.
                                                                    JTAG        uproc        Chip Counters Memory
                                                                                                                                         STATUS
                                                                                                                    Interface Block
                               2 x SPI-3
                                                                      LID Counters Memory
                                                                                             STATUS
                              8 bit / 32 bit
                                                                                                             …
                                                        Interface Block
                             Min: 19.44MHz                                       Main                                                      SPI-4.2
                             Max: 133MHz                                                                                                 Min: 80 MHz
                                                                                Memory                                                   Max:400 MHz
                                 STATUS                                           A
                                                                          …
                                                                                SPI-3 /                   SPI-4 /
                                                                                LID map                   LID map
                                                                                                                    6371 drw13a
                                                     Figure 20. SPI-4 ingress to SPI-3 egress flow control
                                                                                        32                                                             APRIL 10, 2006


IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                                            INDUSTRIAL TEMPERATURE RANGE
4.3 SPI-3 ingress to SPI-3 egress datapath                                                     The Table 80, SPI-3 egress port descriptor table (64 entries) is consulted,
   The SPI-3 redirect buffer can store SPI-3 packet fragments. The status of the            and the PFP decides to send a LID to the associated SPI-3 egress port. The
packet fragment buffers is forwarded to the associated packet fragment proces-              SPI-3 packet fragment processor chooses the next LP. The choice of LP is
sor. The purpose of the SPI-3 redirect is to enable per-LP flows between                    dependent on status of the LP and availability of a complete fragment. Data is
physical interfaces SPI-3 A and SPI-3 B. Other flows between SPI-3 ports are                moved to an egress buffer along with the SPI-3 LP address, error information,
not allowed; i.e., between A and A, and between B and B.                                    SOP, and EOP information. Data is transmitted in packet fragments over a SPI-
   The following is a description of the path taken by a fragment of data through           3 interface.
the device.                                                                                    The paths to and from the microprocessor interface can be used to perform
   A SPI-3 to SPI-3 path is between an LP on one SPI-3 to the paired SPI-3.                 mappings from a SPI-3 LP to a SPI-3 LP where not provided, and from a SPI-
Data enters on the SPI-3 interface in fragments. Fragments are of equal length              4 to a SPI-4 LP. However these paths are limited by the bandwidth of the
except the last fragment of a packet which may be shorter. The LP address is                microprocessor interface.
in-band with the data. The packet fragment enters an ingress buffer. SPI-3 LP                  The diagram below shows the datapath through the device from a SPI-3
address, error information, SOP, and EOP information is are stored with the                 interface to its paired SPI-3 interface. For the SPI-3 redirect, the LID connecting
fragment. The LP address is mapped to a LID. The fragment is stored in buffer               associated port pairs must be the same in both directions.
segment pool per-LID-allocated memory space.
                                                                   JTAG        uproc         Chip Counters Memory
                                                                     LID Counters Memory
                                      SPI-3
                                                       Interface Block
                                  8 bit / 32 bit
                                 Min: 19.44MHz
                                                                                Main
                                 Max: 133MHz                                   Memory
                                                                         …       A
                                                                                                                    Interface Block
                                                                                SPI-3 /
                                                                               LID map                                                  SPI-4.2
                                                                                                             …                        Min: 80 MHz
                                                                                                                                      Max: 400 MHz
                                                                     LID Counters Memory
                                                       Interface Block
                                                                                Main
                                      SPI-3
                                                                               Memory
                                  8 bit / 32 bit
                                 Min: 19.44MHz                           …       B
                                 Max: 133MHz                                   SPI-3 /                     SPI-4 /
                                                                               LID map                     LID map
                                                                                                                         6370 drw14
                                                     Figure 21. SPI-3 ingress to SPI-3 egress datapath
                                                                                       33                                                                 APRIL 10, 2006


IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                                                                                             INDUSTRIAL TEMPERATURE RANGE
4.4 Microprocessor interface to SPI-3 datapath                                                                   Read packet data fragment
capture/insert configurable parameters                                                                              The microprocessor needs to read a buffer to capture a packet fragment. It
   Enable insertion / capture of data to the SPI-3 or SPI-4 data stream (which                                   verifies the DATA_AVAILABLE flag in the SPI-3 capture control register.
is dependent on the egress control register). For each direction, the following                                  Microprocessor reads the packet fragment and EOP, SOP, ERROR, LID and
are to be used:                                                                                                  LENGTH fields from the SPI-3 data capture buffer. Microprocessor hands over
                                                                                                                 control of the capture buffer when it clears the DATA_AVAILABLE flag in the SPI-
  - Data for insertion or data captured                                                                          3 data capture control register (Table 31 - SPI-3 data capture control register).
  - Data available: set when data is available. Asserted by device for capture,
asserted by microprocessor for insertion.                                                                        4.4.1 SPI-3 to ingress microprocessor interface
  - LID: Logical Identifier of capture / insertion channel                                                       datapath
  - Length: length of data for insertion or capture                                                                 The diagram below shows the datapath through the device from the SPI-3
  - Flags: SOP, EOP, address parity error, data parity error, packet error                                       interface to the microprocessor capture interface.
                                                                                                                    The following is a description of the path taken by a fragment of data through
  There are separate instantiations of microprocessor insert capture buffers for                                 the device.
SPI-3 and SPI-4.                                                                                                    Data enters on a SPI-3 interface in fragments. Fragments are of equal length
                                                                                                                 except the last fragment of a packet which may be shorter. The LP address is
Capture data fragment                                                                                            in-band with the data. The fragment enters a SPI-3 ingress buffer. SPI-3 LP
   Packets can be captured from the SPI-3-4 stream and directed towards the                                      address, error information, SOP, and EOP are stored with the fragment. The LP
microprocessor. The capture buffer can store only one 256 byte packet                                            address is mapped to a LID. The fragment is stored in LID allocated buffer segments.
fragment. When the buffer is full the DATA_AVAILABLE flag is set and a SPI-                                         The Table 80, SPI-3 egress port descriptor table (64 entries) is consulted,
3 capture event is generated. The event is directed towards the interrupt                                        and the PFP decides to send this LID to the microprocessor capture port. Data
module.                                                                                                          is moved to the capture buffer along with the LP address. LID, error information,
                                                                                                                 SOP, and EOP. The data available bit is set. Data and control information are
                                                                                                                 read from the relevant register space through the microprocessor interface.
                                                             t+258                          data[255]                                            t+258   EA          address parity error
                                                                                                                                                         ED              packet error
                                       insert sequence                                                                extract sequence
                                                                                             data[2]
                                                                                                                                                         PAR         data parity error
                                                                                             data[1]
                                                                                             data[0]
                                                                                             length
                                                         t+1                                                                                 t+1
                                                                                                lid
                                                         t                                                                                   t
                                                                                               flags
                                                                     SOP                              EA   ED   PAR               EOP                                            not used
                                                                     7                                                                   0                                           6371 drw28
                                                                     Figure 22 . Microprocessor data capture buffer
                                                                                    JTAG          uproc              Chip Counters Memory
                                                                                                                                                               Interface Block
                                                                                      LID Counters Memory
                                                                                                                                                                                      SPI-4.2
                                                                                                                                                         …                          Min: 80 MHz
                                                                         Interface Block
                                    4 x SPI-3                                                      Main
                                   8 bit / 32 bit                                                                                                                                   Max: 400 MHz
                                  Min: 19.44MHz                                                   Memory
                                  Max: 133MHz
                                                                                           …        A
                                                                                                  SPI-3 /                                            SPI-4 /
                                                                                                  LID map                                            LID map
                                                                                                                                                                   6371 drw15
                                              Figure 23. SPI-3 ingress to microprocessor capture interface datapath
                                                                                                                34                                                                                     APRIL 10, 2006


IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                                                                                            INDUSTRIAL TEMPERATURE RANGE
4.4.2 Microprocessor insert to SPI-3 egress                                                                         Data is stored in LID-allocated buffer segments. The Table 80, SPI-3 egress
datapath                                                                                                            port descriptor table (64 entries) is consulted and the PFP decides to move the
    The diagram below shows the datapath through the device from the                                                data to the SPI-3 egress port. The SPI-3 packet fragment processor chooses
microprocessor data insert interface to a SPI-3 egress port.                                                        the next LP. The choice of LP is dependent on the status of the LP and the
    The following is a description of the path taken by a fragment of data through                                  availability of a complete fragment. Data is moved to a SPI-3 egress buffer along
the device.                                                                                                         with its LP address. SPI-3 LP address, error information, SOP, and EOP.
    Data and control information are written to the insert buffer through the                                          Data is transmitted in packet fragments over the selected SPI-3 egress
microprocessor interface. The data available bit is set. Data is stored along with                                  interface.
its LP address, LID (including SPI-3 choice), error information, SOP, and EOP.
                                                          t+258                             data[255]                                           t+258    EA    address parity error
                                                                                                                                                         ED    packet error
                                    insert sequence                                                                  extract sequence
                                                                                             data[2]
                                                                                                                                                         PAR   data parity error
                                                                                             data[1]
                                                                                             data[0]
                                                                                             length
                                                      t+1                                                                                   t+1
                                                                                               lid
                                                      t                                                                                     t
                                                                                              flags
                                                                  SOP                                EA   ED   PAR               EOP                                              not used
                                                                  7                                                                     0                                             6371 drw28
                                                                                    Figure 24 . Microprocessor data insert buffer
                                                                              JTAG               uproc               Chip Counters Memory
                                                                                                                                                                Interface Block
                            2 x SPI-3
                                                                                LID Counters Memory
                           8 bit / 32 bit
                                                                                                                                                         …
                                                                  Interface Block
                          Min: 19.44MHz                                                               Main                                                                                     SPI-4.2
                          Max: 133MHz                                                                                                                                                        Min: 80 MHz
                                                                                                     Memory                                                                                  Max:400 MHz
                                                                                                       A
                                                                                         …
                                                                                                     SPI-3 /                                            SPI-4 /
                                                                                                     LID map                                            LID map
                                                                                                                                                                    6371 drw16
                                    Figure 25. Microprocessor interface to SPI-3 egress detailed datapath diagram
                                                                                                               35                                                                                          APRIL 10, 2006


IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                                                                                              INDUSTRIAL TEMPERATURE RANGE
4.4.3 Microprocessor interface to SPI-4 egress                                                                         The microprocessor needs to write data into a dedicated buffer to insert a
datapath                                                                                                            packet burst. Refer to Figure 26, Microprocessor data insert buffer for the data
    Packets can be inserted into the SPI-3-4 datapath by the microprocessor. The                                    format in the buffer. The microprocessor must verify the DATA_AVAILABLE flag
following is a description of the path taken by a burst of data through the device.                                 in the SPI-4 insert control register and waits until the flag is cleared. The
    Data and control information are written to the insert buffer through the                                       microprocessor specifies the EOP, SOP, ERROR, LID and LENGTH fields and
microprocessor interface. The data available bit is set. Data is stored in the insert                               writes up to 256 bytes of packet fragment burst into the insert buffer. The packet
buffer along with the LP address, LID, error information, SOP, and EOP. Data                                        burst insert buffer is accessed through the Table 34, SPI-4 data insert register
is stored in per-LID allocated buffer segments. The Table 36-SPI-3 data insert                                      (register_offsets 0x03 and 0x0B) SPI-4 data insert register. The microproces-
control register is consulted, and determines to send this LID to the SPI-4 egress                                  sor hands over control of the buffer setting the DATA_AVAILABLE flag in the
port. The SPI-4 Packet Fragment Processor chooses the next LP. Data is sent                                         SPI-4 insert control register. A SPI4_insert_empty event is generated when
to the SPI-4 egress buffer along with the SPI-4 LP address, error information,                                      the DATA_AVAILABLE flag is cleared. The event is directed towards the
SOP, and EOP. Data is transmitted in bursts over the SPI-4 egress interface.                                        interrupt module.
                                                              t+258                             data[255]                                           t+258    EA    address parity error
                                                                                                                                                             ED    packet error
                                     insert sequence                                                                     extract sequence
                                                                                                 data[2]
                                                                                                                                                             PAR   data parity error
                                                                                                 data[1]
                                                                                                 data[0]
                                                                                                 length
                                                          t+1                                                                                   t+1
                                                                                                   lid
                                                          t                                                                                     t
                                                                                                  flags
                                                                      SOP                                EA   ED   PAR               EOP                                             not used
                                                                      7                                                                     0                                            6371 drw28
                                                                                        Figure 26. Microprocessor data insert buffer
  The diagram below shows the datapath through the device from the
microprocessor data insert interface to the SPI-4 egress interface.
                                                                                  JTAG               uproc              Chip Counters Memory
                                                                                                                                                                   Interface Block
                             2 x SPI-3
                                                                                    LID Counters Memory
                            8 bit / 32 bit
                                                                                                                                                             …
                                                                      Interface Block
                           Min: 19.44MHz                                                                  Main                                                                                    SPI-4.2
                           Max: 133MHz                                                                                                                                                          Min: 80 MHz
                                                                                                         Memory                                                                                 Max:400 MHz
                                                                                                           A
                                                                                             …
                                                                                                     SPI-3 /                                                SPI-4 /
                                                                                                     LID map                                                LID map
                                                                                                                                                                         6371 drw18
                                                       Figure 27. Microprocessor data insert interface to SPI-4 egress datapath
                                                                                                                   36                                                                                         APRIL 10, 2006


IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                                                                                    INDUSTRIAL TEMPERATURE RANGE
4.4.4 SPI-4 ingress to microprocessor interface                                                                  address, error information, SOP, and EOP are stored along with the burst data.
datapath                                                                                                         The SPI-4 LP address is mapped to a LID. Data is stored in per-LID allocated
    The diagram below shows the datapath through the device from the SPI-4                                       buffer segments. The DIRECTION field of the SPI-3 egress port descriptor
interface to the microprocessor data capture interface.                                                          (Block_base 0x1700 + Register_offset 0x00 - 0xFF) is used to send this LID
    The following is a description of the path taken by a burst of data through the                              data to the microprocessor port. Data is moved to the capture buffer along with
device.                                                                                                          the LP address, LID, error information, SOP, and EOP.
    Data enters on the SPI-4 interface in bursts. Bursts are normally of equal                                      The data available bit is set by the PFP. Data and control information are read
length except the last burst of a packet which may be shorter. The control word                                  from the capture buffer through the microprocessor interface.
is in-band with the data. The burst data enters a SPI-4 ingress buffer. SPI-4 LP
                                                             t+258                       data[255]                                           t+258   EA    address parity error
                                                                                                                                                     ED    packet error
                                     insert sequence                                                              extract sequence
                                                                                          data[2]
                                                                                                                                                     PAR   data parity error
                                                                                          data[1]
                                                                                          data[0]
                                                                                          length
                                                         t+1                                                                             t+1
                                                                                            lid
                                                         t                                                                               t
                                                                                           flags
                                                                     SOP                          EA   ED   PAR               EOP                                         not used
                                                                     7                                                               0                                        6371 drw28
                                                                            Figure 28. Microprocessor data capture buffer
                                                                                 JTAG             uproc            Chip Counters Memory
                                                                                                                                                            Interface Block
                             2 x SPI-3
                                                                                   LID Counters Memory
                            8 bit / 32 bit
                                                                                                                                                      …                                SPI-4.2
                                                                     Interface Block
                           Min: 19.44MHz                                                           Main                                                                              Min: 80 MHz
                           Max: 133MHz
                                                                                                  Memory                                                                             Max:400 MHz
                                                                                                    A
                                                                                       …
                                                                                                  SPI-3 /                                            SPI-4 /
                                                                                                  LID map                                            LID map
                                                                                                                                                           6371 drw17
                                                       Figure 29. SPI-4 ingress to microprocessor data capture interface path
                                                                                                            37                                                                                     APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                                        INDUSTRIAL TEMPERATURE RANGE
5. PERFORMANCE MONITOR AND                                                                  5.3.2.1 Non critical events
DIAGNOSTICS                                                                                    LID associated non critical events are captured in the Table 64, LID-
                                                                                            associated interrupt indication register(0x0E). An interrupt is generated if the
                                                                                            interrupt is enabled by its enable flag in the Table 65, LID-associated interrupt
5.1 Mode of operation                                                                       enable register(0x0F). The interrupt indication is cleared by writing a logical one
    A performance monitor & diagnostics module is available in modules A and                to the Table 64, LID-Associated Interrupt Indication Register(0x0E).
B. The performance monitor captures events and accumulates error events and                    When the event is captured, the LID or LP associated with the event is
diagnostics data. Some performance monitor accumulators are associated to a                 captured in Table 66, Non-Critical LID-Associated Capture Table (0x10-
physical port, some to a LID.                                                               0x15). The table records the latest captured LID or LP.
5.2 Counters                                                                                5.3.2.2 Critical events
    All events and diagnostics data are accumulated during an interval defined                 Critical events are captured per LID in Table 67, SPI-3 to SPI-4 Critical LID
by the timebase event. The data accumulated during the previous time period                 interrupt indication registers (Block_base 0x0C00 + Register_offset 0x16-
can be accessed by the indirect access scheme. The counters are cleared when                0x17) and Table 69, SPI-4 to SPI-3 critical LID interrupt indication registers
the timebase expires. All counters are saturating, and will not overflow.                   (0x1A-0x1B). An interrupt is generated if enabled by the corresponding enable
                                                                                            flag in the Table 68, SPI-3 to SPI-4 critical LID interrupt enable registers (0x18-
                                                                                            0x19) and Table 70, SPI-4 to SPI-3 critical LID interrupt enable registers (0x1C-
5.2.1 LID associated event counters                                                         0x1D). The indication is cleared by writing a logical one to the Table 67, SPI-
    A set of event counters is provided for each of the 64 LPs on each SPI-3                3 to SPI-4 critical LID interrupt indication registers (0x16-0x17) or Table 69, SPI-
interface and for each LID to/from the SPI-4 module.                                        4 to SPI-3 critical LID interrupt indication registers (0x1A-0x1B). Only one kind
    A packet is delineated by an SOP and EOP on the SPI-3 / SPI-4 logical port.             of critical event is defined, buffer overflow. Since there are 64 x 2=128 critical
It is defined as “bad” when the packet is tagged with an error.                             LID associated event sources, two source indication bits are contained in Table
    All packets that are not “bad” are considered “good”.                                   71, Critical events source indication register (0x1E). The bits are read only. Bit
    For more information refer to Table 60 - LID Associated Event Counters                  SPI34_OVR reflects the OR result of all bits in Table 67, SPI-3 to SPI-4 critical
(0x000-0x17F).                                                                              LID interrupt indication registers (0x16-0x17). Bit SPI43_OVR reflects the OR
                                                                                            result of all bits in Table 69, SPI-4 to SPI-3 critical LID interrupt indication registers
                                                                                            (0x1A-0x1B).
5.2.2 Non - LID associated event counters
    A set of event counters is provided for each of the SPI-3 and SPI-4 physical
interfaces.                                                                                 5.3.3 Timebase
    Refer to Table 61, Non LID associated event counters (0x00-0x0B) for the                   A single timebase module is provided in the device. The timebase period can
offset in the indirect access space, and for the events recorded.                           be configured to be internally or externally generated. A snapshot of the
                                                                                            counters is taken when the timebase expires and the counters are cleared. The
                                                                                            snapshot registers are accessed by an indirect access scheme.
5.3 Captured events
    Two categories of events are captured: LID and non LID associated events.               5.3.3.1 Internally generated timebase
If at least one event is captured in one of the interrupt indication registers, an active      The period of the timebase is configured for the device using the register
PMON service request is directed towards the interrupt module.                              defined in Table 120, Timebase register (Register_offset 0x01). The configu-
                                                                                            ration specifies the number of master clock (MCLK) cycles required for each
                                                                                            period. For a description of MCLK refer to Chapter 6 Clock generator. The
5.3.1 Non LID associated events
                                                                                            timebase event is captured by the timebase status in Table 45, Secondary
    Non LID associated events are captured into the Table 62 - Non LID
                                                                                            interrupt status register (0x2D in the direct accessed space).
associated interrupt indication register (Block_base 0x0C00 + Register_offset
                                                                                               The internal timebase is generated either by the microprocessor or by a free
0x00 to 0x0B). An interrupt is generated if the event is enabled by its enable
                                                                                            running timer input. The selection is made by the TIMER flag in the Table 119,
flag in the Table 63 - Non LID associated interrupt enable register(Block_base
                                                                                            PMON update control register (Register_offset 0x00). When the time interval
0x0C00 + Register_offset 0x0D). The interrupt is cleared by writing a logical
                                                                                            expires, the TIMEBASE pin is asserted for sixteen MCLK cycles.
one to the Table 62 - Non LID associated interrupt indication register (Block_base
0x0C00 + Register_offset 0x00 to 0x0B).
                                                                                            5.3.3.2 Externally generated timebase
                                                                                               The externally generated timebase signal is applied on the TIMEBASE pin.
5.3.2 LID associated events
                                                                                            A positive edge detector generates the timebase event. The timebase event is
    Two types of LID associated events are captured. Non critical events are
                                                                                            captured by the timebase status in the Table 45 - Secondary Interrupt
defined in Table 64 - LID-associated interrupt indication register(0x0E) and are
                                                                                            Status Register (0x2D in the direct accessed space).
associated with the physical interface. Critical events are defined as buffer
overflows within the IDT88P8342 device in Table 67, SPI-3 to SPI-4 critical LID
interrupt indication registers (register_offset 0x16-0x17).
                                                                                          38                                                                     APRIL 10, 2006


IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                                                           INDUSTRIAL TEMPERATURE RANGE
6. CLOCK GENERATOR                                                                       OCLK[3:0] pins are separately enabled by setting each associated enable flag
   The device generates clocks from the SPI-4 ingress clock (I_DCLK) or from             in Table 121, Clock generator control register (Register_offset 0x10). When an
the REF_CLK input pin. The clock so selected is used for core functions of the           OCLK[3:0] output is not enabled, it is in a logic low state. MCLK is the internal
device, and must be present during reset and thereafter. The selection and               processing clock, and is always enabled. Divide options should be selected to
frequency divisors are defined by CK_SEL[3:0] pins as defined in the following           keep the internal PLL output pll_oclk within its operating frequency range of 400
Table 14, CK_SEL[3:0] input pin encoding.                                                to 800 MHZ. Refer to Table 122, OCLK and MCLK frequency select encoding
   The clock generator provides four clock outputs on the OCLK[3:0] pins,                for selecting the frequencies of MCLK and OCLKs. Note that divider values
MCLK for internal use, and SPI-4 data and FIFO status channel egress clocks.             should be chosen so that OCLK[3:0] and MCLK are within their specified
The OCLK[3:0] clock frequencies can be selected independently of each other.             operating range provided in Table 136, OCLK[3:0] clock outputs and MCLK
OCLK[3:0] outputs always have a relative output skew of one pll_oclk (refer to           internal clock.
Figure 30 Clock generator) to prevent simultaneous switching when used as                   During either a hardware or a software reset, the OCLK[3:0] pins are all logic
SPI-3 clock sources. Use of the OCLK[3:0] outputs is encouraged for the SPI-             low. Immediately following reset, all OCLK[3:0] outputs are active with the output
3 clock inputs to reduce system jitter. The frequency is divided according to the        frequency defined by pll_oclk divided by the initial value in the Table 121, Clock
value selected in the clock generator control register shown below. The                  generator control register (Register_offset 0x10).
TABLE 14 – CK_SEL[3:0] INPUT PIN ENCODING
    CK_SEL[1:0]                   Function
        00                        pll_rclk = REF_CLK
        01                        pll_rclk = I_DCLK/16
        10                        pll_rclk = I_DCLK /8
        11                        pll_rclk = I_DCLK /4
    CK_SEL[3:2]                   Function
        00                        E_DCLK = pll_oclk/2
        01                        E_DCLK = pll_oclk/4
        10                        E_DCLK = pll_oclk/6
        11                        E_DCLK = pll_oclk/8
                                                                                         OCLK0          OCLK1          OCLK2          OCLK3
                                                                                                                                                     N_MCLK MCLK
                                                                   (40-133 MHz)
                                                                                            N_OCLK0        N_OCLK1        N_OCLK2        N_OCLK3
                                                                                                            4/6/8/10       4/6/8/10       4/6/8/10    4/6/8/10
                                                                                             4/6/8/10
                     I_DCLK                                                                                                    pll_oclk
                                           4/8/16
                     (80-400 MHz)
                                                            MUX      pll_rclk       X 32 PLL                                                                        E_DCLK
                                                                   (12.5-25 MHz) (400-800 MHz)                                                2/4/6/8              (80-400 MHz)
                     REF_CLK
                     (12.5-25 MHz)
                     CK_SEL[1:0]                                                                                                                                    I_SCLK_L
                      CK_SEL[3:2]
                                                                                                                                                                    I_SCLK_T
                                                                                                                                                            4
                                                                                                                                                                        6370 drw21
                                                                  Figure 30. Clock generator
                                                                                    39                                                                                               APRIL 10, 2006


IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                                        INDUSTRIAL TEMPERATURE RANGE
7. LOOPBACKS                                                                        7.1 SPI-3 Loopback
  Local loopbacks are supported on both of the SPI-3 physical ports. They are           A SPI-3 physical port loop back is supported on both of the SPI-3 interfaces.
described below.                                                                    In this mode, the contents of the SPI-3 ingress buffers are directly transferred
                                                                                    to the SPI-3 egress buffers. All data and error information received on an ingress
                                                                                    interface of a SPI-3 physical port is transmitted on the egress interface of the same
                                                                                    SPI-3 physical port.
                                                            JTAG          uproc        Chip Counters Memory
                                                                                                                Interface Block
                         2 x SPI-3
                                                               LID Counters Memory
                        8 bit / 32 bit
                                                                                                        …
                                                 Interface Block
                       Min: 19.44MHz                                        Main                                                       SPI-4.2
                       Max: 133MHz                                                                                                   Min: 80 MHz
                                                                           Memory                                                    Max:400 MHz
                                                                             A
                                                                   …
                                                                           SPI-3 /                    SPI-4 /
                                                                           LID map                    LID map
                                                                                                                    6370 drw23
                                                                   Figure 31. SPI-3 Loopback diagram
                                                                                  40                                                                APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                                         INDUSTRIAL TEMPERATURE RANGE
8. OPERATION GUIDE                                                                          CLK (REF_CLK or I_DCLK - depends on which of theses pins are selected),
                                                                                            VDDT33, VDDC12 and RESETB. Figure 32, Power-on-Reset Sequence
8.1 Hardware operation
                                                                                            illustrates the recommended implementation for the power-on-reset sequence
8.1.1 System reset                                                                          for the device. IDT recommends powering up the VDD33 power supply first,
   There are two methods for resetting the device: hardware reset & software                and the VDDC18 power supply last. The power supplies can be also powered
reset. During reset the output clocks are not toggled.                                      up in the same time. There is no requirement for the minimum or maximum
                                                                                            delay between the power-up of the power supplies. The power supplies
Hardware reset                                                                              should be powered off in the revers order. The power ramp should not be fast
   The RESETB input requires an active low pulse to reset the internal logic.               than 100us, but also not too slow.
                                                                                                When the power supplies are powered up, the RESETB signal should be
Software reset                                                                              at low level. During power-on-reset, after the VDDT33, VDDC18, CLK
   The software reset is triggered by setting to 1 the SW_RESET field in direct             (REF_CLK or I_DCLK - depends on which of theses pins are selected) and
register Software Reset Register (p.51). The response to a software reset is                the configuration signals are stable, the RESETB signal should remain at a low
identical to a hardware rest except that software reset does not change the                 level at least 10ms (symbol “T1”) to reset the internal logic. After the RESETB
N_OCLK[3:0] fields in the Clock Generator Control Register (p.77), so it does               pulse ends, the device starts generating the SPI-4 / SPI-3 external output
not impact the clock generators. The SW_RESET field is self-clear to 0 after the            clocks & the MCLK internal clock.
device initialized itself. After software reset the external microprocessor should              After the RESETB pulse ends, a delay of 1ms should be added (symbols
have delay of at least 1ms before accessing the device, and then. After the 1ms             “T2”) before accessing the device for initialization and configuration. This
delay, the user should poll the INIT_DONE field in the Software Reset Register              allows the internal logic to be stable. During T2 (at least 1ms delay) the device
(p.51), and wait till it is 1. When the INIT_DONE field is 1, the user should               performs internal memories initialization.
download a boot code from the external microprocessor flash to the device                       After T2, the user should poll the INIT_DONE field in the in the Software
embedded processor RAM.                                                                     Reset Register (p.51), and wait till it is 1. When the INIT_DONE field is 1, the
                                                                                            user should download a boot code from the external microprocessor flash to
8.1.2 Power on sequence                                                                     the device embedded processor RAM.
   A correct power-on-reset sequence is crucial for the normal behavior of
the device. The power-on-reset sequence includes the following signals:
                                 CLK
                             VDDC18
                            VDDT33
                             RESETB
                                                                                                         T1               T2
                                                                                                                                                  6371 drw23a
                                                                   Figure 32. Power-on-Reset Sequence
8.1.3 Clock domains                                                                         8.2 Software operation
   The chip has several clock domains. The related registers can not be                     8.2.1 Chip configuration sequence
configured without each clock. It is necessary to supply the clocks that are                    For proper device operation, it is important to initialize the IDT88P8342 in the
pertinent to the registers being initialized for the initialization to succeed. In order    correct sequence following reset. This sequence is outlined in the following
to access the microprocessor interface, MCLK must be active, either by selecting            paragraphs.
and providing a stable REF_CLK input, or by selecting and ensuring that a stable                1) Reset the IDT88P8342 chip. After reset, the chip will perform auto
clock is always present on the I_DCLK input. The selection of either the                    initialization. Wait for the chip initialization to complete. The INIT_DONE flag will
REF_CLK or the I_DCLK clock inputs is described in Table 14 CK_SEL[3:0]                     go high when initialization has been completed.
input pin decoding.
                                                                                         41                                                                    APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                               INDUSTRIAL TEMPERATURE RANGE
   2) Configure the clock generator as follows:                                       in the TAP value. Therefore, the adjacent device should send training for at
        a) Configure the value for the MCLK divider, OCLK dividers and                least 100ms in the end of the initialization sequence & before starting to send
            enables in the Clock Generator Control Register (refer to Table 121,      data. The bit alignment will select the best tap for each lane.
            Clock generator control register (Register_offset 0x10)).
        b) Configure the values for I_LOW and E_LOW (refer to Table 89, SPI-          8.2.2 Logical Port activation and deactivation
           4 ingress configuration register (0x00) and Table 104, SPI-4               Dynamically deactivate a logical port
           egress configuration register_0 (Register_offset 0x00).                        The procedure for deactivating a logical port is outlined as follows:
   3) Load status channel firmware. See section 8.2.5 for details.                        1) Configure the enable bit of the ingress LP to LID map to “disabled”.
   4) Configure all PFPs as follows:                                                      2) Configure the egress data DIRECTION field in Table 73, SPI-4 egress
        a) The NR_LID fields must be configured first. Do not change the NR_LID       port descriptor table (64 entries) or Table 80, SPI-3 egress port descriptor table
           fields once configured after reset. The NR_LID fields are in the Table     (64 entries) to “discard”.
           76, SPI-3 to SPI-4 PFP register (register_offset 0x00) and the                 3) Wait at least 0.1ms for the flush of the remaining data in the queue.
           Table 83, SPI-4 to SPI-3 PFP register (0x00).                                  4) Change M to 0 for the LP.
        b) There are four sets of port descriptor tables: The Table 73, SPI-4
        egress port descriptor table (64 entries), the Table 75, SPI-3 ingress port   Dynamically activate a logical port
        descriptor table (Block_base 0x1200), the Table 80, SPI-3 egress port             The procedure for activating a logical port is outlined as follows:
        descriptor table (64 entries), and the Table 82, SPI-4 ingress port               1) Make sure the LID is inactive.
        descriptor tables (64 entries). Configure the M (SPI-4 egress),                   2) Configure M for the desired LID.
        MAX_BURST_S, MAX_BURST_H, DIRECTION (SPI-4 egress),                               3) Configure the egress LID to LP map, then enable the LID.
        FREE_SEGMENT, MAX_BURST, DIRECTION (SPI-3 egress), M                              4) Configure the egress data direction for the LID.
        (SPI-4 ingress), FREE_SEGMENT_S, and FREE_SEGMENT_H                               5) Configure the ingress LP to LID map, then enable the LP.
        parameters of the port descriptor tables for each LID to be activated. The
        total buffer segment assignment should not exceed the available buffer        8.2.3 Buffer segment modification
        segment pool capacity of 508 segments per PFP.
                                                                                      Modification of the buffer segment allocation for a LID
   5) Configure the Table 54- SPI-3 egress LID to LP map.
                                                                                          The buffer segment allocation can be changed while the corresponding LP
   6) Configure the Table 49 - SPI-3 ingress LP to LID map.
                                                                                      is disabled. The amount of buffering available for a LID can be decreased or
   7) The SPI-4 Calendar tables must be configured before the SPI-4 mapping
                                                                                      it can be increased if more buffer segments are available for use. The procedure
tables are configured. Do not change the SPI-4 calendar tables once they are
                                                                                      for changing the buffer segment allocation for a LID is outlined as follows:
configured. In LVDS status mode, ensure that the value of (CAL_LEN+1) *
(M+1) is at least 4.
                                                                                          1) Disable the LP corresponding to the LID to undergo buffer segment
        a) Configure the SPI-4 ingress calendar or calendars (refer to Table 87,
                                                                                      modification.
           SPI-4 ingress calendar_0 (256 entries) and Table 88, SPI-4 ingress
                                                                                          2) Discard the fragments, by configuring the DIRECTION field for DISCARD
           calendar_1 (256 entries)).
                                                                                      for the LID.
        b) Configure the SPI-4 egress calendar or calendars (refer to Table 102,
                                                                                          3) Wait at least 0.1ms for the buffer to empty.
           SPI-4 egress calendar_0 (256 locations) and Table 103, SPI-4
                                                                                          4) Change M to 0 for the LID.
           egress calendar_1 (256 locations)).
                                                                                          5) Configure the new M value for the LID.
   8) Configure the Table 101, SPI-4 egress LID to LP map (256 entries).
                                                                                          6) Configure the DIRECTION field for the LID to restore data flow.
   9) Configure the Table 86, SPI-4 ingress LP to LID (256 entries, one per LP).
                                                                                          7) Enable the LP corresponding to the LID that underwent buffer segment
   10) Configure the SPI-4 physical interface. The Table 89, SPI-4 ingress
                                                                                      modification.
configuration register (0x00), Table 104, SPI-4 egress configuration register_0
(Register_offset 0x00), and Table 105, SPI-4 egress configuration register_1
(Register_offset 0x01) must be configured before enabling the SPI-4 physical
                                                                                      8.2.4 Manual SPI-4 ingress LVDS bit alignment
interface. Once the SPI-4 interface is enabled, the SPI-4 interface configuration         The procedure for manually adjusting the SPI-4 ingress LVDS bit alignment
registers can not be changed unless the chip is reset. Individual LIDs can still      is outlined. It is recommended to use automatic alignment in most cases.
be enabled or disabled, within the bounds set by NR_LID.                                  1) Configure the FORCE bit from Table 99, SPI-4 ingress bit alignment control
   11) Configure the SPI-3 physical interfaces. The Table 75, SPI-3 ingress           register (register_offset 0x11). This puts the SPI-4 ingress under manual
port descriptor table (Block_base 0x1200) must be configured before enabling          control.
the SPI-3 physical interfaces. Once the SPI-3 interfaces are enabled, Table               2) Configure the SPI-4 ingress data lane to be measured for clock-data
80, SPI-3 egress port descriptor table (64 entries) can not be changed unless         alignment in Table 111, SPI-4 ingress lane measure register
the chip is reset. Individual LIDs can still be enabled or disabled without a chip    (register_offset 0x01), LANE field.
reset, within the bounds set by NR_LID.                                                   3) Wait for the eye measurement to complete in Table 111, SPI-4 ingress
   12) Enable the SPI-3 physical interfaces. Set the enable bit per LID in Table      lane measure register (register_offset 0x01), MEASURE_busy field.
 50, SPI-3 ingress LP to LID map and Table 54, SPI-3 egress LID to LP map.                4) Read the eye pattern counter in Table 112, SPI-4 ingress bit alignment
   13) Enable the SPI-4 physical interface. Set the enable bit per LID in Table       counter register (0x02 to 0x0B).
82, SPI-4 ingress LP to LID map (256 entries, one per LP) and Table 101, SPI-             5) Calculate the proper value.
4 egress LID to LP map (256 entries).                                                     6) Configure the appropriate phase tap in Table 113, SPI-4 ingress manual
   Note: Sufficient edge transitions on the bus are required to cause a change        alignment phase/result register (0x0C to 0x1F).
                                                                                    42                                                              APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                               INDUSTRIAL TEMPERATURE RANGE
8.2.5 SPI-4 status channel software                                                  PCB trace delay Table 18 permitted is 3 ns (Unit Interval - TD-MAX - TSETUP). This
   The SPI-4 status channel may be configured to either TTL or LVDS by               translates to a maximum PCB trace length for data and control lanes of 13.5
loading the appropriate status channel binary file to activate the firmware.         inches, if the loaded PCB trace delay is 220 picoseconds per inch. This is for
Download LVTTL.bin when using LVTTL status mode. Download LVDS.bin                   zero TSETUP margin, and does not include any margin for clock driver skew.
when using LVDS status mode.                                                         Clock driver or clock trace skew could reduce the TSETUP margin in this example.
   The download process is described.                                                    3) Match all SPI-3 clock lengths to within the TD-MIN - THOLD requirement. For
       Direct write (0x20, 0x01); /* Write register 0x20 with 0x01 to reset */       example, if TD-MIN for the device is 1.5 ns, and THOLD for the attached device
       Delay at least 5ms                                                            is 0.5 ns, the worst case PCB clock trace skew for zero THOLD margin (defined
       Direct write (0x36, 0x07);                                                    in this example as the maximum PCB trace delay that the SPI-3 ingress clock
       ind_write(0x700c8, 0xdcb0);                                                   of the attached device can exceed the trace delay of the SPI-3 egress clock
                                                                                     of the device and still meet the THOLD requirement of the attached device with
   Open LVTTL.bin or LVDS.bin file                                                   zero margin, assuming the fastest device [TD-MIN ] and the worst case THOLD for
   number = file length                                                              the attached device and no trace delay on the data and control lanes) is 1.7
         addr = 0x70e00;                                                             ns (Table 15 (TD-MIN - THOLD)), for a maximum PCB clock trace difference of
               if (number % 2 == 0)                                                  7.6 inches. Trace delay on the data and control lanes would improve the THOLD
                number /=2;                                                          margin in this example. This example does not include any margin for SPI-3
         else                                                                        clock buffer skew.
                number = number/2 + 1;                                                   4) Ensure a few nanoseconds of clock delay between one SPI-3 clock net
                                                                                     and other SPI-3 clock nets of the same frequency to minimize simultaneous
        for ( i = 0; i < number; i ++ )                                              switching noise. The IDT88P8342 OCLK[3:0] outputs have skew between
          {                                                                          each output already built in, and so are useful in lowering simultaneous
                scr_fp.Read(ch, 2);                                                  switching noise. A SPI-3 clock net is defined to be the SPI-3 egress clock for
                data = (ch[1] << 8) | ch[0];                                         a device and the SPI-3 ingress clock for the attached device.
                ind_write(addr, data);                                                   5) Route all SPI-3 traces as 50 Ohm embedded stripline (inner layer
                 addr ++;                                                            referencing ground planes). For example, 8 mil wide 1/2 oz copper traces
                 addr ++;                                                            sandwiched between ground planes with 10 mil dielectric spacing between
          }                                                                          ground planes and signal planes yields 52 Ohms single-ended, using FR-4
         close file                                                                  with a relative dielectric constant (εR or DK) of 4.2. If the edge to edge spacing
         ind_write(0x700c6, 0x0e00);                                                 between adjacent SPI-3 series terminated signals is 20 mils in this example,
         ind_write(0x700c8, 0xc860);                                                 crosstalk between adjacent signals can be kept to 2%. Use a field solver for
          Direct write (0x36, 0x00);                                                 more accurate results.
                                                                                         An example timing budget Table 15, Zero Margin SPI-3 Timing budget, and
8.2.6 IDT88P8342 layout guidelines                                                   example trace lengths to achieve timing margin Table 16, Margin check for SPI-
SPI-3 LAYOUT GUIDELINES                                                              3 timing, are shown. These timing budget tables do not include clock driver
   1) Series terminate SPI-3 traces that are greater than 1/2 inch in end-to-end     relative skew incurred if different drivers are used for a SPI-3 egress and its
length. Place the series resistor as close as possible to the driver, but no more    attached SP-3 ingress. These tables are based on timing only and do not
than 1/2 inch away from the driving end. SPI-3 inputs must have ringing              include such effects as crosstalk and rise time degradation.
controlled to prevent the SPI-3 inputs from going more than 0.5 Volts below
ground. Use the IBIS models for more accurate results with the specific devices      SPI-4 LAYOUT GUIDELINES
being used.                                                                              1) Match the P and N trace lengths within an LVDS differential signal pair to
   2) Minimize all SPI-3 data and control trace lengths to not exceed the            within 100 mils or less.
TD-MAX - TSETUP requirement. For example, if the SPI-3 clock is 104 MHz, TD-MAX          2) Match the group of all differential data, control, and clock signal lengths to
of a device is 5.65 ns, and TSETUP of the attached device is 1 ns, the maximum       within 1/2 unit interval (DDR), or less, of each other (1/4 clock period). For
TABLE 15 - ZERO MARGIN SPI-3 TIMING BUDGET
 SPI-3Clock Tsetup Thold Td, minimum Td, maximum Unit Interval Maximum data Maximum data Maximum Maximum Clock
                                                                                        trace delay       trace length clock skew ∆trace length
  104 MHz            1 ns    0.65 ns     2.33 ns        5.65 ns            9.6 ns           3 ns             13.5 in           1.7 ns          7.6 in
TABLE 16 - MARGIN CHECK FOR SPI-3 TIMING
 SPI-3Clock Tsetup Thold Td, minimum Td, maximum Egress                               Ingress       Longest        Shortest       Tsetup         Thold
                                                                      clock trace   clock trace data trace       data trace       margin        margin
  104 MHz            1 ns    0.65 ns     2.33 ns        5.65 ns        4 inches      8 inches       6 inches       4 inches       2.33 ns       1.48 ns
                                                                                  43                                                                  APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                                INDUSTRIAL TEMPERATURE RANGE
example, a SPI-4 clock of 400 MHz gives a data unit interval of 1.25 ns, so match         4) Avoid changing layers on high-speed signals. On a layer change, signals
the lengths within the entire signal group to within 625 ps, or 3 inches.              should share the same reference (such as ground), connected by reference
    3) Keep P and N signals within a differential pair on the same layer with the      vias close to the signal vias for good current return. If a different reference plane
minimum trace spacing possible while still being able to get 100 ohms differential     (such as Vcc) must be used due to a signal layer change, good high-frequency
impedance (tightly edge-coupled pair routing).                                         0.01 µF ceramic capacitors must be used to connect the references together
    4) Route all differential pairs as 100 Ohm embedded differential stripline (on     as close to the signal vias as possible to ensure good transmission line properties
an inner layer, referencing ground planes). For example, 7 mil wide 1/2 oz             and current return.
copper traces separated by 10 mils, with 10 mil dielectric spacing to ground              5) Use of a low-jitter (100 picoseconds peak-peak maximum jitter) frequency
planes above and below the traces gives 100 Ohms of differential impedance             source for REF_CLK is important. If I_DCLK is used instead of REF_CLK,
for FR-4 with a relative dielectric constant (εR or DK) of 4.2. If the edge to edge    ensure that I_DCLK is low in jitter and always available.
spacing between adjacent differential pair traces is 20 mils, crosstalk is 0.6% for       6) Keep the power decoupling capacitors as close as possible to the power
signals terminated to within a 10% impedance match. If the edge to edge spacing        pins, using at least 15 mil traces and double vias for reduced inductance where
between a differential pair and an LVTTL signal is 30 mils within the parameters       possible.
of this example, crosstalk is 0.8% (with the LVTTL signals series terminated).            7) Distribute some large-valued capacitors around the board for low-
Use a field solver for more accurate results.                                          frequency decoupling and to lower the power-supply impedance.
    5) Follow the SPI-3 layout guidelines for any routed SPI-4 LVTTL status               8) TRSTB (JTAG reset) must have a pull down resistor or be connected to
signals.                                                                               RESETB for normal operation.
                                                                                          9) Filter the 1.8 Volt and 3.3 Volt analog power pins to isolate them from the
GENERAL LAYOUT GUIDELINES                                                              noisy digital environment. Use ferrite beads and capacitors (Pi filters) for
    1) Keep LVDS signals far from LVTTL signals: at least three times the dielectric   VDDA18_x and VDDA33.
thickness to the reference plane (or three times the trace separation, whichever          10) Suppress non-functional inner layer pads.
is greater) in separation width, to minimize the crosstalk contribution of noise on
the LVDS signals from the noisy LVTTL environment.                                     8.2.7 Software Eye-Opening Check on SPI-4
    2) Separate signals of the same type by at least twice the dielectric thickness    Interface
(or twice the trace separation, whichever is greater) to the reference plane to           Since the SPI-4 interface is a DDR interface, both rising and falling edges
reduce crosstalk.                                                                      are used to update or sink data.
    3) The reference planes must extend at least five times the dielectric thickness
from either side of the trace and be unbroken.
                                        clock
                                         data              dn                     dn+1
                                 over sample
                                 position          0 1 2 3 4 5 6 7 8 9 a b c
                                     counter                  c0 c1 c2 c3 c4 c5 c6 c7 c8 c9
                                                                                                                                    6371 drw23b
                                           Figure 33. DDR interface and eye opening check through over sampling
    Refer to the IDT88P8342 uses an internal sampling clock cycle which has             CNT0= Rt.d2^ Rt.d3
a frequency of 10 times SPI-4 clock to over-sample the data on a lane. For each         CNT1= Rt.d3^ Rt.d4
sampling clock cycle t position n data are sampled and labeled as Rt.dn. The            CNT2= Rt.d4^ Rt.d5
following operation is then performed:                                                  CNT3= Rt.d5^ Rt.d6
                                                                                        CNT4= Rt.d6^ Rt.d7
                                                                                        CNT5= Rt.d7^ Rt.d8
                                                                                        CNT6= Rt.d8^ Rt.d9
                                                                                        CNT7= Rt.d9^ Rt+1.d0
                                                                                        CNT9= Rt+1.d0^ Rt+1.d1
                                                                                     44                                                                  APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                                 INDUSTRIAL TEMPERATURE RANGE
   For an ideal case, there is zero jitter on clock an data, zero skew, the clock
high and low level phase are symmetrical. For random input data on each lane,
the counters Cn=CNTn(t)+CNTn(t+1)+. . .+CNTn(t+T), where T is a time
window to do the statistics computation, will increment as follows:
 Counter       C0         C1       C2        C3       C4       C5      C6       C7        C8         C9
 Value          0          0        P         0        0       0       0         K        0           0
   Where P and K are non-zero and need to be a large enough value mark
the transition position of a clock and define the position.
Software for implementing the Eye-Opening Check
   In the IDT88P8342, a set of diagnostic registers are provided for implement-       selected lanes and the MEASURE_BUSY bit will be set accordingly indicating
ing an eye-opening check. The SPI-4 interface has 16 data lanes and one               the measuring process is active. The MEASURE_BUSY bit is cleared internally
control lane on ingress, 2 status lanes on egress, making a total of 19 lanes.        which indicates that the measuring process is complete. The measured result
   The SPI-4 ingress bit alignment window register defines the window T stated        of counters C0 through C9 will be available in the SPI-4 ingress bit alignment
above, based on which the signal statistics are computed. It is recommended           counter registers.
to use the default value. The MEASURE_BUSY bit indicates the status of the               Note that there is one SPI-4 ingress lane measure register and 19 SPI-4
internal measurement operation.                                                       ingress bit alignment counter registers.
   The SPI-4 ingress lane measure register selects the lane statistics counters          The following pseudo code shows how to check the eye opening:
to be read, a write to this register triggers the eye-opening check process to the
      #define SPI-4_ingress_lane_measure_register 0x8801 /* register address in SPI exchange device*/
      #define SPI-4_ingress_bit_alignment_counter_register(0) 0x8802
      #define SPI-4_ingress_bit_alignment_counter_register(1) 0x8803
      #define SPI-4_ingress_bit_alignment_counter_register(2) 0x8804
      #define SPI-4_ingress_bit_alignment_counter_register(3) 0x8805
      #define SPI-4_ingress_bit_alignment_counter_register(4) 0x8806
      #define SPI-4_ingress_bit_alignment_counter_register(5) 0x8807
      #define SPI-4_ingress_bit_alignment_counter_register(6) 0x8808
      #define SPI-4_ingress_bit_alignment_counter_register(7) 0x8809
      #define SPI-4_ingress_bit_alignment_counter_register(8) 0x880a
      #define SPI-4_ingress_bit_alignment_counter_register(9) 0x880b
      For lane=0 to K step 1                 /*the number K depend on status mode: K=18 in LVDS status mode*/
      {                                        /*                                       K=16otherwise */
             write #lane, SPI-4_ingress_lane_measure_ register
             wait until BUSY=0               /* BUSY: bit 8 of SPI-4_ingress_lane_measure_register, at address
             0x8801*/
             for i=0 to 9 step 1
             {
                          read C(i), SPI-4_ingress_bit_alignment_counter_register(i)
             }
             print C(0), C(1), C(2), C(3), C(4), C(5), C(6), C(7), C(8), C(9)
      }
   Because the SPI-4 ingress bit alighnment counter register has a 10-bit width,      delay, if the jitter on a data lane or clock is less than one tap interval (peak to
the maximum counter value is 0x3ff.                                                   peak), the jitter will not be reflected in counters. While the eye open check can
   If the counter values of a lane are:                                               indicate excessive jitter there are limitations in providing a accurate measure-
            0, 0, 0x3ff, 0, 0, 0, 0, 0x3ff, 0, 0                                      ment using this method.
   The eye open is perfect; there is very good signal integrity on input signals         Theoretically as long as one tap accumulates enough non-zero samples for
of the SPI-4 interface.                                                               each 2 bits within a clock cycle the sampled signal position will be correct and
   In each sample position represents a “tap”. Depending on the delay in a lane,      the interface will function correctly. The more counters that have zero values,
even a small jitter value of 1ps on the lane or the clock, may cause eye closing      the better the eye opening.
that can be detected by observing the counter values. In an ideal case with zero
                                                                                   45                                                                 APRIL 10, 2006


IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                                                     INDUSTRIAL TEMPERATURE RANGE
9. REGISTER DESCRIPTION                                                                               Indirect registers are accessed through special direct access registers designed
    There are two distinctly different types of register access in the IDT88P8342.                    for the purpose of allowing indirect access to the large set of registers and maps
Direct access registers are used for interrupts and other high-priority registers                     that are needed to configure the IDT88P8342.
and for access to the indirect access registers. Direct access registers can be
accessed more quickly than indirect access registers, and are used where this                         9.1 Register access summary
access speed advantage is required. There are only a limited number of direct                            The SPI Exchange device uses an indirect addressing scheme for most of
access registers due to the six address lines used on the IDT88P8342. All direct                      the configuration registers. The indirect registers are accessed through a
access registers are one byte wide. Most registers within the IDT88P8342 are                          protocol where interface pins A[5:0], D[7:0], and control pins are mapped into
of the indirect access type. Indirect access registers are used for configuration,                    internal register space A[15:0], D[31:0], and Control[7:0]. The full address of
maps, etc., that may not need to be accessed as often as the direct registers.                        any indirectly addressed register = Module_base + Block_base + Register_offset.
                                            Processor interface
                                                                                   Direct accessed                                   Indirect accessed
                                                                                   space
                                                                                                                                     space
                                                                      C[7:0]                                      C[7:0]
                                                                  8   D[7:0]                                 32   D[31:0]
                                                                  6   A[5:0]                                      A[15:0]
                                                                                                             16
                                                                                                                                                 6370 drw24
                                                                       Figure 34. Direct & indirect access
9.1.1 Direct register format
  All direct register accesses are one byte. The bit ordering for the direct
access registers is shown.
TABLE 17 - BIT ORDER WITHIN AN 8-BIT DATA REGISTER
  Direct Register Format
  bit 7 bit 6 bit 5 bit 4 bit 3 bit 2 bit 2 bit 0
Bit 7 is the most significant data bit.
9.1.2 Indirect register format
   The internal format for 32 and 8 bit registers is shown below. The registers
are accessed from the external processor interface as successive bytes of
indirect data. The indirect register space includes 32-bit data registers and 8-
bit data registers. The directly-addressed register space includes directly-
addressable 8-bit data registers, four 8-bit data registers for indirect data access,
two 8-bit address registers for indirect data access, and an 8-bit control register
for indirect data access.
TABLE 18 - BIT ORDER WITHIN A 32-BIT DATA REGISTER
    Indirect Data            Indirect Data             Indirect Data            Indirect Data
   (register 0x33)          (register 0x32)           (register 0x31)          (register 0x30)
     bit 31…bit 25            bit 24…bit 16              bit 15…bit 8             bit 7…bit 0
Bit 31 is the most significant data bit.
TABLE 19 - BIT ORDER WITHIN AN 8-BIT DATA REGISTER
  Indirect Data (register 0x30)
  bit 7 bit 6 bit 5 bit 4 bit 3 bit 2 bit 2 bit 0
Bit 7 is the most significant data bit.
                                                                                                     46                                                            APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                 INDUSTRIAL TEMPERATURE RANGE
TABLE 20 - BIT ORDER WITHIN A 16-BIT ADDRESS REGISTER
  Indirect High Address (register 0x35)                     Indirect Low Address (register 0x34)
  bit 15 bit 14 bit 13 bit 12 bit 11 bit 10 bit 9 bit 8     bit 7 bit 6 bit 5 bit 4 bit 3 bit 2 bit 2 bit 0
Bit 15 is the most significant data bit.
TABLE 21 - BIT ORDER WITHIN
AN 8-BIT CONTROL REGISTER
  Indirect Control (register 0x3F)
  bit 7 bit 6 bit 5 bit 4 bit 3 bit 2 bit 2 bit 0
Bit 7 is the most significant data bit.
Module base address (Module_base)
   There are three modules defined for indirect data access.
TABLE 22 - MODULE BASE ADDRESS (MODULE_BASE)
                                MODULE                                                 Module_base
  Module A (SPI3-A, PFP-A, PMON-A)                                                         0x0000
  Module B (SPI3-B, PFP-B, PMON-B)                                                         0x2000
  Common (SPI-4, timing, PMON, clock, GPIO, and version number)                            0x8000
Block base
   There are block bases defined for SPI-3 modules and also for Common, as
shown in the following tables.
TABLE 23 - INDIRECT ACCESS BLOCK BASES FOR
MODULE A AND MODULE B
  Block_base                             Function
     0x0000          SPI-3 ingress LP to LID registers
     0x0200          SPI-3 ingress general configuration register
     0x0500          SPI-3 egress LID to LP registers
     0x0700          SPI-3 egress configuration registers
     0x0A00          LID associated event counters
     0x0C00          Non LID associated event counters
     0x1000          SPI-3 ingress packet length configuration register
     0x1100          SPI-4 egress port descriptor table
     0x1200          SPI-3 ingress port descriptor tables
     0x1300          SPI-3 to SPI-4 PFP and flow control registers
     0x1600          SPI-4 ingress control registers
     0x1700          SPI-3 egress port descriptor table
     0x1800          SPI-4 ingress port descriptor table
     0x1900          SPI-4 to SPI-3 PFP register
                                                                                 47                                          APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                                  INDUSTRIAL TEMPERATURE RANGE
TABLE 24 - INDIRECT ACCESS BLOCK BASES FOR COMMON MODULE
  Block_base                                                          Function
     0x0000          SPI-4 ingress LP to LID tables
     0x0100          SPI-4 ingress calendar_0
     0x0200          SPI-4 ingress calendar_1
     0x0300          SPI-4 ingress registers
     0x0400          SPI-4 egress LID to LP map
     0x0500          SPI-4 egress calendar_0
     0x0600          SPI-4 egress calendar_1
     0x0700          SPI-4 egress configuration and status registers
     0x0800          SPI-4 ingress timing block registers
     0x0900          PMON timebase control, clock generator control, GPIO register, and version number
Register offset                                                                         Indirect register read access
   The register offset is shown in the section where the register is defined. The           An indirect read access is initiated by first checking for IND_BUSY=0 in the
register offset is referred to as, “Register_offset”, in this document. A register      indirect access control register, and then writing the address into the indirect
reference takes the form of, “[Register_offset 0xHH]”, where HH is the                  access address registers. Then, 0x40 is written into the indirect access control
hexadecimal value of the register offset.                                               register. The status of the IND_BUSY flag in the indirect access control register
                                                                                        is checked to ensure the process has completed, and then data is read out from
Indirect register access                                                                the indirect access data registers.
Indirect register write access
   An indirect write access is initiated by first checking for IND_BUSY=0 in the            The registers for controlling indirect register access are shown below. The
indirect access control register, and then writing data into the indirect access data   registers for controlling indirect register access are directly accessible with read
registers. Next, the address is written into the indirect access address registers.     and write access.
Then, 0x00 is written into the indirect access control register. The status of the
IND_BUSY flag in the indirect access control register is checked to ensure the
process has completed before another indirect access can be initiated.
TABLE 25 - INDIRECT ACCESS DATA REGISTERS
(DIRECT ACCESSED SPACE) AT 0x30 to 0x33
       Field               Bits        Length                    Function
  DATA[7:0]              7:0               8          Indirect Data Register 0x30
  DATA[15:8]             15:8              8          Indirect Data Register 0x31
  DATA[23:16]            23:16             8          Indirect Data Register 0x32
  DATA[31:24]            31:24             8          Indirect Data Register 0x33
TABLE 26 - INDIRECT ACCESS ADDRESS REGISTER
(DIRECT ACCESSED SPACE) AT 0x34 to 0x35
       Field               Bits        Length                    Function
  ADDRESS[7:0]           7:0               8           Indirect Low Address Register 0x34
  ADDRESS[15:8] 15:8                       8           Indirect High Address Register 0x35
TABLE 27 - INDIRECT ACCESS CONTROL REGISTER
(DIRECT ACCESSED SPACE) AT 0x3F
       Field               Bits        Length
  ERROR code             5:0               6
  R/WN                   6                 1
  IND_BUSY               7                 1
The fields for this register are defined below.
                                                                                      48                                                                 APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                      INDUSTRIAL TEMPERATURE RANGE
   ERROR code See Table 28, Error coding. This error code pertains to
the last indirect access attempted.
TABLE 28 - ERROR CODING TABLE
  ERROR code                            Error Meaning
       0x00           Normal indirect access completion
       0x01           Multiple LP to same LID attempted assignment
       0x02           Multiple LID to same LP attempted assignment
       0x03           Buffer segment overflow
       0x04           Not enough Queue entries
       0x05           Attempt to modify while active
       0x06           Address out of bound
       0x07           Calibration before the chip has finished reset
       0x08           LP limited
       0x09           Undefined direction
       0x3E           Undefined address
       0x3F           Time out
   R/WN This bit defines the read or write access to the indirect register.
                      0=WRITE
                      1=READ
   IND_BUSY This bit is an indication of the ability of the indirect register
access to accept a new transaction, and of the completion of the current
transaction.
                 0=Ready for read or write operation
                 1=Busy indication. Wait before beginning a read or write
                 operation
                                                                              49                  APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                          INDUSTRIAL TEMPERATURE RANGE
9.2 Direct access registers
   The direct access registers are in the directly-addressed access space.
Direct access registers are more quickly accessed, and serve the needs of
interrupts and the indirect access registers.
TABLE 29 - DIRECT MAPPED MODULE A AND MODULE B REGISTERS
  Module A and B direct registers               Module A            Module B
  SPI-3 data capture control register              0x00                0x08
  SPI-3 data capture register                      0x01                0x09
  SPI-4 data insert control register               0x02                0x0A
  SPI-4 data insert register                       0x03                0x0B
  SPI-4 data capture control register              0x04                0x0C
  SPI-3 data insert control register               0x05                0x0D
  SPI-4 data capture register                      0x06                0x0E
  SPI-3 data insert register                       0x07                0x0F
  Module status register                           0x24                0x25
   Module enable register                          0x28                0x29
TABLE 30 - DIRECT MAPPED OTHER REGISTERS
   Other Direct registers                       Address
   Software reset                                  0x20
   SPI-4 status register                           0x22
   SPI-4 enable register                           0x23
   Primary interrupt status register               0x2C
   Secondary interrupt status register             0x2D
   Primary interrupt enable register               0x2E
   Secondary interrupt enable register             0x2F
   Indirect access data[7:0]                       0x30
   Indirect access data[15:8]                      0x31
   Indirect access data[23:16]                     0x32
   Indirect access data[31:24]                     0x33
   Indirect access address[7:0]                    0x34
   Indirect access address[15:8]                   0x35
   Indirect access control[7:0]                    0x3F
SPI-3 data capture control register                                                SPI-3 data capture register
TABLE 31 - SPI-3 DATA CAPTURE CONTROL
REGISTER (REGISTERS 0x00 and 0x08)                                                 TABLE 32 - SPI-3 DATA CAPTURE REGISTER
                                                                                   (REGISTERS 0x01 and 0x09)
           Field                  Bits       Length         Initial Value
    DATA_AVAILABLE                 0           1                 0b0                          Field                  Bits      Length          Initial Value
    Reserved                      7:1          7                0x00                          DATA                   7:0          8                 0x00
   A SPI-3 Data Capture Control Register has read and write access in the direct      A SPI-3 Data Capture Register has read-only access in the direct register
register access space. Write a zero to DATA_AVAILABLE to clear the transfer.       access space. The microprocessor uses these registers to capture data from
The microprocessor uses these registers to capture data from a SPI-3 ingress.      a SPI-3 ingress.
   The SPI-3 Data Capture Control Register for SPI-3 port A is register 0x00.         The SPI-3 Data Capture Register for SPI-3 port A is register 0x01.
   The SPI-3 Data Capture Control Register for SPI-3 port B is register 0x08.         The SPI-3 Data Capture Register for SPI-3 port B is register 0x09.
   The bit field of the SPI-3 Data Capture Control Register is described.             The bit field of the SPI-3 Data Capture Register is described.
   DATA_AVAILABLE The SPI-3 capture data buffer is full and ready for                 DATA The SPI-3 capture data buffer is read from this field.
reading.
                                                                                 50                                                           APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                               INDUSTRIAL TEMPERATURE RANGE
SPI-4 data insert control register                                                     SPI-3 data insert control register
TABLE 33 - SPI-4 DATA INSERT CONTROL REGISTER                                          TABLE 36 - SPI-3 DATA INSERT CONTROL REGISTER
(REGISTERS 0x02 and 0x0A)                                                              (REGISTERS 0x05 and 0x0D)
           Field                  Bits         Length           Initial Value                     Field                  Bits       Length           Initial Value
    DATA_AVAILABLE                   0             1                 0b0                   DATA_AVAILABLE                  0            1                 0b0
    Reserved                        7:1            7                0x00                   Reserved                       7:1           7                0x00
   A SPI-4 data insert control register has read and write access in the direct           A SPI-3 data insert control register has read and write access in the direct
register access space. The microprocessor uses these registers to insert data          register access space. The microprocessor uses these registers to insert data
into a SPI-3 ingress.                                                                  into a SPI-4 ingress.
   The SPI-4 data insert control register for SPI-3 port A is register 0x02.              The SPI-3 Data Insert Control Register for SPI-3 port A is register 0x05.
   The SPI-4 data insert control register for SPI-3 port B is register 0x0A.              The SPI-3 Data Insert Control Register for SPI-3 port B is register 0x0D.
   The bit field of the SPI-4 data insert control register is described.                  The bit field of the SPI-3 Data Insert Control Register is described.
   DATA_AVAILABLE The SPI-4 insert data buffer is empty and ready for                     DATA_AVAILABLE The SPI-3 insert data buffer is empty and available for
writing.                                                                               writing.
SPI-4 data insert register                                                             SPI-4 data capture register
TABLE 34 - SPI-4 DATA INSERT REGISTER                                                  TABLE 37 - SPI-4 DATA CAPTURE REGISTER
(REGISTERS 0x03 and 0x0B)                                                              (REGISTERS 0x06 and 0x0E)
           Field                  Bits         Length           Initial Value                     Field                  Bits       Length           Initial Value
           DATA                     7:0            8                 0x00                         DATA                    7:0           8                 0x00
   A SPI-4 data insert register has write-only access in the direct register access       A SPI-4 data capture register has read-only access in the direct register
space. The microprocessor uses these registers to insert data into a SPI-3             access space. The microprocessor uses these registers to capture data from
ingress.                                                                               a SPI-4 ingress.
   The SPI-4 Data Insert Register for SPI-3 port A is register 0x03.                      The SPI-4 Data Capture Register for SPI-3 port A is register 0x06
   The SPI-4 Data Insert Register for SPI-3 port B is register 0x0B.                      The SPI-4 Data Capture Register for SPI-3 port B is register 0x0E.
   The bit field of the SPI-4 Data Insert Register is described.                          The bit field of the SPI-4 Data Capture Register is described.
   DATA The SPI-4 insert data buffer is written to this field.                            DATA The SPI-4 capture data buffer is read from this field.
SPI-4 data capture control register                                                    SPI-3 data insert register
TABLE 35 - SPI-4 DATA CAPTURE CONTROL                                                  TABLE 38 - SPI-3 DATA INSERT REGISTER (REGIS-
REGISTERS (REGISTERS 0x04 and 0x0C)                                                    TERS 0x07 and 0x0F)
                                                                                                  Field                  Bits       Length           Initial Value
           Field                  Bits         Length           Initial Value
                                                                                                  DATA                    7:0           8                 0x00
    DATA_AVAILABLE                   0             1                 0b0
    Reserved                        7:1            7                0x00                  A SPI-3 Data Insert Register has write-only access in the direct register
                                                                                       access space. The microprocessor uses these registers to insert data into a SPI-
   A SPI-4 Data Capture Control Register has read and write access in the direct       4 ingress.
register access space. The microprocessor uses these registers to capture data            The SPI-3 Data Insert Register for SPI-3 port A is register 0x07.
from a SPI-3 ingress.                                                                     The SPI-3 Data Insert Register for SPI-3 port B is register 0x0F.
   The SPI-4 Data Capture Control Register for SPI-3 port A is register 0x04.             The bit field of the SPI-3 Data Capture Register is described.
   The SPI-4 Data Capture Control Register for SPI-3 port B is register 0x0C.
   The bit field of the SPI-4 Data Capture Control Register is described.                 DATA The SPI-3 insert data buffer is written from this field.
   DATA_AVAILABLE The SPI-4 capture data buffer is full and ready for
reading.
                                                                                    51                                                              APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                                   INDUSTRIAL TEMPERATURE RANGE
Software reset                                                                                SPI4_INACTIVE_TRANSFER_I                  SPI-4 ingress inactive transfer inter-
TABLE 39 - SOFTWARE RESET REGISTER (0x20 in                                               rupt indication.
the direct accessed space)                                                                    0=No indication
           Field                  Bits        Length               Initial Value              1=One or more inactive transfers have been registered on the SPI-4 ingress
    SW_RESET                        0              1                      0
    INIT_DONE                       1              1                      0                   DCLK_UN_I         SPI-4 ingress data clock has transitioned from available
    Reserved                       7:2             6                      0               to an unavailable condition interrupt indication.
    The software reset bit is writable from the direct accessed memory space.                 0=No detection, I_DCLK is available
Write a “1” to the SW_RESET bit to initiate the software reset. The SW_RESET                  1=I_DCLK transitioned from available to an unavailable state
bit will clear to a “0” after the chip has initialized itself. The INIT_DONE bit is set
to a “1” when the initialization following reset has completed. The software reset            E_DIP_ERR_I SPI-4 egress DIP-2 error interrupt indication on the SPI-
is the same as the hardware. The Reserved field must be set to 0.                         4 egress status channel.
    The Initial Value column in this document is the value of the register after reset        0=No errors
has completed.                                                                                1=One or more DIP-2 errors have been registered
    SW_RESET Setting the SW_RESET bit initiates a software reset of the chip.
                      The SW_RESET bit is self-clearing.                                      E_SYNCH_I         SPI-4 egress status channel has transitioned from out of
                           0=No operation is performed                                    synchronization to an in synchronization condition interrupt indication.
                           1=Initiate a software reset                                        0=No detection, still not in synchronization
                                                                                              1=Transition from out of synchronization to in synchronization, or transition
    INIT_DONE Status indication bit following a reset.                                    from in synchronization to out of synchronization.
                           0=Chip has not completed initialization following reset
                           1= Chip has completed initialization following reset               SCLK_UN_I         SPI-4 egress status clock has transitioned from available
                                                                                          to an unavailable condition interrupt indication.
SPI-4 status register (0x22 in the direct accessed                                            In LVTTL mode the Bridgeport does not detect the SPI-4 egress status clock
space)                                                                                    (E_SCLK_T). Therefore, for LVTTL mode the software should ignore the
                                                                                          SCLK_UN field in the SPI-4 Status Register.
TABLE 40 - SPI-4 STATUS REGISTER (0x22 IN THE                                                 0=No detection, E_SCLK is available
DIRECT ACCESSED SPACE)                                                                        1=E_SCLK transitioned from available to an unavailable state
                    Field                       Bits           Length       Initial Val
 I_DIP_ERR_I                                      0               1              0        SPI-4 enable register (0x23 in the direct accessed
 I_SYNCH_I                                        1               1              0        space)
 I_BUS_ERR_I                                      2               1              0        TABLE 41 - SPI-4 ENABLE REGISTER (0x23 IN
 SPI4_INACTIVE_TRANSFER_I                         3               1              0        THE DIRECT ACCESSED SPACE)
 DCLK_UN_I                                        4               1              0
 E_DIP_ERR_I                                      5               1              0                          Field                      Bits        Length       Initial Val
 E_SYNCH_I                                        6               1              0         I_DIP4_ERR_EN                                 0              1            0
 SCLK_UN_I                                        7               1              0         I_SYNCH_EN                                    1              1            0
    The SPI-4 Status Register (0x22 in the direct accessed space) has read                 I_BUS_ERR_EN                                  2              1            0
access, and interrupt status fields are cleared by a microprocessor write cycle,           SPI4_INACTIVE_TRANSFER_EN                     3              1            0
where a logical one must be written to clear the field(s) targeted.                        DCLK_UN_EN                                    4              1            0
    The SPI-4 Status Register is a secondary interrupt status register and can             E_DIP_ERR_EN                                  5              1            0
only be active if the SPI-4 field is active in the Primary Interrupt Status Register       E_SYNCH_EN                                    6              1            0
(Direct 0x2C).
                                                                                           SCLK_UN_EN                                    7              1            0
    I_DIP_ERR_I SPI-4 ingress DIP-4 error interrupt indication.
    0=No errors                                                                               The SPI-4 Enable Register (0x23 in the direct accessed space) has read
    1=One or more DIP-4 errors have been registered on the SPI-4 ingress                  and write access. SPI-4 Enable Register is used to bitwise enable the interrupts
                                                                                          in the SPI-4 Status Register.
    I_SYNCH_I             SPI-4 ingress data path has transitioned from out of
synchronization to in synchronization condition interrupt indication.                         I_DIP4_ERR_EN SPI-4 ingress DIP-4 error interrupt indication enable.
    0=No detection, still not in synchronization                                              0=Disable DIP-4 error interrupt
    1=Transition from out of synchronization to in synchronization, or transition             1=Enable DIP-4 error interrupt
from in synchronization to out of synchronization.
                                                                                              I_SYNCH_EN SPI-4 ingress data path has transitioned from out of
    I_BUS_ERR_I SPI-4 ingress bus error interrupt indication.                             synchronization to in synchronization condition interrupt indication enable.
    0=No errors                                                                               0=Disable synchronization interrupt
    1=One or more bus errors have been registered on the SPI-4 ingress                        1=Enable synchronization interrupt
                                                                                        52                                                               APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                              INDUSTRIAL TEMPERATURE RANGE
   I_BUS_ERR_EN             SPI-4 ingress bus error interrupt indication enable.          SPI-34_CAPTURE SPI-3 ingress to SPI-4 egress capture event inter-
   0=Disable bus error interrupt                                                       rupt indication.
   1=Enable bus error interrupt                                                           0=No capture event
                                                                                          1=Buffer is ready for reading by the microprocessor
   SPI4_INACTIVE_TRANSFER_EN SPI-4 ingress inactive transfer inter-
rupt indication enable.                                                                   SPI-43_CAPTURE SPI-4 ingress to SPI-3 egress capture event interrupt
   0=Disable inactive transfer interrupt                                               indication.
   1=Enable inactive transfer interrupt                                                   0=No capture event
                                                                                          1=Buffer is ready for reading by the microprocessor
   DCLK_UN_EN SPI-4 ingress data clock has transitioned from available
to an unavailable condition interrupt indication enable.                                  SPI-34_INSERT SPI-3 ingress to SPI-4 egress insert event interrupt
   0=Disable unavailable interrupt                                                     indication.
   1=Enable unavailable interrupt                                                         0=No insert event
                                                                                          1=Buffer is ready for writing by the microprocessor
   E_DIP_ERR_EN             SPI-4 egress DIP-2 error interrupt indication enable
on the SPI-4 egress status channel.                                                       SPI-43_INSERT SPI-4 ingress to SPI-3 egress insert event interrupt
   0=Disable DIP-2 error interrupt                                                     indication.
   1=Enable DIP-2 error interrupt                                                         0=No insert event
                                                                                          1=Buffer is ready for writing by the microprocessor
   E_SYNCH_EN SPI-4 egress status channel has transitioned from out of
synchronization to in synchronization condition interrupt indication enable.              PMON Performance Monitor event interrupt indication. Writing to this field has
   0=Disable synchronization interrupt                                                 no effect.
   1=Enable synchronization interrupt                                                     0=No PMON event
                                                                                          1=PMON event is ready for reading by the microprocessor
   SCLK_UN_EN SPI-4 egress status clock has transitioned from available
to an unavailable condition interrupt indication enable. SCLK_UN_EN should             Module enable register (0x28 and 0x29 in the
be written as a zero if using a SPI-4 egress LVTTL status clock that is less than      direct accessed space)
one-half of the MCLK frequency. The SCLK_UN_I interrupt indication is not
                                                                                       TABLE 43 - MODULE ENABLE REGISTER (0x28
usable in this case.
                                                                                       AND 0x29 IN THE DIRECT ACCESSED SPACE)
   0=Disable unavailable interrupt
   1=Enable unavailable interrupt                                                                       Field                  Bits       Length Initial Value
                                                                                          SPI-34 CAPTURE_EN                      0           1                 0
Module status register (0x24 and 0x25 in the direct                                       SPI-43 CAPTURE_EN                      1           1                 0
accessed space)                                                                           SPI-34 INSERT_EN                       2           1                 0
TABLE 42 - MODULE STATUS REGISTER (0x24                                                   SPI-43 INSERT_EN                       3           1                 0
AND 0x25 IN THE DIRECT ACCESSED SPACE)                                                    PMON_EN                                4           1                 0
                  Field                  Bits            Length Initial Value             Reserved                              7:5          3                 0
   SPI-34_CAPTURE                           0               1              0
   SPI-43_CAPTURE                           1               1              0              The Module Enable registers (0x28 and 0x29 in the direct accessed space)
                                                                                       have read and write access.
   SPI-34_INSERT                            2               1              0
                                                                                          Module Enable Register 0x28 is for module A.
   SPI-43_INSERT                            3               1              0              Module Enable Register 0x29 is for module B.
   PMON                                     4               1              0
   Reserved                                7:5              3              0              SPI-34_CAPTURE_EN SPI-3 ingress to SPI-4 egress capture event
   The Module Status registers (0x24 and 0x25 in the direct accessed space)            interrupt enable.
have read and write access, and interrupt status fields are cleared by a                  0=Disable capture interrupt
microprocessor write cycle, where a logical one must be written to clear the              1=Enable capture interrupt
field(s) targeted, except for the PMON field, which can not be cleared.
   The Module Status registers are secondary interrupt status registers and can           SPI-43_CAPTURE_EN SPI-4 ingress to SPI-3 egress capture event
only be active if the corresponding field is active in the Primary Interrupt Status    interrupt enable.
Register (Direct 0x2C):                                                                   0=Disable capture interrupt
                                                                                          1=Enable capture interrupt
   Module Status Register 0x24 is for module A, and can only be active if the
MODULE_A field is active in the Primary Interrupt Status Register.                        SPI-34_INSERT_EN SPI-3 ingress to SPI-4 egress insert event interrupt
                                                                                       enable.
   Module Status Register 0x25 is for module B, and can only be active if the             0=Disable insert interrupt
MODULE_B field is active in the Primary Interrupt Status Register.                        1=Enable insert interrupt
                                                                                    53                                                           APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                             INDUSTRIAL TEMPERATURE RANGE
   SPI-43_INSERT_EN              SPI-4 ingress to SPI-3 egress insert event             SPI-4 When active, the SPI-4 field is responsible for allowing an interrupt
interrupt enable.                                                                   in the SPI-4 status register (secondary interrupt register 0x22).
   0=Disable insert interrupt                                                           0=No SPI-4 interrupt active
   1=Enable insert interrupt                                                            1=SPI-4 interrupt is active
   PMON_EN             Performance Monitor event interrupt enable.                      SECONDARY When active, the SECONDARY field is responsible for
   0=Disable PMON interrupt                                                         allowing an interrupt in the Secondary Interrupt Status Register (secondary
   1=Enable PMON interrupt                                                          interrupt register 0x2D).
                                                                                        0=No SECONDARY interrupt active
Primary interrupt status register (0x2C in the                                          1=SECONDARY interrupt is active
direct accessed space)
                                                                                    Secondary interrupt status register (0x2D in the
TABLE 44 - PRIMARY INTERRUPT STATUS REGIS-
                                                                                    direct accessed space)
TER (0x2C IN THE DIRECT ACCESSED SPACE)
                 Field                    Bits        Length Initial Value          TABLE 45 - SECONDARY INTERRUPT STATUS
  MODULE_A                                  0             1             0           REGISTER (0x2D IN THE DIRECT ACCESSED SPACE)
  MODULE_B                                  1             1             0                            Field                     Bits       Length       Initial Value
  Reserved                                  2             1             0              TIME_BASE                                 0             1              0
  Reserved                                  3             1             0              INDIRECT_ACCESS                           1             1              0
  SPI-4                                     4             1             0              Reserved                                 7:2            6              0
  SECONDARY                                 5             1             0               The secondary interrupt status register (0x2D in the direct accessed space)
  Reserved                                 7:6            2             0           has read and write access.
                                                                                        The secondary interrupt status register has read access, and Interrupt status
   The primary interrupt status register (0x2C in the direct accessed space) has
                                                                                    fields are cleared by a microprocessor write cycle, where a logical one must
read-only access. The interrupts for the primary interrupt status register must
                                                                                    be written to clear the field(s) targeted.
be acknowledged by servicing the corresponding secondary interrupt status
                                                                                        The secondary interrupt status register is a secondary interrupt status register
registers.
                                                                                    and can only be active if the SECONDARY_EN field is active in the primary
                                                                                    interrupt enable register (Direct 0x2C).
   MODULE_A            When active, the MODULE_A field is responsible for
allowing an interrupt in the Module Status Register (secondary interrupt register
                                                                                        TIME_BASE          Time base expiration interrupt indication.
0x24).
                                                                                        0=No time base event
   0=No MODULE_A interrupt active
                                                                                        1=Time base has expired
   1=MODULE_A interrupt is active
                                                                                        INDIRECT_ACCESS                Indirect access completion interrupt indication.
   MODULE_B            When active, the MODULE_B field is responsible for
                                                                                        0=No indirect access event
allowing an interrupt in the module status register (secondary interrupt register
                                                                                        1=Indirect access has completed
0x25).
   0=No MODULE_B interrupt active
   1=MODULE_B interrupt is active
                                                                                  54                                                               APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                             INDUSTRIAL TEMPERATURE RANGE
Primary interrupt enable register (0x2E in the                                           SECONDARY_EN             SECONDARY interrupt enable.
direct accessed space)                                                                   0=Disable SECONDARY interrupt
                                                                                         1=Enable SECONDARY interrupt
TABLE 46 - PRIMARY INTERRUPT ENABLE REGIS-
TER (0x2E IN THE DIRECT ACCESSED SPACE)                                               Secondary interrupt enable register (0x2F in the
                                                                                      direct accessed space)
                 Field                  Bits         Length       Initial Value
   MODULE_A_EN                             0              1              0            TABLE 47 - SECONDARY INTERRUPT ENABLE
                                                                                      REGISTER (0x2F IN THE DIRECT ACCESSED SPACE)
   MODULE_B_EN                             1              1              0
   Reserved                                2              1              0                             Field                   Bits       Length       Initial Value
   Reserved                                3              1              0              TIME_BASE_EN                            0             1               0
   SPI4_EN                                 4              1              0              INDIRECT_ACCESS_EN                      1             1               0
   SECONDARY_EN                            5              1              0              Reserved                               7:2            6               0
   Reserved                              7:6              2              0               The secondary interrupt enable register (0x2F in the direct accessed space)
                                                                                      has read and write access.
    The primary interrupt enable register (0x2E in the direct accessed space)            The secondary interrupt enable register is used to bitwise enable the
has read and write access.                                                            interrupts in the secondary interrupt enable register.
    The Primary Interrupt Enable Register is used to bitwise enable the interrupts
in the Primary Interrupt Status Register.                                                TIME_BASE_EN            Time base expiration interrupt enable.
                                                                                         0=Disable time base event interrupt
    MODULE_A_EN            MODULE_A interrupt enable.                                    1=Enable time base event interrupt
    0=Disable MODULE_A interrupt
    1=Enable MODULE_A interrupt                                                          INDIRECT_ACCESS_EN               Indirect access completion interrupt enable.
                                                                                         0= Disable indirect access completion event interrupt
    MODULE_B_EN MODULE_B interrupt enable.                                               1=Enable indirect access completion event interrupt
    0=Disable MODULE_B interrupt
    1=Enable MODULE_B interrupt
    SPI-4_EN        SPI-4 interrupt enable.
    0=Disable SPI-4 interrupt
    1=Enable SPI-4 interrupt
                                                                                   55                                                             APRIL 10, 2006


IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                 INDUSTRIAL TEMPERATURE RANGE
9.3 Indirect registers for SPI-3A and SPI-3B
modules
Module A is at Module_base 0x0000
Module B is at Module_base 0x2000
TABLE 48 - MODULE A/B INDIRECT REGISTER
  Table Number, Page Block_base, Register_offset Title of Register
  49, page 57        0x0000, 0x00-0xFF           SPI-3 ingress LP to LID map
  50, page 57        0x0200, 0x00                SPI-3 general configuration register
  51, page 58        0x0200, 0x01                SPI-3 ingress configuration register
  52, page 58        0x0200, 0x02                SPI-3 ingress fill level register
  53, page 58        0x0200, 0x03                SPI-3 ingress max fill level register
  54, page 58        0x0500, 0x00-0x3F           SPI-3 egress LID to LP map
  55, page 59        0x0700, 0x00                SPI-3 egress configuration register
  56, page 59        0x0700, 0x01                SPI-4 ingress to SPI-4 egress flow control register
  57, page 59        0x0700, 0x02                SPI-3 egress test register
  58, page 60        0x0700, 0x03                SPI-3 egress fill level register
  59, page 60        0x0700, 0x04                SPI-3 egress max fill level register
  60, page 61        0x0A00, 0x00-0x17F          LID associated event counters
  61, page 61        0x0C00, 0x00-0x0B           Non LID associated event counters
  62, page 62        0x0C00, 0x0C                Non LID associated interrupt indication register
  63, page 62        0x0C00, 0x0D                Non LID associated interrupt enable register
  64, page 62        0x0C00, 0x0E                LID associated interrupt indication register
  65, page 62        0x0C00, 0x0F                LID associated interrupt enable register
  66, page 63        0x0C00, 0x10-0x15           Non critical LID associated capture table
  67, page 63        0x0C00, 0x16-0x17           SPI-3 to SPI-4 critical LID interrupt indication registers
  68, page 63        0x0C00, 0x18-0x19           SPI-3 to SPI-4 critical LID interrupt enable registers
  69, page 63        0x0C00, 0x1A-0x1B           SPI-4 to SPI-3 critical LID interrupt indication registers
  70, page 63        0x0C00, 0x1C-0x1D           SPI-4 to SPI-3 critical LID interrupt enable registers
  71, page 63        0x0C00, 0x1E                Critical events source indication register
  72, page 64        0x1000, 0x00-0x3F           SPI-3 ingress packet length configuration register
  73, page 64        0x1100, 0x00-0x3F           SPI-4 egress port descriptor table
  74, page 64        ———————-                    SPI-4 egress direction code assignment
  75, page 64        0x1200, 0x00-0x3F           SPI-3 ingress port descriptor table
  76, page 65        0x1300, 0x00                SPI-3 to SPI-4 PFP register
  77, page 65        ———————-                    NR_LID field encoding
  78, page 65        0x1300, 0x01                SPI-3 to SPI-4 flow control register
  79, page 66        0x1600, 0x00-0x3F           SPI-4 ingress packet length register
  80, page 66        0x1700, 0x00-0x3F           SPI-3 egress port descriptor table
  81, page 66        ———————-                    SPI-3 egress direction code assignment
  82, page 66        0x1800, 0x00-0x3F           SPI-4 ingress port descriptor table
  83, page 67        0x1900, 0x00                SPI-4 to SPI-3 PFP register
  84, page 67        ———————-                    NR_LID field encoding
                                                      56                                                    APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                               INDUSTRIAL TEMPERATURE RANGE
9.3.1 Block base 0x0000 registers                                                    9.3.2 Block base 0x0200 registers
SPI-3 ingress LP to LID map (Block_base 0x0000 +                                     SPI-3 general configuration register (Block_base
Register_offset 0x00 to 0xFF)                                                        0x0200 + Register_offset 0x00)
TABLE 49 - SPI-3 INGRESS LP TO LID MAP                                               TABLE 50 - SPI-3 GENERAL CONFIGURATION
          Field               Bits        Length            Initial Value            REGISTER (REGISTER_OFFSET=0x00)
    LID                        5:0           6                   0x00                              Field               Bits       Length           Initial Value
    ENABLE                      6            1                    0b0                      LINK                          0            1                  0b0
    BIT_REVERSAL                7            1                    0b0                      PACKET                        1             1                 0b1
   There are 256 SPI-3 ingress Logical Port (LP) to Logical Identifier (LID)               SPI3_ENABLE                   2             1                 0b0
registers, one per potential SPI-3 LP. Only 64 LPs per SPI-3 physical interface            BUSWIDTH                      3             1                 0b0
can be enabled. An attempt to enable more than 64 LPs per SPI-3 physical                   EVEN_PARITY                   4             1                 0b0
interface or to assign an identical LID to more than one LP will be discarded              PARITY_EN                     5            1                  0b1
and an error code will be returned. The ENABLE bit is used to enable SPI-                  Reserved                      6             1                 0b0
3 logical ports. All data from non-enabled SPI-logical ports is discarded and              Reserved                      7             1                 0b0
an inactive SPI-3 logical port event is generated. This event is directed towards
                                                                                           WATERMARK                   12:8            5                0x0F
the PMON & DIAG module. Disabled ports always generate available status.
                                                                                           Reserved                    31:13          19                0x000
   The Table 49 - SPI-3 ingress LP to LID Map assigns a LID to a SPI-3 logical
port. LID mapping for 64 out of 256 SPI-3 logical ports is supported on each              There is one register for SPI-3 general configuration per SPI-3 interface.
SPI-3 physical port. LPs in the SPI Exchange are 8 bits wide[7:0] and range          Each register has read and write access. The address for module A is 0x0200,
from 0 to 255. An example of mapping SPI-3 physical interface “A”, LP 0x08           and the address for module B is 0x2200. The bit fields of the SPI-3 general
to LID 0x05, activating the LID, and not using bit reversal is outlined.             configuration register are described in the following paragraphs.
   Perform an indirect write of 0x45 to register address Module_base 0x0000
+ Block_base 0x0000 + Register_offset 0x08 = 0x0008. Another example of                   LINK A SPI-3 interface can be used either in Link or PHY modes. For
SPI-3 LP to LID mapping is to map SPI-3 “B”, LP 0xFF to LID 0x3F, write 0x7F         connecting to a transmission line-interface PHY, program the SPI Exchange for
to register Module_base 0x2000 + Block_base 0x0000 + Register_offset                 Link mode. For connecting the SPI-3 interface to an NPU or other Link-mode
0xFF = 0x20FF.                                                                       device, program the SPI-3 interface for PHY mode. Note that the two SPI-3
   The Initial Value column is the value of the register after reset.                interfaces can be independently configured into either Link or PHY modes. The
                                                                                     SPI-3 ingress and egress of a given SPI-3 physical port will always be in the
   LID The LID programmed is associated to the LP with the same                      same mode.
number as the register address. Six bits support the 64 simultaneously active                      0= SPI-3 interface in PHY mode
LIDs per SPI-3 physical interface.                                                                 1= SPI-3 interface in Link mode
   ENABLE        This bit is used to enable or disable the connection of this LP          PACKET A SPI-3 interface can be used either in BYTE or PACKET
to this LID.                                                                         modes. A SPI-3 interface acting as a Link layer device can poll the attached PHY
                 0=LID disabled                                                      device for up to 64 LPs if the attached PHY device supports the polling interface.
                 1=LID enabled                                                       When attached to a PHY device that only supports byte mode, the four direct
                                                                                     status indicators can be used. Note that the two SPI-3 interfaces can be
   BIT_REVERSAL This bit is used to reverse the bit ordering of each byte            independently configured into either BYTE or PACKET modes. When the SPI
of the SPI-3 interface on a per-LID basis.                                           Exchange is in PHY mode, the PACKET bit is used to select either a polled or
                 0=Disable bit reversal for this LID                                 direct status response to the attached Link device.
                 1=Enable bit reversal for this LID                                                0 = BYTE mode with direct status indication for up to 4 LPs [3:0]
                                                                                                   1= PACKET mode with polled status for up to 64 LPs
                                                                                          SPI3_ENABLE A SPI-3 interface can be enabled or disabled according
                                                                                     to the state programmed into this bit. A port should be disabled to save power
                                                                                     if it is not used.
                                                                                                   0=SPI-3 Physical port disabled, outputs are in tristate
                                                                                                   1=SPI-3 Physical port enabled
                                                                                          BUSWIDTH A SPI-3 interface can be used as either a single 8-bit or 32-
                                                                                     bit interface, according to the needs of the attached device. The SPI-3 ingress
                                                                                     and egress of a given SPI-3 physical port will always be of the same bus width.
                                                                                                   0=32 bit SPI-3 interface
                                                                                                   1=8 bit SPI-3 interface
                                                                                  57                                                                APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                                        INDUSTRIAL TEMPERATURE RANGE
    EVEN_PARITY A SPI-3 interface is provisioned to generate and to check                   SPI-3 ingress fill level register (Block_base 0x0200
for odd or even parity. The PARITY_EN bit must be set for this to become                    + Register_offset 0x02)
effective. Odd parity is standard for SPI-3 interfaces.
             0=Odd parity on this port                                                      TABLE 52 - SPI-3 INGRESS FILL LEVEL REGISTER
             1=Even parity on this port                                                     (REGISTER_OFFSET=0x02)
                                                                                                         Field              Bits           Length           Initial Value
    PARITY_EN A SPI-3 interface is provisioned to enable or disable parity                       FILL_CUR                      4:0             5                  0x00
generation and checking, according to the state of the EVEN_PARITY bit.                          I_FCLK_AV                      5              1                  0b1
             0=Disable parity on this SPI-3 port                                                There is one register for SPI-3 ingress fill level register per SPI-3 interface.
             1=Enable parity on this SPI-3 port                                             Each register has read-only access. The bit fields of a SPI-3 ingress fill level
                                                                                            register are described.
    WATERMARK A SPI-3 interface can be set to a SPI-3 ingress port
watermark value. 0x10 is the highest watermark that can be set, meaning all                     FILL_CUR Current SPI-3 ingress buffer fill level. Since this is a real-time
ingress buffers will be full before backpressure will be initiated on a SPI-3 ingress       register, the value read from it will change rapidly and is used for internal
interface. The WATERMARK field value of 0x08 is used to set the watermark                   diagnostics only.
for a half-full ingress buffer before tripping backpressure. The units of WATER-
MARK are one-sixteenth of the available ingress buffering per unit. Each unit                   I_FCLK_AV Current SPI-3 ingress clock availability is checked here.
is equal to 128 bytes. BACKPRESSURE_EN must be set [Register_offset 0x01]                                            0=SPI-3 ingress clock not detected on a SPI-3 port
for the watermark to become effective. The watermark field is usually set to 0x10,                                   1=SPI-3 ingress clock transitions detected on a SPI-3 port
and the FREE_SEGMENT field of Table 75, SPI-3 ingress port descriptor tables
(Block_base 0x1200) is used for per LID backpressure.                                       SPI-3 ingress max fill register (Block_base 0x0200
                                                                                            + Register_offset 0x03)
SPI-3 ingress configuration register (Block_base
0x0200 + Register_offset 0x01)                                                              TABLE 53 - SPI-3 INGRESS MAX FILL LEVEL
                                                                                            REGISTER (REGISTER_OFFSET=0x03)
TABLE 51 - SPI-3 INGRESS CONFIGURATION
                                                                                                         Field              Bits           Length           Initial Value
REGISTER (REGISTER_OFFSET=0x01)
                                                                                                 FILL_MAX                      4:0             5                  0x00
             Field                      Bits        Length           Initial Value
                                                                                                There is one register for SPI-3 ingress max fill level register per SPI-3
  BACKPRESSURE_EN                         0              1                0b1
                                                                                            interface. Each register has read-only access, and is cleared after reading.
  FIX_LP                                  1             1                0b0
                                                                                            0x10 is the highest filling level, meaning all ingress buffers had been full at some
  Reserved                              31:2            30              0x0000              time since the last read of the FILL_MAX field. The units of FILL_MAX are one-
    There is one register for SPI-3 ingress configuration per SPI-3 interface.              sixteenth of the available ingress buffering. Each unit is equal to 128 bytes. The
Each register has read and write access.                                                    bit field of a SPI-3 ingress max fill level register is described. The Table 53 - SPI-
    The bit fields for a SPI-3 ingress configuration register are described in the          3 ingress max fill level register (Register_offset=0x03) is for diagnostics only.
following paragraphs.
                                                                                                FILL_MAX Maximum SPI-3 ingress buffer fill level since the last read of
    BACKPRESSURE_EN A SPI-3 interface can have backpressure                                 the SPI-3 ingress max fill level register.
enabled or disabled. Disabling backpressure means that data coming into the
ingress may be lost if the SPI-3 interface ingress buffers overflow. The SPI-3              9.3.3 Block base 0x0500 registers
interface can run at full-rate, however, since there will be no backpressure.               SPI-3 egress LID to LP map (Block_base 0x0500 +
Attached devices that do not respond properly to backpressure should be                     Register_offset 0x00-0x3F)
interfaced by disabling backpressure.
                                                                                            TABLE 54 - SPI-3 EGRESS LID TO LP MAP
    Enabling backpressure will cause the I_ENB signal to be asserted when the
ingress buffer fill level is equal to the WATERMARK value [Register_offset 0x00],                         Field                  Bits         Length            Initial Value
or the free segment buffer threshold Table 75, SPI-3 ingress port descriptor table            LP                                   7:0             8                0x00
(Block_base 0x1200) has been reached for any active LID.                                      ENABLE                                8              1                0b0
                           0=Disable backpressure on this SPI-3 ingress.                      BIT_REVERSAL                          9              1                0b0
                           1=Enable backpressure on this SPI-3 ingress interface.               There are 64 SPI-3 egress LID to LP maps per SPI-3 interface, one per
                                                                                            potential SPI-3 LID.
    FIX_LP A SPI-3 interface can fix the logical port address to 0x00. This                     The SPI-3 egress LID to LP maps have read and write access. The SPI-
is useful when there is only one LP on an interface, such as with some single-              3 egress LID to LP maps are used to map SPI-3 egress logical identifiers to SPI-
PHY devices.                                                                                3 logical port addresses that are in-band with the SPI-3 egress packet fragments.
                           0= Do not fix logical port address to 0x00, but use the actual
                           LP found in the packet fragments.
                           1= Fix logical port address to 0x00
                                                                                          58                                                                   APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                             INDUSTRIAL TEMPERATURE RANGE
   LP      The LP programmed is associated to the LID with the same number         SPI-4 ingress to SPI-3 egress flow control register
as the register address.                                                           (Block_base 0x0700 + Register_offset 0x01)
   ENABLE This bit is used to enable or disable the connection of a LID to         TABLE 56 - SPI-4 INGRESS TO SPI-3 EGRESS FLOW
an LP.                                                                             CONTROL REGISTER (REGISTER_OFFSET=0x01)
           0=LP disabled                                                                        Field                Bits          Length           Initial Value
           1=LP enabled                                                               CREDIT_EN                        0              1                 0b0
                                                                                      BURST_EN                         1              1                 0b0
   BIT_REVERSAL This bit is used to reverse the bit ordering of each byte             LOOP_BACK                        2              1                 0b0
of the SPI-3 interface on a per-LP basis.                                             Reserved                       31:3            29                 0x00
           0=Disable bit reversal for an LP
           1=Enable bit reversal for an LP                                             The SPI-4 ingress to SPI-3 egress flow control register has read and write
                                                                                   access. The bit fields of the SPI-4 ingress to SPI-3 egress flow control register
                                                                                   are described.
9.3.4 Block base 0x0700 registers
                                                                                       CREDIT_EN           CREDIT_EN The flow control information received from
SPI-3 egress configuration register (Block_base                                    the attached SPI-3 device is intrepreted as status or credit information as selected
0x0700 + Register_offset 0x00)                                                     by the CREDIT_EN bit in the SPI-4 ingress to SPI-3 egress flow control Register.
TABLE 55 - SPI-3 EGRESS CONFIGURATION                                              If the status mode is used, data will be egressed until the status is changed by
REGISTER (REGISTER_OFFSET=0x00)                                                    the attached SPI-3 device. If the credit mode is used, the SPI-3 egress will
           Field                 Bits      Length            Initial Value         transmit only one packet fragment and then wait for an update in the internal buffer
  POLL_LENGTH                    5:0           6                  0x0F             segment pool status before sending another packet fragment.
  Reserved                       7:6           2                  0b00                          0=Status mode
                                                                                                1=Credit mode
  STX_SPACING                     8            1                   0b0
  EOP_SPACING                     9            1                   0b0
                                                                                       BURST_EN            Multiple Burst Enable allows more than one burst to be sent
  Reserved                      31:10         22                  0x00             to an LP. When this feature is not enabled, only one burst per LP is allowed into
   There is one SPI-3 egress configuration register per SPI-3 interface. The       the SPI-3 egress buffers.
SPI-3 egress configuration registers have read and write access. A SPI-3                        0=Disable burst enable
egress configuration registers is used to control the poll sequence length of a                 1=Enable burst enable
SPI-3 egress interface when the SPI-3 interface is in Link mode. The SPI-3
egress configuration register is used to add two cycles to STX or EOP as               LOOP_BACK In this mode the contents of a SPI-3 ingress are directly
required to interface to the attached device.                                      transferred to a SPI-3 egress buffers of the same port. This mode is useful for
                                                                                   off-line diagnostics.
   POLL_LENGTH Link layer poll sequence length when in Link mode. The                           0=Disable loopback
poll sequence is from the LP associated with LID0 to the LP associated with the                 1=Enable loopback
LID for POLL_LENGTH - 1.
                                                                                   SPI-3 egress test register (Block_base 0x0700 +
   STX_SPACING This bit is used to enable or disable the adding of two             Register_offset 0x02)
dummy STX cycles to a SPI-3 egress interface to meet the needs of an attached      TABLE 57 - SPI-3 EGRESS TEST REGISTER
device.                                                                            (REGISTER_OFFSET=0x02)
           0= No dummy STX cycles are added to a SPI-3 egress.                                  Field                Bits          Length           Initial Value
           1= Two dummy STX cycles are added to a SPI-3 egress                        ADD_PAR_ERR                      0             1                  0b0
                                                                                      DAT_PAR_ERR                      1             1                  0b0
   EOP_SPACING This bit is used to enable or disable the adding of two
                                                                                      Reserved                        7:2            6                  0x00
dummy EOP cycles to a SPI-3 egress interface to meet the needs of an attached
                                                                                      PORT_ADDRESS                   15:8            8                 0x0F
device.
           0= No dummy EOP cycles are added to a SPI-3 egress.                         The SPI-3 egress test register has read and write access. A single address
           1= Two dummy EOP cycles are added to a SPI-3 egress                     parity error is introduced on a SPI-3 egress LP through the ADD_PAR_ERR
                                                                                   bit field. A single data parity error is introduced on a SPI-3 egress LP through
                                                                                59                                                                  APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                            INDUSTRIAL TEMPERATURE RANGE
the DAT_PAR_ERR bit field. The LP affected by these two parity error bit fields        There is one register for SPI-3 egress fill level register per SPI-3 interface.
is enumerated in the PORT_ADDRESS field. The bit fields of SPI-3 egress test      Each register has read-only access. The bit fields of the SPI-3 egress fill level
register are described. The bit fields are automatically cleared following the    register are described.
generation of the associated error.
                                                                                       FILL_CUR Current SPI-3 egress buffer fill level. Since this is a real-time
    ADD_PAR_ERR A single address parity error is introduced on a SPI-             register, the value read from it will change rapidly and is used for internal
3 egress LP through the ADD_PAR_ERR bit field. The LP affected by the             diagnostics only.
ADD_PAR_ERR bit field is enumerated in the PORT_ADDRESS field.
           0=No parity error introduced                                                I_FCLK_AV Current SPI-3 egress clock availability is checked here.
           1=Introduce a single address parity error on a SPI-3 egress LP                                 0=SPI-3 egress clock transitions were not detected on a
                                                                                                          SPI-3 port
    DAT_PAR_ERR          A single data parity error is introduced on a SPI-3                              1=SPI-3 egress clock transitions were detected on a SPI-
egress LP through the DAT_PAR_ERR bit field. The LP affected by the                                       3 port
DAT_PAR_ERR bit field is enumerated in the PORT_ADDRESS field.
           0=No parity error introduced                                           SPI-3 egress max fill level register (Block_base
           1=Introduce a single data parity error on a SPI-3 egress LP            0x0700 + Register_offset 0x04)
                                                                                  TABLE 59 - SPI-3 EGRESS MAX FILL LEVEL REGIS-
    PORT_ADDRESS          The LP affected by both the ADD_PAR_ERR and             TER (REGISTER_OFFSET=0x04)
the DAT_PAR_ERR bit fields is enumerated in the PORT_ADDRESS field. The
                                                                                              Field               Bits         Length            Initial Value
value of the PORT_ADDRESS is set from 0x00 to 0xFF.
                                                                                        FILL_MAX                    3:0             4                 0x0
SPI-3 egress fill level register (Block_base 0x0700                                    There is one register for SPI-3 egress max fill Level per SPI-3 interface. Each
                                                                                  register has read-only access, and is cleared after reading. 0xF is the highest
+ Register_offset 0x03)
                                                                                  filling level, meaning all egress buffers had been full at some time since the last
TABLE 58 - SPI-3 EGRESS FILL LEVEL REGISTER                                       read of the FILL_MAX field. The units of FILL_MAX are one-sixteenth of the
(REGISTER_OFFSET=0x03)                                                            available egress buffering. Each unit is equal to 128 bytes. The bit field of the
           Field                 Bits       Length          Initial Value         SPI-3 egress max fill Level register is described.
     FILL_CUR                     3:0          4                 0x0
  Reserved                         4           1                 0x0                   FILL_MAX           Maximum SPI-3 egress buffer fill level since the last read
  E_FCLK_AV                        5           1                 0b0              of the SPI-3 egress Max Fill Level Register
                                                                                60                                                                 APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                         INDUSTRIAL TEMPERATURE RANGE
Performance monitor counters
    Two categories of events are captured: LID and non LID associated events.
If at least one event is captured in one of the interrupt indication registers, an active
PMON service request is directed towards the interrupt module.
    All events and diagnostics data are accumulated during an interval defined
by the time base event. The data accumulated during the previous time period
can be accessed by the indirect access scheme. The counters are cleared when
the time base expires. All counters are saturating, and will not overflow.
9.3.5 Block base 0x0A00 registers
LID associated event counters (Block_base
0x0A00 + Register_offset 0x000 to 0x17F)
TABLE 60 - LID ASSOCIATED EVENT COUNTERS
(0x000-0x17F)
   Offset                             Counter                                Counter
                                                                         length (bits)
   LID*6+0     SPI-3 ingress good packet counter                                24
   LID*6+1     SPI-3 ingress bad packet counter(error tagged)                   24
   LID*6+2     SPI-4 ingress good packet counter                                24
   LID*6+3     SPI-4 ingress bad packet counter(abort)                          24
   LID*6+4     SPI-3 egress packet counter                                      24
   LID*6+5     SPI-4 egress packet counter                                      24
    A set of event counters is provided for each of the 64 LIDs on each SPI-3
interface and for each LID to or from a SPI-4 module. LID associated event
counters keep track of packets, packets not delineated by an SOP and an EOP,
or error-tagged packets.
9.3.6 Block base 0x0C00 registers
Non LID associated event counters (Block_base 0x0C00 + Register_offset 0x00
to 0x0B)
TABLE 61 - NON LID ASSOCIATED EVENT COUNTERS (0x00 - 0x0B)
   Offset                      Counters                                   Subject to accumulation                 Width
      0x00         SPI-3 ingress bytes                         All bytes of transfers for active SPI-3 (excluding  29
                                                               address parity error) individual for A/B/C/D
      0x01         SPI-3 ingress transfers                     All transfers for active SPI-3                      26
      0x02         PFP3-4 ingress too long packet              SPI-3 ingress packets longer than MAX_LENGTH         8
      0x03         PFP3-4 ingress too short packet             SPI-3 ingress packets shorter than MIN_LENGTH        8
      0x04         SPI-3 ingress error tagged packet Parity error on SPI-3 ingress                                  8
      0x05         Reserved                                                                                         8
      0x06         SPI-4 ingress bytes                         All bytes of transfers for SPI-4, individual for    29
                                                               modules A and B
      0x07         SPI-4 ingress transfers                     All transfers for active SPI-4 for A and B;         26
                                                               same value in A and B
      0x08         PFP4-3 ingress too long packet              SPI-4 ingress packets longer than MAX_LENGTH         8
      0x09         PFP4-3 ingress too short packet             SPI-4 ingress packets shorter than MIN_LENGTH        8
     0x0A          SPI-4 ingress error tagged packet DIP-4 error on ingress                                         8
     0x0B          Reserved                                                                                         8
    Non LID Associated Event Counters are associated with SPI-3 and SPI-4
physical interfaces. The register offset is shown in the Offset column.
                                                                                          61                                         APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                                  INDUSTRIAL TEMPERATURE RANGE
Non LID associated interrupt indication register                                         Non LID associated interrupt enable register
(Block_base 0x0C00 + Register_offset 0x0C)                                               (Block_base 0x0C00 + Register_offset 0x0D)
TABLE 62 - NON LID ASSOCIATED INTERRUPT                                                  TABLE 63 - NON LID ASSOCIATED INTERRUPT
INDICATION REGISTER (REGISTER_OFFSET                                                     ENABLE REGISTER(REGISTER_OFFSET 0x0D)
0x0C)
                                                                                                      Field               Bits         Length          Initial Value
            Field                 Bits          Length           Initial Value             SPI4_LOCK_UN                      0             1                0b0
    SPI4_LOCK_UN                    0              1                  0b0                  SPI3_LOCK_UN                      1             1                0b0
    SPI3_LOCK_UN                    1              1                  0b0                  SPI3_ICLK_UN                      2             1                0b0
    SPI3_ICLK_UN                    2              1                  0b0                  SPI3_ECLK_UN                      3             1                0b0
    SPI3_ECLK_UN                    3              1                  0b0                  SPI3_FLUSH                        4             1                0b0
    SPI3_FLUSH                      4               1                 0b0                  Reserved                        31:5           27              0x0000
    Reserved                      31:5             27                 0x0
                                                                                            The Non LID associated interrupt enable register is at Block_Base 0x0C00
                                                                                         + Register_offset 0x0D. The Non LID associated interrupt enable register is
     The Non LID associated interrupt indication register is at Block_Base
                                                                                         used to mask the status of SPI-3 and SPI-4 port interrupts in the Non LID
0x0C00. The Non LID interrupt indication register is used to determine the status
                                                                                         associated interrupt indication register. The Non LID associated interrupt enable
of SPI-3 and SPI-4 port interrupts. The Non LID associated interrupt indication
                                                                                         register has read and write access. The bit fields in the Non LID associated
register is read and subsequently a “1” is written to acknowledge individual
                                                                                         interrupt enable register are active “1” interrupt enables for the corresponding
interrupts in this register. An interrupt is generated when enabled by the
                                                                                         bit fields in the Non LID associated interrupt indication register.
corresponding enable flag in the Non LID associated interrupt indication
register. The bit fields in the Non LID associated interrupt indication register are
described.                                                                               LID associated interrupt indication register
                                                                                         (Block_base 0x0C00 + Register_offset 0x0E)
     SPI4_LOCK_UN The SPI-4 interface can create an event indicating that                TABLE 64 - LID ASSOCIATED INTERRUPT INDICA-
the SPI-4 ingress has dropped data due the unavailability of ingress buffering.          TION REGISTER (REGISTER_OFFSET 0x0E)
                     0=No operation
                                                                                                     Field             Bits          Length          Initial Value
                     1=The SPI-4 interface has dropped data due the
                     unavailability of ingress buffering.                                     EVENT_TYPE                  5:0            6                0x00
                                                                                              Reserved                  31:6            26                 0x0
     SPI3_LOCK_UN A SPI-3 interface can create an event indicating that a                   The LID associated interrupt indication register is at Block_Base 0x0C00 +
SPI-3 ingress has dropped data due the unavailability of ingress buffering.              Register_offset 0x0E. The LID associated interrupt indication register is used
                     0=No operation                                                      to determine the EVENT_TYPE of SPI-3 and SPI-4 interrupts. The
                     1=A SPI-3 interface has dropped data due the                        EVENT_TYPE coding is given in the Table 66 - Non critical LID associated
                     unavailability of ingress buffering.                                capture table (0x10-0x15). The LID associated interrupt indication register is
                                                                                         read and subsequently a 0xFF must be written for interrupt acknowledge. An
     SPI3_ICLK_UN A SPI-3 interface can create an event indicating that a                EVENT_TYPE interrupt is generated when enabled by the EVENT_TYPE
SPI-3 ingress clock has failed. No transitions were detected on a SPI-3 ingress          enable flag in the LID associated interrupt enable register.
clock (I_FCLK)
                     0=No operation                                                      LID associated interrupt enable register
                     1=A SPI-3 ingress clock has failed.                                 (Block_base 0x0C00 + Register_offset 0x0F)
     SPI3_ECLK_UN A SPI-3 interface can create an event indicating that a                TABLE 65 - LID ASSOCIATED INTERRUPT ENABLE
SPI-3 egress clock has failed. No transitions were detected on a SPI-3 egress            REGISTER (REGISTER_OFFSET 0x0F)
clock (E_FCLK)                                                                                       Field             Bits          Length          Initial Value
                     0=No operation                                                           EVENT_TYPE                  5:0            6                0x00
                     1=A SPI-3 egress clock has failed.                                       Reserved                  31:6            26                 0x0
                                                                                            The LID associated interrupt enable register is at Block_Base 0x0C00 +
     SPI3_FLUSH             A SPI-3 interface can create an event indicating that a
                                                                                         Register_offset 0x0F. The LID associated interrupt enable register is used to
SPI-3 buffer has been flushed and data has been lost. A buffer is flushed if an
                                                                                         mask the EVENT_TYPE of SPI-3 and SPI-4 per-LID interrupts. The LID
address parity error is detected, or if an ingress buffer is not available at the time
                                                                                         associated interrupt enable register has read and write access.
it is requested.
                     0=No operation
                     1=A SPI-3 buffer has been flushed.
                                                                                       62                                                              APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                                       INDUSTRIAL TEMPERATURE RANGE
Non critical LID associated capture table                                                   SPI-4 to SPI-3 critical LID interrupt indication
(Block_base 0x0C00 + Register_offset 0x10-0x15)                                             registers (Block_base 0x0C00 + Register_offset
TABLE 66 - NON CRITICAL LID ASSOCIATED                                                      0x1A-0x1B)
CAPTURE TABLE (REGISTER_OFFSET 0x10-0x15)                                                   TABLE 69 - SPI-4 TO SPI-3 CRITICAL LID INTERRUPT
  Register                        EVENT_TYPE                             Associated         INDICATION REGISTERS (REGISTER_OFFSET
                                                                              field         0x1A-0x1B)
     0x00         Inactive ingress SPI-3 logical port event               LP (8 bits)
     0x01         SPI-3 ingress data parity error                        LID (6 bits)           Register              Field          Bits             Length         Initial Value
     0x02         SPI-4 illegal SOP sequence event                       LID (6 bits)             0x1A          LID[31:0]            31:0                 32              0x00
     0x03         SPI-4 illegal EOP sequence event                       LID (6 bits)             0x1B          LID[63:32]           31:0                 32              0x00
     0x04         SPI-3 illegal SOP sequence event                       LID (6 bits)           The SPI-4 to SPI-3 critical LID interrupt indication registers are at Block_Base
     0x05         SPI-3 illegal EOP sequence event                       LID (6 bits)       0x0C00 + Register_offset 0x1A-0x1B.
    The Non critical LID associated capture table is at Block_Base 0x0C00 +                     Critical events are captured per LID in a SPI-4 to SPI-3 critical LID interrupt
Register_Offset 0x10-0x15. The Non critical LID associated capture table is                 indication register. An interrupt is generated when enabled by the enable flag
used to determine the EVENT_TYPE of SPI-3 and SPI-4 per-LID or per-LP                       in the SPI-4 to SPI-3 critical LID interrupt enable register. The SPI-4 to SPI-3
interrupts. The EVENT_TYPE coding is used to indicate which event or events                 critical LID interrupt indication registers have read and write access. An interrupt
are pertinent to the interrupt in the Table 64 - LID associated interrupt indication        indication is cleared by writing a logical one to the appropriate bit of a SPI-4 to
register(0x0E). The Non critical LID associated capture table is used to                    SPI-3 critical LID interrupt indication register. Only one kind of critical event is
determine the EVENT, and multiple bits can be active at the same time. The Non              defined-buffer overflow. Each bit of a LID field set to logical one indicates the
critical LID associated capture table is read-only.                                         presence of a buffer overflow event. A summary indication of as to which of the
                                                                                            two sources, SPI-3 to SPI-4 or SPI-4 to SPI-3, is responsible for the critical
                                                                                            interrupt is indicated in the Table 71 Critical events source indication register
SPI-3 to SPI-4 critical LID interrupt indication
                                                                                            (0x1E).
registers (Block_base 0x0C00 + Register_offset
0x16-0x17)                                                                                  SPI-4 to SPI-3 critical LID interrupt enable regis-
TABLE 67 - SPI-3 TO SPI-4 CRITICAL LID INTER-
                                                                                            ters (Block_base 0x0C00 + Register_offset 0x1C-
RUPT INDICATION REGISTERS
(REGISTER_OFFSET 0x16-0x17)
                                                                                            0x1D)
    Register            Field             Bits          Length          Initial Value       TABLE 70 - SPI-4 TO SPI-3 CRITICAL LID INTER-
      0x16          LID[31:0]             31:0              32               0x00           RUPT ENABLE REGISTERS (REGISTER_OFFSET
      0x17          LID[63:32]            31:0              32               0x00           0x1C-0x1D)
    The SPI-3 to SPI-4 critical LID interrupt indication registers are at Block_Base            Register              Field          Bits             Length         Initial Value
0x0C00 + Register_offset 0x16-0x17.                                                               0x1C           LID[31:0]           31:0                 32              0x00
    Critical events are captured per LID in the SPI-3 to SPI-4 critical LID interrupt             0x1D           LID[63:32]          31:0                 32              0x00
indication registers. An interrupt is generated when enabled by the enable flag
in the SPI-3 to SPI-4 critical LID interrupt enableregisters. A SPI-3 to SPI-4 critical         The SPI-4 to SPI-3 critical LID interrupt enable registers have read and write
LID interrupt indication register has read and write access. An interrupt indication        access. The SPI-4 to SPI-3 critical LID interrupt enable register bits enable the
is cleared by writing a logical one to the appropriate bit of a SPI-3 to SPI-4 critical     corresponding bits in the SPI-4 to SPI-3 critical LID interrupt indication registers.
LID interrupt indication register. Only one kind of critical event is defined-buffer
overflow. Each bit of the LID field set to logical one indicates the presence of a          Critical events source indication register
buffer overflow event. A summary indication of as to which of the two sources,              (Block_base 0x0C00 + Register_offset 0x1E)
SPI-3 to SPI-4 or SPI-4 to SPI-3, is responsible for the critical interrupt is indicated
                                                                                            TABLE 71 - CRITICAL EVENTS SOURCE INDICA-
in the Table 71 Critical events source indication register (0x1E).
                                                                                            TION REGISTER (REGISTER_OFFSET 0x1E)
SPI-3 to SPI-4 critical LID interrupt enable regis-                                                      Field                   Bits         Length             Initial Value
ters (Block_base 0x0C00 + Register_offset 0x18-                                                  SPI34_OVR                         0               1                  0b0
0x19)                                                                                            SPI43_OVR                         1               1                  0b0
TABLE 68 - SPI-3 TO SPI-4 CRITICAL LID INTERRUPT                                                 Reserved                        31:2             30                  0x0
ENABLE REGISTERS (REGISTER_OFFSET 0x18-                                                         The bits in the Critical events source indication register are read only. Bit
0x19)                                                                                       SPI34_OVR reflects the logical OR result of all bits in the SPI-3 to SPI-4 critical
    Register            Field             Bits          Length          Initial Value       LID associated interrupt indication registers. Bit SPI43_OVR reflects the logical
      0x18          LID[31:0]             31:0              32               0x00           OR result of all bits in the SPI-4 to SPI-3 critical LID interrupt indication registers.
      0x19          LID[63:32]            31:0              32               0x00
    The SPI-3 to SPI-4 critical LID interrupt enable registers have read and write
access. A SPI-3 to SPI-4 critical LID interrupt enable register bits enable the
corresponding bits in a SPI-3 to SPI-4 critical LID interrupt indication register.
                                                                                         63                                                                     APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                             INDUSTRIAL TEMPERATURE RANGE
9.3.7 Block base 0x0100 registers                                                   multiplied by 16 is the maximum starving burst length. For example, program-
SPI-3 ingress packet length configuration register                                  ming the number 7 into the MAX_BURST_S field results in a maximum starving
(Block_base 0x1000 + Register_offset 0x00-0x3F)                                     burst size of (7 + 1) x 16 = 128 bytes. The MAX_BURST_S field should not be
                                                                                    set to less than the MAX_BURST_H field.
TABLE 72 - SPI-3 INGRESS PACKET LENGTH
CONFIGURATION REGISTER                                                                  DIRECTION           The SPI-4 egress traffic can be captured by the micropro-
             Field                Bits        Length           Initial Value        cessor, directed to a SPI-3 egress port, to the SPI-4 egress port, or discarded.
      MIN_LENGTH                   7:0            8                0x40             The Path selection is defined for each of the 64 LIDs by the associated
      Reserved                    15:8            8                0x00             DIRECTION field as shown in the following table.
      MAX_LENGTH                  29:16          14              0x5EE
                                                                                    TABLE 74 - SPI-4 EGRESS DIRECTION CODE
    There is one set of SPI-3 ingress packet length configuration registers per     ASSIGNMENT
SPI-3 ingress interface. Each SPI-3 ingress interface has 64 registers, one for         DIRECTION                      Path
each of the allowed LIDs supported per SPI-3 interface. Each register has read
                                                                                            00              SPI-4
and write access. The minimum and maximum packet lengths per LID are
                                                                                            01              Associated SPI-3
provisioned using the SPI-3 ingress packet length configuration register. The
bit fields of a SPI-3 ingress packet length configuration register are described.           10              Capture to microprocessor
                                                                                            11              Discard
    MIN_LENGTH SPI-3 ingress minimum packet length. The minimum
packet length is programmed from 0 to 255 bytes. The resolution of the minimum      9.3.9 Block base 0x1200 registers
packet length is one byte.
                                                                                    SPI-3 ingress port descriptor tables (Block_base
    MAX_LENGTH SPI-3 ingress maximum packet length. The maximum                     0x1200 + Register_offset 0x00-0x3F)
packet length is programmed from 0 to 16,383 bytes. The resolution of the           TABLE 75 - SPI-3 INGRESS PORT DESCRIPTOR
maximum packet length is one byte.                                                  TABLE (BLOCK_BASE 0x1200)
9.3.8 Block base 0x1100 registers                                                                Field               Bits        Length           Initial Value
                                                                                      M                               8:0             9               0x000
SPI-4 egress port descriptor table (Block_base
                                                                                      Reserved                       15:9             7                0x00
0x1100 + Register_offset 0x00-0x3F)
                                                                                      Reserved                      20:16             5                0x00
TABLE 73 - SPI-4 EGRESS PORT DESCRIPTOR
TABLE (64 ENTRIES)                                                                    Reserved                      23:21             3                0x0
                                                                                      FREE_SEGMENT                  28:24             5                0x00
             Field                Bits        Length           Initial Value
                                                                                      Reserved                      31:29             3                0x0
     MAX_BURST_H                   3:0            4                 0xF
     MAX_BURST_S                   7:4            4                 0xF                 There is one set of 64 SPI-3 ingress port descriptor tables per SPI-3 ingress
     DIRECTION                     9:8            2                 0x3             interface. The SPI-3 ingress port descriptor tables are at Block_base 0x1200
     Reserved                     31:10          22                0x000            and have read and write access. Each SPI-3 ingress interface has 64 table
    There are two sets of SPI-4 egress port descriptor tables, one per SPI-3        entries for per-LID provisioning of M and FREE_SEGMENT fields. The SPI-
interface. The minimum and maximum SPI-4 egress burst lengths per LID are           3 ingress port descriptor tables are used to control the amount of buffering and
provisioned using aSPI-4 egress port descriptor table. Each SPI-4 egress port       the free segment backpressure threshold of the available buffer segment pool
descriptor table has read and write access. The bit fields of the SPI-4 egress      for a SPI-3 ingress on a per-LID basis.
port descriptor table are described. These fields need to be programmed only            Each SPI-3 buffer segment pool is 128 Kbytes, divided into 508 segments
for SPI-4 egress (DIRECTION=0 in Table 74-SPI-4 egress direction code               of 256 bytes per segment. These 508 segments are shared among the LIDs
assignment.                                                                         initially programmed into the NR_LID fields. A SPI-3 ingress LID can be allocated
                                                                                    the maximum number of segments out of the available buffer segments, or can
    MAX_BURST_H SPI-4 egress per-LID burst length when the attached                 be programmed to fewer segments by decreasing the M field.
device has declared hungry through the FIFO status channel. The number in               The FREE_SEGMENT field is used, along with the M field, to set the free
the MAX_BURST_H field is taken to mean that one more than that number               segment backpressure threshold for a LID on a SPI-3 ingress.
multiplied by 16 is the maximum hungry burst length. For example, programming
the number 3 into the MAX_BURST_H field results in a maximum hungry burst               M        The number of 256-byte buffer pool segments on a SPI-3 ingress port
size of (3 + 1) 9.3.9 Block base 0x1200 registers                                   allocated to a LID. The range of M is 0x000 to 0x1FC (508 base 10), but can
                                                                                    not exceed the number set by the choice of NR_LID [Block_base 0x1300 +
    MAX_BURST_S SPI-4 egress per-LID burst length when the attached                 Register_offset 0x00].
device has declared starving through the FIFO status channel. The number in
the MAX_BURST_S field is taken to mean that one more than that number
                                                                                  64                                                              APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                              INDUSTRIAL TEMPERATURE RANGE
    FREE_SEGMENT The FREE_SEGMNET field is used to define the SPI-                   configuration. The buffer segments do not have to be equally shared among
3 ingress per-LID free segment backpressure threshold based on the number            the LIDs. One buffer segment corresponds to a data burst to be forwarded to
of free buffer segments (M) available, as follows:                                   the SPI-4 egress interface.
    THRESHOLD = N * FREE_SEGEMENT,                                                       An example of the use of the buffer segment pool follows. For a SPI-3 ingress
                                                                                     interface that will never have more than four LIDs, set the NR_LID field for this
    Where the value of N is defined as a function of the domain of M:                interface to 0x01. This allows 256 buffer segments for a LID, with the total number
                                                                                     of buffer segments for all 4 LIDs equal to 508. Let’s say you want only 64 buffer
                          M[8:0]              N (base 10)                            segments for one of the LIDs. Program field M for that LID to 0x040 (64 base
                     0x1FC to 0x100                16                                10). Let’s say you want to backpressure the SPI-3 ingress interface when 48
                     0x0FF to 0x080                 8                                of the 64 allocated buffers for this LID are full. In other words, you want to exert
                     0x07F to 0x040                 4                                SPI-3 ingress backpressure when only 16 segments remain for this LID. Since
                     0x03F to 0x020                 2                                M=0x040, N=4 from the description of the M field above [Block_base 0x1200].
                                                                                     Setting the FREE_SEGMENT field to 4 then yields the desired THRESHOLD
                     0x01F to 0x000                 1
                                                                                     of 16.
    The THRESHOLD thus defined is the number of free segments available for          TABLE 77 - NR_LID FIELD ENCODING
a LID at the time of backpressure initiation.                                             NR_LID           Maximum Number              Maximum Buffer Segments
                                                                                                           of LIDs                       for a LID
9.3.10 Block base 0x1300 registers                                                          0b000                     1                              508
                                                                                            0b001                     4                              256
    The SPI-3 ingress to SPI-4 egress Packet Fragment Processor and flow
                                                                                            0b010                     8                              128
control registers are at Block_Base 0x1300.
                                                                                            0b011                     16                              64
                                                                                            0b100                     32                              32
SPI-3 to SPI-4 PFP register (Block_base 0x1300 +
                                                                                            0b101                     64                              16
Register_offset 0x00)
TABLE 76 - SPI-3 TO SPI-4 PFP REGISTER                                               SPI-3 to SPI-4 flow control register (Block_base
(REGISTER_OFFSET 0x00)                                                               0x1300 + Register_offset 0x01)
            Field                 Bits        Length          Initial Value
                                                                                     TABLE 78 - SPI-3 TO SPI-4 FLOW CONTROL REG-
     NR_LID                        2:0            3              0b011
                                                                                     ISTER (REGISTER_OFFSET 0x01)
     Reserved                      7:3            5               0x0
                                                                                                 Field                  Bits         Length            Initial Value
    A SPI-3 ingress to SPI-4 egress PFP (Packet Fragment Processor) Register           CREDIT_EN                          0               1               0b1
has read and write access. There is one SPI-3 to SPI-4 PFP Register per SPI-
                                                                                       BURST_EN                           1               1               0b0
3 ingress. The bit fields of a SPI-3 to SPI-4 PFP Register are described.
                                                                                       Reserved                          7:3              6              0x00
    NR_LID The maximum number of LIDs per SPI-3 physical ingress                         A SPI-3 to SPI-4 flow control register has read and write access. There is
interface that will ever be used is programmed into the NR_LID field. Once           one SPI-3 to SPI-4 flow control register per SPI-3 ingress.The bit fields of the
configured after reset, this value can not be changed. Fewer LIDs can be used        SPI-3 to SPI-4 flow control register are described.
by not activating some of the LIDs, but more LIDs than the value in NR_LID are
not allowed and will generate an error. The NR_LID field is important, as the            CREDIT_EN          The information received over the FIFO status channel is
buffer segment pool is divided among the number of LIDs programmed into the          interpreted as status or credit information as selected by the CREDIT_EN flag
NR_LID field.                                                                        in the SPI-3 to SPI-4 flow control Register. If the status mode is used, data will
                                                                                     be egressed until the status is changed by the attached device. If the credit mode
    A 128 Kbyte SPI-3 to SPI-4 buffer segment pool for storing data bursts for       is used, the SPI-4 egress will issue only one credit’s worth data burst and then
the SPI-4 egress is available for each SPI-3 physical port. A configurable part      wait for another credit from the status channel before issuing another LID burst.
of this buffer segment pool can be assigned to each of the possible LIDs allowed                 0=Status mode
by the NR_LID field value per SPI-3 physical interface. The buffer size for a LID                1=Credit mode
can be configured in multiples (M) of 256 bytes. Modifications of the buffer size
allocated to a LID are supported only when the logical port associated to the LID        BURST_EN           Multiple Burst Enable allows more than one burst to be sent
is disabled. Attempts to allocate more memory than available will generate an        to an LP. This feature is included to relieve systems with long latency between
allocation error event. The indirect access module will discard the attempt.         updates. When this feature is not enabled, only one burst per LP is allowed into
    A 128 Kbyte SPI-3 to SPI-4 buffer segment pool is divided into 508 buffer        the SPI-4 egress buffers.
segments. Each buffer segment is equal to 256 bytes. The buffer segments are                     0=Disable burst enable
shared among the number of logical ports defined by the static NR_LID                            1=Enable burst enable
                                                                                  65                                                                 APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                                  INDUSTRIAL TEMPERATURE RANGE
9.3.11 Block base 0x1600 registers                                                      9.3.13 Block base 0x1800 registers
   The SPI-4 ingress registers are at Block_base 0x1600.                                SPI-4 ingress port descriptor table (Block_base
                                                                                        0x1800 + Register_offset 0x00-0x3F)
SPI-4 ingress packet length configuration
                                                                                        TABLE 82 - SPI-4 INGRESS PORT DESCRIPTOR
(Block_base 0x1600 + Register_offset 0x00-0x3F)                                         TABLES (64 ENTRIES)
TABLE 79 - SPI-4 INGRESS PACKET LENGTH                                                               Field                 Bits        Length          Initial Value
CONFIGURATION (64 ENTRIES CONFIGURABLE)                                                   M                                8:0            9                0x000
            Field                    Bits        Length            Initial Value          Reserved                         15:9           7                 0x00
  MIN_LENGTH                          7:0            8                 0x40               FREE_SEGMENT_S                  20:16           5                 0x00
  Reserved                           15:8            8                 0x0                Reserved                        23:21           3                 0x0
  MAX_LENGTH                         29:16          14               0x5EE                FREE_SEGMENT_H                  28:24           5                 0x00
   There are two sets of 64 registers for SPI-4 ingress packet length configu-            Reserved                        31:29           3                 0x0
ration, one per SPI-3 interface. Each register has read and write access. The               There is one set of 64 registers for SPI-4 ingress port descriptors per SPI-
minimum and maximum packet lengths per LID are provisioned using the SPI-               3 interface. The SPI-4 ingress port descriptor tables are 32 bits wide and have
4 ingress packet length configuration register. The bit fields of a SPI-4 ingress       read and write access. Each of the SPI-4 ingress port descriptor tables is used
packet length configuration register are described.                                     to control the amount of buffering and the backpressure threshold of the available
   MIN_LENGTH SPI-4 ingress minimum packet length. The minimum                          buffer segment pool for the SPI-4 ingress.
packet length is programmed from 0 to 255 bytes. The resolution is one byte.                Each SPI-4 ingress buffer segment pool is 128 Kbytes, divided into 508 buffer
                                                                                        segments of 256 bytes per segment. The 508 buffer segments can be shared
   MAX_LENGTH SPI-4 ingress maximum packet length. The maximum                          among the LIDs initially programmed by the numerical field NR_LID. Of the share
packet length is programmed from 0 to 16,383 bytes. The resolution is one byte.         of the buffer memory, a SPI-4 LID can be allocated the maximum number of
                                                                                        segments permitted, or can be programmed to fewer segments by decreasing
9.3.12 Block base 0x1700 registers                                                      the M field. Decreasing M increases the chance of backpressure and possibly
SPI-3 egress port descriptor table (Block_base                                          buffer overflow, but can result in lower latency.
0x1700 + Register_offset 0x00-0x3F)                                                         The FREE_SEGMENT_S (starving threshold) and FREE_SEGMENT_H
TABLE 80 - SPI-3 EGRESS PORT DESCRIPTOR                                                 (hungry threshold) fields are used, along with the M field, to set the two
TABLE (64 ENTRIES)                                                                      backpressure settings per LID on the SPI-4 ingress. The FREE_SEGMENT_S
                                                                                        field must always be greater than the FREE_SEGMENT_H field.
            Field                    Bits        Length            Initial Value
     MAX_BURST                        3:0            4                  0x0F
                                                                                            M        The number of 256-byte buffer pool segments allocated to a LID. The
     Reserved                         7:4            4                   0x0            range of M is 0x000 to 0x1FC (508 base 10), but can not exceed the number
     DIRECTION                        8:9            2                  0b11            dictated by NR_LID [Block_base 0x1900 + Register_offset 0x00].
     Reserved                        31:10          22                  0x00
   There are 64 SPI-3 egress port descriptor tables per SPI-3 egress port. The              FREE_SEGMENT_S
SPI-3 egress port descriptor table has read and write access. The SPI-3 egress              This field is used to define the SPI-4 ingress per-LID starving backpressure
per LID packet fragment length and direction are provisioned using the SPI-3            threshold based on the number of free buffer pool segments (M) available, as
egress port descriptor tables. The bit fields of a SPI-3 egress port descriptor table   follows:
are described.                                                                              THRESHOLD_S = N * FREE_SEGEMENT_S, where the value of N is
                                                                                        defined as:
   MAX_BURST SPI-3 packet fragment length for a SPI-3 egress LP. One
more than MAX_BURST field multiplied by sixteen is the packet fragment length                                        M[8:0]                  N
for the LP. For example, programming the number 3 into the MAX_BURST field                                      0x1FF to 0x100               16
results in a packet fragment length of (3+1) x 16 = 64 bytes. The MAX_BURST
                                                                                                                0x0FF to 0x080                8
field is used to prioritize traffic.
                                                                                                                0x07F to 0x040               4
   DIRECTION             The SPI-3 egress traffic is directed to a SPI-3 egress port.                           0x03F to 0x020               2
The Path selection is defined for each of the 64 LIDs by the associated                                         0x01F to 0x000               1
DIRECTION field as shown in the following table.
                                                                                            FREE_SEGMENT_H
TABLE 81 - SPI-3 EGRESS DIRECTION CODE                                                      This field is used to define the SPI-4 ingress per-LID hungry backpressure
ASSIGNMENT                                                                              threshold based on the number of free buffer pool segments (M) available, as
    DIRECTION                           Path                                            follows:
          00                   SPI-3 physical                                               THRESHOLD_H = N * FREE_SEGEMENT_H, where the value of N is as
          01                   Reserved                                                 defined for FREE_SEGEMENT_S.
          10                   Capture
          11                   Discard
                                                                                      66                                                               APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                             INDUSTRIAL TEMPERATURE RANGE
9.3.14 Block base 0x1900 registers                                                      The 128 Kbyte SPI-4 to SPI-3 buffer segment pool is divided into 508 buffer
SPI-4 to SPI-3 PFP register (Block_base 0x1900 +                                     segments. Each buffer segment is equal to 256 bytes. The buffer segments are
Register_Offset 0x00)                                                                shared among the number of logical ports defined by the static NR_LID
                                                                                     configuration. The buffer segments do not have to be equally shared among
TABLE 83 - SPI-4 TO SPI-3 PFP REGISTER (0x00)                                        the allocated LIDs. One buffer segment corresponds to a packet fragment to be
           Field                    Bits      Length          Initial Value          forwarded to a SPI-3 egress physical interface.
    NR_LID                          2:0           3              0b011                  An example of the use of the buffer segment pool follows. For a SPI-3 egress
    Reserved                        7:3           5               0x00               interface that will never have more than eight LIDs, set the NR_LID field for this
                                                                                     interface to 0x02. This allows 128 buffer segments for a LID with the total number
   The SPI-4 ingress to SPI-3 egress Packet Fragment Processor registers are
                                                                                     of buffer segments for all eight LIDs equal to 508.
at Block_Base 0x1900 + Register_offset 0x00. A SPI-4 to SPI-3 PFP Register
                                                                                        Let’s say you want only 24 (base 10) buffer segments for one of the LIDs.
has read and write access. The bit fields of a SPI-4 to SPI-3 PFP Register are
                                                                                     Program field M for that LID to 0x018 (24 base 10). Let’s say you want to set
described.
                                                                                     the per-LID starving backpressure for the SPI-4 ingress interface when 20 of
                                                                                     the 24 allocated buffers for this LID are full. In other words, you want to assert
   NR_LID               The maximum number of LIDs per SPI-3 physical inter-
                                                                                     SPI-4 ingress starving when only 4 segments remain for this LID. Since
face that will ever be used is programmed into the NR_LID field. Once configured
                                                                                     M=0x018, N=1 from the description of the M field above [Block_base 0x1800].
after reset, this value can not be changed. Fewer LIDs can be used by not
                                                                                     Setting the FREE_SEGMENT_S field to 4 then yields the desired
activating some of the LIDs, but more LIDs than the value in NR_LID are not
                                                                                     THRESHOLD_S of 4. Similarly, to set the per-LID SPI-4 ingress hungry
allowed and will generate an error. The NR_LID field is important, as the buffer
                                                                                     threshold, THRESHOLD_H, to trip when only 6 buffer segments remain for this
segment pool is divided among the number of LIDs programmed into the
                                                                                     LID, program the FREE_SEGMENT_H field for this LID to 6.
NR_LID field.
                                                                                     TABLE 84 - NR_LID FIELD ENCODING
   A 128 Kbyte SPI-4 to SPI-3 buffer segment pool for storing packet fragments
for a SPI-3 egress is available per SPI-3 physical port. A configurable part of           NR_LID           Maximum Number              Maximum Buffer Segments
the buffer segment pool can be assigned to each of the LIDs, as determined by                              of LIDs                      for a LID
the NR_LID value, per SPI-3 physical interface. The buffer size (M) for a LID              0b000                     1                             508
can be configured in multiples of 256 bytes. Modifications of the buffer size              0b001                     4                             256
allocated to a LID are supported only when the logical port associated to the LID          0b010                     8                             128
is disabled. Attempts to allocate more memory than available will generate an              0b011                     16                             64
allocation error event. The indirect access module will discard the attempt.               0b100                     32                             32
                                                                                           0b101                     64                             16
                                                                                  67                                                                APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                               INDUSTRIAL TEMPERATURE RANGE
9.4 Common module indirect registers
(Module_base 0x8000)
TABLE 85 -COMMON MODULE (MODULE_BASE
0x8000) INDIRECT REGISTER TABLE
   Table Number, Page Block_base, Register_offset Title of Register
   86, page 69        0x0000, 0x00-0xFF           SPI-4 ingress LP to LID map
   87, page 69        0x0100, 0x00-0xFF           SPI-4 ingress calendar_0
   88, page 69        0x0200, 0x00-0xFF           SPI-4 ingress calendar_1
   89, page 69        0x0300, 0x00                SPI-4 ingress configuration register
   90, page 70        0x0300, 0x01                SPI-4 ingress status configuration register
   91, page 70        0x0300, 0x02                SPI-4 ingress status register
   92, page 70        0x0300, 0x03                SPI-4 ingress inactive transfer port
   93, page 71        0x0300, 0x04-0x05           SPI-4 ingress calendar configuration register
   94, page 71        0x0300, 0x06                SPI-4 ingress watermark register
   95, page 71        0x0300, 0x07-0x0A           SPI-4 ingress fill level register
   96, page 71        0x0300, 0x0B-0x0E           SPI-4 ingress max fill level register
   97, page 71        0x0300, 0x0F                SPI-4 ingress diagnostics register
   98, page 72        0x0300, 0x10                SPI-4 ingress DIP-4 error counter
   99, page 72        0x0300, 0x11                SPI-4 ingress bit alignment control register
   100, page 72       0x0300, 0x12                SPI-4 ingress start up training threshold register
   101, page 72       0x0400, 0x00-0xFF           SPI-4 egress LID to LP map
   102, page 72       0x0500, 0x00-0xFF           SPI-4 egress calendar_0
   103, page 73       0x0600, 0x00-0xFF           SPI-4 egress calendar_1
   104, page 73       0x0700, 0x00                SPI-4 egress configuration register_0
   105, page 73       0x0700, 0x01                SPI-4 egress configuration register_1
   106, page 74       0x0700, 0x02                SPI-4 egress status register
   107, page 74       0x0700, 0x03-0x04           SPI-4 egress calendar configuration register
   108, page 74       0x0700, 0x05                SPI-4 egress diagnostics register
   109, page 74       0x0700, 0x06                SPI-4 egress DIP-2 error counter
   110, page 75       0x0800, 0x00                SPI-4 ingress bit alignment window register
   111, page 75       0x0800, 0x01                SPI-4 ingress lane measure register
   112, page 75       0x0800, 0x02-0x0B           SPI-4 ingress bit alignment counter register
   113, page 75       0x0800, 0x0C-0x1F           SPI-4 ingress manual alignment phase/result register
   114, page 75       0x0800, 0x2A                SPI-4 egress data lane timing register
   115, page 76       0x0800, 0x2B                SPI-4 egress control lane timing register
   116, page 76       0x0800, 0x2C                SPI-4 egress data clock timing register
   117, page 76       0x0800, 0x2D                SPI-4 egress status timing register
   118, page 76       0x0800, 0x2E                SPI-4 egress status clock timing register
   119, page 77       0x0900, 0x00                PMON timebase control register
   120, page 77       0x0900, 0x01                Timebase register
   121, page 77       0x0900, 0x10                Clock generator control register
   122, page 77       ———————-                    OCLK and MCLK frequency select encoding
   123, page 78       0x0900, 0x20                GPIO register
   124, page 78       0x0900, 0x21– 0x25          GPIO monitor table
   125, page 78       0x0900, 0x30                Version number register
                                                      68                                                   APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                               INDUSTRIAL TEMPERATURE RANGE
9.4.1 Common module block base 0x0000 registers                                          LP      The LP value programmed schedules a status channel update
SPI-4 ingress LP to LID maps (Block_base 0x0000                                      according to the calendar sequence.
+ Register_offset 0x00 to 0xFF)
                                                                                     9.4.3 Common module block base 0x0200 registers
TABLE 86 - SPI-4 INGRESS LP TO LID MAP
(256 ENTRIES, ONE PER LP)                                                            SPI-4 ingress calendar_1 (Block_base 0x0200 +
                                                                                     Register_offset 0x00 to 0xFF)
           Field                    Bits       Length        Initial Value
          LID                       5:0           6               0x00               TABLE 88 - SPI-4 INGRESS CALENDAR_1
          PFP                       7:6           2                0x0               (256 ENTRIES)
       ENABLE                        8            1                0x0                          Field                   Bits         Length          Initial Value
    There are 256 SPI-4 ingress LP to LID maps for the SPI-4 ingress interface                    LP                     7:0             8                0xFF
at Block_base 0x0000. The SPI-4 ingress LP to LID maps have read and write               The SPI-4 ingress calendar_1 is at Block_base 0x0200 and has read and
access. The SPI-4 ingress LP to LID maps are used to map SPI-4 ingress logical       write access. When the SPI-4 ingress calendar_1 is selected, SPI-4 ingress
ports to logical identifiers used internally.                                        calendar_1 is in use. There are 256 entries in the SPI-4 ingress calendar_1
    Data for an inactive LP having an entry in the calendar is forwarded to          to schedule the updating of the FIFO status channel LPs to the attached device.
LID0. Therefore all the LPs that have entries in the calendar tables should be       If less than the maximum 256 LPs are needed on the SPI-4 interface, the
enabled.                                                                             calendar entries should be used for scheduling more frequent status updates
                                                                                     for higher-speed LPs. The value of time-critical LPs must appear multiple times
    LID The LID programmed is associated to the LP with the same number              in the table. For example, a multi-PHY SPI-4 could have OC-48 channels
as the register address. Six bits support the 64 simultaneously active LIDs per      appear in the calendar at four times the rate of OC-12 channels, since the higher
SPI-3 physical interface.                                                            data rate of the OC-48 channels would benefit from more frequent FIFO status
                                                                                     channel updates. The LP field values range from 0x00 to 0xFF. The
    PFP The PFP field is used to select among SPI-4 ingress to SPI-3 egress          IDT88P8342 and the attached device must have identical calendars for ingress
Packet Processing Engines. The number in the PFP field selects the PFP               and the attached egress device. The ingress and egress of the IDT88P8342
module to be used.                                                                   do not have to match, however.
            0x0=Select PFP Module A
            0x1=Select PFP Module B                                                      LP      The LP value programmed schedules a status channel update
            0x2=Reserved                                                             according to the calendar sequence.
            0x3=Reserved
                                                                                     9.4.4 Common module block base 0x0300 registers
    ENABLE The Enable is used to enable or disable the connection of an LP           SPI-4 ingress configuration register (Block_base
to a LID.                                                                            0x0300 + Register_offset 0x00)
            0=LP is disabled
            1=LP is enabled                                                          TABLE 89 - SPI-4 INGRESS CONFIGURATION
                                                                                     REGISTER (0x00)
9.4.2 Common module block base 0x0100 registers                                                 Field                  Bits         Length          Initial Value
SPI-4 ingress calendar_0 (Block_base 0x0100 +                                           SPI-4_EN                         0              1                 0b0
Register_offset 0x00 to 0xFF)                                                           Reserved                         1              1                 0x0
TABLE 87 - SPI-4 INGRESS CALENDAR_0                                                     Reserved                         2              1                 0x0
(256 ENTRIES)                                                                           I_CLK_EDGE                       3              1                 0x0
                                                                                        I_DSC                            4              1                 0x0
           Field                    Bits       Length        Initial Value
                                                                                        I_INSYNC_THR                    9:5             5                0x1F
             LP                     7:0           8                0xFF
                                                                                        I_OUTSYNC_THR                  13:10            4                0xF
    The SPI-4 ingress calendar_0 is at Block_base 0x0100 and has read and               I_CSW_EN                        14              1                 0x0
write access. When the SPI-4 ingress calendar_0 is selected, SPI-4 ingress
                                                                                        CAL_SEL                         15              1                 0x0
calendar_0 is in use. There are 256 entries in the SPI-4 ingress calendar_0
                                                                                        I_LOW                           16              1                 0b1
to schedule the updating of the FIFO status channel LPs to the attached device.
If less than the maximum 256 LPs are needed on the SPI-4 interface, the                  The SPI-4 ingress configuration register is at Block_base 0x0300 and has
calendar entries should be used for scheduling more frequent status updates          read and write access.
for higher-speed LPs. The value of time-critical LPs must appear multiple times          The SPI-4 ingress configuration register is used to set the state of the SPI-
in the table. For example, a multi-PHY SPI-4 could have OC-48 channels               4 ingress interface. The bit fields of the SPI-4 ingress configuration register are
appear in the calendar at four times the rate of OC-12 channels, since the higher    described.
data rate of the OC-48 channels would benefit from more frequent FIFO status             SPI-4_EN The SPI-4 ingress path is enabled using this field. The SPI-4
channel updates. The LP field values range from 0x00 to 0xFF. The                    path is disabled during reset and while configuring the port, and then is enabled
IDT88P8342 and the attached device must have identical calendars for ingress         for normal use.
and the attached egress device. The ingress and egress calendars of the                          0=SPI-4 ingress is disabled
IDT88P8342 device do not have to match.                                                          1= SPI-4 ingress is enabled
                                                                                  69                                                                APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                                INDUSTRIAL TEMPERATURE RANGE
    I_CLK_EDGE The SPI-4 ingress LVTTL status clock active clock edge                      ALPHA_FIFO The SPI-4 ingress ALPHA_FIFO field is the number of
is selected using the I_CLK_EDGE field.                                                repetitions of the status training sequence that must be scheduled every
            0=SPI-4 ingress clock uses the rising edge                                 FIFO_MAX_T cycles. The value for alpha used is actually one more than the
            1= SPI-4 ingress clock uses the falling edge                               ALPHA_FIFO value programmed into the ALPHA_FIFO field.
    I_DSC The I_DSC bit is used to protect against a random data error                 SPI-4 ingress status register (Block_base 0x0300 +
during de-skew.                                                                        Register_offset 0x02)
            0= One de-skew result is needed for data de-skew
                                                                                       TABLE 91 - SPI-4 INGRESS STATUS REGISTER
            1= Two consecutive de-skew results are needed for data de-skew
                                                                                       (REGISTER_OFFSET 0x02)
(recommended setting)
                                                                                                   Field                  Bits         Length          Initial Value
    I_INSYNC_THR The SPI-4 ingress DIP-4 in synchronization threshold                     I_SYNCH                           0             1                   0
is controlled using the I_INSYNC_THR field. It is recommended to use the initial          I_DSK_OOR                         1             1                   0
value.                                                                                    DCLK_AV                           2             1                   0
                                                                                           The SPI-4 ingress status register is at Block_base 0x0300 and has read-only
    I_OUTSYNC_THR The SPI-4 ingress DIP-4 out-of synchronization
                                                                                       access.
threshold is controlled using the I_OUTSYNC_THR field. It is recommended to
                                                                                           The SPI-4 ingress status register is used to set the state of the SPI-4 ingress
use the initial value.
                                                                                       synchronization.
                                                                                           The bit fields of the SPI-4 ingress status register are described.
    I_CSW_EN The ingress calendar switch enable bit is used to enable the
switching of the active calendars. It is recommended to use the initial value.
                                                                                           I_SYNCH The SPI-4 ingress I_SYNCH field describes the synchroniza-
            0=Ingress calendar switch disabled. Only SPI-4 ingress calendar_0
                                                                                       tion state of the SPI-4 ingress data path.
            is used.
                                                                                                    0=SPI-4 ingress data path is out of synchronization
            1=Ingress calendar switch enabled. Calendar_0 or calendar_1 can
                                                                                                    1=SPI-4 ingress data path is in synchronization
            be used.
                                                                                           I_DSK_OOR The SPI-4 ingress I_DSK_OOR field describes the de-skew
    CAL_SEL The calendar select bit selects between SPI-4 ingress
                                                                                       state of the SPI-4 ingress data path.
calendar_0 and SPI-4 ingress calendar_1. The CAL_SEL bit is only valid if the
                                                                                                    0=SPI-4 ingress data path de-skew is within range
I_CSW_EN bit is set to a logic one.
                                                                                                    1= SPI-4 ingress data path de-skew is out of range
            0=SPI-4 ingress calendar_0 is selected
            1=SPI-4 ingress calendar_1 is selected if the I_CSW_EN bit is set to
                                                                                           DCLK_AV The SPI-4 ingress DCLK_AV field describes the availability
            a logic one
                                                                                       state of the SPI-4 ingress clock.
                                                                                                    0=SPI-4 ingress clock is not available
    I_LOW        The I_LOW field selects the SPI-4 ingress clock frequency range.
                                                                                                    1= SPI-4 ingress clock is available
            0=SPI-4 ingress clock is greater than or equal to 200 MHz
            1=SPI-4 ingress clock is less than 200 MHz
                                                                                       SPI-4 ingress inactive transfer port (Block_base
SPI-4 ingress status configuration register                                            0x0300 + Register_offset 0x03)
(Block_base 0x0300 + Register_offset 0x01)                                             TABLE 92 - SPI-4 INGRESS INACTIVE TRANSFER
TABLE 90 - SPI-4 INGRESS STATUS CONFIGURA-                                             PORT (REGISTER_OFFSET 0x03)
TION REGISTER (REGISTER_OFFSET 0x01)                                                               Field                  Bits         Length          Initial Value
            Field                  Bits       Length             Initial Value              INACT_LP                       7:0            8                    0
     FIFO_MAX_T                    23:0          24                    0
                                                                                           The SPI-4 ingress inactive transfer port is at Block_base 0x0300 and has
     ALPHA_FIFO                   31:24           8                    0               read-only access.
    The SPI-4 ingress status configuration register is at Block_base 0x0300 and            The SPI-4 ingress inactive transfer port INACT_LP field is used to monitor
has read and write access.                                                             the LP associated with the latest inactive transfer. The INACT_LP field can
    The SPI-4 ingress status configuration register is used to set the state of the    change at any time and is used for diagnostics only.
SPI-4 ingress FIFO status path interface. The bit fields of the SPI-4 ingress status
configuration register are described.                                                      INACT_LP The SPI-4 ingress INACT_LP field contains the numeric value
                                                                                       of the LP associated with the last inactive LP transfer, used for diagnostics only.
    FIFO_MAX_T The SPI-4 ingress FIFO_MAX_T field is the maximum time
interval between scheduling of training sequences on the FIFO status path
interface. The units are the number of times the calendar is sent before
scheduling the training sequence.
                                                                                     70                                                               APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                                 INDUSTRIAL TEMPERATURE RANGE
SPI-4 ingress calendar configuration register                                           SPI-4 ingress fill level register (Block_base 0x0300
(Block_base 0x0300 + Register_offset 0x04 - 0x05)                                       + Register_offset 0x07 - 0x08)
TABLE 93 - SPI-4 INGRESS CALENDAR CONFIGU-                                              TABLE 95 - SPI-4 INGRESS FILL LEVEL REGISTER
RATION REGISTER (0x04 to 0x05)                                                          (0x07 to 0x08)
             Field                   Bits       Length           Initial Value                     Field                  Bits           Length         Initial Value
     I_CAL_M                          7:0           8                  0                    FILL_CUR                       5:0               6                  0x0
     I_CAL_LEN                       13:8           6                0x01                  There is one register for SPI-4 ingress fill level register per SPI-3 interface
    The SPI-4 ingress calendar configuration registers are at Block_base                at Block_base 0x0300. Each register has read-only access.
0x0300 and have read and write access. The Register_offset for calendar_0                  The SPI-4 ingress Fill Level Register for PFP A is at Block_base 0x0300 +
is 0x04. The Register_offset for calendar_1 is 0x05.                                    Register_offset 0x07.
    The bit fields of a SPI-4 ingress calendar configuration register are described.       The SPI-4 ingress Fill Level Register for PFP B is at Block_base 0x0300 +
    Some devices have a fixed calendar length and a fixed calendar M, while             Register_offset 0x08.
the Bridgeport calendar length has to be multiply of 4, and the calendar M is              The bit fields of a SPI-4 ingress fill level register are described.
programmable. Therefore, the user may need to add an FPGA between the
Bridgeport & the adjacent device SPI-4 status signals.                                     FILL_CUR Current SPI-4 ingress buffer fill level. Since this is a real-time
                                                                                        register, the value read from it will change rapidly and is used for internal
    I_CAL_M The I_CAL_M value programmed defines the number of times                    diagnostics only.
the calendar sequence is repeated before a DIP-2 parity and “1 1” framing
words are inserted. The actual calendar_M value used is one more than the               SPI-4 ingress max fill level register (Block_base
value programmed into the I_CAL_M field.                                                0x0300 + Register_offset 0x0B - 0x0C)
                                                                                        TABLE 96 - SPI-4 INGRESS MAX FILL LEVEL
    I_CAL_LEN             The I_CAL_LEN value programmed defines the length of          REGISTER (0x0B and 0x0C)
the SPI-4 ingress calendar. The actual length of the calendar is four times the
value of one more than the I_CAL_LEN field: (I_CAL_LEN + 1)*4. For example,                        Field                  Bits           Length         Initial Value
if the I_CAL_LEN field is programmed to 0x04, the actual value used is 0x14.                FILL_MAX                       5:0               6                 0x00
The calendar length must be at least as large as the number of active SPI-4
ingress LPs.                                                                               There is one register for SPI-4 ingress max fill level register per SPI-3
                                                                                        interface at Block_base 0x0300. Each register has read-only access, and is
SPI-4 ingress watermark register (Block_base                                            cleared after reading. 0x20 is the highest filling level, meaning all ingress buffers
0x0300 + Register_offset 0x06)                                                          on a PFP had been full at some time since the last read of the FILL_MAX field.
TABLE 94 – SPI-4 INGRESS WATERMARK REGIS-                                               The units of FILL_MAX are one-thirty-second of the available ingress buffering
TER (REGISTER_OFFSET 0x06)                                                              per PFP. Each unit is equal to 128 bytes.
                                                                                           The SPI-4 ingress max fill level register for PFP A is at Block_base 0x0300
         Field           Bits Length Initial Value                Function
                                                                                        + Register_offset 0x0B.
   WATERMARK              4:0        5          0x0D       Watermark for PFP A             The SPI-4 ingress max fill level register for PFP B is at Block_base 0x0300
   reserved               7:5        3            0                                     + Register_offset 0x0C.
   WATERMARK             12:6        5          0x0D       Watermark for PFP B             The bit field of a SPI-4 ingress max fill level register is described.
   reserved              15:13       3            0
   Reserved              20:16       5          0x0D                                       FILL_MAX Maximum SPI-4 ingress buffer fill level since the last read of the
   reserved              23:21       3            0                                     SPI-4 ingress max fill level register.
   Reserved              28:24       5          0x0D
   reserved              31:29       3            0                                     SPI-4 ingress diagnostics register (Block_base
                                                                                        0x0300 + Register_offset 0x0F)
    SPI-4 ingress Watermark Register is at Block_base 0x0300, Register_offset
0x06. The SPI-4 ingress Watermark Register has read and write access. A SPI-            TABLE 97 - SPI-4 INGRESS DIAGNOSTICS REGIS-
4 interface can be set to a Watermark Value per PFP. 0x1F is the highest                TER (REGISTER_OFFSET 0x0F)
watermark that can be set, meaning all ingress buffers will be full before                         Field                  Bits           Length         Initial Value
backpressure will be initiated on a SPI-4 ingress interface PFP. A WATER-                  I_FORCE_TRAIN                     0               1                  0
MARK field value of 0x0F is used to set a watermark for a half-full ingress buffer         I_ERR_INS                         1               1                  0
before tripping backpressure. The units of WATERMARK are one-thirty-                       I_DIP_NUM                       5:2               4                  0
second of the available ingress buffering per unit. Each unit is equal to 128 bytes.
                                                                                           The SPI-4 ingress Diagnostics Register is addressed from Block_base
                                                                                        0x0300 + Register_offset 0x0F. The SPI-4 ingress Diagnostics Register has
                                                                                        read and write access. The SPI-4 ingress Diagnostics Register is used in port
                                                                                        diagnostics to force continuous training on the SPI-4 ingress status interface,
                                                                                     71                                                                 APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                               INDUSTRIAL TEMPERATURE RANGE
insert a DIP-2 error on the SPI-4 ingress status interface, and read the number       SPI-4 ingress start up training threshold register
of DIP-2 errors seen on the SPI-4 egress status interface.                            (Block_base 0x0300 + Register_offset 0x12)
                                                                                      TABLE 100 - SPI-4 INGRESS START UP TRAINING
   I_FORCE_TRAIN The I_FORCE_TRAIN field is used to force continu-                    THRESHOLD REGISTER (REGISTER_OFFSET 0x12)
ous training on the SPI-4 ingress status interface.
            0=Normal status channel operation                                                      Field                  Bits      Length           Initial Value
            1=Force continuous training on the SPI-4 ingress status interface              STRT_TRAIN                      7:0          8                   0
                                                                                         The SPI-4 ingress start up training threshold register is addressed from
   I_ERR_INS           The I_ERR_INS field is used to insert the number of DIP-       Block_base 0x0300 + Register_offset 0x12. The SPI-4 ingress start up training
2 errors on the SPI-4 ingress status interface programmed into the I_DIP_NUM          threshold register has read and write access. The SPI-4 ingress start up training
field. After the DIP-2 errors are inserted, the I_ERR_INS field will clear itself.    threshold register is used to set the number of consecutive training patterns that
            0=Normal status channel operation                                         will lead to OUT_OF_SYNCH on the SPI-4 ingress data. If the STRT_TRAIN
            1= Insert DIP-2 errors on the SPI-4 ingress status interface              field is set to zero, then the OUT_OF_SYNCH feature is disabled.
   I_DIP_NUM                                                                             STRT_TRAIN The STRT_TRAIN field is used to set the number of
   The I_DIP_NUM field is used to create the number of DIP-2 errors                   consecutive training patterns that will lead to OUT_OF_SYNCH on the SPI-4
programmed into the I_DIP_NUM field on the SPI-4 egress status interface..            ingress data interface.
SPI-4 ingress DIP-4 error counter (Block_base                                         9.4.5 Common module block base 0x0400 registers
0x0300 + Register_offset 0x10)                                                        SPI-4 egress LID to LP map (Block_base 0x0400 +
TABLE 98 - SPI-4 INGRESS DIP-4 ERROR                                                  Register_offset 0x00 - 0x7F)
COUNTER (REGISTER_OFFSET 0x10)                                                        TABLE 101 - SPI-4 EGRESS LID TO LP MAP
            Field                  Bits       Length           Initial Value          (128 ENTRIES)
    DIP_4                          15:0          16                   0                            Field                  Bits      Length           Initial Value
                                                                                           LP                              7:0          8                0x00
   The SPI-4 ingress DIP-4 error counter is addressed from Block_base
                                                                                           EN                               8           1                 0b0
0x0300 + Register_offset 0x10. The SPI-4 ingress DIP-4 error counter has
read access, and automatically clears itself after a read. The SPI-4 ingress DIP-        There are 128 entries in the SPI-4 egress LID to LP map for the SPI-4 ingress
4 error counter is used in port diagnostics to verify the integrity of the SPI-4      interface. The entries are at Block_base 0x0400 + LID. For example, LID 0x00
ingress data path.                                                                    is at Block_base 0x0400 + 0x00. A SPI-4 egress LID to LP map has read and
                                                                                      write access. A SPI-4 egress LID to LP map is used to map a logical identifier
   DIP_4 The DIP_4 field is used to read the number of DIP-4 errors seen on           used internally to a SPI-4 egress logical port.
the SPI-4 egress status interface. The DIP_4 field saturates at the value                0x00 - 0x3F of the LID map is used for Module A LIDs 0x00 - 0x3F
0xFFFF, and is automatically cleared after reading to re-start DIP-4 error               0x40 - 0x7F of the LID map is used for Module B LIDs 0x40 - 0x7F
counter accumulation.                                                                    Data for an inactive LP having an entry in the calendar is forwarded to
                                                                                      LID0. Therefore all the LPs that have entries in the calendar tables should
SPI-4 ingress bit alignment control register                                          be enabled.
                                                                                         LP The LP programmed is associated to the LID with the same number as
(Block_base 0x0300 + Register_offset 0x11)
                                                                                      the register address. Eight bits support the 256 possible LPs on the SPI-4
TABLE 99 - SPI-4 INGRESS BIT ALIGNMENT                                                physical interface. Only 128 LPs can be supported at one time with the
CONTROL REGISTER (REGISTER_OFFSET 0x11)                                               IDT88P8342 device.
            Field                  Bits       Length           Initial Value
    FORCE                           0             1                   0                  EN The EN bit is used to enable or disable the connection of a LID to an LP.
                                                                                                   0=LP is disabled
   The SPI-4 ingress bit alignment control register is addressed from Block_base                   1=LP is enabled
0x0300 + Register_offset 0x11. The SPI-4 ingress bit alignment control register
has read and write access. The SPI-4 ingress bit alignment control register is        9.4.6 Common module block base 0x0500 registers
used to overrule the automatically selected bit phase alignments and go to
                                                                                      SPI-4 egress calendar_0 (Block_base 0x0500 +
manual mode. In manual mode, the PHASE_ASSIGN field [Block_base 0x0800
+ Register_offset 0x0c – 0x1F] now defines the selected phase.
                                                                                      Register_offset 0x00 – 0xFF)
                                                                                      TABLE 102 - SPI-4 EGRESS CALENDAR_0
   FORCE The FORCE field is used to manually align the SPI-4 ingress data.            (256 LOCATIONS)
            0=Normal bit alignment operation                                                       Field                  Bits      Length           Initial Value
             1= Force to manual bit alignment mode on SPI-4 ingress data using             LP                              7:0          8                0xFF
            the PHASE_ASSIGN field.                                                      The SPI-4 egress calendar_0 is at Block_base 0x0500 and has read and
                                                                                      write access. When the SPI-4 egress calendar_0 is selected, calendar_0 is
                                                                                      in use. There are 256 entries in the SPI-4 egress calendar_0 to schedule the
                                                                                      updating of the FIFO status channel LPs to the attached device. If less than the
                                                                                   72                                                               APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                               INDUSTRIAL TEMPERATURE RANGE
maximum 256 LPs are needed on the SPI-4 interface, the calendar entries                   E_CLK_EDGE The SPI-4 egress clock active clock edge is selected using
should be used for scheduling more frequent status updated for higher-speed            the E_CLK_EDGE field.
LPs. The value of time-critical LPs must appear multiple times in the table. For                   0=SPI-4 egress clock uses the rising clock edge
example, a multi-PHY SPI-4 could have OC-48 channels appear in the                                 1=SPI-4 egress clock uses the falling clock edge
calendar at four times the rate of OC-12 channels, since the higher data rate of
the OC-48 channels would benefit from more frequent FIFO status channel                   E_DSC          The E_DSC bit enables or disables de-skewing of the SPI-4
updates. The LP field values range from 0x00 to 0xFF. The IDT88P8342 and               egress data lines.
the attached devices must have identical calendars.                                                0=Data de-skewing is disabled
                                                                                                   1=Data de-skewing is enabled (recommended)
   LP      The LP value programmed schedules a status channel update
according to the calendar sequence.                                                       E_INSYNC_THR The SPI-4 egress DIP-2 in-synchronization thresh-
                                                                                       old is controlled using the E_INSYNC_THR field. It is recommended to use the
9.4.7 Common module block base 0x0600 registers                                        initial value.
SPI-4 egress calendar_1 (Block_base 0x0600 +
Register_offset 0x00 – 0xFF)                                                              E_OUTSYNC_THR The SPI-4 egress DIP-2 out-of-synchronization
                                                                                       threshold is controlled using the E_OUTSYNC_THR field. It is recommended
TABLE 103 - SPI-4 EGRESS CALENDAR_1                                                    to use the initial value.
(256 LOCATIONS)
           Field                    Bits        Length          Initial Value             E_CSW_EN The ingress calendar switch enable bit is used to enable
    LP                              7:0             8               0xFF               the switching of the active calendars following the reception of the calendar
   The SPI-4 egress calendar_1 is at Block_base 0x0600 and had read and                selection word on the status channel. It is recommended to use the initial value.
write access. When the SPI-4 egress calendar_1 is selected, calendar_1 is in                       0=Egress calendar switch is disabled. Only SPI-4 egress calen-
use. There are 256 entries in the SPI-4 egress calendar_1 to schedule the                          dar_0 is used.
updating of the FIFO status channel LPs to the attached device. If less than the                   1=Egress calendar switch is enabled. Calendar_0 or calendar_1
maximum 256 LPs are needed on the SPI-4 interface, the calendar entries                            will be used.
should be used for scheduling more frequent status updated for higher-speed
LPs. The value of time-critical LPs must appear multiple times in the table. For          E_LOW The E_LOW field selects the SPI-4 egress clock frequency
example, a multi-PHY SPI-4 could have OC-48 channels appear in the                     range.
calendar at four times the rate of OC-12 channels, since the higher data rate of                   0=SPI-4 egress clock is greater than or equal to 200 MHz
the OC-48 channels would benefit from more frequent FIFO status channel                            1=SPI-4 egress clock is less than 200 MHz
updates. The LP field values range from 0x00 to 0xFF. The IDT88P8342 and
the attached devices must have identical calendars.                                       NOSTAT The NOSTAT bit enables the no status channel option. Once
                                                                                       NOSTAT is set, the status channel is ignored. There is no DIP-2 error checking,
   LP      The LP value programmed schedules a status channel update                   and no status channel updating. The received status is fixed to starving. The
according to the calendar sequence.                                                    data channel is put into the IN_SYNCH state.
                                                                                                   0=Normal status channel operation
9.4.8 Common module block base 0x0700 registers                                                    1=No status channel option is selected
SPI-4 egress configuration register_0 (Block_base
0x0700 + Register_offset 0x00)                                                         SPI-4 egress configuration register_1 (Block_base
TABLE 104 – SPI-4 EGRESS CONFIGURATION
                                                                                       0x0700 + Register_offset 0x01)
REGISTER_0 (REGISTER_OFFSET 0x00)                                                      TABLE 105 - SPI-4 EGRESS CONFIGURATION
           Field                    Bits        Length          Initial Value          REGISTER_1 (REGISTER_OFFSET 0x01)
    Reserved                        2:0             3                 0                            Field                 Bits         Length          Initial Value
    E_CLK_EDGE                         3            1                 0                     DATA_MAX_T                   23:0           24                  0
    E_DSC                              4            1                 0                     ALPHA                        31:24           8                  0
    E_INSYNC_THR                    9:5             5              0x1F                   The SPI-4 egress configuration register_1 is at Block_base 0x0700 and has
    E_OUTSYNC_THR                  13:10            4               0xF                read and write access.
    E_CSW_EN                         14             1                 0                   The SPI-4 egress configuration register_1 is used to set the state of the SPI-
    Reserved                         15             1                 0                4 egress FIFO status path interface. The bit fields of the SPI-4 egress
    E_LOW                            16             1                 1                configuration register_1 are described.
    NOSTAT                           17             1                 0
                                                                                          DATA_MAX_T The SPI-4 egress DATA_MAX_T field is the maximum
   The SPI-4 egress configuration register_0 is at Block_base 0x0700 and has           time interval between scheduling of training sequences on the egress data path
read and write access.                                                                 interface. The purpose of the data training interval is to allow the de-skewing
   The SPI-4 egress configuration register_0 is used to set the state of the SPI-      of plus or minus one bit time on the egress data interface if needed. The time is
4 egress interface. The bit fields of the SPI-4 egress configuration register_0 are    set for the DATA_MAX_T field multiplied by 128 cycles.
described.
                                                                                    73                                                                APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                            INDUSTRIAL TEMPERATURE RANGE
   ALPHA         The SPI-4 egress ALPHA field is the number of repetitions of the       E_CAL_M The E_CAL_M value programmed defines the number of
data training sequence that must be scheduled every DATA_MAX_T cycles.              times the calendar sequence is repeated before a DIP-2 parity and “1 1” framing
The value for alpha used is actually one more than the ALPHA value                  words are inserted. The actual calendar_M value used is one more than the
programmed into the ALPHA field.                                                    value programmed into the E_CAL_M field.
SPI-4 egress status register (Block_base 0x0700 +                                       E_CAL_LEN The E_CAL_LEN value programmed defines the length of
Register_offset 0x02)                                                               the SPI-4 egress calendar. The actual length of the calendar is four times one
                                                                                    more than the value programmed into the E_CAL_LEN field. For example, if
TABLE 106 - SPI-4 EGRESS STATUS REGISTER
                                                                                    the E_CAL_LEN field is programmed to 0x3F, the actual value used is 0x100.
(REGISTER_OFFSET 0x02)
                                                                                    The calendar length must be at least as large as the number of active SPI-4
           Field                  Bits        Length          Initial Value         egress LPs.
  E_SYNCH                          0             1                  0
  E_DSK_OOR                        1             1                  0               SPI-4 egress diagnostics register (Block_base
  SCLK_AV                          2             1                  0               0x0700 + Register_offset 0x05)
   SPI-4 egress status register                                                     TABLE 108 – SPI-4 EGRESS DIAGNOSTICS REGIS-
   The SPI-4 egress status register is at Block_base 0x0700 and has read-only       TER (REGISTER_OFFSET 0x05)
access.                                                                                      Field                    Bits               Length               Initial
   The SPI-4 egress status register is used to set the state of the SPI-4 egress                                                          Value
synchronization.                                                                       E_FORCE_TRAIN                   0                     1                    0
   The bit fields of the SPI-4 egress status register are described.                   E_ERR_INS                       1                     1                    0
                                                                                       E_DIP_NUM                      5:2                    4                    0
   E_SYNCH           The SPI-4 egress E_SYNCH field describes the synchro-             BIT_DELAY                      7:6                    2                    0
nization state of the SPI-4 egress data path.
            0=SPI-4 egress data path is out of synchronization                          The SPI-4 egress diagnostics register is addressed from Block_base 0x0700
            1=SPI-4 egress data path is in synchronization                          + Register_offset 0x05. The SPI-4 egress diagnostics register has read and
                                                                                    write access.
   E_DSK_OOR The SPI-4 egress E_DSK_OOR field describes the de-                         E_FORCE_TRAIN The E_FORCE_TRAIN field is used to force continu-
skew state of the SPI-4 egress data path.                                           ous training on the SPI-4 egress status interface.
            0=SPI-4 egress data path de-skew is within range                                     0=Normal status channel operation
            1=SPI-4 egress data path de-skew is out of range                                     1=Force continuous training on the SPI-4 egress status interface
   SCLK_AV           The SPI-4 egress SCLK_AV field describes the availability          E_ERR_INS The E_ERR_INS field is used to insert the number of DIP-
state of the SPI-4 egress status channel clock. This function is not available if   4 errors on the SPI-4 egress data interface that have been programmed into
SCLK < 0.5 MCLK.                                                                    the E_DIP_NUM field. After the DIP-4 errors are inserted, the E_ERR_INS field
            0=SPI-4 egress status channel clock is not available                    will clear itself.
            1=SPI-4 egress status channel clock is available                                     0=Normal status channel operation
                                                                                                 1= Insert DIP-4 errors on the SPI-4 egress data interface
SPI-4 egress calendar configuration register
                                                                                        E_DIP_NUM The E_DIP_NUM field is used to create DPI-4 errors on the
(Block_base 0x0700 + Register_offset 0x03 - 0x04)
                                                                                    SPI-4 egress data interface. The number of errors generated is equal to the
TABLE 107 - SPI-4 EGRESS CALENDAR CONFIGU-                                          value of the E_DIP_NUM field.
RATION REGISTER (REGISTER_OFFSET 0x03 -
0x04)                                                                                   BIT_DELAY The BIT_DELAY field is used to delay SPI-4 egress data bit
      Field              Acc           Bits          Length           Initial       line 0 by the number of bits programmed into the BIT_DELAY field. This may
                                                      Value                         be used for diagnostics.
 E_CAL_M                RW              7:0              8           0
 E_CAL_LEN              RW             13:8              6           0x01           SPI-4 egress DIP-2 error counter (Block_base
   The SPI-4 egress calendar configuration registers are at Block_base              0x0700 + Register_offset 0x06)
0x0300 and has read and write access. The Register_offset for calendar_0 is         TABLE 109 - SPI-4 EGRESS DIP-2 ERROR
0x03. The register offset for calendar_1 is 0x04.                                   COUNTER (REGISTER_OFFSET 0x06)
   The bit fields of the SPI-4 egress calendar configuration register are                     Field               Bits              Length              Initial Value
described.                                                                                     DIP_2              15:0                 16                      0
   The IDT88P8342 calendar length can be programmed to any multiple of 4
using suitable values for the calendar entries, calendar length and calendar            The SPI-4 egress DIP-2 error counter is addressed from Block_base
M. If the adjacent device is unable to configure its calendar to be a multiple of   0x0700 + Register_offset 0x06. The SPI-2 egress DIP-2 error counter has read
4, conversion logic may be needed between the adjacent device SPI-4                 access, and automatically clears itself after a read. The SPI-4 egress DIP-2 error
status signals and the 88P8342 signals.                                             counter is used in port diagnostics to verify the integrity of the SPI-4 egress status
                                                                                    channel.
                                                                                  74                                                                   APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                                      INDUSTRIAL TEMPERATURE RANGE
    DIP_2 The DIP_2 field is used to read the number of DIP-2 errors seen on               SPI-4 ingress bit alignment counter register
the SPI-4 egress status interface. The DIP_2 field saturates at the value                  (Block_base 0x0800 + Register_offset 0x02 – 0x0B)
0xFFFF, and is automatically cleared after reading to re-start DIP-2 error
                                                                                           TABLE 112 - SPI-4 INGRESS BIT ALIGNMENT
counter accumulation.
                                                                                           COUNTER REGISTER (0x02 to 0x0B)
                                                                                                      Field                 Bits         Length             Initial Value
9.4.9 Common module block base 0x0800 registers
                                                                                                      C[n]                   9:0            10                     0
SPI-4 ingress bit alignment window register
(Block_base 0x0800 + Register_offset 0x00)                                                    The SPI-4 ingress bit alignment counter registers at Block_base 0x0800 are
                                                                                           read-only and contains the values of the bit alignment counters used for manual
TABLE 110 - SPI-4 INGRESS BIT ALIGNMENT                                                    lane alignment . The registers are intended for diagnostics only and are not
WINDOW REGISTER (REGISTER_OFFSET 0x00)                                                     needed in normal operation.
          Field                  Bits            Length             Initial Value
          W                     15:0                16                0xFFFF               SPI-4 ingress manual alignment phase/result
    The SPI-4 ingress bit alignment window register is addressed from Block_base           register (Block_base 0x0800 + Register_offset
0x0800 + Register_offset 0x00. The SPI-4 ingress bit alignment window register             0x0C – 0x1F)
has read and write access. The SPI-4 ingress bit alignment window register is              TABLE 113 - SPI-4 INGRESS MANUAL ALIGNMENT
used in manual bit alignment procedures and it is recommended to leave the                 PHASE/RESULT REGISTER (0x0C to 0x1F)
W field at its initial value.
                                                                                                      Field                 Bits         Length             Initial Value
                                                                                              PHASE_ASSIGN                   7:0             8                     0
    W        The W field is used to define the width of the SPI-4 ingress bit alignment
observation window by setting the time between bit alignment operations. .                    The SPI-4 ingress manual alignment phase/result registers at Block_base
                                                                                           0x0800 have read and write access. A SPI-4 ingress manual alignment phase/
SPI-4 ingress lane measure register (Block_base                                            result register is used to manually align the phase of the data lane, control lane,
0x0800 + Register_offset 0x01)                                                             status lanes, and a test lane corresponding to its register in turn and is intended
                                                                                           for diagnostics only and is not needed in normal operation. If the FORCE field
TABLE 111 - SPI-4 INGRESS LANE MEASURE                                                     of Table 99, SPI-4 ingress bit alignment control register (register_offset 0x11)
REGISTER (REGISTER_OFFSET 0x01)                                                            is set to a logic one, manual phase alignment is enabled. If the FORCE field is
                                                                                           set to a logic zero, normal automatic phase alignment is enabled, and the result
            Field                    Bits         Length            Initial Value          can be viewed here. There are five center taps to choose from, plus two guard
  LANE                                4:0             5                   0                taps on either side of the center, per data bit sampled. The oldest data sample
  Reserved                            7:5             3                   0                is at tap 8 ("right"), while the newest data sample is at tap 0 ("left"). Taps 0 and
  MEASURE_BUSY                         8              1                   0                1 are the left margin taps for tracking purposes, while taps 7 and 8 are the right
                                                                                           margin taps. A tap between 2 to 7 is initially selected in automatic mode. See
    The SPI-4 ingress lane measure register is addressed from Block_base
                                                                                           Figure 7-Data sampling diagram. Register 0x0C is used for lane DATA0.
0x0800 + Register_offset 0x01. The SPI-4 ingress lane measure register has
read and write access. SPI-4 ingress lane measure register is used in manual                  PHASE_ASSIGN [3:0]
bit alignment procedures and it is recommended to leave the SPI-4 ingress lane                Used for selecting the bit phase corresponding to the rising clock edge of
measure register at its initial value.                                                     I_DCLK. The four bits number the phases from 0 to 8, relative to the positively-
                                                                                           clocked bit.
    LANE The LANE field is used to manually control the measurement of SPI-
4 ingress data lane alignment. The LANE field is intended for diagnostics only                PHASE_ASSIGN [7:4]
and is not needed in normal operation.                                                        Used for selecting the bit phase corresponding to the falling clock edge of
             0=DATA0 lane selected for measurement                                         I_DCLK. The four bits number the phases from 0 to 8, relative to the negatively-
             x=DATAx lane selected for measurement                                         clocked bit.
             15=DATA15 lane selected for measurement
             16=CTL selected for measurement                                               SPI-4 egress data lane timing register (Block_base
             17=Egress status 0 selected for measurement                                   0x0800 + Register_offset 0x2A)
             18=Egress status 1 selected for measurement                                   TABLE 114 - SPI-4 EGRESS DATA LANE TIMING
             19=Chip test feature not available for diagnostics                            REGISTER (REGISTER_OFFSET 0x2A)
                                                                                                        Field                   Bits      Length            Initial Value
    MEASURE_BUSY The MEASURE_BUSY field is used to observe                                   DTC0[1:0]                           1:0          2                   0
when the LANE process is busy for manual lane assignment procedures. The                     DTC1[1:0]                           3:2          2                   0
MEASURE_BUSY field is intended for diagnostics only and is not needed for                    …                                    ..          2                   0
normal operation.                                                                            DTC15[1:0]                        31:30          2                   0
             0=Normal operation
                                                                                              The SPI-4 egress data lane timing register at Block_base 0x0800 +
             1=Lane process is busy
                                                                                           Register_offset 0x2A has read and write access. The SPI-4 egress data lane
                                                                                           timing register is used to manually align the phase of data lane n by adding from
                                                                                           0.1 clock cycle to 0.3 clock cycles of delay.
                                                                                        75                                                                 APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                                  INDUSTRIAL TEMPERATURE RANGE
   DTCn [1:0]          Used for adding 0.1 clock cycles of output delay to SPI-         SPI-4 egress status timing register (Block_base
4 egress data lane n.                                                                   0x0800 + Register_offset 0x2D)
            [1:0]=0=No added delay
                                                                                        TABLE 117 - SPI-4 EGRESS STATUS TIMING
            [1:0]=1=Add 0.1 clock cycle of delay to data lane n
                                                                                        REGISTER (REGISTER_OFFSET 0x2D)
            [1:0]=2=Add 0.2 clock cycles of delay to data lane n                                   Field                Bits            Length           Initial Value
            [1:0]=3=Add 0.3 clock cycles of delay to data lane n                               STC0[1:0]                1:0                 2                   0
                                                                                               STC1[1:0]                3:2                 2                   0
SPI-4 egress control lane timing register                                                   The SPI-4 egress status timing register at Block_base 0x0800 + Register_offset
(Block_base 0x0800 + Register_offset 0x2B)                                              0x2D has read and write access. The SPI-4 egress status timing register is used
TABLE 115 - SPI-4 EGRESS CONTROL LANE                                                   to manually align the phase of the status lane n by adding from 0.1 clock cycle
TIMING REGISTER (REGISTER_OFFSET 0x2B)                                                  to 0.3 clock cycles of delay. The STC0[1:0] and STC1[1:0] fields are valid only
         Field                 Bits            Length           Initial Value           for LVDS status, not for LVTTL status.
      CTLTC[1:0]                1:0               2                    0
                                                                                            STCn [1:0]          Used for adding 0.1 clock cycles of output delay to SPI-
   The SPI-4 egress control lane timing register at Block_base 0x0800 has read          4 egress status lane n.
and write access. The SPI-4 egress controllane timing register is used to                             [1:0]=0=No added delay
manually align the phase of the control lane by adding from 0.1 clock cycle to                        [1:0]=1=Add 0.1 clock cycle of delay to status lane n
0.3 clock cycles of delay.                                                                            [1:0]=2=Add 0.2 clock cycles of delay to status lane n
                                                                                                      [1:0]=3=Add 0.3 clock cycles of delay to status lane n
   CTLTC [1:0]         Used for adding 0.1 clock cycles of output delay to the SPI-
4 egress control output.                                                                SPI-4 egress status clock timing register
            [1:0]=0=No added delay                                                      (Block_base 0x0800 + Register_offset 0x2E)
            [1:0]=1=Add 0.1 clock cycle of delay to the control output
            [1:0]=2=Add 0.2 clock cycles of delay to the control output                 TABLE 118 - SPI-4 EGRESS STATUS CLOCK TIM-
            [1:0]=3=Add 0.3 clock cycles of delay to the control output                 ING REGISTER (REGISTER_OFFSET 0x2E)
                                                                                                   Field                Bits            Length           Initial Value
SPI-4 egress data clock timing register                                                        SCTC[3:0]                 3:0                4                   0
(Block_base 0x0800 + Register_offset 0x2C)                                                  The SPI-4 egress status clock timing register at Block_base 0x0800 +
TABLE 116 - SPI-4 EGRESS DATA CLOCK TIMING                                              Register_offset 0x2E has read and write access. The SPI-4 egress status clock
REGISTER (REGISTER_OFFSET 0x2C)                                                         timing register is used to manually align the phase of the SPI-4 egress status clock
         Field                 Bits            Length           Initial Value           to the status outputs by adding from 0.1 clock cycle to 0.9 clock cycles of delay
                                                                                        to the status clock output. Note that tap selection is not monotonic with the number
      DCTC[3:0]                 3:0               4                    0
                                                                                        in bit field [3:0].
   The SPI-4 egress data clock timing control register at Block_base 0x0800                 SCTC [3:0]          Used for adding 0.1 clock cycles of output delay to the SPI-
has read and write access. The SPI-4 egress data clock timing control register          4 egress status clock output.
is used to manually align the phase of the SPI-4 egress data clock to the data                        [3:0]=0=No added delay
and control lanes by adding from 0.1 clock cycle to 0.9 clock cycles of delay to                      [3:0]=1=Add 0.1 clock cycle of delay to the SPI-4 egress status clock
the data clock. Note that tap selection is not monotonic with the number in bit field                 [3:0]=3=Add 0.2 clock cycles of delay to the SPI-4 egress status clock
[3:0].                                                                                                [3:0]=2=Add 0.3 clock cycles of delay to the SPI-4 egress status clock
                                                                                                      [3:0]=7=Add 0.4 clock cycles of delay to the SPI-4 egress status clock
   DCTC [3:0] Used for adding 0.1clock cycles of output delay to the SPI-                             [3:0]=6=Add 0.5 clock cycles of delay to the SPI-4 egress status clock
4 egress data clock.                                                                                  [3:0]=4=Add 0.6 clock cycles of delay to the SPI-4 egress status clock
            [3:0]=0=No added delay                                                                    [3:0]=5=Add 0.7 clock cycles of delay to the SPI-4 egress status clock
            [3:0]=1=Add 0.1 clock cycle of delay to the SPI-4 egress data clock                       [3:0]=F=Add 0.8 clock cycles of delay to the SPI-4 egress status clock
            [3:0]=3=Add 0.2 clock cycles of delay to the SPI-4 egress data clock                      [3:0]=E=Add 0.9 clock cycles of delay to the SPI-4 egress status clock
            [3:0]=2=Add 0.3 clock cycles of delay to the SPI-4 egress data clock
            [3:0]=7=Add 0.4 clock cycles of delay to the SPI-4 egress data clock
            [3:0]=6=Add 0.5 clock cycles of delay to the SPI-4 egress data clock
            [3:0]=4=Add 0.6 clock cycles of delay to the SPI-4 egress data clock
            [3:0]=5=Add 0.7 clock cycles of delay to the SPI-4 egress data clock
            [3:0]=F=Add 0.8 clock cycles of delay to the SPI-4 egress data clock
            [3:0]=E=Add 0.9 clock cycles of delay to the SPI-4 egress data clock
                                                                                      76                                                                 APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                                  INDUSTRIAL TEMPERATURE RANGE
9.4.10 Common module block base 0x0900 registers                                        Clock generator control register (Block_base
                                                                                        0x0900 + Register_offset 0x010)
PMON timebase control register (Block_base                                              TABLE 121 - CLOCK GENERATOR CONTROL
0x0900 + Register_offset 0x00)                                                          REGISTER (REGISTER_OFFSET 0x10)
TABLE 119 - PMON TIMEBASE CONTROL REGIS-                                                         Field                  Bits           Length            Initial Value
TER (REGISTER_OFFSET 0x00)                                                                    OCLK0_EN                    0                 1                 0b01
                                                                                              N_OCLK0                    2:1                2                 0b11
            Field                  Bits        Length            Initial Value
                                                                                              Reserved                    3                 1                  0b0
  INTERNAL                           0            1                   0b0
                                                                                              OCLK1_EN                    4                 1                  0b1
  TIMER                              1            1                   0b0
                                                                                              N_OCLK1                    6:5                2                 0b11
  MANUAL                             2            1                   0b0
                                                                                              Reserved                    7                 1                  0b0
    A single PMON timebase module is available in the IDT88P8344. The PMON
                                                                                              OCLK2_EN                    8                 1                  0b1
timebase module directs a timebase event to all PMON modules in the device.
The timebase period can be internally or externally generated. The selection                  N_OCLK2                   10:9                2                 0b11
is made by the INTERNAL flag in the PMON update control register. A snapshot                  Reserved                   11                 1                  0b0
of the counters is taken when the timebase expires and the counters are cleared.              OCLK3_EN                   12                 1                  0b1
The PMON update control register is at common module 0x8000 + Block_base                      N_OCLK3                  14:13                2                 0b11
0x0900 + Register_offset 0x00 = 0x8900 and has read and write access.                         Reserved                 16:15                2                  0b0
                                                                                              N_MCLK                   18:17                2                 0b11
    INTERNAL           Selects between internal or external timebases for perfor-             Reserved                 31:19               13                   0
mance monitoring. The internal timebase is either generated by the internal                The clock generator control register is at common module Block_base
processor or by a free running timer. The selection is made by the TIMER flag           0x0900 + Register_offset 0x010.
in the PMON update control register. When the time interval expires, the                   The clock generator provides four clock outputs on the OCLK[3:0] pins,
TIMEBASE pin is asserted for sixteen MCLK cycles. The timebase event is                 MCLK for internal use, and SPI-4 data and FIFO status channel egress clocks.
captured by the timebase status in the support interrupt status register.               The OCLK[3:0] clock frequencies can be selected independently of each other.
    0= External timebase from the TIMEBASE pin is selected. The externally              OCLK[3:0] outputs can be used as SPI-3 clock sources. The OCLK[3:0] pins
generated timebase signal is applied to the TIMEBASE pin. A positive edge               are separately enabled by setting each associated enable flag in Table 121 -
detector generates the timebase event.                                                  Clock generator control register (Register_offset 0x10). When an OCLK[3:0]
    1=Internal timebase is selected. When the time interval expires, the TIMEBASE       output is not enabled, it is in a logic low state. MCLK is the internal processing
pin is driven high for sixteen MCLK cycles.                                             clock, and is always enabled. Refer to Table 122 - OCLK and MCLK frequency
                                                                                        select encoding, for selecting the frequencies of MCLK and OCLKs.
    TIMER Selects between the internal free-running timebase or a micropro-                During either a hardware or a software reset, the OCLK[3:0] pins are all logic
cessor-controlled write to generate the timebase event. The TIMER field is valid        low. Immediately following reset, all OCLK[3:0] outputs are active with the output
only when the INTERNAL field is a logic one.                                            frequency defined by pll_oclk divided by the initial value in the Table 121 - Clock
            0=Selects the microprocessor generated timebase                             generator control register (Block_base 0x0900 + Register_offset 0x10).
            1=Selects the internal free-running timebase                                   The clock generator control register at indirect address 0x8910 has read and
                                                                                        write access. The clock generator control register is used to set the frequency
    MANUAL             The microprocessor generates an internal timebase event          of MCLK and the OCLK outputs, as well as to enable the OCLK outputs. Note
by a write access with a logical one to the MANUAL flag in the PMON Update              that divider values should be chosen so that OCLK[3:0] and MCLK are within
Control Register if the microprocessor timebase is selected. The MANUAL bit             their specified operating range provided in Table 136, OCLK[3:0] clock outputs
is self-clearing. The MANUAL field is only valid if the TIMER field is a logic zero.    and MCLK internal clock.
            0=No operation                                                                 OCLK[k]_EN Used for enabling the kth OCLK output
            1=A timebase event is generated                                                0=OCLK[k] is not enabled and OCLK[k] is at a logic zero
                                                                                           1=OCLK[k] is enabled and active
Timebase register (Block_base 0x0900 +
Register_offset 0x01)                                                                      N_OCLK[k] [1:0] Select the OCLK[k] frequency according to Table 122-
TABLE 120 - TIMEBASE REGISTER                                                           OCLK and MCLK frequency select encoding.
(REGISTER_OFFSET 0x01)
          Field                Bits          Length              Initial Value             N_MCLK[k] Select the MCLK frequency according to Table 122-OCLK
       PERIOD                  26:0              27               0x4A2 8600            and MCLK frequency select encoding.
    The timebase register is at Block_base 0x0900 + Register_offset 0x01 and            TABLE 122 - OCLK AND MCLK FREQUENCY
has read and write access.                                                              SELECT ENCODING
    The timebase period for free-running timers is configured by the PERIOD field          N_MCLK & N_OCLK[k] Frequency Selects                         Frequency
in the timebase register. The PERIOD field specifies the number of MCLK clock                                         00                              pll_oclk / 4
cycles required for a single event. The PERIOD field is only valid if both the                                        01                              pll_oclk / 6
INTERNAL and TIMER fields are a logic one.                                                                            10                              pll_oclk / 8
                                                                                                                      11                              pll_oclk / 10
                                                                                     77                                                                APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                              INDUSTRIAL TEMPERATURE RANGE
General purpose I/O (Block_base 0x0900 +                                                The GPIO Monitor Table for GPIO[0] is at Common_Module 0x8000+
Register_offset 0x20)                                                                 Block_base 0x900 + Register_offset 0x21 = 8x8921.
                                                                                        The GPIO Monitor Table for GPIO[1] is at Common_Module 0x8000+
TABLE 123 - GPIO REGISTER (REGISTER_OFFSET
                                                                                      Block_base 0x0900 + Register_offset 0x22 = 0x8922.
0x20)
                                                                                        The GPIO Monitor Table for GPIO[2] is at Common_Module 0x8000+
       Field                      Bits        Length            Initial               Block_base 0x0900 + Register_offset 0x23 = 0x8923.
                                                                Value                   The GPIO Monitor Table for GPIO[3] is at Common_Module 0x8000+
 DIR_OUT                           4:0            5             0x00                  Block_base 0x0900 + Register_offset 0x24 = 0x8924.
 Reserved                         7:5             3             0x0                     The GPIO Monitor Table for GPIO[4] is at Common_Module 0x8000+
 LEVEL                            12:8            5             0x00                  Block_base 0x0900 + Register_offset 0x25 = 0x8925.
 Reserved                        15:13            3             0x0
 MONITOR_EN                      20:16            5             0x00                    ADDRESS[15:0]             Used for configuring the indirect address select when
                                                                                      the GPIO pins are put into monitor mode.
    Five general purpose I/O pins are provided. Each pin I/O direction is
controlled by the DIR_OUT field in the GPIO register. The logical level on a GPIO       BIT[4:0] Used for selecting the register bit (1 of 32) for a GPIO put into
pin is controlled by the LEVEL field in the GPIO register if DIR_OUT=1                monitor mode.
(pin=output), or sensed if DIR_OUT=0 (pin=input). Optionally, the LEVEL bit                      BIT[4:0]=0x00 selects data bit 0.
can monitor the logic level of any bit selected from the indirect access space if                …
MONITOR_EN is set high. With MONITOR_EN set high, bits in the indirect                           BIT[4:0]=0x1F selects data bit 31.
access space can be selected for monitoring by the ADDRESS and BIT fields
in the GPIO monitor table.                                                            Version number register (common module
    The general purpose I/O registers are at common module Block_base                 Block_base 0x0900 + Register_offset 0x30)
0x0900 and have read and write access.                                                TABLE 125 - VERSION NUMBER REGISTER
                                                                                      (REGISTER_OFFSET 0x30)
    DIR_OUT[4:0] Used for configuring each GPIO pin as either an input or
                                                                                               Field                 Bits            Length           Initial Value
an output
                                                                                           Version                   7:0                8                  0x01
    0=GPIO pin is an input
    1=GPIO pin is an output                                                                ID                        15:8               8                  0xF8
                                                                                        The version number register is a read-only sixteen-bit register at
    LEVEL[4:0]         Used for sensing or driving each GPIO pin                      Common_module 0x8000 + Block_base 0x0900 + Register_offset 0x30 =
    0=GPIO pin is sensed as a logic zero if an input , or driven to a logic zero if   0x8930 in the indirect register access space. The version number register
an output                                                                             contains hard-coded values that can be read to verify the microprocessor read
    1=GPIO pin is sensed as a logic one if an input , or driven to a logic one if     path is correct, and that the correct part is installed.
an output
                                                                                        VERSION              The hardware version is read from this field.
    MONITOR_EN [4:0] Used for enabling the monitor output function for each
GPIO pin. GPIO pins used as monitors must also be configured to be outputs.             ID                   The hardware identification is read from this field.
All GPIO pins must be used as either monitors or as normal I/O; no mixing of
the monitoring function and the normal I/O function is permitted.
    0=GPIO pin is used as an I/O pin
    1=GPIO pin is used as a monitor pin
GPIO monitor table (Block_base 0x0900 +
Register_offset 0x21 - 0x25)
TABLE 124 - GPIO MONITOR TABLE (5 ENTRIES
0x21-0x25 FOR GPIO[0] THROUGH GPIO[4])
            Field                 Bits        Length          Initial Value
  ADDRESS                       15:0             16            0x0000
  Reserved                      23:16             8            0x00
  BIT                           28:24             5            0x00
  Reserved                      31:29             3            0x0
   A bit in the indirect access space can be selected for monitoring by the
ADDRESS and BIT fields in the GPIO monitor table.
                                                                                    78                                                               APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                                   INDUSTRIAL TEMPERATURE RANGE
10. JTAG INTERFACE
The device supports the optional TRST input signal. It supports a TCK
clock frequency up to 10MHz.
TABLE 126 – JTAG INSTRUCTIONS
     Code                  Instruction                          Function
   000                 EXTEST                           JTAG function
   001                 IDCODE                           JTAG function
   010                 SAMPLE                           JTAG function
   011                 CLAMP                            JTAG function
   100                 HIGHZ                            JTAG function
   101                 Private                          Private function
   111                 BYPASS                           JTAG function
Version field equals 0
JTAG ID #0x044E MANUFACTURER ID 0x033 LAST BIT IS 1.
11. ELECTRICAL AND THERMAL SPECIFICATIONS
11.1 Absolute maximum ratings
TABLE 127 – ABSOLUTE MAXIMUM RATINGS
             Parameter                          Symbol                   Conditions                   Min.(1)      Max.(1)         Unit
   Core Digital Supply Voltage             VDDC18                 VSS=0, AVSS=0, Tj=25°C               -0.3          2.2             V
   I/O Digital Supply Voltage              VDDT33                                                      -0.3          4.6             V
   Analog Supply Voltage                   VDDA18                                                      -0.3          3.6             V
   Analog Supply Voltage                   VDDA33                                                      -0.3          3.6             V
   I/O Input Voltage for CMOS              VinL                                                        -0.5          6.0             V
   I/O Input Voltage for LVTTL             VinL                                                        -0.5          6.0             V
   I/O Output Voltage                      Vout                                                        -0.5          4.6             V
   Latch-up Current                        IO                                                            -           100           mA
   ESD Performance (HBM)                                                                                 -          2000             V
   Ambient Operating Temperature Ta(Industrial)                                                        -40           +85            °C
   Ambient Operating Temperature Ta(Commercial)                                                         0            +70            °C
   Storage Temperature                     TS                                                          -65          +150            °C
NOTE:
1. Functional and tested operating conditions are given in Table Absolute Maximum Ratings are stress ratings only, and functional operation
   at the maximum is not guaranteed. Stresses beyaond those listed may affect device reliability or cause permament damage to the device.
11.2 Recommended Operating Conditions
TABLE 128 – RECOMMENDED OPERATING CONDITIONS
             Parameter                          Symbol             Conditions           Min.            Typ.         Max.          Unit
   Core Digital Supply Voltage             VDDC18                      VSS=0           1.68               1.8        1.96            V
   I/O Digital Supply Voltage              VDDT33                      VSS=0             3.0              3.3         3.6            V
   Analog Supply Voltage                   VDDA18                      VSS=0           1.68               1.8        1.96            V
   Analog Supply Voltage                   VDDA33                      VSS=0             3.0              3.3         3.6            V
   Ambient Operating Temperature Ta(Industrial)                                          -40               25         +85           °C
   Ambient Operating Temperature Ta(Commercial)                                           0                25         +70           °C
   Junction Temperature                    TJ                                             -                 -        +110           °C
                                                                                    79                                                         APRIL 10, 2006


IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                   INDUSTRIAL TEMPERATURE RANGE
11.3 Terminal Capacitance
TABLE 129 – TERMINAL CAPACITANCE
            Parameter               Symbol        Conditions         Min.        Typ.  Max.      Unit
  Input Capacitance                   CI   Measured at Vin=Vout=VSS     -          -      8       pF
  Load Capacitance                    CO   Ta=25°C                     -           -     20       pF
  Load Capacitance for OCLK           CO                                -          -     30       pF
  [3:0] signals
  Load Capacitance for                CO                                -          -    100       pF
  microprocessor interface
11.4 Thermal Characteristics
TABLE 130 – THERMAL CHARACTERISTICS
                 Parameter                              Symbol       Conditions          Value
  Typical Power Dissipation total                     PT             Ta=25°C              4.0W
  Typical Power Dissipation from 1.8V                 PVDD18         Ta=25°C              2.1W
  Typical Power Dissipation from 3.3V                 PVDD33         Ta=25°C              1.9W
  Thermal Resistance (Junction to case)               ΘJC                              4.5 °C/W
  Thermal Resistance (Junction to board)              ΘJB                              4.1 °C/W
  Thermal Resistance (Ambient)                        ΘJA            Air flow 0.0m/s  15.4 °C/W
                                                                     Air flow 1.0m/s  11.7 °C/W
                                                                     Air flow 2.0m/s  10.2 °C/W
                                                                  80                                          APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                       INDUSTRIAL TEMPERATURE RANGE
11.5 DC Electrical characteristics
TABLE 131 – DC ELECTRICAL CHARACTERISTICS
 Parameter                    Description                         Min.         Typ.         Max.         Unit                Test Conditions
 CMOS I/O
 VIL             Input Low Voltage                                   -0.3          —             0.8           V
 VIH             Input High Voltage                                  2.0           —          VD33+0.3         V
 VOL             Output Low Voltage                                  VSS           —             0.4           V     VD33=min, IOL= max_load (Note 1)
 VOH             Output High Voltage                                  2.4          —            VD33           V     VD33=min, IOH= max_load (Note 1)
 VRESETBH        RESETB Reset Input High Voltage                    1.47           —              —            V
 VRESETBL        RESETB Reset Input Low Voltage                       —            —            0.95           V
 VRESETBHYST RESETB Reset Input Hysteresis Voltage                  0.53           —              —            V
 IILPU           Input Low Current (with pullups)                   -100          -50             -4          µA     VIL=VSS
 IILPU           Input High Current (with pullups)                   -10           0            +10           µA     VIL=VD33
 IIL             Input Low Current (without pullups)                 -10           0            +10           µA     VIL=VSS
 IIH             Input High Current (without pullups)                -10           0            +10           µA     VIH=VD33
 IOZ             Off state output current                            -10           0            +10           µA     VD33=MAX
 LVTTL I/O
 VIL             Input Low Voltage                                   -0.3          —             0.8           V
 VIH             Input High Voltage                                  2.0           —          VD33+0.3         V
 VOL             Output Low Voltage                                  VSS           —             0.4           V     VD33=MIN, IOL= 8mA
 VOH             Output High Voltage                                  2.4          —            VD33           V     VD33=MIN, IOH= -8mA
 IL              Input Current                                        -5           0              +5          µA     VD33=MAX
 IOZ             Off state output current                            -10           0            +10           µA     VD33=MAX
 SPI-4           LVDS I/O
 Input           Characteristics
 VIN             Input Voltage Range, VP or VN                         0           —            2400          mV     |VGPG| < 925 mV
 |VIDTH |        Differential Voltage Required to Toggle Input       100           —              —           mV     |VGPG| < 925 mV
 VHYST           Input Differential Hysteresis, VIDTHH - VIDTHL       25           —              —           mV
 RIN             Input Differential Impedance                         90         100             110         Ohms    P to N input
 Output          Characteristics
 VOL             Output Low Voltage, VP or VN                        925           —              —           mV     RDIFF_TERM =   100
 VOH             Output High Voltage, VP or VN                        —            —            1475          mV     RDIFF_TERM =   100
 VOS             Output Offset Voltage                              1125           —            1375          mV     RDIFF_TERM =   100
 delta VOS       Change in VOS between “0” and “1”                    —            —              25          mV     RDIFF_TERM =   100
 |VOD|           Output Differential Voltage                         250           —            450           mV     RDIFF_TERM =   100
 |delta VOD| Change in |VOD| between “0” and “1”                   50 (DC)         —          150 (AC)        mV     RDIFF_TERM =   100
 Ro              Output Single-ended Impedance                        40         100            140          Ohms
 delta Ro        Ro mismatch between P and N                          —            —              10          %
 ISP, ISN        Output Short Circuit Current                         —            —              40          mA     P or N output shorted to VSS
 ISPN            Output Short Circuit Current                         —            —              12          mA     P and N outputs shorted together
 |IXP|, |IXN|    Power-off output leakage                             —            —              10          µA     VD33 = VSS
NOTE:
1. Maximum load = 8 mA for microprocessor data bus DBUS[7:0]; maximum load= 4 mA for all other CMOS outputs.
                                                                              81                                                         APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                            INDUSTRIAL TEMPERATURE RANGE
11.6 AC characteristics                                                               SPI-3 Input / Output
11.6.1 SPI-3 I/O timing                                                                  SPI-3 input and output timing is shown in the following paragraph.
   Refer to [SPI-3 in Glossary] for logical timing diagrams of the SPI-3 and SPI-
4 interfaces. Note that underclocking and overclocking for the SPI-4 and SPI-
3 interfaces is supported.
      I_F C LK, E_ F C L K
                                                                                        Th
                                                                          T su
      SPI3_ I_ D AT
                                                                                         Td
     SPI3 _E_D AT
                                                                                                                                                     6371 drw05
                                                                 Figure 35. SPI-3 I/O timing diagram
TABLE 132 – SPI-3 AC INPUT / OUTPUT TIMING SPECIFICATIONS
 I_FCLK, E_FCLK               Unit        Min.       Typ.   Max.      Description
 Duty cycle                    %            30        —       70      Input SPI-3 clock duty cycle
 Frequency                   MHz        MCLK/4        —      133      I_FCLK, E_FCLK
 TR, TF                        ns           —         —         2     Rise fall time ( 20%, 80% )
 All outputs
 TD                            ns         2.33        —      5.65     Output delay after E_FCLK
 TR, TF                        ns           —         —         2     Rise fall time ( 20%, 80% )
 All inputs
 TSU                           ns            1        —       —       Input setup before I_FCLK
 TH                            ns         0.65        —       —       Input hold after I_FCLK
                                                                                   82                                                            APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                             INDUSTRIAL TEMPERATURE RANGE
11.6.2 SPI-4 LVDS Input / Output
   SPI-4 input and output timing is shown in the following paragraph. Double
Data Rate protocol is used for data and status transfer. The SPI-4 LVDS signals
use a dynamic data alignment at the ingress.
               S PI4 _ I_ D C L K ,
               S PI4 _ E _ D C L K
                                                                                   Th             Th
                                                                          T su               T su
              S P I4 _ I_ D A T ,
             S P I4 _ E _ S T A T
                                                                                      Td             Td
             S P I4 _ E _ D A T ,
             S P I4 _ I_S T A T
                                                                                                                         6370 drw06
                                                              Figure 36. SPI-4 I/O timing diagram
                                                                                83                                       APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                              INDUSTRIAL TEMPERATURE RANGE
TABLE 133 – SPI-4.2 LVDS AC INPUT / OUTPUT TIMING SPECIFICATIONS
 Inputs                     Unit       Min.    Typ.     Max.      Description
 Duty cycle                  %          45      50       55       I_DCLK ingress clock duty cycle
 Frequency (DDR)            MHz         80       —      200       Ingress clock frequency, I_LOW=1
 Frequency (DDR)            MHz        200      311     400       Ingress clock frequency, I_LOW=0
 TR, TF                      ps        300       —      500       Input rise or fall time ( 20%, 80% )
 Deskew                      UI         —        —      +/- 1     Bit line deskew
 Outputs
 Duty cycle                  %          45      50       55       E_DCLK Egress clock duty cycle
 Frequency (DDR)            MHz         80       —      200       Egress clock frequency, E_LOW=1
 Frequency (DDR)            MHz        200      311     400       Egress clock frequency, E_LOW=0
 TR, TF                      ps        300       —      500       Output rise or fall time ( 20%, 80% )
 Tskew                       ps         —        —       50       Output differential skew, P to N
 SYNTH Jitter                UI         —        —       0.1      PLL jitter as a fraction of the clock cycle
 TD                          ns         —        —       —        Adjustable
11.6.3 SPI-4 LVTTL Status AC characteristics
TABLE 134 – SPI-4 LVTTL STATUS AC CHARACTERISTICS
               Parameter                    Symbol Conditions Min                        Typ         Max         Unit
 SPI-4 LVTTL Status(1)
 STAT_T[1:0] to SCLK_T setup time             T SU                            2                                   ns
 SCLK_T to STAT_T [1:0] hold time              TH                            0.5                                  ns
 SCLK_T to STAT_T [1:0] delay                  TD                                         1           1.2         ns
NOTE:
1. For the SPI-4 LVTTL valid, hold & setup the edge is configurable. The SPI-4 ingress LVTTL status clock active edge is
configured by I_CLK_EDGE field in Table 89-SPI-4 Ingress Configuration Register on page 69. The SPI-4 egress LVTTL
status clock active edge is configured by E_CLK_EDGE field in Table 104-SPI-4 Egress Configuration Register on page 73.
11.6.4 REF_CLK clock input
TABLE 135 – REF_CLK CLOCK INPUT
 REF_CLK            Unit      Min. Typ. Max.
 Duty cycle          %         30        50       70      REF_CLK clock input duty cycle
 FREF_CLK           MHz       12.5 19.44          25      Main reference clock input
 TR, TF              ns         —        —         5      Rise fall time ( 20%, 80% )
11.6.5 MCLK internal clock and OCLK[3:0] clock outputs
TABLE 136 – OCLK[3:0] CLOCK OUTPUTS AND MCLK INTERNAL CLOCK
 OCLK[3:0]              Unit       Min. Typ. Max. Description
 Duty cycle              %          45       50      55       OCLK[3:0] outputs, clock duty cycle
 Frequency              MHz         40      104      133 OCLK[3:0], programmable
 Output skew                                                  One pll_oclk cycle of deliberate
 between OCLKs                                                skew between each OCLK[3:0]
 T R , TF                ns          1                2       OCLK[3:0] rise, fall time (20%,80%)
 MCLK
 Frequency              MHz         80       —       100 Programmable
11.6.6 Microprocessor interface
TABLE 137 – MICROPROCESSOR INTERFACE
 All outputs Unit             Min. Typ. Max. Description
 TR, Tf              ns                           10      Rise, fall time (20%, 80%)
 All inputs
 TR, TF              ns                           10      Rise, fall time (20%,80%)
                                                                                       84                                                 APRIL 10, 2006


IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                      INDUSTRIAL TEMPERATURE RANGE
11.6.6.1 Microprocessor parallel port AC timing
specifications
   Be sure to connect SPI_EN to a logic low when using the parallel µP interface
mode.
Read cycle specification Motorola non-multiplexed (MPM=0)
                                                                   tRC
                                                                                                                 tRecovery
                                                                                              tDW
                          DSB + CSB
                                                                                                       tRWH
                                                                                    tRWV
                                   R/WB
                                                                                                         tADH
                                                                                    tAV
                               ADD[5:0]                                                   Valid Address
                                                                                                                   tDAZ
                                                                              tPRD
                     READ DBUS[7:0]                                                                   Valid Data
                                                                                                                             6370 drw07
                                         Figure 37. Microprocessor parallel port Motorola read timing diagram
TABLE 138 – MICROPROCESSOR PARALLEL PORT MOTOROLA READ TIMING
 Symbol Parameter                                             MIN          MAX       Unit
 T             Internal main clock period (MCLK)               80          100       MHz
 tRC           Read cycle time                              5.5T+25                   ns
 tDW           Valid DSB width                              5.5T+20                   ns
 tRWV          Delay from DSB to valid read signal                        T/2-4       ns
 tRWH          R/WB to DSB hold time                         2T+10                    ns
 tAV           Delay from DSB to Valid Address                            T/2-4       ns
 tADH          Address to DSB hold time                      2T+10                    ns
 tRPD          DSB to valid read data propagation delay                  5.5T+20      ns
 tDAZ          Delay from read data active to high Z                        12        ns
 tRecovery Recovery time from read cycle                         5                    ns
                                                                                 85                                                     APRIL 10, 2006


IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                              INDUSTRIAL TEMPERATURE RANGE
Write cycle specification Motorola non-multiplexed (MPM=0)
                                                                                                                tRecovery
                                                                    tWC
                                                                                   tDW
           DSB + CSB
                                                                                                   tRWH
                                                                       tRWV
                  R/WB
                                                                                            tAH
                                                                             tAV
               ADD[5:0]                                                            Valid Address
                                                                                          tDHW
                                                                        tDV
       Write DBUS[7:0]                                                                       Valid Data
                                                                                                                          6370 drw08
                                     Figure 38. Microprocessor parallel port Motorola write timing diagram
TABLE 139 – MICROPROCESSOR PARALLEL PORT MOTOROLA WRITE TIMING
 Symbol Parameter                                       MIN     MAX         Unit
 T          Internal main clock period (MCLK)            80      100        MHz
 tWC        Write cycle time                          2.5T+17                ns
 tDW        Valid DSB width                           2.5T+12                ns
 tRWV       Delay from DSB to valid write signal                T/2-4        ns
 tRWH       R/WB to DSB hold time                     2.5T+12                ns
 tAV        Delay from DSB to Valid Address                     T/2-4        ns
 tAH        Address to DSB hold time                  2.5T+12                ns
 tDV        Delay from DSB to valid write data                  T/2-4        ns
 tDHW       Write data to DSB hold time               2.5T+12                ns
 tRecovery Recovery time from write cycle                 5                  ns
                                                                      86                                                  APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                              INDUSTRIAL TEMPERATURE RANGE
Read cycle specification Intel non-multiplexed bus (MPM=1)
                                                                       tRC
                                                                                                               tRecovery
                                                                                      tRDW
                CSB + RDB
                                                                                tAV
                    ADD[5:0]                                                           Valid Address
                                                                       tRPD                                      tDAZ
         Read DBUS[7:0]
                                                                                               Valid Data
                                                                                                                         6370 drw09
NOTE:
1. WRB should be tied to High.
                                       Figure 39. Microprocessor parallel port Intel mode read timing diagram
TABLE 140 – MICROPROCESSOR PARALLEL PORT INTEL MODE READ TIMING
 Symbol Parameter                                          MIN     MAX       Unit
 T            Internal main clock period (MCLK)             80     100       MHz
 tRC          Read cycle time                            5.5T+25               ns
 tRDW         Valid RDB width                            5.5T+20               ns
 tAV          Delay from RDB to Valid Address                     T/2-4        ns
 tAH          Address to RDB hold time                   2.5T+12               ns
 tRPD         RDB to valid read data propagation delay           5.5T-20       ns
 tDAZ         Delay from read data active to High-Z                 12         ns
 tRecovery Recovery time from read cycle                     5                 ns
                                                                         87                                                APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                              INDUSTRIAL TEMPERATURE RANGE
Write cycle specification Intel non-multiplexed bus (MPM=1)
                                                                         tWC                                     tRecovery
                                                                                          tWRW
                WRB + CSB
                                                                                                             tAH
                                                                                     tAV
                       ADD[5:0]                                                              Valid Address
                                                                                                           tDHW
                                                                                        tDV
         Write DBUS[7:0]
                                                                                                                           6370 drw10
NOTE:
1. RDB should be tied to a logic one.
                                      Figure 40. Microprocessor parallel port Intel mode write timing diagram
TABLE 141 – MICROPROCESSOR PARALLEL PORT INTEL MODE WRITE TIMING
 Symbol       Parameter                                   MIN     MAX        Unit
 T            Internal main clock period (MCLK)            80     100        MHz
 tWC          Write cycle time                          2.5T+19               ns
 tWRW         Valid WRB width                           2.5T+14               ns
 tAV          Delay from WRB to Valid Address                    T/2-2        ns
 tAH          Address to WRB hold time                  2.5T+12               ns
 tDV          Delay from WRB to valid write data                 T/2-2        ns
 tDHW         Write data to WRB hold time               2.5T+12               ns
 tRecovery    Recovery time from read cycle                 5                 ns
                                                                         88                                                APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                                  INDUSTRIAL TEMPERATURE RANGE
11.6.6.2 Serial microprocessor interface (serial
peripheral interface mode)
Timing Characteristics
   The maximum SPI Data transfer clock frequency is 2 MHz. The detail
information of the timing characteristics is shown in below and timing diagram is
shown in Figure 41, Microprocessor serial peripheral interface timing diagram.
                                                                                                                    tCSH
              CSB
                                              tCSS              tCLH           tCLL                 tCSD              tCLD
            SCLK
                                                  tDIS      tDIH
                SDI                                 Valid Input
                                                                            tPD                                   tDF
                                      High Impedance                                                                    High Impedance
             SDO                                                                       Valid Output
                                                                                                                                 6370 drw11
                                            Figure 41. Microprocessor serial peripheral interface timing diagram
TABLE 142 – MICROPROCESSOR SERIAL PERIPHERAL INTERFACE TIMING
 Symbol                       Description                         Min.     Max.      Unit
 fOP           SCLK Frequency                                               2.0      MHz
 fCSH          Minimum CSB High Time                              100                 ns
 tCSS          CSB Setup Time                                      50                 ns
 tCSD          CSB Hold Time                                      100                 ns
 tCLD          SCLK Clock Disable Time                             50                 ns
 tCLH          SCLK Clock High Time                               205                 ns
 tCLL          SCLK Clock Low Time                                205                 ns
 tDIS          SDI Data Setup Time                                 50                 ns
 tDIH          SDI Data Hold Time                                 150                 ns
 tPD           SDO Output Delay                                             150       ns
 tDF           SDO Output Disable Time                                       50       ns
                                                                                  89                                             APRIL 10, 2006


 IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                         INDUSTRIAL TEMPERATURE RANGE
12. MECHANICAL CHARACTERISTICS
12.1 Device overview
    1  2  3   4  5  6   7 8  9  10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34
 A                                                                                                                        A
 B                                                                                                                        B
 C                                                                                                                        C
 D                                                                                                                        D
 E                                                                                                                        E
 F                                                                                                                        F
 G                                                                                                                        G
 H                                                                                                                        H
 J                                                                                                                        J
 K                                                                                                                        K
 L                                                                                                                        L
M                                                                                                                         M
 N                                                                                                                        N
 P                                                                                                                        P
 R                                                                                                                        R
 T                                                                                                                        T
 U                                                                                                                        U
 V                                                                                                                        V
W                                                                                                                        W
 Y                                                                                                                        Y
AA                                                                                                                      AA
AB                                                                                                                      AB
AC                                                                                                                      AC
AD                                                                                                                      AD
AE                                                                                                                      AE
AF                                                                                                                       AF
AG                                                                                                                      AG
AH                                                                                                                      AH
AJ                                                                                                                       AJ
AK                                                                                                                      AK
AL                                                                                                                       AL
AM                                                                                                                      AM
AN                                                                                                                      AN
AP                                                                                                                      AP
    1  2  3   4  5  6   7 8  9  10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34
                                                                                                                  6370 drw04
         VDD      VDDA33   VDDA18     VD33         SPI3_INGRESS         SPI3_EGRESS
        VSSA18     VSS            SPI4_INGRESS      SPI4_EGRESS          PROCESSOR   TEST, CONFIG, MISC
                                              PBGA (BH820-1, order code: BH)
                                                        TOP VIEW
                                                           90                                           APRIL 10, 2006


IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                INDUSTRIAL TEMPERATURE RANGE
12.2 Pin name/ball location table
 SIGNAL PIN NAME BALL  SIGNAL PIN NAME     BALL SIGNAL PIN NAME BALL SIGNAL PIN NAME BALL
 SPI3B_E_DAT[21]  A4     SPI3B_I_DAT[26]    N5   RESERVED       AC5   RESERVED         AM6
 SPI3B_E_DAT[20]  E5     SPI3B_I_DAT[25]    N3   RESERVED       AC4   RESERVED         AL6
 SPI3B_E_DAT[19]  B4     SPI3B_I_DAT[24]    N2   RESERVED       AD1   RESERVED         AP6
 SPI3B_E_DAT[18]  D4     SPI3B_I_DAT[23]    N1   RESERVED       AD2   RESERVED         AN6
 SPI3B_E_DAT[17]  A3     SPI3B_I_DAT[22]    R5   RESERVED       AD5   RESERVED         AL7
 SPI3B_E_DAT[16]  C4     SPI3B_I_DAT[21]    P5   RESERVED       AD4   RESERVED         AK7
 SPI3B_E_DAT[15]  B3     SPI3B_I_DAT[20]    P4   RESERVED       AD3   RESERVED         AN7
 SPI3B_E_DAT[14]  C2     SPI3B_I_DAT[19]    P2   RESERVED       AE1   RESERVED         AM7
 SPI3B_E_DAT[13]  C1     SPI3B_I_DAT[18]    P1   RESERVED       AE3   RESERVED         AK8
 SPI3B_E_DAT[12]  C3     SPI3B_I_DAT[17]    P3   RESERVED       AE2   RESERVED         AP7
 SPI3B_E_DAT[11]  D3     SPI3B_I_DAT[16]    R4   RESERVED       AE4   RESERVED         AM8
 SPI3B_E_DAT[10]  D1     SPI3B_I_DAT[15]    R3   RESERVED       AF3   RESERVED         AL8
 SPI3B_E_DAT[9]   F5     SPI3B_I_DAT[14]    T5   RESERVED       AE5   RESERVED         AK9
 SPI3B_E_DAT[8]   D2     SPI3B_I_DAT[13]    R2   RESERVED       AF1   RESERVED         AN8
 SPI3B_E_DAT[7]   E3     SPI3B_I_DAT[12]    R1   RESERVED       AF2   RESERVED         AP8
 SPI3B_E_DAT[6]   E1     SPI3B_I_DAT[11]    T4   RESERVED       AF5   RESERVED         AL9
 SPI3B_E_DAT[5]   F4     SPI3B_I_DAT[10]    U5   RESERVED       AF4   RESERVED        AK10
 SPI3B_E_DAT[4]   E2     SPI3B_I_DAT[9]     T3   RESERVED       AG2   RESERVED         AM9
 SPI3B_E_DAT[3]   F3     SPI3B_I_DAT[8]     T2   RESERVED       AG1   RESERVED         AN9
 SPI3B_E_DAT[2]   F2     SPI3B_I_DAT[7]     T1   RESERVED       AG4   RESERVED         AP9
 SPI3B_E_DAT[1]   G4     SPI3B_I_DAT[6]     U3   RESERVED       AG3   RESERVED        AL10
 SPI3B_E_DAT[0]   F1     SPI3B_I_DAT[5]     U4   RESERVED       AH1   RESERVED        AM10
 SPI3B_E_FCLK     G5     SPI3B_I_DAT[4]     U2   RESERVED       AH2   RESERVED        AN10
 SPI3B_PTPA       G3     SPI3B_I_DAT[3]     U1   RESERVED       AH3   RESERVED        AP10
 SPI3B_TADR[7]    H5     SPI3B_I_DAT[2]     V5   RESERVED       AG5   RESERVED        AK12
 SPI3B_TADR[6]    G2     SPI3B_I_DAT[1]     V1   RESERVED       AH4   RESERVED        AK11
 SPI3B_TADR[5]    G1     SPI3B_I_DAT[0]     V2   RESERVED       AJ1   RESERVED        AL11
 SPI3B_TADR[4]    H4     RESERVED           V4   RESERVED       AJ4   RESERVED        AN11
 SPI3B_TADR[3]    H2     RESERVED           W3   RESERVED       AJ2   RESERVED        AP11
 SPI3B_TADR[2]    H3     RESERVED           W1   RESERVED       AJ3   RESERVED        AM11
 SPI3B_TADR[1]    H1     RESERVED           V3   RESERVED       AK1   RESERVED        AL12
 SPI3B_TADR[0]    J5     RESERVED           W2   RESERVED       AK2   RESERVED        AM12
 SPI3B_STPA       J4     RESERVED           W5   RESERVED       AH5   RESERVED        AK13
 SPI3B_DTPA[3]    J3     RESERVED           W4   RESERVED       AK4   RESERVED        AN12
 SPI3B_DTPA[2]    J2     RESERVED           Y1   RESERVED       AL1   RESERVED        AP12
 SPI3B_DTPA[1]    J1     RESERVED           Y2   RESERVED       AL2   RESERVED        AL13
 SPI3B_DTPA[0]    K5     RESERVED           Y5   RESERVED       AK3   RESERVED        AM13
 SPI3B_I_ENB      K4     RESERVED           Y3   RESERVED       AM1   RESERVED        AN13
 SPI3B_I_SX       K3     RESERVED           Y4   RESERVED       AM2   RESERVED        AP13
 SPI3B_RVAL       K2     RESERVED           AA1  RESERVED       AM3   RESERVED        AN14
 SPI3B_I_ERR      K1     RESERVED           AA5  RESERVED       AL3   RESERVED        AK14
 SPI3B_I_FCLK     L5     RESERVED           AA2  RESERVED       AP3   RESERVED        AL14
 SPI3B_I_SOP      L4     RESERVED           AA3  RESERVED       AL4   RESERVED        AM14
 SPI3B_I_PRTY     L3     RESERVED           AA4  RESERVED       AM4   RESERVED        AP14
 SPI3B_I_MOD[1]   M5     RESERVED           AB4  RESERVED       AN4   RESERVED        AM15
 SPI3B_I_MOD[0]   L2     RESERVED           AB1  RESERVED       AP4   RESERVED        AL15
 SPI3B_I_EOP      L1     RESERVED           AB2  RESERVED       AK5   RESERVED        AN15
 SPI3B_I_DAT[31]  M4     RESERVED          AC2   RESERVED       AL5   RESERVED        AP15
 SPI3B_I_DAT[30]  M3     RESERVED           AB5  RESERVED       AN5   RESERVED        AK15
 SPI3B_I_DAT[29]  M2     RESERVED           AB3  RESERVED       AM5   RESERVED        AL16
 SPI3B_I_DAT[28]  M1     RESERVED          AC1   RESERVED       AK6   RESERVED        AK16
 SPI3B_I_DAT[27]  N4     RESERVED          AC3   RESERVED       AP5   RESERVED        AM16
                                                    91                                     APRIL 10, 2006


IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                   INDUSTRIAL TEMPERATURE RANGE
12.2. Pin name/ball location table (continued)
 SIGNAL PIN NAME BALL  SIGNAL PIN NAME      BALL SIGNAL PIN NAME   BALL SIGNAL PIN NAME    BALL
  RESERVED        AK17    RESERVED         AL26  SPI4_E_DAT_N[12] AC31   SPI4_I_DAT_N[4]  K31
  RESERVED        AN16    RESERVED]        AM27  SPI4_E_DAT_P[11] AC34   SPI4_I_DAT_P[3]  K30
  RESERVED        AP16    RESERVED         AN27  SPI4_E_DAT_N[11] AC33   SPI4_I_DAT_N[3]  J30
  RESERVED        AL17    RESERVED         AK27  SPI4_E_DAT_P[10] AB31   SPI4_I_DAT_P[2]  J32
  RESERVED        AK18    RESERVED         AL27  SPI4_E_DAT_N[10] AB30   SPI4_I_DAT_N[2]  J33
  RESERVED        AM17    RESERVED         AN28  SPI4_E_DAT_P[9]  AB34   SPI4_I_DAT_P[1]  J34
  RESERVED        AN17    RESERVED         AP28  SPI4_E_DAT_N[9]  AB33   SPI4_I_DAT_N[1]  H34
  RESERVED        AP17    RESERVED         AL28  SPI4_E_DAT_P[8]  AA31   SPI4_I_DAT_P[0]  H32
  RESERVED        AK20    RESERVED         AM28  SPI4_E_DAT_N[8]  AA30   SPI4_I_DAT_N[0]  H33
  RESERVED        AL18    RESERVED         AP29  SPI4_E_DAT_P[7]  AA34   SPI4_I_CTRL_P    H30
  RESERVED        AM18    RESERVED         AK28  SPI4_E_DAT_N[7]  AA33   SPI4_I_CTRL_N    H31
  RESERVED        AP18    RESERVED         AM29  SPI4_E_DAT_P[6]   Y32   SPI4_E_SCLK_P    G31
  RESERVED        AK19    RESERVED         AN29  SPI4_E_DAT_N[6]   Y31   SPI4_E_SCLK_N    G32
  RESERVED        AP19    REF_CLK          AP30  SPI4_E_DAT_P[5]   Y34   SPI4_E_STAT_P[1] F33
  RESERVED        AN18    TCK              AL29  SPI4_E_DAT_N[5]   Y33   SPI4_E_STAT_N[1] F34
  RESERVED        AN19    LVDS_STA         AN30  SPI4_E_DAT_P[4]  W31    SPI4_E_STAT_P[0] F32
  RESERVED        AK22    TDI              AM30  SPI4_E_DAT_N[4]  W30    SPI4_E_STAT_N[0] E32
  RESERVED        AL19    TDO              AP32  SPI4_E_DAT_P[3]  W34    SPI4_E_STAT_T[1] L30
  RESERVED        AP20    TMS              AN32  SPI4_E_DAT_N[3]  W33    SPI4_E_STAT_T[0] M30
  RESERVED        AM20    GPIO[4]          AM31  SPI4_E_DAT_P[2]   V31   SPI4_E_SCLK_T    E31
  RESERVED        AM19    GPIO[3]          AM33  SPI4_E_DAT_N[2]   V30   SPI_EN           E29
  RESERVED        AL20    GPIO[2]          AM34  SPI4_E_DAT_P[1]   V34   DBUS[7]          E30
  RESERVED        AN20    CLK_SEL[3]       AL31  SPI4_E_DAT_N[1]   V33   ADD[5]           D33
  RESERVED        AP21    GPIO[1]          AL30  SPI4_E_DAT_P[0]  U32    DBUS[6]          D34
  RESERVED        AK21    CLK_SEL[2]       AK29  SPI4_E_DAT_N[0]  U31    ADD[4]           D31
  RESERVED        AN21    GPIO[0]          AL32  SPI4_E_CTRL_P    U34    DBUS[5]          D32
  RESERVED        AM21    CLK_SEL[1]       AK30  SPI4_E_CTRL_N    U33    ADD[3]           C34
  RESERVED        AL21    OCLK[3]          AK31  SPI4_I_DCLK_P     T34   DBUS[4]          D30
  RESERVED        AP22    CLK_SEL[0]       AH31  SPI4_I_DCLK_N     T33   WRB              C33
  RESERVED        AN22    OCLK[2]          AJ30  SPI4_I_DAT_P[15]  T31   DBUS[3]          C32
  RESERVED        AM22    TIMEBASE         AH34  SPI4_I_DAT_N[15]  T30   CSB              B32
  RESERVED        AL22    OCLK[1]          AH32  SPI4_I_DAT_P[14] R34    DBUS[2]          C31
  RESERVED        AK23    OCLK[0]          AH33  SPI4_I_DAT_N[14] R33    DBUS[1]          A32
  RESERVED        AP23    SPI4_I_STAT_T[1] AH30  SPI4_I_DAT_P[13] R31    RESETB           C30
  RESERVED        AN23    SPI4_I_STAT_T[0] AG32  SPI4_I_DAT_N[13] R30    INTB             A31
  RESERVED        AL23    SPI4_I_SCLK_T    AG33  SPI4_I_DAT_P[12]  P34   DBUS[0]          A30
  RESERVED        AM23    BIAS             AJ31  SPI4_I_DAT_N[12]  P33   ADD[2]           B30
  RESERVED        AP24    SPI4_I_STAT_P[1] AG31  SPI4_I_DAT_P[11]  P32   RDB              E28
  RESERVED        AM24    SPI4_I_STAT_P[0] AF31  SPI4_I_DAT_N[11]  P31   ADD[1]           D29
  RESERVED        AN24    SPI4_I_STAT_N[1] AG30  SPI4_I_DAT_P[10] N34    TRSTB            D28
  RESERVED        AK24    SPI4_I_STAT_N[0] AF30  SPI4_I_DAT_N[10] N33    ADD[0]           B28
  RESERVED        AL24    SPI4_I_SCLK_P    AF33  SPI4_I_DAT_P[9]  N31    MPM              C28
  RESERVED        AP25    SPI4_I_SCLK_N    AF32  SPI4_I_DAT_N[9]  N30    SPI3A_E_SOP      A28
  RESERVED        AN25    SPI4_E_DCLK_P    AE34  SPI4_I_DAT_P[8]  M34    SPI3A_E_ERR      E27
  RESERVED        AK25    SPI4_E_DCLK_N    AE33  SPI4_I_DAT_N[8]  M33    SPI3A_E_MOD[1]   C27
  RESERVED        AL25    SPI4_E_DAT_P[15] AE30  SPI4_I_DAT_P[7]  M32    SPI3A_E_MOD[0]   D27
  RESERVED        AM25    SPI4_E_DAT_N[15] AE31  SPI4_I_DAT_N[7]  M31    SPI3A_E_EOP      B27
  RESERVED        AP26    SPI4_E_DAT_P[14] AD31  SPI4_I_DAT_P[6]   L34   SPI3A_E_ENB      A27
  RESERVED        AN26    SPI4_E_DAT_N[14] AD30  SPI4_I_DAT_N[6]   L33   SPI3A_E_SX       D26
  RESERVED        AP27    SPI4_E_DAT_P13]  AD34  SPI4_I_DAT_P[5]   K33   SPI3A_E_PRTY     E26
  RESERVED        AM26    SPI4_E_DAT_N[13] AD33  SPI4_I_DAT_N[5]   K34   SPI3A_E_DAT[31]  C26
  RESERVED        AK26    SPI4_E_DAT_P[12] AC32  SPI4_I_DAT_P[4]   L31   SPI3A_E_DAT[30]  B26
                                                     92                                       APRIL 10, 2006


IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                          INDUSTRIAL TEMPERATURE RANGE
12.2 Pin name/ball location table (continued)
 SIGNAL PIN NAME BALL       SIGNAL PIN NAME           BALL     SIGNAL PIN NAME       BALL SIGNAL PIN NAME BALL
  SPI3A_E_DAT[29]   A26        SPI3A_E_DAT[2]         C20       SPI3A_I_EOP           D15      SPI3A_I_DAT[5]          A9
  SPI3A_E_DAT[28]   E25        SPI3A_E_DAT[1]         B20       SPI3A_I_DAT[31]       E15      SPI3A_I_DAT[4]          B9
  SPI3A_E_DAT[27]   D25        SPI3A_E_DAT[0]         D20       SPI3A_I_DAT[30]       A14      SPI3A_I_DAT[3]         D9
  SPI3A_E_DAT[26]   C25        SPI3A_E_FCLK           A20       SPI3A_I_DAT[29]       E14      SPI3A_I_DAT[2]          E9
  SPI3A_E_DAT[25]   A25        SPI3A_PTPA             C19       SPI3A_I_DAT[28]       B14      SPI3A_I_DAT[1]         C9
  SPI3A_E_DAT[24]   B25        SPI3A_TADR[7]          B19       SPI3A_I_DAT[27]       C14      SPI3A_I_DAT[0]          A8
  SPI3A_E_DAT[23]   C24        SPI3A_TADR[6]          D19       SPI3A_I_DAT[26]       D14      SPI3B_E_SOP            C8
  SPI3A_E_DAT[22]   D24        SPI3A_TADR[5]          A19       SPI3A_I_DAT[25]       E13      SPI3B_E_ERR            D8
  SPI3A_E_DAT[21]   D23        SPI3A_TADR[4]          A18       SPI3A_I_DAT[24]       A13      SPI3B_E_MOD[1]          B8
  SPI3A_E_DAT[20]   E23        SPI3A_TADR[3]          B18       SPI3A_I_DAT[23]       B13      SPI3B_E_MOD[0]          E8
  SPI3A_E_DAT[19]   B24        SPI3A_TADR[2]          E19       SPI3A_I_DAT[22]       C13      SPI3B_E_EOP             B7
  SPI3A_E_DAT[18]   A24        SPI3A_TADR[1]          C18       SPI3A_I_DAT[21]       E12      SPI3B_E_ENB            C7
  SPI3A_E_DAT[17]   C23        SPI3A_TADR[0]          D18       SPI3A_I_DAT[20]       D13      SPI3B_E_SX              A7
  SPI3A_E_DAT[16]   E24        SPI3A_STPA             A17       SPI3A_I_DAT[19]       A12      SPI3B_E_PRTY            A6
  SPI3A_E_DAT[15]   B23        SPI3A_DTPA[3]          E18       SPI3A_I_DAT[18]       B12      SPI3B_E_DAT[31]        D7
  SPI3A_E_DAT[14]   A23        SPI3A_DTPA[2]          B17       SPI3A_I_DAT[17]       E11      SPI3B_E_DAT[30]         B6
  SPI3A_E_DAT[13]   D22        SPI3A_DTPA[1]          C17       SPI3A_I_DAT[16]       D12      SPI3B_E_DAT[29]         E7
  SPI3A_E_DAT[12]   E22        SPI3A_DTPA[0]          D17       SPI3A_I_DAT[15]       C12      SPI3B_E_DAT[28]         E6
  SPI3A_E_DAT[11]   C22        SPI3A_I_ENB            E17       SPI3A_I_DAT[14]       A11      SPI3B_E_DAT[27]        C6
  SPI3A_E_DAT[10]   B22        SPI3A_I_SX             A16       SPI3A_I_DAT[13]       C11      SPI3B_E_DAT[26]         A5
  SPI3A_E_DAT[9]    A22        SPI3A_RVAL             B16       SPI3A_I_DAT[12]       D11      SPI3B_E_DAT[25]        D6
  SPI3A_E_DAT[8]    E21        SPI3A_I_ERR            C16       SPI3A_I_DAT[11]       B11      SPI3B_E_DAT[24]         B5
  SPI3A_E_DAT[7]    D21        SPI3A_I_FCLK           D16       SPI3A_I_DAT[10]       A10      SPI3B_E_DAT[23]        D5
  SPI3A_E_DAT[6]    C21        SPI3A_I_SOP            B15       SPI3A_I_DAT[9]        B10      SPI3B_E_DAT[22]        C5
  SPI3A_E_DAT[5]    B21        SPI3A_I_PRTY           A15       SPI3A_I_DAT[8]        C10
  SPI3A_E_DAT[4]    E20        SPI3A_I_MOD[1]         C15       SPI3A_I_DAT[7]        E10
  SPI3A_E_DAT[3]    A21        SPI3A_I_MOD[0]         E16       SPI3A_I_DAT[6]        D10
 POWER PIN NAME                                                     BALL(S)
 VDDA18_CLKGEN      AF28
 VSSA18_CLKGEN      AA20
 VDDA18_ISTX        AD28
 VSSA18_ISTX        Y21
 VDDA18_EDTX        AE28
 VSSA18_EDTX        AA21
 VDDA18_IDRX        P28
 VSSA18_IDRX        R21
 VDDA18_ESRX        L28
 VSSA18_ESRX        P21
 VSS (GND)          A29, B29, C29, E4, F6, F7, F17, F18, F28, F29, F31, G6, G7, G17, G18, G28, G29, G33, G34, J31, L32, N32, P14 - P20,
                    R14- R20, T14 - T21, T32, U6, U7, U14 - U21, U28, U29, V6, V7, V14 - V21, V28, V29, V32, W14 - W21, Y14 - Y20, Y30,
                    AA14 - AA19, AA32, AC30, AD32, AF34, AG34, AH6, AH7, AH17, AH18, AH28, AH29, AJ5 - AJ7, AJ17, AJ18, AJ28, AJ29,
                    AJ32 - AJ34, AK32, AK33, AN3, AP31, AN31, B31, AM32
 VDD18 (1.8 VOLTS) A1, A2, A33, A34, B1, B2, B33, B34, E33, E34, F8, F9, F12, F13, F15, F16, F19, F20, F22, F23, F26, F27, F30, G8, G9, G12,
                    G13, G15, G16, G19, G20, G22, G23, G26, G27, G30, H6, H7, H28, H29, J6, J7, J28, J29, K32, M6, M7, M28, M29, N6, N7,
                    N28, N29, R6, R7, R28, R29, R32, T6, T7, T28, T29, W6, W7, W28, W29, W32, Y6, Y7, Y28, Y29, AB6, AB7, AB28, AB29, AB32,
                    AC6, AC7, AC28, AC29, AE32, AF6, AF7, AH25, AF29, AG6, AG7, AG28, AG29, AH8, AH9, AH12, AH13, AH15, AH16, AH19,
                    AH20, AH22, AH23, AH26, AH27, AJ8, AJ9, AJ12, AJ13, AJ15, AJ16, AJ19, AJ20, AJ22, AJ23, AJ26, AJ27, AK34, AL33, AL34,
                    AN1, AN2, AN33, AN34, AP1, AP2, AP33, AP34
 VD33 (3.3 VOLTS) F10, F11, F14, F21, G10, G11, G14, G21, K6, K7, L6, L7, P6, P7, AA6, AA7, AD6, AD7, AE6, AE7, AH10, AH11, AH14, AH21,
                    AJ10, AJ11, AJ14, AJ21
 VDDA33 (3.3 VOLTS) F24, F25, G24, G25, K28, K29, L29, P29, P30, U30, AA28, AA29, AD29, AE29, AJ24, AH24, AJ25
                                                                    93                                                      APRIL 10, 2006


IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                          INDUSTRIAL TEMPERATURE RANGE
12.3 Device package
  The SPI Exchange IDT88P8342 device is packaged in a 35 mm by 35 mm
820-ball one millimeter ball pitch thermally-enhanced plastic ball grid array. All
balls, whether used or unused, must be soldered to pads.
                                                 Figure 42. IDT88P8342 820PBGA package, bottom view
                                                                                   94                                APRIL 10, 2006


IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                              INDUSTRIAL TEMPERATURE RANGE
                               Figure 43. IDT88P8342 820PBGA package, top and side views
                                                          95                                             APRIL 10, 2006


IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                               INDUSTRIAL TEMPERATURE RANGE
13. GLOSSARY
  ACRONYM                                                      MEANING
   FIFO       First In First Out memory
   LID        Logical IDentifier See also Logical Port (LP)
              The entity associated with a flow of data between a SPI-3 LP to a SPI-4 LP, or a SPI-4 LP to a SPI-3 LP.
   LP         Logical Port. See also Logical Identifier (LID)
              The entity associated with a SPI-3 or SPI-4 address.
   OIF        Optical Internetworking Forum
   SPI-3      System Packet Interface Level 3
              This interface is defined by the OIF implementation agreement OIF-SPI3-01.0 - SPI-3 Packet Interface for
              Physical and Link Layers for OC-48 available at http://www.oiforum.com/public/impagreements.html
   SPI-4      System Packet Interface Level 4 phase 2
              This interface is defined by the OIF implementation agreement OIF-SPI4-02.1 - System Packet Interface
              Level 4 (SPI-4) Phase 2: OC-192 System Interface for Physical and Link Layer Devices available
              at http://www.oiforum.com/public/impagreements.html
                                                                        96                                                APRIL 10, 2006


IDT88P8342 SPI EXCHANGE 2 x SPI-3 TO SPI-4                                                              INDUSTRIAL TEMPERATURE RANGE
14. DATASHEET DOCUMENT REVISION HISTORY
 ISSUE    DATE                                                 DESCRIPTION
   0.7  05/21/04  • General Release
   0.8  10/01/04  • AG30 ball location changed to SPI4_I_STAT_N[1] and AF31 ball location changed to
                   SPI4_I_STAT_P[0] on Pin name/ball location table (section 12.2) on page 88.
   0.9  03/01/05  • Updated Chip Configuration Sequence (p. 41)
                  • Update Table 21: “BIT Order Whitin a 16-BIT Address Register” (p. 45)
                  • Update Table 27: “Indirect Access Address Register” (p. 46)
                  • Updated Direct Access Registers (p. 48-49)
                  • Updated Common Module Indirect Registers (p. 66)
                  • Updated Electrical and Thermal Specification (p. 77) (the section name changed from Electrical
                    Characteristics to Electrical and Thermal Specification). Updated JTAG Instructions.
                  • Added Document Revision History (p. 95)
  0.91  05/09/05  • Added sections System Reset and Power on Sequence (p.41).
                  • Updated PFR to PFP in Table 49: "Module A/B indirect register" (p.55)
                  • Updated Table 80: "SPI-4 ingress packet length configuration" (p.65)
                  • Updated length for Reserved in Table 83: "SPI-4 ingress port descriptor" (p.65)
                  • Added Green to Ordering information (p.96)
  0.92  08/05/05  • Updated Table 128: "Absolute maximum ratings" (p.78)
  0.93  10/20/05  • Updated Table 7: "Parallel microprocessor interface" (p.12)
                  • Updated Table 131: "Thermal Characteristics" (p.79)
                  • Updated Microprocessor parallel port section (p.84-87)
  0.94  11/21/05  • Updated Table 126: "Version number register (register_offset 0x30)" (p.77)
  0.95  01/09/06  • Updated Figure 4: "PHY mode SPI-3 ingress interface" (p.14)
                  • Deleted Table 13: "NR_LID Field Encoding". Updated SPI-4 egress queues, Normal operation
                    section (p.26)
                  • Updated Section 8.2.5 "SPI-4 status channel software" (p.43)
                  • Updated Table 127: "Absolute maximum ratings" (p.78)
                  • Updated Table 129: "Terminal Capacitance" (p.79)
   1.0  04/10/06  • Initial Release of Final Datasheet with new section 8.2.7 "Software Eye-Opening Check on SPI-4"
                  & new Figure 33. "DDR interface and eye opening check through over sampling" (p.44-45)
                  • Updated Clock generator (pg. 39)
                  • Updated SPI-4 ingress watermark register (pg. 71)
                  • Updated Clock generator control register (pg. 77)
                  • Updated Table 130: Thermal Characteristics (pg. 80)
                  • Updated Table 132: SPI-3 AC Input/Output timing specifications (pg. 82)
                  • Updated Table 136: OCLK[3:0] outputs and MCLK internal clock (pg. 84)
                                                                      97                                                 APRIL 10, 2006


15. ORDERING INFORMATION
IDT           X                  X              X                X
       Device Type            Package                        Process /
                                                            Temperature
                                                              Range
                                                                           I            Industrial (-40C to +85C)
                                                                           G            Green
                                                                           BH           Plastic Ball Grid Array (PBGA, BH820-1)
                                                                          88P8342       SPI Exchange SPI-3 to SPI-4
                                                                                                                         6371 drwlast
NOTE:
1. Green parts are available.
                               CORPORATE HEADQUARTERS              for SALES:                                         for Tech Support:
                               6024 Silver Creek Valley Road       800-345-7015 or 408-284-8200                             408-360-1716
                               San Jose, CA 95138                  fax: 408-284-2775                                   email: SPI@idt.com
                                                                   www.idt.com
                                                                       98


Mouser Electronics
Authorized Distributor
Click to View Pricing, Inventory, Delivery & Lifecycle Information:
Renesas Electronics:
 88P8342BHGI
