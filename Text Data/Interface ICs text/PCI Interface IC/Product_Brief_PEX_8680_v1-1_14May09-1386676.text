                                              PEX 8680, PCI Express Gen 2 Switch, 80 Lanes, 20 Ports
Features                                          The ExpressLaneTM PEX 8680 device offers Multi-Host PCI Express
  PEX 8680 General Features                      switching capability enabling users to connect multiple hosts to their
  o 80-lane, 20-port PCIe Gen2 switch             respective endpoints via scalable, high bandwidth, non-blocking
    - Integrated 5.0 GT/s SerDes
  o 35 x 35mm2, 1156-ball FCBGA package           interconnection to a wide variety of applications including servers,
  o Typical Power: 9.0 Watts                      storage systems, and communications platforms. The PEX 8680 is
                                                  well suited for fan-out, aggregation, and peer-to-peer applications.
  PEX 8680 Key Features
  o Standards Compliant                           Multi-Host Architecture
    - PCI Express Base Specification, r2.0
                                                  The PEX 8680 employs an enhanced version of PLX’s field tested PEX 8648
      (backwards compatible w/ PCIe r1.0a/1.1)
    - PCI Power Management Spec, r1.2             PCIe switch architecture, which allows users to configure the device in
    - Microsoft Vista Compliant                   legacy single-host mode or multi-host mode with up to six host ports capable
    - Supports Access Control Services            of 1+1 (one active & one backup) or N+1 (N active & one backup) host
    - Dynamic link-width control                  failover. This powerful architectural enhancement enables users to build
    - Dynamic SerDes speed control
  o High Performance
                                                  PCIe based systems to support high-availability, failover, redundant and
    ♦ performancePAK                              clustered systems.
      9 Read Pacing (bandwidth throttling)
      9 Multicast                                 High Performance & Low Packet Latency
      9 Dynamic Buffer/FC Credit Pool             The PEX 8680 architecture supports packet cut-thru with a maximum
    - Non-blocking switch fabric
    - Full line rate on all ports                 latency of 176ns (x16 to x16). This, combined with large packet memory,
    - Packet Cut-Thru with 176ns max packet       flexible common buffer/FC credit pool and non-blocking internal switch
      latency (x16 to x16)                        architecture, provides full line rate on all ports for performance-hungry
    - 2KB Max Payload Size                        applications such as servers and switch fabrics. The low latency enables
  o Flexible Configuration
    - Ports configurable as x1, x2, x4, x8, x16
                                                  applications to achieve high throughput and performance. In addition to low
    - Registers configurable with strapping       latency, the device supports a packet payload size of up to 2048 bytes,
      pins, EEPROM, I2C, or host software         enabling the user to achieve even higher throughput.
    - Lane and polarity reversal
    - Compatible with PCIe 1.0a PM                Data Integrity
  o Multi-Host & Fail-Over Support
    - Configurable Non-Transparent (NT) port      The PEX 8680 provides end-to-end CRC (ECRC) protection and Poison bit
    - Failover with NT port                       support to enable designs that require end-to-end data integrity. PLX also
    - Up to Six upstream/Host ports with 1+1      supports data path parity and memory (RAM) error correction circuitry
      or N+1 failover to other upstream ports     throughout the internal data paths as packets pass through the switch.
  o Quality of Service (QoS)
    - Eight traffic classes per port
    - Weighted round-robin source                 Flexible Configuration
      port arbitration                            The PEX 8680’s 20 ports can be configured to lane widths of x1, x2, x4, x8,
  o Reliability, Availability, Serviceability     or x16. Flexible buffer
    ♦ visionPAK                                   allocation, along with the                    x4                       x8
      9 Per Port Performance Monitoring           device's flexible packet
          Per port payload & header counters
      9 SerDes Eye Capture                        flow control, maximizes
                                                  throughput for applications             PEX 8680                PEX 8680
      9 Error Injection and Loopback
    - 4 Hot Plug Ports with native HP Signals     where more traffic flows in
    - All ports hot plug capable thru I2C         the downstream, rather than
      (Hot Plug Controller on every port)                                                  19 x4                6 x8 6 x4
    - ECRC and Poison bit support
                                                  upstream, direction. Any
    - Data Path parity                            port can be designated as the
                                                                                                x8                       x16
    - Memory (RAM) Error Correction               upstream port, which can be
    - INTA# and FATAL_ERR# signals                changed dynamically.
    - Advanced Error Reporting
                                                  Figure 1 shows some of the
    - Port Status bits and GPIO available                                                 PEX 8680                PEX 8680
    - Per port error diagnostics                  PEX 8680’s common port
    - JTAG AC/DC boundary scan                    configurations in legacy
                                                  Single-Host mode.
                                                                                       4 x8 10 x4                    8 x8
                                                                                     Figure 1. Common Port Configurations
© PLX Technology, www.plxtech.com                              Page 1 of 1                                       5/14/2009, Version 1.1


                                                PEX 8680, PCI Express Gen 2 Switch, 80 Lanes, 20 Ports
The PEX 8680 can also be configured in Multi-Host                                      Multi-Host & Failover Support
mode where users can choose up to six ports as                                         In Multi-Host mode, PEX 8680 can be configured with
host/upstream ports and assign a desired number of                                     up to six upstream host ports, each with its own
downstream ports to each host. In Multi-Host mode, a                                   dedicated downstream ports. The device can be
virtual switch is created for each host port and its                                   configured for 1+1 redundancy or N+1 redundancy. The
associated downstream ports inside the device. The                                     PEX 8680 allows the hosts to communicate their status
traffic between the ports of a virtual switch is completely                            to each other via special door-bell registers. In failover
isolated from the traffic in other virtual switches. Figure                            mode, if a host fails, the host designated for failover will
2 illustrates some configurations of the PEX 8680 in                                   disable the upstream port attached to the failing host and
Multi-Host mode where each ellipse represents a virtual                                program the downstream ports of that host to its own
switch inside the device.                                                              domain. Figure 4a shows a two host system in Multi-
                                                                                       Host mode with two virtual switches inside the device
The PEX 8680              x8     x8                x8 x8 x8                            and Figure 4b shows Host 1 disabled after failure and
also provides                                                                          Host 2 having taken over all of Host 1’s end-points.
several ways to
                                                                                            Host 1       Host 2            Host 1       Host 2
configure its
                          PEX 8680                  PEX 8680
registers. The                                                                                 PEX 8680                       PEX 8680
device can be
configured          2 x8, 4 x4 2 x8, 4x4        4 x4 4 x4 4 x4
through                     4 x4s                    6 x4s
                                                                                         End
                                                                                        Point
                                                                                                End
                                                                                                Point
                                                                                                       End
                                                                                                      Point
                                                                                                               End
                                                                                                              Point
                                                                                                                        End
                                                                                                                       Point
                                                                                                                               End
                                                                                                                               Point
                                                                                                                                      End
                                                                                                                                      Point
                                                                                                                                              End
                                                                                                                                             Point
strapping pins,                                                                           Figure 4a. Multi-Host     Figure 4b. Multi-Host Fail-Over
I2C interface,
host software,                                                            or           Hot Plug for High Availability
                          PEX 8680                  PEX 8680
an optional                                                                            Hot plug capability allows users to replace hardware
serial                                                                                 modules and perform maintenance without powering
EEPROM.                     16 x4s                    12 x4s                           down the system. The PEX 8680 hot plug capability
This allows        Figure 2. Common Multi-Host Configurations                          feature makes it suitable for High Availability (HA)
for easy debug during the development phase,                                           applications. Four downstream ports include a Standard
performance monitoring during the operation phase, and                                 Hot Plug Controller. If the PEX 8680 is used in an
driver or software upgrade.                                                            application where one or more of its downstream ports
                                                                                       connect to PCI Express slots, each port’s Hot Plug
Dual-Host & Failover Support                                                           Controller can be used to manage the hot-plug event of
In Single-Host mode, the PEX 8680 supports a Non-                                      its associated slot. Every port on the PEX 8680 is
Transparent (NT) Port, which enables the                                               equipped with a hot-plug control/status register to
implementation of dual-host systems for redundancy                                     support hot-plug capability through external logic via the
and host failover capability.         Primary
                                      Primary Host
                                              Host       Secondary
                                                         Secondary Host
                                                                   Host
                                                                                       I2C interface.
The NT port allows systems               CPU                 CPU
to isolate host memory                                                                 SerDes Power and Signal Management
domains by presenting the                Root                                          The PEX 8680 supports software control of the SerDes
processor subsystem as an             Complex                                          outputs to allow optimization of power and signal
endpoint rather than                                                                   strength in a system. The PLX SerDes implementation
another memory system.                          NT                      Base           supports four levels of power – off, low, typical, and
address registers are used            PEX 8680             Non-Transparent             high. The SerDes block also supports loop-back modes
                                                                  Port
to translate addresses;                                                                and advanced reporting of error conditions, which
doorbell registers are         End       End          End                              enables efficient management of the entire system.
                              Point      Point        Point
used to send
interrupts between the Figure 3. Non-Transparent Port                                  Interoperability
address domains; and scratchpad registers (accessible by                               The PEX 8680 is designed to be fully compliant with the
both CPUs) allow inter-processor communication (see                                    PCI Express Base Specification r2.0, and is backwards
Figure 3).                                                                             compatible to PCI Express Base Specification r1.1 and
© PLX Technology, www.plxtech.com                                            Page 2 of 2                                              5/14/2009, Version 1.1


                                       PEX 8680, PCI Express Gen 2 Switch, 80 Lanes, 20 Ports
r1.0a. Additionally, it supports auto-negotiation, lane              visionPAKTM
reversal, and polarity reversal. Furthermore, the PEX                Another PLX exclusive, visionPAK is a debug
8680 is tested for Microsoft Vista compliance. All PLX               diagnostics suite of integrated hardware and software
switches undergo thorough interoperability testing in                instruments that users can use to help bring their systems
PLX’s Interoperability Lab and compliance testing at                 to market faster. visionPAK features consist of
the PCI-SIG plug-fest.                                               Performance Monitoring, SerDes Eye Capture, Error
                                                                     Injection, SerDes Loopback, and more.
performancePAKTM
Exclusive to PLX, performancePAK is a suite of unique                Performance Monitoring
and innovative performance features which allows                     The PEX 8680’s real time performance monitoring
PLX’s Gen 2 switches to be the highest performing Gen                allows users to literally “see” ingress and egress
2 switches in the market today. The performancePAK                   performance on each port as traffic passes through the
features consists of the Read Pacing, Multicast, and                 switch using PLX’s Software Development Kit (SDK).
Dynamic Buffer Pool.                                                 The monitoring is completely passive and therefore has
                                                                     no affect on overall system performance. Internal
Read Pacing                                                          counters provide extensive granularity down to traffic &
The Read Pacing feature allows users to throttle the                 packet type and even allows for the filtering of traffic
amount of read requests being made by downstream                     (i.e. count only Memory Writes).
devices. When a downstream device requests several
long reads back-to-back, the Root Complex gets tied up               SerDes Eye Capture
in serving that downstream port. If that port has a narrow           Users can evaluate their system’s signal integrity at the
link and is therefore slow in receiving these read packets           physical layer using the PEX 8680’s SerDes Eye
from the Root Complex, then other downstream ports                   Capture feature. Using PLX’s SDK, users can view the
may become starved – thus, impacting performance. The                receiver eye of any lane on the switch. Users can then
Read Pacing feature enhances performances by allowing                modify SerDes settings and see the impact on the
for the adequate servicing of all downstream devices.                receiver eye. Figure 5 shows a screenshot of the SerDes
                                                                     Eye Capture feature in the SDK.
Multicast
The Multicast feature enables the copying of data
(packets) from one ingress port to multiple (up to 19)
egress ports in one transaction allowing for higher
performance in dual-graphics, storage, security, and
redundant applications, among others. Multicast relieves
the CPU from having to conduct multiple redundant
transactions, resulting in higher system performance.
Dynamic Buffer Pool
The PEX 8680 employs a dynamic buffer pool for Flow
Control (FC) management. As opposed to a static buffer
scheme which assigns fixed, static buffers to each port,                         Figure 5. SerDes Eye Capture
PLX’s dynamic buffer allocation scheme utilizes a
common pool of FC Credits which are shared by other                  Error Injection & SerDes Loopback
ports. This shared buffer pool is fully programmable by              Using the PEX 8680’s Error Injection feature, users can
the user, so FC credits can be allocated among the ports             inject malformed packets and/or fatal errors into their
as needed. Not only does this prevent wasted buffers and             system and evaluate a system’s ability to detect and
inappropriate buffer assignments, any unallocated                    recover from such errors. The PEX 8680 also supports
buffers remain in the common buffer pool and can then                Internal Tx, External Tx, Recovered Clock, and
be used for faster FC credit updates.                                Recovered Data Loopback modes.
© PLX Technology, www.plxtech.com                          Page 3 of 3                                        5/14/2009, Version 1.1


                                                       PEX 8680, PCI Express Gen 2 Switch, 80 Lanes, 20 Ports
Applications                                                                 Embedded or Communications Systems
                                                                             The PEX 8680’s 80 lanes can come in handy for
Suitable for host-centric as well as peer-to-peer traffic                    embedded or communications applications requiring
patterns, the PEX 8680 can be configured for a wide                          heavy processing and/or connectivity to multiple
variety of form factors and applications.                                    endpoints. Figure 8a shows an embedded system where
Host Centric Fan-out                                                         the PEX 8680 is being used to fan-out to eight endpoints
The PEX 8680, with its symmetric or asymmetric lane                          using x8 and x16 links. Figure 8b shows a
configuration capability, allows user-specific tuning to a                   communications system where the PEX 8680 is using
variety of host-centric applications. Figure 6 shows a                       x16 and x8 links to fan out to I/Os and three CPUs
server design where, in a quad or multi processor                            which have been configured as endpoints. These CPUs
system, users can assign endpoints/slots to CPU cores to                     will run as endpoints, conducting different processing
distribute the system load. The packets directed to                          tasks while the host CPU (connected to the PEX 8680
different CPUs will go to different (user assigned) PEX                      via a x16 upstream link) manages them.
8680 upstream ports, allowing better queuing and load
balancing capability for higher performance.                                                       CPU                                        CPU
                                  CPU    CPU
                                                                                                   Chip                                      Chip
                                  CPU    CPU                                                        Set                                        Set
                                 Chipset             Memory
                                                                                                        x16                                       x16
                            x4            x8   x8
              Endpoint                                                                                                           x8s
                                                                                                 PEX 8680                                   PEX 8680
                            x16
                                       PEX 8680                                                                    x16s       I/O                 x16s
                                                            x4s                                                   & x8s                       CPU
                                x8s                                                      I/O      I/O      I/O
                 Endpoint                                                                                                         I/O       Endpoint
                                                                                             I/O      I/O      I/O                      CPU           CPU
                                                                                                                                     Endpoint      Endpoint
                              PCIe Gen1 or PCIe Gen2 slots                             Figure 8a. Embedded System                   Figure 8b. Comms System
       Figure 6. Host Centric Dual Upstream
                                                                             N+1 Fail-Over in Storage Systems
Multi-Host Systems                                                           The PEX 8680’s Multi-Host feature can also be used to
In multi-host mode, the PEX 8680 can support up to six                       develop storage array clusters where each host manages
hosts at once. By creating six virtual switches, the PEX                     a set of storage devices independent of others (Figure 9).
8680 allows six hosts to fan-out to their respective                         Users can designate one of the hosts as the failover-host
endpoints. This reduces the number of switches required                      for all the other hosts while actively managing its own
for fan-out, saving precious board space and power. In                       endpoints. The failover-host will communicate with
Figure 7, the PEX 8680 is being shared by six different                      other hosts for status/heartbeat information and execute a
CPU cores (hosts) on three servers, with each CPU core                       failover event if/when it gets triggered.
running its own applications (I/Os). The PEX 8680
                                                                                                          CPU        CPU     CPU        CPU
assigns the endpoints to the appropriate host and isolates                                                CPU        CPU     CPU        CPU
them from the other hosts. In Figure 7, the endpoints are
assigned to the CPU core of the same color.                                                               x4       x4           x8       x8
                    CPU CPU          CPU CPU       CPU CPU                                                          PEX 8680
                     Chip             Chip          Chip                                                  x4       x4           x8       x8
                      Set              Set           Set
                                                                                                                            PEX 8616  PEX 8616
                                                                                                                     PEX 8612        x4       x4
                                                                                                         PEX 8612          x4         x4
                                                                                                                    x4      x4
                                PEX 8680                                                                x4         x4      FC
                                                                                                                                     FC
                                                                                                                                    FC
                                                                                                                                            FC
                                                                                                                    FC     FC
                                                                                                        FC       FC
                  I/O     I/O      I/O     I/O    I/O     I/O
                                                                                                                                 8 Disk Chassis
                                                                                                                         8 Disk Chassis
                      I/O              I/O            I/O                                                        8 Disk Chassis
                                                                                                     8 Disk Chassis
             Figure 7. Multi-Host System                                                             Figure 9. N+1 Failover
© PLX Technology, www.plxtech.com                                  Page 4 of 4                                                                5/14/2009, Version 1.1


                                       PEX 8680, PCI Express Gen 2 Switch, 80 Lanes, 20 Ports
Software Usage Model                                                  ExpressLane PEX 8680 RDK
                                                                      The PEX 8680 RDK (see Figure 10) is a hardware
From a system model viewpoint, each PCI Express port                  module containing the PEX 8680 which plugs right into
is a virtual PCI to PCI bridge device and has its own set             your system. The PEX 8680 RDK can be used to test
of PCI Express configuration registers. It is through the             and validate customer software, or used as an evaluation
upstream port that the BIOS or host can configure the                 vehicle for PEX 8680 features and benefits. The PEX
other ports using standard PCI enumeration. The virtual               8680 RDK provides everything that a user needs to get
PCI to PCI bridges within the PEX 8680 are compliant                  their hardware and software development started.
to the PCI and PCI Express system models. The
Configuration Space Registers (CSRs) in a virtual                     Software Development Kit (SDK)
primary/secondary PCI to PCI bridge are accessible by                 PLX’s Software Development Kit is available for
type 0 configuration cycles through the virtual primary               download at www.plxtech.com/sdk. The software
bus interface (matching bus number, device number, and                development kit includes drivers, source code, and GUI
function number).                                                     interfaces to aid in configuring and debugging the PEX
                                                                      8680. For more information, please refer to the PEX
Interrupt Sources/Events                                              8680 RDK Product Brief.
The PEX 8680 switch supports the INTx interrupt
message type (compatible with PCI 2.3 Interrupt signals)              Both performancePAK and visionPAK are supported by
or Message Signaled Interrupts (MSI) when enabled.                    PLX’s RDK and SDK, the industry’s most advanced
Interrupts/messages are generated by PEX 8680 for hot                 hardware- and software-development kits.
plug events, doorbell interrupts, baseline error reporting,
and advanced error reporting.
                                                                      Product Ordering Information
                                                                      Part Number                    Description
                                                                                                     80-Lane, 20-Port PCI Express Switch,
                                                                      PEX8680-AA50BC F
                                                                                                     Pb-Free (35x35mm2)
                                                                      PEX8680-16U8D BB               PEX 8680 Rapid Development Kit with
                                                                      RDK                            x16 Upstream and Eight x8 Downstream
                                                                      PLX Technology, Inc. All rights reserved. PLX, the PLX logo, ExpressLane,
                                                                      Read Pacing and Dual Cast are trademarks of PLX Technology, Inc. All other
                                                                      product names that appear in this material are for identification purposes only
                                                                      and are acknowledged to be trademarks or registered trademarks of their
                                                                      respective companies. Information supplied by PLX is believed to be accurate
                                                                      and reliable, but PLX assumes no responsibility for any errors that may appear
                                                                      in this material. PLX reserves the right, without notice, to make changes in
                                                                      product design or specification.
         Figure 10. PEX8680-16U8D BB RDK
                                                                      Visit www.plxtech.com for more information.
Development Tools
PLX offers hardware and software tools to enable rapid
customer design activity. These tools consist of a
hardware module (PEX 8680 RDK), hardware
documentation (available at www.plxtech.com), and a
Software Development Kit (also available at
www.plxtech.com).
© PLX Technology, www.plxtech.com                           Page 5 of 5                                                     5/14/2009, Version 1.1


Mouser Electronics
Authorized Distributor
Click to View Pricing, Inventory, Delivery & Lifecycle Information:
Broadcom Limited:
 PEX8680-AA50RBC G
