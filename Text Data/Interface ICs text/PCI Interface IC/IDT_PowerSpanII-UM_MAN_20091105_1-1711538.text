                                                          ®
PowerSpan II™
 User Manual
      80A1010_MA001_09
                       November 2009
      6024 Silver Creek Valley Road, San Jose, California 95138
 Telephone: (800) 345-7015 • (408) 284-8200 • FAX: (408) 284-2775
                          Printed in U.S.A.
              ©2009 Integrated Device Technology, Inc.


                                                                           GENERAL DISCLAIMER
Integrated Device Technology, Inc. reserves the right to make changes to its products or specifications at any time, without notice, in order to improve design or performance
and to supply the best possible product. IDT does not assume any responsibility for use of any circuitry described other than the circuitry embodied in an IDT product. The
Company makes no representations that circuitry described herein is free from patent infringement or other rights of third parties which may result from its use. No license is
granted by implication or otherwise under any patent, patent rights or other rights, of Integrated Device Technology, Inc.
                                                                              CODE DISCLAIMER
Code examples provided by IDT are for illustrative purposes only and should not be relied upon for developing applications. Any use of the code examples below is completely
at your own risk. IDT MAKES NO REPRESENTATIONS OR WARRANTIES OF ANY KIND CONCERNING THE NONINFRINGEMENT, QUALITY, SAFETY OR SUITABILITY
OF THE CODE, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICU-
LAR PURPOSE, OR NON-INFRINGEMENT. FURTHER, IDT MAKES NO REPRESENTATIONS OR WARRANTIES AS TO THE TRUTH, ACCURACY OR COMPLETENESS
OF ANY STATEMENTS, INFORMATION OR MATERIALS CONCERNING CODE EXAMPLES CONTAINED IN ANY IDT PUBLICATION OR PUBLIC DISCLOSURE OR
THAT IS CONTAINED ON ANY IDT INTERNET SITE. IN NO EVENT WILL IDT BE LIABLE FOR ANY DIRECT, CONSEQUENTIAL, INCIDENTAL, INDIRECT, PUNITIVE OR
SPECIAL DAMAGES, HOWEVER THEY MAY ARISE, AND EVEN IF IDT HAS BEEN PREVIOUSLY ADVISED ABOUT THE POSSIBILITY OF SUCH DAMAGES. The code
examples also may be subject to United States export control laws and may be subject to the export or import laws of other countries and it is your responsibility to comply with
any applicable laws or regulations.
                                                                           LIFE SUPPORT POLICY
Integrated Device Technology's products are not authorized for use as critical components in life support devices or systems unless a specific written agreement pertaining to
such intended use is executed between the manufacturer and an officer of IDT.
1. Life support devices or systems are devices or systems which (a) are intended for surgical implant into the body or (b) support or sustain life and whose failure to perform,
when properly used in accordance with instructions for use provided in the labeling, can be reasonably expected to result in a significant injury to the user.
2. A critical component is any components of a life support device or system whose failure to perform can be reasonably expected to cause the failure of the life support device
or system, or to affect its safety or effectiveness.
                      IDT, the IDT logo, and Integrated Device Technology are trademarks or registered trademarks of Integrated Device Technology, Inc.


                                                                                                                                                                                      3
Contents
1.    Functional Overview . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 19
             1.1.1     PowerSpan II Features . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .             20
             1.1.2     PowerSpan II Benefits . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .             21
             1.1.3     Typical Applications . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .            22
             1.1.4     PowerSpan II and PowerSpan Differences Summary . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                                    23
      1.2    PCI Interface . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 24
             1.2.1     PCI-to-PCI Bridge . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .           24
             1.2.2     Primary PCI Interface . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .             25
             1.2.3     PCI Host Bridge . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .         26
             1.2.4     PCI Bus Arbitration . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .           26
      1.3    Processor Bus Interface . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .       26
             1.3.1     Address Decoding . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .            26
             1.3.2     Processor Bus Arbitration . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .               26
      1.4    DMA Controller . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .    26
      1.5    I2C / EEPROM . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .      27
             1.5.1     EEPROM . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .        27
             1.5.2     I2C . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 27
      1.6    Concurrent Reads . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .    27
             1.6.1     PowerSpan II’s Concurrent Read Solution . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                           27
             1.6.2     PowerSpan II’s Concurrent Read Applications . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                             29
2.    PCI Interface . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 31
             2.1.1     Primary PCI . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .       31
             2.1.2     PCI Data Width . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .          32
             2.1.3     PCI Interface Descriptions . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .              34
             2.1.4     Transaction Ordering . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .            34
      2.2    PCI Target Interface . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .    37
             2.2.1     Address Phase . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .         37
             2.2.2     Data Phase . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .      41
             2.2.3     Termination Phase . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .           44
      2.3    PCI Master Interface . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .      46
             2.3.1     Arbitration Phase: Arbitration for the PCI Bus . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                          47
             2.3.2     Address Phase . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .         47
             2.3.3     Data Phase . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .      50
             2.3.4     Terminations. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .       52
      2.4    CompactPCI Hot Swap Silicon Support . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                     53
             2.4.1     LED Support . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .         53
             2.4.2     ES Input . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .    53
             2.4.3     HEALTHY# Signal . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .               53
             2.4.4     CompactPCI Hot Swap Card Insertion and Extraction . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                                   54
             2.4.5     Hot Swap Insertion Process . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                56
             2.4.6     Hot Swap Extraction Process . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                 58
Integrated Device Technology                                                                                                                 PowerSpan II User Manual
www.idt.com                                                                                                                                            80A1010_MA001_09


4                                                                                                                                                                       Contents
     2.5    Vital Product Data . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .  60
            2.5.1     VPD Access . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .      60
            2.5.2     Reading VPD Data. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .           60
            2.5.3     Writing VPD Data . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .          61
     2.6    I2O Shell Interface. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .  62
            2.6.1     I2O Target Image . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .        62
            2.6.2     IOP Functionality. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .        63
            2.6.3     Messaging Interface. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .          64
            2.6.4     Inbound Messages . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .          68
            2.6.5     Outbound Messages. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .            69
            2.6.6     Pull Capability . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .     70
            2.6.7     Outbound Option . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .         73
            2.6.8     I2O Standard Registers . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .            76
3.   Processor Bus Interface . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .83
     3.2    Interface Support . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 83
            3.2.1     Terminology. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 83
            3.2.2     PB Bus Interface Descriptions. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 84
     3.3    PB Slave Interface . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 84
            3.3.1     Address Phase . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 85
            3.3.2     Data Phase . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 92
            3.3.3     Terminations . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 98
     3.4    PB Master Interface . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 100
            3.4.1     Address Phase . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 100
            3.4.2     Data Phase . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 103
            3.4.3     Terminations . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .111
4.   DMA. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 113
     4.2    DMA Register Description . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .           114
            4.2.1     Source and Destination Addresses. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                    114
            4.2.2     Transfer Control Register . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .              115
            4.2.3     Command Packet Addressing . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                    115
            4.2.4     Address Retry . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .        115
            4.2.5     General DMA Control and Status . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                     116
            4.2.6     Processor Bus Transfer Attributes . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                  117
     4.3    Direct Mode DMA Operation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .              118
            4.3.1     Initializing a Direct Mode Operation. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                    118
     4.4    Linked-List Mode DMA Operation. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                  120
            4.4.1     Initializing a Linked-List Mode Transfer . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                       122
     4.5    DMA Interrupts . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .   124
     4.6    DMA Error Handling. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .        124
            4.6.1     PCI Error Bits . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .       125
            4.6.2     Processor Bus Error Bit . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .            125
            4.6.3     Source Port Errors . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .         125
            4.6.4     Destination Port Errors . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .            125
            4.6.5     Command Port Errors . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .              126
PowerSpan II User Manual                                                                                                             Integrated Device Technology
80A1010_MA001_09                                                                                                                                                  www.idt.com


Contents                                                                                                                                                                                   5
5.    I2C/EEPROM . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 127
      5.2    Power-Up Configuration . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                128
             5.2.1        EEPROM Loading . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                 128
      5.3    Bus Master I2C Transactions . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                 135
      5.4    PCI Vital Product Data (VPD) . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                  135
6.    Arbitration . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 137
      6.2    PCI Interface Arbitration . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .             137
             6.2.1        Arbitration Levels . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .             138
             6.2.2        Bus Parking . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .          141
      6.3    Processor Bus Arbitration . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .               141
             6.3.1        Address Bus Arbitration. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                 142
             6.3.2        Data Bus Arbitration . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .               142
             6.3.3        Address Only Cycles . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                143
             6.3.4        PowerSpan II Arbiter and System Boot . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                           143
7.    Interrupt Handling . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 145
      7.2    Interrupt Sources . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .         145
             7.2.1        Interrupts from Normal Operations . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                        145
             7.2.2        Interrupts from Transaction Exceptions . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                         146
      7.3    Interrupt Registers . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .         147
             7.3.1        Interrupt Status . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .         148
             7.3.2        Interrupt Enable . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .           150
             7.3.3        Interrupt Mapping . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .              152
      7.4    Interrupt Pins . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .      153
      7.5    DMA Interrupts . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .          154
             7.5.1        DMA Interrupt Servicing . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                  154
      7.6    Mailboxes . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .     154
      7.7    Doorbells . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .     155
8.    Error Handling . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 157
      8.2    PB Interface Errors. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 158
      8.3    PCI Interface Errors . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 162
      8.4    DMA Errors . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 166
9.    Resets, Clocks and Power-up Options. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 167
      9.1    Reset . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 167
             9.1.1        Reset Pins . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .       167
      9.2    Clocks. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .   170
      9.3    Power-Up Options . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .            171
             9.3.1        Multiplexed System Pin Mode. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                       173
             9.3.2        Configuration Slave Mode . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                   175
             9.3.3        Assertion of P1_REQ64# . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                   175
10. Endian Mapping . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 177
      10.2   Conventions . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 177
Integrated Device Technology                                                                                                                       PowerSpan II User Manual
www.idt.com                                                                                                                                                  80A1010_MA001_09


6                                                                                                                                                                        Contents
     10.3   Processor Bus and PowerSpan II Register Transfers. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                         179
     10.4   Processor Bus and PCI Transfers. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .             183
            10.4.1     Big-endian Mode . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .         183
            10.4.2     Little-endian Mode . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .          185
            10.4.3     PowerPC Little-endian Mode . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                  187
            10.4.4     True Little-endian Mode . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .             188
11. Signals and Pinout . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .191
     11.1   Signal Description . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .   191
            11.1.1     Signal Types. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .     191
            11.1.2     Processor Bus Signals . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .           192
            11.1.3     PCI-1 Signals . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .     196
            11.1.4     PCI-2 Signals . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .     199
            11.1.5     Miscellaneous Signals . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .           201
            11.1.6     Test Signals . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .    203
     11.2   Dual PCI PowerSpan II Pinout . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .             205
            11.2.1     Dual PCI PowerSpan II 480 HSBGA . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                         205
            11.2.2     480 HSBGA Pin Information . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                   207
            11.2.3     Dual PCI PowerSpan II 504 HSBGA . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                         213
            11.2.4     504 HSBGA Pin Information . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                   215
     11.3   Single PCI PowerSpan II Pin Information. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                   221
            11.3.1     Single PCI PowerSpan II 420 HSBGA . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                         221
            11.3.2     420 HSBGA Pin Information . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                   223
            11.3.3     Single PCI PowerSpan II 484 HSBGA . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                         227
12. Register Descriptions . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .235
     12.1   Register Access . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .  235
            12.1.1     Register Map . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .      235
            12.1.2     Access from PCI . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .         244
            12.1.3     Access from the Processor Bus . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                 245
            12.1.4     Access from Multiple Interfaces . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                 245
     12.2   Register Reset . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 245
     12.3   Configuration and IACK Cycle Generation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                      246
            12.3.1     From PCI-to-PCI . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .         246
            12.3.2     From the Processor Bus to PCI . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                 247
     12.4   Bit Ordering and Endian Ordering. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .              248
     12.5   Register Descriptions. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .     248
13. Electrical and Signal Characteristics. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .381
     13.1   Electrical Characteristics . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .     381
            13.1.1     PCI Electrical Characteristics . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .              381
            13.1.2     Non-PCI Electrical Characteristics . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                  381
     13.2   Power Dissipation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .    383
     13.3   Operating Conditions. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .      384
            13.3.1     Recommended Operating Conditions . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                        384
            13.3.2     Handling and Storage Specifications. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                    384
PowerSpan II User Manual                                                                                                              Integrated Device Technology
80A1010_MA001_09                                                                                                                                                   www.idt.com


Contents                                                                                                                                                                              7
             13.3.3   Absolute Maximum Ratings . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 385
14. Package Information . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 387
      14.1   Package Characteristics . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .        387
             14.1.1   Single PCI PowerSpan II 420 HSBGA . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                             387
             14.1.2   Dual PCI PowerSpan II 480 HSBGA . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                             389
      14.2   Thermal Characteristics . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .        391
             14.2.1   Single PCI 420 HSBGA Package . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                          392
             14.2.2   Dual PCI 480 HSBGA Package . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                        393
15. AC Timing . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 395
      15.1   Overview . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 395
      15.2   Single PCI PowerSpan II Timing Parameters . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                        396
      15.3   Dual PCI PowerSpan II Timing Parameters. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                       402
      15.4   Timing Diagrams . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .      408
16. Ordering Information . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 415
      16.1   Ordering Information . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 415
A.    Hardware Implementation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 417
      A.2    Recommended Bootstrap Diode . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                  417
      A.3    PLL External Decoupling . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .            418
             A.3.1    Backwards Compatible PLL Decoupling for Migrating PowerSpan II Designs . . . . . . . . . . . . . . . . .                                                      418
             A.3.2    PowerSpan II External PLL Decoupling for New Designs . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                                        419
B.    Typical Applications. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 421
      B.2    PowerQUICC II and PowerSpan II Applications . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                            421
             B.2.1    Direct Connect Support . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                421
             B.2.2    CompactPCI Adapter Card . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                     423
             B.2.3    CompactPCI Host Card . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                  425
      B.3    WinPath and PowerSpan II Applications. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                     427
Index 433
Integrated Device Technology                                                                                                                  PowerSpan II User Manual
www.idt.com                                                                                                                                             80A1010_MA001_09


8                                            Contents
PowerSpan II User Manual Integrated Device Technology
80A1010_MA001_09                          www.idt.com


                                                                                                                                                                                       9
List of Figures
Figure 1:   PowerSpan II Block Diagram . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 20
Figure 2:   Typical PowerSpan II Application . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 22
Figure 3:   Non-transparent PCI-to-PCI in CompactPCI Application . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 25
Figure 4:   Concurrent Read Process with PowerSpan II . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 28
Figure 5:   Reads with Conventional FIFO-Based Bridges . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 29
Figure 6:   Concurrent Read Waveform . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 42
Figure 7:   PowerSpan II in a CompactPCI Adapter Card . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 55
Figure 8:   Hot Swap Insertion . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 58
Figure 9:   Hot Swap Extraction . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 59
Figure 10:  PowerSpan II I2O Message Passing . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 67
Figure 11:  PowerSpan II I2O Pull Capability. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 72
Figure 12:  PowerSpan II I2O Outbound Capability . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 75
Figure 13:  PB Master Interface Burst Read . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 105
Figure 14:  PB Master Interface Burst Write . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 105
Figure 15:  PB Master Interface Single Cycle Read . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 106
Figure 16:  PB Master Interface Single Cycle Write . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 106
Figure 17:  Direct Mode DMA Transfers . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 119
Figure 18:  DMA Command Packet Linked-List. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 122
Figure 19:  Sequence of Operations in a Linked-List Transfer . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 123
Figure 20:  Assignment of Additional Bus Requesters with PCI Arbiters . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 138
Figure 21:  Arbitration Algorithm . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 140
Figure 22:  PowerSpan II Power-up Waveform . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 174
Figure 23:  PowerSpan II Configuration Slave Mode Timing. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 175
Figure 24:  480 HSBGA. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 206
Figure 25:  504 HSBGA. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 214
Figure 26:  420 HSBGA. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 222
Figure 27:  484 PBGA . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 228
Figure 28:  420 HSBGA. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 388
Figure 29:  480 HSBGA. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 390
Figure 30:  Power-up Reset: CompactPCI Adapter Scenario . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 408
Figure 31:  Power-up Options: Multiplexed System Pin Approach . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 409
Figure 32:  Power-up Options: Configuration Slave Mode . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 409
Figure 33:  Clocking . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 410
Figure 34:  PCI Timing . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 410
Figure 35:  PCI Miscellaneous Timing; Compact PCI Adapter Scenario . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 411
Figure 36:  P1_REQ64_ Assertion Timing . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 411
Figure 37:  Processor Bus Timing . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 412
Figure 38:  Interrupt Timing . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 413
Figure 39:  I2C Timing . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 413
Figure 40:  Bootstrap Diodes for Power-up Sequencing . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 417
Figure 41:  PLL Power Filter . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 418
Figure 42:  PLL Decoupling . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 419
Integrated Device Technology                                                                                                                   PowerSpan II User Manual
www.idt.com                                                                                                                                              80A1010_MA001_09


10                                                                                                                                            List of Figures
Figure 43: PowerSpan II in Multi-processor 60x system . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 422
Figure 44: PowerSpan II in CompactPCI Peripheral Slot . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 424
Figure 45: PowerSpan II in CompactPCI System Slot . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 426
PowerSpan II User Manual                                                                                           Integrated Device Technology
80A1010_MA001_09                                                                                                                                www.idt.com


                                                                                                                                                                                  11
List of Tables
Table 1:    PowerSpan II Applications. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 22
Table 2:    PowerSpan II Functional Enhancements . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 23
Table 3:    Signals Involved in PCI Data Width Determination . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 33
Table 4:    Command Encoding for Transaction Type—PowerSpan II as PCI Target . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 38
Table 5:    Programming Model for PCI Target Image Control Register . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 38
Table 6:    PowerSpan II PCI Target Read Watermarks . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 43
Table 7:    Command Encoding for Transaction Type (PowerSpan II as PCI Master) . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 48
Table 8:    PB Writes and Their Corresponding PCI Writes . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 50
Table 9:    PowerSpan II PCI Master Read Commands . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 51
Table 10:   PowerSpan II I20 Target Image Map . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 76
Table 11:   Programming Model for PB Slave Image Control Register . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 86
Table 12:   Recommended Memory/Cache Attribute Settings. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 86
Table 13:   PowerSpan II PB Slave Transfer Types . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 87
Table 14:   Translation Address Mapping . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 90
Table 15:   PowerSpan II PB Address Parity Assignments . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 91
Table 16:   PowerSpan II PB Transfer Sizes . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 92
Table 17:   PowerSpan II Processor Bus Single Beat Data Transfers . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 93
Table 18:   Read Amount settings . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 96
Table 19:   PowerSpan II PB Data Parity Assignments . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 97
Table 20:   Default PowerSpan II PB Master Transfer Type . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 102
Table 21:   PowerSpan II PB Address Parity Assignments . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 102
Table 22:   PowerSpan II PB Transfer Sizes . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 104
Table 23:   64-bit PB Data Bus Byte Lane Definitions . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 107
Table 24:   PowerSpan II Processor Bus Single Beat Data Transfers . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 108
Table 25:   PowerSpan II PB Data Parity Assignments . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 110
Table 26:   DMA Register Description. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 114
Table 27:   Programming Model for DMA General Control and Status Register . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 116
Table 28:   Default PowerSpan II PB Master Transfer Type . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 117
Table 29:   Programming Model for the Command Packet Contents . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 121
Table 30:   DMA Channel Interrupt Sources and Enables . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 124
Table 31:   Power-up EEPROM Load Sequence . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 128
Table 32:   Mx_EN Default State . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 144
Table 33:   Interrupt Register Description . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 147
Table 34:   Register Description for Interrupt Status Register 0 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 148
Table 35:   Register Description for Interrupt Status Register 1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 149
Table 36:   Register Description for Interrupt Enable Register 0. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 150
Table 37:   Register Description for Interrupt Enable Register 1. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 151
Table 38:   Mapping Definition . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 152
Table 39:   DMA Channel Interrupt Sources and Enables . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 154
Table 40:   PB Interface Errors. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 159
Table 41:   PCI Interface Errors . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 163
Table 42:   PowerSpan II Reset Pins . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 167
Integrated Device Technology                                                                                                               PowerSpan II User Manual
www.idt.com                                                                                                                                          80A1010_MA001_09


12                                                                                                                                                                  List of Tables
Table 43: Reset Direction Control Pins . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .           168
Table 44: PowerSpan II Reset Response . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .              168
Table 45: PowerSpan II Power-up Options . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                171
Table 46: PCI Byte Lane Definitions. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .           177
Table 47: 64-bit PB Data Bus Byte Lane Definitions . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                     178
Table 48: PowerSpan II Big-Endian PB Register Accesses . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                           180
Table 49: Processor Bus Address Munging . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                181
Table 50: PowerSpan II PowerPC Little-Endian PB Register Accesses . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                                  182
Table 51: PowerSpan II Big-endian Mode Byte Lane Mapping . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                               184
Table 52: PowerSpan II Little-endian Mode Byte Lane Mapping. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                               186
Table 53: PowerSpan II True Little-Endian Byte Lane Mappings . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                               189
Table 54: Signal Type Definitions . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .        191
Table 55: Processor Bus Signals . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .        192
Table 56: PCI-1 Signals . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .  196
Table 57: PCI-2 Signals . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .  199
Table 58: Miscellaneous Signals . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .        201
Table 59: Test Signals . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 203
Table 60: Package Characteristics . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .        205
Table 61: Package Characteristics . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .        213
Table 62: Package Characteristics . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .        221
Table 63: Package Characteristics . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .        227
Table 64: PowerSpan II Register Map . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .            235
Table 65: Abbreviations used in Register Descriptions. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                     248
Table 66: Read Amount Versus Read Command . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                        256
Table 67: Block Size . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 271
Table 68: Setting for MODE and MEM_IO Bits. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                      272
Table 69: Read Amount . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .    273
Table 70: Arbitration Pin Mapping . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .          274
Table 71: PCI-2 AD[31:11] lines asserted during Configuration Type 0 cycles. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                                     277
Table 72: Parked PCI Master . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .      285
Table 73: Block Size . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 289
Table 74: Setting for MODE and MEM_IO Bits. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                      291
Table 75: Read Amount . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .    291
Table 76: Translation Address Mapping . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .              293
Table 77: PCI AD[31:11] lines asserted during Configuration Type 0 cycles . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                                    297
Table 78: Mx_EN Default State. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .         308
Table 79: Parked Processor Bus Master. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .             308
Table 80: Arbitration Pin Mappings . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .           320
Table 81: Mapping Definition . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .       337
Table 82: Block Size . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 354
Table 83: Read Amount . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .    355
Table 84: Host Outbound Post List Size . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .             359
Table 85: I2O FIFO Sizes . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .     360
Table 86: HBGA Electrical Characteristics (non-PCI) . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                      381
Table 87: Single PCI PowerSpan II Power Dissipation. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                       383
PowerSpan II User Manual                                                                                                                Integrated Device Technology
80A1010_MA001_09                                                                                                                                                     www.idt.com


List of Tables                                                                                                                                                                   13
Table 88:    Dual PCI PowerSpan II Power Dissipation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .                383
Table 89:    Operating and Storage Conditions . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .         384
Table 90:    Absolute Maximum Ratings. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .        385
Table 91:    Package Characteristics . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .  387
Table 92:    Package Characteristics . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .  389
Table 93:    Thermal Parameters . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 392
Table 94:    420 HSBGA Package Performance . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .              392
Table 95:    Thermal Parameters . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 393
Table 96:    480 PBGA Package Performance . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .             393
Table 97:    Reset, and Clock Timing Parameters . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .           396
Table 98:    PCI 33 MHz Timing Parameters . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .           398
Table 99:    PCI 66 MHz Timing Parameters . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .           399
Table 100:   PB Timing Parameters . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .   400
Table 101:   Miscellaneous Timing Parameters . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .          401
Table 102:   Reset, and Clock Timing Parameters . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .           402
Table 103:   PCI 33 MHz Timing Parameters . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .           404
Table 104:   PCI 66 MHz Timing Parameters . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .           405
Table 105:   PB Timing Parameters . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .   406
Table 106:   Miscellaneous Timing Parameters . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .          407
Table 107:   Standard Ordering Information . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .        415
Integrated Device Technology                                                                                                              PowerSpan II User Manual
www.idt.com                                                                                                                                         80A1010_MA001_09


14                                       List of Tables
PowerSpan II User Manual Integrated Device Technology
80A1010_MA001_09                          www.idt.com


                                                                                                                         15
About this Document
                This section discusses the following topics:
                •   “Scope” on page 15
                •   “Document Conventions” on page 15
                •   “Revision History” on page 16
Scope
                The PowerSpan II User Manual discusses the features, configuration requirements, and design
                architecture of the PowerSpan II.
Document Conventions
                This document uses the following conventions.
                Non-differential Signal Notation
                Non-differential signals are either active-low or active-high. An active-low signal has an active state of
                logic 0 (or the lower voltage level), and is denoted by a lowercase “_” or “#” for PCI signals. An
                active-high signal has an active state of logic 1 (or the higher voltage level), and is not denoted by a
                special character. The following table illustrates the non-differential signal naming convention.
                          State             Single-line signal          Multi-line signal
                       Active low                NAME_                     NAME[3]_
                       Active low                NAME#                     NAME[3]#
                       Active high                NAME                      NAME[3]
                Object Size Notation
                •   A byte is an 8-bit object.
                •   A word is a 16-bit object.
                •   A doubleword (Dword) is a 32-bit object.
Integrated Device Technology                                                                     PowerSpan II User Manual
www.idt.com                                                                                            80A1010_MA001_09


16                                                                                                    About this Document
              Numeric Notation
              •      Hexadecimal numbers are denoted by the prefix 0x (for example, 0x04).
              •      Binary numbers are denoted by the prefix 0b (for example, 0b010).
              •      Registers that have multiple iterations are denoted by {x..y} in their names; where x is first register
                     and address, and y is the last register and address. For example, REG{0..1} indicates there are two
                     versions of the register at different addresses: REG0 and REG1.
              Symbols
                           This symbol indicates a basic design concept or information considered helpful.
                   p
                Ti
                           This symbol indicates important configuration information or suggestions.
                           This symbol indicates procedures or operating levels that may result in misuse or damage to
                           the device.
              Document Status Information
              •      Advance – Contains information that is subject to change, and is available once prototypes are
                     released to customers.
              •      Preliminary – Contains information about a product that is near production-ready, and is revised as
                     required.
              •      Formal – Contains information about a final, customer-ready product, and is available once the
                     product is released to production.
Revision History
              80A1010_MA001_09, Formal, November 2009
              This document was rebranded as IDT. It does not include any technical changes.
              80A1010_MA001_08, Formal, March 2007
              The formatting of this document has been changed and technical edits have occurred throughout the
              document.
              80A1010_MA001_07, Formal, February 2003
              The Dual PCI PowerSpan II has reached production status. This manual represents the production
              information for the Dual PCI PowerSpan II.
PowerSpan II User Manual                                                                     Integrated Device Technology
80A1010_MA001_09                                                                                              www.idt.com


About this Document                                                                                              17
                80A1010_MA001_06, Formal, December 2002
                The Single PCI PowerSpan II has reached production status. This manual represents the production
                information for the Single PCI PowerSpan II.
Integrated Device Technology                                                             PowerSpan II User Manual
www.idt.com                                                                                    80A1010_MA001_09


18                                About this Document
PowerSpan II User Manual Integrated Device Technology
80A1010_MA001_09                          www.idt.com


                                                                                                                      19
1.              Functional Overview
                This chapter describes the PowerSpan II’s architecture. The following topics are discussed:
                •   “PCI Interface” on page 24
                •   “Processor Bus Interface” on page 26
                •   “DMA Controller” on page 26
                •   “I2C / EEPROM” on page 27
                •   “Concurrent Reads” on page 27
1.1             Overview
                The IDT PowerSpanTM II is a Multi-port PCI Bus Switch that bridges PCI to the PowerQUICC II
                (MPC8260), PowerPCTM 7xx, and the Wintegra WinPathTM processors. PowerSpan II is available in
                either a single PCI or dual PCI variant. PowerSpan II defines a new level of PCI bus switch flexibility.
                The integrated, non-transparent PCI-to-PCI bridge in the Dual PCI PowerSpan II provides a significant
                opportunity for designers to reduce component count and increase overall system performance.
                PowerSpan II offers a flexible package design. The design is available in both the original PowerSpan
                package dimensions and newly designed, smaller packages.
                The high level of performance and flexibility of PowerSpan II is made possible through Switched PCI
                - unique to PowerSpan II. Switched PCI uses a switching fabric to enable data streams to pass from
                port-to-port across the multi-ported PowerSpan II without collision. This improves the burst
                performance and decreases latency on the PCI and processor buses — a key element in enabling
                increased I/O performance.
Integrated Device Technology                                                                 PowerSpan II User Manual
www.idt.com                                                                                        80A1010_MA001_09


20                                                                                                                                                                 1. Functional Overview
              Figure 1: PowerSpan II Block Diagram
                                                     IEEE1149.1   Up to 3                           32-bit Address/64-bit Data
                                                      Boundary   External                            100 MHz Processor Bus
                                                        Scan    Bus Masters
                                                       JTAG                  PB                PowerPC Processor Bus Interface
                                                                           Arbiter
                                                                                     DMA
                  32-bit Address / 64-bit Data                                                                                                                      32-bit Address and Data
                                                                                           Switching Fabric
                                                                                                                                              PCI-2 Interface
                                                                                        PCI-to-Processor
                                                         PCI-1 Interface
                                                                                        Posted Writes
                                                                                        Concurrent Delayed Reads
                                                                                        Concurrent DMA Reads/Writes
                       66 MHz PCI Bus
                                                                                                                                            (Optional Interface)       66 MHz PCI Bus
                                                                                        Processor-to-PCI
                                                                                        Posted Writes
                                                                                        Concurrent Delayed Reads
                                                                                        Concurrent DMA Reads/Writes
                                                                                        PCI-to-PCI
                                                                                        Posted Writes
                                                                                        Concurrent Reads
                                                                                        Concurrent DMA Reads/Writes
                                                                                               Registers
                                                         PCI-1                                                                               PCI-2
                                                        Arbiter            Interrupts             I2 C
                                                                                                                 Hot Swap                   Arbiter
                                                                                                                 Controller
                                                                                                                         80A1010_BK001_03
                                                      Up to 7                                  Up to 8        Hot Swap          Up to 7
                                                     External                                   Slave Friendly - Programmable  External
                                                    Bus Masters                                Devices    on PCI-1 or PCI-2   Bus Masters
1.1.1         PowerSpan II Features
              PowerSpan II has the following features:
1.1.1.1       Processor Support
              •                          Direct connect interface for embedded processors:
                                                 — Motorola: PowerQUICC II (MPC825x, MPC826x, MPC827x, MPC8280), PowerPC 7XX
                                                   (MPC74x,MPC75x), PowerPC 7400
                                                 — IBM: PowerPC 740, PowerPC 750
                                                 — Wintegra: WinPathTM
              •                          25 MHz-to-100 MHz bus frequency
              •                          Programmable endian conversion
              •                          PowerQUICC II Configuration Slave support for power-up options
PowerSpan II User Manual                                                                                                                                   Integrated Device Technology
80A1010_MA001_09                                                                                                                                                            www.idt.com


1. Functional Overview                                                                                             21
                •   Eight programmable memory maps to PCI from the processor
                •   Processor bus arbiter with support for three requesters
1.1.1.2         PCI Support
                •   Dual PCI PowerSpan II:
                     — One 32-bit or 64-bit PCI interface
                     — One 32-bit interface
                     — 66 MHz operation
                •   Single PCI PowerSpan II:
                     — One 32-bit or 64-bit PCI interface
                     — 66 MHz operation
                •   Integrated, non-transparent PCI-to-PCI bridge in the Dual PCI PowerSpan II
                •   PCI arbiters on each PCI interface
                •   CompactPCI Hot Swap Friendly
                •   PCI 2.2 Specification compliant
1.1.1.3         Packaging options
                •   Single PCI PowerSpan II (CA91L8260B)
                     — 64-bit/66MHz
                     — 420 HSBGA: 1.27mm ball pitch, 35mm body size
                     — 484 PBGA: 1.0mm ball pitch, 23mm body size
                •   Dual PCI PowerSpan II (CA91L8200B)
                     — 32-bit/66MHz and 64-bit/66MHz
                     — 480 HSBGA: 1.27mm ball pitch, 37.5mm body size
                     — 504 HSBGA: 1.0mm ball pitch, 27mm body size
1.1.2           PowerSpan II Benefits
                PowerSpan II offers the following benefits to designers:
                •   Smaller packages reduce board area required for system design.
                •   Integrated PCI bus, processor bus arbiters decrease individual component count on boards.
                •   Flexible PCI interfaces enable PowerSpan II to meet many different application requirements.
                •   Integrated, non-transparent PCI-to-PCI bridge connects traffic between the two PCI interfaces.
                    This decreases individual component count and simplifies conventional CompactPCI board
                    architecture.
                •   Supports reads from multiple I/O devices in parallel, non-blocking streams which decreases bus
                    latency.
Integrated Device Technology                                                                PowerSpan II User Manual
www.idt.com                                                                                      80A1010_MA001_09


22                                                                                                                            1. Functional Overview
1.1.3         Typical Applications
              IDT understands vendors’ needs to increase performance throughout today’s communications
              networks. From premise equipment to local carrier gear to high-end switches, designer’s need to
              deliver ever-faster traffic through the same or smaller footprint at a reduced cost. IDT System
              Interconnect helps in that effort by providing features and benefits across all areas of the network.
              PowerSpan II helps designers working on infrastructure equipment in the following areas:
              Table 1: PowerSpan II Applications
                LAN/WAN                                                  Remote/Local Access                      Wireless
                Exchange Carrier Switching                               ADSL Concentrators                       Third Generation (3G) Base
                Equipment                                                                                         Stations
                Ethernet Switches                                        VoIP Gateways
                MPEG 2 Encoders                                          VPN Equipment
              PowerSpan II is a very flexible device. The following diagram shows a typical PowerPC system
              architecture using PowerQUICC II and the Dual PCI PowerSpan II.
              Figure 2: Typical PowerSpan II Application
                        MPC8260
                         Memory
                        Controller
                              Processor Bus
                              32-bit Address/64-bit Data
                              66 MHz/100 MHz (PPC 740/750)
                                                                                    PMC Connectors
                                        PCI-2 (optional)
                       PowerSpan II
                                        32-bit Address/32-bit Data
                                        66 MHz
                              PCI-1
                              32-bit Address/64-bit Data
                              66 MHz
                                                                                                   80A1010_TA001_02
                                                                   PCI Bus
PowerSpan II User Manual                                                                                               Integrated Device Technology
80A1010_MA001_09                                                                                                                        www.idt.com


1. Functional Overview                                                                                                  23
1.1.4             PowerSpan II and PowerSpan Differences Summary
                  The following table summarizes the main PowerSpan II programmable features that were unavailable
                  in the PowerSpan device. All functional enhancements are programmable in order to make sure that all
                  original PowerSpan functionality can be exercised.
Table 2: PowerSpan II Functional Enhancements
 Functional Enhancement Descriptions                                                             See
 Packaging Change                                                                                “Electrical and Signal
 Packaging has been changed from HPBGA packages to HSBGA packages. Four variants are             Characteristics” on
 available for PowerSpan II: two variants for the Single PCI                                     page 381 and “Package
 PowerSpan II and two variants for the Dual PCI PowerSpan II. Both the Single and Dual PCI       Information” on
 PowerSpan II have packages, signals, and pins that are backwards compatible with the original   page 387
 PowerSpan device.
 New Revision ID                                                                                 “Register Descriptions”
 PowerSpan II has a new ID.                                                                      on page 235
 Read implementation                                                                             “PCI Interface” on
 PowerSpan II supports 4 byte transactions.                                                      page 31, “Processor
                                                                                                 Bus Interface” on
                                                                                                 page 83, and “Register
                                                                                                 Descriptions” on
                                                                                                 page 235
 True Little-endian Mode                                                                         “Endian Mapping” on
 A new endian mode was developed for PowerSpan II                                                page 177, and “Register
                                                                                                 Descriptions” on
                                                                                                 page 235
 Base Address Implementation                                                                     “Register Descriptions”
 PowerSpan II supports a PCI base address of 0x00000.                                            on page 235
 Maximum Retry Counter Modification                                                              “Register Descriptions”
 The maximum retry counter is programmable in PowerSpan II                                       on page 235
 Arbitration Timing for Masters                                                                  “Arbitration” on
 PowerSpan II measures the length of time it takes a master to respond to the GNT# signal.       page 137 and “Register
                                                                                                 Descriptions” on
                                                                                                 page 235
 PowerPC 7400 Transaction Support                                                                “Processor Bus
 PowerSpan II has been designed to support specific PowerPC 7400 misaligned transactions.        Interface” on page 83
                                                                                                 and “Register
                                                                                                 Descriptions” on
                                                                                                 page 235
 Delay Sampling of Transaction Start Signal                                                      “Arbitration” on
 The PowerSpan II PB arbiter can be programmed to sample requests two clocks after the PB_TS_    page 137 and “Register
 signal is asserted.                                                                             Descriptions” on
                                                                                                 page 235
Integrated Device Technology                                                                   PowerSpan II User Manual
www.idt.com                                                                                          80A1010_MA001_09


24                                                                                                        1. Functional Overview
Table 2: PowerSpan II Functional Enhancements
 Functional Enhancement Descriptions                                                                     See
 Programmable DMA Block Size                                                                             “DMA” on page 113 and
 PowerSpan II enables programmable DMA block sizes.                                                      “Register Descriptions”
                                                                                                         on page 235
 PB Arbiter Qualifies Bus Grants                                                                         “Arbitration” on
 The PowerSpan II PB Arbiter can be programmed to qualify data bus grants before issuing data bus        page 137 and “Register
 grants.                                                                                                 Descriptions” on
                                                                                                         page 235
 Target Fast Back to Back Capable (TFBBC)                                                                “Register Descriptions”
 The default setting of this bit was changed to 0 in PowerSpan II; the device does not support fast      on page 235
 back-to-back transactions.
1.2               PCI Interface
                  PowerSpan II is available as a Single PCI PowerSpan II or Dual PCI PowerSpan II. A 64-bit PCI
                  Interface is available on both variants; the Dual PCI PowerSpan II has a 32-bit PCI Interface in
                  addition to the 64-bit PCI Interface. In both cases, the PCI Interfaces on the PowerSpan II support
                  66MHz operation and are asynchronous to the other interfaces on the device.
                  The PCI interfaces are PCI 2.2 Specification compliant.
1.2.1             PCI-to-PCI Bridge
                  The Dual PCI PowerSpan II is a PCI-to-PCI bridge. It connects traffic between the two PCI interfaces.
                  This PCI-to-PCI bridging function is “non-transparent”. In a non-transparent bridge one PCI bus is
                  hidden from system BIOS running in the other PCI domain. Memory and I/O transfers pass freely
                  between the PCI interfaces, but Configuration accesses are filtered.
                  The application is shown in Figure 3.
PowerSpan II User Manual                                                                           Integrated Device Technology
80A1010_MA001_09                                                                                                      www.idt.com


1. Functional Overview                                                                                             25
Figure 3: Non-transparent PCI-to-PCI in CompactPCI Application
                                                                                                       Dual PCI
                                                                                                      PowerSpan
                                                                  MEM
       Host processor                               Host
      as local controller
                                                                                              To CompactPCI
                                                                                                Back-Plane
                                        One or More Local I/O Controllers
                                   (for example, gigabit ethernet, IEEE 1394)
                Because of the non-transparent PCI-to-PCI bridging, the host processor on the CompactPCI adapter
                card acts as local host without the local PCI devices being configured by the CompactPCI system host.
1.2.2           Primary PCI Interface
                The PowerSpan II provides extra functionality for one of the PCI interfaces. The PCI Interface
                assigned extra functionality must be specified as Primary PCI Interface through a power-up option.
                The Primary PCI Interface functions are:
                •   CompactPCI Hot Swap Friendly support
                •   I2O 2.0 Specification compliant messaging
                •   Vital Product Data support.
                          This extra functionality is available for the Single PCI PowerSpan II and the Dual PCI
                          PowerSpan II.
Integrated Device Technology                                                                  PowerSpan II User Manual
www.idt.com                                                                                        80A1010_MA001_09


26                                                                                              1. Functional Overview
1.2.3         PCI Host Bridge
              PowerSpan II is designed for host bridge applications. The PowerPC processor generates configuration
              cycles on the PCI bus in the same way as that found in conventional PCI host bridges. In addition, with
              concurrent reads and low device latency, the PCI Target Interface on PowerSpan II is specifically
              designed to allow low latency access to host packet memory for I/O controllers on either of the PCI
              buses.
1.2.4         PCI Bus Arbitration
              Each PCI Interface has an integrated PCI bus arbiter. Each arbiter supports four external bus requesters.
              An additional three bus requesters can be assigned between the two PCI arbiters.
              The PCI arbiters implement a fairness algorithm, two round robin priority levels and flexible bus
              parking options.
1.3           Processor Bus Interface
              The PowerSpan II provides a direct-connect 64-bit interface to the PowerQUICC II (MPC8260),
              MPC7xx, PowerPCTM 7xx, and the Wintegra WinPathTM processors. The direct-connect support for
              these interfaces has been extensively verified during product development with processor functional
              models as well as with a hardware emulation methodology. This verification ensures any potential
              interface issues are identified and resolved by IDT before PowerSpan II customers begin to design their
              own systems.
              PowerSpan II supports processor (60x) bus extended cycles on the Processor Interface. Extended cycle
              support means more flexible bursting and more efficient use of the processor bandwidth.
1.3.1         Address Decoding
              Instead of consuming chip selects from the processor, PowerSpan II performs its own address decoding
              for up to eight memory (slave) images to the PCI bus from the processor bus. This allows a flexible
              mapping of processor transactions to PCI cycle types.
1.3.2         Processor Bus Arbitration
              The Processor Interface has an integrated bus arbiter. The Processor Interface supports three external
              bus masters for applications involving multiple processors. The processor bus arbiter implements two
              levels of priority, where devices programmed into a specific priority level operate in a round robin
              fashion in that level.
1.4           DMA Controller
              PowerSpan II provides four independent, bidirectional DMA channels. Each DMA channel is capable
              of Linked-List or Direct mode transfers.
              Each DMA channel transfers data from any-port to any-port. For example, from PCI-1 to PCI-2,
              Processor Bus to PCI-1, or Processor Bus and Processor Bus. High throughput data transfer is coupled
              by flexible endian mapping and a range of status bits mappable to external interrupts.
PowerSpan II User Manual                                                                 Integrated Device Technology
80A1010_MA001_09                                                                                          www.idt.com


1. Functional Overview                                                                                                  27
1.5             I2C / EEPROM
1.5.1           EEPROM
                PowerSpan II registers can be programmed by data in an EEPROM at system reset. This enables board
                designers to set unique identifiers for their cards on the PCI bus at reset, and set various image
                parameters and addresses. Configuring PowerSpan II with the EEPROM allows PowerSpan II to
                boot-up as a Plug and Play compatible device. PowerSpan II supports reads from, and writes to, the
                EEPROM.
1.5.2           I 2C
                PowerSpan II has a master only I2C bus compatible interface which supports up to eight I2C slave
                devices. This interface is used by PowerSpan II for the initialization of registers and for reading and
                writing PCI Vital Product Data (VPD).
                PowerSpan II also provides a mechanism to perform master read and write operations to EEPROMs or
                other I2C compatible slave devices.
1.6             Concurrent Reads
                PowerSpan II’s Switched PCI architecture enables concurrent reads through a single channel. This
                ability greatly reduces read latency, which is often the limiting factor in PCI performance.
1.6.1           PowerSpan II’s Concurrent Read Solution
                With PowerSpan II’s concurrent reads, read requests are accepted even while the current read is in
                progress. Figure 4 illustrates the concurrent read process with the PowerSpan II.
Integrated Device Technology                                                                     PowerSpan II User Manual
www.idt.com                                                                                            80A1010_MA001_09


28                                                                                                        1. Functional Overview
Figure 4: Concurrent Read Process with PowerSpan II
                                                                          READ 1
      READ 1 Request                                                                                            Read Request
                  1.                                                     2.
                             Master 1: Makes a read request                       Master 2: Makes an initial read
                             and is retried.                                      request and is retried.
                                                READ 2
                                                            Read Request
                   3.                                                    4.
                              Master 1: Takes the read data                                     Master 2: Takes read data
                                                                          Master 1: Makes request
               When Master 2 makes its first read request in Step 2, it is retried but information about the read request
               is latched and initiates a read on the other bus. This occurs even though a read is in progress for
               Master 1.
               PowerSpan II can simultaneously support two reads to the Processor Bus and two reads to the PCI bus.
1.6.1.1        Conventional Reads and Retries
               In conventional FIFO-based bridge architectures, bus masters must take turns for read opportunities
               and incur multiple retries while waiting. Figure illustrates the read process for subsequent reads where
               retries are incurred while a pending read is completed.
PowerSpan II User Manual                                                                         Integrated Device Technology
80A1010_MA001_09                                                                                                     www.idt.com


1. Functional Overview                                                                                                         29
Figure 5: Reads with Conventional FIFO-Based Bridges
                                                            READ 1
        READ 1 Request
                 1.                                          2.                             3.
                               Master 1: Makes a                Master 2: Makes a read          Master 1: Takes the read data.
                               read request.                    request and is retried.
                                                                            READ 2
                                             READ 2 Request
                 4.                                      5.                             6.
                        Master 2: Makes another                 Master 1: Makes another    Master 2: Takes the read data.
                        read request.                           request and is retried.
                 When Master 2 is retried in Step 2, no information is latched about the read request. When Master 2
                 returns for a subsequent read request in Step 4, it is treated by the bridge as the first read request.
1.6.2            PowerSpan II’s Concurrent Read Applications
1.6.2.1          PCI Host Bridge
                 In a PCI host bridge application, all of the PCI masters — for example, I/O controllers — potentially
                 receive only one retry before receiving read data. Even with another read pending, when the PCI Target
                 Interface of the PCI host device receives a read request, it latches the information and begins another
                 burst read prefetch on the processor bus. The PCI host bridge latches the addresses and delivers the
                 data to each master using separate, dedicated buffering. This approach greatly reduces the overall
                 system latency and allows for a more scalable I/O subsystem.
Integrated Device Technology                                                                          PowerSpan II User Manual
www.idt.com                                                                                                  80A1010_MA001_09


30                                                                                               1. Functional Overview
1.6.2.2       Adapter Card
              In an adapter card application, the read latency problem is a mirror image of a PCI host bridge
              application. In an adapter card, the PowerQUICC II serial ports (FCCs) may be expected to transfer bit
              streams through the PowerQUICC II/PCI to host memory across the PCI bus. In this case, there can be
              eight separate FCCs potentially contending for the processor slave interface in the PCI bridge —
              assuming there are two PowerQUICC IIs on the local bus. This architecture adds considerable latencies
              to read transactions because of FCCs attempting reads to host memory across the PCI bus. Ideally, each
              FCC would have a dedicated channel to the PCI bus so they do not have to share resources.
              PowerSpan II supports this ideal situation through its concurrent reads in a flexible switching
              architecture. The PCI bridge latches information about the local read as it receives the read request
              even with reads pending. The FCCs can now receive transmit data from system host memory with far
              lower latencies.
PowerSpan II User Manual                                                                 Integrated Device Technology
80A1010_MA001_09                                                                                           www.idt.com


                                                                                                                     31
2.              PCI Interface
                Peripheral Component Interconnect (PCI) is a bus protocol that defines how devices communicate on a
                peripheral bus and with a host processor. If a device is referred to as PCI compliant it must be
                compliant with the PCI Local Bus Specification (Revision 2.2). A PCI bus supports frequencies up to
                66 MHz, and 32-bit or 64-bit transfers.
                This chapter describes the PCI Interface of the Dual PCI PowerSpan II. The following topics are
                discussed:
                •   “Overview” on page 31
                •   “PCI Target Interface” on page 37
                •   “PCI Master Interface” on page 46
                •   “CompactPCI Hot Swap Silicon Support” on page 53
                •   “Vital Product Data” on page 60
                •   “I2O Shell Interface” on page 62
2.1             Overview
                This chapter describes the functionality of the Dual PCI PowerSpan II. The Single PCI PowerSpan II is
                identified when its functionality or settings differ from the Dual PCI PowerSpan II.
                The Single PCI PowerSpan II and the Dual PCI PowerSpan II have different characteristics. The
                features of each device are shown in the following list.
                •   Dual PCI PowerSpan II:
                     — One 32-bit or 64-bit PCI interface
                     — One 32-bit interface
                     — 66 MHz operation
                •   Single PCI PowerSpan II:
                     — One 32-bit or 64-bit PCI interface
                     — 66 MHz operation
2.1.1           Primary PCI
                The Dual PCI PowerSpan II has two PCI interfaces: the PCI-1 Interface and the PCI-2 Interface. PCI-1
                interface is 32-bit or 64-bit capable, while the PCI-2 Interface is 32-bit. Both PCI interfaces have
                66 MHz capability.
Integrated Device Technology                                                                    PowerSpan II User Manual
www.idt.com                                                                                           80A1010_MA001_09


32                                                                                                      2. PCI Interface
              There are two settings available for the Dual PCI PowerSpan II: Primary PCI Interface and Secondary
              PCI Interface. The Primary PCI Interface adds extra functionality to the PCI Interface that is designated
              as the Primary PCI Interface. The Secondary PCI Interface has no extra functionality.
              The following features are associated with the Primary PCI Interface:
              •    CompactPCI Hot Swap Support (see “CompactPCI Hot Swap Silicon Support” on page 53)
              •    Vital Product Data (see “Vital Product Data” on page 60)
              •    I2O Shell Interface (see “I2O Shell Interface” on page 62)
                         The Primary PCI Bus (PRI_PCI) bit in the “Reset Control and Status Register” on page 324 is
                         always 0 in the Single PCI PowerSpan II.
              Either the PCI-1 Interface (64-bit) or the PCI-2 Interface (32-bit) can be configured as the Primary
              Interface. The selected PCI interface is assigned as the Primary PCI Interface through the Primary PCI
              Select (PWRUP_PRI_PCI) power-up option (see “Resets, Clocks and Power-up Options” on page 167
              for more information). Primary PCI functionality is shown in the value of the Primary PCI Bus
              (PRI_PCI) bit in the “Reset Control and Status Register” on page 324. The PRI_PCI is a status bit and
              only shows which bus is primary. It does not enable a bus as the Primary PCI Interface. The Primary
              PCI interface is enabled with a power-up option (see 9. “Resets, Clocks and Power-up Options”
              on page 167).
2.1.1.1       Clock Frequencies
              Each of the PCI interfaces, PCI-1 and PCI-2, run at frequencies from 25 MHz to 66 MHz. The DEV66
              bit in the “PCI-1 Control and Status Register.” on page 251 indicates that PowerSpan II is a 66
              MHz-capable device.
              The speed of these buses is determined through a power-up option (see “Clocks” on page 170 and
              “Power-Up Options” on page 171) using the corresponding P1_M66EN pins.
              Both PCI interfaces run asynchronously to one another, and asynchronously to the Processor Bus
              Interface.
2.1.2         PCI Data Width
              The PCI-1 Interface is a 64-bit data interface that supports 32-bit addressing. The PCI-2 Interface is a
              32-bit data interface that supports 32-bit addressing.
2.1.2.1       PowerSpan II in non-Hot Swap and PCI Host Applications
              The PCI-1 Interface can be programmed to assert P1_REQ64# to indicate the data width of the PCI-1
              bus at reset. This feature is controlled by the PWRUP_P1_R64_EN power-up option (see “Power-Up
              Options” on page 171) and minimizes required external logic. A logic low applied to P1_64EN#
              enables this feature. PowerSpan II drives P1_REQ64# when PWRUP_P1_R64_EN is selected and
              P1_64EN# is set to 0.
PowerSpan II User Manual                                                                  Integrated Device Technology
80A1010_MA001_09                                                                                           www.idt.com


2. PCI Interface                                                                                                   33
                 When P1_64EN# is at a logic low, and PWRUP_P1_R64_EN is selected, P1_REQ64# is asserted low
                 during reset. The status of PWRUP_P1_R64_EN is reflected in the P1_R64_EN bit in the “Reset
                 Control and Status Register” on page 324.
                           This feature must only be used in systems where PowerSpan II controls both P1_REQ64#
                           and P1_RST#. In this scenario, PowerSpan II is the Central Resource in the system and can
                           ensure that timing parameters are satisfied.
2.1.2.2          PowerSpan II in non-Hot Swap and PCI Peripheral Applications
                 The PCI-1 Interface supports the following mechanisms for determining the width of the PCI-1
                 datapath:
                 •   sampling P1_REQ64# at the negation of P1_RST#
                 •   logic level on P1_64EN#
                 In non-Hot Swap applications, the P1_64EN# signal must be pulled high in order to enable sampling of
                 P1_REQ64# to determine the width of the data path. The result of the sampling of P1_REQ64# is or’d
                 with the logic level on P1_64EN# to determine data path width (see Table 3).
                 Table 3: Signals Involved in PCI Data Width Determination
                                              Signal
                           P1_REQ64#                         P1_64EN#                        Result
                                 0                               0                         64-bit bus
                                 1                               0                         64-bit bus
                                 0                               1                         64-bit bus
                                 1                               1                         32-bit bus
2.1.2.3          PowerSpan II in Hot Swap Applications
                 In Hot Swap applications the P1_64EN# signal is the only signal sampled to indicate the PCI data
                 width. The following scenarios can be used for determining the proper implementation of the
                 P1_REQ64# and P1_64EN# signals:
                 •   PCI bus is currently a 32-bit slot and the Hot Swap board is 64-bit capable. In this case,
                     P1_REQ64# is pulled up in the slot and P1_64EN# is OPEN and the card will initialize in 32-bit
                     mode.
                 •   PCI bus is currently a 32-bit slot and the Hot Swap board is 32-bit capable. In this case,
                     P1_REQ64# is not sampled and P1_64EN# does not exist on the board so initialization would be
                     32-bit mode.
Integrated Device Technology                                                                  PowerSpan II User Manual
www.idt.com                                                                                          80A1010_MA001_09


34                                                                                                         2. PCI Interface
              •    PCI bus is currently a 64-bit slot and the Hot Swap board is 64-bit capable. In this case,
                   P1_REQ64# could be anything but P1_64EN# is GND and the card will initialize in 64-bit mode.
              •    PCI bus is currently a 64-bit slot and the Hot Swap board is 32-bit capable. In this case,
                   P1_REQ64# is not sampled and P1_64EN# does not exist on the board so initialization would be
                   32-bit mode.
2.1.2.4       PowerSpan II Drives PCI 64-bit Extension Signal in 32-bit Environment
              When PowerSpan II's 64-bit PCI interface is programmed to operate in 32-bit mode, the 64-bit
              extension PCI bus signals can be left open. PowerSpan II actively drives the following the input
              signals:
              •    Driven Low
                    — P1_ADb[63:32]#
                    — P1_CBE[7:4]#
                    — P1_REQ64#
                    — P1_ACK64#
                    — P1_PAR64#
                    — P1_PAR64#
                    — P1_REQ64#
                    — P1_ACK64#
              This insures the signals do not oscillate and that there is not a significant power drain through the input
              buffer.
2.1.3         PCI Interface Descriptions
              The PowerSpan II PCI interfaces are described in terms of its PCI master and PCI target functions. This
              description is largely independent of PCI-1 versus PCI-2, or the assignment of the Primary PCI
              Interface functions. Exceptions to these rules are noted as required.
                            Cross-references to PCI registers are shown as PCI-1 whenever the
                            cross-references apply equally to PCI-1 or PCI-2 registers.
2.1.4         Transaction Ordering
              PowerSpan II implements a set of ordering rules for transactions initiated by master(s) connected to
              PCI Interface Px, that are destined for targets and/or slaves connected to PCI Interface Py.
                        Transactions initiated by master(s) connected to PCI Interface Px, but with different
                        PowerSpan II destination interfaces, are independent from an ordering perspective.
                        Transactions initiated by PowerSpan II DMA and PowerSpan II generated interrupt events
                        have no ordering relationship to externally initiated transactions processed by PowerSpan II.
PowerSpan II User Manual                                                                     Integrated Device Technology
80A1010_MA001_09                                                                                              www.idt.com


2. PCI Interface                                                                                                        35
2.1.4.1          Transactions Between Px and Py
                 PowerSpan II implements the following transaction ordering rules for transactions flowing between
                 PCI Interface Px and PCI Interface Py:
                 •   The order in which delayed read requests are latched on the source bus, and posted memory write
                     transactions are presented on the source bus, is the order in which they appear on the destination
                     bus.
                 •   Writes flowing from Px to Py have no ordering relationship to writes flowing from Py to Px.
                 •   The acceptance of a posted write as a target or slave is not contingent on the completion of a
                     transaction by the master of the same interface. PowerSpan II master and target/slave modules are
                     independent.
2.1.4.2          Transactions Between the PB Interface and the PCI Interfaces
                 When there are transactions to the PB Interface from both PCI-1 and PCI-2, there is a possibility that a
                 transaction from PCI-2 can be queued ahead of a transaction from
                 PCI-. This is caused by the fact there is no transaction ordering between the two independent PCI
                 interfaces. For example, if transactions to the PB Interface arrive in the following order from PCI-1 and
                 PCI-2:
                 •   PCI-1 Write 1
                 •   PCI-2 Write 1
                 •   PCI-2 Write 2
                 •   PCI-1 Write 2
                 The transactions can be completed to the PB Interface in the following order even though PCI-2 Write
                 2 entered PowerSpan II before PCI-1 Write 2:
                 •   PCI-1 Write 1
                 •   PCI-2 Write 1
                 •   PCI-1 Write 2
                 •   PCI-2 Write 2
                 This is caused by the fact that PCI-1 to PB Interface transactions and PCI-2 to PB Interface transactions
                 arbitrate in a round robin fashion. When a PowerSpan II decision is required on whether to service a
                 transaction from PCI-1 or PCI-2, writes are available at both even though at one point a write is only
                 available from PCI-2.
2.1.4.3          DMA Transactions
                 DMA transactions and regular write/read transactions arbitrate for the use of a master interface in a
                 round robin scheme. There are no special priorities for DMA transactions and regular write/read
                 transactions.
Integrated Device Technology                                                                      PowerSpan II User Manual
www.idt.com                                                                                            80A1010_MA001_09


36                                                                                                        2. PCI Interface
              Writes and reads from one source are queued and arbitrated for the use of the master interface with
              DMA in a round robin design. A DMA transaction can be given a lower priority by programming the
              DMA Channel Off Counter (OFF) bit in the “DMA x General Control and Status Register” on
              page 314. The OFF bit provides programmable control over the amount of source bus traffic generated
              by the DMA channel. The channel interleaves source bus transfers with a period of idle processor bus
              clocks where no source bus requests are generated. When source and destination interfaces are
              different, 256 bytes of source bus traffic occurs before the idle period. If source and destination
              interfaces are the same, 64 bytes of source bus traffic occur before the idle period. This helps prevent
              PowerSpan II from interfering with processor bus instruction fetches.
              All transactions (writes/reads/DMA) from two source interfaces arbitrate in a round robin scheme on a
              per interface basis. Refer to “Transactions Between the PB Interface and the PCI Interfaces” on
              page 35 for more information.
2.1.4.4       PCI Transaction Ordering Rules
              The PCI 2.2 Specification outlines transaction ordering rules for PCI transactions. PowerSpan II does
              not comply with the following PCI transaction ordering rules:
              •    PowerSpan II only completes the writes that are destined for the same bus as the initiated read
                   when it is processing a read request. It does not complete writes in both directions before
                   processing a read request. PowerSpan II does not prioritize writes over reads.
              •    PowerSpan II does not allow posted memory writes to pass delayed read requests. This implies that
                   deadlock conditions may occur when the customer uses bridges that do not support delayed
                   transactions. Deadlock conditions are broken by the PowerSpan II maximum retry counter.
PowerSpan II User Manual                                                                    Integrated Device Technology
80A1010_MA001_09                                                                                             www.idt.com


2. PCI Interface                                                                                                       37
2.2              PCI Target Interface
                 PowerSpan II participates in a transaction as a PCI target when a PCI master initiates one of the
                 following actions:
                 •    attempts to access the alternate PCI Interface
                 •    attempts to access processor bus memory
                 •    accesses PowerSpan II registers
                 This chapter describes only the first two conditions listed above. Transactions targeted for the
                 PowerSpan II’s 4 Kbytes of device control and status registers are discussed in “Register Access” on
                 page 235.
                 The operation of the PCI Target is described by dividing the PCI transaction into the following phases:
                 •    Address phase: This section discusses the decoding of PCI accesses.
                 •    Data phase: This section describes control of burst length and byte lane management.
                 •    Terminations: This section describes the terminations supported by the PowerSpan II, how they are
                      mapped from the destination port to the PCI Target, and exception handling.
2.2.1            Address Phase
                 The address phase deals with the decoding of PCI accesses.
2.2.1.1          Transaction Decoding
                 Transaction decoding on the PCI Target operates in both normal decode mode and Master-based
                 decode mode. Only memory and configuration cycles are decoded. I/O cycles are not decoded.
                 During normal decode mode, a PCI device monitors the Px_AD and Px_C/BE# lines to decode an
                 access to some programmed PCI physical address range — through positive decoding.
                 A PCI target image is defined as the range of PCI physical address space to decode a PCI transaction. A
                 PCI target image location and size is controlled using a Base Address field and in the “PCI Target Base
                 Address Register” on page 259, and a Block Size field in the “PCI-1 Target Image x Control Register”
                 on page 268.
                           Normal address decoding only applies to memory cycles.
Integrated Device Technology                                                                   PowerSpan II User Manual
www.idt.com                                                                                          80A1010_MA001_09


38                                                                                                         2. PCI Interface
              Table 4 illustrates the command encoding for PowerSpan II as PCI target.
              Table 4: Command Encoding for Transaction Type—PowerSpan II as PCI Target
                Px_C/BE#[3:0]            Transaction Type                           PowerSpan II Capable
                0000                     Interrupt Acknowledge                      No
                0001                     Special Cycle                              No
                0010                     I/O Read                                   No
                0011                     I/O Write                                  No
                0100                     Reserved                                   N/A
                0101                     Reserved                                   N/A
                0110                     Memory Read                                Yes
                0111                     Memory Write                               Yes
                1000                     Reserved                                   N/A
                1001                     Reserved                                   N/A
                1010                     Configuration Read                         Yes (Type 0 only)
                1011                     Configuration Write                        Yes (Type 0 only)
                1100                     Memory Read Multiple                       Yes
                1101                     Dual Address Cycle                         No
                1110                     Memory Read Line                           Yes
                1111                     Memory Write and Invalidate                Aliased to Memory Write
              The PCI target image decodes and claims PCI transactions and controls how these incoming PCI
              transactions are mapped to the destination port on PowerSpan II.
              Table 5 describes the programming model for a PCI Target Image Control register.
              Table 5: Programming Model for PCI Target Image Control Register
                Bits            Type      Description                                         Default Setting
                IMG_EN          R/W       Enables the PCI target image to decode in the       Disabled
                                          specified physical address range of memory
                                          space.
                TA_EN           R/W       Enables address translation (see “PCI-1 Target      Disabled
                                          Image x Translation Address Register” on
                                          page 274).
PowerSpan II User Manual                                                                    Integrated Device Technology
80A1010_MA001_09                                                                                              www.idt.com


2. PCI Interface                                                                                                       39
                 Table 5: Programming Model for PCI Target Image Control Register
                  Bits         Type   Description                                         Default Setting
                  BAR_EN       R/W    Enables the PCI Base Address register. When this    Enabled or configurable
                                      bit is set, the Px_BSTx Register is R/W and visible through EEPROM
                                      to Processor Bus access and PCI memory cycles.
                                      When this bit is cleared, the Px_BSTx register
                                      returns only zeros on a read. Writes will have no
                                      effect on Px_BSTx when this bit is cleared.
                  BS[3:0]      R/W    Sets the block size of the PCI target image. The    Default value is 0, can be
                                      size of the image is 64Kbyte * 2BS.                 programmed through any
                                                                                          port after reset or loaded
                                                                                          through EEPROM.
                  MODE         R/W    Maps the incoming PCI transaction to either         Default value is 0 (Memory
                                      memory or I/O space on the alternate PCI bus.       command generation)
                  DEST         R/W    Directs the incoming PCI transaction to either the  Defaults to processor bus
                                      processor bus or the alternate PCI interface.
                  MEM_IO       R/W    Commands to the corresponding image generates       Default value is 0 (Regular
                                      Memory Read commands on the destination PCI         I/O mode)
                                      bus (Py) with the same byte enables latched from
                                      the source bus transaction PowerSpan II is
                                      capable of performing 1,2,3, or 4 byte memory
                                      transfers on the PCI bus(es).
                  RTT[4:0]     R/W    A 5-bit value, defined in the processor bus         Defaults to Read
                                      protocol, is generated on the PB_TT lines during a
                                      read on the processor bus.
                  GBL          R/W    Controls the assertion of the PB_GBL_ cache         Asserts PB_GBL_
                                      control signal.
                  CI_          R/W    Controls the assertion of the PB_CI_ cache          Asserts PB_CI_
                                      control signal.
                  WTT[4:0]     R/W    A 5-bit value, defined in the processor bus         Defaults to Write with Flush
                                      protocol, is generated on the PB_TT lines during a
                                      write on the processor bus.
                  PRKEEP       R/W    Enables PowerSpan II to keep prefetch read data                Disabled
                                      over subsequent transactions (see “Reads” on
                                      page 41).
                  END[1:0]     R/W    Sets endian mapping to little-endian, PowerPC          Big-endian is the default
                                      little-endian, or big-endian (see “Endian Mapping”               mode.
                                      on page 177).
Integrated Device Technology                                                                PowerSpan II User Manual
www.idt.com                                                                                        80A1010_MA001_09


40                                                                                                            2. PCI Interface
              Table 5: Programming Model for PCI Target Image Control Register
                Bits            Type       Description                                          Default Setting
                MRA             R/W        Aliases a Memory Read Command to Memory              Disabled
                                           Read Multiple Command. This causes PowerSpan
                                           II to prefetch read data on the destination bus
                                           (processor bus or PCI) up to the amount
                                           programmed in the RD_AMT[2:0] field.
                RD_AMT[2:0]     R/W        Controls the prefetch read amount for a Memory       8 bytes is the default
                                           Read when MRA is enabled. Memory Read                prefetch read amount
                                           Multiple always causes prefetch up to the value in
                                           RD_AMT[2:0]. This can be programmed up to a
                                           maximum of 128 bytes.
              Master-based Decode
              The PCI Target supports Master-based decode when the PowerSpan II PCI arbiter is enabled (see
              “Arbitration” on page 137). With Master-based decode enabled, a PCI target image only claims a
              transaction decoded for its specified physical address space if it originates from a specific PCI master.
              External bus masters are selected for a specific target image by setting the corresponding bits in the
              “PCI-1 Target Image x Translation Address Register” on page 274.
                         PowerSpan II behavior is undefined if more than one overlapping target image claims a
                         transaction. For example, if two target image have the same base address and size, then they
                         must have unique master bits set in the “PCI-1 Target Image x Translation Address Register”
                         on page 274.
2.2.1.2       Address Translation
              The address generated on the destination port is dependent on the use of address translation in the
              source target image. For more information, see the Translation Address Enable (TA_EN) bit in the
              “PCI-1 Target Image x Control Register” on page 268. When address translation is enabled — by
              setting the TA_EN bit— the address generated on the destination bus is derived from the following
              three inputs:
              •    incoming address on the PCI Target
              •    block size of the target image
                   BS[3:0] in the “PCI-1 Target Image x Control Register” on page 268
              •    translation address
                   TADDR in the “PCI-1 Target Image x Translation Address Register” on page 274
              When address translation is disabled the address on the destination bus is the same as the address on the
              source bus.
2.2.1.3       Transaction Type Mapping
              A transaction can be mapped to the PB interface or to another PCI Interface.
PowerSpan II User Manual                                                                      Integrated Device Technology
80A1010_MA001_09                                                                                                 www.idt.com


2. PCI Interface                                                                                                           41
                 Mapping to the Processor Interface
                 The PCI Target Image controls the transaction type on the processor bus through the use of the PB
                 Read Transfer Type (RTT[4:0]) and PB Write Transfer Type (WTT[4:0]) bits in the “PCI-1 Target
                 Image x Control Register” on page 268. By default, these bit fields assign reads as read operations on
                 the processor bus, and assign incoming writes as Write with Flush on the Processor Bus.
                 Mapping to a PCI Interface
                 The PCI Target Image determines the address space on the destination PCI bus through the use of the
                 Image Mode (MODE) bit in the “PCI-1 Target Image x Control Register” on page 268. By default,
                 incoming PCI transactions are mapped to Memory Space on the alternate PCI Interface. Setting the
                 MODE bit maps incoming PCI transactions to
                 I/O Space on the alternate PCI Interface.
2.2.1.4          Address Parity
                 The PCI target image monitors parity during the address phase of decoded transactions. Address parity
                 errors are reported on Px_SERR# when both the Parity Error Response (PERESP) and SERR Enable
                 (SERR_EN) bits are set in the “PCI-1 Control and Status Register.” on page 251. Assertion of the
                 Px_SERR# signal can be disabled by clearing the SERR_EN bit.
                 PowerSpan II records an error condition in the event of an address parity error (see “Error Handling”
                 on page 157). PowerSpan II claims the errored transaction and forwards the transaction to the
                 destination bus.
2.2.2            Data Phase
                 The data phase deals with control of burst length and byte lane management.
2.2.2.1          Writes
                 PowerSpan II accepts single beat or burst transactions in memory space. I/O accesses are not decoded.
                 All writes to the PCI Target are posted writes.
                 Burst writes are linear bursts. A Target-Disconnect is issued if a buffer fills while a burst write is in
                 progress (see “Termination Phase” on page 44). PowerSpan II can manage arbitrary PCI byte enable
                 combinations during PCI burst writes.
                           PowerSpan II does not support delayed write transactions as described in the PCI 2.2
                           Specification.
2.2.2.2          Reads
                 PowerSpan II supports up to four concurrent reads from external PCI masters. All four reads are treated
                 equally and have the same prefetch capacity, but have individually programmable values.
Integrated Device Technology                                                                      PowerSpan II User Manual
www.idt.com                                                                                            80A1010_MA001_09


42                                                                                                               2. PCI Interface
               An example of PowerSpan II’s concurrent read capability is illustrated in Figure 6. The concurrent
               reads in the figure are represented by Read A and Read B. In the figure, both Read A and Read B are
               retried. Once Read A is completed on the processor bus, Read B is initiated on the processor bus while
               the contents of Read A are returned to the PCI master. Because Read B is completed on the processor
               bus while Read A data is returned to the PCI bus, read latency is significantly reduced with concurrent
               reads.
               Figure 6: Concurrent Read Waveform
                             Device,
                             Arbitration and              Arbitration and
                             Memory Latency               Memory Latency
        Processor Bus                        PPC-RDA                           PPC-RDB
              PCI Bus     RET-A        RET-B   RET-A       RET-B         ACC-A        Completion-A  ACC-B       Completion-B
                                                  Single Read Latency
                                                                           Double Read Latency
               See “Concurrent Reads” on page 27 for a general discussion of read pipelining in PowerSpan II.
               Concurrent Read Phases
               The delayed, concurrent reads on the PCI Target consist of the following phases:
               1. Delayed Read Request
                          –   The PCI Target latches the transaction parameters and issues a retry.
               2. Delayed Read
                          –   The PCI Target obtains the requested data. The destination bus master retries requested
                              data.
               3. Delayed Read Completion
                          –   The master repeats the transaction with the same parameters used for the initial request
                              and data is provided by PowerSpan II.
               Read line buffers are allocated on a first come, first serve basis. When an external master makes the
               initial memory request, the PowerSpan II PCI Target captures the PCI address in an available delayed
               read request latch. This initiates a read on the destination bus specified by the Destination Bus (DEST)
               bit in the “PCI-1 Target Image x Control Register” on page 268.
               Prefetch Reads
               All PowerSpan II PCI target memory reads are considered prefetchable to 8-byte boundaries by
               default. Setting the MEM_IO bit in the “PCI-1 Target Image x Translation Address Register” on
               page 274 enables 1,2,3, or 4 byte memory reads on the PCI bus and 4 byte reads on the processor bus.
               When PowerSpan II is programmed to support 4 byte transactions, only 4 byte transactions are
               supported. Burst transactions are not supported while the MEM_IO bit is set to 1.
PowerSpan II User Manual                                                                           Integrated Device Technology
80A1010_MA001_09                                                                                                    www.idt.com


2. PCI Interface                                                                                                           43
                 In order to program PowerSpan II to complete 4 byte reads on the PCI bus, both the MEM_IO bit and
                 the MODE bit must be set to 1 in the PCI x Target Image x Control register.
                 In order to perform a 4-byte read from the PCI bus to the processor (60x) bus, the following bits must
                 be programmed:
                 •    MEM_IO bit set to 1
                 •    MODE bit set to 1 or 0
                 •    END bit, in the “PCI-1 Target Image x Control Register” on page 268, must not be set to
                      little-endian mode (00). It can be set to PowerPC little-endian (01), or big-endian (10).
                             When the Target Image Control register is programmed for 4 byte read transactions,
                             requesting 8 byte reads causes undefined results in the system.
                 PowerSpan II prefetch behavior on the destination bus when claiming Memory reads on the originating
                 bus is controlled by the PCI Memory Read Alias (MRA) bit and the Prefetch Size (RD_AMT[2:0])
                 field in the “PCI-1 Target Image x Control Register” on page 268. If the MRA bit is set when
                 PowerSpan II claims a memory read, PowerSpan II prefetches the amount programmed into the
                 RD_AMT[2:0] field — up to 128 bytes.
                 The Memory Read Line command results in a prefetch of the value programmed into Cache Line
                 (CLINE) bit. When the MRA bit is cleared, the target image prefetches 8 bytes when a PCI Memory
                 Read command is decoded.
                 The Memory Read Multiple command results in a prefetch read of a minimum of 32 bytes or the value
                 programmed into the RD_AMT[2:0] field— independent of the MRA bit setting.
                 The PowerSpan II PCI target read watermarks are defined in Table 6.
                 Table 6: PowerSpan II PCI Target Read Watermarks
                   PCI Command                                    Prefetch Amount
                   Memory Read                                    8 bytes (default) or 1,2,3, or 4 bytes
                                                                  Depending in the setting in the MEM_IO bit in
                                                                  the “PCI-1 Target Image x Control Register” on
                                                                  page 268
                   Memory Read Line                               Minimum of CLINE in the “PCI-1
                                                                  Miscellaneous 0 Register” on page 255
                                                                  register
                   Memory Read Multiple                           Minimum of 32 bytes or RD_AMT.
                 PowerSpan II never prefetches data beyond a 4-Kbyte address boundary regardless of the value
                 programmed in the RD_AMT field. This boundary corresponds to the processor bus memory
                 management page size.
Integrated Device Technology                                                                          PowerSpan II User Manual
www.idt.com                                                                                               80A1010_MA001_09


44                                                                                                      2. PCI Interface
              The PowerSpan II PCI Target can be configured to keep prefetch data over multiple read accesses for
              any master that provides the correct address — by setting the PRKEEP bit in the “PCI-1 Target Image
              x Control Register” on page 268. PowerSpan II increments its latched address for the read transaction
              based on the amount of data removed by the PCI master during the read transaction. If the PCI master
              returns with an address that matches the incremented address held by PowerSpan II, then PowerSpan II
              provides data already held in the prefetch line buffer.
                         Writes do not invalidate read buffer contents.
2.2.2.3       Data Parity
              PowerSpan II monitors Px_PAR#/Px_PAR64# when it accepts data as a PCI target during a write.
              PowerSpan II drives Px_PAR#/Px_PAR64# when it provides data as a PCI target during a read. In both
              cases, the Px_PAR#/Px_PAR64# signal provides even parity for Px_C/BE#[3:0] and Px_AD[31:0] —
              or Px_C/BE#[7:4] and Px_AD[63:32] for the PCI-1 Interface in 64-bit mode.
              The PERESP bit in the “PCI-1 Control and Status Register.” on page 251 determines whether or not
              PowerSpan II responds to parity errors as a PCI target. Data parity errors are reported through the
              assertion of Px_PERR# when the PERESP bit is set. The Detected Parity Error (D_PE) bit in the
              “PCI-1 Control and Status Register.” on page 251 is set when PowerSpan II encounters a parity error as
              a PCI target on any transaction. PowerSpan II records an error condition when a parity error occurs (see
              “Error Handling” on page 157).
2.2.3         Termination Phase
              This section describes the terminations supported by the PowerSpan II, how they are mapped from the
              destination port to the PCI Target, and exception handling.
2.2.3.1       PCI Target Terminations
              The PCI Target Interface generates the following terminations:
              1. Target-Disconnect (with data): A termination is requested by the PCI target — by asserting
                   Px_STOP# and Px_TRDY# — when it requires a new address phase. Target-Disconnect means the
                   transaction is terminated after one or more valid data transfers.
                   The PCI target requests a Target-Disconnect in the following cases:
                    •   PowerSpan II is unable to buffer an incoming write or provide data from a read buffer during a
                        read.
                    •   PowerSpan II reaches the 4-Kbyte address boundary on reads and writes to the processor bus.
                    •   One data phase for PowerSpan II register accesses
                    •   One data phase for I2O shell accesses
                    •   Detection of a transaction with non-linear addressing
PowerSpan II User Manual                                                                 Integrated Device Technology
80A1010_MA001_09                                                                                           www.idt.com


2. PCI Interface                                                                                                          45
                 2. Target-Retry: A termination is requested — by asserting Px_STOP# and Px_DEVSEL# while
                     Px_TRDY# is high — by the PCI Target because it cannot currently process the transaction. Retry
                     means the transaction is terminated after the address phase without any data transfer. PowerSpan II
                     retries read requests while it fetches data from the destination bus. Any attempt by a PCI master to
                     complete the memory read transaction is retried by the PCI target until at least an 8-byte quantity is
                     available in the line buffer. If a PCI master does not retry the transaction within 215 clocks after a
                     read request has been latched, the delayed read request latch and line buffer are de-allocated. This
                     prevents deadlock conditions.
                 3. Target-Abort: The PCI target requests a termination of a transaction — by negating Px_DEVSEL#
                     and Px_TRDY# and asserting Px_STOP# on the same clock edge — when it cannot respond to the
                     transaction, or during a fatal error. A fatal error occurs when: a bus error is experienced on the
                     processor bus, the maximum retry count is exceeded, a Target-Abort occurs on the alternate PCI
                     bus during a read, or a Master-Abort occurs on the alternate PCI bus during a read.
                     Although there may be a fatal error for the initiating application, the transaction completes
                     gracefully, ensuring normal PCI operation for other PCI resources. PowerSpan II sets the signaled
                     Target-Abort (S_TA) bit in the “PCI-1 Control and Status Register.” on page 251, and records an
                     error condition in the event of a Target-Abort (see “Error Handling” on page 157)
                 Error Logging and Interrupts
                 The PowerSpan II PCI Target records errors under the following conditions:
                 •   address parity error
                 •   data parity error on writes
                 •   Target-Abort
                 See “Error Handling” on page 157 and “Interrupt Handling” on page 145 for a full description of error
                 logging support and associated interrupt mapping options.
Integrated Device Technology                                                                     PowerSpan II User Manual
www.idt.com                                                                                            80A1010_MA001_09


46                                                                                                      2. PCI Interface
2.3           PCI Master Interface
              In order for PowerSpan II to be a PCI master in a transaction the Bus Master (BM) bit, in the “PCI-1
              Control and Status Register.” on page 251, must be set. With this bit set, PowerSpan II is PCI Master in
              a transaction in the following instances:
              •    Servicing a request by:
                    — the processor bus: PowerSpan II is accessed as a PB slave
                    — the alternate PCI Interface: PowerSpan II is accessed as a PCI target
              •    processing a transfer by one of the four PowerSpan II DMA channels
              •    generating a configuration or IACK cycle because of a PowerSpan II register access
              This section discusses only the first three conditions listed above. Configuration and IACK cycles are
              discussed in “Configuration and IACK Cycle Generation” on page 246.
              The operation of the PCI Master is described by dividing the PCI master transaction into the following
              phases:
              •    Arbitration phase: This section describes how PowerSpan II requests the PCI bus and its response
                   to bus parking.
              •    Address phase: This section discusses the generation of the PCI address and command encoding.
              •    Data phase: This section describes control of burst length.
              •    Terminations: This section explains the terminations supported by
                   PowerSpan II, how they are mapped to the source port (Processor Interface or the alternate PCI
                   Interface), and exception handling.
                         PowerSpan II cannot be both master and target on a PCI bus at the same time.
PowerSpan II User Manual                                                                  Integrated Device Technology
80A1010_MA001_09                                                                                           www.idt.com


2. PCI Interface                                                                                                        47
2.3.1            Arbitration Phase: Arbitration for the PCI Bus
                 PowerSpan II issues a bus request on the PCI bus when it requires access to the PCI bus. When the
                 PowerSpan II PCI arbiter is active, this request is internal. When it is not enabled the request appears
                 externally (see “PCI Interface Arbitration” on page 137 for more information).
                 The internal PowerSpan II PCI arbiter parks the bus on a PCI master by asserting Px_GNT# to the PCI
                 master. Bus parking improves the performance of the PowerSpan II PCI Master by reducing arbitration
                 latency.
2.3.2            Address Phase
                 The address phase deals with the generation of the PCI address and command encoding.
2.3.2.1          Command Encoding
                 The encoding on the Px_C/BE# lines indicate the transaction type on the PCI bus. The PCI command
                 encoding supported by PowerSpan II, and their corresponding transaction types, are shown in Table 7.
Integrated Device Technology                                                                     PowerSpan II User Manual
www.idt.com                                                                                            80A1010_MA001_09


48                                                                                                       2. PCI Interface
              Table 7: Command Encoding for Transaction Type (PowerSpan II as PCI Master)
                Px_C/BE# [3:0]                Transaction Type             PowerSpan II Capable
                0000                          Interrupt Acknowledge        Yes (see “Configuration and IACK
                                                                           Cycle Generation” on page 246)
                0001                          Special Cycle                No
                0010                          I/O Read                     Yes
                0011                          I/O Write                    Yes
                0100                          Reserved                     N/A
                0101                          Reserved                     N/A
                0110                          Memory Read                  Yes
                0111                          Memory Write                 Yes
                1000                          Reserved                     N/A
                1001                          Reserved                     N/A
                1010                          Configuration Read           Yes (see “Configuration and IACK
                                                                           Cycle Generation” on page 246)
                1011                          Configuration Write          Yes (see “Configuration and IACK
                                                                           Cycle Generation” on page 246)
                1100                          Memory Read Multiple         Yes
                1101                          Dual Address Cycle           No
                1110                          Memory Read Line             Yes
                1111                          Memory Write and Invalidate  No
                                              (The MWI_EN bit is
                                              hard-wired to “0” in the
                                              “PCI-1 Control and Status
                                              Register.” on page 251)
              A new request for access to the bus is generated by the PowerSpan II PCI Master when it requires
              access to the PCI bus to service a request from the Processor Bus Interface or the other PCI interface
              (Py). After the request is generated by PowerSpan II, it successfully arbitrates for access to the PCI bus
              when it receives GNT_ from the arbiter. PowerSpan II then asserts Px_FRAME# to indicate the
              beginning of a transaction.
PowerSpan II User Manual                                                                  Integrated Device Technology
80A1010_MA001_09                                                                                            www.idt.com


2. PCI Interface                                                                                                     49
2.3.2.2          Address Translation
                 The address generated by the PCI Master is dependent on the use of address translation in the source
                 target image (see “PCI-1 Target Image x Control Register” on page 268) or slave image (see
                 “Processor Bus Slave Image x Control Register” on page 287). When address translation is enabled —
                 by setting the TA_EN bit in PCI Target or PB Slave Image Control Register — PowerSpan II produces
                 the PCI address using the following inputs:
                 •   the incoming address from the source bus
                 •   the block size of the slave or target image
                 •   the translation offset
                 For address translation going from the processor bus to PCI, see “Processor Bus Interface” on page 83.
                 For an example of address translation control going from PCI to PCI, see “PCI-1 Target Image x
                 Translation Address Register” on page 274.
                 When address translation is disabled, the address generated by the PCI Master is the same as the
                 address on the source bus.
Integrated Device Technology                                                                  PowerSpan II User Manual
www.idt.com                                                                                        80A1010_MA001_09


50                                                                                                          2. PCI Interface
2.3.3         Data Phase
              The data phase deals with the control of burst length.
2.3.3.1       Writes
              For non-DMA writes, the length of the PCI write transaction is dependent on the length of the
              transaction delivered from the source bus. Writes originating from the processor bus can be either
              single cycle writes or burst writes. Burst writes from the processor bus are always 32 bytes in length.
              This burst is converted to an 8 byte burst on a 32-bit PCI bus. Either PCI-1 or PCI-2 can be configured
              as 32-bit. Single cycle writes from the 64-bit processor bus are translated into two 8 byte burst writes
              on the 32-bit PCI bus. This information is summarized in Table 8
              Table 8: PB Writes and Their Corresponding PCI Writes
                PB Write                         64-bit PCI Write                 32-bit PCI Write
                32-byte Line Write               4-beat 32-byte Burst Write       8-beat 32-byte Burst Write
                8-byte Single Write              Single Beat 8-byte Write         2-beat 8-byte Burst Write
              The PB Master can also generate extended cycles. Extended cycles are either 16 byte or 24 byte
              transactions. These cycles are enabled by setting the Extended Cycle (EXTCYC) bit to 1 in the
              “Processor Bus Miscellaneous Control and Status Register” on page 304.
              When the Dual PCI PowerSpan II is used, incoming PCI writes are executed as similar writes on the
              alternate PCI interface. For example, a 64-byte burst write to memory space from the PCI-1bus is
              executed as a 64-byte burst write to the memory space on the PCI-2 bus, provided the target on PCI-2
              does not disconnect.
                             Write transactions intended for I/O space on the alternate PCI bus must be single
                             beat writes. Bursting is not supported for a target image programmed to generate
                             an I/O access on the alternate PCI bus. A burst write directed at such a target
                             image results in a Target-Disconnect after every data beat.
              DMA Writes
              The PowerSpan II DMA channels always attempt to perform the longest possible burst — up to
              128-bytes — on the PCI bus.
2.3.3.2       Reads
              The minimum memory read prefetch quantity is 8 bytes (default). Setting the MEM_IO bit in the
              “PCI-1 Target Image x Control Register” on page 268 enables 1,2,3, or 4 byte memory reads on the
              PCI bus.
PowerSpan II User Manual                                                                    Integrated Device Technology
80A1010_MA001_09                                                                                               www.idt.com


2. PCI Interface                                                                                                         51
                 The PowerSpan II PCI Master generates a Memory Read command selection according to the rules in
                 Table 9.
                 Table 9: PowerSpan II PCI Master Read Commands
                   Internal Request of Transaction     PCI Memory Read Command
                   Length
                   <= 8 bytes                          Memory Read
                   <= CLINE[7:0] in Px_MISC0           Memory Read Line
                   > CLINE[7:0] in Px_MISC0            Memory Read Multiple
                 The read amount presented to the PCI Master determines the command used. A Memory Read Line
                 command uses the burst length programmed into the CLINE[7:0] field in the “PCI-1 Miscellaneous 0
                 Register” on page 255. It is programmable to 16-, 32-, 64-, or 128 bytes.
                             If the PCI Master does not complete the burst read transaction before a target termination, it
                             completes the read with subsequent PCI read transactions at the appropriate address.
2.3.3.3          Parity Monitoring and Generation
                 PowerSpan II monitors Px_PAR#/Px_PAR64# when it accepts data as a PCI master during a read, and
                 drives Px_PAR#/Px_PAR64# when it provides data as a PCI master during a write. PowerSpan II also
                 drives Px_PAR#/Px_PAR64# during the address phase of a transaction when it is a PCI master. In both
                 address and data phases, the Px_PAR#/Px_PAR64# signal provides even parity for Px_C/BE#[3:0] and
                 Px_AD[31:0]. Even parity is enabled Px_C/BE#[7:4] and Px_AD[63:32] for PCI-1 in 64-bit mode.
                 PowerSpan II parity response is enabled through the Parity Error Response (PERESP) bit in the “PCI-1
                 Control and Status Register.” on page 251. Data parity errors are reported through the assertion of
                 Px_PERR# when the PERESP bit is set. The Detected Parity Error (D_PE) bit in the “PCI-1 Control
                 and Status Register.” on page 251 is set when PowerSpan II encounters a parity error as a PCI master
                 on any transaction. PowerSpan II records an error condition in the event of a parity error (see “Error
                 Handling” on page 157).
                 The Master Data Parity Detected (MDP_D) bit in the “PCI-1 Control and Status Register.” on page 251
                 is set if the PERESP bit is enabled and either PowerSpan II is the master of the transaction where it
                 asserts PERR#, or the addressed target asserts PERR#. If the transfer originated from the Processor
                 Interface, then PowerSpan II sets the MDP_D bit and the Px_PB_ERR_EN bit in the “Interrupt Enable
                 Register 1” on page 334. PowerSpan II then asserts an interrupt (see “Interrupt Handling” on
                 page 145).
                             PowerSpan II continues with the transaction independent of any parity errors reported during
                             the transaction.
Integrated Device Technology                                                                    PowerSpan II User Manual
www.idt.com                                                                                           80A1010_MA001_09


52                                                                                                         2. PCI Interface
2.3.4         Terminations
              This section describes the terminations supported by the PowerSpan II, how they are mapped from the
              destination port to the PCI Target, and exception handling.
2.3.4.1       PCI Master Terminations
              The PCI Master supports all four types of PCI terminations:
              1. Master-Abort: The PCI Master negates Px_FRAME# and then negates Px_IRDY# on the
                   following clock edge when no target responds with Px_DEVSEL# asserted on the fifth positive
                   edge of clock after Px_FRAME# is asserted. PowerSpan II sets R_MA in Px_CSR and records an
                   error condition in the event of a Master-Abort (see “Error Handling” on page 157)
              2. Target-Disconnect (with data): A termination is requested by the target — by asserting Px_STOP,
                   Px_DEVSEL# and Px_TRDY# — because it is unable to respond within the latency requirements
                   of the PCI 2.2 Specification or it requires a new address phase. Target-Disconnect means the
                   transaction is terminated after data is transferred. PowerSpan II negates Px_REQ# for at least two
                   clock cycles if it receives Px_STOP# from the PCI target.
              3. Target-Retry: Termination is requested — by asserting Px_STOP# and Px_DEVSEL# while
                   Px_TRDY# is high — by the target because it cannot currently process the transaction. Retry
                   means the transaction is terminated after the address phase without data transfer. PowerSpan II has
                   a Maximum Retry Counter (MAX_RETRY) in the “PCI-1 Miscellaneous Control and Status
                   Register” on page 283 which is used to record an error condition if the number of retries exceed the
                   programmed amount (see “Error Handling” on page 157).
              4. Target-Abort: The target requests a termination of a transaction — by negating Px_DEVSEL# and
                   asserting Px_STOP# on the same clock edge — when it cannot respond to the transaction, or
                   during a fatal error. Although there may be a fatal error for the initiating application, the
                   transaction completes gracefully, ensuring normal PCI operation for other PCI resources.
                   PowerSpan II sets R_TA in Px_CSR and records an error condition in the event of a Target-abort
                   (see “Error Handling” on page 157).
2.3.4.2       Error Logging and Interrupts
              The PowerSpan II PCI Master records errors under the following conditions:
              •    Data Parity on reads (when the PERSP bit, in the “PCI-1 Control and Status Register.” on
                   page 251, is set)
              •    Master-Abort
              •    Target-Abort
              •    Expiration of Maximum Retry Counter (when the MAX_RETRY field, in the “PCI-1
                   Miscellaneous Control and Status Register” on page 283, is set.
              See “Error Handling” on page 157 and “Interrupt Handling” on page 145 for a full description of error
              logging support and associated interrupt mapping options.
PowerSpan II User Manual                                                                     Integrated Device Technology
80A1010_MA001_09                                                                                              www.idt.com


2. PCI Interface                                                                                                        53
2.4              CompactPCI Hot Swap Silicon Support
                 CompactPCI’s Hot Swap Specification defines the process for installing and removing adapter boards
                 without adversely affecting a running system. It provides a programmatic access to Hot Swap services.
                 This enables system re-configuration and fault recovery to take place with no system down time and
                 minimum operator interaction.
                 PowerSpan II is compliant with the CompactPCI’s Hot Swap Specification, Revision 2.0 and is a Hot
                 Swap Silicon device. Hot Swap Silicon support includes the following:
                 •   Open drain output pin ENUM# is used to indicate Hot Swap insertion and extraction events.
                 •   5V tolerant input pin ES for sensing the state of the ejector switch used to insert or extract a
                     CompactPCI board.
                 •   5V tolerant open drain output pin LED# for controlling the blue Light Emitting (LED) required to
                     indicate status of the software connection process.
                 For the different levels of Hot Swap support, refer to the CompactPCI Hot Swap Specification.
                 To simplify the design of CompactPCI Hot Swap adapter cards, PowerSpan II has additional support.
                 This support includes:
                 •   A 5V tolerant input pin HEALTHY# for sensing the status of the Back End power on the card.
                 •   An input pin P1_64EN# that enables Hot Swap adapter cards to sense the presence of a 64-bit PCI
                     backplane.
2.4.1            LED Support
                 The LED can be controlled by hardware and software. PowerSpan II drives the LED# signal low to
                 turn on the LED during the Physical and Hardware Connection process (when HEALTHY# is
                 negated). A blue LED with an internal resistor can be directly connected between the 5V rail and the
                 LED# signal. Software controls the LED by setting the LED On/Off (LOO) bit in the “PCI-1 Compact
                 PCI Hot Swap Control and Status Register” on page 264.
2.4.2            ES Input
                 The CompactPCI Hot Swap Specification defines a switch located in the ejector handle that indicates to
                 PowerSpan II if the ejector handle is open or closed. A low value on ES input indicates that the ejector
                 latch is open. A high value on ES indicates that the ejector latch is closed and is in operation mode.
2.4.3            HEALTHY# Signal
                 PowerSpan II manages the electrical board level issues involved in the Hot Swap process with the
                 HEALTHY# signal. The negation of HEALTHY# indicates only some of the components on the Hot
                 Swap card are powered. To operate in this environment and minimize long term reliability issues, the
                 HEALTHY# signal controls the electrical behavior of PowerSpan II I/O buffers.
Integrated Device Technology                                                                    PowerSpan II User Manual
www.idt.com                                                                                            80A1010_MA001_09


54                                                                                                   2. PCI Interface
              During the negation of HEALTHY#, PowerSpan II disables its output and bidirectional pins (except for
              LED#) to avoid applying power to non-powered components on the card. The signals connected
              between PowerSpan II and these non-powered components result in floating pins on PowerSpan II.
              PowerSpan II uses HEALTHY# to inhibit the input receivers. An inhibited receiver has no static
              current path between supply and ground that could be activated by a voltage level near the switching
              point.
              See “Resets, Clocks and Power-up Options” on page 167 for more details on HEALTHY# and
              PowerSpan II reset.
2.4.4         CompactPCI Hot Swap Card Insertion and Extraction
              A CompactPCI board has a staggered pin arrangement (long/medium/short) to allow power and
              ground, signal and a Board Inserted Indicator (BD_SEL#) to be connected and disconnected in stages.
              A limited number of power and ground pins are long. The rest of the power, ground, and signal pins are
              of medium length. BD_SEL# is a short pin. When BD_SEL# connects, the physical connection process
              is complete.
2.4.4.1       CompactPCI Hot Swap Process
              A CompactPCI Hot Swap board is divided into two power regions: Early Power and Back End Power.
              Early Power is provided by the long pins on the CompactPCI connector. Back End Power is controlled
              by a sequencer on the card. The sequencer begins to power the Back End of the card when the short
              CompactPCI signal BD_SEL# engages on insertion, or when host software enables the process as in a
              High Availability system.
              In Figure 7, PowerSpan II is designed into a CompactPCI adapter card.
                        Figure 7 assumes the CompactPCI backplane is not in reset during the insertion and
                        extraction process. For example, PowerSpan II’s P1_RST# is negated.
PowerSpan II User Manual                                                               Integrated Device Technology
80A1010_MA001_09                                                                                        www.idt.com


Integrated Device Technology
                                                                                                                                                                                                                                                                                                                                                                                                                          2. PCI Interface
                                                                                                                                                                                                    Early Power                                                                                       Back End Power
                                                                                                                                                                          5V
                                                                                                                                                                                                                                                5V                          5V
www.idt.com
                                                                                                                                                        Long Pins         3.3 V
                                                                                                                                                                                                                                                3.3 V                      3.3 V
                                                                                                                                                                          VIO
                                                                                                                                                                                                                                                           Hot Swap
                                                                                                                                                                                                                                                        Supply Sequencer
                                                                                                                                                                          BD_SEL#                                                               ON_
                                                                                                                                                             Short Pins
                                                                                                                                                                                                                                                                                   Power On   Oscillator               Regulator
                                                                                                                                                                                                                                                                                    Reset
                                                                                                                                                                                      Vp                     Regulator                          HEALTHY#
                                                                                                                                                                                            Precharge                                                         GND
                                                                                                                                                                                Rp
                                                                                                                                                                           GND
                                                                                                                                                        Long Pins
                                                                                                                                                                                       Rp
                                                                                                                                                                                                            3.3v    2.5v                                                                                     3.3 V           2.0 V
                                                                                                                                                                                                                                 PO_RST_
                                                                                                                                                                                                  HEALTHY#                                                                                                 PORESET_
                                                                                                                                                                                                                              PB_RST_DIR
                                                                                                                                                                                                  P1_RST_DIR
                                                                                                                                                                                                                                  PB_RST_                                                                  HRESET_
                                                                                                                                                                                                  P1_RST#                                                                                                               Host Processor
                                                                                                                                                                                                                                   PB_CLK                                                                  CLKIN
                                                                                                                                                                                                  ENUM#
                                                                                                                                                             Medium                                                                                                                                        "remaining I/O"
                                                                                                                                                                                                                           "remaining PB I/O"
                               Ensure that PB_CLK and P2_CLK are within specification before the release of back-end
                                                                                                                                                              Pins
                                                                                                                                                                                                  "remaining PCI-1 I/O"
                                                                                                                                                                                                               PowerSpan II                                                                                                  GND
                                                                                                                                                                                                  P1_64EN#
                                                                                                                                                                                     5V                                                                                                                                                                    3.3 V
                                                                                                                                                                                                                              P2_RST_DIR
                                                                                                                       Compact PCI PCI-1/J1 Connector
                                                                                                                                                                                                                                 P2_RST#                                                                                                 RST#
                                                                                                                                                                                                                                   P2_CLK                                                                                                CLK        Secondary PCI
                                                                                                                                                                                                                                                                                                                                                                    Figure 7: PowerSpan II in a CompactPCI Adapter Card
                                                                                                                                                                                                  LED#
                                                                                                                                                                                                                      "remaining PCI-2 I/O"                                                                                              "remaining I/O"
                                                                                                                                                                                                  ES
                                                                                                                                                                                                                                                                                                                                                           GND
                                                                                                                                                                                                                   GND
                                                                                                                                                                           GND
                                                                                                                                                        Long Pins
                                                                                                                                                 Ejector/Switch
PowerSpan II User Manual
                               power-up reset.
                                                                                                                                                                                                                                                                                                                                                                                                                          55
    80A1010_MA001_09


56                                                                                                      2. PCI Interface
2.4.5         Hot Swap Insertion Process
              Use the application illustrated in Figure 7 as a point of reference in the Hot Swap insertion process
              outlined below.
              1. Long pins contact for Early Power:
                   — HEALTHY# negated
                        –   PowerSpan II resources are in reset
                        –   LED# pin enabled, status diode turned on
                        –   PowerSpan II output pins disabled, input pins inhibited
                   — Card’s PCI signals pre-charge
              2. Medium pins contact PCI backplane signals:
                   — PowerSpan II’s Primary PCI Interface, in this case PCI-1, connects to the PCI pins on the
                       backplane
                   — PowerSpan II P1_CLK is within specification
              3. Short pins contact, BD_SEL# asserted:
                   — Back End Power ramps
                   — Back End Power-up reset asserted
                        –   PowerSpan II PO_RST_ asserted
                        –   Host processor PORESET_ asserted, Host processor asserts HRESET_
                   — Clock generator begins oscillation
                        –   PowerSpan II PB_CLK and P2_CLK begin to oscillate
                   — Ejector switch closes sometime after short pins contact
              4. Back End power is within specification:
                   — HEALTHY# asserted
                        –   LED# pin disabled
                        –   PowerSpan II outputs enabled, PB_RST_ and P2_RST# asserted
                   — Host processor and Secondary PCI clocks are within specification
              5. Back End Power-up reset negation:
                   — PowerSpan II PLLs released from reset and begin to lock on to P1_CLK, PB_CLK, P2_CLK
PowerSpan II User Manual                                                                  Integrated Device Technology
80A1010_MA001_09                                                                                           www.idt.com


2. PCI Interface                                                                                                   57
                     — Host processor completes its configuration master transactions
                           –    PowerSpan II power-up options are loaded
                     — Host processor HRESET_ times out
                     — PowerSpan II PLL locking complete
                           –    All PowerSpan II resources out of reset, PB_RST_ and P2_RST# negated
                           –    PowerSpan II executes EEPROM load or waits to be initialized by the processor
                 6. PowerSpan II waits for the closed ejector switch and responds by:
                     — Setting INS bit in the HS_CSR register
                     — Asserting ENUM#
                 7. PowerSpan II is now able to accept Configuration cycles on PCI-1 from the CompactPCI Host
                 Since Px_LOCKOUT bit in the “PCI-1 Miscellaneous Control and Status Register” on page 283)
                 defaults to 1, PowerSpan II retries the Host Configuration accesses on the PCI-1 Interface until
                 Px_LOCKOUT is cleared. The Host then negates ENUM# by clearing the Insertion (INS) bit in the
                 “PCI-1 Compact PCI Hot Swap Control and Status Register” on page 264 and configures the card. The
                 Px_LOCKOUT bit is cleared by an EEPROM load or by access from the Processor Interface. It is
                 automatically cleared by PowerSpan II when the PWRUP_BOOT option is set to PCI.
Integrated Device Technology                                                                  PowerSpan II User Manual
www.idt.com                                                                                        80A1010_MA001_09


58                                                                                                                            2. PCI Interface
               Figure 8: Hot Swap Insertion
                             Long
                           Engage
                                        Med        Short       Fully         Back-End Powered    Clears               Ejector
                                      Engage      Engage      Seated         Board goes Healthy LOO bit               Latched
               Early Power
          Back End Power
                BD_SEL#              Pulled up
               HEALTHY#
                PCI RST#
                   (from J1)    pre-charge
                 PCI Clock      pre-charge                   Clocking
               PCI Signals      pre-charge          Engaged, tracking bus
              Ejector State                                         Open                                                       Closed
                  ENUM#         pre-charge
                       LED             LED on                                                             LED off
                    INS bit                                        Cleared/Unarmed                     Cleared/Armed                    Set
                     EXT bit                                       Cleared/Unarmed                                Cleared/Unarmed
                                         Physical Connection                Hardware Connection         Start of Software Connection Process
2.4.6          Hot Swap Extraction Process
               Use the application illustrated in Figure 7 as a point of reference in the Hot Swap extraction process
               outlined below.
               1. Ejector switch opens
                       — The Extraction (EXT) bit in the P1_HS_CSR register is set, causing the assertion of ENUM#
               2. Compact PCI Host:
                       — Reads the P1_HS_CSR of each agent to determine which card is being extracted
                       — Clears the PowerSpan II EXT bit. This causes the negation of ENUM# and arms the INS bit
                       — Places the card in a software dormant state
                       — Sets the LED On/Off (LOO) bit in the P1_HS_CSR register. This causes the assertion of
                             LED# which turns the light emitting diode to signal the operator
                              At this point the operator can close the ejector switch and reenter the insertion process.
               3. Operator begins extracting the card.
PowerSpan II User Manual                                                                                   Integrated Device Technology
80A1010_MA001_09                                                                                                                 www.idt.com


2. PCI Interface                                                                                                                                 59
                 4. Short pins break, BD_SEL# is negated
                         — Back End power goes out of specification
                         — HEALTHY# negated
                                –     All PowerSpan II resources reset
                                –     LED# pin enabled, status diode turned on
                                –     PowerSpan II output pins disabled, input pins inhibited
                         — PCI pre-charge reapplied
                 5. Medium pins break.
                 6. Long pins break.
                 Figure 9: Hot Swap Extraction
                                             Ejector             SW Clear            SW Set           Withdrawal      Short      Med.       Long
                                          Unlatched                EXT bit           LOO bit             Starts    disengage  disengage disengage
                  Early Power
              Back End Power
                   BD_SEL#                                                                                                    Pulled up
                  HEALTHY#
                   PCI RST#        (from J1)
                                                                                                                                   pre-charge
                    PCI Clock                                   Clocking                                                           pre-charge
                  PCI Signals                             Engaged, tracking bus                                                    pre-charge
                 Ejector State     Closed              Open
                     ENUM#                                                                                                          pre-charge
                          LED            LED off                                         LED on
                       INS bit            Cleared/Unarmed                       Cleared/Armed
                        EXT bit   Cleared/Armed                Set              Cleared/Unarmed
                                                    Software Connection                        Hardware Connection           Physical Connection
                                After the status LED# is illuminated by the host, the operator can close the ejector switch,
                                rather than extracting the card. If the closure or the extraction occurs, a PowerSpan II register
                                reload from EEPROM does not occur.
Integrated Device Technology                                                                                         PowerSpan II User Manual
www.idt.com                                                                                                                 80A1010_MA001_09


60                                                                                                     2. PCI Interface
2.5           Vital Product Data
              Vital Product Data (VPD) is information which uniquely defines items of a system. These items
              include the hardware, software and microcode elements of a system. VPD also provides a mechanism
              for storing information, such as performance data on a device. VPD resides in a local storage device.
              PowerSpan II supports VPD through the I2C Interface to serial EEPROM. The Vital Product Data
              Extended Capabilities Pointer and supporting registers reside in the configuration space of the
              PowerSpan II Primary PCI Interface. The VPD feature requires the VPD_EN bit, in the “Miscellaneous
              Control and Status Register” on page 318, to be set and an available external EEPROM.
2.5.1         VPD Access
              VPD accesses through PowerSpan II default to the I2C serial EEPROM device zero (VPD EEPROM
              Chip Select (VPD_CS) = 0b000 in the “Miscellaneous Control and Status Register” on page 318). This
              is also used for EEPROM loading of the registers after reset. Since the lower bytes in the EEPROM
              contain data for setting up PowerSpan II before software initialization, the lower portion of the
              EEPROM (the first 64 bytes) are not visible through the VPD registers. The upper 192 bytes of the 256
              byte EEPROM are visible through the VPD registers. Of these bytes, the first 64 bytes are VPD-Read
              Only and the remaining 128 bytes are VPD-Read/Write. When VPD_CS = 0b000, VPD addresses are
              translated upward by 64 bytes before being presented to the EEPROM.
              PowerSpan II can be programmed with an alternate chip select for VPD access if more than the 192
              accessible bytes is required. Programming of the I2C chip select is done in the PowerSpan II
              “Miscellaneous Control and Status Register” on page 318. If an alternate I2C chip select is used then
              the first 64 bytes of the VPD EEPROM is designated as VPD-Read Only and the upper 192 bytes are
              designated as VPD-Read/Write.
              The VPD access to the EEPROM is similar to the EEPROM access implemented in PowerSpan II
              through the I2C_CSR register, except that it uses the “PCI-1 Vital Product Data Capability Register”
              on page 266 and the “PCI-1 Vital Product Data Register” on page 267. Since they both access the same
              resource, a PowerSpan II semaphore register SEMAx must be used to acquire exclusive access of the
              I2C Interface before software initiates VPD accesses.
2.5.2         Reading VPD Data
              PowerSpan II implements 8-bits of address for accessing the EEPROM up to a maximum of 256 bytes.
              The VPD address must be DWORD-aligned. A single read access reads four consecutive bytes starting
              from the VPD address from the EEPROM. If I2C chip select zero is used for VPD, then 192 bytes
              (address 0x00-BF) of VPD are accessible through the VPD read. Using another I2C chip select, the
              VPD Read can access the entire 256-byte EEPROM address range.
PowerSpan II User Manual                                                                 Integrated Device Technology
80A1010_MA001_09                                                                                          www.idt.com


2. PCI Interface                                                                                                          61
                 During a read access, the VPD Address (VPDA) field and the VPD Flag (F) bit are written in the
                 “PCI-1 Vital Product Data Register” on page 267. The F bit must be set to 0 to indicate a VPD read
                 access. PowerSpan II sets the F bit to 1 when it completes reading the 4 bytes from the EEPROM. The
                 F bit must be polled to determine when the read is complete. Byte 0 (bits 7 through 0) of the “PCI-1
                 Vital Product Data Register” on page 267 contains the data referenced by the VPD Address — bytes 1
                 through 3 contain the successive bytes.
                            If the Px_VPDD register or the I2C_CSR register is written to prior to the flag bit being set to
                            1, the results of the original read operation are unpredictable.
2.5.3            Writing VPD Data
                 A write can only occur to the upper 128 bytes of the EEPROM or, potentially, the upper 192 bytes if
                 I2C chip select is non-zero. Similar to the read operation, the write operation always writes four
                 consecutive bytes starting from the VPD address to the EEPROM.
                 The “PCI-1 Vital Product Data Register” on page 267 is written with the 4 bytes of data. Byte 0
                 (register bits 7 - 0) contains the data to be written to the location referenced by the VPD Address. Bytes
                 1-3 contain the data for the successive bytes. The VPDA field and the F bit is then written. The F bit
                 must be set to 1 to indicate a VPD write. The F bit is polled to determine when the write to the
                 EEPROM is completed. PowerSpan II sets the F bit to 0 when the write is completed.
                 When a write is attempted to the lower 64 bytes of the VPD area of the EEPROM, PowerSpan II does
                 not perform the write operation and clears the F bit.
                            The Px_VPDD or I2C_CSR register must not be written while a write operation is occurring.
Integrated Device Technology                                                                       PowerSpan II User Manual
www.idt.com                                                                                              80A1010_MA001_09


62                                                                                                      2. PCI Interface
2.6           I2O Shell Interface
              PowerSpan II provides portions of the I2O Shell Interface for the platform it is connecting to the
              Primary PCI bus. The I2O Shell Interface defined in the I2O 2.0 Specification is comprised of three
              main sections:
              •    messaging interface
              •    protocol for exchanging messages
              •    executive class messages
              PowerSpan II implements the I2O messaging interface and, in conjunction with the Input/Output
              Processor (IOP), enables the message passing protocol.
2.6.1         I2O Target Image
              There are three registers which enable Memory access to the I2O Shell Interface and local IOP
              Message Frames. The supporting registers include the following:
              •    “PCI-1 I2O Target Image Base Address Register” on page 257
              •    “PCI I2O Target Image Control Register” on page 352
              •    “PCI I2O Target Image Translation Address Register” on page 356
                         The I2O target image does not support Master-Based Decode.
              The I2O Shell Interface consists of Inbound and Outbound Queues and supporting I2O Host interrupt
              registers. The queues contain Message Frame Addresses (MFAs). These MFAs specify the starting
              address of Message Frames relative to the base address of the memory window in PowerPC memory.
              PowerSpan II implements I2O support with the first Memory Base Address Register in PCI
              configuration space.
              The I2O target image is divided into an I2O Shell Interface and a processor bus memory window
              intended for IOP Message Frame accesses. The I2O Shell Interface is accessed through the lower 4
              Kbytes of the I2O target image. I2O Shell Interface accesses are limited to 32-bit single data phase PCI
              transactions. Accesses through the I2O target image memory window to IOP Message Frames are
              burstable up to 64-bits wide for PCI-1, but limited to 32-bit wide for PCI-2.
              PowerSpan II does not support posting of more than one write transaction to the Inbound or Outbound
              Queue. Attempts to write to the Inbound or Outbound Queue are retried until the currently active write
              completes on the Processor Bus Interface.
PowerSpan II User Manual                                                                 Integrated Device Technology
80A1010_MA001_09                                                                                           www.idt.com


2. PCI Interface                                                                                                    63
2.6.2            IOP Functionality
                 A number of configuration steps are required before PowerSpan II and the embedded processor bus are
                 enabled to provide IOP functionality. The following example assumes PCI-1 is the Primary PCI
                 Interface.
                 The steps required to implement IOP functionality are listed below.
                 1. In order to identify PowerSpan II as an I2O Controller the “PCI-1 Class Register” on page 254
                     must be programmed as follows:
                      — Base Class Code (BASE) = 0x0E
                      — Sub Class Code (SUB) = 0x00
                      — Programming Interface (PROG) = 0x01
                              Programming values other than the ones listed above do not affect the behavior
                              of PowerSpan II as an I2O device.
                 2. The Inbound and Outbound Queues’ location and size in IOP memory must be programmed in
                     PowerSpan II. This is accomplished by programming the “I2O Queue Base Address Register” on
                     page 360:
                      — Processor Bus I2O Base Address (PB_I2O_BS): specifies base address of the Queues
                      — FIFO Size (FIFO_SIZE): specifies the size of the Queues
                 3. The PCI I2O target image must be configured to claim I2O Shell and Message Frame accesses from
                     PCI. The following registers must be programmed:
                      — Configure I2O image size with the Block size (BS) bit in “PCI I2O Target Image Control
                          Register” on page 352 (PCI_TI2O_CTL).
                      — Enable Base Address Register (BAR) visibility in configuration space.
                            –  Set BAR_EN in the PCI_TI2O_CTL register.
                      — Program PCI Base Address Register “PCI-1 I2O Target Image Base Address Register” on
                          page 257.
                            –  Set Image Enable (IMG_EN) in “PCI I2O Target Image Control Register” on page 352 to
                               enable decode. Note that this occurs if a non-zero value is written to the PCI Base
                               Address Register.
                      — Configure Processor Bus Master transaction parameters.
                            –  Write Transfer Type (WTT) in the PCI_TI2O_CTL register.
                            –  Read Transfer Type (RTT) in the PCI_TI2O_CTL register.
                            –  Global Command (GBL) in the PCI_TI2O_CTL register.
                            –  Cache Inhibit (CI) in the PCI_TI2O_CTL register.
                      — Select endian conversion mechanism with the Endian Conversion (END) bit in the
                          PCI_TI2O_CTL register
Integrated Device Technology                                                                   PowerSpan II User Manual
www.idt.com                                                                                          80A1010_MA001_09


64                                                                                                       2. PCI Interface
                    — Configure address translation
                         –    Translation Address Enable (TA_EN) bit in the PCI_TI2O_CTL register.
                         –    Translation Address (TADDR) in the “PCI I2O Target Image Translation Address
                              Register” on page 356 (PCI_TI2O_TADDR)
                    — Enable decode in PCI memory space.
                         –    Set memory Space (MS) bit in the “PCI-1 Control and Status Register.” on page 251.
                   At this stage, the I2O image is defined but all accesses to the PCI I2O target image are retried.
              4. The IOP is required to initialize all Top and Bottom Pointer registers and initialize all the MFAs in
                   the Inbound Free List FIFO. At this point, the IOP enables PCI accesses with the following step:
                    — Set the I2O Enable (I2O_EN) bit in the “I2O Control and Status Register” on page 357.
2.6.3         Messaging Interface
              The I2O 2.0 Specification defines a mechanism for connecting an I/O Platform (IOP) to an I2O system
              through a memory-based system, such as PCI, which has no inherent message passing capability. An
              IOP which is connected to a memory-based system is said to be locally attached. The PowerSpan II
              implements four I2O defined memory mapped registers on PCI to enable the physical and logical
              connection of the IOP to the system. Two of these memory-mapped registers provide the interface for
              the external Host platform and other IOPs to exchange messages with the local IOP sitting behind the
              PowerSpan II. These two registers are the Inbound Queue and Outbound Queue interfaces. The other
              two registers are used as I2O specific Interrupt Status and Enable registers for the local IOP to signal
              the Host platform. Additional PowerSpan II specific registers are implemented to support the
              messaging interface.
2.6.3.1       Inbound Queue
              The I2O Inbound Queue register is the messaging interface used by the Host or external IOP to post
              messages to the local IOP.
              The I20 Inbound Queue Register Interface is located at offset 0x040 of the PowerSpan II PCI I20 target
              image in PCI Memory space. The Inbound Queue has a Free List FIFO and a Post List FIFO, both of
              which reside in the IOP local memory.
2.6.3.2       Inbound Free List FIFO and Post List FIFO
              The Free List contains the Message Frame Address (MFAs) of Message Frames (MFs) in the IOP’s
              local memory, which are available to the Host or other IOPs for writing inbound messages.
              The Post List contains the MFAs of MFs in the local IOPs memory which contain inbound messages
              for the IOP to process.
PowerSpan II User Manual                                                                  Integrated Device Technology
80A1010_MA001_09                                                                                            www.idt.com


2. PCI Interface                                                                                                       65
                 The Inbound MFAs are 32-bit offsets from the translated PowerSpan II I20 target image window base
                 address in local IOP memory. When the Host platform or an external IOP wishes to send a message to
                 the local IOP it must first obtain an MFA from the Inbound Free List. The external platform is then free
                 to place a message in the associated MF. The MFA is then placed into the Inbound Post List for the
                 Local IOP to process.
                            All I2O Inbound Queue MFAs must be offsets of greater than 4 Kbytes.
2.6.3.3          Outbound Queue
                 The Outbound Queue Register is the messaging interface used by the local IOP to post messages to the
                 Host. The I2O Outbound Queue Register Interface is located at offset 0x044 of the PowerSpan II PCI
                 I2O target image in PCI memory space. The Outbound Queue has a Free List FIFO and a Post List
                 FIFO, both of which reside in the IOP local memory. The Free List contains the Message Frame
                 Address (MFAs) of Message Frames (MFs) in the Host system memory, which are available to the
                 local IOP for writing outbound messages. Outbound MFAs are absolute addresses of a Message Frame
                 in Host memory. The Post List contains the MFAs of MFs in the Host system memory which contain
                 outbound messages for the Host to process. When the local IOP wishes to send a message to the Host
                 platform it must first obtain an MFA from the Outbound Free List. The local IOP is then free to place a
                 message in the associated MF. The MFA is then placed into the Outbound Post List for the Host to
                 process. All Outbound messages are targeted for the Host platform. If the local IOP wishes to send a
                 message to another IOP (peer-to-peer communication) it uses the external IOPs Inbound Queue to post
                 the Message.
2.6.3.4          Protocol for Exchanging Messages
                 PowerSpan II I2O Registers
                 The PowerSpan II PCI I2O Shell Interface implements the following I2O defined registers:
                 •    I2O Outbound Post List Interrupt Status Register
                 •    I2O Outbound Post List Interrupt Mask Register
                 •    I2O Inbound Queue
                 •    I2O Outbound Queue
                 •    I2O Host Outbound Index Register (used for Outbound Option)
                 In addition to the registers defined in the I2O 2.0 Specification, PowerSpan II implements a number of
                 registers to support the I2O message passing protocol of the Shell Interface.
                 •    PCI I2O Target Image Control Register (PCI_TI2O_ CTL)
                 •    PCI I2O Target Image Translation Address Register (PCI_TI2O_ TADDR)
                 •    I2O Queue Base Address Register (I20_ QUEUE_BS)
Integrated Device Technology                                                                   PowerSpan II User Manual
www.idt.com                                                                                          80A1010_MA001_09


66                                                                                                     2. PCI Interface
                    — Processor Bus I2O Base Address Field: Base Address of the block of IOP memory that
                       contains the four FIFOs (two Inbound and two Outbound). The Base Address alignment is 1
                       Mbyte.
                    — FIFO Size Field: Indicates the number of bytes required for each of the Inbound Queue and
                       Outbound Queue FIFOs implemented in local memory
              •    I2O Control and Status Register (I20_ CSR)
                    — Host Outbound Post List Size Field: Indicates the number of entries in the Host Outbound Post
                       List FIFO in Host memory, used for the Outbound Option.
                    — I2O Enable Field: Enables/Disables PowerSpan II I2O Interface
                        –   PowerSpan II Primary PCI target retries I2O accesses until enabled
                    — XI2O Enable Field: Enables/Disables PowerSpan II Outbound Option
                        –   IPL: Inbound Post List is set when the Inbound Post list FIFO is not empty
                        –   OFL: Outbound Free List is set when the Outbound Free List FIFO is not empty.
              •    Inbound Free List Bottom/Top/Top Increment Pointer Registers:
                   (IFL_BOT/IFL_TOP/IFL_TOP_INC)
                    — Manages the Inbound Free List circular FIFO implemented in local memory
              •    Inbound Post List Bottom/Bottom Increment/Top Pointer Registers:
                   (IPL_BOT/IPL_BOT_INC/IPL_TOP)
                    — Used to manage the Inbound Post List circular FIFO implemented in local memory
              •    Outbound Free List Bottom/Bottom Increment/Top Pointer Registers:
                   (OFL_BOT/IPL_BOT_INC/OFL_TOP)
                    — Used to manage the Outbound Free List circular FIFO implemented in local memory
              •    Outbound Post List Bottom/Top/Top Increment Pointer Registers:
                   (IPL_BOT/IPL_TOP_INC/IPL_TOP)
                    — Used to manage the Outbound Post List circular FIFO implemented in local memory
              •    IOP Outbound Index/Increment Registers: (IOP_OI/IOP_OI_INC)
                    — Used to manage the Host Outbound FIFO
              •    Host Outbound Index/Index Alias Registers: (HOST_OI/HOST_OIA)
                    — Used to manage the Host Outbound FIFO
              •    Host Outbound Index Offset Registers: (HOST_OIO)
                    — Determines offset of the I2O target image at which the Host Processor can access the I2O Host
                       Outbound Index Register
              Interactions between the IOP and Host platforms during the I2O message passing protocols are
              displayed in Figure 3.4. The solid lines indicate pointers which are maintained and incremented by the
              PowerSpan II. The dashed lines indicate pointers which are incremented by the IOP. The IOP writes
              one to increment to PowerSpan II increment register associated with the pointer.
PowerSpan II User Manual                                                                 Integrated Device Technology
80A1010_MA001_09                                                                                          www.idt.com


2. PCI Interface                                                                                                       67
                 Figure 10: PowerSpan II I2O Message Passing
                                                                                 Bottom Pointer
                                        Inbound Queue                            Top Pointer
                                                                                                            Inbound
                                        (0x040)
                                                                                                            Free List
                                                                                                            FIFO
                                                                                 Bottom Pointer
                                          Local                                  Top Pointer
                                                                                                             Inbound
                                          Processor (IOP)                                                    post List
                                                                                                             FIFO
                   PCI
                   Bus
                           Inbound Queue
                           Outbound Queue
                                                                                 Top Pointer
                                        Outbound Queue                           Bottom Pointer
                                        (0x044)                                                             Outbound
                                                                                                            Free List
                                                                                                            FIFO
                                                                                 Top Pointer
                                                                                 Bottom Pointer
                                          Local                                                             Outbound
                                          Processor (IOP)                                                   Post List
                                                                                                            FIFO
                 The Top and Bottom pointers manage external FIFOs to determine the full and/or empty status of the
                 FIFOs. After a FIFO write, the Top pointer is incremented. If the Top pointer then equals the Bottom
                 pointer, a FIFO full condition exists. After a FIFO read, the Bottom pointer is incremented. If the
                 Bottom pointer then equals the Top pointer, a FIFO empty condition exists.
Integrated Device Technology                                                                   PowerSpan II User Manual
www.idt.com                                                                                          80A1010_MA001_09


68                                                                                                      2. PCI Interface
2.6.4         Inbound Messages
              The Inbound Free and Post List FIFOs are implemented as circular queues using Bottom and Top
              pointers. The PowerSpan II implements the Bottom and Top pointers for the Inbound Free List FIFO
              and the Inbound Post List FIFO. The FIFOs reside in the local memory. The Inbound posted messages
              also reside in local processor memory.
              When the Host platform or external IOP wants to post a message to the local IOP, it must first acquire
              an MFA from the Inbound Free List. This is accomplished through a PCI read transaction to the
              PowerSpan II Inbound Queue Register at offset 0x040 of the I2O target image. PowerSpan II provides
              the next available MFA from the Inbound Free List FIFO pointed to by the Inbound Free List Bottom
              Pointer Register. PowerSpan II increments the Inbound Free List Bottom Pointer Register to point to
              the next entry of the FIFO. A read from the Inbound Queue Register when the Inbound Free List FIFO
              is empty (Bottom Pointer equal to Top pointer) returns 0xffff_ffff to the requesting PCI master.
              Once the Host or external IOP obtains an MFA, it is then to write a message to the IOP’s local MF at
              the address offset from the Px_BSI2O specified by the MFA. Once the message is transferred the Host
              or external IOP writes the MFA back to the same I2O target image offset (0x040). PowerSpan II
              accepts the write transaction on PCI and generate a write to the Inbound Post List FIFO at the local IOP
              memory address pointed to by the Inbound Post List Top Pointer Register. PowerSpan II then
              increments the Inbound Post List Top Pointer Register and asserts the I2O_IOP Interrupt Status bit in
              the ISR0 register to notify the local processor of MFAs in the Inbound Post list FIFO. The IPL bit in the
              “I2O Control and Status Register” on page 357 is set while the Inbound Post List FIFO is not empty,
              indicating that Inbound Message Frames need to be processed.
2.6.4.1       Local Processor Functions
              For Inbound Messaging, the local processor performs the following:
              •    detects the interrupt
              •    reads the PowerSpan II ISR0 Register
              •    determines the source of the interrupt through the I2O_IOP register
              •    clears the I2O_IOP interrupt (write 1 to clear)
              •    reads the Inbound Post List FIFO Bottom Pointer Register to access the Inbound Post List FIFO to
                   get the MFA
              •    increments the Inbound Post List Bottom Pointer Register by writing the Inbound Post List Bottom
                   Pointer Increment Register
              •    reads and processes the MF pointed to by the MFA
              •    writes the MFA back to the Top of the Inbound Free List FIFO
              •    writes to the PowerSpan II’s Inbound Free List Top Pointer Increment Register to increment the
                   address by four
              •    reads the IPL bit, in the I2O_CSR, to determine if the Inbound Post List is empty
              The interrupt can be masked, leaving it to the processor to poll the ISR Register. A read from the
              Inbound Post List Bottom Pointer Register by the IOP when the Inbound Post List FIFO is empty
              returns 0xffff_ffff to the processor if the EMTR field of the I2O_CSR register is set to one.
PowerSpan II User Manual                                                                  Integrated Device Technology
80A1010_MA001_09                                                                                           www.idt.com


2. PCI Interface                                                                                                      69
2.6.5            Outbound Messages
                 The Outbound Free and Post List FIFOs are implemented as circular queues using Bottom and Top
                 pointers. PowerSpan II implements the Bottom and Top pointers for the Outbound Free List FIFO and
                 the Outbound Post List FIFO.
                 When the local IOP wants to post a message to the Host, it must first acquire an MFA from the
                 Outbound Free List. The IOP reads the MFA pointed to by the Outbound Free List Bottom Pointer
                 Register. The processor then increments the Outbound Free List Bottom Pointer Register by four to
                 point to the next entry of the FIFO.
                 The IOP, having obtained a Host MFA, is then free to write a message through the PowerSpan II to the
                 Host MF at the Host memory address specified by the MFA. Once the message is transferred, the IOP
                 writes the MFA to the Outbound Post List FIFO at the address pointed to by the Outbound Post List
                 Top pointer maintained by PowerSpan II. The processor then increments the Outbound Post List Top
                 Pointer Register by four.
                 While the Outbound Post List FIFO is non-empty PowerSpan II sets an interrupt status bit in the
                 PowerSpan II I2O Outbound Post List Interrupt Status Register of the I2O target image (0x030). If the
                 Interrupt is not masked by the PowerSpan II Outbound Post List Interrupt Mask Register of the I2O
                 target image (0x034), PowerSpan II drives an interrupt to notify the Host processor of MFAs in the
                 Outbound Post list FIFO. PowerSpan II determines the Outbound Post List FIFO to be non-empty
                 when the Outbound Post List FIFO Bottom and Top pointers do not point to the same FIFO address.
2.6.5.1          Host Processor Functions
                 For Outbound Messaging, the host processor performs the following:
                 •   detects the interrupt.
                 •   reads the I2O Outbound Post List Interrupt Status Register (0x030).
                 •   reads the Outbound Queue Register at offset 0x044 of the PowerSpan II I2O target image map to
                     obtain the next Outbound Post List MFA.
                 •   processes the Message pointed to by the MFA.
                 The Outbound Interrupt Status and Mask bits are aliased in I2O_HOST in the “Interrupt Status Register
                 0” on page 327 and I2O_HOST_MASK in the “Interrupt Status Register 0” on page 327. The IOP must
                 program I2O_HOST_MAP in the “Interrupt Map Register Miscellaneous” on page 346 in order for the
                 Outbound Interrupt to be routed to PowerSpan II’s Primary PCI interrupt pin.
2.6.5.2          Outbound Message Frame Addresses (MFA)
                 PowerSpan II provides the MFA at the Bottom of the Outbound Post List FIFO by performing a
                 delayed read from the processor bus. The PowerSpan II increments the Outbound Post List Bottom
                 Pointer Register and compares the value with the Outbound Post List Top Pointer to determine if the
                 Outbound Post List FIFO is empty. When the Bottom and Top pointers contain the same value the I2O
                 Outbound Post Queue Interrupt Status bit is cleared by the PowerSpan II. Alternatively, the interrupt
                 can be masked out, leaving it to the Host processor to poll the Outbound Queue Register. When the
                 Outbound Post List FIFO is empty, the PowerSpan II returns 0xffff_ffff when the Host processor reads
                 the Outbound Queue Register.
Integrated Device Technology                                                                  PowerSpan II User Manual
www.idt.com                                                                                        80A1010_MA001_09


70                                                                                                       2. PCI Interface
              Once the Host processor has processed the MFA, it writes the MFA back to the Outbound Queue
              Register (0x044) to place it back in the Outbound Free List FIFO. PowerSpan II accepts the write
              transaction and takes responsibility for replacing the MFA in the Outbound Free List FIFO at the
              address pointed to by the Outbound Free List Top Pointer Register. PowerSpan II then increments the
              Outbound Free List Top Pointer Register by four.
2.6.6         Pull Capability
              The I2O 2.0 Specification defines an enhancement that allows the IOP to provide a capability to pull
              the I2O Inbound messages from the Host memory. In this configuration the Host places the I2O
              Inbound messages in MFs located in the Host memory as opposed to the IOP local memory. The Host
              must also implement a Host Free List FIFO in Host memory. This FIFO does not replace the IOP
              Inbound Free List FIFO, which must still be implemented in the IOP local memory to support normal
              inbound message passing, or peer to-peer message passing. This capability increases server
              performance by virtue of the Host CPU and server platforms being optimized for memory access rather
              than I/O access. Under this option, the Host can post Inbound messages to the IOP with a single write
              to the IOP. The IOP pulls the MF from the Host memory and releases a MF to the Host by generating a
              single write to Host memory. The Pull capability applies only to the IOP’s Inbound Queue and to the
              posting of messages by the Host.
              The Pull model requires 16 byte alignment of the message frames, therefore, the least significant four
              bits of the MFA are always zero. The Pull options use these four bits to create an Extended MFA
              (XMFA). The Pull model uses the least significant bit of the XMFA to indicate a pull request. This bit
              is the Pull Indicator or the P bit. Bits 3:1 of the XMFA indicate the number of data transfers required to
              copy the message. This number is system specific and has no effect on the PowerSpan II’s behavior.
              To prevent overflow of the local Inbound Post List FIFO the IOP reports an Inbound Post List
              Headroom to the Host, which is the difference between the size of the Inbound Post List FIFO and the
              total number of IOP Inbound Message Frames allocated by the IOP in local memory. This is the
              number of XMFAs the Host can Post to the I2O Inbound Post List FIFO and guarantee not to overflow
              the Inbound Post List FIFO. The IOP must not allocate more MFAs in the Inbound Free List than can
              be accepted in the Inbound Post List (along with XMFAs) without causing overflow.
              Equation
              •    #Inbound Free MFAs + #XMFAs <= FIFO_SIZE (see “I2O Queue Base Address Register” on
                   page 360 for more information)
2.6.6.1       Host Posting
              The Host can post a message to the IOP using the Pull Capability by using the following methods:
              •    reading an XMFA from the Host Free List FIFO
              •    writing an Inbound Message to the MF in Host memory indicated by the XMFA
              •    writing an XMFA to the Inbound Queue Register at offset 0x040 of the I2O target image on PCI
              The XMFA is processed by the PowerSpan II in the same way as a normal MFA posted to the local IOP
              by the Host or external IOP. The IOP can determine if the XMFA is posted using the Pull Capability
              and to pull the message from the system memory. To release an XMFA back to the Host platform the
              IOP writes the XMFA back to the Host Free List FIFO which resides in system memory.
PowerSpan II User Manual                                                                 Integrated Device Technology
80A1010_MA001_09                                                                                            www.idt.com


2. PCI Interface                                                                                                       71
2.6.6.2          Host Free List Address
                 The address and size of the Host Free List FIFO is provided to the IOP by the I2O System Host in an
                 I2O defined “IOP Message Pull Extensions” Message. The Host Free List FIFO structure is located at a
                 memory boundary equal to its size to enable the IOP to know when it has reached the end of the FIFO.
                 When the IOP returns XMFAs to the Host Free List FIFO sets the P bit to 1. When the IOP reaches the
                 end of the FIFO resets the FIFO index to the base address and this time through write the P bit to 0.
                 This allows the Host to track the progress of the local IOP in returning XMFAs.
                 Figure 11 illustrates the following steps in PowerSpan II I20 pull capability:
                 1. Host reads XMFA from Host Free List
                 2. Host writes message to MF in Host memory
                 3. Host writes XMFA to Inbound Queue
                 4. Local processor reads XMFA from the Inbound Post List FIFO
                 5. Local processor copies MF from Host memory
                 6. Local processor writes XMFA to Host Free List Index
Integrated Device Technology                                                                    PowerSpan II User Manual
www.idt.com                                                                                         80A1010_MA001_09


72                                                                                    2. PCI Interface
              Figure 11: PowerSpan II I2O Pull Capability
                                                            Bottom Pointer
                                  Inbound Queue             Top Pointer
                     Step 3                                                              Inbound
                                  (0x040)
                                                                                         Free List
                                                                                         FIFO
                     Step 6 XMFA
                                         Step 5  MFA
                                                                   Step 4
                                                            Bottom Pointer
                                    Local                   Top Pointer
                                                                                          Inbound
                                    Processor (IOP)                                       Post List
                                                                                          FIFO
                                                                                        Headroom
              PCI                                                                       (XMFA)
              Bus
                     Inbound Queue
                     Host Platform
                                                            Top Pointer
                     XMFA
                                  Host Free                 Bottom Pointer
                     Step 6                                                              Host
                                  List Index
                                                                                         Free List
                                                                                         FIFO
                         XMFA                        Step 1
                         Step 3
                                    Host
                                    Processor
PowerSpan II User Manual                                                Integrated Device Technology
80A1010_MA001_09                                                                         www.idt.com


2. PCI Interface                                                                                                       73
2.6.7            Outbound Option
                 The I2O 2.0 Specification allows for the IOP to provide an enhanced capability to post reply messages
                 to the Host. This mechanism is independent of the Pull Capability of the previous section. This
                 capability reduces the number of reads that the Host must perform to the IOP. Under the Outbound
                 Option Operation, the local IOP copies out the reply message to the Host system memory and then
                 posts the message by performing a single write to the Host memory. The Host need only to write to the
                 PowerSpan II to return the MFA.
                 The Outbound option requires 16-byte alignment of the message frames and thus the least significant
                 four bits of the MFA are always zero. The Outbound option uses these four bits to create and Extended
                 MFA (XMFA). The least significant bit of the outbound XMFA is the Cycle Indicator bit or the C bit.
2.6.7.1          Host Posting
                 To post a message to the Host, the IOP completes the following:
                 1. Obtains an Outbound MFA from the Outbound Free List FIFO.
                 2. Copies out the reply message to the MF indicated by the Host allocated Outbound MFA.
                 3. Posts the Outbound MFA to the HostPostList FIFO pointed to by the IOP Outbound Index
                      Register, setting the least significant bit of the MFA to 1, and increment the IOP Outbound Index
                      Register by writing to the IOP Outbound Index Increment Register.
                 The PowerSpan II IOP Outbound Index Register is initialized by the IOP with a value received along
                 with the Host Outbound Post List FIFO Size through an “IOP Message Outbound Extensions” message
                 from the Host. The size of the Host Outbound Post List FIFO is specified in the HOPL_SIZE bit in the
                 I2O_CSR register.
                 The PowerSpan II IOP Outbound Index Register points to the Top of the Host Outbound Post List
                 FIFO implemented in Host memory. When it reaches the end of the FIFO the IOP resets the IOP
                 Outbound Index Register to the base of the FIFO. The IOP writes XMFAs to the FIFO with the C bit
                 set to 0, and continues to alternate this pattern. This allows the Host to determine where the IOP
                 processor has last written to the FIFO.
                 PowerSpan II also implements a Host Outbound Index Register where the Host will write its Host
                 Outbound Post List FIFO Index after servicing Outbound reply messages posted using the Outbound
                 Option. The Host Outbound Index Register points to the Bottom of the Host Outbound Post List FIFO.
                 PowerSpan II maps this register into the PowerSpan II I2O Target Image Shell Interface at the offset
                 specified in the I2O Host Outbound Index Offset Register. This register is initialized by the IOP with
                 an offset provided by the Host through the IOP Message Outbound Extensions message.
                 When I2O Extended capabilities are enabled with I2O_CSR[XI2O_EN], PowerSpan II will set an
                 interrupt status bit in the I2O Outbound Post List Interrupt Status register when the I2O Host Outbound
                 Index Register is not equal to the I2O IOP Outbound Index Register. This indicates that the Host
                 Outbound Post List FIFO is non-empty.
Integrated Device Technology                                                                     PowerSpan II User Manual
www.idt.com                                                                                            80A1010_MA001_09


74                                                                                                         2. PCI Interface
              PowerSpan II compares the value of the Host Outbound Index Register to the IOP Outbound Index
              Register. If they are identical the Interrupt is cleared by the PowerSpan II. If these registers differ, then
              it is assumed that the PowerSpan II has posted additional Outbound reply messages which have not yet
              been serviced by the Host, and therefore, the PowerSpan II continues to assert the Interrupt to the Host.
              The Host will post empty MFAs back to the IOP by writing to the PowerSpan II’s Outbound Queue
              Register (0x044), with the C bit set to zero. PowerSpan II services the written MFA the same as a
              normal Outbound MFA being returned to the IOP.
              Figure 12 illustrates the following steps in PowerSpan II I20 outbound capability:
              1. Local processor reads the Outbound Free List to obtain an MFA
              2. Local processor writes the MF in the Host memory
              3. Local processor writes the MFA to the Host Outbound Post List FIFO, setting the P bit
              4. Host processor reads the XMFAs from the Host Outbound Post List
              5. Host writes the XMFA to the Outbound Queue (0x044)
PowerSpan II User Manual                                                                   Integrated Device Technology
80A1010_MA001_09                                                                                              www.idt.com


2. PCI Interface                                                                                         75
                 Figure 12: PowerSpan II I2O Outbound Capability
                       XMFA
                       Step 3
                                        XMFA
                            XMFA
                            Step 5                 Step 4
                                                                 IOP Outbound Index
                                                                 Host Outbound Index           Host
                                      Host
                                                                                               Outbound
                                      Processor
                                                                                               Post List
                                                                                               FIFO
                 PCI
                 Bus
                       Host Platform
                       Outbound Queue
                                                                    Top Pointer
                       XMFA
                                    Outbound Queue                  Bottom Pointer
                       Step 5                                                                  Outbound
                                    (0x044)
                                                                                               Free List
                                                                                               FIFO
                            XMFA                          Step 1
                            Step 3
                                      Local
                                      Processor (IOP)
Integrated Device Technology                                                       PowerSpan II User Manual
www.idt.com                                                                            80A1010_MA001_09


76                                                                                                          2. PCI Interface
2.6.8         I2O Standard Registers
              This section defines the standard I2O register set supported by PowerSpan II. These registers are
              accessible within the PowerSpan II I2O target image. In Table 10, all standards-based registers are in
              italics.
              Table 10: PowerSpan II I20 Target Image Map
                 Offset                 Register
                (HEX)                   Mnemonic           Register Name
                0x000-028               PowerSpan II Reserved
                0x030                   OPL_IS             I20 Outbound Post List Interrupt Status Register
                0x034                   OPL_IM             I20 Outbound Post List Interrupt Mask Register
                0x038                   PowerSpan II Reserved
                0x040                   IN_Q               I20 Inbound Queue
                0x044                   OUT_Q              I20 Outbound Queue
                0x048-[HOST_OIO]-4      PowerSpan II Reserved
                [HOST_OIO]              HOST_OI            I2O Host Outbound Index Register
                [HOST_OIO]+4-0xFF       PowerSpan II Reserved
                0x100-xxx               I20 Inbound Message Frames
              The I2O Shell Interface is located in the first 4 Kbytes of the PowerSpan II I2O target image. The I2O
              Inbound Message Frames occupies offsets above the 4 Kbyte point of the PowerSpan II I2O target
              image. The upper limit of the I2O Inbound Message Frames is determined by the size of the PowerSpan
              II I2O target image, as defined by the PCI_I2O_CTL[BS] register.
              The offset of the I2O Host Outbound Index Register is programmed in the I2O Host Outbound Index
              Offset Register (HOST_OIO) of the PowerSpan II Register Map.
              The following tables show the I2O register definitions.
PowerSpan II User Manual                                                                     Integrated Device Technology
80A1010_MA001_09                                                                                               www.idt.com


2. PCI Interface                                                                                                              77
2.6.9            I20 Outbound Post List Interrupt Status Register
                 The I20 2.0 Specification requires the Outbound Post_List Interrupt Status register to be located at
                 offset 0x30 in the Memory region specified by the first base address register (I20 Base Address Register
                 - Px_BSI2O).
                 When the I20 messaging unit in PowerSpan II is enabled (I2O_CSR[I2O_EN] = 1), a Memory access
                 from PCI to offset 0x30 from Px_BSI2O is destined for OPL_IS.
                 When the I20 messaging unit in PowerSpan II is not enabled, the OPL_IS register is not visible to read
                 or write access. The register essentially disappears from all PowerSpan II memory maps.
 Register Name: OPL_IS                                                                                    Register Offset: 030
    PCI                                                                                                                 PPC
    Bits                                                  Function                                                       Bits
   31-24                                                I2O Reserved                                                      0-7
   23-16                                                I2O Reserved                                                     8-15
   15-08                                                I2O Reserved                                                    16-23
   07-00                      I2O Reserved                        OPL_                   I2O Reserved                   24-31
                                                                   ISR
                                       Reset        Reset
       Name              Type           By           State                                 Function
     OPL_ISR               R          Px_RST           0        Outbound Post List Interrupt Service Request
                                                                0 = Outbound Post_List FIFO is empty
                                                                1 = Outbound Post_List FIFO is not empty. The value of the
                                                                interrupt mask bit does not affect this bit.
Integrated Device Technology                                                                        PowerSpan II User Manual
www.idt.com                                                                                                80A1010_MA001_09


78                                                                                                        2. PCI Interface
2.6.10        I20 Outbound Post List Interrupt Mask Register.
              The I20 2.0 Specification requires the Outbound Post_List Interrupt Mask register to be located at
              offset 0x34 in the memory region specified by the first base address register (I20 Base Address Register
              - Px_BSI2O).
              When the I20 messaging unit in PowerSpan II is enabled (I2O_CSR[I2O_EN] = 1), a memory access
              from PCI to offset 034h from Px_BSI2O is destined for OPL_IM.
              When the I20 messaging unit in PowerSpan II is not enabled, the OPL_IM register is not visible to read
              or write access. The register essentially disappears from all PowerSpan II memory maps.
 Register Name: OPL_IM                                                                              Register Offset: 034
   PCI                                                                                                             PPC
   Bits                                                Function                                                    Bits
  31-24                                              I2O Reserved                                                   0-7
  23-16                                              I2O Reserved                                                  8-15
  15-08                                              I2O Reserved                                                 16-23
  07-00                    I2O Reserved                      OP_ISM                 I2O Reserved                  24-31
                                    Reset        Reset
      Name            Type           By           State                               Function
     OP_ISM            R/W         Px_RST           0        Outbound Post_List Interrupt Mask
                                                             0 = Outbound Post_List Interrupt is enabled
                                                             1 = Outbound Post_List Interrupt is masked
PowerSpan II User Manual                                                                   Integrated Device Technology
80A1010_MA001_09                                                                                             www.idt.com


2. PCI Interface                                                                                                              79
2.6.11           I20 Inbound Queue
                 A read from the I2O Inbound Queue returns the next available MFA from the I2O Inbound Free List
                 FIFO. This is a destructive read.
                 A write to this offset is used to place a MFA into the I2O Inbound Post List FIFO. The PowerSpan II
                 accepts the write cycle as a posted write and is responsible for completing the cycle on the destination
                 bus.
                 When the I20 Interface in PowerSpan II is not enabled, the IN_Q register is not visible to read or write
                 access. The register essentially disappears from all PowerSpan II memory maps.
 Register Name: IN_Q                                                                                    Register Offset: 040
    PCI                                                                                                                 PPC
    Bits                                                   Function                                                      Bits
   31-24                                                     MFA                                                         0-7
   23-16                                                     MFA                                                         8-15
   15-08                                                     MFA                                                        16-23
   07-00                                                     MFA                                                        24-31
                                        Reset         Reset
       Name              Type             By          State                                Function
     MFA[31:0]           R/W           Px_RST           0        Inbound Message Frame Address
                                                                 The Inbound Message Frame Address specifies locations in
                                                                 the IOP memory map where Inbound Message Frames
                                                                 reside.
                                                                 The MFA is the offset from the beginning of the I2O target
                                                                 image window in the destination bus memory map and the
                                                                 destination address where the Message Frame begins.
Integrated Device Technology                                                                       PowerSpan II User Manual
www.idt.com                                                                                              80A1010_MA001_09


80                                                                                                     2. PCI Interface
2.6.12        I20 Outbound Queue
              A read from the I2O Outbound Queue returns the next MFA from the I2O Outbound Post List FIFO.
              This is a destructive read.
              A write to this offset places a Free Host MFA into the I2O Outbound Free List FIFO. PowerSpan II
              accepts the write cycle as a posted write and is responsible for completing the cycle on the destination
              bus.
              When the I20 Interface in PowerSpan II is not enabled, the OUT_Q register is not visible to read or
              write access. The register essentially disappears from all PowerSpan II memory maps.
 Register Name: OUT_Q                                                                            Register Offset: 044
   PCI                                                                                                          PPC
   Bits                                                Function                                                 Bits
  31-24                                                  MFA                                                    0-7
  23-16                                                  MFA                                                    8-15
  15-08                                                  MFA                                                   16-23
  07-00                                                  MFA                                                   24-31
                                     Reset        Reset
      Name            Type            By           State                            Function
    MFA[31:0]          R/W          Px_RST           0       Outbound Message Frame Address
                                                             The Outbound Message Frame Address specify locations in
                                                             the Host memory map where Outbound Message Frames
                                                             reside.
                                                             The Message Frame Address is the Host memory address of
                                                             the Message Frame.
PowerSpan II User Manual                                                                 Integrated Device Technology
80A1010_MA001_09                                                                                          www.idt.com


2. PCI Interface                                                                                                         81
2.6.13           I2O Host Outbound Index Register
                 This register indicates the address in Host memory from which the Host is to retrieve the next
                 Outbound XMFA. This register is initialized by the IOP with an index received from the Host in an I2O
                 message. The register is written by the Host during I2O Outbound Option message passing.
                 When the I2O Host Outbound Index Register and the I2O IOP Outbound Index Register differ, the
                 Outbound Post List Interrupt Status bit is set in the OPL_IS register at offset 0x30 of the PCI I2O target
                 Image. When these registers contain the same Host memory address, the Interrupt is cleared.
                 This feature is only supported if the I2O Outbound Option is enabled with the XI2O_EN bit in the
                 I2O_CSR register and I2O_EN.
                 The HOPL_SIZE bit in the I2O_CSR register determines the alignment of this Index register.
                 The Register Offset is specified in the I2O Host Outbound Index Offset Register at offset 0x548 of the
                 PowerSpan II Register Map. The I2O Host Outbound Index Register must be located in the lower
                 4 Kbytes of the PCI I2O target image map.
                 When the I20 Interface in PowerSpan II is not enabled, the HOST_OI register is not visible to read or
                 write access. The register essentially disappears from all PowerSpan II memory maps.
 Register Name: HOST_OI                                                                     Register Offset: [HOST_OIO]
    PCI                                                                                                              PB
    Bits                                                  Function                                                  Bits
   31-24                                                     OI                                                     0-7
   23-16                                                     OI                                                     8-15
   15-08                                                     OI                                                    16-23
   07-00                                        OI                                            0            0       24-31
                                       Reset         Reset
       Name              Type            By          State                               Function
      OI[29:0]           R/W          Px_RST            0        Host Outbound Index
Integrated Device Technology                                                                     PowerSpan II User Manual
www.idt.com                                                                                            80A1010_MA001_09


82                                     2. PCI Interface
PowerSpan II User Manual Integrated Device Technology
80A1010_MA001_09                          www.idt.com


                                                                                                                          83
3.              Processor Bus Interface
                This chapter describes the functionality of the Processor Bus Interface. Both the Single PCI PowerSpan
                II and Dual PCI PowerSpan II have a Processor Bus Interface. The following topics are discussed:
                •    “Overview” on page 83
                •    “PB Slave Interface” on page 84
                •    “PB Master Interface” on page 100
3.1             Overview
                The PowerSpan II Processor Bus (PB) Interface directly connects with a wide range of processors in
                order to meet the demands of high end systems, the PB Interface operates up to100 MHz and has a
                64-bit data bus.
3.2             Interface Support
                The PowerSpan II Processor Bus Interface supports the following embedded processors:
                       — Motorola: PowerQUICC II (MPC825x, MPC826x, MPC827x, MPC8280), PowerPC 7XX
                           (MPC74x, MPC75x), PowerPC 7400
                       — IBM: PowerPC 740, PowerPC 750
                       — Wintegra: WinPathTM
                Although these interfaces are not identical, for the most part the processor interface on the PowerSpan
                II is referred to simply as the Processor Bus (PB). The interface sections in this chapter highlight where
                the PowerSpan II operates differently to address specific processor requirements as the need arises. An
                example of this different operation is the extended cycles with the PowerQUICC II.
                            The PowerQUICC II and PowerPC 7400 must operate in 60x compatible bus mode to be used
                            with PowerSpan II. In single PowerQUICC II mode the processor cannot share the bus with
                            other external masters.
3.2.1           Terminology
                The following terms are used in the Processor Bus Interface descriptions:
                •    Address retry window: refers to the clock following the assertion of AACK_, which is the latest a
                     snooping master can request for an address tenure re-run.
                •    Window of opportunity: refers to the clock following the assertion of ARTRY_. The retrying
                     master has to request the bus on this clock to ensure that it is the next bus owner. This enables it to
                     perform the transactions required to maintain cache coherency.
Integrated Device Technology                                                                      PowerSpan II User Manual
www.idt.com                                                                                           80A1010_MA001_09


84                                                                                          3. Processor Bus Interface
3.2.2         PB Bus Interface Descriptions
              The PB Bus Interface is described in terms of its master and slave functions. The PCI interfaces on
              PowerSpan II are described in terms of its PCI master and PCI target functions. This description is
              largely independent of PCI-1 versus PCI-2, or the assignment of the Primary PCI Interface functions.
              Exceptions to these rules are noted in the manual.
3.2.2.1       Transaction Ordering
              For information on PowerSpan II’s PCI transaction ordering refer to “Transaction Ordering” on
              page 34.
3.3           PB Slave Interface
              PowerSpan II becomes active as a PB slave when one of the following conditions occurs:
              •    A processor bus master accesses a PCI resource, generating a memory or I/O space access
              •    A processor bus master accesses a PCI resource, generating a configuration or IACK access
              •    A processor bus master accesses PowerSpan II registers
              This section covers the first two of these conditions. See “Register Access” on page 235 for a
              discussion of the last two items in the bullet list above.
              The operation of the PB Slave is described below by dividing the PB Slave transaction into the
              following different phases:
              •    Address phase: This section discusses the decoding of processor bus accesses.
              •    Data transfer: This section describes control of transaction length.
              •    Terminations: This section describes the terminations supported by PowerSpan II, and exception
                   handling.
                         The PowerSpan II PB Slave supports cacheable accesses to PCI, but it does not guarantee
                         coherency if more than one processor accesses a given range of memory. In order to address
                         this issue, operating system pages mapped to PowerSpan II must have the Memory
                         Coherency Attribute (M) set to zero. PowerSpan II performs PCI read prefetches. These reads
                         can be cached in an internal queueing memory within PowerSpan II — if PRKEEP is set to 1.
                         When a write is performed to a prefetched address, a subsequent read yields stale data.
                         Prefetching attributes for each image map must meet the systems cache coherency
                         requirements.
              Pull-up resistors are not required on the processor bus address (PB_A[0:31]) and data (PB_D[0:63])
              signals to guarantee functional operation of PowerSpan II. However, adding resistors to the address and
              data signals minimizes the current drawn by the PowerSpan II's tristated buffers when the bus is in an
              idle condition. The system designer must decide whether to add these resistors to the address and data
              bus.
PowerSpan II User Manual                                                                Integrated Device Technology
80A1010_MA001_09                                                                                         www.idt.com


3. Processor Bus Interface                                                                                            85
3.3.1           Address Phase
                The address phase deals with the decoding of processor bus accesses.
3.3.1.1         Transaction Decoding
                Transaction decoding on the PB Slave operates in both normal decode mode and Master-based decode
                mode.
                When PowerSpan II is in normal decode mode, each PB slave monitors the Processor Bus Address
                (PB_A[]). When the address falls into one of the programmed windows, and the Transfer Type
                (PB_TT[]) is supported, PowerSpan II claims the address tenure.
                          A PB slave image is defined as the range of processor bus physical address space that
                          decodes a PowerSpan II access.
                PB slave image location is controlled by setting the Base Address (BA) field in the “Processor Bus
                Register Image Base Address Register” on page 295. PB slave image size is controlled by setting the
                Block Size (BS) field in the “Processor Bus Slave Image x Control Register” on page 287.
                PowerSpan II supports eight general purpose slave images and four specialty slave images. A general
                purpose slave image generates memory or I/O reads and writes to the PCI bus. For example, the eight
                general purpose slave images can support the local bus traffic of four PowerQUICC II SCCs, two
                threads of CPU traffic destined for PCI-1, and two threads destined for PCI-2. The specialty images are
                used for the generation of PCI Configuration cycles on PCI-1 and PCI-2, IACK reads on PCI-1, IACK
                reads on PCI-2 and PowerSpan II register accesses.
                The PB slave image also controls how an incoming PB transaction is mapped to the destination port on
                PowerSpan II. For example, there are bits for endian mapping, prefetch behavior, etc. Table 11 on
                page 86 describes the programming model for a PB Slave Image Control register.
                The PB slave image only claims a transaction when all of the following conditions are met:
                •   the external address matches the slave image
                •   the transaction codes are supported
                          In normal decoding mode (see “Transaction Decoding” on page 85), the PB slave image
                          claims transactions initiated by the PowerSpan II PB Master Interface if the transaction meets
                          the two conditions listed above. In order to avoid the PB slave from claiming transactions
                          from the a transaction PowerSpan II PB Master Interface, the Master-based Decode
                          functionality can be enabled.
Integrated Device Technology                                                                  PowerSpan II User Manual
www.idt.com                                                                                         80A1010_MA001_09


86                                                                                               3. Processor Bus Interface
              Table 11 describes the bits and default settings of the “Processor Bus Slave Image x Control Register”
              on page 287.
              Table 11: Programming Model for PB Slave Image Control Register
                Bits            Type      Description                                               Default Setting
                IMG_EN          R/W       Enables the PB slave image to decode in the specified     Disabled
                                          physical address range.
                TA_EN           R/W       Enables address translation (see “Processor Bus           Disabled
                                          Slave Image x Translation Address Register” on
                                          page 292).
                BS[4:0]         R/W       Sets the block size of the PB slave image. The size of    Default value is 0. It can
                                          the image is 4 Kbyte * 2BS.                               be programmed through
                                                                                                    any port after reset, or
                                                                                                    loaded through
                                                                                                    EEPROM.
                MODE            R/W       Maps the incoming PB transaction to either Memory or      Defaults to Memory
                                          I/O space on the PCI bus.                                 space.
                DEST            R/W       Directs the incoming PB transaction to either of PCI-1    Defaults to PCI-1
                                          or PCI-2
                MEM_IO          R/W       Enables 1,2,3, or 4 byte memory reads on the PCI          Regular I/O mode
                                          bus(es).
                PRKEEP          R/W       Enables PowerSpan II to keep prefetch read data over      Disabled
                                          subsequent transactions.
                END[1:0]        R/W       Sets endian mapping to little-endian, PowerPC             Big-endian is the default
                                          little-endian, or big-endian                              mode.
                RD_AMT[2:0]     R/W       Controls the prefetch read amount. Can be                 8 bytes is the default
                                          programmed up to a maximum of 128 bytes.                  prefetch read amount
                              PB memory management supports a variety of memory/cache access attributes: write
                              through (W), caching-inhibited (I), and memory coherency (M). Although PowerSpan II
                              does not decode these attributes — external pins PB_GBL_ and PB_CI_ are output
                              only— specific guidelines must be followed to ensure correct system operation. These
                              guidelines are shown in Table 12.
              Table 12: Recommended Memory/Cache Attribute Settings
                PowerSpan II Resource                 Memory Coherency                  Caching Inhibited
                Registers                             M=0                               I=1
                PCI I/O space                         M=0                               I=1
                PCI Memory space                      M=0                               External L2 cache: I=1
                                                                                        No External L2 cache: I=0 or 1
PowerSpan II User Manual                                                                     Integrated Device Technology
80A1010_MA001_09                                                                                                 www.idt.com


3. Processor Bus Interface                                                                                              87
                           Register and PCI I/O space accesses requires I to be set to 1 because PowerSpan II does not
                           accept burst transactions to these resources.
                Master-based Decode Mode
                The PB Slave Interface supports Master-based decode mode when the internal PowerSpan II processor
                bus arbiter is enabled (see “Processor Bus Arbitration” on page 141) and the Master Decode Enable
                (MD_EN) bit is set in the “Processor Bus Slave Image x Control Register” on page 287. When
                Master-based decode is enabled, a PB slave image only claims a transaction decoded for its specified
                physical address space if it originates from specific processor bus master or masters.
                External bus masters are selected for a specific target by setting one or more of the M1 to M3 bits in the
                “Processor Bus Slave Image x Translation Address Register” on page 292.
                The PB slave image only claims a transaction when all of the following conditions are met:
                •    the address matches the slave image
                •    the transaction codes are supported
                •    Mx is set and the identified master is requesting a transaction
                           PowerSpan II behavior is undefined if more than one identically programmed, or
                           overlapping, slave image claims a transaction. For example, if two slave image have the same
                           base address and size, then they must have unique master bits set in the “Processor Bus Slave
                           Image x Translation Address Register” on page 292.
3.3.1.2         Transfer Types
                The PB Slave only claims processor bus transactions with specific transfer types. The supported
                transfer types consist of address only, read, and write. They are defined in Table 13.
                All reads are treated as delayed reads and can be single cycle, extended or bursts. All writes are treated
                as posted writes and can be single cycle, extended or bursts. PowerSpan II handles address only cycles
                by asserting PB_AACK_ — no data transfer occurs.
                Address only transfer types are claimed to ensure PowerSpan II does not negatively impact cache
                control, reservation, or ordering transactions on the processor bus.
                Table 13: PowerSpan II PB Slave Transfer Types
                    TT[0:4]                                 Name
                  Address Only
                  00000         Clean Block
                  00100         Flush Block
                  01000         Sync Block
                  01100         Kill Block
Integrated Device Technology                                                                    PowerSpan II User Manual
www.idt.com                                                                                           80A1010_MA001_09


88                                                                                              3. Processor Bus Interface
              Table 13: PowerSpan II PB Slave Transfer Types
                  TT[0:4]                                 Name
                10000        eieio
                11000        tlb invalidate
                00001        lwarx
                01001        tlb sync
                01101        icbi
                Reads
                01010        Read
                01110        Read with intent to modify
                11010        Read Atomic
                11110        Read with intent to modify atomic
                01011        Read with no intent to cache
                Writes
                00010        Write with flush
                00110        Write with kill
                10010        Write with flush atomic
              Because PowerSpan II does not have a cache, all read and write transfer types are treated the same. For
              example, a Read with Intent to Modify command (PB_TT= 01110) is handled the same way as a Read
              Atomic command (PB_TT= 11010).
              PowerSpan II performs PCI read prefetches and stores read data in an internal buffer when the Prefetch
              Keep (PRKEEP) bit is set to 1. The purpose of a prefetch read is to fetch read information before the
              master requests the information. If the master then requests the information the target can respond
              immediately with the prefetched information. This ability protects the master from slow access times
              for information it requires. However, when a write is performed to a prefetched address, a subsequent
              read could yield stale data. In order to guarantee there is no stale data, set the PRKEEP bit to 0. This
              function disables the internal buffer to ensure there is no stale data. By setting this PRKEEP bit to 0
              PowerSpan II is unable to perform PCI read prefetches and read performance may be decreased in the
              system.
                         Prefetching attributes for each image map must meet the system’s cache coherency
                         requirements
PowerSpan II User Manual                                                                    Integrated Device Technology
80A1010_MA001_09                                                                                             www.idt.com


3. Processor Bus Interface                                                                                             89
3.3.1.3         Address Tenure
                Each slave on the PB Interface is responsible for the following:
                •    decoding the address broadcast by the master
                •    claiming the address tenure with PB_AACK_ assertion
                •    managing the data termination signals during the data tenure
                The PB Slave uses PB_AACK_ to limit the level of address pipelining to one. The earliest the PB slave
                can assert PB_AACK_ is two clocks after PB_TS_.
                The PB Slave does not acknowledge subsequent address phases until it finishes its participation in the
                current data tenure. If the previous address phase was claimed by another slave, the PB slave does not
                acknowledge the current address phase until the previous slave completes its data tenure.
                The use of PB_ARTRY_ by the PB Slave is enabled by the Address Retry Enable (ARTRY_EN) bit in
                the “Processor Bus Miscellaneous Control and Status Register” on page 304. If the ARTRY_EN bit is
                set to 0, the PB_ARTRY_ signal is not asserted and the PB slave retains ownership of the bus. The PB
                Slave retains ownership after the assertion of PB_AACK_ and until it is able to assert PB_TA.
                When ARTRY_EN has a value of 1, the PB Slave can assert PB_ARTRY_. The default setting is 0
                (ARTRY_EN is disabled). The PB Interface has higher performance if the ARTRY_EN bit is enabled.
                PowerSpan II’s PB Master or another external master can gain access to the bus when PowerSpan II
                cannot assert PB_TA.
                When ARTRY_EN is enabled, the PB Slave asserts PB_ARTRY_ in the following situations:
                •    a write destined for PCI cannot be internally buffered
                •    when a read request has been latched and read data is being fetched from PCI
                •    a register access when a load from EEPROM is in progress
                •    writing to registers when another bus (PCI-1, PCI-2) is also writing to the register block
                If the assertion of PB_ARTRY_ is enabled, it occurs the clock after PB_AACK_ within the address
                retry window.
3.3.1.4         Address Translation
                The incoming address on the PB Interface can have a translation offset applied to it using the
                TADDR[19:0] field of the “Processor Bus Slave Image x Translation Address Register” on page 292.
                When the translation offset is applied to the incoming PB address, the translated address appears on the
                destination bus (PCI-1 or PCI-2). The translation offset replaces the PB address, up to the size of the
                image. TADDR[19:0] replaces PB address lines PB_A[0:19].
Integrated Device Technology                                                                   PowerSpan II User Manual
www.idt.com                                                                                          80A1010_MA001_09


90                                                                                       3. Processor Bus Interface
              For example, if TADDR[19:0] = 0x12345 and the BS bit in the PB_SIx_CTL register equals 0
              (4-Kbyte image) and the address on the processor bus is PB_A[0:31] = 0x78563412, then the PCI
              address becomes 0x12345412. Table 14 summarizes the relationship between translation offset,
              processor bus address, and block size of the image.
              Table 14: Translation Address Mapping
                                                                              BS bit
                PB_SIx_TADDR      Processor Bus Address (PB_A)         (PB_SIx_CTL register)       Block Size
                      31                          0                           10011                    2G
                    31:30                        0:1                          10010                    1G
                    31:29                        0:2                          10001                   512M
                    31:28                        0:3                          10000                   256M
                    31:27                        0:4                          01111                   128M
                    31:26                        0:5                          01110                   64M
                    31:25                        0:6                          01101                   32M
                    31:24                        0:7                          01100                   16M
                    31:23                        0:8                          01011                    8M
                    31:22                        0:9                          01010                    4M
                    31:21                       0:10                          01001                    2M
                    31:20                       0:11                          01000                    1M
                    31:19                       0:12                          00111                   512k
                    31:18                       0:13                          00110                   256k
                    31:17                       0:14                          00101                   128k
                    31:16                       0:15                          00100                    64k
                    31:15                       0:16                          00011                    32k
                    31:14                       0:17                          00010                    16k
                    31:13                       0:18                          00001                    8k
                    31:12                       0:19                          00000                    4k
PowerSpan II User Manual                                                             Integrated Device Technology
80A1010_MA001_09                                                                                      www.idt.com


3. Processor Bus Interface                                                                                           91
3.3.1.5         Address Parity
                Address parity checking is provided on each byte of the address bus. Address parity bit assignments are
                defined in Table 15.
                Table 15: PowerSpan II PB Address Parity Assignments
                            Address Bus                          Address Parity
                              PB_A[0:7]                            PB_AP[0]
                             PB_A[8:15]                            PB_AP[1]
                             PB_A[16:23]                           PB_AP[2]
                             PB_A[24:31]                           PB_AP[3]
                When the PB Slave detects an address parity error during its decode process it does not assert Address
                Acknowledge (PB_AACK_). Address parity checking is enabled with the Address Parity Enable
                (AP_EN) bit in the “Processor Bus Miscellaneous Control and Status Register” on page 304. Odd
                parity versus even parity is configured with the PARITY bit in the same register.
                Special Parity Requirements with the PowerQUICC II
                Address parity and data parity must be specially programmed in a joint
                PowerSpan II and PowerQUICC II application.
                In a joint application all memory accesses from the PowerQUICC II to PowerSpan II must be routed
                through the internal memory controller on the PowerQUICC II. When the data is passed through the
                memory controller both address parity and data parity can be used in the system.
                If accesses do not pass through the memory controller of the PowerQUICC II before reaching
                PowerSpan II, and PowerSpan II has either or both address and data parity enabled, then PowerSpan II
                reports parity errors on the transaction.
                To enable or disable address parity in PowerSpan II, set the Address Parity Enable (AP_EN) bit in the
                “Processor Bus Miscellaneous Control and Status Register” on page 304.
                To enable or disable data parity in PowerSpan II, set the Data Parity Enable (AP_EN) bit in the
                “Processor Bus Miscellaneous Control and Status Register” on page 304
Integrated Device Technology                                                                  PowerSpan II User Manual
www.idt.com                                                                                        80A1010_MA001_09


92                                                                                             3. Processor Bus Interface
3.3.2         Data Phase
              The data phase deals with the control of transaction length.
3.3.2.1       Transaction Length
              The PB Slave supports a set of the data transfer sizes supported by the embedded PowerPC family. All
              data transfer sizes supported by the PowerSpan II PB Slave are illustrated in Table 16. Burst transfers
              are indicated by the assertion of Processor Bus Transfer Burst (PB_TBST_). The shaded regions
              indicate transaction sizes unique to the PowerQUICC II.
              Table 16: PowerSpan II PB Transfer Sizes
                            Transfer Size                Bytes       PB_TBST        PB_TSIZ[0]          PB_TSIZ[1:3]
                Byte                                       1             1                0                 001
                Half-word                                  2             1                0                 010
                Tri-byte                                   3             1                0                  011
                Word                                       4             1                0                 100
                Five bytes                                 5             1                0                 101
                Six bytes                                  6             1                0                  110
                Seven bytes                                7             1                0                  111
                Double Word (DW)                           8             1                0                 000
                Extended Double (PowerQUICC II            16             1                1                 001
                only)
                Extended Triple (PowerQUICC II only)      24             1                1                 010
                Burst (Quad DW)                           32             0                0                 010
3.3.2.2       Data Alignment
              Embedded processor bus transfer sizes and alignments, defined in Table 16 and Table 17, are supported
              by the PB Slave for transaction accesses. The shaded table cells in Table 17 show transactions that
              support the PowerPC 7400 processor.
              Table 17 lists the size and alignment transactions less than or equal to 8 bytes. PowerSpan II register
              accesses are limited to 4 bytes or less.
                          The PowerSpan II port size is 64-bit.
PowerSpan II User Manual                                                                   Integrated Device Technology
80A1010_MA001_09                                                                                            www.idt.com


3. Processor Bus Interface                                                                            93
                Table 17: PowerSpan II Processor Bus Single Beat Data Transfers
                  Size       TSIZ[0:3] A[29:31]                  Data Bus Byte Lanes
                                                0     1      2      3      4       5      6        7
                 Byte        0001      000      D0
                             0001      001            D1
                             0001      010                   D2
                             0001      011                          D3
                             0001      100                                 D4
                             0001      101                                         D5
                             0001      110                                                D6
                             0001      111                                                         D7
                 Half word   0010      000      D0    D1
                             0010      001            D1     D2
                             0010      010                   D2     D3
                             0010      011                          D3     D4
                             0010      100                                 D4      D5
                             0010      101                                         D5     D6
                             0010      110                                                D6       D7
                 Tri-byte    0011      000      D0    D1     D2
                             0011      001            D1     D2     D3
                             0011      010                   D2     D3     D4
                             0011      011                          D3     D4      D5
                             0011      100                                 D4      D5     D6
                             0011      101                                         D5     D6       D7
Integrated Device Technology                                                     PowerSpan II User Manual
www.idt.com                                                                           80A1010_MA001_09


94                                                                                             3. Processor Bus Interface
              Table 17: PowerSpan II Processor Bus Single Beat Data Transfers
                Size          TSIZ[0:3]    A[29:31]                         Data Bus Byte Lanes
                Word          0100         000        D0       D1      D2      D3
                              0100         001                 D1      D2      D3       D4
                              0100         010                         D2      D3       D4        D5
                              0100         011                                 D3       D4        D5     D6
                              0100         100                                          D4        D5     D6       D7
                Five bytes    0101         000        D0       D1      D2      D3       D4
                              0101         001                 D1      D2      D3       D4        D5
                              0101         010                         D2      D3       D4        D5     D6
                              0101         011                                 D3       D4        D5     D6       D7
                Six bytes     0110         000        D0       D1      D2      D3       D4        D5
                              0110         001                 D1      D2      D3       D4        D5     D6
                              0110         010                         D2      D3       D4        D5     D6       D7
                Seven         0111         000        D0       D1      D2      D3       D4        D5     D6
                bytes
                              0111         001                 D1      D2      D3       D4        D5     D6       D7
                Double        0000         000        D0       D1      D2      D3       D4        D5     D6       D7
                word
                          The information in Table 17 is independent of endian considerations and pertains to byte lane
                          control on the processor bus. For endian considerations, please consult “Endian Mapping” on
                          page 177.
              PowerPC 7400 Transaction Support
              The PowerPC 7400 processors supports misaligned transactions within a double word (64-bit aligned)
              boundary. As long as the transaction does not cross the double word boundary, the PowerPC 7400 can
              transfer data on the misaligned address.
              PowerSpan II supports a specific types of the PowerPC 7400 misaligned transactions (shown in
              Table 17) when the MODE_7400 bit is set in the “Processor Bus Miscellaneous Control and Status
              Register” on page 304. Any misaligned transaction between PowerSpan II and the PowerPC 7400 that
              is a single word (32-bit) or less must be within a single word aligned boundary. Any transfer greater
              than a single word must start or end on a word boundary.
                          Software must make sure that the PowerPC 7400 does not initiate unsupported misaligned
                          transactions to PowerSpan II.
PowerSpan II User Manual                                                                   Integrated Device Technology
80A1010_MA001_09                                                                                            www.idt.com


3. Processor Bus Interface                                                                                            95
3.3.2.3         Cache Line Size
                The supported embedded PowerPC processors implement a 32-byte cache line size. Cache wrap reads
                are supported by the PB slave for burst and extended transactions.
                           PowerPC processors do not generate cache wrap writes.
3.3.2.4         Reads
                Address Retry Enable
                The PB slave supports up to eight concurrent delayed reads when the Address Retry Enable
                (ARTRY_EN) bit in the “Processor Bus Miscellaneous Control and Status Register” on page 304 is set
                to 1. Refer to “Concurrent Reads” on page 27 for more information on read pipelining in PowerSpan II.
                When an external master makes an initial read request, the PowerSpan II PB slave latches the address.
                This initiates a read on the destination bus. The destination bus is specified by the Destination Bus
                (DEST) bit in the “Processor Bus Slave Image x Control Register” on page 287.
                Delayed Reads
                The outstanding read is referred to as a delayed read. Delayed reads consist of the following phases:
                1. Delayed Read Request
                      — PowerSpan II PB Slave latches transaction parameters and issues a retry
                2. Delayed Read Completion
                      — The PB Slave obtains the requested data and completion status on the destination bus
                3. Read Completion
                      — The master repeats the transaction with the same parameters used for the initial request
                Any attempt by a processor bus master to complete the read transaction is retried by the PowerSpan II
                PB Slave until the following byte quantities are available in the line buffer:
                •    32 bytes
                •    8 bytes if the RD_AMT=0 (see “Processor Bus Slave Image x Control Register” on page 287)
                •    16 bytes if the RD_AMT=1
                Read Amount
                All PowerSpan II PB slave reads destined for PCI Memory space are considered prefetchable to 8-byte
                boundaries by default. Setting the MEM_IO bit in the “Processor Bus Slave Image x Control Register”
                on page 287 enables 1,2,3, or 4 byte reads from the PCI bus(es).
Integrated Device Technology                                                                    PowerSpan II User Manual
www.idt.com                                                                                           80A1010_MA001_09


96                                                                                              3. Processor Bus Interface
              In order to program PowerSpan II to complete 4 byte reads on the PB bus, both the MEM_IO bit and
              the MODE bit must be set to 1 in the Processor Bus Slave Image x Control register.
              In order to perform a 4-byte read from the processor (60x) bus to PCI, the following bits must be
              programmed:
              •    MEM_IO bit set to 1
              •    MODE bit set to 1
              •    END bit, in the “Processor Bus Slave Image x Control Register” on page 287, must not be set to
                   little-endian mode (00). It can be set to PowerPC little-endian (01), or big-endian (10).
                          When the Slave Image Control register is programmed for 4 byte read transactions,
                          requesting 8 byte reads causes undefined results in the system.
              The amount of data prefetched on the destination bus is specified using the Prefetch Read Amount
              (RD_AMT[2:0]) field in the “Processor Bus Slave Image x Control Register” on page 287. If the
              Prefetch Keep (PRKEEP) bit is set, then PowerSpan II automatically increments the latched address
              every time the processor bus master returns for read data. This PRKEEP function enables a burst read
              by the
              PowerSpan II PCI Master to be unpacked as smaller transfers on the processor bus.
              The PB Interface can generate a 32-byte burst read with a starting address at the second, third or fourth
              8-byte quantity. A cache wrap read always causes the PB slave to make a 32-byte read request from the
              destination PCI bus. In other words, PRKEEP and RD_AMT[2:0] have no effect.
              There are instances where a read requires more data than that specified by RD_AMT. Since PB slaves
              cannot terminate transactions, PowerSpan II compensates for a potential hang situation — for example,
              not having enough read data — by over-riding the programming of RD_AMT. PowerSpan II prefetches
              the larger data value. This enables the PowerSpan II to accommodate the byte count specified by the
              transaction. Alternatively, it initiates a new read transaction on the destination if it does not have
              enough data to satisfy the transaction.
              The read amount values that can be programmed in the RD_AMT field are shown in Table 18. The
              read amount setting determines different values to prefetch from the destination bus.
              Table 18: Read Amount settings
                         RD_AMT[2:0]                      Data Fetched
                              000                            8 bytes
                              001                           16 bytes
                              010                           32 bytes
                              011                           64 bytes
                              100                          128 bytes
                            101-111                        Reserved
PowerSpan II User Manual                                                                    Integrated Device Technology
80A1010_MA001_09                                                                                              www.idt.com


3. Processor Bus Interface                                                                                             97
                Discard Timer
                Each PB slave image has a discard timer. If an external master does not claim data within 215 clocks
                after data is read from the destination bus, the Delayed Read Request latch is de-allocated. This
                prevents deadlock conditions. Read buffer contents are flushed but there is no error recorded and no
                interrupts are generated.
                Posted Writes
                Posted writes have dedicated line buffers and are treated independently of reads. A write to an image
                does not invalidate the contents of the read line buffer currently in use.
                Address Retry Disabled
                The PB Slave supports a single read at a time when ARTRY_EN is disabled. ARTRY_EN is disabled
                by setting the bit to 0. The PB slave acknowledges the address tenure with the PB_AACK_ signal and
                captures the address in the Delayed Read latch. However, when ARTRY_EN is disabled, the PB slave
                does not acknowledge the data transfer until the Read Amount (RD_AMT) field in the “Processor Bus
                Slave Image x Control Register” on page 287 is read. The Delayed Read Request latch is de-allocated
                when the external processor bus master completes the transaction.
                PRKEEP has no affect when PKEEP is set to 1 and ARTRY_EN is disabled. A maximum of 32 bytes
                can be programmed in the RD_AMT field.
3.3.2.5         Writes
                All writes are posted and are buffered separately from read data. The transaction length of the PB write
                is directly translated to the PCI bus with no address phase deletion. For example, a single cycle write
                on the PB results in a single cycle write on the PCI bus.
3.3.2.6         Data Parity
                Data parity is enabled by setting the Data Parity Enable (DP_EN) bit in the “Processor Bus
                Miscellaneous Control and Status Register” on page 304. Even parity or odd parity is enabled by
                setting the Parity (PARITY) bit in the same register.
                Parity generation and checking is provided for each byte of the data bus and for each data beat of the
                data tenure. Data parity bit assignments are as defined in Table 19.
                Table 19: PowerSpan II PB Data Parity Assignments
                  Data Bus                    Data Parity
                  PB_D[0:7]                   PB_DP[0]
                  PB_D[8:15]                  PB_DP[1]
                  PB_D[16:23]                 PB_DP[2]
                  PB_D[24:31]                 PB_DP[3]
                  PB_D[32:39]                 PB_DP[4]
Integrated Device Technology                                                                  PowerSpan II User Manual
www.idt.com                                                                                         80A1010_MA001_09


98                                                                                             3. Processor Bus Interface
              Table 19: PowerSpan II PB Data Parity Assignments
                Data Bus                   Data Parity
                PB_D[40:47]                PB_DP[5]
                PB_D[48:55]                PB_DP[6]
                PB_D[56:63]                PB_DP[7]
              The data parity bits, PB_DP[0:7], are driven to the correct values for even or odd parity by the PB slave
              during reads and checked during writes.
              The detection of a data parity error does not affect the transaction and data is still forwarded to the
              destination bus. See “Error Handling” on page 157 and “Interrupt Handling” on page 145 for a full
              description of error logging support and associated interrupt mapping options.
              Special Parity Requirements with the PowerQUICC II
              Address parity and data parity must be specially programmed in a joint
              PowerSpan II and PowerQUICC II application.
              In a joint application all memory accesses from the PowerQUICC II to
              PowerSpan II must be routed through the internal memory controller on the PowerQUICC II. When the
              data is passed through the memory controller both address parity and data parity can be used in the
              system.
              If accesses do not pass through the memory controller of the PowerQUICC II before reaching
              PowerSpan II, and PowerSpan II has either or both address and data parity enabled, then PowerSpan II
              reports parity errors on the transaction.
              To enable or disable address parity in PowerSpan II, set the Address Parity Enable (AP_EN) bit in the
              “Processor Bus Slave Image x Control Register” on page 287.
              To enable or disable data parity in PowerSpan II, set the Data Parity Enable (DP_EN) bit in the
              “Processor Bus Slave Image x Control Register” on page 287.
3.3.3         Terminations
              The following sections describe the terminations and exception handling supported by PowerSpan II.
3.3.3.1       PB Slave Termination
              The PB slave uses the following pins to indicate termination of individual data beats and/or data tenure:
              •    Address Retry (PB_ARTRY_): This signal terminates the entire address and data tenure and
                   schedules the transaction to be rerun. No data is transferred, even if asserted coincidentally with
                   PB_TA/PB_DVAL_, as in the case of a third party address retry.
              •    Transfer Acknowledge (PB_TA_): This signal is asserted by the PowerSpan II PB Slave to indicate
                   the successful transfer of a single beat transaction, or each 8-byte quantity transferred for a burst.
PowerSpan II User Manual                                                                   Integrated Device Technology
80A1010_MA001_09                                                                                             www.idt.com


3. Processor Bus Interface                                                                                           99
                •   Data Valid (PB_DVAL_): This signal is asserted by the PB slave to indicate the successful transfer
                    of an 8-byte quantity within an extended transfer of 16 or 24 bytes. PB_TA_ is asserted together
                    with PB_DVAL_ on the transfer of the last 8-byte quantity.
                •   Transfer Error Acknowledge (PB_TEA_): This signal indicates an unrecoverable error and causes
                    the external master to immediately terminate the data tenure.
                          The PB Slave does not assert a data termination signal earlier than the address retry window.
3.3.3.2         Assertion of PB_TEA_
                PowerSpan II asserts PB_TEA_ when a particular slave image cannot handle transactions involving
                more than 4 bytes. This applies to the following:
                •   register accesses (see “Register Access” on page 235)
                •   accesses to general purpose slave image configured for PCI I/O space
                •   access to registers designed to generate PCI Configuration or IACK commands (see
                    “Configuration and IACK Cycle Generation” on page 246)
                PowerSpan II also asserts PB_TEA_ if a read from PCI generates a Master-Abort or Target-Abort.
                The assertion PB_TEA_ is enabled or disabled with the TEA Enable (TEA_EN) bit in the “Processor
                Bus Miscellaneous Control and Status Register” on page 304.
                          In a development environment, the TEA_EN bit is set to allow the assertion of PB_TEA_ to
                          support the debug of software. In a production environment, customers may find it useful to
                          disable the assertion of PB_TEA_.
3.3.3.3         Errors
                The PowerSpan II PB Slave detects the following error conditions:
                •   address parity
                •   data parity on writes
                •   illegal accesses
                See “Error Handling” on page 157 and “Interrupt Handling” on page 145 for a full description of error
                logging support and associated interrupt mapping options.
Integrated Device Technology                                                                  PowerSpan II User Manual
www.idt.com                                                                                         80A1010_MA001_09


100                                                                                             3. Processor Bus Interface
3.4           PB Master Interface
              The PowerSpan II becomes active as PB Master when:
              •    PowerSpan II is accessed as a PCI target
              •    one of the PowerSpan II DMA engines is processing a transfer
              The operation of the PB Master is described by dividing a transaction into three different phases:
              •    Address Phase: This section discusses the arbitration for the address bus, and generation of the PB
                   address and transfer types.
              •    Data Transfer: This section describes arbitration for the data bus, and control of transaction size
                   and length.
              •    Terminations: This section describes the terminations supported by
                   PowerSpan II, and exception handling.
3.4.1         Address Phase
              The address phase deals with the arbitration for the address bus, and generation of the PB address and
              transfer types.
3.4.1.1       Address Bus Arbitration and Tenure
              The PB Master asserts Address Bus Busy (PB_ABB_) to indicate address bus ownership after it
              receives a qualified bus grant for its address bus request. A qualified bus grant assumes the following:
              •    address bus grant asserted
              •    PB_ARTRY_ negated
              •    address bus not busy
              The PB Master negates PB_ABB_ for at least one clock after Address Acknowledge (PB_AACK_) has
              been asserted by the slave. This is true even if the arbiter parked the bus on PowerSpan II. For example,
              in Figure 13 on page 105 the bus is parked at the PowerSpan II (PB_BG[1]_ is asserted throughout),
              PB_ABB_ is negated the first positive clock edge after sampling PB_AACK_.
                         The PowerSpan II PB Master derives equivalent Address Bus Busy information from
                         processor bus control signals. This allows the PowerSpan II processor bus arbiter to operate
                         in 60x environments that do not implement ABB. The PowerQUICC II uses ABB to qualify
                         address bus grants generated by the system arbiter.
              The PB Master operates in a multi-processor, cache-coherent PowerPC environment that requires
              correct implementation of the window of opportunity. The following PB Master behavior supports the
              window of opportunity:
              •    respond to PB_ARTRY_ in the address retry window
              •    snoop PB_ARTRY_
PowerSpan II User Manual                                                                    Integrated Device Technology
80A1010_MA001_09                                                                                             www.idt.com


3. Processor Bus Interface                                                                                              101
                Negating Address Bus Requests
                When the PB Master (as current address bus owner) detects Address Retry (PB_ARTRY_) asserted
                during the address retry window, it negates its bus request for at least one clock. This guarantees the
                snooping master that retried the cycle an opportunity to request and be granted the bus before the
                PowerSpan II PB Master can restart its transaction. Once the bus is re-acquired, the PB Master restarts
                the transaction.
                Cache Coherency
                The Global (PB_GBL_) and Cache Inhibit (PB_CI_) parameters are programmable for each PCI target
                image and DMA channel (GBL and CI in the “PCI-1 Target Image x Control Register” on page 268
                and the “DMA x Attributes Register” on page 317). Assertion of PB_GBL_ during a PB master
                transaction instructs all processors on the bus to snoop the transaction. Control of this parameter allows
                the user to implement non-coherent accesses in specific areas of memory. Assertion of PB_CI_
                prohibits external agents from caching the transaction. This ability is useful in a system with an L2
                look aside cache.
                The PB Master, along with all other bus masters, are required to snoop ARTRY_ when they are not the
                bus owner. If ARTRY_ is asserted, the masters must ensure the following actions are taken:
                •    release bus request, if it is asserted, for at least one clock
                •    do not acquire the bus if presently granted
                •    do not assert bus request during the window of opportunity
                To ensure a transaction is retried, systems assert PB_ARTRY_ at, or before, the first assertion of
                PB_TA_. This timing avoids a data tenure being terminated after data is transferred between bus
                agents. Normally, a retry scenario implies PB_ARTRY_ assertion one clock after assertion of the
                PB_AACK_ — in the address retry window. In certain systems however, the first assertion of PB_TA
                can occur before PB_AACK_. If this situation occurs, PB_ARTRY_ must be asserted at the same time
                as the first assertion of PB_TA_ and must be held until the clock after PB_AACK_ assertion.
                Address Pipelining
                The PB Master can operate in a system that implements up to one level of address pipelining. The PB
                Master does not prohibit other bus agents from pipelining transactions.
                           When mastering the bus, the PB Master can begin a new address tenure before the current
                           data tenure completes.
                Internal and External Arbitration
                When the PowerSpan II processor bus arbiter is enabled (see “Arbitration” on page 137) all processor
                bus master address bus requests and grants are internal to PowerSpan II. When an external arbiter is
                used, the PB Master requests the address bus on PB_BR[1]_ and receives grants on PB_BG[1]_. For
                example, PowerSpan II’s internal arbiter is disabled in Figure 13 on page 105.
Integrated Device Technology                                                                    PowerSpan II User Manual
www.idt.com                                                                                           80A1010_MA001_09


102                                                                                         3. Processor Bus Interface
3.4.1.2       Address Translation
              The address generated by the PB Master is dependent on the use of address translation in the source
              target image (see “PCI-1 Target Image x Control Register” on page 268. When address translation is
              enabled — TA_EN bit is set in the PCI target image— PowerSpan II produces the processor bus
              address using three inputs:
              •    the incoming address from the source bus
              •    the block size of the target image
              •    the translation offset
              This does not apply to DMA transfers because the destination address is assumed to have the necessary
              offset by design.
              For more information, see “DMA x Destination Address Register” on page 310.
3.4.1.3       Transaction type
              The transfer type parameter of a PB master transaction, PB_TT, is specified with the PCI target image
              or DMA channel registers. The following registers control the parameter for write transactions:
              •    WTT[4:0] field in the “PCI-1 Target Image x Control Register” on page 268
              •    WTT[4:0] field in the “DMA x Attributes Register” on page 317
              The following registers control the parameter for read transactions:
              •    RTT[4:0] field in the “PCI-1 Target Image x Control Register” on page 268
              •    RTT[4:0] field in the “DMA x Attributes Register” on page 317
              The default transfer type generated by the PowerSpan II PB Interface master is shown in Table 20.
              Table 20: Default PowerSpan II PB Master Transfer Type
                PB Master Transaction          PB_TT[0:4]     Processor Bus Command
                Writes                         00010          Write with flush
                Reads                          01010          Read
3.4.1.4       Address Parity
              Address parity generation is provided on each byte of the address bus. Address parity bit assignments
              are defined in Table 21
              Table 21: PowerSpan II PB Address Parity Assignments
                Address Bus                          Address Parity
                PB_A[0:7]                            PB_AP[0]
                PB_A[8:15]                           PB_AP[1]
PowerSpan II User Manual                                                                Integrated Device Technology
80A1010_MA001_09                                                                                         www.idt.com


3. Processor Bus Interface                                                                                            103
                Table 21: PowerSpan II PB Address Parity Assignments
                  Address Bus                        Address Parity
                  PB_A[16:23]                        PB_AP[2]
                  PB_A[24:31]                        PB_AP[3]
                During PB master transactions, PB_AP[0:3] is driven to the correct values for either even parity or odd
                parity. Odd versus even parity is controlled with the PARITY bit in the “Processor Bus Miscellaneous
                Control and Status Register” on page 304.
3.4.2           Data Phase
                The data phase deals with arbitration for the data bus, and control of transaction size and length.
3.4.2.1         Data Bus Arbitration and Tenure
                The PB Master generates a data bus request by driving Transfer Type (PB_TT[3]) high during assertion
                of Transfer Start (PB_TS_). The PB Master asserts Data Bus Busy (PB_DBB_) to indicate data bus
                ownership when it receives a qualified bus grant (see Figure 13 on page 105). A qualified bus grant
                includes:
                •   Data Bus Grant (DBG) signal asserted
                          If the DBG signal is asserted past the data tenure of a transaction, the PB Master sees the
                          assertion of the DBG signal as a new data tenure and re-asserts PB_DBB_.
                •   PB_ARTRY_ negated
                •   Data bus not busy
                          External slaves must not indicate a successful data transfer with the assertion of PB_TA_
                          and/or PB_DVAL_ earlier than two clocks after the assertion of PB_TS_. To ensure
                          PowerQUICC II compliance with this rule, the PowerQUICC II register BCR[APD] must be
                          programed to a value greater than one. This parameter specifies the earliest time after
                          assertion of PB_TS_ that the PowerQUICC II slave asserts PB_TA_ to complete a data
                          transfer. The BCR[APD] parameter is supported by the PowerQUICC II to accommodate
                          processor bus agents with a range of snoop response times. BCR[APD] must be programmed
                          to accommodate the slowest snooping device in the system.
                The PB Master negates PB_DBB_ for at least one clock after the final data termination signal is
                asserted by the slave.
                          The PowerSpan II PB Master derives equivalent Data Bus Busy information from PB control
                          signals. This allows the PowerSpan II processor bus arbiter to operate in processor bus
                          environments that do not implement DBB. Some processors (for example the PowerQUICC
                          II) use DBB to qualify data bus grants generated by the system arbiter.
Integrated Device Technology                                                                    PowerSpan II User Manual
www.idt.com                                                                                          80A1010_MA001_09


104                                                                                            3. Processor Bus Interface
3.4.2.2       Transaction Length
              The PB Master can generate a super-set of the data transfer sizes supported by the embedded PowerPC
              family. The user can disable certain data transfer sizes that are unique to the PowerQUICC II. All data
              transfer sizes supported by the PowerSpan II PB master are illustrated in Table 22 below. Burst
              transfers are indicated by the assertion of Processor Bus Transfer Burst (PB_TBST_, see Figure 13 and
              Figure 14). PB_TBST_ is negated during single cycle transactions (see Figure 15 and Figure 16
              below).
              The shaded regions in Table 22 indicate transaction sizes that are unique to the PowerQUICC II. The
              extended cycles supported by the PowerQUICC II are identified with an additional size pin, Processor
              Bus Transfer Size (PB_TSIZ[0]). Extended cycles are enabled using the EXTCYC bit in the “Processor
              Bus Miscellaneous Control and Status Register” on page 304.
                          PowerSpan II only interfaces to 64-bit slaves.
              Table 22: PowerSpan II PB Transfer Sizes
                             Transfer Size                  Bytes       PB_TBST       PB_TSIZ[0]        PB_TSIZ[1:3]
                Byte                                           1            1               0                001
                Half-word                                      2            1               0                010
                Tri-byte                                       3            1               0                011
                Word                                           4            1               0                100
                Five bytes                                     5            1               0                101
                Six bytes                                      6            1               0                110
                Seven bytes                                    7            1               0                111
                Double Word (DW)                               8            1               0                000
                Extended Double (PowerQUICC II only)          16            1               1                001
                Extended Triple (PowerQUICC II only)          24            1               1                010
                Burst (Quad DW)                               32            0               0                010
              The following figures, Figure 13 and Figure 14, illustrate burst reads and burst writes on the PB
              Master.
PowerSpan II User Manual                                                                   Integrated Device Technology
80A1010_MA001_09                                                                                            www.idt.com


3. Processor Bus Interface                                                                                          105
                Figure 13: PB Master Interface Burst Read
                        PB_CLK
                      PB_BR[1]_
                      PB_BG[1]_
                       PB_ABB_
                        PB_TS_
                      PB_A[0:31]
                      PB_AP[0:3]
                      PB_TBST_
                    PB_TSIZ[0:3]
                      PB_TT[0:4]     0A
                      PB_AACK_
                     PB_ARTRY_
                    PB_DBG_IN_
                        PB_DBB
                      PB_D[0:63]
                      PB_DP[0:7]
                      PB_DVAL_
                        PB_TA_
                       PB_TEA_
                Figure 14: PB Master Interface Burst Write
                        PB_CLK
                      PB_BR[1]_
                      PB_BG[1]_
                       PB_ABB_
                        PB_TS_
                      PB_A[0:31]
                      PB_AP[0:3]
                      PB_TBST_
                    PB_TSIZ[0:3]
                      PB_TT[0:4]     02
                       PB_AACK
                     PB_ARTRY_
                    PB_DBG_IN_
                        PB_DBB
                      PB_D[0:63]
                      PB_DP[0:7]
                      PB_DVAL_
                        PB_TA_
                       PB_TEA_
                The following figures, Figure 15 and Figure 16, illustrate single cycle read and single cycle write
                transfers on the PB Master Interface.
Integrated Device Technology                                                                  PowerSpan II User Manual
www.idt.com                                                                                         80A1010_MA001_09


106                                                                                           3. Processor Bus Interface
              Figure 15: PB Master Interface Single Cycle Read
                     PB_CLK
                  PB_BR[1]_
                 PB_BG[1]_
                   PB_ABB_
                     PB_TS_
                 PB_A[0:31]
                 PB_AP[0:3]
                  PB_TBST_
                PB_TSIZ[0:3]
                 PB_TT[0:4]                            0A
                 PB_AACK_
                PB_ARTRY_
               PB_DBG_IN_
                   PB_DBB_
                 PB_D[0:63]
                 PB_DP[0:7]
                 PB_DVAL_
                     PB_TA_
                   PB_TEA_
              Figure 16: PB Master Interface Single Cycle Write
                       PB_CLK
                     PB_BR[1]_
                     PB_BG[1]_
                      PB_ABB_
                       PB_TS_
                    PB_A[0:31]
                    PB_AP[0:3]
                     PB_TBST_
                 PB_TSIZ[0:3]
                    PB_TT[0:4]                                   02
                     PB_AACK_
                   PB_ARTRY_
                  PB_DBG_IN_
                      PB_DBB_
                    PB_D[0:63]
                    PB_DP[0:7]
                     PB_DVAL_
                       PB_TA_
                      PB_TEA_
3.4.2.3       Data Alignment
              Embedded processor bus transfer sizes and alignments are supported by the
              PowerSpan II PB Master for transaction accesses. The PB master creates the necessary sequence of
              transactions from a set of processor bus data size and alignment options. The size and alignment
              combinations defined in Table 24 are supported by the PowerQUICC II, PowerPC 7xx, and
              PowerPC 750 processors. This set includes:
              •     transactions less than or equal to 8-bytes (single beat transactions)
              •     specific misaligned transactions
              •     extended transactions of 16 or 24-bytes
              •     burst of 32-bytes
PowerSpan II User Manual                                                                  Integrated Device Technology
80A1010_MA001_09                                                                                           www.idt.com


3. Processor Bus Interface                                                                                              107
                Table 23 illustrates the lanes used to carry each byte of a multi-byte structure on a 64-bit processor data
                bus.
Table 23: 64-bit PB Data Bus Byte Lane Definitions
   Byte Address                                                 PB Byte Lanes
                                                                PowerQUICC II        PowerPC 7xx
   PB_A[29:31]       Lane Number        PowerSpan II Pins            Pins                 Pins            WinPath Pins
        000                0           PB_D[0:7]              D[0:7]               DH[0:7]              H_DATA[63:56]
        001                1           PB_D[8:15]             D[8:15]              DH[8:15]             H_DATA[55:48]
        010                2           PB_D[16:23]            D[16:23]             DH[16:23]            H_DATA[47:40]
        011                3           PB_D[24:31]            D[24:31]             DH[24:31]            H_DATA[39:32]
        100                4           PB_D[32:39]            D[32:39]             DL[0:7]              H_DATA[31:24]
        101                5           PB_D[40:47]            D[40:47]             DL[8:15]             H_DATA[23:16]
        110                6           PB_D[48:55]            D[48:55]             DL[16:23]            H_DATA[15:8]
        111                7           PB_D[56:63]            D[56:63]             DL[24:31]            H_DATA[7:0]
Integrated Device Technology                                                                     PowerSpan II User Manual
www.idt.com                                                                                            80A1010_MA001_09


108                                                                                           3. Processor Bus Interface
              Table 24 lists the size and alignment transactions less than or equal to 8-bytes. The shaded table cells
              show transactions that support the PowerPC 7400 processor.
Table 24: PowerSpan II Processor Bus Single Beat Data Transfers
 Size         TSIZ[0:3]      A[29:31]                                  Data Bus Byte Lanes
                                           0        1         2         3         4         5         6        7
 Byte         0001           000           D0
              0001           001                    D1
              0001           010                              D2
              0001           011                                        D3
              0001           100                                                  D4
              0001           101                                                            D5
              0001           110                                                                      D6
              0001           111                                                                               D7
 Half word    0010           000           D0       D1
              0010           001                    D1        D2
              0010           010                              D2        D3
              0010           011                                        D3        D4
              0010           100                                                  D4        D5
              0010           101                                                            D5        D6
              0010           110                                                                      D6       D7
 Tri-byte     0011           000           D0       D1        D2
              0011           001                    D1        D2        D3
              0011           010                              D2        D3        D4
              0011           011                                        D3        D4        D5
              0011           100                                                  D4        D5        D6
              0011           101                                                            D5        D6       D7
PowerSpan II User Manual                                                                  Integrated Device Technology
80A1010_MA001_09                                                                                           www.idt.com


3. Processor Bus Interface                                                                                           109
Table 24: PowerSpan II Processor Bus Single Beat Data Transfers
  Size          TSIZ[0:3]       A[29:31]                                Data Bus Byte Lanes
 Word           0100            000          D0        D1       D2        D3
                0100            001                    D1       D2        D3        D4
                0100            010                             D2        D3        D4       D5
                0100            011                                       D3        D4       D5       D6
                0100            100                                                 D4       D5       D6        D7
 Five bytes     0101            000          D0        D1       D2        D3        D4
                0101            001                    D1       D2        D3        D4       D5
                0101            010                             D2        D3        D4       D5       D6
                0101            011                                       D3        D4       D5       D6        D7
 Six bytes      0110            000          D0        D1       D2        D3        D4       D5
                0110            001                    D1       D2        D3        D4       D5       D6
                0110            010                             D2        D3        D4       D5       D6        D7
 Seven bytes    0111            000          D0        D1       D2        D3        D4       D5       D6
                0111            001                    D1       D2        D3        D4       D5       D6        D7
 Double word    0000            000          D0        D1       D2        D3        D4       D5       D6        D7
                           The information in Table 24 is independent of endian considerations and pertains to byte lane
                           control on the processor bus. For endian considerations, please consult “Endian Mapping” on
                           page 177.
                PowerPC 7400 Transaction Support
                The PowerPC 7400 processors supports misaligned transactions within a double word (64-bit aligned)
                boundary. As long as the transaction does not cross the double word boundary, the PowerPC 7400 can
                transfer data on the misaligned address.
                PowerSpan II supports a specific types of the PowerPC 7400 misaligned transactions (shown in
                Table 24) when the MODE_7400 bit is set in the “Processor Bus Miscellaneous Control and Status
                Register” on page 304. Any misaligned transaction between PowerSpan II and the PowerPC 7400 that
                is a single word (32-bit) or less must be within a single word aligned boundary. Any transfer greater
                than a single word must start or end on a word boundary.
                           Software must make sure that the PowerPC 7400 does not initiate unsupported misaligned
                           transactions to PowerSpan II.
Integrated Device Technology                                                                  PowerSpan II User Manual
www.idt.com                                                                                         80A1010_MA001_09


110                                                                                           3. Processor Bus Interface
3.4.2.4       Cache Line Size
              The PowerPC processors supported by PowerSpan II implement a 32-byte cache line size (8 words).
              Cache wrap bursts are not generated because the PB master starts a burst transaction at a 32-byte
              aligned address. For a transaction that is not 32-byte aligned, the PB master utilizes one or more single
              beat or extended transaction size, to align to the cache line boundary, before generating the required
              burst transaction or transactions.
                         The PowerSpan II PB Master assumes all external slaves can accept burst transactions.
3.4.2.5       Data Parity
              Data Parity is enabled by setting the DP_EN bit in the Processor Bus Control and Status register (see
              “Processor Bus Miscellaneous Control and Status Register” on page 304). Even or odd parity can be
              enabled by setting the PARITY bit on the Processor Bus Control and Status register.
              Parity generation and checking is provided for each byte of the data bus and for each data beat of the
              data tenure. Data parity bit assignments are as defined in Table 25.
              Table 25: PowerSpan II PB Data Parity Assignments
                Data Bus                      Data Parity
                PB_D[0:7]                     PB_DP[0]
                PB_D[8:15]                    PB_DP[1]
                PB_D[16:23]                   PB_DP[2]
                PB_D[24:31]                   PB_DP[3]
                PB_D[32:39]                   PB_DP[4]
                PB_D[40:47]                   PB_DP[5]
                PB_D[48:55]                   PB_DP[6]
                PB_D[56:63]                   PB_DP[7]
              The data parity bits, PB_DP[0:7], are driven to the correct values for even or odd parity by the PB
              Master during writes. If checking is enabled (by setting the DP_EN bit) the data parity bits,
              PB_DP[0:7], are checked by the PB Master during reads. The detection of a data parity error does not
              affect the transaction, and data is still forwarded to the destination.
              See “Error Handling” on page 157 and “Interrupt Handling” on page 145 for a full description of error
              logging support and associated interrupt mapping options.
PowerSpan II User Manual                                                                  Integrated Device Technology
80A1010_MA001_09                                                                                            www.idt.com


3. Processor Bus Interface                                                                                             111
3.4.3           Terminations
                The PB master uses the following pins as termination signals for individual data beats and data tenure:
                •    Address Retry (PB_ARTRY_): This signal terminates the entire data tenure and schedules the
                    transaction to be rerun. No data is transferred.
                •   Transfer Acknowledge (PB_TA_): This signal is asserted by the external slave to indicate the
                    successful transfer of a single beat transaction, or each 8 byte quantity transferred for a burst.
                •   Data Valid (PB_DVAL_): This signal is asserted by the external slave to indicate the successful
                    transfer of a quantity of data. The PowerQUICC II provides this pin to support the termination of
                    extended cycles. The external slave asserts this pin once for each successful 8 byte transfer.
                    PB_TA_ is asserted, with PB_DVAL_, on the final transfer of the transaction. The slave uses
                    PB_TA_ and/or PB_DVAL_ to insert wait states. The PB master ignores PB_DVAL_ when the
                    EXTCYC bit cleared in the “Processor Bus Miscellaneous Control and Status Register” on
                    page 304.
                •   Transfer Error Acknowledge (PB_TEA): This signal indicates an unrecoverable error and causes
                    the PB master to immediately terminate the data tenure.
3.4.3.1         Errors
                The PB master detects three error conditions:
                •   data parity on reads
                •   assertion of PB_TEA_ by external slave
                •   expiration of maximum retry counter (MAX_RETRY bit in the “Processor Bus Miscellaneous
                    Control and Status Register” on page 304).
                See “Error Handling” on page 157 and “Interrupt Handling” on page 145 for a full description of error
                logging support and associated interrupt mapping options.
Integrated Device Technology                                                                    PowerSpan II User Manual
www.idt.com                                                                                           80A1010_MA001_09


112                          3. Processor Bus Interface
PowerSpan II User Manual Integrated Device Technology
80A1010_MA001_09                          www.idt.com


                                                                                                                   113
4.              DMA
                A direct memory access (DMA) channel allows a transaction to occur between two devices without
                involving the host processor (for example, a read transaction between a peripheral device and host
                processor memory). Because less time is required to complete transactions, applications that contain
                one or more DMA channels support faster read and write transfers than applications that support only
                host-assisted transactions.
                discusses the following topics about the PowerSpan II DMA:
                •   “DMA Register Description” on page 114
                •   “Direct Mode DMA Operation” on page 118
                •   “Linked-List Mode DMA Operation” on page 120
                •   “DMA Interrupts” on page 124
                •   “DMA Error Handling” on page 124
4.1             Overview
                PowerSpan II has four identical Direct Memory Access (DMA) channels for independent data transfer
                between the three ports of the Dual PCI PowerSpan II: Processor Bus Interface (PB), PCI Interface 1
                (PCI-1) and PCI Interface 2 (PCI-2). The programming and operation of the four DMAs are the same.
                This chapter discusses DMA operation within the context of a single channel. In addition, since the
                DMAs are able to transfer data from any port to any port, the DMA discussion refers to “source” bus
                and “destination” bus with no reference to bus type. Exceptions to this guideline are noted in the
                manual.
                          In the Single PCI PowerSpan II, the PCI-2 specific DMA bits must not be programmed.
                          DMA transfers must not be directed to the PCI-2 Interface.
                There are two modes of operation for the PowerSpan II DMA: Direct mode and Linked-List mode. In
                Direct mode, the DMA control registers are directly programmed for each DMA transfer — one start
                address and transfer size. In Linked-List mode, the PowerSpan II loads its DMA registers from a
                linked-list of “command packets”. The packets are essentially pre-programmed register contents for a
                PowerSpan II DMA channel.
Integrated Device Technology                                                                 PowerSpan II User Manual
www.idt.com                                                                                        80A1010_MA001_09


114                                                                                                                    4. DMA
4.2           DMA Register Description
              The DMA registers are the same for each DMA channel. DMA registers are described in Table 26. The
              registers for DMA1 begin at offset 0x300 and their organization in PowerSpan II register space is
              described in “Register Descriptions” on page 235.
              Table 26: DMA Register Description
                Register              Register Description and Operation
                DMAx_SRC_ADDR         The Source Address Register can be programmed for an address on any one of the
                                      three PowerSpan II buses. This register can be programmed in Direct mode or
                                      automatically loaded in Linked-List mode. Writing to this register while the DMA is in
                                      operation has no effect. While the DMA is active, this register provides the current
                                      status of the source address. This address is byte-aligned.
                DMAx_DST_ADDR         The Destination Address Register can be programmed for an address on any one of
                                      the three PowerSpan II buses — even the same bus as that used for the Source
                                      Address. This register can be programmed in Direct mode or automatically loaded in
                                      Linked-List mode. Writing to this register while the DMA is in operation has no effect.
                                      While the DMA is active, this register provides the status of the current destination
                                      address. This address is byte-aligned. The lower bits on the destination address are
                                      the same as the lower bits on the source address.
                DMAx_TCR              The DMA Transfer Control Register specifies the source and destination buses, the
                                      endian conversion mode of a transfer involving the processor bus and a PCI bus (see
                                      “Endian Mapping” on page 177), and specifies the byte count from any remaining
                                      Direct mode operation.
                DMAx_CPP              The DMA Command Packet Pointer register specifies the 32-byte aligned address of
                                      the next command packet in the linked-list. This is programmed by PowerSpan II as it
                                      loads a command packet. There is a LAST flag in this register to indicate the end of
                                      the linked-list.
                DMAx_GCSR             The DMA General Control and Status Register controls DMA activity, reflects
                                      operational status and enables DMA-specific interrupts (see Table 27)
                DMAx_ATTR             The DMA Attributes Register controls the transfer type and cache-specific behavior
                                      of processor bus transactions. It also selects the command packet port.
                         Most DMA channel registers are locked against any changes by the user while the channel is
                         active. However, both the Stop Request (STOP_REQ) and Halt Request (HALT_REQ) bits,
                         in the “DMA x General Control and Status Register” on page 314, are not locked.
4.2.1         Source and Destination Addresses
              The lower three bits of DMA Destination Address register are taken directly from the lower three bits
              of the Source Address register. This enforces 8-byte alignment of the starting source and destination
              addresses. The source and destination address registers are part of the command packet contents
              (“Linked-List Mode DMA Operation” on page 120).
PowerSpan II User Manual                                                                      Integrated Device Technology
80A1010_MA001_09                                                                                                 www.idt.com


4. DMA                                                                                                                  115
                The starting byte address on the source port is specified in “DMA x Source Address Register” on
                page 309. The starting byte address on the Destination port is specified in “DMA x Destination
                Address Register” on page 310.
4.2.2           Transfer Control Register
                The “DMA x Transfer Control Register” on page 311 details the programming options for this register.
                It controls the direction of the transfer, the endian conversion between the processor bus and the PCI
                bus and specifies the transfer byte count. Note that the maximum byte count is 16 Mbytes. The DMA
                Transfer Control Register is part of the command packet contents (“Linked-List Mode DMA
                Operation” on page 120).
                           In the Single PCI PowerSpan II, the PCI-2 specific DMA bits must not be programmed.
                           DMA transfers must not be directed to the PCI-2 Interface.
4.2.3           Command Packet Addressing
                The “DMA x Command Packet Pointer Register” on page 313 specifies the address for the command
                packets in Linked-List mode. See “Linked-List Mode DMA Operation” on page 120 for more details
                on command packet processing.
4.2.4           Address Retry
                The Address Retry Enable (ARTRY_EN) bit in the “Processor Bus Miscellaneous Control and Status
                Register” on page 304 controls PowerSpan II’s assertion of PB_ARTRY_ during the servicing of
                transactions. When the ARTRY_EN bit is set to 0, the PB Slave is disabled from generating address
                retries.
4.2.4.1         DMA Addresses and Retries
                If a PowerSpan II DMA transaction is retried enough times the its retry counter may expire. When the
                retry timer expires, the DMA transaction does not try to restart the transaction at the original address; it
                jumps the address. The new address starts at the nearest address boundary. The nearest address
                boundary depends on the value programmed in the DBS field (see “DMA x General Control and Status
                Register” on page 314). For example, the nearest address boundary for an incremented address when
                the DMA block size is set to 128 bytes is 0x80. In this case, the equation for the incremented address
                value is: original address + 0x80.
                By advancing the address, PowerSpan II provides a method to step-out of the error condition.
Integrated Device Technology                                                                    PowerSpan II User Manual
www.idt.com                                                                                           80A1010_MA001_09


116                                                                                                                  4. DMA
4.2.5         General DMA Control and Status
              The “DMA x General Control and Status Register” on page 314 is not part of the command packet
              contents and is set up prior to any DMA operation (Direct or Linked-List mode). The contents of the
              DMA General Control and Status Register are described in Table 27 below.
Table 27: Programming Model for DMA General Control and Status Register
 Bits             Type       Description                                                         Default Setting
 GO               Write 1 to Initiates DMA activity                                              Clear
                  set
 CHAIN            R/W        Enables the Linked-List mode of operation.                          Disabled
 STOP_REQ         Write 1 to Stops DMA operation after the internally buffered data is written   Clear
                  set        out to the destination bus.
 HALT_REQ         Write 1 to Halts DMA operation after the completion of the current             Clear
                  set        command packet.
 DACT             R          Provides status of DMA activity (active or inactive).               Clear
 DBS[1:0]         R/W        Controls the byte size of DMA transactions when DBS_EN is           Clear
                             set to 1.
 DBS_EN           R/W        Enables byte size control of transactions generated by the DMA      Clear
                             Channel. Transaction size is based on the setting of the DBS
                             field.
 OFF              R/W        DMA Channel Off Counter (number of PB clocks)                       Clear
                             Controls the number of Processor clocks between sequential
                             PB tenures.
 P1_ERR           R/         A status bit indicating an error has occurred on PCI-1.             Clear
                  Write 1 to
                  clear
 P2_ERR           R/         A status bit indicating an error has occurred on                    Clear
                  Write 1 to PCI-2. Disregard this bit with the Single PCI PowerSpan II.
                  clear
 PB_ERR           R/         A status bit indicating an error has occurred on the processor      Clear
                  Write 1 to bus.
                  clear
 STOP             R/         A status bit indicating if the DMA has been stopped                 Clear
                  Write 1 to (STOP_REQ was set)
                  clear
 HALT             R/         A status bit indicating if the DMA has been halted (HALT_REQ        Clear
                  Write 1 to was set).
                  clear
PowerSpan II User Manual                                                                       Integrated Device Technology
80A1010_MA001_09                                                                                                 www.idt.com


4. DMA                                                                                                               117
Table 27: Programming Model for DMA General Control and Status Register
 Bits              Type        Description                                                      Default Setting
 DONE              R/          A status bit indicating if the DMA has been completed its Direct Clear
                   Write 1 to  mode or Linked-List mode.
                   clear
 P1_ERR_EN         R/W         Enables an interrupt if an error occurs on PCI-1.                Disabled
 P2_ERR_EN         R/W         Enables an interrupt if an error occurs on PCI-2. Do not         Disabled
                               program this bit if using the Single PCI PowerSpan II.
 PB_ERR_EN         R/W         Enables an interrupt if an error occurs on the processor bus.    Disabled
 STOP_EN           R/W         Enables an interrupt if the DMA has been stopped (STOP_REQ       Disabled
                               bit was set).
 HALT_EN           R/W         Enables an interrupt if the DMA has been halted (HALT_REQ        Disabled
                               bit was set).
 DONE_EN           R/W         Enables an interrupt if the DMA completes its Direct mode or     Disabled
                               Linked-List mode.
4.2.6           Processor Bus Transfer Attributes
                The “DMA x Attributes Register” on page 317 controls the read and write transactions generated by
                the DMA as a processor bus master.
                The default transfer type generated by the processor bus master is shown in Table 28.
                Table 28: Default PowerSpan II PB Master Transfer Type
                  PB Master Transfer                     PB_TT[0:4]        60x Command
                  Writes                                 00010             Write with flush
                  Reads                                  01010             Read
                The Global (PB_GBL_) and Cache Inhibit (PB_CI_) parameters are programmable for each DMA in
                the“DMA x Attributes Register” on page 317. Assertion of PB_GBL_ during a processor bus master
                transaction instructs all processors on the bus to snoop the transaction. Control of this parameter
                enables the user to implement non-coherent accesses in specific areas of memory. Assertion of PB_CI_
                prohibits external agents from caching the transaction.
Integrated Device Technology                                                                     PowerSpan II User Manual
www.idt.com                                                                                            80A1010_MA001_09


118                                                                                                           4. DMA
4.3           Direct Mode DMA Operation
              In Direct mode, the contents for all of a DMA channel registers are directly programmed into
              PowerSpan II before every DMA operation (see Table 26). This results in higher software overhead
              than in Linked-List mode since PowerSpan II register accesses are required for every DMA block
              transfer.
4.3.1         Initializing a Direct Mode Operation
              The GO bit in the “DMA x General Control and Status Register” on page 314 is used when the
              following conditions are met:
              •    The CHAIN bit is zero which indicates a Direct mode operation
              •    All status bits in the DMA General Control and Status Register are cleared, including: P1_ERR,
                   P2_ERR, PB_ERR, STOP, HALT, DONE
              The CHAIN bit and status bits can be properly configured on the same register write which sets the GO
              bit.
              The DMA channel delivers data from the source port to the destination port until:
              •    DMA is stopped by setting the STOP_REQ bit
              •    DMA encounters an error on one of the buses
              •    transfer byte count decrements to zero
              When the Direct mode operation completes the programmed transfer, PowerSpan II sets the DONE bit.
              The operation completes when the transfer byte count decrements to zero. The operation of a Direct
              mode operation is illustrated in Figure 17.
PowerSpan II User Manual                                                                Integrated Device Technology
80A1010_MA001_09                                                                                         www.idt.com


4. DMA                                                                                         119
                Figure 17: Direct Mode DMA Transfers
                                     Program:
                                     Source and destination
                                     addresses
                                     Transfer size and addresses
                                     Ensure status bits are clear
                                     Set GO bit
                                     Await termination of DMA
                                               Normal          No
                                           Termination?           Handle error
                                                    Yes
                                                 More
                                   Yes         transfers
                                              required?
                                                    No
                                                 Done
Integrated Device Technology                                               PowerSpan II User Manual
www.idt.com                                                                    80A1010_MA001_09


120                                                                                                             4. DMA
4.3.1.1       Direct Mode Transfer Acknowledgment
              The following registers are updated during a transfer and can be used to monitor status during DMA
              channel activity:
              •    DMA Source Address (DMAx_SRC_ADDR) in the “DMA x Source Address Register” on
                   page 309
              •    DMA Destination Address (DMAx_DST_ADDR) in the “DMA x Destination Address Register”
                   on page 310
              •    Byte Count (BC[23:0]) field in the “DMA x Destination Address Register” on page 310.
4.3.1.2       Terminating a Direct Mode Transfer
              The current Direct mode transfer can be stopped by writing 1 to the STOP_REQ bit in the “DMA x
              General Control and Status Register” on page 314. When this occurs, the channel stops attempting to
              buffer data from the source bus. When the remaining buffered source data is written to the destination
              bus, the STOP status bit is set.
              The channel can be restarted by clearing the STOP status bit (along with any other status bits) and then
              writing a 1 to the GO bit.
                        Due to the pipelined nature of DMA channel requests, up to 256-bytes can be transferred after
                        the user programmed the initial stop request.
4.4           Linked-List Mode DMA Operation
              In Linked-List (scatter-gather) mode, PowerSpan II steps through a linked series of command packets
              in external memory. The DMA is configured with the starting address of this list and independently
              reads command packets and executes the transfers specified.
PowerSpan II User Manual                                                                Integrated Device Technology
80A1010_MA001_09                                                                                          www.idt.com


4. DMA                                                                                                                        121
                Each command packet is 32-byte aligned. If the command packets are resident in PCI memory, the byte
                ordering is little-endian. If the command packets are resident in processor bus memory, the byte
                ordering is big-endian. command packets can reside on any one of the three PowerSpan II interfaces.
                The contents of a command packet are described, with the associated DMA register, in Table 29.
                Table 29: Programming Model for the Command Packet Contents
                 Register                            Register Description and Operation
                 DMAx_SRC_ADDR                       The Source Address Register can be programmed for an address on any
                                                     one of the three PowerSpan II buses. This register can be programmed in
                                                     Direct mode or automatically loaded in Linked-List mode. Writing to this
                                                     register while the DMA is in operation has no effect. While the DMA is
                                                     active, this register provides the status on the current source address.
                                                     This address is byte-aligned.
                 DMAx_DST_ADDR                       The Destination Address Register can be programmed for an address on
                                                     any one of the three PowerSpan II buses (including the same bus as that
                                                     used for the Source Address). This register can be programmed in Direct
                                                     mode or automatically loaded in Linked-List mode. Writing to this register
                                                     while the DMA is in operation has no effect. While the DMA is active, this
                                                     register provides the status on the current destination address. This
                                                     address is byte-aligned. The lower bits on the destination address are the
                                                     same as the lower bits on the source address.
                 DMAx_TCR                            The DMA Transfer Control Register specifies the source and destination
                                                     buses, the endian conversion mode of a transfer involving the Processor
                                                     Bus and a PCI bus (see “Endian Mapping” on page 177), and specifies
                                                     the byte count from any remaining Direct mode operation.
                 DMAx_CPP                            The DMA Command Packet Pointer register specifies the 32-byte aligned
                                                     address of the next command packet in the linked-list. This is
                                                     programmed by PowerSpan II as it loads a command packet. There is a
                                                     LAST flag in this register to indicate the end of the linked-list.
                 DMAx_ATTR                           The DMA Attributes Register specifies to the channel the location of the
                                                     linked-list port.
                The Command Packet Pointer register (DMAx_CPP) contains two elements: the Next Command
                Packet Pointer (NCP[31:5]) and the LAST bit. The NCP[31:5] field directs the PowerSpan II DMA to
                the next command packet in the linked-list. The LAST bit indicates the end of the linked-list.
                The chaining of the command packets is illustrated in Figure 18.
Integrated Device Technology                                                                          PowerSpan II User Manual
www.idt.com                                                                                                   80A1010_MA001_09


122                                                                                                            4. DMA
              Figure 18: DMA Command Packet Linked-List
                                First Command Packet                      Second Command Packet
                Address
                Offset: 0x00 Reserved                                        Reserved
                         0x04 DMAx_SRC_ADDR                                  DMAx_SRC_ADDR
                         0x08 Reserved                                       Reserved
                         0x0C DMAx_DST_ADDR                                  DMAx_DST_ADDR
                         0x10 Reserved                                       Reserved
                         0x14 DMAx_TCR                                       DMAx_TCR
                         0x18 Reserved                                       Reserved
                         0x1C DMAx_CPP                                       DMAx_CPP
4.4.1         Initializing a Linked-List Mode Transfer
              A Linked-List mode DMA transfer is configured using the following steps:
              1. Set-up the command packet linked-list in memory accessible to any one of the PowerSpan II’s
                   three ports. The command packet port selection is independent of the port selected as the source or
                   destination port.
              2. Configure DMAx_ATTR parameters and DMAx_GCSR.
              3. Set-up the NCP[31:5] field to point to the first command packet.
              4. Ensure the BC[23:0] field in the DMA Transfer Control Register is 0.
              5. Clear all status bits in the DMA General Control and Status Register.
              6. Set the GO bit.
              The steps to configure a Linked-List mode DMA transfer are illustrated in Figure 19.
PowerSpan II User Manual                                                                Integrated Device Technology
80A1010_MA001_09                                                                                          www.idt.com


4. DMA                                                                                                             123
                Figure 19: Sequence of Operations in a Linked-List Transfer
                                 Set up Linked List in
                                 memory space
                                 Configure DMAx_ATTR
                                 Set DMAx_CPP [NCP]
                                 Set GO and CHAIN bit
                                 Await termination
                                 of DMA
                                            Normal             No         Handle
                                       Termination?                       Error
                                                  Yes
                                              Done
                The DMA walks through the linked-list of command packets until it executes the last packet. When the
                operation programmed with that last Command Packet is completed, the DMA sets the DONE bit. The
                LAST bit indicates the end of the linked-list.
                If the Linked-List mode is started with a non-zero byte count in the DMA Transfer Control Register, a
                Direct mode DMA transfer is initiated by PowerSpan II to clear the remaining byte count value. Once
                that Direct mode transfer is complete, the DMA then processes the linked-list pointed to in the DMA
                Command Packet Pointer Register. This mechanism allows the restart of a linked-list transfer that has
                been stopped with the STOP_REQ bit in the “DMA x General Control and Status Register” on
                page 314.
Integrated Device Technology                                                                PowerSpan II User Manual
www.idt.com                                                                                       80A1010_MA001_09


124                                                                                                              4. DMA
4.4.1.1       Terminating Linked-List Mode
              Linked-List mode is terminated in two ways: setting the STOP_REQ bit or the HALT_REQ bit in the
              “DMA x General Control and Status Register” on page 314. When the STOP_REQ bit is set, the DMA
              stops making source port requests. When all outstanding transactions are completed on the destination
              bus, the STOP status bit is set. The channel can be restarted by clearing the STOP status bit (along with
              any other status bits) and then writing a one to the GO bit.
              Processing of the current linked-list can also be halted by setting the HALT_REQ bit. If this bit is set,
              transfers specified by the current command packet are completed and then the DMA sets the HALT
              status bit. Since DMAx_CPP contains the address of the next command packet, the channel can be
              restarted by writing 1 to HALT bit (to clear the HALT state), the CHAIN bit (to re-initiate the
              Linked-List mode), and the GO bit (to re-activate the DMA).
4.5           DMA Interrupts
              The PowerSpan II DMA supports a number of interrupt sources for each channel. Individual enable
              and status bits exist for each source. The status and enable bits are contained in the “DMA x General
              Control and Status Register” on page 314:
              Table 30: DMA Channel Interrupt Sources and Enables
                Interrupt Source                 Enable bit
                DONE                             DONE_EN
                P1_ERR                           P1_ERR_EN
                P2_ERR                           P2_ERR_EN
                PB_ERR                           PB_ERR_EN
                HALT                             HALT_EN
                STOP                             STOP_EN
              See “Interrupt Handling” on page 145 for a complete description of the mapping and status bits for
              each of these interrupt sources.
4.6           DMA Error Handling
              PowerSpan II can encounter external bus errors while mastering the source, destination or command
              packet ports on behalf of a DMA channel. Each DMA channel provides the following status bits in the
              “DMA x General Control and Status Register” on page 314 that indicate an error condition occurred
              during DMA bus master activity:
              •    P1_ERR
              •    P2_ERR
              •    PB_ERR
PowerSpan II User Manual                                                                   Integrated Device Technology
80A1010_MA001_09                                                                                            www.idt.com


4. DMA                                                                                                               125
                In addition to the reporting provided by a DMA channel, the participating Master also reports the error.
                See “Error Handling” on page 157.
4.6.1           PCI Error Bits
                The error bits for PCI-1 and PCI-2 are set when the corresponding PowerSpan II PCI Master
                encounters one of the following conditions while servicing a DMA channel:
                •   Master-Abort
                •   Target-Abort
                •   Maximum retry limit is reached
4.6.2           Processor Bus Error Bit
                The error bit for the processor bus is set if the PowerSpan II PB Master encounters one of the following
                conditions while servicing a DMA channel:
                •   Assertion of PB_TEA_
                •   Maximum retry limit is reached
                          The occurrence of data parity error does not affect DMA channel behavior but is captured by
                          the appropriate interface.
4.6.3           Source Port Errors
                When an error occurs on the source port, transactions initiated by the source port are terminated. Any
                source data buffered in the PowerSpan II is written to the destination port and the appropriate
                DMAx_GCSR error bit is set.
                Due to the pipelined nature of DMA channel requests, additional Source port transaction activity may
                occur until all outstanding channel requests are completed.
4.6.4           Destination Port Errors
                When an error occurs on the destination port transactions associated with any buffered data are
                terminated, and the appropriate DMAx_GCSR error bit is set.
                Due to the pipelined nature of DMA channel requests, additional destination port transaction activity
                can occur until all outstanding channel requests are completed.
Integrated Device Technology                                                                  PowerSpan II User Manual
www.idt.com                                                                                         80A1010_MA001_09


126                                                                                                             4. DMA
4.6.5         Command Port Errors
              When an error occurs on the command port the appropriate DMAx_GCSR error bit is set. The DMA
              channel registers are not updated with command packet data.
                       Each PowerSpan II external port has error log registers that provides additional diagnostic
                       information to assist in error recovery. These error log registers indicate when multiple errors
                       occur due to the pipelined nature of DMA channel requests.
              See “Error Handling” on page 157 and “Interrupt Handling” on page 145 for a full description of error
              logging support and associated interrupt mapping options.
PowerSpan II User Manual                                                                   Integrated Device Technology
80A1010_MA001_09                                                                                            www.idt.com


                                                                                                                      127
5.              I2C/EEPROM
                The I2C (Inter-IC) bus is a bi-directional, two-wire serial data and serial clock bus that provides
                communication links between integrated circuits (ICs) in an embedded application. Each device is
                recognized by a unique address and can operate as either a receiver device (for example, an LCD
                driver), or a transmitter device (for example, EEPROM) with the capability to both receive and send
                information. Transmitters and receivers can operate in either master or slave mode, depending on
                whether the IC initiates data transfers.
                This chapter discusses the following topics about the PowerSpan II I2C/EEPROM Interface:
                •   “Power-Up Configuration” on page 128
                •   “Bus Master I2C Transactions” on page 135
                •   “PCI Vital Product Data (VPD)” on page 135
5.1             Overview
                PowerSpan II has a master only, I2C bus compatible interface which supports up to eight I2C slave
                devices. This interface is primarily used by PowerSpan II for the initialization of registers and for
                reading and writing PCI Vital Product Data (VPD). However, PowerSpan II also provides a mechanism
                for processor bus and PCI masters to access the I2C devices.
                           PowerSpan II does not support multiple masters on the same I2C bus.
                PowerSpan II I2C Interface supports the following features:
                •   I2C 7-bit device addressing
                •   Standard mode (up to 100 Kbits/s)
                •   Single read/write (random read, byte write)
                •   Sequential read during power-up configuration
                The interface consists of two pins: I2C_SDA and I2C_SCLK. I2C_SDA is a bidirectional open drain
                signal for transferring address, control, and data bits. I2C_SCLK is the clock output for the I2C slave
                devices. I2C_SCL is derived from the processor bus clock. For example, at the maximum Processor
                Bus Clock (PB_CLK) frequency of 100 MHz, the I2C_SCLK clock rate is 100 kHz.
Integrated Device Technology                                                                    PowerSpan II User Manual
www.idt.com                                                                                          80A1010_MA001_09


128                                                                                                       5. I2C/EEPROM
5.2           Power-Up Configuration
              At the end of each PowerSpan II reset sequence, the I2C Interface initiates a sequential read with
              device select code 0b1010000. If no response is detected, the read is terminated and the EEPROM
              Load bit (ELOAD), in the “Reset Control and Status Register” on page 324 (RST_CSR), is cleared to
              indicate the absence of an external EEPROM.
              When an EEPROM is not used in the system for initialization, the initialization occurs from the
              processor bus. Once initialization is complete, the P1_LOCKOUT and P2_LOCKOUT bits must be
              cleared in the “Miscellaneous Control and Status Register” on page 318 (MISC_CSR) to enable the
              host processor to assign memory space.
              When a EEPROM is used in a system, the EEPROM device responds and a number of PowerSpan II
              register bits are loaded from the external device and the ELOAD bit is set. During this loading process,
              all accesses to PowerSpan II’s external interfaces are retried.
5.2.1         EEPROM Loading
              When the reset sequence is initiated by assertion of PO_RST_ — a power-up reset — the register
              loading process is defined by Table 31. The first byte read from the EEPROM defines the loading
              option and is reflected in the EEPROM Load Option (ELOAD_OPT) field, in the “Miscellaneous
              Control and Status Register” on page 318, at the conclusion of the loading process.
              The loading options for EEPROM are short loading and long loading. The short load consists of 29
              bytes and is designed to provide a PowerSpan II configuration to support the absence of a processor on
              the PB Interface. The long load is 61 bytes in length and provides additional configuration
              convenience. The upper 192 bytes of the EEPROM are reserved for PCI Vital Product Data (see “PCI
              Vital Product Data (VPD)” on page 135).
              Table 31 defines the power-up EEPROM load sequence. The shaded areas indicate registers not visible
              in the Single PCI PowerSpan II.
                         Table 31 assumes PCI little-endian bit ordering. Consult the register tables for each of the
                         registers listed in the table to obtain the corresponding PowerPC big-endian bit ordering.
              Table 31: Power-up EEPROM Load Sequence
                Byte
                Offset            Bit      Name                              Description
                0x00              7-0      MISC_CSR[ELOAD_OPT]               0b00000001=short load
                                                                             0b00000010=long load
                                                                             0b00000100=reserved
                                                                             others=do not load
                0x01              7-0      PowerSpan II Reserved
                0x02              7-0      PowerSpan II Reserved
                0x03              7-0      PowerSpan II Reserved
PowerSpan II User Manual                                                                     Integrated Device Technology
80A1010_MA001_09                                                                                              www.idt.com


5. I2C/EEPROM                                                                                                      129
                Table 31: Power-up EEPROM Load Sequence
                 Byte
                 Offset       Bit    Name                                Description
                                                       Start of short load
                 0x04         7-0    PowerSpan II Reserved
                 0x05         7-4    PowerSpan II Reserved
                              3      P1_CSR[BM]                          PCI-1 Bus Master Enable
                              2      P1_CSR[MS]                          PCI-1 Memory Space Enable
                              1      P2_CSR[BM]                          PCI-2 Bus Master Enable
                              0      P2_CSR[MS]                          PCI-2 Memory Space Enable
                 0x06         7-5    PowerSpan II Reserved
                              4      P1_BSI2O[PRFTCH]                    PCI-1 I2O target image prefetch indicator
                              3      P1_BST0[PRFTCH]                     PCI-1 Target image 0 prefetch indicator
                              2      P1_BST1[PRFTCH]                     PCI-1 Target image 1 prefetch indicator
                              1      P1_BST2[PRFTCH]                     PCI-1 Target image 2 prefetch indicator
                              0      P1_BST3[PRFTCH]                     PCI-1 Target image 3 prefetch indicator
                 0x07         7-0    P1_SID[SID[15:8]]                   PCI-1 Subsystem ID bits 15-8
                 0x08         7-0    P1_SID[SID[7:0]]                    PCI-1 Subsystem ID bits 7-0
                 0x09         7-0    P1_SID[SVID[15:8]]                  PCI-1 Subsystem vendor ID bits 15-8
                 0x0A         7-0    P1_SID[SVID[7:0]]                   PCI-1 Subsystem vendor ID bits 7-0
                 0x0B         7-2                                 PowerSpan II Reserved
                              1      P1_MISC1[INT_PIN[0]]                PCI-1 Interrupt pin bit 0
                              0      P2_MISC1[INT_PIN[0]]                PCI-2 Interrupt pin bit 0
Integrated Device Technology                                                                 PowerSpan II User Manual
www.idt.com                                                                                        80A1010_MA001_09


130                                                                                         5. I2C/EEPROM
              Table 31: Power-up EEPROM Load Sequence
                Byte
                Offset      Bit    Name                       Description
                0x0C        7-5    PowerSpan II Reserved
                            4      P1_MISC_CSR[BSREG_BAR_E    PCI-1 Register image base address register
                                   N]                         enable
                            3      P1_TI0_CTL[BAR_EN]         PCI-1 Target image 0 base address register
                                                              enable
                            2      P1_TI1_CTL[BAR_EN]         PCI-1 Target image 1 base address register
                                                              enable
                            1      P1_TI2_CTL[BAR_EN]         PCI-1 Target image 2 base address register
                                                              enable
                            0      P1_TI3_CTL[BAR_EN]         PCI-1 Target image 3 base address register
                                                              enable
                0x0D        7-4    P1_TI0_CTL[BS]             PCI-1 Target image 0 block size
                            3-0    P1_TI1_CTL[BS]             PCI-1 Target image 1 block size
                0x0E        7-4    P1_TI2_CTL[BS]             PCI-1 Target image 2 block size
                            3-0    P1_TI3_CTL[BS]             PCI-1 Target image 3 block size
                0x0F        7      MISC_CSR[VPD_EN]           PCI Vital Product Data enable
                            6-4    MISC_CSR[VPD_CS[2:0]]      PCI Vital Product Data chip select
                            3-0                          PowerSpan II Reserved
                0x10        7      MISC_CSR[P1_LOCKOUT]       PCI-1 Lockout
                            6      MISC_CSR[P2_LOCKOUT]       PCI-2 Lockout
                            5-4                          PowerSpan II Reserved
                            3      MISC_CSR[PCI_ARB_CFG]      PCI Arbiter Configuration Complete
                            2      MISC_CSR[PCI_M7]           PCI Arbiter Master 7
                            1      MISC_CSR[PCI_M6]           PCI Arbiter Master 6
                            0      MISC_CSR[PCI_M5]           PCI Arbiter Master 5
PowerSpan II User Manual                                                      Integrated Device Technology
80A1010_MA001_09                                                                                 www.idt.com


5. I2C/EEPROM                                                                                            131
                Table 31: Power-up EEPROM Load Sequence
                 Byte
                 Offset       Bit    Name                     Description
                 0x11         7      IDR[P2_HW_DIR]           P2_INTA Direction
                              6      IDR[P1_HW_DIR]           P1_INTA Direction
                              5      IDR[INT5_HW_DIR]         INT[5] Direction
                              4      IDR[INT4_HW_DIR]         INT[4] Direction
                              3      IDR[INT3_HW_DIR]         INT[3] Direction
                              2      IDR[INT2_HW_DIR]         INT[2] Direction
                              1      IDR[INT1_HW_DIR]         INT[1] Direction
                              0      IDR[INT0_HW_DIR]         INT[0] Direction
                 0x12         7-6                        PowerSpan II Reserved
                              5      PCI_I2O_CTL[BAR_EN]      PCI I2O Target image base address register
                                                              enable
                              4                          PowerSpan II Reserved
                              3-0    PCI_I2O_CTL[BS]          PCI I2O Target image block size
                 0x13         7-5                        PowerSpan II Reserved
                              4      P2_BSI2O[PRFTCH]         PCI-2 I2O target image prefetch indicator
                              3      P2_BST0[PRFTCH]          PCI-2 Target image 0 prefetch indicator
                              2      P2_BST1[PRFTCH]          PCI-2 Target image 1 prefetch indicator
                              1      P2_BST2[PRFTCH]          PCI-2 Target image 2 prefetch indicator
                              0      P2_BST3[PRFTCH]          PCI-2 Target image 3 prefetch indicator
                 0x14         7-0    P2_SID[SID[15:8]]        PCI-2 Subsystem ID bits 15-8
                 0x15         7-0    P2_SID[SID[7:0]]         PCI-2 Subsystem ID bits 7-0
                 0x16         7-0    P2_SID[SVID[15:8]]       PCI-2 Subsystem vendor ID bits 15-8
                 0x17         7-0    P2_SID[SVID[7:0]]        PCI-2 Subsystem vendor ID bits 7-0
Integrated Device Technology                                                     PowerSpan II User Manual
www.idt.com                                                                            80A1010_MA001_09


132                                                                                                  5. I2C/EEPROM
              Table 31: Power-up EEPROM Load Sequence
                Byte
                Offset      Bit    Name                                Description
                0x18        7-5    PowerSpan II Reserved
                            4      P2_MISC_CSR[BSREG_BAR_E             PCI-2 Register image base address register
                                   N]                                  enable
                            3      P2_TI0_CTL[BAR_EN]                  PCI-2 Target image 0 base address register
                                                                       enable
                            2      P2_TI1_CTL[BAR_EN]                  PCI-2 Target image 1 base address register
                                                                       enable
                            1      P2_TI2_CTL[BAR_EN]                  PCI-2 Target image 2 base address register
                                                                       enable
                            0      P2_TI3_CTL[BAR_EN]                  PCI-2 Target image 3 base address register
                                                                       enable
                0x19        3-0    P2_TI0_CTL[BS]                      PCI-2 Target image 0 block size
                            3-0    P2_TI1_CTL[BS]                      PCI-2 Target image 1 block size
                0x1A        3-0    P2_TI2_CTL[BS]                      PCI-2 Target image 2 block size
                            3-0    P2_TI3_CTL[BS]                      PCI-2 Target image 3 block size
                0x1B-0x1F                                       PowerSpan II Reserved
                                           End of short load, long load continues
                0x20        7-0    P1_ID[DID[15:8]]                    PCI-1 Device ID bits 15-8
                0x21        7-0    P1_ID[DID[7:0]]                     PCI-1 Device ID bits 7-0
                0x22        7-0    P1_ID[VID[15:8]]                    PCI-1 Vendor ID bits 15-8
                0x23        7-0    P1_ID[VID[7:0]]                     PCI-1 Vendor ID bits 7-0
                0x24        7-0    P1_CLASS[BASE]                      PCI-1 Base Class Code
                0x25        7-0    P1_CLASS[SUB]                       PCI-1 Sub Class Code
                0x26        7-0    P1_CLASS[PROG]                      PCI-1 Programming Interface
                0x27        7-0    P1_CLASS[RID]                       PCI-1 Revision ID
                0x28                                            PowerSpan II Reserved
                            6      PB_SI0_CTL[TA_EN]                   PB Slave image 0 translation enable
                            5      PB_SI0_CTL[MD_EN]                   PB Slave image 0 Master decode enable
                            4-0    PB_SI0_CTL[BS]                      PB Slave image 0 block size
PowerSpan II User Manual                                                               Integrated Device Technology
80A1010_MA001_09                                                                                         www.idt.com


5. I2C/EEPROM                                                                                             133
                Table 31: Power-up EEPROM Load Sequence
                 Byte
                 Offset       Bit    Name                       Description
                 0x29         7      PB_SI0_CTL[MODE]           PB Slave image 0 image select
                              6      PB_SI0_CTL[DEST]           PB Slave image 0 destination
                              5-0                          PowerSpan II Reserved
                 0x2A         7      PB_SI0_CTL[PRKEEP]         PB Slave image 0 image prefetch read keep
                              6-5    PB_SI0_CTL[END]            PB Slave image 0 image endian conversion
                              4-3                          PowerSpan II Reserved
                              2-0    PB_SI0_CTL[RD_AMT]         PB Slave image 0 Read Prefetch Amount
                 0x2B         7-0    PB_SI0_TADDR[31:24]        PB Slave image 0 translation address bits
                                                                31-24
                 0x2C         7-0    PB_SI0_TADDR[23:16]        PB Slave image 0 translation address bits
                                                                23:16
                 0x2D         7-4    PB_SI0_TADDR[15:12]        PB Slave image 0 translation address bits
                                                                15-12
                              3      PB_SI0_TADDR[M3]           PB Slave image 0 master 3 select
                              2      PB_SI0_TADDR[M2]           PB Slave image 0 master 2 select
                              1      PB_SI0_TADDR[M1]           PB Slave image 0 master 1 select
                              0      PowerSpan II Reserved
                 0x2E         7-0    PB_SI0_BADDR[31:24]        PB Slave image 0 base address bits 31-24
                 0x2F         7-0    PB_SI0_BADDR[23:16]        PB Slave image 0 base address bits 23-16
                 0x30         7-4    PB_SI0_BADDR[15:12]        PB Slave image 0 base address bits 15-12
                              3-0                          PowerSpan II Reserved
                 0x31         7-0    PB_REG_ADDR[31:24]         PB Slave register image base address bits
                                                                31-24
                 0x32         7-0    PB_REG_ADDR[23:16]         PB Slave register image base address bits
                                                                23-16
                 0x33         7-4    PB_REG_ADDR[15:12]         PB Slave register image base address bits
                                                                15-12
                              3-2                          PowerSpan II Reserved
                              0      PB_REG_ADDR[END]           PB Slave register image endian conversion
                 0x34         7-0    P2_ID[DID[15:8]]           PCI-2 Device ID bits 15-8
Integrated Device Technology                                                       PowerSpan II User Manual
www.idt.com                                                                               80A1010_MA001_09


134                                                                                                       5. I2C/EEPROM
              Table 31: Power-up EEPROM Load Sequence
                Byte
                Offset           Bit      Name                               Description
                0x35             7-0      P2_ID[DID[7:0]]                    PCI-2 Device ID bits 7-0
                0x36             7-0      P2_ID[VID[15:8]]                   PCI-2 Vendor ID bits 15-8
                0x37             7-0      P2_ID[VID[7:0]]                    PCI-2 Vendor ID bits 7-0
                0x38             7-0      P2_CLASS[BASE]                     PCI-2 Base Class Code
                0x39             7-0      P2_CLASS[SUB]                      PCI-2 Sub Class Code
                0x3A             7-0      P2_CLASS[PROG]                     PCI-2 Programming Interface
                0x3B             7-0      P2_CLASS[RID]                      PCI-2 Revision ID
                0x3C-0x3F        7-0                                  PowerSpan II Reserved
                                                          End of load sequence
                0x40-0xFF        7-0      Reserved for PCI Vital Product Data (VPD)
                        When a long EEPROM load is executed, the PB Slave Image 0 is enabled automatically. The
                        IMG_EN bit is set to 1 in the PB_S1_CTL register.
              When the reset sequence is initiated by assertion of PB_RST_, P1_RST# or P2_RST#, the first byte of
              the EEPROM is read to determine the loading sequence desired. All bytes for the selected load option
              are read from the EEPROM, but only a subset of PowerSpan II registers are updated. This subset is
              defined by the external reset pin that initiated the reset sequence. Only those register bits affected by
              the active reset pin(s) are updated with EEPROM contents. See “Register Descriptions” on page 235
              for more information.
PowerSpan II User Manual                                                                     Integrated Device Technology
80A1010_MA001_09                                                                                              www.idt.com


5. I2C/EEPROM                                                                                                           135
5.3             Bus Master I2C Transactions
                I2C master reads and writes can be performed from any one of the PowerSpan II’s three interfaces —
                PB, PCI-1 or PCI-2. These I2C transactions are generated by accessing the “I2C/EEPROM Interface
                Control and Status Register” on page 322. This register can be used to access EEPROMs or perform
                arbitrary single byte transfers to other I2C compatible devices. Since the I2C Interface is a shared
                resource, software must use a PowerSpan II register semaphore, SEMAx, to acquire exclusive access to
                interface before initiating transactions with I2C_CSR. The I2C_CSR register contains the following
                fields:
                •    EEPROM Address (ADDR): The 8-bit EEPROM address specifies the address for byte writes and
                     random reads.
                •    Data (DATA): The 8-bit data field is the source for writes and destination for reads.
                •    Device Code (DEV_CODE): Device code is the 4-bit field that specifies the I2C device type. The
                     default is 1010b which is the code for EEPROMs.
                •    Chip Select (CS): Chip select is the 3-bit field use to select one of the eight slaves on the I2C bus.
                     The device code and chip select fields together form the I2C 7-bit device address.
                •    Read/Write (RW)
                •    Active (ACT): When the active bit is set, a transfer is in progress and the register is in read-only
                     mode. After performing a write or read access, the user must poll the active bit until it is negated
                     before performing other transfers. The active bit is also asserted during power-up EEPROM load
                     and when a PCI Vital Product Data transfer is in progress.
                •    Error (ERR): If the PowerSpan II is unable to complete an I2C access, the ERR bit is set when the
                     ACT is negated. The ERR bit must be cleared before attempting another access.
5.4             PCI Vital Product Data (VPD)
                Vital Product Data (VPD) is the information that uniquely defines items such as the hardware,
                software, and microcode elements of a system. VPD also provides a mechanism for storing information
                such as performance and failure data on a device.
                VPD resides in a local storage device. PowerSpan II supports VPD through the serial EEPROM. If an
                external EEPROM is not used, the VPD feature is disabled.
                There are four bits in Table 31 associated with PCI Vital Product Data: VPD_EN and VPD_CS[2:0].
                These bits may also be programmed in the “Miscellaneous Control and Status Register” on page 318.
                When VPD_EN is set, PowerSpan II supports PCI Vital Product Data through the VPD capabilities
                registers in the PCI Configuration Space of the designated Primary PCI Interface (see “Primary PCI”
                on page 31). The VPD may be located in two different places: the upper 192 bytes of the first
                EEPROM (VPD_CS=000) or the entire 256 bytes of a second EEPROM with chip select VPD_CS.
                The VPD Enable and VPD Chip Select fields in the “Miscellaneous Control and Status Register” on
                page 318 are initialized as part of the short load post reset sequence.
Integrated Device Technology                                                                      PowerSpan II User Manual
www.idt.com                                                                                             80A1010_MA001_09


136                                                                                                     5. I2C/EEPROM
              If VPD is located in the first EEPROM, the first byte is located at offset 0x40. On every VPD transfer,
              PowerSpan II adds the offset 0x40 to the address in the P1_VPDC or P2_VPDC register. If VPD is not
              located in the first EEPROM, then the address in the P1_VPDC or P2_VPDC register is used directly
              as the 8 bit EEPROM address.
              Accesses to Vital Product Data in external EEPROM is performed in the manner described in “Bus
              Master I2C Transactions” on page 135.
                        The bit ordering of the data returned from EEPROM in the “PCI-1 Vital Product Data
                        Register” on page 267 can be addressed according to little-endian or big-endian conventions.
                        See the bit ordering information in the register table to obtain the necessary bit ordering
                        information.
PowerSpan II User Manual                                                                   Integrated Device Technology
80A1010_MA001_09                                                                                            www.idt.com


                                                                                                                         137
6.              Arbitration
                Arbitration is a process used by multi-drop bus protocols, such as PCI, to support read and write access
                on a peripheral bus. A bus arbiter is a logic module that controls access to the bus by the devices
                residing on it. For example, when a device requires access to the bus it sends a request signal to the bus
                arbiter. If the bus is not active, the arbiter grants the device access; otherwise, the device must continue
                to request access until it is successful in obtaining the bus.
                This chapter discusses the following topics about PowerSpan II’s Processor Bus and PCI arbitration
                capabilities:
                •    “PCI Interface Arbitration” on page 137
                •    “Processor Bus Arbitration” on page 141
6.1             Overview
                PowerSpan II has three arbiters. There is an arbiter on each PCI interface: PCI-1 and
                PCI-2. There is also one arbiter for the Processor Bus Interface.
6.2             PCI Interface Arbitration
                Each PowerSpan II PCI Interface supports a PCI central arbiter. Each arbiter has dedicated support for
                the PowerSpan II PCI Master — with internal request and grant signaling and up to four external PCI
                masters.
                PowerSpan II provides external pins to support three additional external PCI masters —
                PCI_REQ[7:5]#/PCI_GNT[7:5]#. Pairs of these additional arbitration pins can be individually
                assigned to the PCI-1 arbiter or the PCI-2 arbiter (see Figure 20). Assignment of these pins is
                accomplished by initializing the PCI Arbiter Master (PCI_Mx) bits and PCI Arbiter Pins Configuration
                (PCI_ARB_CFG) bit in the “Miscellaneous Control and Status Register” on page 318. These bits can
                be configured either through EEPROM load at reset (see “I2C/EEPROM” on page 127) or direct
                PowerSpan II register access. Requests on PCI_REQ#[7:5] are ignored until these bits are initialized.
                            Signals PCI_REQ[7:5]# / PCI_GNT[7:5]# operate at a maximum of 33 MHz.
Integrated Device Technology                                                                       PowerSpan II User Manual
www.idt.com                                                                                              80A1010_MA001_09


138                                                                                                                                                           6. Arbitration
              Figure 20: Assignment of Additional Bus Requesters with PCI Arbiters
                               PCI-1                                                                         PCI-2
                                                                  Assignable to
                               Arbiter                        either PCI-1 or PCI-2
                                                                                                             Arbiter
                        4                  4                                                            4                  4
                            P1_GNT[4:1]#       P1_REQ[4:1]#                                                 P2_GNT[4:1]#       P2_REQ[4:1]#
                                                                3                   3
                                                                    PCI_GNT[7:5]#       PCI_REQ[7:5]#
                        In the Single PCI PowerSpan II, PCI_REQ#[7:5]/PCI_GNT#[7:5] are assigned to the PCI-1
                        arbiter.
6.2.1         Arbitration Levels
              The PowerSpan II PCI arbiter implements a fairness algorithm in order to prevent deadlocks. There are
              two priority levels signed to the PCI master agents. Fairness is defined by the PCI 2.2 Specification as
              an algorithm that grants all potential PCI masters access to the bus, independent of other requests.
6.2.1.1       High and Low Priority PCI Agents
              There are two priority levels assigned to the PCI Master Agents: high priority and low priority. Each
              priority level performs a round-robin arbitration algorithm among the PCI masters assigned to each
              level. For example, all the PCI masters assigned to the lower priority level represent one entry in the
              higher priority round-robin arbitration. For every turn of the high priority round-robin arbitration, high
              priority PCI masters asserting Px_REQ# are granted access to the PCI bus. At the same time, only one
              lower priority level PCI master asserting Px_REQ# is granted access to the PCI bus.
              Arbitration on PowerSpan II is hidden. Hidden arbitration means it occurs during the previous access
              so that no PCI cycles are consumed due to arbitration — except when the bus is in an idle state.
PowerSpan II User Manual                                                                                                                      Integrated Device Technology
80A1010_MA001_09                                                                                                                                               www.idt.com


6. Arbitration                                                                                                           139
6.2.1.2         Requesting the PCI Bus
                When the bus is idle a master requesting the bus has 16 clocks from the detection of Px_GNT# asserted
                to drive Px_FRAME# asserted. If the 16 clocks is exceeded, the arbiter assumes the master is unable to
                drive the bus and re-arbitrates the bus to another requesting master. PCI masters unable to assert
                Px_FRAME# within 16 clocks of detecting Px_GNT# asserted lose their turn to access the PCI bus.
                            The PCI bus is idle when both Px_FRAME# and Px_IRDY# are negated.
                Functioning and Non-functioning PCI Masters
                A master that does not respond to the Px_GNT# signal in 16 clocks is considered a non-functioning
                master by the PowerSpan II PCIx Arbiter when the Status enable (STATUS_EN) bit is set to 1 in the
                “PCI-1 Bus Arbiter Control Register” on page 284. The STATUS_EN bit enables an internal monitor
                in the PowerSpan II PCIx Arbiter that checks that no PCI Master waits longer than 16 PCI clock cycles
                before starting a transaction.
                When a master takes longer than 16 clocks before starting a transaction, the STATUS bit is set to 1 in
                the “PCI-1 Bus Arbiter Control Register” on page 284. When the STATUS bit is set to 1 by the
                PowerSpan II PCIx arbiter, the PowerSpan II arbiter does not include the non-functioning PCI Master
                in its arbitration algorithm. When the bit is set to 0, the operating status of the PCI Master is considered
                by the arbiter to be functioning and the PCI Master is included in the arbitration algorithm used by
                PowerSpan II.
                When PowerSpan II is reset, all masters are considered functioning — the STATUS bit is set to 0.
                Refer to “Bus Parking on a Non-functioning Master” on page 141 for more information on bus parking
                on a master that is non-functioning.
6.2.1.3         PCI Master Driving the PCI Bus
                A PCI master accessing the PCI bus has extended assertion of Px_GNT# by the arbiter if no other
                masters are attempting to access the bus. The arbiter keeps Px_GNT# asserted for the PCI master
                actively driving the bus. This enables the PCI master to extend its PCI access beyond the Latency
                Timer.
                The Px_GNT# to the driving PCI master remains asserted for the duration of the transaction, regardless
                of the state of the master’s Px_REQ# signal. The arbiter does not try to park the bus on another master
                while the present master is actively driving the bus with Px_REQ# negated.
                The arbiter negates all Px_GNT# lines for all masters except the PCI master accessing the PCI bus if
                another PCI master asserts Px_REQ# to gain the bus. Px_GNT# is negated for the duration of the
                active access. The PowerSpan II arbiter updates the arbitration when it detects Px_FRAME# negated
                and Px_IRDY# asserted — which occurs in the last data phase of the transaction. The arbitration
                update is designed to minimize the latency to higher priority PCI masters which may have asserted
                their Px_REQ# while the present transaction was active.
                The arbitration algorithm is illustrated in Figure 21.
Integrated Device Technology                                                                       PowerSpan II User Manual
www.idt.com                                                                                             80A1010_MA001_09


140                                                                                                    6. Arbitration
              Figure 21: Arbitration Algorithm
                                        Master B
                    Master C             Level 1            Master A
                                         Level 0
                 Arbitration Order
                 Level 1, Level 1, Level 1, Level 0
                 For example, if all bus masters
                 assert Request:
                                                                                                Master Z
                 * A, B, C, X
                 * A, B, C, Y                             Master X
                 * A, B, C, Z                                                 Level 0
                 * A, B, C, X
                                                                            Master Y
              Each PowerSpan II PCI arbiter is programmable with the corresponding arbiter control register (see
              “PCI-1 Bus Arbiter Control Register” on page 284) and enabled through power-up option PCI x
              Arbiter enable (PWRUP_Px_ARB_EN) (see “Resets, Clocks and Power-up Options” on page 167).
              Each master has a arbitration level for PCI Master Device x (Mx_PRI) bit in the “PCI-1 Bus Arbiter
              Control Register” on page 284 (Px_ARB_CTRL) to determine its arbitration level.
              External Arbitration
              When an external arbiter is used, the PowerSpan II PCI Master uses Px_REQ#[1]/Px_GNT#[1] to
              acquire the bus.
PowerSpan II User Manual                                                              Integrated Device Technology
80A1010_MA001_09                                                                                       www.idt.com


6. Arbitration                                                                                                        141
6.2.2           Bus Parking
                The PowerSpan II PCI arbiter provides a flexible address bus parking scheme. When no master is
                requesting the address bus, the PCI arbiter can park on either the:
                •     last bus master
                •     specific bus master
                The bus parking mode is determined by PARK bit in the Px_ARB_CTRL register. When Specific
                Master mode is selected by setting the PARK bit to 0, the BM_PARK[2:0] field selects the specific bus
                master for bus parking. The parked master must enable its drivers for the following PCI signals:
                •     AD[31:0]
                •     Px_C/BE#[3:0]
                •     PAR
                Bus parking does not occur until the PCI bus is idle. When a PCI master is accessing the bus when no
                Px_REQ# signals are asserted to the PowerSpan II PCI arbiter, Px_GNT# remains asserted to the
                master until the bus becomes idle.
6.2.2.1         Bus Parking on a Non-functioning Master
                It is possible for PowerSpan II to park the bus on a master that is considered non-functioning or to park
                the bus on the last master that has a status that has changed to non-functioning by the STATUS bit is set
                to 1 in the “PCI-1 Bus Arbiter Control Register” on page 284. Refer to “Functioning and
                Non-functioning PCI Masters” on page 139 for a detailed description of functioning and
                non-functioning PCI Masters.
                When PowerSpan II parks the bus on a non-functioning PCI Master, the
                PowerSpan II PCIx Arbiter waits for another master to request the bus. Once another master request the
                bus the PCIx Arbiter then ignores the non-functioning master until the master is considered
                functioning. The master status is considered functioning after PowerSpan II is reset (default setting) or
                the STATUS bit is cleared.
6.3             Processor Bus Arbitration
                PowerSpan II’s internal processor bus arbiter is enabled through a power-up option
                (PWRUP_PB_ARB_EN, see “Resets, Clocks and Power-up Options” on page 167). When the internal
                arbiter is enabled, PowerSpan II’s PB Master uses an internal arbitration mechanism to acquire the
                processor bus. When the internal arbiter is disabled an external arbiter is implemented. The PB Master
                uses Address Bus Request (PB_BR[1]_), Address Bus Grant (PB_BG[1]_) and Data Bus Grant
                (PB_DBG[1]_) to gain external bus ownership.
                PowerSpan II’s internal processor bus arbiter supports three external processor bus masters and
                implements internal request and grant lines for the PowerSpan II itself — four processor bus masters in
                total. The external masters are enabled with the External Master x Enable (Mx_EN) bits in the
                “Processor Bus Arbiter Control Register” on page 307.
Integrated Device Technology                                                                    PowerSpan II User Manual
www.idt.com                                                                                           80A1010_MA001_09


142                                                                                                          6. Arbitration
              The processor bus arbiter implements two levels of priority. Devices programmed into a specific
              priority level operate in a round robin fashion. Each master has a External Master x Priority Level
              (Mx_PRI) bit in the PB_ARB_CTRL register to determine its arbitration level for the address bus. The
              arbitration level for each master can be reconfigured during system run-time.
6.3.1         Address Bus Arbitration
              The PB_BG_ pins change state under the following conditions:
              •    The assertion of PB_REQ_ when the bus is idle.
              •    After the assertion of PB Address Acknowledge (PB_AACK_), Bus Grant (PB_BG_) changes to
                   the next requesting master or the parked master.
                         Requesting masters are required to qualify bus grants before beginning an address tenure.
              Some host processors (for example, the PowerQUICC II) and other processor bus agents require the
              system signal ABB_ to qualify address bus grants. The PowerSpan II PB Master Interface does not
              require ABB_ to qualify data bus grants.
6.3.1.1       Bus Parking
              The PowerSpan II processor bus arbiter provides a flexible address bus parking scheme. When no
              master is requesting the address bus, the processor bus arbiter can park on either the:
              •    Last bus master
              •    Specific bus master
              The bus parking mode is determined by the PARK bit in the PB_ARB_CTRL Register. When specific
              master mode is selected (PARK = 0), the BM_PARK[1:0] field selects the specific bus master for
              address parking.
                         The parked master does not drive any address bus signals until it generates a request to use
                         the address bus.
6.3.2         Data Bus Arbitration
              The arbiter samples PB_TT[3] when PB_TS_ is asserted to generate data bus requests. The arbiter
              grants the data bus to the current address bus owner by asserting one of PB_DBG[1:3]_ signals. The
              signal is asserted, by default, one clock after PB_TS_. The PB arbiter can be programmed to sample
              requests two clocks after the PB_TS_ signals is asserted. The arbiter is programmed through the
              TS_DLY bit in the “Processor Bus Arbiter Control Register” on page 307.
                         An example application for this feature is some L2 caches hold the BR_ signal after the TS_
                         signal starts. The PowerSpan II arbiter could see this as a valid request and give the bus to the
                         L2 cache when the bus was not requested. This bit delays when the PB arbiter samples the
                         signal so a false bus request is not granted.
PowerSpan II User Manual                                                                    Integrated Device Technology
80A1010_MA001_09                                                                                             www.idt.com


6. Arbitration                                                                                                        143
                The current data bus grant is negated when the requesting master has qualified the grant.
                           Requesting masters are required to qualify bus grants before beginning an data tenure.
                Some host processors (for example, the PowerQUICC II) and other processor bus agents require the
                system signal DBB_ to qualify data bus grants. The PowerSpan II PB Master does not require DBB_ to
                qualify data bus grants.
6.3.2.1         Qualifying Data Bus Grant
                Some processors, specifically the PowerPC 7400, must have the data bus grant qualified by the arbiter
                before it is issued to the master. PowerSpan II, by default, does not qualify the data bus grant by the
                PowerSpan II PB Arbiter and requires that the requesting master qualify bus grants before beginning an
                data tenure.
                The PowerSpan II PB Arbiter can be programmed to qualify data bus grants before issuing them by
                setting the 7400_MODE bit in the “Reset Control and Status Register” on page 324. When the
                7400_MODE bit is set to 1, the PB arbiter qualifies data bus grants before issuing them to a processor
                bus master. When the 7400_MODE bit is disabled (default setting) the PB arbiter issues a data bus
                grant to the processor bus master and expects that the processor bus master the at receives the grant
                qualifies the grant.
                The 7400_MODE bit is a power-up option.
6.3.3           Address Only Cycles
                The arbiter supports address only cycles. If Transfer Type (PB_TT[3]) is sampled low during PB_TS_,
                the arbiter does not grant the data bus. The use of PB_TT[3] as a data bus request means that the
                PowerSpan II PB arbiter does not support the processor bus instructions eciwx and ecowx.
6.3.4           PowerSpan II Arbiter and System Boot
                System boot from the PCI bus can be selected by configuring the processor bus arbiter at power-up to
                ignore all external requests on PB_BR[3:1]_. This allows an external PCI master, with the PowerSpan
                II PB Master, to configure the host processor memory controller and load boot code before enabling
                recognition of requests on PB_BR[3:1]_.
                Alternatively, at power-up the processor bus arbiter can be configured to recognize requests on
                PB_BR[1]_ and ignore requests on PB_BR[3:2]_. In this case the processor connected to PB_BR[1]_
                can enable recognition of requests from other masters when its system configuration tasks are
                complete.
                The PowerSpan II processor bus arbiter controls system boot with the M3_EN, M2_EN and M1_EN
                bits in the “PCI-1 Bus Arbiter Control Register” on page 284 (PB_ARB_CTRL), as well as the
                power-up option PWRUP_BOOT.
Integrated Device Technology                                                                    PowerSpan II User Manual
www.idt.com                                                                                          80A1010_MA001_09


144                                                                                                      6. Arbitration
              The default value of these Mx_EN bits in the PB_ARB_CTRL register are set using the
              PWRUP_BOOT option shown in Table 32. When PWRUP_BOOT is selected to boot from PCI, both
              Px_LOCKOUT bits in the MISC_CSR register are cleared automatically, even if an EEPROM is not
              present.
              Table 32: Mx_EN Default State
                   PWRUP_BOOT
                     Selection          RST_CSR Register          M1_EN               M2_EN              M3_EN
                      Boot PCI            PCI_BOOT=1                  0                  0                  0
                       Boot PB            PCI_BOOT=0                  1                  0                  0
              The processor bus arbiter does not have to be enabled to select either PCI or processor bus boot. The
              PWRUP_BOOT option sets the M1_EN bit in the PB_ARB_CTL register and the P1_LOCKOUT and
              P2_LOCKOUT bits in the MISC_CSR register. Setting the Px_LOCKOUT bits means any
              configuration cycles for PowerSpan II on the PCI bus are retried until the Px_LOCKOUT bits are
              cleared from the processor bus or the EEPROM. When PCI_BOOT is set to 1 (boot is from PCI) the
              Px_LOCKOUT bits are not set
              For more information on power-up options and boot selection, refer to “PowerSpan II Power-up
              Options” on page 171.
PowerSpan II User Manual                                                                Integrated Device Technology
80A1010_MA001_09                                                                                         www.idt.com


                                                                                                                    145
7.              Interrupt Handling
                An interrupt is a signal informing a program that an event (for example, an error) has occurred. When a
                program receives an interrupt signal, it temporarily suspends normal processing and diverts the
                execution of instructions to a sub-routine handled by an interrupt controller. The controller
                communicates with the host processor and the device that initiated the interrupt to determine how to
                handle the interrupt.
                This chapter discusses the following topics about the PowerSpan II interrupt features:
                •   “Interrupt Sources” on page 145
                •   “Interrupt Registers” on page 147
                •   “Interrupt Pins” on page 153
                •   “Mailboxes” on page 154
                •   “Doorbells” on page 155
7.1             Overview
                PowerSpan II handles interrupts both from normal device operation and from exceptions. These
                interrupts are programmed through certain register settings and are signaled through both input and
                output signal pins.
                The following sections describes PowerSpan II interrupt handling.
7.2             Interrupt Sources
                Interrupt sources are classified as originating from normal device operation or conditions generated
                from an exception.
                These classifications are discussed in the following sections.
7.2.1           Interrupts from Normal Operations
                Interrupt sources associated with normal device operations are:
                •   Eight bidirectional, configurable interrupts pins:
                    P1_INTA#, P2_INTA#, INT[5:0]_
                •   DMA channels (see “DMA Interrupts” on page 154 for DMA interrupt sources)
                •   Doorbell interrupts (see “Interrupt Enable Register 0” on page 332 for doorbell interrupt
                    generation)
                •   Mailbox interrupts (see “Mailbox x Register” on page 349)
Integrated Device Technology                                                                   PowerSpan II User Manual
www.idt.com                                                                                         80A1010_MA001_09


146                                                                                                7. Interrupt Handling
7.2.2         Interrupts from Transaction Exceptions
              Bus transaction exceptions can occur on any one of the PowerSpan II interfaces — PCI-1, PCI-2 or
              Processor Bus (PB) — because of bus errors, address parity errors, or data parity errors. When an error
              occurs, PowerSpan II tracks the direction of the transaction through the interrupt enabling and status
              function.
              Interrupt sources associated with exceptions are:
              1. PB Interface errors
                   •   PB_P1_ERR
                   •   PB_P2_ERR
                   •   PB_A_PAR
                   •   PB_P1_D_PAR
                   •   PB_P2_D_PAR
                   •   PB_P1_RETRY
                   •   PB_P2_RETRY
                   •   PB_PB_ERR
                   •   PB_PB_D_PAR
                   •   PB_PB_RETRY
              2. PCI-1 Interface errors
                   •   P1_PB_ERR
                   •   P1_P2_ERR
                   •   P1_A_PAR
                   •   P1_PB_RETRY
                   •   P1_P2_RETRY
                   •   P1_P1_ERR
                   •   P1_P1_RETRY
              3. PCI-2 Interface errors
                   •   P2_PB_ERR
                   •   P2_P1_ERR
                   •   P2_A_PAR
                   •   P2_PB_RETRY
                   •   P2_P1_RETRY
                   •   P2_P2_ERR
                   •   P2_P2_RETRY
              See “Error Handling” on page 157 for information on how these interrupts for bus transaction
              exceptions are associated with error logging functionality.
PowerSpan II User Manual                                                                 Integrated Device Technology
80A1010_MA001_09                                                                                            www.idt.com


7. Interrupt Handling                                                                                                              147
7.3              Interrupt Registers
                PowerSpan II interrupt status and enabling, as well as message passing through mailboxes and
                doorbells are controlled by the interrupt registers. Table 33 provides a description of PowerSpan II
                registers controlling these functions.
                Table 33: Interrupt Register Description
                  Register Type          Register Description and Operation
                  Status                 The status register bits cover all of the interrupt sources supported PowerSpan II and
                                         indicate active interrupt sources when set (see “Interrupt Status” on page 148).
                                         With a some exceptions, all bits in these registers are read and cleared by setting
                                         (“R/Write 1 to Clear”)
                  Enable                 The enable register bits cover all of the interrupt sources supported by PowerSpan II
                                         and allow status bits to assert an external pin (see “Interrupt Enable” on page 150).
                                         With some exceptions, all bits in these registers are Read/Write.
                  Mapping                This series of registers allow each interrupt source to be mapped to a specific
                                         interrupt output pin. The mapping definitions are provided in Table 38 (see “Interrupt
                                         Mapping” on page 152)
                  Direction              Interrupt Direction refers to the ability to control the input/output characteristics of the
                                         PowerSpan II interrupt pins. Each pin has a corresponding bit that configures it as
                                         either an input-only or an output-only (see “Interrupt Pins” on page 153).
                  Mailbox                The Mailbox registers are a series of eight 32-bit Read/Write registers available for
                                         message passing between PowerSpan II interfaces (see “Mailboxes” on page 154)
Integrated Device Technology                                                                             PowerSpan II User Manual
www.idt.com                                                                                                    80A1010_MA001_09


148                                                                                                         7. Interrupt Handling
7.3.1         Interrupt Status
              When an interrupt source becomes active, the relevant status bit is set in one of the interrupt status
              registers. Interrupt Status is reported through two registers: “Interrupt Enable Register 0” on page 332
              and “Interrupt Status Register 1” on page 329. Interrupt Status Register 0 provides status for interrupts
              resulting from normal device operation. This includes I2O, DMA, hardware, doorbell and mailbox
              interrupts. A register description for ISR0 is provided in Table 34.
              All status bits are clear by default.
              Table 34: Register Description for Interrupt Status Register 0
                Bits                   Type        Description
                ISR1_ACTV              R           This bit indicates an active status bit in ISR1. This enables software to
                                                   monitor activity of the other interrupt status register while observing this
                                                   interrupt status register.
                I2O_HOST               R           Indicates to the Host that there are outstanding Message Frame
                                                   Addresses in the Outbound Post List FIFO.
                I2O_IOP                R/          Indicates to the IOP that there are outstanding Message Frame
                                       Write 1     Addresses in the Inbound Post List FIFO.
                                       to Clear
                DMAx                   R/          Status bit is set when DMAx generates an interrupt. See “DMA x General
                                       Write 1     Control and Status Register” on page 314 for details of DMAx interrupt
                                       to Clear    sources.
                x_HW                   R/          An interrupt is outstanding on an interrupt input (one of eight interrupt
                                       Write 1     pins, see “Interrupt Pins” on page 153).
                                       to Clear
                DBx                    R/          Set when a doorbell register is written to in the corresponding IER0 bit.
                                       Write 1
                                       to Clear
                MBOXx                  R/          Set when there is a write to a mailbox.
                                       Write 1
                                       to Clear
PowerSpan II User Manual                                                                         Integrated Device Technology
80A1010_MA001_09                                                                                                     www.idt.com


7. Interrupt Handling                                                                                                            149
                Interrupt Status Register 1 provides status for interrupts resulting from exceptions occurring during
                device operation. This includes maximum retry errors, bus errors, and parity error. A register
                description for ISR1 is provided in Table 35.
                Table 35: Register Description for Interrupt Status Register 1
                  Bits                Type       Description
                  ISR0_ACTV           R          This bit allows software to monitor activity of the other interrupt status
                                                 register while observing this interrupt status register. It essentially chains the
                                                 two registers so both are only read if necessary.
                  PB_x_RETRY          R/         The PowerSpan II PB Master Interface has detected more than the
                                      Write 1    maximum allowable retries.
                                      to Clear
                  PB_x_ERR            R/         The PowerSpan II PB Interface asserted (as slave) or received (as master)
                                      Write 1    PB_TEA_. The PB slave detects illegal conditions, while the PB master
                                      to Clear   receives PB_TEA_.
                  PB_A_PAR            R/         An address parity error was detected on the PB.
                                      Write 1
                                      to Clear
                  PB_x_D_PAR          R/         A data parity error was detected on the PB.
                                      Write 1
                                      to Clear
                  P2_x_ERR            R/         The PowerSpan II PCI-2 Interface detected an error. The corresponding PCI
                                      Write 1    Control and Status Register must be checked for the error.
                                      to Clear
                  P2_A_PAR            R/         The PowerSpan II PCI-2 Interface detected an address parity error.
                                      Write 1
                                      to Clear
                  P2_x_RETRY          R/         The PowerSpan II PCI-2 Master has detected more than the maximum
                                      Write 1    allowable retries.
                                      to Clear
                  P1_x_ERR            R/         The PowerSpan II PCI-1 Interface detected an error. The corresponding PCI
                                      Write 1    Control and Status Register must be checked for the error.
                                      to Clear
                  P1_A_PAR            R/         The PowerSpan II PCI-1 Interface detected an address parity error.
                                      Write 1
                                      to Clear
                  P1_x_RETRY          R/         The PowerSpan II PCI-1 Master has detected more than the maximum
                                      Write 1    allowable retries.
                                      to Clear
Integrated Device Technology                                                                         PowerSpan II User Manual
www.idt.com                                                                                                   80A1010_MA001_09


150                                                                                                       7. Interrupt Handling
              The description in Table 35 groups several bits under one name. For example, P1_x_RETRY actually
              corresponds to P1_P2_RETRY, P1_PB_RETRY, and P1_P1_RETRY.
              PowerSpan II has the following conventions:
              •    For errors detected by a master, PowerSpan II has separate reporting mechanisms for each source
                   interface. For example, if the PowerSpan II PCI-2 master detects an address parity error on a
                   transaction claimed by the PB slave, the P2_PB_A_PAR bit in the ISR1 register is set.
              •    For errors detected by a target/slave, PowerSpan II has separate reporting mechanisms for each
                   destination port. For example, if the PowerSpan II PB slave detects a data parity error on a
                   transaction destined for an agent connected to the PCI-1 external interface, the P1_PB_A_PAR bit
                   in the ISR1 register is set.
7.3.2         Interrupt Enable
              Each interrupt enable bit allows an active source status bit to assert one of the external interrupt pins.
              Interrupt enabling is controlled through two registers:“Interrupt Enable Register 0” on page 332 and
              “Interrupt Status Register 1” on page 329. Interrupt Enable Register 0 enables interrupts resulting from
              normal device operation. This includes I2O, DMA, hardware, doorbell and mailbox interrupts. A
              register description for IER0 is in Table 36.
              All interrupts are disabled by default.
              Table 36: Register Description for Interrupt Enable Register 0
                Bits                  Type      Description
                I2O_HOST_MASK         R/W       Masks an interrupt to the Host that there are outstanding MFAs in the
                                                Outbound Post List FIFO.
                I2O_IOP_EN            R/W       Enables an interrupt to the IOP indicating that there are outstanding MFAs in
                                                the Inbound Post List FIFO.
                DMAx_EN               R/W       Enables the DMAx interrupt
                x_HW_EN               R/W       Enables the corresponding hardware interrupt source t (one of eight
                                                interrupt pins, see “Interrupt Pins” on page 153).
                DBx_EN                Write 1   Sets the corresponding status bit
                                      to Set
                MBOXx_EN              R/W       Enables the Mailbox interrupt source
PowerSpan II User Manual                                                                        Integrated Device Technology
80A1010_MA001_09                                                                                                   www.idt.com


7. Interrupt Handling                                                                                                      151
                Interrupt Enable Register 1 enables interrupts resulting from errors occurring during the device
                operation. This includes maximum retry errors, bus errors, and parity errors. A register description for
                IER1 is in Table 37.
                Table 37: Register Description for Interrupt Enable Register 1
                  Bits                Type       Description
                  PB_x_RETRY_EN       R/W        Enables interrupt if the PowerSpan II PB Master has detected more than
                                                 the maximum allowable retries.
                  PB_x_ERR_EN         R/W        Enables interrupt if the PowerSpan II PB Interface asserted (as slave) or
                                                 received (as master) PB_TEA_.
                  PB_A_PAR_EN         R/W        Enables interrupt if an address parity error was detected on the PB.
                  PB_x_D_PAR_EN       R/W        Enables interrupt if a data parity error was detected on the PB.
                  P2_x_ERR_EN         R/W        Enables interrupt if the PowerSpan II PCI-2 Interface detected an error.
                                                 The corresponding PCI Control and Status Register must be checked for
                                                 the error.
                  P2_A_PAR_EN         R/W        Enables interrupt if the PowerSpan II PCI-2 Interface detected an address
                                                 parity error.
                  P2_x_RETRY_EN       R/W        Enables interrupt if the PowerSpan II PCI-2 Master has detected more
                                                 than the maximum allowable retries.
                  P1_x_ERR_EN         R/W        Enables interrupt if the PowerSpan II PCI-1 Interface detected an error.
                                                 The corresponding PCI Control and Status Register must be checked for
                                                 the error.
                  P1_A_PAR_EN         R/W        Enables interrupt if the PowerSpan II PCI-1 Interface detected an address
                                                 parity error.
                  P1_x_RETRY_EN       R/W        Enables interrupt if the PowerSpan II PCI-1 Master has detected more
                                                 than the maximum allowable retries.
                The descriptions in Table 35, Table 36,and Table 37 groups several bits under one name. For example,
                P1_x_RETRY actually corresponds to P1_P2_RETRY, P1_PB_RETRY, and P1_P1_RETRY.
                For errors detected by a master, PowerSpan II has separate reporting mechanisms for each source port.
                For example, if the PCI-2 master detects an address parity error on a transaction claimed by the PB
                slave, the P2_PB_A_PAR bit in the ISR1 register is set.
                For errors detected by a target/slave, PowerSpan II has separate reporting mechanisms for each
                destination port. For example, if the PowerSpan II PB slave detects a data parity error on a transaction
                destined for an agent connected to the PCI-1 external interface, the P1_PB_A_PAR bit in the ISR1
                register is set.
Integrated Device Technology                                                                         PowerSpan II User Manual
www.idt.com                                                                                                80A1010_MA001_09


152                                                                                                 7. Interrupt Handling
7.3.3         Interrupt Mapping
              The following registers contain mapping bits for PowerSpan II interrupt sources:
              •    IMR_MBOX (mailbox sources)
              •    IMR_DB (doorbell sources)
              •    IMR_DMA (DMA channel sources)
              •    IMR_HW (external pin sources)
              •    IMR_P1 (PCI-1 sources)
              •    IMR_P2 (PCI-2 sources)
              •    IMR_PB (Processor Bus sources)
              •    IMR2_PB (Processor Bus sources)
              •    IMR_MISC (I2O sources)
              Each interrupt source contains a three bit field in an IMR_x register. This mapping field determines
              which external pin to assert when the source is active and enabled.
              Table 38 details the mapping scheme. The shaded area in the table denotes the shaded map field and
              interrupt pin information apply only to the Dual PCI PowerSpan II
              Table 38: Mapping Definition
                     Map Field           Interrupt Pin
                        000                P1_INTA#
                        001                P2_INTA#
                        010                 INT[0]_
                        011                 INT[1]_
                        100                 INT[2]_
                        101                 INT[3]_
                        110                 INT[4]_
                        111                 INT[5]_
PowerSpan II User Manual                                                                  Integrated Device Technology
80A1010_MA001_09                                                                                             www.idt.com


7. Interrupt Handling                                                                                                 153
7.4              Interrupt Pins
                PowerSpan II has the following interrupt pins:
                •     P1_INTA#
                •     P2_INTA#
                •     INT[5:0]_
                Pins INT[5:0]_ are 5V tolerant and general purpose interrupt pins. Interrupt pins are active low and,
                when configured as input, are sampled on three successive processor bus clock edges to ensure
                appropriate setting of a status bit.
                Each pin is bidirectional, open drain, active low and level sensitive. The input/output character of each
                interrupt pin is controlled through a corresponding bit in the “Interrupt Direction Register” on
                page 347. Each pin can be configured as either an input or output. All pins are configured as inputs by
                default.
                P1_INTA# and P2_INTA# are intended to be used with PCI interfaces PCI-1 and PCI-2. They are
                electrically PCI compliant. To configure PCI interface Px with interrupt capability, the following
                register settings are required:
                •     INT_PIN = 0x01, in the “PCI-1 Miscellaneous 1 Register” on page 262 (Px_MISC1). This setting
                      enables a single function PCI device INTA#
                •     Px_HW_DIR = 0x01, in the “Interrupt Direction Register” on page 347 (ID). Px_INTA# is
                      configured as an output pin.
                If the PCI interface Px does not require interrupt capability, the following register settings are
                necessary:
                •     INT_PIN = 0x00, in the Px_MISC1 register. This setting enables a single function PCI device that
                      is using no interrupts.
                •     Px_INTA = user defined, in the ID register. Px_INTA# is used as general purpose pin.
                PowerSpan II provides an EEPROM load feature to automatically control the interrupt capabilities of
                PCI-1 and PCI-2 (see “I2C/EEPROM” on page 127).
Integrated Device Technology                                                                    PowerSpan II User Manual
www.idt.com                                                                                           80A1010_MA001_09


154                                                                                                  7. Interrupt Handling
7.5           DMA Interrupts
              The PowerSpan II DMA supports a number of interrupt sources for each channel. Individual enable
              and status bits exist for each source. The status and enable bits are contained in the “DMA x General
              Control and Status Register” on page 314:
              Table 39: DMA Channel Interrupt Sources and Enables
                          Interrupt Source                          Enable bit
                                DONE                                DONE_EN
                              P1_ERR                               P1_ERR_EN
                              P2_ERR                               P2_ERR_EN
                              PB_ERR                               PB_ERR_EN
                                HALT                                 HALT_EN
                                STOP                                STOP_EN
              The following programming steps route done, halt and stop interrupts on DMA channel two onto
              INT[3]_:
              •    Set the DMA2_EN bit in the IER0 register
              •    Program the DMA2_MAP bit to 0bx101 in the IMR_DMA register
              •    Set the DONE_EN, HALT_EN, STOP_EN bits in the “DMA x General Control and Status
                   Register” on page 314 (DMAx_GCSR)
7.5.1         DMA Interrupt Servicing
              To service a DMA interrupt, the following steps must be taken:
              •    Read “Interrupt Enable Register 0” on page 332 (ISR0) to determine which DMA channel caused
                   the interrupt
              •    Read DMAx_GCSR to determine which DMA source caused the interrupt
              •    Service the interrupt
              •    Write 1 to clear DMAx_GCSR[status_bit] and allow a restart of the DMA channel
              •    Write 1 to clear the DMAx_EN bit in the ISR0 register and negate the interrupt signal
7.6           Mailboxes
              PowerSpan II provides eight 32-bit general Mailbox registers for passing messages between processes.
              Each Mailbox has an associated interrupt enable and status bit. When enabled, an interrupt is generated
              whenever there is a write to the Mailbox register.
PowerSpan II User Manual                                                                   Integrated Device Technology
80A1010_MA001_09                                                                                              www.idt.com


7. Interrupt Handling                                                                                                 155
7.7              Doorbells
                The Doorbell interrupts are generated by writing 1 to the corresponding Doorbell x Enable (DBx_EN)
                bit in the “Interrupt Enable Register 0” on page 332. The Doorbell interrupt is cleared by writing a 1 to
                the corresponding Doorbell x (DBx) bit in the “Interrupt Status Register 0” on page 327.
Integrated Device Technology                                                                  PowerSpan II User Manual
www.idt.com                                                                                         80A1010_MA001_09


156                                7. Interrupt Handling
PowerSpan II User Manual Integrated Device Technology
80A1010_MA001_09                            www.idt.com


                                                                                                                         157
8.              Error Handling
                Errors occur in a system as a result of parity, bus, or internal problems. In order to handle errors so that
                they have minimum effects on an application, devices have a logic module called an error handler. The
                error handler logs data about the error then communicates the information to another device (for
                example, a host processor) that is capable of resolving the error condition.
                This chapter discusses the following topics about PowerSpan II’s error handling features:
                •   “PB Interface Errors” on page 158
                •   “PCI Interface Errors” on page 162
                •   “DMA Errors” on page 166
8.1             Overview
                PowerSpan II has error detection, error reporting and error recovery mechanisms for each of the major
                interfaces — Processor Bus (PB), PCI-1 and PCI-2.
                The master and target/slave of each interface provides error detection for transactions where they
                participate. The types of errors identified are:
                •   Address parity
                •   Data parity
                •   Bus errors (Target-Abort, Master-Abort, and PB_TEA_ assertion)
                •   Maximum retry errors
                Each of PowerSpan II’s interfaces has a mechanism for reporting detected errors to hardware and/or
                software. The reporting mechanisms include:
                •   Interrupt status bits in the “Interrupt Status Register 1” on page 329 — the error is reported through
                    PowerSpan II’s interrupt generation mechanisms
                •   PCI standard error reporting mechanisms
Integrated Device Technology                                                                     PowerSpan II User Manual
www.idt.com                                                                                            80A1010_MA001_09


158                                                                                                   8. Error Handling
              •    Error logging registers that capture parameters from the transaction that caused the error
              •    Assertion of external bus protocol pins
                   PowerSpan II has separate reporting mechanisms for each source port when errors are detected by
                   a master. For example, if the PC1-2 Master detects a address parity error on a transaction claimed
                   by the PB slave, the P2_PB_A_PAR bit in the ISR1 register is set.
                   For errors detected by a target/slave, PowerSpan II provides separate reporting tools for each
                   destination port. For example, if the PowerSpan II PB slave detects a data parity error on a
                   transaction destined for an agent connected to the PCI-1 external interface, the PB_P1_D_PAR bit
                   in the ISR1 is set.
                   Each PowerSpan II DMA channel provides an additional reporting mechanism (see “DMA Errors”
                   on page 166).
8.2           PB Interface Errors
              The PB master and slave detect error conditions while participating in PB transactions. In addition to
              Interrupt Status Register 1, the PB Interface has the following error reporting mechanisms:
              •    Assertion of PB_TEA_ — provided the Transfer Error Acknowledge Enable (TEA_EN) bit in the
                   “Processor Bus Miscellaneous Control and Status Register” on page 304 (PB_MISC_CSR) is set
                   to 1
              •    Capture of specific parameters from the transaction that caused the error
                    a. “Processor Bus Error Control and Status Register” on page 302 (PB_ERRCS) logs:
                         –   PB_TT signals
                         –   PB_TSIZ signals
                    b. “Processor Bus Address Error Log” on page 303 (PB_AERR) logs:
                         –   PB_A signals
PowerSpan II User Manual                                                                  Integrated Device Technology
80A1010_MA001_09                                                                                           www.idt.com


8. Error Handling                                                                                                    159
                Table 40 itemizes the error cases detected and reported by the PB master and the PB slave. Error
                logging in PB_ERRCS and PB_AERR is triggered for each of the error cases outlined in Table 40.
                Table 40: PB Interface Errors
                  Interface        Error       Destination/Source             Conditions                 Reporting
                  PB slave   Address parity   PCI-1, PCI-2,          Address only, Write, Read    PB_A_PAR in the ISR1
                                              Registers                                           register
                                Data parity   PCI-1, Registers       Write                        PB_P1_D_PAR in the
                                                                                                  ISR1 register
                                              PCI-2                  Write                        PB_P2_D_PAR in the
                                                                                                  ISR1 register
                              Illegal access  PCI-1 (Memory)         Unaligned access in PPC      PB_TEA if TEA_EN=1,
                                                                     little-endian mode           PB_P1_ERR in the
                                                                                                  ISR1 register
                                              PCI-1 (Configuration,  Unaligned access in PPC
                                              IO, IACK)              little-endian mode,
                                              Registers              Transaction Size > 4 bytes
                                                                     or burst
                                              PCI-2 (Memory)         Unaligned access in PPC      PB_TEA if TEA_EN=1,
                                                                     little-endian mode           PB_P2_ERR in the
                                                                                                  ISR1 register
                                              PCI-2 (Configuration,  Unaligned access in PPC
                                              IO, IACK)              little-endian mode,
                                                                     Transaction Size > 4 bytes
                                                                     or burst
                             Propagation of   PCI-1                  Read                         PB_TEA if
                                 error from                                                       TEA_EN=1
                                destination
                                  master      PCI-2                  Read                         PB_TEA if
                                                                                                  TEA_EN=1
Integrated Device Technology                                                                    PowerSpan II User Manual
www.idt.com                                                                                          80A1010_MA001_09


160                                                                                                     8. Error Handling
              Table 40: PB Interface Errors
                Interface         Error       Destination/Source            Conditions                  Reporting
                PB Master     Data parity     External PCI-1 agent    Read                       PB_P1_D_PAR in the
                                              PB to PCI-1 DMA                                    ISR1 register
                                              External PCI-2 agent    Read                       PB_P2_D_PAR in the
                                              PB to PCI-2 DMA                                    ISR1 register
                                              DMA PB Linked-List      Read                       PB_PB_D_PAR in the
                                              PB to PB DMA                                       ISR1 register
                             External agent   External PCI-1 agent    Read/Write                 PB_P1_ERR in the
                                 asserts      PB to PCI-1 DMA                                    ISR1 register
                               PB_TEA_
                                              PCI-1 to PB DMA
                                              External PCI-2 agent    Read/Write                 PB_P2_ERR in the
                                              PB to PCI-2 DMA                                    ISR1 register
                                              PCI-2 to PB DMA
                                              DMA PB Linked-List                                 PB_PB_ERR in the
                                              PB to PB DMA                                       ISR1 register
                               Max retry      External PCI-1 agent                               PB_P1_RETRY in the
                                 expires      PB to PCI-1 DMA                                    ISR1 register
                                              PCI-1 to PB DMA
                                              External PCI-2 agent                               PB_P2_RETRY in the
                                              PB to PCI-2 DMA                                    ISR1 register
                                              PCI-2 to PB DMA
              The shaded row from the PB slave section of Table 40 indicates the PB slave asserts PB_TEA_ and sets
              a bit in the ISR1 register when an external PB master attempts a register access or a PCI-1
              Configuration, IO or IACK transaction with any of the following characteristics:
              •    Not naturally aligned — if Endian (END) bit in the PB_REG_BADDR register is programmed for
                   PowerPC little-endian mode
              •    Transfer Size, PB_TSIZ, indicates a transfer greater than 4 bytes
              When a PowerSpan II PCI master is performing a read and encounters a Target-Abort, or generates a
              Master-Abort, an error indication is latched. When the Address Retry Enable (ARTRY_EN) bit, in the
              “Processor Bus Miscellaneous Control and Status Register” on page 304, is set to 0 the error is
              immediately signaled by the PB slave and the transaction terminates. If ARTRY_EN is set to 1, the PB
              slave propagates this error to the initiating the processor bus agent when it returns to retrieve the read
              data it requested.
              The assertion of the PB_TEA_ signal is controlled with assertion the Transfer Error Acknowledge
              Enable (TEA_EN) bit in the PB_MISC_CSR register. If TEA_EN is set, the PB slave reports error
              scenarios as defined in Table 40. If TEA_EN is cleared, transactions determined to be in error are not
              forwarded to the intended interface or registers. The appropriate ISR1 status bits are set.
PowerSpan II User Manual                                                                  Integrated Device Technology
80A1010_MA001_09                                                                                             www.idt.com


8. Error Handling                                                                                                     161
                The PB slave propagation of PCI Master-Abort for Configuration commands is controlled with the
                Master-Abort Configuration Error Mapping (MAC_TEA) bit in the PB_MISC_CSR register. When
                MAC_TEA is set, the PB slave returns all ones on a PCI Configuration read which terminates with
                Master-Abort. If MAC_TEA is cleared, the PB slave asserts PB_TEA_.
                The shaded row from the PB master section of Table 40 indicates that the PB master sets a bit in the
                ISR1 register if its transaction is terminated with PB_TEA_. The sources for such a transaction are:
                •    External PCI-1 agent read or write
                •    DMA channel moving data to/from PCI-1
                A typical interrupt service routine for a PB Interface error — as illustrated for in Table 40 — executes
                the following steps:
                1. Read ISR1 to determine which interface reported the error.
                2. Read error logs PB_ERRCS and PB_AERR to obtain diagnostic information if the PB Interface
                     reported the error.
                3. Clear the Error Status (ES) bit in the PB_ERRCS to enable future error logging.
                4. Clear the status bit in ISR1— this negates external interrupt pin.
                5. Fix the configuration issue that caused the error.
                6. Retry the transaction that caused the error.
                The flow of transactions through the PowerSpan II interfaces is independent of error status bits in ISR1
                and Error Status bit in the “Processor Bus Error Control and Status Register” on page 302. If
                PowerSpan II detects an error while processing a transaction, subsequent transactions are not affected.
                The transaction response for a PB slave error is as follows:
                •    Address parity: do not claim the transaction
                •    Data parity: transaction proceeds normally to its destination
                •    Illegal access (see Table 40)
                The transaction response for a PB master error is as follows:
                •    Data parity on reads:
                      — Transaction proceeds normally back to the source
                      — Correct data parity is calculated internally and propagated back to the source
Integrated Device Technology                                                                    PowerSpan II User Manual
www.idt.com                                                                                           80A1010_MA001_09


162                                                                                                   8. Error Handling
              •    Assertion of PB_TEA_, expiration of max retry counter:
                    — All writes
                         –   Stop the transaction
                         –   Purge the entire source transaction from the Switching Fabric
                         –   Error status sent to DMA channel registers (for DMA writes)
                    — All reads
                         –   Stop the transaction
                         –   Latch error condition for propagation back to source
8.3           PCI Interface Errors
              In the following discussion Px refers to the PCI Interface that detected the error and Py refers to the
              alternate PCI Interface.
              The Px master and target detect error conditions while participating in PCI bus transactions. In addition
              to the “Interrupt Status Register 1” on page 329 (ISR1), the Px Interface provides the following
              reporting mechanisms:
              •    External signaling of the following signals:
                    — Target-Abort
                    — Master-Abort
                    — Address parity errors
                    — Data parity errors
              •    Detection of Target-Abort.
              •    Standard PCI error reporting in “PCI-1 Control and Status Register.” on page 251 (Px_CSR).
              •    Capture of specific parameters from the transaction that caused the error:
                    — “PCI-1 Bus Error Control and Status Register” on page 281 (Px_ERRCS), which logs PCI
                       command
                    — “PCI-1 Address Error Log Register” on page 282 (Px_AERR), which logs PCI Address
                       (Px_AD)
              Table 41 on page 163 itemizes the error cases detected and reported by the Px master and the Px target.
              Error logging in Px_ERRCS and Px_AERR is triggered for each of these error cases
PowerSpan II User Manual                                                                  Integrated Device Technology
80A1010_MA001_09                                                                                           www.idt.com


8. Error Handling                                                                                163
Table 41: PCI Interface Errors
 Interface     Error          Destination/Source Conditions  Reporting
 Px            Address Parity PB, Registers, Py  Write, Read Px_SERR if PERESP=1 and
 Target                                                      SERR_EN=1, S_SERR in the
                                                             Px_CSR register if PERESP=1
                                                             and SERR_EN=1, D_PE in the
                                                             Px_CSR register, Px_A_PAR in
                                                             the ISR1 register
               Data parity    PB, Registers      Write       Px_PERR if PERESP=1, D_PE
                                                             in the Px_CSR register,
                                                             Px_PB_ERR in the ISR1 register
                              Py                 Write       Px_PERR if PERESP=1, D_PE
                                                             in the Px_CSR register,
                                                             Px_Py_ERR in the ISR1 register
               Propagation of PB                 Read        Target-Abort, S_TA in the
               Error from                                    Px_CSR register, Px_PB_ERR in
               Destination                                   the ISR1 register
               Master
                              Py                 Read        Target-Abort, S_TA in the
                                                             Px_CSR register, Px_Py_ERR in
                                                             the ISR1 register
 Px Master     Data Parity    External PB agent  Read        Px_PERR if PERESP=1,
                              Px-to-PB DMA                   MDP_D in the Px_CSR register if
                                                             Px_PERR, D_PE in the Px_CSR
                                                             register, Px_PB_ERR in the ISR1
                                                             register
                              External Py agent  Read        Px_PERR if PERESP=1,
                              Px-to-Py DMA                   Px_CSR[MDP_D] if Px_PERR_,
                                                             D_PE in the Px_CSR register,
                                                             Px_Py_ERR in the ISR1 register
                              DMA Px Linked-List Read/Write  Px_PERR if PERESP=1,
                              Px-to-Px DMA                   MDP_D in the Px_CSR register if
                                                             Px_PERR_, D_PE in the
                                                             Px_CSR register, Px_Px_ERR in
                                                             the ISR1 register
               External Agent External PB agent  Read/Write  R_TA in the Px_CSR register,
               Generates      Px-to-PB DMA                   Px_PB_ERR in the ISR1 register
               Target-Abort   PB-to-Px DMA
                              External Py agent  Read/Write  R_TA in the Px_CSR register,
                              Px-to-Py DMA                   Px_Py_ERR in the ISR1 register
                              Py-to-Px DMA
                              DMA Px Linked-List             R_TA in the Px_CSR register,
                              Px-to-Px DMA                   Px_Px_ERR in the ISR1 register
Integrated Device Technology                                                 PowerSpan II User Manual
www.idt.com                                                                       80A1010_MA001_09


164                                                                                                      8. Error Handling
Table 41: PCI Interface Errors
 Interface   Error             Destination/Source      Conditions               Reporting
 Px Master   Px Master         External PB agent       Read/Write               R_MA in the Px_CSR register,
             Generates         Px-to-PB DMA                                     Px_PB_ERR in the ISR1 register
             Master-Abort
                               PB-to-Px DMA
                               External Py agent                                R_MA in the Px_CSR register,
                               Px-to-Py DMA                                     Px_Py_ERR in the ISR1 register
                               Py-to-Px DMA
                               DMA Px Linked-List                               R_MA in the Px_CSR register,
                               Px-to-Px DMA                                     Px_Px_ERR in the ISR1 register
 Px Master   Maximum           External PB agent                                Px_PB_RETRY in the ISR1
             Retry Expires     Px-to-PB DMA                                     register
                               PB to-Px DMA
                               External Py agent                                Px_Py_RETRY in the ISR1
                               Px-to-Py DMA                                     register
                               Py-to-Px DMA
                               DMA Px Linked-List                               Px_Px_RETRY in the ISR1
                               Px-to-Px DMA                                     register
               When the PB master or Py master are performing a read and encounter an error condition, an error
               indication is latched. The Px target propagates this error to the initiating Px external master when it
               comes back to acquire the read data it requested. This scenario is indicated by the shaded row in the Px
               target section of Table 41. The Px target signals a Target-Abort on the bus and sets the Px Processor
               Bus Error (Px_PB_ERR) bit in the “Interrupt Status Register 1” on page 329 and Signaled
               Target-Abort (S_TA) bit in the “PCI-1 Control and Status Register.” on page 251. In this case the
               PowerSpan II PB Master or Py master and the Px target reports the error.
               The shaded row from the Px master section of Table 41 indicates that the Px master sets the
               Px_PB_ERR bit in the ISR1 register and the R_TA bit in the Px_CSR register if its transaction
               terminates with a Target-Abort. The sources for such a transaction are:
               •    External PB agent read or write
               •    DMA channel moving data to/from PB
               The MDP_D bit in the Px_CSR register is also set for data parity errors detected by an external target
               during write transactions. This condition was not included in the Px master section of Table 41 because
               the master does not detect the error.
               The assertion of Px_PERR# is controlled with the Parity Error Response (PERESP) bit in the “PCI-1
               Control and Status Register.” on page 251. The assertion of Px_SERR# is controlled with the PERESP
               bit and SERR# Enable (SERR_EN) bit in the Px_CSR.
PowerSpan II User Manual                                                                     Integrated Device Technology
80A1010_MA001_09                                                                                              www.idt.com


8. Error Handling                                                                                                    165
                The user controls the Px target propagation of PCI Master-Abort Configuration command initiated on
                Py with MAC_ERR. When the Master-Abort Configuration Error Mapping (MAC_ERR) bit is set in
                the “PCI-1 Miscellaneous Control and Status Register” on page 283, the Px target returns all ones on a
                Py Configuration read that terminates with Master-Abort. When the MAC_ERR bit is cleared, the Px
                target responds with Target-Abort.
                A typical interrupt service routine for a PB Interface error — as illustrated for in Table 41 — executes
                the following steps:
                1. Read ISR1 to determine which interface reported the error.
                2. If the PCI-1 Interface reported the error:
                     •    Read error logs Px_ERRCS and Px_AERR to obtain diagnostic information.
                     •    Read Px_CSR to distinguish address parity, data parity, Target-Abort, Master-Abort scenarios.
                3. Clear Px_ERRCS[ES] to enable future error logging.
                4. Clear the status bit in ISR1.
                     Negates external interrupt pin.
                5. Clear the error bits in Px_CSR.
                6. Fix the configuration issue that caused the error.
                7. Retry the transaction that caused the error.
                The flow of transactions through PowerSpan II is independent of error status bits in “Interrupt Status
                Register 1” on page 329, error status bits in “PCI-1 Control and Status Register.” on page 251 and the
                Error Log Status (ES) bit in the “PCI-1 Bus Error Control and Status Register” on page 281.
                The transaction response for a Px target error is:
                •    Address parity: claim and complete as normal
                •    Data parity: transaction proceeds normally to its destination
                The transaction response for a Px master error is:
                •    Data parity on reads
                     — Transaction proceeds normally to its source
                     — Correct data parity is calculated internally and propagated back to the source
                •    Detection of Target-Abort, generation of Master-Abort, expiration of max retry counter:
                     — All writes:
                           –   Stop the transaction
                           –   Purge the entire source transaction from the Switching Fabric
                           –   DMA writes, error status sent to DMA channel registers
                     — All reads:
                           –   Stop the transaction
                           –   Latch error condition for propagation back to source
Integrated Device Technology                                                                    PowerSpan II User Manual
www.idt.com                                                                                           80A1010_MA001_09


166                                                                                                    8. Error Handling
8.4           DMA Errors
              A PowerSpan II DMA channel requires a PowerSpan II master to service source activity and a second
              PowerSpan II master to service destination activity. These masters provide error detection and
              reporting services as described in the previous sections. The DMA channel provides the following
              additional status bits to indicate an error condition on an interface currently in use:
              •    Processor Bus Error (PB_ERR) bit in the “DMA x General Control and Status Register” on
                   page 314 (DMAx_GCSR)
              •    PCI-1 Bus Error (P1_ERR) in the DMAx_GCSR register
              •    PCI-2 Bus Error (P2_ERR) in the DMAx_GCSR register
              These status bits can be used to cause the assertion of a PowerSpan II interrupt pin according to
              “Interrupt Handling” on page 145.
              Assume that an error occurred at the PCI-1 master using DMA-2. A typical interrupt service routine
              executes the following steps:
              1. ISR1 read to determine which interface reported the error.
              2. If PCI-1 reports the error:
                    •  Error logs P1_ERRCS and P1_AERR read to obtain diagnostic information.
                    •  P1_CSR read to distinguish address parity, data parity, target abort, master abort scenarios.
              3. ISR0 read to determine if a DMA2 status bit is set.
              4. DMA2_GCSR read to determine which condition caused the channel to interrupt.
              5. The ES bit is cleared in the P1_ERRCS register to enable future error logging.
              6. The status bit in ISR is cleared — this negates external interrupt pin.
              7. The status bit in P1_CSR is cleared.
              8. Configuration issue that caused the error is corrected.
              9. P1_ERR bit in the DMA2_GCSR is cleared to allow DMA channel two to restart.
              10. DMA channel two is restarted.
PowerSpan II User Manual                                                                   Integrated Device Technology
80A1010_MA001_09                                                                                            www.idt.com


                                                                                                                        167
9.              Resets, Clocks and Power-up Options
                This chapter describes the resets, clocks and power-up options implemented by PowerSpan II. The
                following topics are discussed:
                •    “Reset” on page 167
                •    “Clocks” on page 170
                •    “Power-Up Options” on page 171
9.1             Reset
                PowerSpan II has several inputs to its reset logic. It also has the capability of propagating the reset to
                the other side of the bus.
                          PowerSpan II has reset capabilities for PCI Host, Adapter and Hot Swap applications
9.1.1           Reset Pins
                PowerSpan II reset pins are listed in Table 42..
                Table 42: PowerSpan II Reset Pins
                  Pin Name                        Direction                         Description
                  PO_RST_                         Input only                        Power-On Reset
                  HEALTHY#                        Input only                        Board Status (CompactPCI Hot
                                                                                    Swap)
                  PB_RST_                         Bidirectional open drain          Processor Bus Hard Reset
                  P1_RST#                         Tristate bidirectional            PCI-1 Bus Reset
                  P2_RST#                         Tristate bidirectional            PCI-2 Bus Reset
                  TRST_                           Input only                        JTAG Reset
                All pins indicate a reset condition when driven low, except for HEALTHY# signal.
9.1.1.1         Reset Direction Control Pins
                Each bidirectional reset pin (PB_RST_, P1_RST#, and P2_RST#) has a dedicated direction control pin.
                The assertion of a reset pin configured as input propagates to the other bus reset pins configured as
                output.
Integrated Device Technology                                                                     PowerSpan II User Manual
www.idt.com                                                                                           80A1010_MA001_09


168                                                                               9. Resets, Clocks and Power-up Options
              The relationship between the reset and direction control pins is defined in Table 43.
              Table 43: Reset Direction Control Pins
                Control Pin             Associated Reset Pin       Description
                PB_RST_DIR              PB_RST_                    Direction of PB_RST_
                                                                   • When PB_RST_DIR = 0, PB_RST_ is an
                                                                     input
                                                                   • When PB_RST_DIR = 1, PB_RST_ is an
                                                                     output
                P1_RST_DIR              P1_RST#                    Direction of P1_RST#
                                                                   • When P1_RST_DIR = 0, P1_RST# is an
                                                                     input
                                                                   • When P1_RST_DIR = 1, P1_RST# is an
                                                                     output
                P2_RST_DIR              P2_RST#                    Direction of P2_RST#
                                                                   • When P2_RST_DIR = 0, P1_RST# is an
                                                                     input
                                                                   • When P2_RST_DIR = 1, P2_RST# is an
                                                                     output
              The dedicated direction control pins must either be pulled up or down. At least one of the bidirectional
              reset pins must be configured as an input. Typically, the bus reset pin on the bus closest to the system
              host must be configured as an input.
9.1.1.2       Reset Response
              The assertion of an external reset pin elicits a specific response from PowerSpan II. Table 44 defines
              how various PowerSpan II resources are affected by active reset pins.
              Table 44: PowerSpan II Reset Response
                                                                  PowerSpan II Resource
                                                                                          PowerSpan II
                                                                                              Device
                                                 PCI-1          PCI-2            PB           Specific      Finite State
                   Reset Pin       PLLs       Registers       Registers      Registers      Registers        Machines
                 PO_RST_ = 0        Yes           Yes            Yes            Yes             Yes             Yes
                HEALTHY# = 1        Yes           Yes            Yes            Yes             Yes             Yes
                 PB_RST_ = 0         No           No             No             Yes             Yes             Yes
                 P1_RST# = 0         No           Yes            No              No             Yes             Yes
                 P2_RST# = 0         No           No             Yes             No             Yes             Yes
PowerSpan II User Manual                                                                     Integrated Device Technology
80A1010_MA001_09                                                                                              www.idt.com


9. Resets, Clocks and Power-up Options                                                                                   169
                PowerSpan II’s response to the assertion of a bidirectional reset pin is independent of the direction of
                that pin.
                PowerSpan II’s PB_RST_, P1_RST# and P2_RST# are bidirectional. When they are configured as
                outputs, they still sense logic lows. If any of these signals sense the logic low on their particular reset
                signal, the corresponding PowerSpan II bus interface is in a reset state. However, the reset does not
                propagate to other PowerSpan II busses when the reset pin is configured as an input. In order for
                PowerSpan II to propagate the reset another bus, the reset pin must be configured as an input (see
                “Reset Generation” on page 169)
                PowerSpan II’s input reset pins do not require clock synchronization - they are asynchronous.
                The Phase Locked Loops (PLLs) in PowerSpan II are only reset by either the assertion of PO_RST_ or
                negation of HEALTHY#. The assertion of PO_RST_ or negation of HEALTHY# causes all the
                PowerSpan II resources to be reset. These resources are not released from reset until all PLLs are
                locked (see Table 97 on page 396 and Table 102 on page 402, parameter t103).
                           Applications that use both HEALTHY# and PO_RST_ must assert HEALTHY# before
                           negating PO_RST_. (see Table 97 on page 396 and Table 102 on page 402, parameter t101)
                The HEALTHY# pin tristates all of PowerSpan II’s output buffers, and inhibits all of PowerSpan II’s
                input buffers. See “CompactPCI Hot Swap Silicon Support” on page 53 for more details on the use of
                HEALTHY#.
                The assertion of TRST_ resets the JTAG controller and configures the Boundary Scan Register for
                normal system operation.
                           Customers must assert TRST_ concurrently with PO_RST_ as part of the power-up reset
                           sequence. If the PowerSpan II JTAG interface is not used, the TRST_ signal must be
                           pulled-down with a 1 Kohm resistor.
9.1.1.3         Reset Generation
                Each of PowerSpan II’s three interfaces have bidirectional reset pins that are used to reset the hardware
                on the associated bus.
                PowerSpan II assertion of PB_RST_ occurs if PB_RST_DIR is pulled high and one of the following
                occurs:
                •    PO_RST_ asserted
                •    P1_RST_DIR is pulled low and P1_RST# is asserted
                •    P2_RST_DIR is pulled low and P2_RST# is asserted
                PowerSpan II assertion of P1_RST# occurs if P1_RST_DIR is pulled high and on of the following
                occurs:
                •    PO_RST_ asserted
                •    PB_RST_DIR is pulled low and PB_RST# is asserted
                •    P2_RST_DIR is pulled low and P2_RST# is asserted
Integrated Device Technology                                                                     PowerSpan II User Manual
www.idt.com                                                                                            80A1010_MA001_09


170                                                                             9. Resets, Clocks and Power-up Options
              PowerSpan II assertion of P2_RST# occurs if P2_RST_DIR is pulled high and on of the following
              occurs:
              •    PO_RST_ asserted
              •    PB_RST_DIR is pulled low and PB_RST_ is asserted
              •    P1_RST_DIR is pulled low and P1_RST# is asserted
              The negation of HEALTHY# tristates all PowerSpan II output pins, including the reset outputs.
              PowerSpan II reset outputs do not respond immediately to the negation of PO_RST_ because they are
              negated once all internal PLLs are locked.
9.2           Clocks
              Each of the PowerSpan II external ports has a clock input pin. The pins are:
              •    PB_CLK
              •    P1_CLK
              •    P2_CLK
              The clock input for each port enables PowerSpan II’s master/target state machines to be synchronized
              to the external bus. Each interface has a dedicated PLL designed to eliminate clock tree insertion delay.
              PowerSpan II requires the input clock to be at the specified frequency before the negation of PO_RST_
              (see Table 97 on page 396 and Table 102 on page 402, parameter t102). PowerSpan II PLLs are reset
              during either the assertion of PO_RST_ or the negation of HEALTHY#. The PLLs are not locked until
              a certain period after the negation of PO_RST_ or HEALTHY# (see Table 97 on page 396 and
              Table 102 on page 402, parameter t103).
              Each PLL has a dedicated configuration pin to indicate the desired operating frequency range. The
              following configuration pins are used by the PLL:
              •    PB_FAST
              •    P1_M66EN
              •    P2_M66EN
                         PB_FAST, P1_M66EN, and P2_M66EN are multiplexed signals. They are also used for
                         PowerSpan II power-up options (see “Power-Up Options” on page 171).
              The input clocks are not required to maintain specific phase relationships. However, there is a
              limitation on the range of input clock periods. The ratio of the maximum period to minimum period, for
              all three clock inputs, must be less than four. For example, if the period of PB_CLK is 10 ns, the
              periods of P1_CLK and P2_CLK must be less than, but not equal to, 40 ns.
              PowerSpan II has power-up options for bypassing all three PLLs. This capability is used for debugging
              purposes. IDT recommends always enabling the PLL.Refer to “Power-Up Options” on page 171 for
              more information on power-up options.
PowerSpan II User Manual                                                                   Integrated Device Technology
80A1010_MA001_09                                                                                            www.idt.com


9. Resets, Clocks and Power-up Options                                                                           171
9.3             Power-Up Options
                To ensure proper operation, a number of PowerSpan II features must be configured by completion of
                the power-up reset sequence. PowerSpan II has the following modes to configure these power-up
                options:
                •    Multiplexed System Pins mode
                •    Configuration Slave mode (only available in a PowerQUICC II system)
                The Multiplexed System Pins mode multiplexes several input pins during the power-up reset sequence
                to configure power-up options. The Multiplexed System Pins mode is the default mode for PowerSpan
                II.
                In the Configuration Slave mode, the power-up options are latched from PB_D. PB_RSTCONF_ is
                asserted by the configuration master during the assertion of PB_RST_. Refer to the MPC8260
                (PowerQUICC II) User Manual for a detailed description of configuration master functionality.
                Power-up option status can be confirmed by reading the Reset Control and Status (RST_CSR) register
                (see “Configuration Slave Mode” on page 175 for more information).
                           Power-up options are not affected by reset events on the PB_RST_, P1_RST# or P2_RST#
                           pins.
                Table 45 lists PowerSpan II power-up options and directions for their configuration with PowerSpan II
                system pins and the processor data bus in configuration slave mode.
                Table 45: PowerSpan II Power-up Options
                     Power-up Option           Selection        System Pina     PB_D Pinb       RST_CSR Register
                  PB Arbiter Enable        Enable PB Arbiter   PB_FAST=1        PB_D[0]=1   PB_ARB_EN=1
                                           Disable PB Arbiter  PB_FAST=0        PB_D[0]=0   PB_ARB_EN=0
                  (PWRUP_PB_ARB_EN)
                  PCI-1 Arbiter Enable     Enable              P1_M66EN=1       PB_D[1]=1   P1_ARB_EN=1
                                           PCI-1 Arbiter
                                           Disable             P1_M66EN=0       PB_D[1]=0   P1_ARB_EN=0
                  (PWRUP_P1_ARB_EN)        PCI-1 Arbiter
                  PCI-2 Arbiter Enable     Enable              P2_M66EN=1       PB_D[2]=1   P2_ARB_EN=1
                                           PCI-2 Arbiter
                                           Disable             P2_M66EN=0       PB_D[2]=0   P2_ARB_EN=0
                  (PWRUP_P2_ARB_EN)        PCI-2 Arbiter
                  Primary PCI Select       PCI-1 is Primary    INT[5]_=1        PB_D[3]=0   PRI_PCI=0
                                           PCI-2 is Primary    INT[5]_=0        PB_D[3]=1   PRI_PCI=1
                  (PWRUP_PRI_PCI)
Integrated Device Technology                                                                 PowerSpan II User Manual
www.idt.com                                                                                       80A1010_MA001_09


172                                                                            9. Resets, Clocks and Power-up Options
              Table 45: PowerSpan II Power-up Options
                   Power-up Option             Selection         System Pina  PB_D Pinb            RST_CSR Register
                PCI-1 REQ64 Enable         Disable              INT[4]_=1     PB_D[4]=0       P1_R64_EN=0
                                           P1_REQ64_
                (PWRUP_P1_R64_EN)          Enable               INT[4]_=0     PB_D[4]=1       P1_R64_EN=1
                                           P1_REQ64_
                Boot select                PB Boot              INT[3]_=1     PB_D[5]=0       PCI_BOOT=0
                                           PCI Boot             INT[3]_=0     PB_D[5]=1       PCI_BOOT=1
                (PWRUP_BOOT)
                7400 Mode Enable           Disable              INT[2]_=1     PB_D[6]=0       7400_MODE=0
                                           7400_Mode
                                           Enable               INT[2]_=0     PB_D[6]=1       7400_MODE=1
                (PWRUP_7400_MODE)          7400_Mode
                PLL Bypass Enable          Disable PLL          INT[1]_=1     PB_D[7]=0       BYPASS_EN=0
                                           Bypass
                                           Enable PLL           INT[1]_=0     PB_D[7]=1       BYPASS_EN=1
                (PWRUP_BYPASS_EN)          Bypass
               a. The information in the System Pin column is used when PowerSpan II is in Multiplexed System Pin mode
                  (see page 173)
               b. The information in the PB_D Pin column is used when PowerSpan II is in Configuration Slave mode
                  (page 175).
              The options PWRUP_PB_ARB_EN, PWRUP_P1_ARB_EN, and PWRUP_P2_ARB_EN are used to
              select between an external arbiter or a PowerSpan II arbiter for each interface.
              PWRUP_PRI_PCI designates either PCI-1 or PCI-2 as being connected to the Primary PCI Interface
              segment in the system (see “Primary PCI” on page 31 for more details on Primary PCI Interface
              functionality).
              When PWRUP_P1_R64_EN is enabled, the PowerSpan II PCI-1 interface drives P1_REQ64# during
              assertion of P1_RST# to signal the presence of a 32-bit or
              64-bit data path to all agents on the PCI-1 bus segment. This option must only be enabled when
              PowerSpan II is the Central Resource in the system.
              The option PWRUP_BOOT enables the system designer to control boot from PCI or from the
              processor bus. Whether this feature is enabled or disabled is dependent on system requirements (refer
              to “Arbitration” on page 137 for more information).
              By enabling option PWRUP_BYPASS_EN, all PLLs in the design are bypassed. Typically, this option
              must be disabled (PLL in use) in the system.
              In the Single PCI PowerSpan II, the following power-up options are not configurable:
              •    PWRUP_P2_ARB_EN
                    — no PCI-2 arbiter
PowerSpan II User Manual                                                                   Integrated Device Technology
80A1010_MA001_09                                                                                             www.idt.com


9. Resets, Clocks and Power-up Options                                                                             173
                •    PWRUP_PRI_PCI
                      — PCI-1 is always the Primary Interface
9.3.1           Multiplexed System Pin Mode
                PowerSpan II multiplexes a number of pins to provide either power-up options or other system
                application purposes (see Table 45). The multiplexed system pins mode is the default mode for
                PowerSpan II power-up options.
9.3.1.1         Signal Timing Requirements
                PWRUP_PB_ARB_EN, PWRUP_P1_ARB_EN, and PWRUP_P2_ARB_EN have multiple purposes:
                determines the PLL frequency range, and the PowerSpan II power-up option.
                During the low to high transition of PO_RST_, the following pins are latched by PowerSpan II in order
                to choose the following internal clock PLL frequency range:
                •    PB_FAST Signal
                      — High when the PB clock frequency is between 50 MHz and 100 MHz
                      — Low when the PB clock frequency is between 25 MHz and 50 MHz
                •    P1_M66EN Signal
                      — High when the PCI-1 clock frequency is 66 MHz
                      — Low when the PCI-1 clock frequency is 33 MHz
                •    P2_M66EN signal
                      — High when the PCI-2 clock frequency is 66 MHz
                      — Low when the PCI-2 clock frequency is 33 MHz
                There is a 10 ns minimum input setup time and 10 ns maximum input hold time requirement for
                latching these frequency range pins for determining the PLL range (see Table 97 on page 396 and
                Table 102 on page 402, parameters t110 and t111 for more AC Timing reset information).
                The arbiter enable and disable (PWR_PB_ARB_EN and PWRUP_P1_ARB_EN) power- up options
                are sampled continuously 10 ns the negation of PO_RST_ until the power-up option is updated by the
                Configuration Slave mode settings (this is only true in MPC8260 applications). The option is
                determined by the logic level of PB_FAST, P1_66EN, and P2_66EN signals through internal
                combination logic. This means the system can enable/disable arbiter(s) by controlling these frequency
                range pins’ logic level during normal system operation after the negation of PO_RST_ if the
                PB_RSTCONF signal is tied to 1 (it never goes low).
Integrated Device Technology                                                                 PowerSpan II User Manual
www.idt.com                                                                                       80A1010_MA001_09


174                                                                                 9. Resets, Clocks and Power-up Options
9.3.1.2       Signal Timing for the Remaining Power-up Options Using to INT[5:1]
              During the low to high transition of PO_RST_, the INT[5:1] pins are internally latched by
              PowerSpan II in order to choose the required power-up options (see Figure 22).
              There is a 10 ns minimum input setup time and 10 ns maximum input hold time requirement for
              latching INT[5:1] for the power-up options (see Table 97 on page 396 and Table 101 on page 401 for
              more AC Timing reset information).
                            The logic levels are typically provided by external transceiver or FPGA. when INT[5:1] are
                    p
                 Ti
                            also used for general purpose I/O pins.
              After the 10 ns hold time, the INT[5:1] signals are used as general purpose interrupt pins. Normal
              operation of these pins (as interrupt pins) requires external pull-ups. Default values for power-up
              options loaded by INT[5:1]_ are shown in Table 45.
              Figure 22: PowerSpan II Power-up Waveform
                  HEALTHY#
                   PO_RST_
              PB_HRESET_
             PB_RSTCONF_
                  PB_D[0:7]
                     INT[5:1]_
                 PB_FAST
                 Px_M66EN
                                         10ns
                                                                                        Configuration Slave Mode
                                              Muliplexed System Pin                     Power-up options selected and all previously
                                              Mode (Default)                            selected options are overwritten
                                              Power-up options latched off
                PLL frequency selected
                                              the interrupt pins selected   Muliplexed System Pin
                when PO_RST_ is
                                                                            Mode (Default)
                transitioned from
                                                                            Power-up options for arbiter selection
                low to high
                                                                            are latched continuously
PowerSpan II User Manual                                                                        Integrated Device Technology
80A1010_MA001_09                                                                                                      www.idt.com


9. Resets, Clocks and Power-up Options                                                                              175
9.3.2           Configuration Slave Mode
                When there is a 60x bus device with the capability to be a configuration master in a PowerSpan II
                system (for example the PowerQUICC II) the Configuration Slave mode overrides the default
                power-up option — the Multiplexed System Pins mode. The slave mode’s power-up options overwrite
                the multiplex system pin mode power-up options that were sampled at PO_RST_ (see Figure 22).
                When the PowerQUICC II is the configuration master, it asserts one of the A[0:6] signals when the
                HRESET_ signal is low. Refer to the MPC8260 (PowerQUICC II) User Manual for a detailed
                description of configuration master functionality.
                PowerSpan II acts as a configuration slave under the following conditions:
                •    PB_RSTCONF_ is connected to one of the configuration master’s A[0:6] lines
                •    PB_RST_ is connected to the configuration master HRESET_ signal
                •    PB_D is connected to the processor bus data line
                The configuration slave power-up options are configured by PB_D as defined in Table 45. PowerSpan
                II configuration slave mode timing is illustrated in Figure 23.
                Figure 23: PowerSpan II Configuration Slave Mode Timing
                PB_RST_
                PB_D[0:7]                                             Configuration Word
                PB_RSTCONF_
                                                                         Power-up Options Configured
                The configuration master updates all configuration slaves for each HRESET_ sequence. PowerSpan II
                updates its the same configuration word accordingly after each sequence.
9.3.3           Assertion of P1_REQ64#
                When PowerSpan II is used as the Central Resource in the system and controls both P1_REQ64# and
                P1_RST#, the PWRUP_P1_REQ64_EN bit must be set to 1 in the “Reset Control and Status Register”
                on page 324. However, PowerSpan II does not assert P1_REQ64# signal until its configuration word is
                latched. In order to meet this requirement, PowerSpan II must not be the last four configuration slaves
                (PowerQUICC II can support up to seven external configuration slaves). By meeting these
                requirements, PowerSpan II ensures that the timing parameters for a 64-bit data width are satisfied.
Integrated Device Technology                                                                 PowerSpan II User Manual
www.idt.com                                                                                        80A1010_MA001_09


176                      9. Resets, Clocks and Power-up Options
PowerSpan II User Manual            Integrated Device Technology
80A1010_MA001_09                                     www.idt.com


                                                                                                                       177
10.             Endian Mapping
                Big-endian refers to a method of formatting data where address 0 (or the smallest address referencing
                to the data) points to the most significant byte of the data.
                Little-endian refers to a method of formatting data where address 0 (or the smallest address referencing
                the data) points to the least significant byte of the data.
                Data in a system must be consistent; that is, the system must be entirely big-endian or little-endian.
                This chapter describes the endian mapping system used in PowerSpan II. The following topics are
                discussed:
                •    “Conventions” on page 177
                •    “Processor Bus and PowerSpan II Register Transfers” on page 179
                •    “Processor Bus and PCI Transfers” on page 183
10.1            Overview
                PowerSpan II supports a flexible endian conversion scheme for the following transactions involving
                the Processor Bus (PB) Interface:
                •    Access of PowerSpan II registers from the PB Interface
                •    Transfers between the processor bus and PCI — both externally initiated and PowerSpan II DMA
                     initiated
                            No endian conversion is performed for transactions mapped between the two PCI interfaces:
                            PCI-1 and PCI-2.
10.2            Conventions
                Table 46 illustrates the data bus lanes used to carry each byte of a multi-byte structure on PCI. PCI
                stores multi-byte structures with little-endian byte ordering.
                Table 46: PCI Byte Lane Definitions
                  Byte Address                                          PCI Byte Lanes
                  AD[2:0]           64-bit Transaction                  32-bit Transaction
                                    Lane Number       Pins              AD[2]             Lane Number     Pins
                  000               0                 P1_AD[7:0]        0                 0               Px_AD[7:0]
Integrated Device Technology                                                                    PowerSpan II User Manual
www.idt.com                                                                                          80A1010_MA001_09


178                                                                                                   10. Endian Mapping
              Table 46: PCI Byte Lane Definitions
                Byte Address                                        PCI Byte Lanes
                001              1                 P1_AD[15:8]       0                 1                  Px_AD[15:8]
                010              2                 P1_AD[23:16]      0                 2                  Px_AD[23:16]
                011              3                 P1_AD[31:24]      0                 3                  Px_AD[31:24]
                100              4                 P1_AD[39:32]      1                 0                  Px_AD[7:0]
                101              5                 P1_AD[47:40]      1                 1                  Px_AD[15:8]
                110              6                 P1_AD[55:48]      1                 2                  Px_AD[23:16]
                111              7                 P1_AD[63:56]      1                 3                  Px_AD[31:24]
              Table 47 illustrates the lanes used to carry each byte of a multi-byte structure on a 64-bit PB Interface
              data bus.
              Table 47: 64-bit PB Data Bus Byte Lane Definitions
                Byte Address     Processor Bus Byte Lanes
                                                                         PowerQUICC II        PowerPC 7xx
                PB_A[29:31]      Lane Number       PowerSpan II Pins     Pins                 Pins
                000              0                 PB_D[0:7]             D[0:7]               DH[0:7]
                001              1                 PB_D[8:15]            D[8:15]              DH[8:15]
                010              2                 PB_D[16:23]           D[16:23]             DH[16:23]
                011              3                 PB_D[24:31]           D[24:31]             DH[24:31]
                100              4                 PB_D[32:39]           D[32:39]             DL[0:7]
                101              5                 PB_D[40:47]           D[40:47]             DL[8:15]
                110              6                 PB_D[48:55]           D[48:55]             DL[16:23]
                111              7                 PB_D[56:63]           D[56:63]             DL[24:31]
              PowerSpan II supports both big-endian and PowerPC little-endian byte ordering. Endian selection with
              PowerPC is performed with the processor register MSR[LE] and defaults to big-endian. PowerPC
              little-endian mode allows a PowerPC and Pentium processor to share a data structure in memory.
PowerSpan II User Manual                                                                   Integrated Device Technology
80A1010_MA001_09                                                                                             www.idt.com


10. Endian Mapping                                                                                                    179
10.3            Processor Bus and PowerSpan II Register Transfers
                The PowerSpan II PB Slave supports register accesses from a PowerPC operating in big-endian or
                PowerPC little-endian mode. The endian conversion mode for processor access to PowerSpan II
                registers is selected by programming the END bit in the “Processor Bus Register Image Base Address
                Register” on page 295. The default mode is big-endian, which matches the default mode of the
                processor bus.
                PowerSpan II registers are little-endian structures. The endian conversion process provided by
                PowerSpan II for processor bus accesses to its registers is designed to preserve the significance of the
                programmer’s multi-byte structures or scalars. Endian conversion for access to PowerSpan II registers
                from the processor is data invariant.
                When the processor bus is operating in big-endian mode, the END bit must be set to big-endian mode.
                In this case, the PowerSpan II PB slave maps the processor bus byte lanes to PowerSpan II register
                addresses according to Table 48.
Integrated Device Technology                                                                  PowerSpan II User Manual
www.idt.com                                                                                         80A1010_MA001_09


180                                                                          10. Endian Mapping
Table 48: PowerSpan II Big-Endian PB Register Accesses
                                                               PowerSpan II Register Address
               Starting
               Address              PowerPC Byte Lanes                         A[1:0]
  Transfer       PB_A
    Size        [29:31]    0     1   2     3    4     5  6  7 A[2]     11    10      01    00
    Byte          000     D0                                   0      D0
                  001           D1                             0             D1
                  010                D2                        0                     D2
                  011                     D3                   0                           D3
                  100                          D4              1      D4
                  101                                D5        1             D5
                  110                                   D6     1                     D6
                  111                                      D7  1                           D7
 Two bytes        000     D0    D1                             0      D0     D1
                  001           D1   D2                        0             D1      D2
                  010                D2   D3                   0                     D2    D3
                  100                           D4   D5        1      D4     D5
                  101                                D5 D6     1             D5      D6
                  110                                   D6 D7  1                     D6    D7
     Tri-         000     D0    D1   D2                        0      D0     D1      D2
    byte
                  001           D1   D2   D3                   0             D1      D2    D3
                  100                          D4    D5 D6     1      D4     D5      D6
                  101                                D5 D6 D7  1             D5      D6    D7
    Word          000     D0    D1   D2   D3                   0      D0     D1      D2    D3
                  100                          D4    D5 D6 D7  1      D4     D5      D6    D7
PowerSpan II User Manual                                           Integrated Device Technology
80A1010_MA001_09                                                                    www.idt.com


10. Endian Mapping                                                                                                        181
                In PowerPC little-endian mode, the processor munges the address and places the scalar on the external
                byte lanes starting at this modified address. The scalar is still in big-endian order. This operation is only
                defined for starting addresses that are a multiple of the size of the scalar. In PowerPC literature, this is
                referred to as being naturally aligned.
                             Munging the address makes the address appear to the processor bus that individual aligned
                      p
                   Ti        scalars are stored as little-endian values when they are actually stored in big-endian order.
                             They are stored at different byte addresses with a double word.
                The munging performed by the processor is illustrated in Table 49.
                Table 49: Processor Bus Address Munging
                        Transfer Size            Address modification
                           4 bytes                   XOR with 0b100
                           2 bytes                    XOR with 0b110
                           1 byte                     XOR with 0b111
                When the processor bus is operating in PowerPC little-endian mode, END bit must be set to PowerPC
                little-endian mode. In this case, the PB Slave munges the processor bus address, and maps byte lanes to
                register addresses to preserve the significance of the scalar.
Integrated Device Technology                                                                       PowerSpan II User Manual
www.idt.com                                                                                              80A1010_MA001_09


182                                                                                              10. Endian Mapping
              The byte lane to register address mapping is shown in Table 50. Only munged cases are illustrated. The
              PB slave asserts PB_TEA_ in response to an unaligned access to a register if the END bit is set for
              PowerPC little-endian mode.
Table 50: PowerSpan II PowerPC Little-Endian PB Register Accesses
                Starting                                                         PowerSpan II Register Address
                Address
               (Munged)                   PowerPC Byte Lanes                                       A[1:0]
  Transfer        PB_A
    Size         [29:31]      0     1      2     3    4      5     6     7     A[2]     11      10      01      00
    Byte           000       D0                                                  1                              D0
                   001             D1                                            1                      D1
                   010                    D2                                     1              D2
                   011                          D3                               1      D3
                   100                               D4                          0                              D4
                   101                                      D5                   0                      D5
                   110                                            D6             0              D6
                   111                                                  D7       0      D7
  Two bytes        000       D0    D1                                            1                      D0      D1
                   010                    D2    D3                               1      D2      D3
                   100                               D4     D5                   0                      D4      D5
                   110                                            D6    D7       0      D6      D7
    Word           000       D0    D1     D2    D3                               1      D0      D1      D2      D3
                   100                               D4     D5    D6    D7       0      D4      D5      D6      D7
              A PCI transaction is generated by accessing the following registers:
              •    Processor Bus Configuration Cycle Data register (PB_CONF_DATA)
              •    Processor Bus to PCI-1 Interrupt Acknowledge Cycle Generation register (PB_P1_IACK)
              •    Processor Bus to PCI-2 Interrupt Acknowledge Cycle Generation register (PB_P2_IACK)
              The endian conversion scheme applied for processor bus access to these registers is controlled by the
              END bit, but the endian mapping scheme in this case is described in “Processor Bus and PCI
              Transfers” on page 183.
PowerSpan II User Manual                                                              Integrated Device Technology
80A1010_MA001_09                                                                                         www.idt.com


10. Endian Mapping                                                                                                     183
10.4            Processor Bus and PCI Transfers
                The following endian conversion modes are provided for transactions involving the processor bus and
                a PCI Interface:
                •    Big-endian (swap or address invariance)
                •    Little-endian (no swap or data invariance)
                •    PowerPC little-endian (no swap and address munge)
                •    True little-endian (swap or address invariance)
                The following PowerSpan II register bits are used to control the endian conversion for transactions
                involving the PB Interface and PCI:
                •    END [1:0] field in the “PCI-1 Target Image x Control Register” on page 268
                •    END [1:0] field in the “PCI I2O Target Image Control Register” on page 352
                •    END [1:0] field in the “Processor Bus Slave Image x Control Register” on page 287
                •    END [1:0] field in the “DMA x Transfer Control Register” on page 311
                The endian conversion mode of a DMA channel can be updated for each direct mode transaction or for
                each element in a linked-list.
                The following sections describe each of the endian conversion modes.
10.4.1          Big-endian Mode
                When operating in big-endian mode, PowerSpan II uses an address invariant scheme for mapping
                processor bus byte lanes. In this mode, all elements of a multi-byte structure or scalar appear at the
                same address in both PCI and processor bus spaces, but their relative significance is not preserved.
                If the processor bus is programmed to be big-endian, PowerSpan II big-endian mode must be used for
                processor bus/PCI transactions.
                PowerSpan II byte lane mappings for big-endian mode support are illustrated in Table 51. Byte lane
                number references are defined in Table 46 and Table 47.
Integrated Device Technology                                                                   PowerSpan II User Manual
www.idt.com                                                                                          80A1010_MA001_09


184                                                                            10. Endian Mapping
Table 51: PowerSpan II Big-endian Mode Byte Lane Mapping
                                PowerPC Byte Lanes                 PCI Byte Lanes
  Transfer     Start
    Size      Address     0  1   2    3    4    5   6   7  7  6  5     4     3      2    1     0
    Byte        000      D0                                                                   D0
                001         D1                                                          D1
                010             D2                                                 D2
                011                  D3                                     D3
                100                       D4                          D4
                101                            D5               D5
                110                                D6        D6
                111                                    D7 D7
 Two bytes      000      D0 D1                                                          D1    D0
                001         D1  D2                                                 D2   D1
                010             D2   D3                                     D3     D2
                100                       D4   D5               D5    D4
                101                            D5  D6        D6 D5
                110                                D6  D7 D7 D6
   Tri-byte     000      D0 D1  D2                                                 D2   D1    D0
                001         D1  D2   D3                                     D3     D2   D1
                100                       D4   D5  D6        D6 D5    D4
                101                            D5  D6  D7 D7 D6 D5
    Word        000      D0 D1  D2   D3                                     D3     D2   D1    D0
                100                       D4   D5  D6  D7 D7 D6 D5    D4
 Five bytes     000      D0 D1  D2   D3   D4                          D4    D3     D2   D1    D0
                011                  D3   D4   D5  D6  D7 D7 D6 D5    D4    D3
  Six bytes     000      D0 D1  D2   D3   D4   D5               D5    D4    D3     D2   D1    D0
                010             D2   D3   D4   D5  D6  D7 D7 D6 D5    D4    D3     D2
PowerSpan II User Manual                                            Integrated Device Technology
80A1010_MA001_09                                                                      www.idt.com


10. Endian Mapping                                                                                                    185
Table 51: PowerSpan II Big-endian Mode Byte Lane Mapping
                                       PowerPC Byte Lanes                                  PCI Byte Lanes
   Transfer      Start
     Size      Address       0     1    2     3      4     5      6    7     7    6      5     4     3    2     1     0
    Seven         000       D0    D1   D2    D3     D4    D5     D6              D6     D5    D4    D3   D2    D1    D0
     bytes
                  001             D1   D2    D3     D4    D5     D6   D7    D7   D6     D5    D4    D3   D2    D1
    Double        000       D0    D1   D2    D3     D4    D5     D6   D7    D7   D6     D5    D4    D3   D2    D1    D0
10.4.2          Little-endian Mode
                When operating in little-endian mode, PowerSpan II uses a data invariant scheme for mapping
                PowerPC byte lanes. Data invariance preserves the relative byte significance of a structure in both PCI
                and PowerPC spaces, but translates the byte addressing.
                In order to access PCI device registers from the processor bus in little-endian mode, there are certain
                addressing rules which must be followed. In PowerSpan II when little-endian mode is selected, no
                address swapping takes place (refer to Table 52 on page 186). This means that the MSB on the
                processor bus goes to the MSB on PCI. However, the MSB on processor bus is the low address and
                MSB on PCI is the high address.
10.4.2.1        4 Byte Transactions
                When performing 4 byte transactions to the PCI bus in little-endian mode the intended address must
                XOR the address with 0x4. This creates the address for PCI which is used in the transaction.
                In little-endian mode for 4 byte transfers, the following changes must be made:
                •    Change a register on PCI at offset 0x0 using address 0x4
                •    Change a register on PCI at offset 0x4 using address 0x0
                •    Change a register on PCI at offset 0x8 using address 0xC
                •    Change a register on PCI at offset 0xC using address 0x8
                These rules enable the transactions to reach the intended targets without manual code changes.
                PowerSpan II byte lane mappings for little-endian mode support are illustrated in Table 52 on
                page 186.
Integrated Device Technology                                                                    PowerSpan II User Manual
www.idt.com                                                                                          80A1010_MA001_09


186                                                                              10. Endian Mapping
Table 52: PowerSpan II Little-endian Mode Byte Lane Mapping
                                 PowerPC Byte Lanes                  PCI Byte Lanes
  Transfer     Start
    Size      Address     0   1    2   3    4    5   6   7   7  6  5     4     3      2    1     0
    Byte        000      D0                                 D0
                001          D1                                D1
                010               D2                              D2
                011                   D3                                D3
                100                        D4                                 D4
                101                             D5                                   D5
                110                                 D6                                    D6
                111                                     D7                                      D7
 Two bytes      000      D0  D1                             D0 D1
                001          D1   D2                           D1 D2
                010               D2  D3                          D2    D3
                100                        D4   D5                            D4     D5
                101                             D5  D6                               D5   D6
                110                                 D6  D7                                D6    D7
   Tri-byte     000      D0  D1   D2                        D0 D1 D2
                001          D1   D2  D3                       D1 D2    D3
                100                        D4   D5  D6                        D4     D5   D6
                101                             D5  D6  D7                           D5   D6    D7
    Word        000      D0  D1   D2  D3                    D0 D1 D2    D3
                100                        D4   D5  D6  D7                    D4     D5   D6    D7
 Five bytes     000      D0  D1   D2  D3   D4               D0 D1 D2    D3    D4
                011                   D3   D4   D5  D6  D7              D3    D4     D5   D6    D7
  Six bytes     000      D0  D1   D2  D3   D4   D5          D0 D1 D2    D3    D4     D5
                010               D2  D3   D4   D5  D6  D7        D2    D3    D4     D5   D6    D7
PowerSpan II User Manual                                              Integrated Device Technology
80A1010_MA001_09                                                                        www.idt.com


10. Endian Mapping                                                                                                   187
Table 52: PowerSpan II Little-endian Mode Byte Lane Mapping
                                       PowerPC Byte Lanes                                 PCI Byte Lanes
   Transfer      Start
     Size      Address       0    1     2    3     4    5     6      7     7     6      5     4     3    2     1     0
    Seven         000       D0   D1    D2   D3    D4   D5    D6           D0    D1    D2     D3    D4   D5    D6
     bytes
                  001            D1    D2   D3    D4   D5    D6     D7          D1    D2     D3    D4   D5    D6    D7
    Double        000       D0   D1    D2   D3    D4   D5    D6     D7    D0    D1    D2     D3    D4   D5    D6    D7
10.4.3          PowerPC Little-endian Mode
                In PowerPC little-endian mode, the PB Master swaps byte lanes according to Table 52 and munges
                outgoing addresses PB_A[29:31] according to Table 49. Address munging does not occur for burst and
                extended cycles.
                In PowerPC little-endian mode, the PB Master is restricted to transferring naturally aligned quantities.
                External PCI masters or the PowerSpan II’s DMA channels can request transactions that are not
                naturally aligned. The PB Master breaks up these requests into single byte transactions on the
                processor bus, with a performance penalty.
                The PB Slave asserts PB_TEA_ in response to a transaction that is not naturally aligned. These cases
                are as follows:
                •   PB_TSIZ = 3, 5, 6, 7 bytes
                •   PB_TSIZ = 2 bytes and PB_A[31] = 1
                For DMA transactions between the processor (60x) bus and the PCI-1 bus, the END bit in the “DMA x
                Transfer Control Register” on page 311 must be set to 11. For all other PowerPC little-endian transfers,
                the END bit must be set to 01.
Integrated Device Technology                                                                   PowerSpan II User Manual
www.idt.com                                                                                         80A1010_MA001_09


188                                                                                                  10. Endian Mapping
10.4.4        True Little-endian Mode
              When operating in true little-endian mode, PowerSpan II uses a data invariant scheme for mapping
              PowerPC byte lanes. Data invariance preserves the relative byte significance of a structure in both PCI
              and PowerPC spaces, but translates the byte addressing.
              In order to access PCI device registers from the processor bus in true little-endian mode, there are
              certain addressing rules which must be followed. In PowerSpan II when true little-endian mode is
              selected, no address swapping takes place (refer to Table 53). This means that the MSB on the
              processor bus goes to the MSB on PCI. However, the MSB on processor bus is the low address and
              MSB on PCI is the high address.
              True little-endian mode cannot be used with the 4 byte read implementation in the PowerSpan II
              design. The MEM_IO bit must be set to 0 when the END field is set to 11. Refer to “Reads” on page 41
              and “Reads” on page 95 for a detailed explanation of the 4 byte read through the PCI Interfaces and PB
              Interface.
                         The 4 byte read implementation can be used with the other types of endian conversion.
PowerSpan II User Manual                                                                   Integrated Device Technology
80A1010_MA001_09                                                                                            www.idt.com


10. Endian Mapping                                                                             189
Table 53: PowerSpan II True Little-Endian Byte Lane Mappings
                  Starting                                           PowerSpan II PCI Address
                  Address
                 (Munged)            PowerPC Byte Lanes                            A[1:0]
    Transfer        PB_A
      Size         [29:31]    0  1    2    3     4    5   6   7 A[2]     11      10     01    00
      Byte           000     D0                                  0       D0
                     001        D1                               0               D1
                     010             D2                          0                      D2
                     011                  D3                     0                            D3
                     100                        D4               1       D4
                     101                             D5          1               D5
                     110                                 D6      1                      D6
                     111                                     D7  1                            D7
   Two bytes         000     D0 D1                               0       D0      D1
                     010             D2   D3                     0                      D2    D3
                     100                        D4   D5          1       D4      D5
                     110                                 D6  D7  1                      D6    D7
    Tri bytes        000     D0 D1   D2                          0       D0      D1     D2
                     001        D1   D2   D3                     0               D1     D2    D3
                     100                        D4   D5  D6      1       D4      D5     D6
                     101                             D5  D6  D7  1               D5     D6    D7
      Word           000     D0 D1   D2   D3                     0       D0      D1     D2    D3
                     100                        D4   D5  D6  D7  1       D4      D5     D6    D7
   Five Bytes        000     D0 D1   D2   D3    D4               0       D0     D1      D2    D3
                                                                 1       D4
                     011                  D3    D4   D5  D6  D7  0                            D3
                                                                 1       D4      D5     D6    D7
Integrated Device Technology                                               PowerSpan II User Manual
www.idt.com                                                                     80A1010_MA001_09


190                                                                               10. Endian Mapping
Table 53: PowerSpan II True Little-Endian Byte Lane Mappings
                Starting                                             PowerSpan II PCI Address
                Address
               (Munged)              PowerPC Byte Lanes                            A[1:0]
  Transfer        PB_A
     Size        [29:31]   0     1    2    3     4    5   6   7 A[2]      11     10     01      00
  Six Bytes        000    D0    D1   D2   D3    D4   D5          0        D0     D1     D2      D3
                                                                 1        D4     D5
                   010               D2   D3    D4   D5  D6  D7  0                      D2      D3
                                                                 1        D4     D5     D6      D7
 Seven Bytes       000    D0    D1   D2   D3    D4   D5  D6      0        D0     D1     D2      D3
                                                                 1        D4     D5     D6
                   001          D1   D2   D3    D4   D5  D6  D7  0               D1     D2      D3
                                                                 1        D4     D5     D6      D7
    Double         000    D0    D1   D2   D3    D4   D5  D6  D7  0        D0     D1     D2      D3
                                                                 1        D4     D5     D6      D7
PowerSpan II User Manual                                                Integrated Device Technology
80A1010_MA001_09                                                                         www.idt.com


                                                                                                                          191
11.                Signals and Pinout
                   This chapter describes the Processor Bus (PB) Interface, Single PCI PowerSpan II and Dual PCI
                   PowerSpan II signals. Signals the differ between the Single PCI PowerSpan II and Dual PCI
                   PowerSpan II are identified in the signal tables. The following topics are discussed:
                   •    “Signal Description” on page 191
11.1               Signal Description
                   This section organizes the PowerSpan II signals along the following functional groups:
                   •    Processor Bus
                   •    PCI-1
                   •    PCI-2
                   •    Miscellaneous
                   •    Test
                   The Dual PCI PowerSpan II contains all five of these signal groupings.
                   The Single PCI PowerSpan II device does not implement the PCI-2 signal group.
11.1.1             Signal Types
                   Signals are classified according to the types defined in Table 54.
Table 54: Signal Type Definitions
 Signal type                                 Signal type definition
 Input                                       Standard input only signal.
 Output                                      Standard output only signal.
 Tristate output                             Standard tristate output only signal.
 Open drain                                  Open drain output that allows multiple devices to share as a wire-OR
 Tristate bidirectional                      Tristate input/output signal.
 Bidirectional open drain                    Open drain input/output which allows multiple devices to share as a wire or
                                             when it is used as output.
                             All arbitration signals — REQ# and GNT# — must be weakly pulled-up when using the
                             PowerSpan II’s arbiters. This is true for all of PowerSpan II’s arbiters: Processor Bus, PCI-1
                             and PCI-2.
Integrated Device Technology                                                                          PowerSpan II User Manual
www.idt.com                                                                                                 80A1010_MA001_09


192                                                                                               11. Signals and Pinout
11.1.2        Processor Bus Signals
              This section describes PowerSpan II PB Interface signals used to interface to the 60x bus processors.
              Signals in this group are 3.3V LVTTL compatible. The signals are not 5V tolerant.
              Table 55 summarizes the signals in this grouping. Signals with electrical characteristics different from
              the remainder of the group are placed at the end of the table.
Table 55: Processor Bus Signals
                                                                Recommended
 Pin Name            Pin Type               Reset State         Termination           Description
 PB_AACK_            Tristate bidirectional Hi-Z                Pull-up resistor     Address Acknowledge: A
                                                                                     processor bus slave asserts this
                                                                                     signal to indicate that it identified
                                                                                     the address tenure. Assertion of
                                                                                     this signal terminates the address
                                                                                     tenure.
 PB_ABB_             Tristate output        Hi-Z                Pull-up resistor     Address Bus Busy: Indicates
                                                                                     ownership of the processor
                                                                                     address bus.
 PB_AP[0:3]          Tristate bidirectional Hi-Z                Pull-up resistor     Address Parity: The processor
                                                                                     address bus master drives this
                                                                                     signal to indicate the parity of the
                                                                                     address bus.
 PB_ARTRY_           Tristate bidirectional Hi-Z                Pull-up resistor     Address Retry: Assertion of this
                                                                                     signal indicates that the bus
                                                                                     transaction must be retried by the
                                                                                     processor bus master.
 PB_A[0:31]          Tristate bidirectional Hi-Z                No requirementa      Address Bus: Address for the
                                                                                     current bus cycle. It is driven by
                                                                                     PowerSpan II when it is the 603
                                                                                     bus master. At all other times it is
                                                                                     an input to PowerSpan II.
 PB_BG[1]_           Tristate bidirectional Hi-Z                Pull-up resistor     Address Bus Grant: This is an
                                                                                     input when an external arbiter is
                                                                                     used and an output when the
                                                                                     internal arbiter is used. As input it
                                                                                     is used by an external arbiter to
                                                                                     grant the processor address bus
                                                                                     to PowerSpan II. As output it is
                                                                                     used by the internal arbiter to
                                                                                     grant the processor address bus
                                                                                     to an external bus master. This
                                                                                     pin must be weakly pulled high.
 PB_BG[2:3]_         Tristate output        Hi-Z                Pull-up resistor     Address Bus Grant: It is used by
                                                                                     the internal arbiter to grant the
                                                                                     processor address bus to the
                                                                                     external bus masters. These pins
                                                                                     must be weakly pulled high.
PowerSpan II User Manual                                                                 Integrated Device Technology
80A1010_MA001_09                                                                                             www.idt.com


11. Signals and Pinout                                                                                      193
Table 55: Processor Bus Signals
                                                          Recommended
 Pin Name              Pin Type               Reset State Termination       Description
 PB_BR[1]_             Tristate bidirectional Hi-Z        Pull-up resistor Address Bus Request: This is
                                                                           an output when an external
                                                                           arbiter is used and an input when
                                                                           an internal arbiter is used. As
                                                                           output it indicates that
                                                                           PowerSpan II requests the
                                                                           ownership of the processor
                                                                           address bus. As input an external
                                                                           master should assert this signal
                                                                           to request the ownership of the
                                                                           processor address bus from
                                                                           PowerSpan II’s internal arbiter.
                                                                           This pin must be weakly pulled
                                                                           high.
 PB_BR[2:3]_           Input                  Hi-Z        Pull-up resistor Address Bus Request: These
                                                                           are inputs only. They are used by
                                                                           external masters to request the
                                                                           processor address bus from the
                                                                           internal arbiter. These pins must
                                                                           be weakly pulled high.
 PB_CI_                Tristate output        Hi-Z        Pull-up resistor Cache Inhibit: It is used for L2
                                                                           cache control. It indicates
                                                                           whether the transaction should be
                                                                           cached or not.
 PB_CLK                Input                  -           -                Processor Bus Clock: All
                                                                           devices intended to interface with
                                                                           the bus processor side of the
                                                                           PowerSpan II must be
                                                                           synchronized to this clock. The
                                                                           PB_CLK can operate up to 100
                                                                           MHz.
 PB_DBB_               Tristate output        Hi-Z        Pull-up resistor Data Bus Busy: Indicates the
                                                                           ownership of the data bus. The
                                                                           master who owns the processor
                                                                           data bus asserts this signal.
Integrated Device Technology                                                      PowerSpan II User Manual
www.idt.com                                                                              80A1010_MA001_09


194                                                                                  11. Signals and Pinout
Table 55: Processor Bus Signals
                                                       Recommended
 Pin Name           Pin Type               Reset State Termination       Description
 PB_DBG[1]_         Tristate bidirectional Hi-Z        Pull-up resistor Data Bus Grant: This is an input
                                                                        when an external arbiter is used
                                                                        and an output when the internal
                                                                        arbiter is used. As input it is used
                                                                        by an external arbiter to grant the
                                                                        processor data bus to PowerSpan
                                                                        II. As output it is used by the
                                                                        internal arbiter to grant the
                                                                        processor data bus to an external
                                                                        bus master. This pin must be
                                                                        weakly pulled high.
 PB_DBG[2:3]_       Tristate output        Hi-Z        Pull-up resistor Data Bus Grant: This is an
                                                                        output only. It is used by the
                                                                        internal arbiter to grant the
                                                                        processor data bus to external
                                                                        bus masters. These pins must be
                                                                        weakly pulled high.
 PB_DP[0:7]         Tristate bidirectional Hi-Z        No requirementa  Data Parity: The processor data
                                                                        bus slave drives on reads, master
                                                                        drives on write to indicate the
                                                                        parity of the data bus.
 PB_DVAL_           Tristate bidirectional Hi-Z        Pull-up resistor Data Valid: Indicates if the data
                                                                        beat is valid on PB_D[0:63].
 PB_D[0:63]         Tristate bidirectional Hi-Z        No requirementa  Data Bus
 PB_FAST            Input                  -           Power-up option  PLL Configuration: If the signal
                                                                        is pulled low, it configures the PB
                                                                        Interface PLL to operate with
                                                                        input frequencies between 25 and
                                                                        50 MHz. If the signal is pulled
                                                                        high, it configures the PB
                                                                        Interface PLL to operate with
                                                                        input frequencies above 50 MHz
                                                                        to a maximum of 100 MHz.
 PB_GBL_            Tristate output        Hi-Z        Pull-up resistor Global: Indicates that the transfer
                                                                        is coherent and it should be
                                                                        snooped by bus masters.
 PB_RSTCONF_        Input                  -           -                Reset Configuration: Asserted
                    (Schmitt trigger)                                   by PowerQUICC II master to
                                                                        indicate to PowerSpan II to load
                                                                        power-up options. This pin must
                                                                        be pulled high if the multiplexed
                                                                        system pin mechanism is used to
                                                                        load the power-up options.
PowerSpan II User Manual                                                     Integrated Device Technology
80A1010_MA001_09                                                                                www.idt.com


11. Signals and Pinout                                                                                                    195
Table 55: Processor Bus Signals
                                                                   Recommended
 Pin Name              Pin Type               Reset State          Termination         Description
 PB_RST_               Bidirectional open     Low                  Pull-up resistor   Reset: Asynchronous active low
                       drain                  (if PB_RST_DIR=1,                       reset.
                       (Schmitt trigger)      otherwise the signal
                                              is an input)
 PB_RST_DIR            Input                  -                    Power-up option    Processor Bus Reset Direction
 PB_TA_                Tristate bidirectional Hi-Z                 Pull-up resistor   Transfer Acknowledge:
                                                                                      Indicates that a data beat is valid
                                                                                      on the data bus. For single beat
                                                                                      transfers, it indicates the
                                                                                      termination of the transfer. For
                                                                                      burst transfers, it will be asserted
                                                                                      four times to indicate the transfer
                                                                                      of four data beats with the last
                                                                                      assertion indicating the
                                                                                      termination of the burst transfer.
 PB_TBST_              Tristate bidirectional Hi-Z                 Pull-up resistor   Transfer Burst: The bus master
                                                                                      asserts this pin to indicate that
                                                                                      the current transaction is a burst
                                                                                      transaction
 PB_TEA_               Tristate bidirectional Hi-Z                 Pull-up resistor   Transfer Error Acknowledge:
                                                                                      Indicates a bus error.
 PB_TSIZ[0:3]          Tristate bidirectional Hi-Z                 Pull-down resistor Transfer Size: Indicates the
                                                                   on TSIZ[0]b        number of bytes to be transferred
                                                                                      during a bus cycle.
 PB_TS_                Tristate bidirectional Hi-Z                 Pull-up resistor   Transfer Start: Indicates the
                                                                                      beginning of a new address bus
                                                                                      tenure.
 PB_TT[0:4]            Tristate bidirectional Hi-Z                 No requirementa    Transfer Type: The bus master
                                                                                      drives these pins to specify the
                                                                                      type of the transaction.
 PB_VDDA               Supply                 -                    -                  PB Analog VDD: Voltage supply
                                                                                      pin to the analog circuits in the PB
                                                                                      Phase Locked Loop (nominally
                                                                                      2.5V).
 PB_DVDD               Supply                 -                    -                  PB Digital VDD: Voltage supply
                                                                                      pin to the digital circuits in the PB
                                                                                      Phase Locked Loop (nominally
                                                                                      2.5V).
Integrated Device Technology                                                                  PowerSpan II User Manual
www.idt.com                                                                                          80A1010_MA001_09


196                                                                                                              11. Signals and Pinout
Table 55: Processor Bus Signals
                                                                           Recommended
 Pin Name                Pin Type                Reset State               Termination               Description
 PB_DVSS                 Ground                  -                         -                        PB Digital VSS: Ground pin to
                                                                                                    the digital circuits in the PB Phase
                                                                                                    Locked Loop.
 PB_AVSS                 Ground                  -                         -                        PB Analog VSS: Ground pin to
                                                                                                    the digital circuits in the PB Phase
                                                                                                    Locked Loop.
a. Pull-up resistors are not required on the processor bus address (PB_A[0:31]) and data (PB_D[0:63]) signals to guarantee
    functional operation of the PowerSpan II. However, adding resistors to the address and data signals minimizes the current
    drawn by the PowerSpan II's tristated buffers when the bus is in an idle condition. The system designer must decide whether
    to add these resistors to the address and data bus.
b. A pull-up resistor must be added to the signal if all the external masters in the system support extended cycles. If any external
    master in the system does not support extended cycles, PowerSpan II’s TSIZ[0] signal must be disconnected and a pull-down
    resistor must be used on the signal. Refer to B. “Typical Applications” on page 421 for a description and illustration of this type
    of system.
11.1.3           PCI-1 Signals
                 This section describes PowerSpan II signals used to interface to PCI-1. Signals in this group are
                 compatible with both 3V and 5V signaling environments — as defined by the PCI 2.2 Specification.
                 Table 56 summarizes the signals in this grouping. Signals with electrical characteristics different from
                 the remainder of the group are placed at the end of the table.
Table 56: PCI-1 Signalsa
 Pin Name             Pin Type                   Description
 P1_AD [63:0]         Tristate bidirectional     PCI-1 Address/Data Bus: Address and data are multiplexed over these pins
                                                 providing a 64-bit address/data bus. b
 P1_ACK64#            Tristate bidirectional     PCI-1 Acknowledge 64-bit Transaction: Active low signal asserted by a target
                                                 to indicate its willingness to participate in a 64-bit transaction. Driven by the
                                                 target; sampled by the master. Rescinded by the target at the end of the
                                                 transaction.
 P1_CBE[7:0]#         Tristate bidirectional     PCI-1 Bus Command and Byte Enable Lines: Command and byte enable
                                                 information is multiplexed over all eight CBE lines.
 P1_DEVSEL#           Tristate bidirectional     PCI-1 Device Select: An active low indication from an agent that is the target of
                                                 the current transaction. Driven by the target; sampled by the master. Rescinded
                                                 by the target at the end of the transaction.
PowerSpan II User Manual                                                                                Integrated Device Technology
80A1010_MA001_09                                                                                                              www.idt.com


11. Signals and Pinout                                                                                                       197
Table 56: PCI-1 Signalsa
 Pin Name           Pin Type               Description
 P1_FRAME#          Tristate bidirectional PCI-1 Cycle Frame for PCI Bus: An active low indication from the current bus
                                           master of the beginning and end of a transaction. Driven by the bus master;
                                           sampled by the selected target. Rescinded by the bus master at the end of the
                                           transaction.
 P1_GNT[1]#         Tristate bidirectional PCI-1 Grant: This is an input when an external arbiter is used and an output
                                           when the internal arbiter is used. As input it is used by the external arbiter to
                                           grant the bus to PowerSpan II. As output it is used by the internal arbiter to grant
                                           the bus to an external master. This pin must be weakly pulled high.
 P1_GNT             Tristate output        PCI-1 Grant: These are outputs only. They are used by the PCI-1 internal arbiter
 [4:2]#                                    to grant the bus to external masters.
 PCI_GNT            Tristate output        PCI-1 Grant: These outputs may be driven by the PCI-1 or PCI-2 internal arbiter
 [7:5]#                                    to grant the bus to external masters. They are assigned to PCI-1 or PCI-2 by
                                           software. These pins should be weakly pulled high in a system.
 P1_IDSEL           Input                  PCI-1 Initialization Device Select: Used as a chip select during Configuration
                                           read and write transactions.
 P1_INTA#           Bidirectional open     PCI-1 Interrupt A: An active low level sensitive indication of an interrupt.
                    drain                  Asynchronous to P1_CLK.
 P1_IRDY#           Tristate bidirectional PCI-1 Initiator Ready: An active low indication of the current bus master’s ability
                                           to complete the current dataphase. Driven by the master; sampled by the
                                           selected target.
 P1_PAR             Tristate bidirectional PCI-1 Parity: Carries even parity across P1_AD[31:0] and P1_C/BE[3:0]. Driven
                                           by the master for the address and write dataphases. Driven by the target for read
                                           dataphases.
 P1_PAR64           Tristate bidirectional PCI-1 Parity Upper Dword: Carries even parity across P1_AD[63:32] and
                                           P1_CBE[7:4]. Driven by the master for address and write dataphases. Driven by
                                           the target for read dataphases.
 P1_CLK             Input                  PCI-1 Clock: Clock input for the PCI-1 Interface: P1_CLK operates between
                                           25 and 66MHz.
 P1_M66EN           Input                  PCI-1 66 MHz Enable: When pulled low, configures the PCI-1 PLL for operation
                                           between 25 and 33 MHz. When pulled high, configures the PCI-1 Interface PLL
                                           for operation above 33 MHz to a maximum of 66 MHz.
 P1_PERR#           Tristate bidirectional PCI-1 Parity Error: An active low indication of a data parity error. Driven by the
                                           target receiving data. Rescinded by that agent at the end of the transaction.
 P1_REQ[1]#         Tristate bidirectional PCI-1 Bus Request: This is an output when an external arbiter is used and an
                                           input when the PCI-1 internal arbiter is used. As input it is used by an external
                                           master to request the bus. As output it is used by PowerSpan II to request the
                                           bus. This pin must be weakly pulled high.
 P1_REQ[4:2]#       Input                  PCI-1 Bus Request: These are inputs only. They can be used by external
                                           masters to request the bus through the PCI-1 arbiter. These pins should be
                                           weakly pulled high in a system.
Integrated Device Technology                                                                       PowerSpan II User Manual
www.idt.com                                                                                               80A1010_MA001_09


198                                                                                                         11. Signals and Pinout
Table 56: PCI-1 Signalsa
 Pin Name            Pin Type                  Description
 PCI_REQ             Input                     PCI-1 Bus Request: These inputs are used by external masters to request the
 [7:5]#                                        bus from the PCI-1 or PCI-2 arbiter. They are assigned to PCI-1 or PCI-2 by
                                               software. These pins must be weakly pulled high in a system.
 P1_REQ64#           Tristate bidirectional    PCI-1 Request 64-bit Transfer: An active low indication from the current master
                                               of its choice to perform 64-bit transactions. Rescinded by the bus master at the
                                               end of the transaction.
 P1_RST#             Tristate bidirectional    PCI-1 Reset: Asynchronous active low reset for PCI-1 Interface
 P1_SERR#            Open drain                PCI-1 System Error: An active low indication of address parity error.
 P1_STOP#            Tristate bidirectional    PCI-1 Stop: An active low indication from the target of its desire to stop the
                                               current transition. Sampled by the master. Rescinded by the target at the end of
                                               the transaction.
 P1_TRDY#            Tristate bidirectional    PCI-1 Target Ready: An active low indication of the current target’s ability to
                                               complete the dataphase. Driven by the target; sampled by the current bus
                                               master. Rescinded by the target at the end of the transaction.
 P1_64EN#            Input                     PCI-1 64-bit Enable: An active low indication that a CompactPCI Hot Swap
                                               board is in a 64-bit slot. This signal must be pulled high in a non-Hot Swap
                                               environment.
 P1_RST_DIR          Input                     PCI-1 Bus Reset Direction
                     (LVTTL)
 P1_VDDA             Supply                    PCI-1 Analog VDD: Voltage supply pin to the analog circuits in the PCI-1 Phase
                                               Locked Loop (nominally 2.5V).
 P1_DVDD             Supply                    PCI-1 Digital VDD: Voltage supply pin to the digital circuits in the PCI-1 Phase
                                               Locked Loop (nominally 2.5V).
 P1_DVSS             Ground                    PCI-1 Digital VSS: Ground pin to the digital circuits in the PCI-1 Phase Locked
                                               Loop.
 P1_AVSS             Ground                    PCI-1 Analog VSS: Ground pin to the digital circuits in the PCI-1 Phase Locked
                                               Loop.
a. Refer to the PCI Local Bus Specification for reset states and recommended terminations of these PCI signals.
b. To use the PowerSpan II Dual PCI in a 32-bit environment, add a pull-up resistor to P1_AD[32:63].
PowerSpan II User Manual                                                                            Integrated Device Technology
80A1010_MA001_09                                                                                                      www.idt.com


11. Signals and Pinout                                                                                                            199
11.1.4          PCI-2 Signals
                This section describes PowerSpan II signals used to interface to PCI-2. Signals in this group are
                compatible with both 3V and 5V signaling environments — as defined by the PCI 2.2 Specification.
                              These signals are not implemented in the Single PCI PowerSpan II.
                     p
                  Ti
                Table 57 below summarizes the signals in this grouping. Signals with electrical characteristics different
                from the remainder of the group are placed at the end of the table.
Table 57: PCI-2 Signalsa
 Pin Name              Pin Type                 Description
 P2_AD[31:0]           Tristate bidirectional   PCI-2 Address/Data Bus: Address and data are multiplexed over these pins
                                                providing a 32-bit address/data bus.
 P2_CBE[3:0]#          Tristate bidirectional   PCI-2 Bus Command and Byte Enable Lines: Command and byte enable
                                                information is multiplexed over all four CBE lines.
 P2_DEVSEL#            Tristate bidirectional   PCI-2 Device Select: An active low indication from an agent that is the target of
                                                the current transaction. Driven by the target; sampled by the master. Rescinded
                                                by the target at the end of the transaction.
 P2_FRAME#             Tristate bidirectional   PCI-2 Cycle Frame for PCI Bus: An active low indication from the current bus
                                                master of the beginning and end of a transaction. Driven by the bus master,
                                                sampled by the selected target. Rescinded by the bus master at the end of the
                                                transaction.
 P2_GNT[1]#            Tristate bidirectional   PCI-2 Grant: This is an input when an external arbiter is used and an output
                                                when the PCI-2 internal arbiter is used. As input it is used by the external arbiter
                                                to grant the bus to PowerSpan II. As output it is used by the PCI-2 internal arbiter
                                                to grant the bus to an external master.
                                                This pin must be weakly pulled high in a system.
 P2_GNT [4:2]#         Tristate output          PCI-2 Grant: These are outputs only. They are used by the PCI-2 internal arbiter
                                                to grant the bus to external masters.
                                                These pins must be weakly pulled high in a system.
 P2_IDSEL              Input                    PCI-2 Initialization Device Select: Used as a chip select during Configuration
                                                read and write transactions
 P2_INTA#              Bidirectional open       PCI -2 Interrupt A: An active low level sensitive indication of an interrupt.
                       drain                    Asynchronous to P2_CLK
 P2_IRDY#              Tristate bidirectional   PCI-2 Initiator Ready: An active low indication of the current bus master’s ability
                                                to complete the current dataphase. Driven by the master; sampled by the
                                                selected target.
 P2_PAR                Tristate bidirectional   PCI-2 Parity: Carries even parity across P2_AD[31:0] and P2_C/BE[3:0]. Driven
                                                by the master for the address and write dataphases. Driven by the target for read
                                                dataphases.
Integrated Device Technology                                                                             PowerSpan II User Manual
www.idt.com                                                                                                   80A1010_MA001_09


200                                                                                                        11. Signals and Pinout
Table 57: PCI-2 Signalsa
 Pin Name            Pin Type                  Description
 P2_CLK              Input                     PCI-2 Clock: Clock input for the PCI-2 Interface. P2_CLK operates between 25
                                               and 66MHz.
 P2_M66EN            Input                     PCI-2 66 MHz Enable: When pulled low, configures the PCI-2 PLL for operation
                                               between 25 and 33 MHz. When pulled high, configures the PCI-2 Interface PLL
                                               for operation above 33 MHz to a maximum of 66 MHz.
 P2_PERR#            Tristate bidirectional    PCI-2 Parity Error: An active low indication of a data parity error. Driven by the
                                               target receiving data. Rescinded by that agent at the end of the transaction.
 P2_REQ[1]           Tristate bidirectional    PCI-2 Bus Request: This is an output when an external arbiter is used and an
                                               input when the PCI-2 Interface internal arbiter is used. As input it is used by an
                                               external master to request the bus. As output it is used by PowerSpan II to
                                               request the bus.
                                               This pin must be weakly pulled high.
 P2_REQ[4:2]         Input                     PCI-2 Bus Request: These are inputs only. They can be used by external
                                               masters to request the bus from the PCI-2 arbiter.
                                               These pins must be weakly pulled high in a system.
 P2_RST#             Tristate bidirectional    PCI-2 Reset: Asynchronous active low reset for PCI-2 Interface.
 P2_SERR#            Open drain                PCI-2 System Error: An active low indication of address parity error.
 P2_STOP#            Tristate bidirectional    PCI-2 Stop: An active low indication from the target of its desire to stop the
                                               current transition. Sampled by the master. Rescinded by the target at the end of
                                               the transaction.
 P2_TRDY#            Tristate bidirectional    PCI-2 Target Ready: An active low indication of the current target’s ability to
                                               complete the dataphase. Driven by the target; sampled by the current bus
                                               master. Rescinded by the target at the end of the transaction.
 P2_RST_DIR          Input                     PCI-2 Bus Reset Direction
                     (LVTTL)
 P2_VDDA             Supply                    PCI-2 Analog VDD: Voltage supply pin to the analog circuits in the PCI-2 Phase
                                               Locked Loop (nominally 2.5V).
 P2_DVDD             Supply                    PCI-2 Digital VDD: Voltage supply pin to the digital circuits in the PCI-1 Phase
                                               Locked Loop (nominally 2.5V).
 P2_DVSS             Ground                    PCI-2 Digital VSS: Ground pin to the digital circuits in the PCI-1 Phase Locked
                                               Loop.
 P2_AVSS             Ground                    PCI-2 Analog VSS: Ground pin to the digital circuits in the PCI-1 Phase Locked
                                               Loop.
a. Refer to the PCI Local Bus Specification for reset states and recommended terminations of these PCI signals.
PowerSpan II User Manual                                                                           Integrated Device Technology
80A1010_MA001_09                                                                                                       www.idt.com


11. Signals and Pinout                                                                                                     201
11.1.5          Miscellaneous Signals
                Table 58 below lists PowerSpan II signals which are not necessarily dedicated to the PB, PCI-1 or
                PCI-2 Interfaces. They have a variety of electrical capabilities.
Table 58: Miscellaneous Signals
                                                                Recommended
 Pin Name          Pin Type             Reset State             Termination             Description
 INT[5:0]_         Bidirectional open   Hi-Z                    Pull-up resistor        Interrupt: General purpose
                   drain                                                                interrupt pins
                   (5V tolerant LVTTL)
                   (Schmitt trigger)
 ENUM#             Open drain output    Hi-Z                    Pull-up resistor if the System Enumeration: Used to
                   (PCI)                                        application is a        notify system host that a board has
                                                                system host.            been freshly inserted or extracted
                                                                Otherwise there is no   from the system.
                                                                resistor requirement
                                                                on the signal.
 ES                Input                -                       Pull-down resistor in   Ejector Switch: Indicates the
                   (5V tolerant LVTTL)                          non-Hot Swap            status of Hot Swap board ejector
                                                                environmenta            switch. A logic high value indicates
                   (Schmitt trigger)
                                                                                        the switch is closed and it is in
                                                                                        operation mode. This signal must
                                                                                        be pulled low in a non-Hot Swap
                                                                                        environment.
 LED#              Open drain output    Low                     Pull-up resistor if the LED: Controls the Hot Swap status
                   (5V tolerant LVTTL)                          application is a        LED.
                                                                system host.
                                                                Otherwise there is no
                                                                resistor requirement
                                                                on the signal.a
 HEALTHY#          Input                -                       Pull-down resistor in   Board Healthy: In a Hot Swap
                   (5 V tolerant LVTTL)                         non-Hot Swap            environment, indicates the board is
                                                                environmenta            ready to be released from reset and
                   (Schmitt trigger)
                                                                                        become an active agent on PCI.
                                                                                        Negation of this signal resets all
                                                                                        PowerSpan II resources, including
                                                                                        PLL’s. Additionally, all PowerSpan II
                                                                                        outputs are tristated when this pin is
                                                                                        negated; inputs and bidirects are
                                                                                        inhibited. This signal must be pulled
                                                                                        low in a non-Hot Swap application.
 PO_RST_           Input                -                       -                       Power On Reset: Assertion of this
                   (5 V tolerant LVTTL)                                                 signal resets all PowerSpan II
                                                                                        resources, including PLL’s.
                   (Schmitt trigger)
Integrated Device Technology                                                                      PowerSpan II User Manual
www.idt.com                                                                                             80A1010_MA001_09


202                                                                                                11. Signals and Pinout
Table 58: Miscellaneous Signals
                                                                 Recommended
 Pin Name         Pin Type             Reset State               Termination        Description
 I2C_SCLK         Open drain output    Hi-Z                      Pull-up resistor   Serial Clock: EEPROM Serial
                  (5 V tolerant LVTTL)                                              clock. This pin must be pulled high
                                                                                    even if an EEPROM is not installed
                                                                                    on the board.
 I2C_SDA          Bidirectional open   Hi-Z                      Pull-up resistor   Serial Data: EPROM Serial data
                  drain                                                             line. This pin must be pulled high
                  (5 V tolerant LVTTL)                                              even if an EEPROM is not installed
                                                                                    on the board.
 Vdd CORE         Supply               -                         -                  Core Vdd: Nominally 2.5V
 Vdd I/O          Supply               -                         -                  IO Vdd: Nominally 3.3V
 VSS              Supply               -                         -                  Ground
a. Refer to the CompactPCI Hot Swap Specification for information on these signals.
PowerSpan II User Manual                                                                  Integrated Device Technology
80A1010_MA001_09                                                                                            www.idt.com


11. Signals and Pinout                                                                                                   203
11.1.6          Test Signals
                Table 59 lists PowerSpan II signals used to support silicon or board level testing.
Table 59: Test Signals
                                                                 Recommended
 Pin Name              Pin Type             Reset State          Termination            Description
 PI_TEST1              Input                Internal pull-down   Pull-down resistor     PLL Test 1: Internal PLL test
                                            resistor                                    signal. This is for internal IDT
                                                                                        use.
 PI_TEST2              Input                Internal pull-down   Pull-down resistor     PLL Test 2: Internal PLL test
                                            resistor                                    signal. This is for internal IDT
                                                                                        use.
 P2_TEST1              Input                Internal pull-down   Pull-down resistor     PLL Test 1: Internal PLL test
                       Note: This signal is resistor                                    signal. This is for internal IDT
                       present in both the                                              use.
                       Single PCI
                       PowerSpan II and
                       the Dual PCI
                       PowerSpan II. The
                       signal is used for
                       both PCI-1 and
                       PCI-2 internal
                       testing.
 P2_TEST2              Input                Internal pull-down   Pull-down resistor     PLL Test 2: Internal PLL test
                                            resistor                                    signal. This is for internal IDT
                                                                                        use.
 PB_TEST1              Input                Internal pull-down   Pull-down resistor     PLL Test 1: Internal PLL test
                                            resistor                                    signal. This is for internal IDT
                                                                                        use.
 PB_TEST2              Input                Internal pull-down   Pull-down resistor     PLL Test 2: Internal PLL test
                                            resistor                                    signal. This is for internal IDT
                                                                                        use.
 TCK                   Input                Hi-Z                 -                      Test Clock (JTAG): Used to
                       (LVTTL)                                                          clock state information and data
                                                                                        into and out of the device during
                                                                                        boundary scan.
 TMS                   Input                Internal pull-up     -                      Test Mode Select (JTAG): Used
                       (LVTTL)              resistor                                    to control the state of the Test
                                                                                        Access Port controller
 TDI                   Input                Internal pull-up     -                      Test Data Input (JTAG): Used
                       (LVTTL)              resistor                                    (in conjunction with TCK) to shift
                                                                                        data and instructions into the Test
                                                                                        Access Port (TAP) in a serial bit
                                                                                        stream.
Integrated Device Technology                                                                   PowerSpan II User Manual
www.idt.com                                                                                           80A1010_MA001_09


204                                                                                        11. Signals and Pinout
Table 59: Test Signals
                                                         Recommended
 Pin Name           Pin Type          Reset State        Termination           Description
 TDO                Tristate output   Hi-Z               -                     Test Data Output (JTAG): Used
                    (LVTTL)                                                    (in conjunction with TCK) to shift
                                                                               data and instructions into the Test
                                                                               Access Port (TAP) in a serial bit
                                                                               stream.
 TRST_              Input             Internal pull-up   Pull-down resistor if Test Reset (JTAG):
                    (LVTTL)           resistor           JTAG is not used in   Asynchronous reset for the JTAG
                                                         the system.           controller. This pin must be
                    (Schmitt trigger)
                                                         Otherwise the signal  asserted during the power-up
                                                         must be toggled with  reset sequence to ensure that the
                                                         the PO_RST_           Boundary Scan Register
                                                         signal.               elements are configured for
                                                                               normal system operation.
                                                                               Customers must assert TRST
                                                                               _concurrently with PO_RST_ as
                                                                               part of the power-up reset
                                                                               sequence.
 TE                 Input             Internal pull-down Pull-down resistor    Test Enable: Enables
                                      resistor                                 manufacturing test. IDT
                                                                               recommends that system
                                                                               designers pull this signal low.
PowerSpan II User Manual                                                           Integrated Device Technology
80A1010_MA001_09                                                                                      www.idt.com


11. Signals and Pinout                                                                                           205
11.2            Dual PCI PowerSpan II Pinout
11.2.1          Dual PCI PowerSpan II 480 HSBGA
                Figure 24 illustrates the top, side, and bottom views of the PowerSpan II package.
                Table 60: Package Characteristics
                             Feature                                        Description
                 Package Type                        480 HSBGA
                 Package Body Size                   37.5mm
                 JEDEC Specification                 JEDEC MO-151 Variation BAT-1
Integrated Device Technology                                                                 PowerSpan II User Manual
www.idt.com                                                                                        80A1010_MA001_09


206                                                                                             11. Signals and Pinout
Figure 24: 480 HSBGA
                                                          Notes:
                                                          1. All dimensions in mm.
                                                          2. All dimension and tolerances conform to ANSI
                                                          Y14.5M-1994.
                                                          3. Conforms to JEDEC MO-151 Variation BAT-1.
11.2.1.1      Package Notes
              1. All dimensions in mm
              2. All dimensions and tolerance conform to ANSI Y14.5M - 1994
              3. Conforms to JEDEC MO-151 Variation BAT-1
PowerSpan II User Manual                                                                Integrated Device Technology
80A1010_MA001_09                                                                                          www.idt.com


11. Signals and Pinout                                                                                      207
11.2.2          480 HSBGA Pin Information
                The following table shows the PowerSpan II 480 HSBGA, 1.27 mm package, pin information. This
                package is backwards compatible with the original Powerspan’s 480 HPBGA device.
                A1. VSS_IO                     G25. VDD25                   AC25. VDD25
                A2. VSS_IO                     G26. P1_AD[9]                AC26. P2_TEST1
                A3. PB_A[12]                   G27. PCI_GNT[5]_             AC27. P2_AD[9]
                A4. PB_A[14]                   G28. P1_GNT[4]_              AC28. P2_AD[8]
                A5. PB_A[16]                   G29. VSS_IO                  AC29. VSS_IO
                A6. PB_A[18]                   H1. INT[4]_                  AD1. PB_D[60]
                A7. VSS_IO                     H2. PB_A[0]                  AD2. PB_D[52]
                A8. PB_A[21]                   H3. PB_A[1]                  AD3. PB_D[44]
                A9. PB_A[24]                   H4. PB_BR2_                  AD4. JT_TRST_
                A10. PB_A[27]                  H5. VDD25                    AD5. VDD25
                A11. PB_A[31]                  H25. VDD25                   AD25. VDD25
                A12. VSS_IO                    H26. VSS                     AD26. PCI_GNT[7]_
                A13. P1_AD[34]                 H27. P1_AD[12]               AD27. P2_AD[12]
                A14. P1_AD[38]                 H28. P1_AD[11]               AD28. P2_AD[11]
                A15. P1_AD[41]                 H29. P1_AD[10]               AD29. P2_AD[10]
                A16. VSS_IO                    J1. PB_TT[1]                 AE1. PB_D[20]
                A17. P1_AD[48]                 J2. HEALTHY_                 AE2. PB_TEST1
                A18. VSS_IO                    J3. PB_TT[2]                 AE3. PB_D[12]
                A19. P1_AD[53]                 J4. PB_TT[3]                 AE4. PB_BG2_
                A20. P1_AD[56]                 J5. VSS                      AE5. PB_AVSS
                A21. P1_AD[59]                 J25. VSS                     AE6. PB_DVDD
                A22. P1_AD[62]                 J26. VSS                     AE7. VDD25
                A23. VSS_IO                    J27. P1_INTA_                AE8. VDD25
                A24. P1_CBE[6]_                J28. PCI_GNT[6]_             AE9. VSS
                A25. P1_VDDA                   J29. P1_AD[13]               AE10. VDD33
                A26. P1_REQ64_                 K1. PB_AACK_                 AE11. VDD33
                A27. P1_AD[0]                  K2. PB_TT[4]                 AE12. VDD33
                A28. VSS_IO                    K3. VSS                      AE13. VSS
Integrated Device Technology                                                            PowerSpan II User Manual
www.idt.com                                                                                   80A1010_MA001_09


208                                                              11. Signals and Pinout
              A29. VSS_IO     K4. PB_TT[0]    AE14. VDD25
              B1. VSS_IO      K5. VDD33       AE15. VDD25
              B2. VSS_IO      K25. VDD33      AE16. VDD25
              B3. PB_A[13]    K26. P1_PAR     AE17. VSS
              B4. PB_A[15]    K27. P1_CBE[1]_ AE18. VDD33
              B5. VSS_IO      K28. P1_AD[15]  AE19. VDD33
              B6. JT_TMS      K29. P1_AD[14]  AE20. VDD33
              B7. P1_RST_DIR  L1. PB_ARTRY_   AE21. VSS
              B8. PB_A[22]    L2. PB_TSIZ[3]  AE22. VDD25
              B9. PB_A[26]    L3. PB_BG1_     AE23. VDD25
              B10. PB_A[28]   L4. PB_BR3_     AE24. P2_DVDD
              B11. PB_CI_     L5. VDD33       AE25. P2_AVSS
              B12. P1_AD[32]  L25. VDD33      AE26. P2_AD[14]
              B13. P1_AD[35]  L26. P1_TRDY_   AE27. P2_AD[13]
              B14. VSS_IO     L27. P1_DEVSEL_ AE28. P2_TEST2
              B15. P1_AD[42]  L28. P1_STOP_   AE29. P2_IDSEL
              B16. P1_AD[45]  L29. P1_PERR_   AF1. PB_D[36]
              B17. P1_AD[49]  M1. VSS_IO      AF2. PB_D[28]
              B18. P1_AD[50]  M2. PB_TSIZ[2]  AF3. INT[3]_
              B19. P1_AD[54]  M3. PB_TSIZ[1]  AF4. PB_DVSS
              B20. P1_AD[57]  M4. PB_TS_      AF5. PB_CLK
              B21. P1_IDSEL   M5. VDD33       AF6. INT[1]_
              B22. P1_AD[63]  M25. VDD33      AF7. VSS
              B23. P1_CBE[4]_ M26. P1_CBE[2]_ AF8. PB_VDDA
              B24. P1_CBE[7]_ M27. P1_FRAME_  AF9. PB_D[26]
              B25. P1_TEST2   M28. P1_IRDY_   AF10. PB_D[57]
              B26. P1_ACK64_  M29. VSS_IO     AF11. INT[0]_
              B27. P1_CLK     N1. PB_AP[3]    AF12. PB_D[25]
              B28. VSS_IO     N2. PB_TSIZ[0]  AF13. PB_D[1]
              B29. VSS_IO     N3. I2C_SCLK    AF14. PB_FAST
              C1. PB_A[11]    N4. PB_TBST_    AF15. PB_D[24]
PowerSpan II User Manual                                 Integrated Device Technology
80A1010_MA001_09                                                          www.idt.com


11. Signals and Pinout                                                           209
                C2. TE          N5. VSS         AF16. PB_DP[7]
                C3. VSS         N25. VSS        AF17. PB_DP[4]
                C4. JT_TCK      N26. P1_AD[19]  AF18. PB_DP[1]
                C5. PB_A[17]    N27. P1_AD[18]  AF19. P2_RST_
                C6. PB_A[19]    N28. P1_AD[17]  AF20. P2_AD[28]
                C7. PB_DBG2_    N29. P1_AD[16]  AF21. P2_AD[24]
                C8. PB_A[23]    P1. VSS_IO      AF22. VSS
                C9. PB_A[25]    P2. PB_AP[1]    AF23. P2_AD[19]
                C10. PB_A[29]   P3. PB_AP[2]    AF24. P2_SERR_
                C11. PB_DBG1_   P4. I2C_SDA     AF25. P2_CLK
                C12. P1_AD[33]  P5. VDD25       AF26. P2_DVSS
                C13. P1_AD[36]  P25. VDD25      AF27. P2_INTA_
                C14. P1_AD[39]  P26. P1_AD[22]  AF28. P2_CBE[1]_
                C15. P1_AD[43]  P27. P1_AD[21]  AF29. P2_AD[15]
                C16. P1_AD[46]  P28. VSS_IO     AG1. PB_D[43]
                C17. P1_SERR_   P29. P1_AD[20]  AG2. PB_D[35]
                C18. P1_AD[51]  R1. PB_TA_      AG3. VSS
                C19. P1_AD[55]  R2. PB_DVAL_    AG4. INT[2]_
                C20. P1_REQ[4]_ R3. PB_TEA_     AG5. PB_D[3]
                C21. P1_AD[60]  R4. PB_AP[0]    AG6. PB_D[11]
                C22. P1_PAR64   R5. VDD25       AG7. PB_D[42]
                C23. P1_CBE[5]_ R25. VDD25      AG8. PB_D[58]
                C24. P1_REQ1_   R26. P1_AD[25]  AG9. PB_D[18]
                C25. P1_GNT1_   R27. P1_AD[24]  AG10. PB_ABB_
                C26. P1_64EN_   R28. P1_CBE[3]_ AG11. PB_RSTCONF_
                C27. VSS        R29. P1_AD[23]  AG12. PB_D[17]
                C28. P1_AD[2]   T1. PB_D[15]    AG13. PB_RST_
                C29. P1_AD[1]   T2. VSS_IO      AG14. PB_D[40]
                D1. PB_A[8]     T3. PB_D[30]    AG15. PB_D[16]
                D2. PB_A[9]     T4. PB_D[39]    AG16. PB_DP[6]
                D3. PB_A[10]    T5. VDD25       AG17. PB_DP[3]
Integrated Device Technology                                 PowerSpan II User Manual
www.idt.com                                                      80A1010_MA001_09


210                                                            11. Signals and Pinout
              D4. VSS         T25. VDD25      AG18. PB_DP[0]
              D5. JT_TDI      T26. P1_AD[28]  AG19. P2_AD[31]
              D6. JT_TDO      T27. P1_AD[27]  AG20. P2_AD[27]
              D7. PB_A[20]    T28. P1_AD[26]  AG21. P2_CBE[3]_
              D8. VSS         T29. VSS_IO     AG22. P2_AD[22]
              D9. VSS         U1. LED_        AG23. P2_AD[18]
              D10. PB_A[30]   U2. PB_D[7]     AG24. P2_AD[17]
              D11. PB_BR1_    U3. PB_D[22]    AG25. P2_FRAME_
              D12. PB_GBL_    U4. PB_D[47]    AG26. P2_REQ[2]_
              D13. P1_AD[37]  U5. VSS         AG27. VSS
              D14. P1_AD[40]  U25. VSS        AG28. P2_REQ[3]_
              D15. P1_AD[44]  U26. P1_AD[31]  AG29. P2_PAR
              D16. P1_AD[47]  U27. VSS        AH1. VSS_IO
              D17. P1_M66EN   U28. P1_AD[30]  AH2. VSS_IO
              D18. P1_AD[52]  U29. P1_AD[29]  AH3. NC
              D19. P1_REQ[3]_ V1. VSS_IO      AH4. PB_D[59]
              D20. P1_AD[58]  V2. PB_D[6]     AH5. PB_TEST2
              D21. P1_AD[61]  V3. PB_D[55]    AH6. PB_D[19]
              D22. ENUM_      V4. PB_D[23]    AH7. PB_D[50]
              D23. P1_TEST1   V5. VDD33       AH8. PB_D[34]
              D24. P1_GNT[2]_ V25. VDD33      AH9. VSS_IO
              D25. P1_GNT[3]_ V26. P2_GNT[3]_ AH10. PB_D[49]
              D26. P1_DVSS    V27. P2_GNT[4]_ AH11. PB_D[41]
              D27. P1_REQ[2]_ V28. P1_RST_    AH12. PB_D[9]
              D28. P1_AD[4]   V29. VSS_IO     AH13. PB_D[56]
              D29. P1_AD[3]   W1. PB_D[31]    AH14. PB_D[32]
              E1. PB_DBG3_    W2. PB_D[62]    AH15. PB_D[8]
              E2. VSS_IO      W3. PB_D[54]    AH16. VSS_IO
              E3. PB_A[7]     W4. PB_D[46]    AH17. PB_DP[2]
              E4. ES          W5. VDD33       AH18. PB_D[63]
              E5. VSS         W25. VDD33      AH19. P2_AD[30]
PowerSpan II User Manual                               Integrated Device Technology
80A1010_MA001_09                                                        www.idt.com


11. Signals and Pinout                                                             211
                E6. VDD25        W26. P2_AD[0]    AH20. P2_AD[26]
                E7. VDD25        W27. P2_REQ1_    AH21. VSS_IO
                E8. VDD25        W28. P2_GNT1_    AH22. P2_AD[21]
                E9. VSS          W29. P2_GNT[2]_  AH23. P2_VDDA
                E10. VDD33       Y1. PB_D[21]     AH24. P2_AD[16]
                E11. VDD33       Y2. PB_D[38]     AH25. VSS_IO
                E12. VDD33       Y3. PB_D[14]     AH26. P2_TRDY_
                E13. VSS         Y4. PB_D[53]     AH27. P2_STOP_
                E14. VDD25       Y5. VDD33        AH28. VSS_IO
                E15. VDD25       Y25. VDD33       AH29. VSS_IO
                E16. VDD25       Y26. P2_AD[3]    AJ1. VSS_IO
                E17. VSS         Y27. PCI_REQ[7]_ AJ2. VSS_IO
                E18. VDD33       Y28. P2_AD[2]    AJ3. PB_D[51]
                E19. VDD33       Y29. P2_AD[1]    AJ4. PB_D[4]
                E20. VDD33       AA1. PB_D[37]    AJ5. PB_DBB_
                E21. VSS         AA2. NC          AJ6. PB_D[27]
                E22. VDD25       AA3. PB_D[29]    AJ7. VSS_IO
                E23. VDD25       AA4. VSS         AJ8. PB_D[10]
                E24. P1_DVDD     AA5. VSS         AJ9. PB_D[2]
                E25. P1_AVSS     AA25. VSS        AJ10. PO_RST_
                E26. PCI_REQ[5]_ AA26. P2_AD[5]   AJ11. PB_D[33]
                E27. P1_AD[6]    AA27. P2_AD[4]   AJ12. VSS_IO
                E28. VSS_IO      AA28. VSS_IO     AJ13. PB_D[48]
                E29. P1_AD[5]    AA29. P2_M66EN   AJ14. VSS_IO
                F1. PB_A[4]      AB1. PB_D[5]     AJ15. PB_D[0]
                F2. PB_A[5]      AB2. PB_D[61]    AJ16. PB_DP[5]
                F3. PB_A[6]      AB3. PB_D[45]    AJ17. P2_RST_DIR
                F4. PB_RST_DIR   AB4. VSS         AJ18. VSS_IO
                F5. VDD25        AB5. VDD25       AJ19. P2_AD[29]
                F25. VDD25       AB25. VDD25      AJ20. P2_AD[25]
                F26. PCI_REQ[6]_ AB26. P2_REQ[4]_ AJ21. P2_AD[23]
Integrated Device Technology                                   PowerSpan II User Manual
www.idt.com                                                        80A1010_MA001_09


212                                                              11. Signals and Pinout
              F27. P1_AD[8]   AB27. P2_CBE[0]_ AJ22. P2_AD[20]
              F28. P1_CBE[0]_ AB28. P2_AD[7]   AJ23. VSS_IO
              F29. P1_AD[7]   AB29. P2_AD[6]   AJ24. P2_CBE[2]_
              G1. VSS_IO      AC1. VSS_IO      AJ25. P2_IRDY_
              G2. PB_A[2]     AC2. PB_BG3_     AJ26. P2_DEVSEL_
              G3. PB_A[3]     AC3. INT[5]_     AJ27. P2_PERR_
              G4. VSS         AC4. PB_D[13]    AJ28. VSS_IO
              G5. VDD25       AC5. VDD25       AJ29. VSS_IO
PowerSpan II User Manual                                 Integrated Device Technology
80A1010_MA001_09                                                          www.idt.com


11. Signals and Pinout                                                                                           213
11.2.3          Dual PCI PowerSpan II 504 HSBGA
                Figure 25 illustrates the top, side, and bottom views of the PowerSpan II package.
                Table 61: Package Characteristics
                             Feature                                        Description
                 Package Type                        504 HSBGA
                 Package Body Size                   27mm
                 JEDEC Specification                 JEDEC MO-151 Variation AAL-1
Integrated Device Technology                                                                 PowerSpan II User Manual
www.idt.com                                                                                        80A1010_MA001_09


214                                                                                        11. Signals and Pinout
Figure 25: 504 HSBGA
                                                     Notes:
                                                     1. All dimensions in mm.
                                                     2. All dimension and tolerances conform to ANSI
                                                     Y14.5M-1994.
                                                     3. Conforms to JEDEC MO-151 Variation AAL-1.
11.2.3.1      Package Notes
              1. All dimensions in mm
              2. All dimensions and tolerance conform to ANSI Y14.5M - 1994
              3. Conforms to JEDEC MO-151 Variation AAL-1
PowerSpan II User Manual                                                           Integrated Device Technology
80A1010_MA001_09                                                                                    www.idt.com


11. Signals and Pinout                                                                                      215
11.2.4          504 HSBGA Pin Information
                The following table shows the PowerSpan II 504 HSBG pin information.
                A3. JT_TDO                     H21. VDD25                 W21. VDD25
                A4. PB_A[19]                   H22. VDD25                 W22. VDD25
                A5. JT_TMS                     H23. P1_CBE[0]_            W23. P2_IDSEL
                A6. PB_A[21]                   H24. P1_INTA_              W24. P2_AD[5]
                A7. PB_A[24]                   H25. P1_AD[15]             W25. PCI_REQ[7]_
                A8. PB_CI_                     H26. P1_CBE[2]_            W26. P2_REQ[1]_
                A9. P1_AD[33]                  J1. PB_ARTRY_              Y1. PB_D[53]
                A10. P1_AD[32]                 J2. PB_BR3_                Y2. PB_D[61]
                A11. P1_AD[35]                 J3. INT[4]_                Y3. PB_D[60]
                A12. P1_AD[40]                 J4. PB_BR2_                Y4. JT_TRST_
                A13. P1_AD[42]                 J5. VDD25                  Y5. PB_D[35]
                A14. P1_AD[43]                 J6. VDD25                  Y6. VDD33
                A15. P1_AD[45]                 J21. VDD25                 Y21. VDD33
                A16. P1_SERR_                  J22. VDD25                 Y22. P2_PAR
                A17. P1_AD[52]                 J23. P1_GNT[4]_            Y23. P2_AD[15]
                A18. P1_AD[53]                 J24. P1_AD[13]             Y24. P2_AD[8]
                A19. P1_AD[56]                 J25. P1_DEVSEL_            Y25. P2_AD[6]
                A20. P1_AD[58]                 J26. P1_IRDY_              Y26. P2_M66EN
                A21. P1_AD[61]                 K1. PB_TS_                 AA1. PB_D[45]
                A22. P1_CBE[7]_                K2. PB_TSIZ[3]             AA2. INT[5]_
                A23. P1_GNT[2]_                K3. PB_TT[1]               AA3. PB_D[20]
                A24. P1_ACK64_                 K4. PB_TT[2]               AA4. PB_D[28]
                B2. VSS_IO                     K5. VDD33                  AA5. PB_BG2_
                B3. VSS_IO                     K6. VDD33                  AA6. PB_DVDD
                B4. PB_A[15]                   K21. VDD33                 AA7. VDD33
                B5. PB_A[20]                   K22. VDD33                 AA8. VDD25
                B6. PB_A[23]                   K23. PCI_GNT[6]_           AA9. VDD25
                B7. PB_A[25]                   K24. P1_TRDY_              AA10. VDD33
                B8. PB_A[29]                   K25. P1_FRAME_             AA11. VDD33
Integrated Device Technology                                                            PowerSpan II User Manual
www.idt.com                                                                                 80A1010_MA001_09


216                                                              11. Signals and Pinout
              B9. PB_DBG1_    K26. P1_AD[19] AA12. VSS
              B10. PB_GBL_    L1. I2C_SCLK   AA13. VSS
              B11. P1_AD[36]  L2. PB_TBST_   AA14. VSS
              B12. P1_AD[34]  L3. PB_BG1_    AA15. VSS
              B13. P1_AD[41]  L4. PB_TT[4]   AA16. VDD33
              B14. P1_AD[44]  L5. VDD33      AA17. VDD33
              B15. P1_AD[49]  L6. VDD33      AA18. VDD25
              B16. P1_M66EN   L11. VSS_IO    AA19. VDD25
              B17. P1_AD[54]  L12. VSS_IO    AA20. VDD33
              B18. P1_REQ[3]_ L13. VSS_IO    AA21. P2_DVDD
              B19. P1_AD[59]  L14. VSS_IO    AA22. P2_INTA_
              B20. P1_AD[63]  L15. VSS_IO    AA23. P2_AD[13]
              B21. P1_CBE[6]_ L16. VSS_IO    AA24. P2_AD[9]
              B22. P1_REQ64_  L21. VDD33     AA25. P2_CBE[0]_
              B23. P1_64EN_   L22. VDD33     AA26. P2_AD[7]
              B24. VSS_IO     L23. P1_AD[14] AB1. PB_D[13]
              B25. VSS_IO     L24. P1_PERR_  AB2. PB_D[12]
              C1. PB_A[9]     L25. P1_AD[16] AB3. INT[3]_
              C2. VSS_IO      L26. P1_AD[22] AB4. PB_TEST1
              C3. VSS         M1. PB_AP[1]   AB5. VSS_IO
              C4. PB_A[13]    M2. PB_AP[3]   AB6. INT[2]_
              C5. PB_A[12]    M3. PB_TSIZ[1] AB7. PB_TEST2
              C6. PB_DBG2_    M4. PB_TSIZ[0] AB8. VDD25
              C7. P1_RST_DIR  M5. PB_TSIZ[2] AB9. VDD25
              C8. PB_A[22]    M6. VSS        AB10. VDD33
              C9. PB_A[30]    M11. VSS_IO    AB11. VDD33
              C10. PB_A[28]   M12. VSS_IO    AB12. PB_D[49]
              C11. PB_A[31]   M13. VSS_IO    AB13. VSS
              C12. P1_AD[37]  M14. VSS_IO    AB14. VSS
              C13. P1_AD[39]  M15. VSS_IO    AB15. P2_CBE[3]_
              C14. P1_AD[47]  M16. VSS_IO    AB16. VDD33
PowerSpan II User Manual                                 Integrated Device Technology
80A1010_MA001_09                                                          www.idt.com


11. Signals and Pinout                                                             217
                C15. P1_AD[50]  M21. VSS         AB17. VDD33
                C16. P1_AD[55]  M22. P1_STOP_    AB18. VDD25
                C17. P1_REQ[4]_ M23. P1_AD[17]   AB19. VDD25
                C18. P1_AD[62]  M24. P1_AD[18]   AB20. P2_REQ[3]_
                C19. P1_PAR64   M25. P1_AD[21]   AB21. P2_TEST1
                C20. P1_CBE[4]_ M26. P1_AD[23]   AB22. VSS_IO
                C21. P1_CBE[5]_ N1. PB_DVAL_     AB23. P2_TEST2
                C22. P1_CLK     N2. PB_TA_       AB24. P2_AD[14]
                C23. P1_AVSS    N3. PB_AP[2]     AB25. P2_AD[12]
                C24. P1_VDDA    N4. I2C_SDA      AB26. P2_AD[10]
                C25. VSS_IO     N5. VSS          AC1. PB_D[36]
                C26. P1_AD[4]   N6. VSS          AC2. VSS_IO
                D1. PB_A[6]     N11. VSS_IO      AC3. VSS_IO
                D2. PB_A[11]    N12. VSS_IO      AC4. VSS_IO
                D3. TE          N13. VSS_IO      AC5. PB_DVSS
                D4. VSS         N14. VSS_IO      AC6. INT[1]_
                D5. JT_TDI      N15. VSS_IO      AC7. PB_D[3]
                D6. PB_A[17]    N16. VSS_IO      AC8. PB_D[11]
                D7. PB_A[14]    N21. VSS         AC9. PB_D[42]
                D8. PB_A[16]    N22. VSS         AC10. PB_D[10]
                D9. PB_A[18]    N23. PCI_REQ[5]_ AC11. PO_RST_
                D10. PB_A[26]   N24. P1_AD[20]   AC12. PB_D[25]
                D11. PB_A[27]   N25. P1_CBE[3]_  AC13. PB_D[40]
                D12. P1_AD[38]  N26. P1_AD[24]   AC14. PB_DP[5]
                D13. P1_AD[46]  P1. PB_TEA_      AC15. PB_DP[4]
                D14. P1_AD[48]  P2. PB_D[15]     AC16. P2_AD[26]
                D15. P1_AD[51]  P3. PB_D[39]     AC17. P2_AD[21]
                D16. P1_AD[57]  P4. PB_AP[0]     AC18. P2_IRDY_
                D17. P1_AD[60]  P5. VSS          AC19. P2_DEVSEL_
                D18. ENUM_      P6. VSS          AC20. P2_TRDY_
                D19. P1_REQ[1]_ P11. VSS_IO      AC21. P2_PERR_
Integrated Device Technology                                   PowerSpan II User Manual
www.idt.com                                                        80A1010_MA001_09


218                                                               11. Signals and Pinout
              D20. P1_GNT[1]_ P12. VSS_IO      AC22. P2_DVSS
              D21. P1_GNT[3]_ P13. VSS_IO      AC23. VSS_IO
              D22. P1_DVSS    P14. VSS_IO      AC24. VSS_IO
              D23. VSS_IO     P15. VSS_IO      AC25. VSS_IO
              D24. VSS_IO     P16. VSS_IO      AC26. P2_AD[11]
              D25. VSS_IO     P21. VSS         AD1. PB_D[43]
              D26. P1_AD[8]   P22. VSS         AD2. VSS_IO
              E1. PB_A[3]     P23. P1_AD[28]   AD3. PB_VDDA
              E2. PB_RST_DIR  P24. PCI_GNT[7]_ AD4. PB_AVSS
              E3. PB_A[10]    P25. PCI_REQ[6]_ AD5. PB_CLK
              E4. ES          P26. P1_AD[25]   AD6. PB_D[19]
              E5. VSS         R1. PB_D[30]     AD7. PB_D[50]
              E6. VSS         R2. LED_         AD8. PB_D[26]
              E7. JT_TCK      R3. PB_D[6]      AD9. PB_D[57]
              E8. VDD25       R4. PB_D[47]     AD10. INT[0]_
              E9. VDD25       R5. PB_D[37]     AD11. PB_D[33]
              E10. VDD33      R6. VSS          AD12. PB_RST_
              E11. VDD33      R11. VSS_IO      AD13. PB_D[32]
              E12. PB_BR1_    R12. VSS_IO      AD14. P2_RST_DIR
              E13. VSS        R13. VSS_IO      AD15. PB_D[63]
              E14. VSS        R14. VSS_IO      AD16. P2_AD[31]
              E15. P1_IDSEL   R15. VSS_IO      AD17. P2_AD[27]
              E16. VDD33      R16. VSS_IO      AD18. P2_AD[20]
              E17. VDD33      R21. VSS         AD19. P2_CBE[2]_
              E18. VDD25      R22. P2_AD[1]    AD20. P2_AD[18]
              E19. VDD25      R23. P1_AD[29]   AD21. P2_AD[19]
              E20. P1_TEST2   R24. P1_AD[31]   AD22. P2_CLK
              E21. P1_TEST1   R25. P1_AD[27]   AD23. P2_AVSS
              E22. VSS_IO     R26. PCI_GNT[5]_ AD24. P2_VDDA
              E23. P1_AD[0]   T1. PB_D[7]      AD25. VSS_IO
              E24. P1_AD[2]   T2. PB_D[22]     AD26. P2_CBE[1]_
PowerSpan II User Manual                                  Integrated Device Technology
80A1010_MA001_09                                                           www.idt.com


11. Signals and Pinout                                                            219
                E25. P1_AD[9]   T3. PB_D[62]    AE2. VSS_IO
                E26. P1_AD[7]   T4. PB_D[21]    AE3. VSS_IO
                F1. PB_A[0]     T5. VDD33       AE4. PB_D[51]
                F2. PB_A[2]     T6. VDD33       AE5. PB_D[4]
                F3. PB_DBG3_    T11. VSS_IO     AE6. PB_D[58]
                F4. PB_A[7]     T12. VSS_IO     AE7. PB_D[18]
                F5. VSS         T13. VSS_IO     AE8. PB_ABB_
                F6. VDD33       T14. VSS_IO     AE9. PB_RSTCONF_
                F7. VDD33       T15. VSS_IO     AE10. PB_D[17]
                F8. VDD25       T16. VSS_IO     AE11. PB_D[56]
                F9. VDD25       T21. VDD33      AE12. PB_FAST
                F10. VDD33      T22. VDD33      AE13. PB_D[16]
                F11. VDD33      T23. P2_AD[0]   AE14. PB_DP[6]
                F12. VSS        T24. P2_GNT[2]_ AE15. PB_DP[2]
                F13. VSS        T25. P1_AD[30]  AE16. PB_DP[0]
                F14. VSS        T26. P1_AD[26]  AE17. P2_AD[30]
                F15. VSS        U1. PB_D[55]    AE18. P2_RST_
                F16. VDD33      U2. PB_D[31]    AE19. P2_AD[23]
                F17. VDD33      U3. PB_D[38]    AE20. P2_AD[24]
                F18. VDD25      U4. PB_D[5]     AE21. P2_AD[16]
                F19. VDD25      U5. VDD33       AE22. P2_SERR_
                F20. VDD33      U6. VDD33       AE23. P2_REQ[2]_
                F21. P1_DVDD    U21. VDD33      AE24. VSS_IO
                F22. P1_REQ[2]_ U22. VDD33      AE25. VSS_IO
                F23. P1_AD[1]   U23. P2_AD[4]   AF3. PB_D[59]
                F24. P1_AD[5]   U24. P2_AD[2]   AF4. PB_DBB_
                F25. P1_AD[11]  U25. P2_GNT[3]_ AF5. PB_D[27]
                F26. P1_AD[10]  U26. P1_RST_    AF6. PB_D[34]
                G1. HEALTHY_    V1. PB_D[23]    AF7. PB_D[2]
                G2. PB_TT[3]    V2. PB_D[46]    AF8. PB_D[41]
                G3. PB_A[4]     V3. PB_D[29]    AF9. PB_D[9]
Integrated Device Technology                                  PowerSpan II User Manual
www.idt.com                                                       80A1010_MA001_09


220                                                             11. Signals and Pinout
              G4. PB_A[8]     V4. PB_D[52]    AF10. PB_D[1]
              G5. VSS         V5. VDD25       AF11. PB_D[48]
              G6. VDD33       V6. VDD25       AF12. PB_D[24]
              G21. VDD33      V21. VDD25      AF13. PB_D[8]
              G22. P1_AD[6]   V22. VDD25      AF14. PB_D[0]
              G23. P1_AD[3]   V23. P2_REQ[4]_ AF15. PB_DP[7]
              G24. P1_AD[12]  V24. P2_AD[3]   AF16. PB_DP[3]
              G25. P1_PAR     V25. P2_GNT[1]_ AF17. PB_DP[1]
              G26. P1_CBE[1]_ V26. P2_GNT[4]_ AF18. P2_AD[29]
              H1. PB_AACK_    W1. PB_D[54]    AF19. P2_AD[25]
              H2. PB_TT[0]    W2. PB_D[14]    AF20. P2_AD[28]
              H3. PB_A[1]     W3. PB_BG3_     AF21. P2_AD[22]
              H4. PB_A[5]     W4. PB_D[44]    AF22. P2_AD[17]
              H5. VDD25       W5. VDD25       AF23. P2_FRAME_
              H6. VDD25       W6. VDD25       AF24. P2_STOP_
PowerSpan II User Manual                                Integrated Device Technology
80A1010_MA001_09                                                         www.idt.com


11. Signals and Pinout                                                                                           221
11.3            Single PCI PowerSpan II Pin Information
                The PowerSpan II Single PCI device is offered in two packages. The 484 PBGA package is offered
                with a 23 mm body size and 1.00 mm ball pitch.The 420 HSBGA package is offered with a 35 mm
                body size and 1.27 mm ball pitch. The 35 mm body size is the same as the original PowerSpan package
                offering.
11.3.1          Single PCI PowerSpan II 420 HSBGA
                Figure 26 illustrates the top, side, and bottom views of the PowerSpan II package.
                Table 62: Package Characteristics
                             Feature                                        Description
                 Package Type                        420 HSBGA
                 Package Body Size                   35mm
                 JEDEC Specification                 JEDEC MO-151 Variation BAT-1
Integrated Device Technology                                                                 PowerSpan II User Manual
www.idt.com                                                                                        80A1010_MA001_09


222                                                                                                 11. Signals and Pinout
Figure 26: 420 HSBGA
                                                         Notes:
                                                         1. All dimensions in mm.
                                                         2. All dimension and tolerances conform to ANSI Y14.5M-1994.
                                                         3. Conforms to JEDEC MO-034 Variation BAR-1.
11.3.1.1      Package Notes
              1. All dimensions in mm
              2. All dimensions and tolerance conform to ANSI Y14.5M - 1994
              3. Conforms to JEDEC MS-034 Variation BAR-1
PowerSpan II User Manual                                                                   Integrated Device Technology
80A1010_MA001_09                                                                                              www.idt.com


11. Signals and Pinout                                                                                      223
11.3.2          420 HSBGA Pin Information
                The following table shows the PowerSpan II 420 HSBGA pin information. This package is backwards
                compatible with the original PowerSpan’s 420 HPBGA device.
                A1. VSS_IO                         G1. PB_TT[3]              AA1. VSS_IO
                A2. VSS_IO                         G2. PB_A[1]               AA2. PB_D[36]
                A3. JT_TDI                         G3. PB_A[5]               AA3. PB_D[28]
                A4. JT_TDO                         G4. PB_A[3]               AA4. PB_D[12]
                A5. JT_TCK                         G5. VDD33                 AA5. VDD33
                A6. VSS_IO                         G22. VDD33                AA22. VDD33
                A7. PB_A[30]                       G23. P1_AD[6]             AA23. VSS
                A8. P1_RST_DIR                     G24. P1_AD[1]             AA24. VSS
                A9. VSS_IO                         G25. P1_AD[4]             AA25. VSS_IO
                A10. PB_DBG1_                      G26. P1_AD[3]             AA26. VSS_IO
                A11. VSS_IO                        H1. PB_BR3_               AB1. INT[5]_
                A12. P1_AD[34]                     H2. PB_TT[2]              AB2. PB_D[44]
                A13. P1_AD[40]                     H3. PB_A[4]               AB3. PB_D[43]
                A14. P1_AD[44]                     H4. PB_A[2]               AB4. PB_D[35]
                A15. P1_AD[47]                     H5. VDD33                 AB5. VSS
                A16. VSS_IO                        H22. VDD33                AB6. VDD33
                A17. P1_AD[50]                     H23. P1_AD[8]             AB7. VDD33
                A18. P1_AD[51]                     H24. P1_AD[9]             AB8. VDD33
                A19. P1_REQ[4]_                    H25. PCI_GNT[5]_          AB9. VSS
                A20. P1_AD[59]                     H26. P1_TEST2             AB10. PB_DVDD
                A21. VSS_IO                        J1. HEALTHY_              AB11. VDD25
                A22. P1_VDDA                       J2. VSS_IO                AB12. VDD25
                A23. P1_CBE[7]_                    J3. PB_A[0]               AB13. VSS_IO
                A24. P1_GNT[3]_                    J4. INT[4]_               AB14. VSS_IO
                A25. P1_CLK                        J5. VSS                   AB15. VDD25
                A26. VSS_IO                        J22. VSS                  AB16. VDD25
                B1. TE                             J23. P1_CBE[0]_           AB17. VDD25
                B2. VSS_IO                         J24. P1_AD[7]             AB18. VSS
Integrated Device Technology                                                            PowerSpan II User Manual
www.idt.com                                                                                  80A1010_MA001_09


224                                                           11. Signals and Pinout
              B3. PB_A[13]    J25. P1_GNT[4]_  AB19. VDD33
              B4. PB_A[19]    J26. PCI_GNT[6]_ AB20. VDD33
              B5. PB_A[20]    K1. PB_AACK_     AB21. VDD33
              B6. PB_A[18]    K2. PB_TT[4]     AB22. VSS
              B7. PB_A[21]    K3. PB_TT[0]     AB23. PCI_GNT[7]_
              B8. PB_A[26]    K4. PB_TT[1]     AB24. VSS_IO
              B9. PB_DBG2_    K5. VDD25        AB25. VSS_IO
              B10. PB_BR1_    K22. P1_DVDD     AB26. NC
              B11. P1_AD[33]  K23. P1_AD[12]   AC1. JT_TRST_
              B12. P1_AD[32]  K24. P1_AD[11]   AC2. PB_D[53]
              B13. P1_AD[39]  K25. P1_AD[10]   AC3. PB_TEA_
              B14. P1_AD[41]  K26. P1_AD[13]   AC4. PB_AVSS
              B15. P1_AD[48]  L1. VSS_IO       AC5. NC
              B16. P1_AD[49]  L2. PB_ARTRY_    AC6. PB_D[3]
              B17. P1_AD[52]  L3. PB_TSIZ[3]   AC7. LED_
              B18. P1_REQ[3]_ L4. PB_BG1_      AC8. VSS
              B19. P1_AD[56]  L5. VDD25        AC9. PB_D[19]
              B20. P1_IDSEL   L22. VDD25       AC10. PB_D[27]
              B21. ENUM_      L23. P1_INTA_    AC11. PB_D[18]
              B22. NC         L24. P1_PAR      AC12. PB_D[57]
              B23. P1_GNT[1]_ L25. P1_CBE[1]_  AC13. PB_D[41]
              B24. P1_64EN_   L26. VSS_IO      AC14. PB_D[1]
              B25. VSS_IO     M1. PB_TS_       AC15. PB_FAST
              B26. VSS_IO     M2. PB_TSIZ[1]   AC16. PB_D[24]
              C1. PB_RST_DIR  M3. PB_TBST_     AC17. PB_DP[6]
              C2. PB_A[10]    M4. PB_TSIZ[2]   AC18. PB_DP[3]
              C3. VSS_IO      M5. VDD25        AC19. PB_D[63]
              C4. PB_A[17]    M22. VDD25       AC20. PB_DP[5]
              C5. PB_A[15]    M23. P1_AD[15]   AC21. VSS
              C6. PB_A[16]    M24. P1_AD[14]   AC22. PB_D[8]
              C7. PB_A[22]    M25. P1_AD[5]    AC23. VSS
PowerSpan II User Manual                              Integrated Device Technology
80A1010_MA001_09                                                       www.idt.com


11. Signals and Pinout                                                          225
                C8. PB_A[25]     M26. P1_AD[2]   AC24. VSS_IO
                C9. PB_A[29]     N1. I2C_SCLK    AC25. P1_RST_
                C10. PB_A[27]    N2. PB_TSIZ[0]  AC26. P1_AD[31]
                C11. PB_GBL_     N3. PB_AP[3]    AD1. INT[3]_
                C12. P1_AD[37]   N4. PB_AP[2]    AD2. PB_D[37]
                C13. VSS_IO      N5. VSS_IO      AD3. PB_DVSS
                C14. NC          N22. VSS_IO     AD4. PB_D[31]
                C15. P1_SERR_    N23. P1_FRAME_  AD5. PB_D[38]
                C16. P1_AD[53]   N24. P1_CBE[2]_ AD6. PB_D[14]
                C17. P1_AD[57]   N25. P1_PERR_   AD7. PB_D[11]
                C18. P1_AD[60]   N26. P1_STOP_   AD8. PB_D[51]
                C19. P1_AD[61]   P1. PB_AP[1]    AD9. PB_D[42]
                C20. P1_CBE[6]_  P2. NC          AD10. PB_D[50]
                C21. P1_CBE[5]_  P3. PB_TA_      AD11. PB_D[34]
                C22. P1_REQ[1]_  P4. PB_AP[0]    AD12. PB_D[2]
                C23. P1_AD[46]   P5. VSS_IO      AD13. PB_D[33]
                C24. VSS_IO      P22. VSS_IO     AD14. PB_D[9]
                C25. PB_CI_      P23. P1_AD[17]  AD15. PB_D[48]
                C26. PCI_REQ[5]_ P24. P1_AD[18]  AD16. P2_TEST1
                D1. PB_A[8]      P25. P1_AD[19]  AD17. PB_DP[7]
                D2. PB_A[11]     P26. P1_IRDY_   AD18. PB_DP[2]
                D3. PB_A[7]      R1. VSS_IO      AD19. PB_DP[4]
                D4. VSS          R2. PB_D[47]    AD20. PB_DP[1]
                D5. PB_A[12]     R3. PB_D[22]    AD21. PB_D[0]
                D6. PB_A[14]     R4. PB_D[7]     AD22. VSS
                D7. JT_TMS       R5. VDD25       AD23. VSS_IO
                D8. PB_A[23]     R22. VDD25      AD24. VSS_IO
                D9. PB_A[24]     R23. P1_TEST1   AD25. NC
                D10. PB_A[28]    R24. P1_AD[21]  AD26. VSS_IO
                D11. PB_A[31]    R25. P1_AD[22]  AE1. VSS_IO
                D12. P1_AD[35]   R26. P1_AD[16]  AE2. VSS_IO
Integrated Device Technology                                PowerSpan II User Manual
www.idt.com                                                     80A1010_MA001_09


226                                                          11. Signals and Pinout
              D13. P1_AD[43]  T1. VSS_IO      AE3. INT[2]_
              D14. P1_AD[45]  T2. PB_D[6]     AE4. PB_D[39]
              D15. P1_M66EN   T3. PB_D[55]    AE5. PB_DBB_
              D16. P1_AD[54]  T4. PB_D[23]    AE6. NC
              D17. P1_AD[58]  T5. VDD25       AE7. PB_D[15]
              D18. P1_AD[63]  T22. VDD25      AE8. PB_D[59]
              D19. P1_PAR64   T23. P1_AD[24]  AE9. PB_VDDA
              D20. P1_CBE[4]_ T24. P1_CBE[3]_ AE10. PB_D[58]
              D21. VSS        T25. P1_AD[20]  AE11. PB_D[10]
              D22. P1_GNT[2]_ T26. VSS_IO     AE12. VSS_IO
              D23. P1_AVSS    U1. PB_D[30]    AE13. PB_RSTCONF_
              D24. P1_AD[42]  U2. PB_D[54]    AE14. PB_D[17]
              D25. P1_AD[36]  U3. PB_D[46]    AE15. PB_D[56]
              D26. P1_REQ[2]_ U4. PB_D[21]    AE16. PB_D[40]
              E1. PB_DBG3_    U5. VDD25       AE17. NC
              E2. VSS_IO      U22. VDD25      AE18. NC
              E3. PB_A[9]     U23. NC         AE19. VSS_IO
              E4. ES          U24. P1_AD[23]  AE20. PB_DP[0]
              E5. VSS         U25. P1_AD[25]  AE21. PB_D[32]
              E6. VDD33       U26. VSS_IO     AE22. VSS_IO
              E7. VDD33       V1. PB_BG3_     AE23. VSS_IO
              E8. VDD33       V2. NC          AE24. VSS_IO
              E9. VSS         V3. PB_D[29]    AE25. VSS_IO
              E10. VDD25      V4. PB_D[5]     AE26. NC
              E11. VDD25      V5. VSS         AF1. VSS_IO
              E12. VDD25      V22. VSS        AF2. PB_BG2_
              E13. VSS_IO     V23. P1_AD[27]  AF3. INT[1]_
              E14. VSS_IO     V24. P1_AD[26]  AF4. PB_D[61]
              E15. VDD25      V25. VSS_IO     AF5. PB_CLK
              E16. VDD25      V26. VSS_IO     AF6. VSS_IO
              E17. VDD25      W1. PB_D[62]    AF7. PB_DVAL_
PowerSpan II User Manual                             Integrated Device Technology
80A1010_MA001_09                                                      www.idt.com


11. Signals and Pinout                                                                                             227
                E18. VSS                                W2. PB_TEST2                AF8. PB_ABB_
                E19. VDD33                              W3. PB_D[45]                AF9. I2C_SDA
                E20. VDD33                              W4. PB_D[60]                AF10. PB_D[26]
                E21. VDD33                              W5. VDD33                   AF11. VSS_IO
                E22. P1_DVSS                            W22. VDD33                  AF12. PB_D[49]
                E23. P1_AD[62]                          W23. P1_AD[30]              AF13. PO_RST_
                E24. P1_AD[38]                          W24. P1_AD[29]              AF14. PB_D[25]
                E25. P1_AD[55]                          W25. P1_AD[28]              AF15. PB_RST_
                E26. PCI_REQ[6]_                        W26. PCI_REQ[7]_            AF16. VSS_IO
                F1. VSS_IO                              Y1. PB_D[52]                AF17. PB_D[16]
                F2. PB_BR2_                             Y2. PB_D[20]                AF18. INT[0]_
                F3. NC                                  Y3. PB_TEST1                AF19. VSS_IO
                F4. PB_A[6]                             Y4. PB_D[13]                AF20. PB_D[4]
                F5. VDD33                               Y5. VDD33                   AF21. VSS_IO
                F22. VDD33                              Y22. VDD33                  AF22. NC
                F23. P1_ACK64_                          Y23. VSS                    AF23. NC
                F24. P1_AD[0]                           Y24. P1_DEVSEL_             AF24. NC
                F25. P1_REQ64_                          Y25. P1_TRDY_               AF25. VSS_IO
                F26. VSS_IO                             Y26. VSS_IO                 AF26. VSS_IO
11.3.3          Single PCI PowerSpan II 484 HSBGA
                Figure 27 illustrates the top, side, and bottom views of the PowerSpan II package.
                Table 63: Package Characteristics
                             Feature                                        Description
                 Package Type                        484 HSBGA
                 Package Body Size                   23mm
                 JEDEC Specification                 JEDEC MS-034 Variation AAJ-1
Integrated Device Technology                                                                   PowerSpan II User Manual
www.idt.com                                                                                        80A1010_MA001_09


228                                                                                 11. Signals and Pinout
Figure 27: 484 PBGA
11.3.3.1      Package Notes
              1. All dimensions in mm
              2. All dimensions and tolerance conform to ANSI Y14.5M - 1994
              3. Conforms to JEDEC MS-034 Variation AAJ-1
PowerSpan II User Manual                                                    Integrated Device Technology
80A1010_MA001_09                                                                             www.idt.com


11. Signals and Pinout                                                                                      229
11.3.3.2        484 PBGA Pin Information
                The following table shows the PowerSpan II 484 PBGA pin information.
                A1. PB_A[6]                    H9. VSS_IO                  R17. VDD33
                A2. PB_A[13]                   H10. VSS_IO                 R18. VDD25
                A3. TE                         H11. VSS_IO                 R19. P1_AD[22]
                A4. JT_TMS                     H12. VSS_IO                 R20. P1_AD[17]
                A5. PB_A[20]                   H13. VSS_IO                 R21. P1_AD[5]
                A6. JT_TCK                     H14. VSS_IO                 R22. P1_PERR_
                A7. PB_A[24]                   H15. VSS_IO                 T1. PB_TEST2
                A8. PB_A[30]                   H16. VSS                    T2. PB_D[21]
                A9. PB_A[27]                   H17. VDD33                  T3. PB_D[52]
                A10. PB_DBG2_                  H18. VDD25                  T4. JT_TRST_
                A11. PB_GBL_                   H19. PCI_REQ[5]_            T5. VDD25
                A12. P1_AD[34]                 H20. P1_AD[0]               T6. VDD33
                A13. P1_AD[32]                 H21. P1_REQ64_              T7. VSS
                A14. P1_AD[40]                 H22. P1_AD[8]               T8. VSS
                A15. P1_AD[48]                 J1. PB_TSIZ[2]              T9. VSS
                A16. P1_AD[53]                 J2. PB_TBST_                T10. VSS
                A17. P1_AD[52]                 J3. PB_ARTRY_               T11. VSS
                A18. P1_AD[58]                 J4. PB_BG1_                 T12. VSS
                A19. P1_AD[60]                 J5. VDD25                   T13. VSS
                A20. P1_PAR64                  J6. VDD33                   T14. VSS
                A21. ENUM_                     J7. VSS                     T15. VSS
                A22. VSS_IO                    J8. VSS_IO                  T16. VSS
                B1. PB_RST_DIR                 J9. VSS_IO                  T17. VDD33
                B2. ES                         J10. VSS_IO                 T18. VDD25
                B3. PB_A[14]                   J11. VSS_IO                 T19. P1_AD[25]
                B4. PB_A[12]                   J12. VSS_IO                 T20. P1_AD[18]
                B5. JT_TDO                     J13. VSS_IO                 T21. P1_STOP_
                B6. PB_A[22]                   J14. VSS_IO                 T22. P1_AD[19]
                B7. PB_A[21]                   J15. VSS_IO                 U1. PB_D[20]
Integrated Device Technology                                                            PowerSpan II User Manual
www.idt.com                                                                                 80A1010_MA001_09


230                                                               11. Signals and Pinout
              B8. PB_A[28]    J16. VSS         U2. PB_D[45]
              B9. PB_A[31]    J17. VDD33       U3. PB_D[36]
              B10. PB_BR1_    J18. VDD25       U4. PB_D[43]
              B11. P1_AD[35]  J19. PCI_REQ[6]_ U5. VDD25
              B12. P1_AD[37]  J20. P1_CBE[0]_  U6. VDD33
              B13. P1_AD[43]  J21. P1_AD[4]    U7. VDD33
              B14. P1_AD[39]  J22. P1_AD[9]    U8. VDD33
              B15. P1_AD[47]  K1. PB_AP[2]     U9. VDD33
              B16. P1_AD[49]  K2. PB_AP[3]     U10. VDD33
              B17. P1_AD[57]  K3. PB_TSIZ[0]   U11. VDD33
              B18. P1_AD[56]  K4. PB_AACK_     U12. VDD33
              B19. P1_CBE[6]_ K5. VDD25        U13. VDD33
              B20. P1_AD[59]  K6. VDD33        U14. VDD33
              B21. VSS_IO     K7. VSS          U15. VDD33
              B22. P1_VDDA    K8. VSS_IO       U16. VDD33
              C1. PB_A[11]    K9. VSS_IO       U17. VDD33
              C2. PB_BR2_     K10. VSS_IO      U18. VDD25
              C3. VSS_IO      K11. VSS_IO      U19. PCI_REQ[7]_
              C4. JT_TDI      K12. VSS_IO      U20. P1_AD[21]
              C5. PB_A[15]    K13. VSS_IO      U21. P1_AD[16]
              C6. PB_A[16]    K14. VSS_IO      U22. P1_IRDY_
              C7. PB_A[18]    K15. VSS_IO      V1. PB_D[5]
              C8. PB_A[25]    K16. VSS         V2. INT[5]_
              C9. P1_RST_DIR  K17. VDD33       V3. PB_D[44]
              C10. PB_DBG1_   K18. VDD25       V4. PB_D[37]
              C11. P1_AD[33]  K19. P1_AD[1]    V5. PB_TEA_
              C12. P1_AD[41]  K20. P1_AD[7]    V6. PB_D[35]
              C13. P1_AD[44]  K21. P1_AD[12]   V7. VDD25
              C14. P1_SERR_   K22. P1_AD[3]    V8. VDD25
              C15. P1_AD[50]  L1. I2C_SCLK     V9. VDD25
              C16. P1_AD[51]  L2. PB_AP[1]     V10. VDD25
PowerSpan II User Manual                                  Integrated Device Technology
80A1010_MA001_09                                                           www.idt.com


11. Signals and Pinout                                                            231
                C17. P1_REQ[3]_ L3. PB_TSIZ[1]   V11. VDD25
                C18. P1_AD[63]  L4. PB_TS_       V12. VDD25
                C19. P1_AD[61]  L5. VDD25        V13. VDD25
                C20. VSS_IO     L6. VDD33        V14. VDD25
                C21. P1_DVSS    L7. VSS          V15. VDD25
                C22. P1_AVSS    L8. VSS_IO       V16. VDD25
                D1. PB_A[2]     L9. VSS_IO       V17. VDD25
                D2. PB_A[8]     L10. VSS_IO      V18. VDD25
                D3. PB_DBG3_    L11. VSS_IO      V19. P1_DEVSEL_
                D4. VSS_IO      L12. VSS_IO      V20. P1_CBE[3]_
                D5. PB_A[10]    L13. VSS_IO      V21. P1_AD[20]
                D6. PB_A[17]    L14. VSS_IO      V22. P1_TEST1
                D7. PB_A[19]    L15. VSS_IO      W1. PB_D[60]
                D8. PB_A[23]    L16. VSS         W2. PB_D[53]
                D9. PB_A[26]    L17. VDD33       W3. PB_D[13]
                D10. PB_A[29]   L18. VDD25       W4. VSS_IO
                D11. VDD25      L19. VDD25       W5. PB_BG2_
                D12. P1_AD[45]  L20. P1_TEST2    W6. INT[1]_
                D13. P1_M66EN   L21. P1_INTA_    W7. INT[2]_
                D14. P1_AD[54]  L22. PCI_GNT[5]_ W8. PB_D[61]
                D15. P1_REQ[4]_ M1. PB_D[47]     W9. PB_D[42]
                D16. P1_IDSEL   M2. PB_TA_       W10. PB_D[59]
                D17. P1_CBE[7]_ M3. PB_AP[0]     W11. PB_D[18]
                D18. P1_CBE[5]_ M4. VDD25        W12. VDD25
                D19. VSS_IO     M5. VDD25        W13. PB_D[48]
                D20. P1_CLK     M6. VDD33        W14. PB_D[56]
                D21. P1_DVDD    M7. VSS          W15. PB_DP[2]
                D22. PB_CI_     M8. VSS_IO       W16. PB_D[63]
                E1. INT[4]_     M9. VSS_IO       W17. PB_D[8]
                E2. PB_A[1]     M10. VSS_IO      W18. PCI_GNT[7]_
                E3. PB_A[5]     M11. VSS_IO      W19. VDD25
Integrated Device Technology                                  PowerSpan II User Manual
www.idt.com                                                       80A1010_MA001_09


232                                                              11. Signals and Pinout
              E4. PB_A[7]     M12. VSS_IO      W20. P1_AD[27]
              E5. VSS_IO      M13. VSS_IO      W21. P1_AD[26]
              E6. VDD25       M14. VSS_IO      W22. P1_AD[24]
              E7. VDD25       M15. VSS_IO      Y1. PB_D[12]
              E8. VDD25       M16. VSS         Y2. PB_D[28]
              E9. VDD25       M17. VDD33       Y3. VSS_IO
              E10. VDD25      M18. VDD25       Y4. PB_DVSS
              E11. VDD25      M19. P1_AD[10]   Y5. PB_D[31]
              E12. VDD25      M20. P1_AD[13]   Y6. PB_D[3]
              E13. VDD25      M21. P1_AD[11]   Y7. PB_D[11]
              E14. VDD25      M22. P1_GNT[4]_  Y8. PB_D[51]
              E15. VDD25      N1. PB_D[7]      Y9. PB_D[27]
              E16. VDD25      N2. PB_D[6]      Y10. PB_D[10]
              E17. VDD25      N3. PB_D[22]     Y11. PB_D[58]
              E18. P1_CBE[4]_ N4. PB_D[46]     Y12. PB_D[41]
              E19. P1_GNT[1]_ N5. VDD25        Y13. PB_RSTCONF_
              E20. P1_AD[46]  N6. VDD33        Y14. PB_D[1]
              E21. P1_AD[42]  N7. VSS          Y15. P2_TEST1
              E22. P1_ACK64_  N8. VSS_IO       Y16. PB_D[16]
              F1. PB_A[0]     N9. VSS_IO       Y17. PB_DP[3]
              F2. PB_TT[2]    N10. VSS_IO      Y18. PB_DP[0]
              F3. PB_A[4]     N11. VSS_IO      Y19. PB_DP[1]
              F4. PB_A[9]     N12. VSS_IO      Y20. P1_TRDY_
              F5. VDD25       N13. VSS_IO      Y21. P1_AD[23]
              F6. VSS_IO      N14. VSS_IO      Y22. P1_AD[28]
              F7. VDD33       N15. VSS_IO      AA1. INT[3]_
              F8. VDD33       N16. VSS         AA2. VSS_IO
              F9. VDD33       N17. VDD33       AA3. PB_AVSS
              F10. VDD33      N18. VDD25       AA4. PB_CLK
              F11. VDD33      N19. P1_CBE[2]_  AA5. PB_D[38]
              F12. VDD33      N20. PCI_GNT[6]_ AA6. PB_D[14]
PowerSpan II User Manual                                 Integrated Device Technology
80A1010_MA001_09                                                          www.idt.com


11. Signals and Pinout                                                            233
                F13. VDD33      N21. P1_AD[15]  AA7. PB_DVAL_
                F14. VDD33      N22. P1_PAR     AA8. PB_ABB_
                F15. VDD33      P1. PB_D[30]    AA9. PB_D[50]
                F16. VDD33      P2. PB_D[55]    AA10. PB_D[34]
                F17. VDD33      P3. PB_D[54]    AA11. PB_D[2]
                F18. P1_REQ[1]_ P4. PB_D[23]    AA12. PB_D[49]
                F19. P1_GNT[2]_ P5. VDD25       AA13. PO_RST_
                F20. P1_AD[62]  P6. VDD33       AA14. PB_D[17]
                F21. P1_AD[36]  P7. VSS         AA15. PB_RST_
                F22. P1_AD[38]  P8. VSS_IO      AA16. PB_D[40]
                G1. PB_TT[1]    P9. VSS_IO      AA17. INT[0]_
                G2. PB_TT[0]    P10. VSS_IO     AA18. PB_DP[4]
                G3. PB_BR3_     P11. VSS_IO     AA19. PB_DP[5]
                G4. PB_A[3]     P12. VSS_IO     AA20. PB_D[32]
                G5. VDD25       P13. VSS_IO     AA21. P1_AD[30]
                G6. VDD33       P14. VSS_IO     AA22. P1_AD[29]
                G7. VSS_IO      P15. VSS_IO     AB1. VSS_IO
                G8. VSS         P16. VSS        AB2. PB_VDDA
                G9. VSS         P17. VDD33      AB3. PB_DVDD
                G10. VSS        P18. VDD25      AB4. PB_D[39]
                G11. VSS        P19. P1_AD[2]   AB5. PB_DBB_
                G12. VSS        P20. P1_CBE[1]_ AB6. LED_
                G13. VSS        P21. P1_FRAME_  AB7. PB_D[15]
                G14. VSS        P22. P1_AD[14]  AB8. PB_D[19]
                G15. VSS        R1. PB_D[62]    AB9. I2C_SDA
                G16. VSS        R2. PB_BG3_     AB10. PB_D[26]
                G17. VDD33      R3. PB_D[29]    AB11. PB_D[57]
                G18. P1_GNT[3]_ R4. PB_TEST1    AB12. PB_D[33]
                G19. P1_64EN_   R5. VDD25       AB13. PB_D[25]
                G20. P1_AD[6]   R6. VDD33       AB14. PB_D[9]
                G21. P1_AD[55]  R7. VSS         AB15. PB_FAST
Integrated Device Technology                                  PowerSpan II User Manual
www.idt.com                                                       80A1010_MA001_09


234                                                        11. Signals and Pinout
              G22. P1_REQ[2]_ R8. VSS_IO  AB16. PB_D[24]
              H1. PB_TT[4]    R9. VSS_IO  AB17. PB_DP[7]
              H2. PB_TSIZ[3]  R10. VSS_IO AB18. PB_DP[6]
              H3. HEALTHY_    R11. VSS_IO AB19. PB_D[4]
              H4. PB_TT[3]    R12. VSS_IO AB20. PB_D[0]
              H5. VDD25       R13. VSS_IO AB21. P1_RST_
              H6. VDD33       R14. VSS_IO AB22. P1_AD[31]
              H7. VSS         R15. VSS_IO
              H8. VSS_IO      R16. VSS
PowerSpan II User Manual                           Integrated Device Technology
80A1010_MA001_09                                                    www.idt.com


                                                                                                                       235
12.             Register Descriptions
                This chapter describes the registers used in PowerSpan II. It describes the register settings and bits
                which enable PowerSpan II features and functionality. The following topics are discussed:
                •   “Register Access” on page 235
                •   “Register Reset” on page 245
                •   “Configuration and IACK Cycle Generation” on page 246
                •   “Register Descriptions” on page 248
12.1            Register Access
                The PowerSpan II registers can be accessed from both PCI and the processor bus. PowerSpan II allows
                reads to its registers from all of its bus interfaces at the same time. However, writes may occur from
                only one bus interface at a time.
12.1.1          Register Map
                The 4 Kbytes of PowerSpan II Control and Status Registers (PCSR) are used for PCI Control and
                Status Registers (CSRs), and for overall PowerSpan II operation. The PCSR space is functionally
                divided into two areas: the PCI CSR space and the PowerSpan II PCSR space. PSCR space is
                accessible from the Processor Bus, PCI-1 or PCI-2 interfaces.
                Table 64 is a detailed memory map for PCSR space and shows the PowerSpan II register map for the
                Dual PCI PowerSpan II. PowerSpan II is available as both the Single PCI PowerSpan II and Dual PCI
                PowerSpan II.
                The shaded registers under PCI-1 Configuration and PCI-2 Configuration registers exist only if the
                associated PCI Interface is configured as the Primary Interface. A interface is configured as Primary
                using a power-up option (see “Resets, Clocks and Power-up Options” on page 167 for more
                information). The PCI Interface that is designated as Primary has added functionality which includes
                CompactPCI Hot Swap support, Vital Product Data support and an I2C Interface. Refer to“PCI
                Interface” on page 31 for more information on Primary Interface functionality.
Table 64: PowerSpan II Register Map
      Offset            Register Mnemonic                                              See
 PCI-1 Configuration Registers
 0x000             P1_ID                             “PCI-1 ID Register” on page 250
 0x004             P1_CSR                            “PCI-1 Control and Status Register.” on page 251
Integrated Device Technology                                                                       PowerSpan II User Manual
www.idt.com                                                                                            80A1010_MA001_09


236                                                                                      12. Register Descriptions
Table 64: PowerSpan II Register Map
     Offset           Register Mnemonic                                     See
 0x008            P1_CLASS              “PCI-1 Class Register” on page 254
 0x00C            P1_MISC0              “PCI-1 Miscellaneous 0 Register” on page 255
 0x010            P1_BSI2O              “PCI-1 I2O Target Image Base Address Register” on page 257
 0x014            P1_BSREG              “PCI-1 Register Image Base Address Register” on page 258
 0x018            P1_BST0               “PCI Target Base Address Register” on page 259
 0x01C            P1_BST1               “PCI Target Base Address Register” on page 259
 0x020            P1_BST2               “PCI Target Base Address Register” on page 259
 0x024            P1_BST3               “PCI Target Base Address Register” on page 259
 0x028            PCI Unimplemented
 0x02C            P1_SID                “PCI System ID Register” on page 260
 0x030            PCI Unimplemented
 0x034            P1_CAP                “PCI-1 Capability Pointer Register” on page 261
 0x038            PCI Unimplemented
 0x03C            P1_MISC1              “PCI-1 Miscellaneous 1 Register” on page 262
 0x040- 0x0E0     PCI Unimplemented
 0x0E4            P1_HS_CSR             “PCI-1 Compact PCI Hot Swap Control and Status Register” on page 264
 0x0E8            P1_VPDC               “PCI-1 Vital Product Data Capability Register” on page 266
 0x0EC            P1_VPDD               “PCI-1 Vital Product Data Register” on page 267
 0x0F0-0x0FC      PCI Unimplemented
 PCI-1 Registers
 0x100            P1_TI0_CTL            “PCI-1 Target Image x Control Register” on page 268
 0x104            P1_TI0_TADDR          “PCI-1 Target Image x Translation Address Register” on page 274
 0x108-0x10C      PowerSpan II Reserved
 0x110            P1_TI1_CTL            “PCI-1 Target Image x Control Register” on page 268
 0x114            P1_TI1_TADDR          “PCI-1 Target Image x Translation Address Register” on page 274
 0x118-0x11C      PowerSpan II Reserved
 0x120            P1_TI2_CTL            “PCI-1 Target Image x Control Register” on page 268
PowerSpan II User Manual                                                           Integrated Device Technology
80A1010_MA001_09                                                                                     www.idt.com


12. Register Descriptions                                                                                       237
Table 64: PowerSpan II Register Map
      Offset            Register Mnemonic                                    See
 0x124             P1_TI2_TADDR           “PCI-1 Target Image x Translation Address Register” on page 274
 0x128-0x12C       PowerSpan II Reserved
 0x130             P1_TI3_CTL             “PCI-1 Target Image x Control Register” on page 268
 0x134             P1_TI3_TADDR           “PCI-1 Target Image x Translation Address Register” on page 274
 0x138-0x140       PowerSpan II Reserved
 0x144             P1_CONF_INFO           “PCI-1 to PCI-2 Configuration Cycle Information Register” on page 276
 0x148             P1_CONF_DATA           “PCI-1 to PCI-2 Configuration Cycle Data Register” on page 279
 0x14C             P1_IACK                “PCI-1 to PCI-2 Interrupt Acknowledge Cycle Generation Register” on
                                          page 280
 0x150             P1_ERRCS               “PCI-1 Bus Error Control and Status Register” on page 281
 0x154             P1_AERR                “PCI-1 Address Error Log Register” on page 282
 0x158-0x15C       PowerSpan II Reserved
 0x160             P1_MISC_CSR            “PCI-1 Miscellaneous Control and Status Register” on page 283
 0x164             P1_ARB_CTRL            “PCI-1 Bus Arbiter Control Register” on page 284
 0x168-0x1FC       PowerSpan II Reserved
 Processor Bus Registers
 0x200             PB_SI0_CTL             “Processor Bus Slave Image x Control Register” on page 287
 0x204             PB_SI0_TADDR           “Processor Bus Slave Image x Translation Address Register” on page 292
 0x208             PB_SI0_BADDR           “Processor Bus Slave Image x Base Address Register” on page 294
 0x20C             PowerSpan II Reserved
 0x210             PB_SI1_CTL             “Processor Bus Slave Image x Control Register” on page 287
 0x214             PB_SI1_TADDR           “Processor Bus Slave Image x Translation Address Register” on page 292
 0x218             PB_SI1_BADDR           “Processor Bus Slave Image x Base Address Register” on page 294
 0x21C             PowerSpan II Reserved
 0x220             PB_SI2_CTL             “Processor Bus Slave Image x Control Register” on page 287
 0x224             PB_SI2_TADDR           “Processor Bus Slave Image x Translation Address Register” on page 292
 0x228             PB_SI2_BADDR           “Processor Bus Slave Image x Base Address Register” on page 294
 0x22C             PowerSpan II Reserved
Integrated Device Technology                                                            PowerSpan II User Manual
www.idt.com                                                                                   80A1010_MA001_09


238                                                                                    12. Register Descriptions
Table 64: PowerSpan II Register Map
     Offset          Register Mnemonic                                     See
 0x230            PB_SI3_CTL            “Processor Bus Slave Image x Control Register” on page 287
 0x234            PB_SI3_TADDR          “Processor Bus Slave Image x Translation Address Register” on page 292
 0x238            PB_SI3_BADDR          “Processor Bus Slave Image x Base Address Register” on page 294
 0x23C            PowerSpan II Reserved
 0x240            PB_SI4_CTL            “Processor Bus Slave Image x Control Register” on page 287
 0x244            PB_SI4_TADDR          “Processor Bus Slave Image x Translation Address Register” on page 292
 0x248            PB_SI4_BADDR          “Processor Bus Slave Image x Base Address Register” on page 294
 0x24C            PowerSpan II Reserved
 0x250            PB_SI5_CTL            “Processor Bus Slave Image x Control Register” on page 287
 0x254            PB_SI5_TADDR          “Processor Bus Slave Image x Translation Address Register” on page 292
 0x258            PB_SI5_BADDR          “Processor Bus Slave Image x Base Address Register” on page 294
 0x25C            PowerSpan II Reserved
 0x260            PB_SI6_CTL            “Processor Bus Slave Image x Control Register” on page 287
 0x264            PB_SI6_TADDR          “Processor Bus Slave Image x Translation Address Register” on page 292
 0x268            PB_SI6_BADDR          “Processor Bus Slave Image x Base Address Register” on page 294
 0x26C            PowerSpan II Reserved
 0x270            PB_SI7_CTL            “Processor Bus Slave Image x Control Register” on page 287
 0x274            PB_SI7_TADDR          “Processor Bus Slave Image x Translation Address Register” on page 292
 0x278            PB_SI7_BADDR          “Processor Bus Slave Image x Base Address Register” on page 294
 0x27C            PowerSpan II Reserved
 0x280            PB_REG_BADDR          “Processor Bus Register Image Base Address Register” on page 295
 0x284-0x28C      PowerSpan II Reserved
 0x290            PB_CONF_INFO          “Processor Bus PCI Configuration Cycle Information Register” on
                                        page 296
 0x294            PB_CONF_DATA          “Processor Bus Configuration Cycle Data Register” on page 299
 0x298-0x29C      PowerSpan II Reserved
 0x2A0            PB_P1_IACK            “Processor Bus to PCI-1 Interrupt Acknowledge Cycle Generation
                                        Register” on page 300
PowerSpan II User Manual                                                          Integrated Device Technology
80A1010_MA001_09                                                                                    www.idt.com


12. Register Descriptions                                                                                     239
Table 64: PowerSpan II Register Map
      Offset            Register Mnemonic                                    See
 0x2A4             PB_P2_IACK             “Processor Bus to PCI-2 Interrupt Acknowledge Cycle Generation
                                          Register” on page 301
 0x2A8-0x2AC       PowerSpan II Reserved
 0x2B0             PB_ERRCS               “Processor Bus Error Control and Status Register” on page 302
 0x2B4             PB_AERR                “Processor Bus Address Error Log” on page 303
 0x2B8-0x2BC       PowerSpan II Reserved
 0x2C0             PB_MISC_CSR            “Processor Bus Miscellaneous Control and Status Register” on page 304
 0x2C4-0x2CC       PowerSpan II Reserved
 0x2D0             PB_ARB_CTRL            “Processor Bus Arbiter Control Register” on page 307
 0x2D4-0x2FC       PowerSpan II Reserved
 DMA Registers
 0x300             PowerSpan II Reserved
 0x304             DMA0_SRC_ADDR          “DMA x Source Address Register” on page 309
 0x308             PowerSpan II Reserved
 0x30C             DMA0_DST_ADDR          “DMA x Destination Address Register” on page 310
 0x310             PowerSpan II Reserved
 0x314             DMA0_TCR               “DMA x Transfer Control Register” on page 311
 0x318             PowerSpan II Reserved
 0x31C             DMA0_CPP               “DMA x Command Packet Pointer Register” on page 313
 0x320             DMA0_GCSR              “DMA x General Control and Status Register” on page 314
 0x324             DMA0_ATTR              “DMA x Attributes Register” on page 317
 0x328-0x330       PowerSpan II Reserved
 0x334             DMA1_SRC_ADDR          “DMA x Source Address Register” on page 309
 0x338             PowerSpan II Reserved
 0x33C             DMA1_DST_ADDR          “DMA x Destination Address Register” on page 310
 0x340             PowerSpan II Reserved
 0x344             DMA1_TCR               “DMA x Transfer Control Register” on page 311
 0x348             PowerSpan II Reserved
Integrated Device Technology                                                            PowerSpan II User Manual
www.idt.com                                                                                   80A1010_MA001_09


240                                                                                     12. Register Descriptions
Table 64: PowerSpan II Register Map
     Offset           Register Mnemonic                                   See
 0x34C            DMA1_CPP              “DMA x Command Packet Pointer Register” on page 313
 0x350            DMA1_GCSR             “DMA x General Control and Status Register” on page 314
 0x354            DMA1_ATTR             “DMA x Attributes Register” on page 317
 0x358-0x360      PowerSpan II Reserved
 0x364            DMA2_SRC_ADDR         “DMA x Source Address Register” on page 309
 0x368            PowerSpan II Reserved
 0x36C            DMA2_DST_ADDR         “DMA x Destination Address Register” on page 310
 0x370            PowerSpan II Reserved
 0x374            DMA2_TCR              “DMA x Transfer Control Register” on page 311
 0x378            PowerSpan II Reserved
 0x37C            DMA2_CPP              “DMA x Command Packet Pointer Register” on page 313
 0x380            DMA2_GCSR             “DMA x General Control and Status Register” on page 314
 0x384            DMA2_ATTR             “DMA x Attributes Register” on page 317
 0x388-0x390      PowerSpan II Reserved
 0x394            DMA3_SRC_ADDR         “DMA x Source Address Register” on page 309
 0x398            PowerSpan II Reserved
 0x39C            DMA3_DST_ADDR         “DMA x Destination Address Register” on page 310
 0x3A0            PowerSpan II Reserved
 0x3A4            DMA3_TCR              “DMA x Transfer Control Register” on page 311
 0x3A8            PowerSpan II Reserved
 0x3AC            DMA3_CPP              “DMA x Command Packet Pointer Register” on page 313
 0x3B0            DMA3_GCSR             “DMA x General Control and Status Register” on page 314
 0x3B4            DMA3_ATTR             “DMA x Attributes Register” on page 317
 0x3B8-0x3FC      PowerSpan II Reserved
 Miscellaneous Registers
 0x400            MISC_CSR              “Miscellaneous Control and Status Register” on page 318
 0x404            CLOCK_CTL             “Clock Control Register” on page 321
PowerSpan II User Manual                                                          Integrated Device Technology
80A1010_MA001_09                                                                                    www.idt.com


12. Register Descriptions                                                                                   241
Table 64: PowerSpan II Register Map
      Offset            Register Mnemonic                                     See
 0x408             I2C_CSR                “I2C/EEPROM Interface Control and Status Register” on page 322
 0x40C             RST_CSR                “Reset Control and Status Register” on page 324
 0x410             ISR0                   “Interrupt Status Register 0” on page 327
 0x414             ISR1                   “Interrupt Status Register 1” on page 329
 0x418             IER0                   “Interrupt Enable Register 0” on page 332
 0x41C             IER1                   “Interrupt Enable Register 1” on page 334
 0x420             IMR_MBOX               “Interrupt Map Register Mail Box” on page 337
 0x424             IMR_DB                 “Interrupt Map Register Doorbell” on page 339
 0x428             IMR_DMA                “Interrupt Map Register DMA” on page 340
 0x42C             IMR_HW                 “Interrupt Map Register Hardware” on page 341
 0x430             IMR_P1                 “Interrupt Map Register PCI-1” on page 342
 0x434             IMR_P2                 “Interrupt Map Register PCI-2” on page 343
 0x438             IMR_PB                 “Interrupt Map Register Processor Bus” on page 344
 0x43C             IMR2_PB                “Interrupt Map Register Two Processor Bus” on page 345
 0x440             IMR_MISC               “Interrupt Map Register Miscellaneous” on page 346
 0x444             IDR                    “Interrupt Direction Register” on page 347
 0x448-0x44C       PowerSpan II Reserved
 0x450             MBOX0                  “Mailbox x Register” on page 349
 0x454             MBOX1                  “Mailbox x Register” on page 349
 0x458             MBOX2                  “Mailbox x Register” on page 349
 0x45C             MBOX3                  “Mailbox x Register” on page 349
 0x460             MBOX4                  “Mailbox x Register” on page 349
 0x464             MBOX5                  “Mailbox x Register” on page 349
 0x468             MBOX6                  “Mailbox x Register” on page 349
 0x46C             MBOX7                  “Mailbox x Register” on page 349
 0x470             SEMA0                  “Semaphore 0 Register” on page 350
 0x474             SEMA1                  “Semaphore 1 Register” on page 351
Integrated Device Technology                                                            PowerSpan II User Manual
www.idt.com                                                                                  80A1010_MA001_09


242                                                                                                           12. Register Descriptions
Table 64: PowerSpan II Register Map
      Offset             Register Mnemonic                                                     See
 0x478-0x4FC        PowerSpan II Reserved
 I2O Registers
 0x500              PCI_TI2O_CTL                         “PCI I2O Target Image Control Register” on page 352
 0x504              PCI_TI2O_TADDR                       “PCI I2O Target Image Translation Address Register” on page 356
 0x508              I2O_CSR                              “I2O Control and Status Register” on page 357
 0x50C              I2O_QUEUE_BS                         “I2O Queue Base Address Register” on page 360
 0x510              IFL_BOT                              “I2O Inbound Free List Bottom Pointer Register” on page 362
 0x514              IFL_TOP                              “I2O Inbound Free List Top Pointer Register” on page 363
 0x518              IFL_TOP_INC                          “Inbound Free List Top Pointer Increment Register” on page 364
 0x51C              IPL_BOT                              “I2O Inbound Post List Bottom Pointer Register” on page 365
 0x520              IPL_BOT_INC                          “I2O Inbound Post List Bottom Pointer Increment Register” on page 366
 0x524              IPL_TOP                              “I2O Inbound Post List Top Pointer Register” on page 367
 0x528              OFL_BOT                              “I2O Outbound Free List Bottom Pointer Register” on page 368
 0x52C              OFL_BOT_INC                          “I2O Outbound Free List Bottom Pointer Increment Register” on page 369
 0x530              OFL_TOP                              “I2O Outbound Free List Top Pointer Register” on page 370
 0x534              OPL_BOT                              “I2O Outbound Post List Bottom Pointer Register” on page 371
 0x538              OPL_TOP                              “I2O Outbound Post List Top Pointer Register” on page 372
 0x53C              OPL_TOP_INC                          “I2O Outbound Post List Top Pointer Increment Register” on page 373
 0x540              HOST_OIO                             “I2O Host Outbound Index Offset Register” on page 374
 0x544              HOST_OIA                             “I2O Host Outbound Index Alias Register” on page 375
 0x548              IOP_OI                               “I2O IOP Outbound Index Register” on page 376
 0x54C              IOP_OI_INC                           “I2O IOP Outbound Index Increment Register” on page 377
 0x550-0x7FC        PowerSpan II Reserved
 PCI-2 Configuration Registers (Dual PCI PowerSpan II)
 The PCI-2 Configuration Registers are functionally identical to the PCI-1 Configuration Registers from offsets 0x000-0FC.
 Documentation of the PCI-2 Configuration Space is the same as the PCI-1 Interface, shifting the register offsets up by 0x800 and
 swapping PCI-1 and PCI-2 everywhere.
 0x800              P2_ID                                PCI-2 ID Register
PowerSpan II User Manual                                                                                Integrated Device Technology
80A1010_MA001_09                                                                                                           www.idt.com


12. Register Descriptions                                                                                                   243
Table 64: PowerSpan II Register Map
      Offset              Register Mnemonic                                              See
 0x804               P2_CSR                         PCI-2 Control and Status Register
 0x808               P2_CLASS                       PCI-2 Class Register
 0x80C               P2_MISC0                       PCI-2 Miscellaneous 0 Register
 0x810               P2_BSI2O                       PCI-2 I2O Target Image Base Address Register
 0x814               P2_BSREG                       PCI-2 Register Image Base Address Register
 0x818               P2_BST0                        PCI-2 Target Image 0 Base Address Register
 0x81C               P2_BST1                        PCI-2 Target Image 1 Base Address Register
 0x820               P2_BST2                        PCI-2 Target Image 2 Base Address Register
 0x824               P2_BST3                        PCI-2 Target Image 3 Base Address Register
 0x828               PCI Unimplemented
 0x82C               P2_SID                         PCI-2 Subsystem ID Register
 0x830               PCI Unimplemented
 0x834               P2_CAP                         PCI-2 Capability Pointer Register
 0x838               PCI Unimplemented
 0x83C               P2_MISC1                       PCI-2 Miscellaneous 1 Register
 0x840-0x8E0         PCI Unimplemented
 0x8E4               P2_HS_CSR                      PCI-2 Compact PCI Hot Swap Control and Status Register
 0x8E8               P2_VPDC                        PCI-2 Vital Product Data Capability Register
 0x8EC               P2_VPDD                        PCI-2 Vital Product Data Register
 0x8F0-0x8FC         PCI Unimplemented
 PCI-2 Registers (Dual PCI PowerSpan II)
 The PCI-2 Target Image Control and Status Registers are functionally identical to the PCI-1 Target Image Control and Status
 Registers from offsets 0x100-1FC. Documentation of the PCI-2 Target Images is the same as the PCI-1 Images, shifting the
 register offsets up by 0x800 and swapping PCI-1 and PCI-2 everywhere.
 0x900               P2_TI0_CTL                     PCI-2 Target Image 0 Control Register
 0x904               P2_TI0_TADDR                   PCI-2 Target Image 0 Translation Address Register
 0x908-0x90C         PowerSpan II Reserved
 0x910               P2_TI1_CTL                     PCI-2 Target Image 1 Control Register
 0x914               P2_TI1_TADDR                   PCI-2 Target Image 1 Translation Address Register
Integrated Device Technology                                                                         PowerSpan II User Manual
www.idt.com                                                                                               80A1010_MA001_09


244                                                                                             12. Register Descriptions
Table 64: PowerSpan II Register Map
     Offset           Register Mnemonic                                            See
 0x918-0x91C      PowerSpan II Reserved
 0x920            P2_TI2_CTL                    PCI-2 Target Image 2 Control Register
 0x924            P2_TI2_TADDR                  PCI-2 Target Image 2 Translation Address Register
 0x928-0x92C      PowerSpan II Reserved
 0x930            P2_TI3_CTL                    PCI-2 Target Image 3 Control Register
 0x934            P2_TI3_TADDR                  PCI-2 Target Image 3 Translation Address Register
 0x938-0x940      PowerSpan II Reserved
 0x944            P2_CONF_INFO                  PCI-2 to PCI 1 Configuration Cycle Information Register
 0x948            P2_CONF_DATA                  PCI-2 to PCI 1 Configuration Cycle Data Register
 0x94C            P2_IACK                       PCI-2 to PCI 1 Interrupt Acknowledge Cycle Generation Register
 0x950            P2_ERRCS                      PCI-2 Bus Error Control and Status Register
 0x954            P2_AERR                       PCI-2 Address Error Log Register
 0x958-0x95C      PowerSpan II Reserved
 0x960            P2_MISC_CSR                   PCI-2 Miscellaneous Control and Status Register
 0x964            P2_ARB_CTRL                   PCI-2 Bus Arbiter Control Register
 0x968-0xFFC      PowerSpan II Reserved
12.1.2        Access from PCI
              The PCI-1 Register Image Base Address Register specifies the 4-Kbyte aligned base address for the
              PowerSpan II Control and Status Registers (PCSRs) in PCI Memory Space. The base address for PCSR
              space is enabled by:
              1. Setting the BSREG_BAR_EN bit in the P1_MISC_CS
              2. Writing to the P1_BSREG register either with a PCI Configuration write access or by writing to it
                   from the Processor Bus (PB).
              Once enabled, the PCSR space can be accessed in PCI Memory Space with single-beat 32-bit accesses.
PowerSpan II User Manual                                                                  Integrated Device Technology
80A1010_MA001_09                                                                                            www.idt.com


12. Register Descriptions                                                                                               245
12.1.3          Access from the Processor Bus
                The PB_REG_BADDR register specifies the 4-Kbyte aligned base address for PCSR space on the
                processor bus. This register is programmed through any register interface or through EEPROM.
                Register accesses through the Processor Bus Interface can be big-endian or PowerPC little-endian (see
                “Processor Bus and PowerSpan II Register Transfers” on page 179). The endian conversion for register
                accesses from the Processor Bus Interface is controlled with the END bit in the PB_REG_BADDR
                Register. The default mode is big-endian.
                The reset state for the base address for PCSR space on the processor bus is 0x3000_0000.
12.1.4          Access from Multiple Interfaces
                PowerSpan II allows reads to its registers from all of its bus interfaces at the same time. However,
                writes may occur from only one bus interface at a time. This prevents data corruption if two or more
                interfaces try to write to the same register simultaneously.
                               Register writes to “write 1 to set/clear” status bits may not be reflected by an
                               immediate register read.
                PowerSpan II uses an internal round robin arbitration mechanism for register access from the different
                bus interfaces. Register writes are retried until the interface doing the write has successfully arbitrated
                for register access.
                               Register accesses from all interfaces are retried during EEPROM load.
                Each PowerSpan II PCI Target has a Px Lockout (Px_LOCKOUT) bit in the “Miscellaneous Control
                and Status Register” on page 318 (MISC_CSR). While a lockout bit is set, the corresponding PCI
                Target retries all Configuration Type 0 transactions. When the Base Address registers have been
                configured, memory transactions are claimed, but they are retried until the lockout bit is cleared. By
                default the Px_LOCKOUT bits are set. The lockout bits can either be cleared by EEPROM load, or by
                an access from the Processor Bus Interface. The lockout bits are automatically cleared by PowerSpan II
                when the PWRUP_BOOT bit in the “Processor Bus Arbiter Control Register” on page 307 is set to
                PCI.
12.2            Register Reset
                The PCSR space is divided into four reset domains:
                •    PCI-1 CSR space
                •    PCI-2 CSR space
                •    Processor Bus Interface registers
                •    Device Specific registers
                See “Reset Response” on page 168 for a detailed description of register reset partitioning.
Integrated Device Technology                                                                     PowerSpan II User Manual
www.idt.com                                                                                            80A1010_MA001_09


246                                                                                           12. Register Descriptions
              When an EEPROM is detected by PowerSpan II’s I2C Interface after reset, certain registers are
              initialized with the contents of the EEPROM. See “I2C/EEPROM” on page 127 for details on which
              register fields are loaded through EEPROM.
12.3          Configuration and IACK Cycle Generation
              PowerSpan II has registers that must be programmed in order for a PCI master to generate
              configuration (Type 1 or 0) and IACK transactions on the alternate PCI Interface and for the processor
              bus to generate configuration (Type 1 or 0) and IACK transactions on either PCI bus.
12.3.1        From PCI-to-PCI
              The following PowerSpan II registers are used by a PCI master to generate configuration (Type 1 or 0)
              and IACK transactions on the alternate PCI Interface:
              •    Px_CONF_INFO/Px_CONF_DATA
              •    Px_IACK
12.3.1.1      PCI Configuration Data
              Generating a Configuration transaction on PCI requires the programming of the “PCI-1 to PCI-2
              Configuration Cycle Information Register” on page 276 (Px_CONF_INFO) in order set-up the address
              of the Configuration cycle. The PCI transaction is generated when a register access occurs on
              the“PCI-1 to PCI-2 Configuration Cycle Data Register” on page 279 (Px_CONF_DATA).
              When a register write is performed to Px_CONF_DATA, the address and data parameters in
              Px_CONF_DATA are used to generate a configuration transaction on the alternate PCI bus.
              When a register read is performed to Px_CONF_DATA, the read is retried while a configuration read
              transaction is generated on the alternate PCI bus. The address for the read transaction is defined by
              Px_CONF_INFO. While the data is being retrieved, register accesses to Px_CONF_DATA is retried.
              The Px_CONF_INFO and Px_CONF_DATA registers must be treated as shared resources for
              applications that require more than one agent to generate configuration transactions on PCI. A
              semaphore is used to control access.
12.3.1.2      Interrupt Acknowledge Generation
              The Px_IACK register is used to generate IACK reads on the alternate PCI bus. If a register read is
              performed to Px_IACK, then the read is retried while an IACK cycle is generated on the alternate PCI
              bus. The address for the IACK cycle is taken directly from the originating PCI bus.
              The Px_IACK register must be treated as shared resources for applications that require more than one
              agent to generate IACK transactions on PCI. A semaphore is used to control access.
                             Writes to Px_IACK have no effect.
PowerSpan II User Manual                                                                 Integrated Device Technology
80A1010_MA001_09                                                                                           www.idt.com


12. Register Descriptions                                                                                          247
12.3.2          From the Processor Bus to PCI
                The following PowerSpan II registers are used to generate Configuration (Type 1 or 0) and IACK
                transactions going from the Processor Bus Interface to either of the PCI Interfaces:
                •   PB_CONF_INFO/PB_CONF_DATA
                •   PB_Px_IACK
12.3.2.1        Processor Bus Configuration Data
                Generating a Configuration transaction on PCI requires the programming of the “PCI-1 to PCI-2
                Configuration Cycle Information Register” on page 276 (PB_CONF_INFO) to set-up the address of
                the Configuration cycle. The DEST bit selects the PCI bus for the configuration access. The PCI
                transaction is generated when the user performs a register access to the “PCI-1 to PCI-2 Configuration
                Cycle Data Register” on page 279 (PB_CONF_DATA).
                When a register write is performed to PB_CONF_DATA, the address and data parameters in
                PB_CONF_DATA are used to generate a Configuration transaction on the selected PCI bus.
                The Processor Bus Slave response to the read of PB_CONF_DATA is dependent on the state the
                Address Retry Enable (ARTRY_EN) bit of the “Processor Bus Miscellaneous Control and Status
                Register” on page 304. If ARTRY_EN is disabled, the Processor Bus slave claims the read of
                PB_CONF_DATA. The Processor Bus slave only asserts PB_TA_ to complete the transaction when the
                read data is returned from PCI. If ARTRY_EN is enabled, the read of PB_CONF_DATA is retried
                immediately. Subsequent register accesses to PB_CONF_DATA will be retried until the data is
                returned from PCI.
12.3.2.2        Interrupt Acknowledge Generation
                The PB_Px_IACK registers are used to generate IACK reads on the PCI interfaces.The address for the
                IACK cycle is taken directly from the processor bus.
                The Processor Bus slave response to the read of PB_Px_IACK is dependent on the state of the Address
                Retry Enable (ARTRY_EN) bit of the “Processor Bus Miscellaneous Control and Status Register” on
                page 304. If ARTRY_EN is disabled, the Processor Bus slave claims the read of PB_Px_IACK. The
                Processor Bus slave only asserts PB_TA_ to complete the transaction when the read data is returned
                from PCI. If ARTRY_EN is enabled, the read of PB_Px_IACK is retried immediately. Subsequent
                register accesses to PB_Px_IACK are retried until the data is returned from PCI.
                Applications that require more than one agent to generate IACK transactions on PCI must use a
                semaphore to control PB_P1_IACK and PB_P2_IACK.
                               Writes to PB_Px_IACK have no effect.
Integrated Device Technology                                                                  PowerSpan II User Manual
www.idt.com                                                                                         80A1010_MA001_09


248                                                                                               12. Register Descriptions
12.4           Bit Ordering and Endian Ordering
               The register tables in “Register Descriptions” on page 248 provide bit ordering in both PCI
               little-endian and PowerPC big-endian. The register table from the “PCI-1 Control and Status Register.”
               on page 251 is repeated here. The “PCI Bits” in the left hand column give the addressing of the register
               bits when the register is accessed from the PCI bus in little-endian mode. The “PB Bits” in the far right
               hand column give the addressing of the register bits when the register is accessed from the Processor
               Bus in big-endian mode.
               Please consult “Endian Mapping” on page 177 for a full endian discussion.
   PCI                                                                                                                PB
   Bits                                                  Function                                                    Bits
  31-24      D_PE           S_          R_MA         R_TA         S_TA             DEVSEL              MDP_D         0-7
                          SERR
  23-16     TFBBC            0         DEV66        CAP_L                       PCI Reserved                         8-15
  15-08                                   PCI Reserved                                    MFBBC      SERR_EN        16-23
  07-00      WAIT        PERESP        VGAPS         MWI_          SC          BM           MS           IOS        24-31
                                                      EN
                               Throughout the manual, register fields are given assuming PCI little-endian bit
                               ordering. The user must consult the register table to obtain the corresponding
                               PowerPC big-endian bit ordering.
12.5           Register Descriptions
               In the following detailed descriptions of each register, the shaded register bits are different for the Dual
               PCI PowerSpan II and Single PCI PowerSpan II
               Table 65 describes the abbreviations used in the register descriptions.
Table 65: Abbreviations used in Register Descriptions
 Abbreviation                Description
 G_RST                        General Reset (Active when either PB_RST, P1_RST, or P2_RST is asserted)
 PB_RST                      Processor Bus Reset
 P1_RST                      PCI-1 (P1) Reset
 P2_RST                      PCI-2 (P2) Reset
 Px_RST                      PCI-1 or PCI-2 Reset
PowerSpan II User Manual                                                                     Integrated Device Technology
80A1010_MA001_09                                                                                               www.idt.com


12. Register Descriptions                                                                                          249
Table 65: Abbreviations used in Register Descriptions
 Abbreviation               Description
 PRI_RST                    Primary PCI Reset
 R/W                        Read/Write
 R                          Read Only
 R/Write 1 to Clear         Read/Write 1 to Clear
 Write 1 to Set             Read 0/Write 1 to Set (Writing a 1 triggers an event)
 R/WPB                      Read Only from PCI, Read/Write from Processor Bus
 0                          Reset value is 0. Register bit may be loaded by EEPROM after reset
 EEPROM
 1                          Reset value is 1. Register bit may be loaded by EEPROM after reset
 EEPROM
 PWRUP                      Register bit loaded as a power-up option
 PCI Reserved               Do not write. Read back 0
 PCI Unimplemented          Do not write. Read back 0
 PowerSpan II Reserved      Do not write. Read back undefined
 Reserved                   Do not write. Read back undefined
 Single PCI PowerSpan II    Single PCI PowerSpan II (PCI-1 and Processor Bus)
Integrated Device Technology                                                                   PowerSpan II User Manual
www.idt.com                                                                                        80A1010_MA001_09


250                                                                                            12. Register Descriptions
12.5.1        PCI-1 ID Register
              This register is Read Only from PCI-1 and Read/Write from the Processor Bus Interface.
 Register Name: P1_ID                                                                           Register Offset: 0x000
   PCI                                                                                                            PB
   Bits                                             Function                                                     Bits
  31-24                                               DID                                                        0-7
  23-16                                               DID                                                        8-15
  15-08                                               VID                                                       16-23
  07-00                                               VID                                                       24-31
                                    Reset       Reset
      Name            Type           By         State                              Function
    DID[15:0]      R/Write from    P1_RST      0x8260     Device ID
                  processor bus               EEPROM      IDT allocated Device Identifier
    DID[15:0]      R/Write from    P1_RST      0x8261     Single PCI PowerSpan II
                  processor bus
    VID[15:0]      R/Write from    P1_RST      0x10E3     Vendor ID
                  processor bus               EEPROM      PCI SIG allocated Vendor Identifier
                                                          Note: IDT acquired Tundra Semiconductor.
PowerSpan II User Manual                                                                  Integrated Device Technology
80A1010_MA001_09                                                                                           www.idt.com


12. Register Descriptions                                                                                                 251
12.5.2          PCI-1 Control and Status Register.
 Register Name: P1_CSR                                                                            Register Offset: 0x004
    PCI                                                                                                               PB
    Bits                                             Function                                                         Bits
   31-24      D_PE          S_       R_MA       R_TA         S_TA                DEVSEL               MDP_D           0-7
                          SERR
   23-16     TFBBC           0      DEV66       CAP_L                          PCI Reserved                          8-15
   15-08                               PCI Reserved                                      MFBBC       SERR_EN         16-23
   07-00      WAIT       PERESP     VGAPS       MWI_          SC             BM             MS          IOS          24-31
                                                  EN
                                    Reset       Reset
       Name             Type         By          State                                 Function
       D_PE            R/W 1 to    P1_RST          0       Detected Parity Error
                        clear                              This bit is set by the device whenever the Master Module
                                                           detects a data parity error or the Target Module detects a data
                                                           or address parity error.
                                                           0 = No Parity Error
                                                           1 = Parity Error
      S_SERR        R/W 1 to clear P1_RST          0       Signaled SERR#
                                                           The device as PCI Target sets this bit when it asserts SERR#
                                                           to signal an address parity error. SERR_EN and PERESP
                                                           must be set before SERR# can be asserted.
                                                           0 = SERR# not asserted
                                                           1 = SERR# asserted
       R_MA         R/W 1 to clear P1_RST          0       Received Master Abort
                                                           The device sets this bit when a transaction it initiated had to
                                                           be terminated with a Master-Abort.
                                                           0 = device did not generate Master-Abort
                                                           1 = device generated Master Abort
        R_TA        R/W 1 to clear P1_RST          0       Received Target Abort
                                                           The device sets this bit when a transaction it initiated was
                                                           terminated with a Target-Abort.
                                                           0 = device did not detect Target-Abort
                                                           1 = device detected Target-Abort
Integrated Device Technology                                                                    PowerSpan II User Manual
www.idt.com                                                                                           80A1010_MA001_09


252                                                                                   12. Register Descriptions
                                  Reset  Reset
     Name            Type          By    State                              Function
      S_TA        R/W 1 to clear P1_RST    0   Signaled Target-Abort
                                               0 = device Target Module did not terminate transaction with
                                               Target-Abort
                                               1 = device Target Module terminated transaction with
                                               Target-Abort.
  DEVSEL [1:0]         R         P1_RST   01   Device Select Timing
                                               The device is a medium speed device.
     MDP_D        R/W 1 to clear P1_RST    0   Master Data Parity Detected
                                               The device sets this bit if the PERESP bit is set and either (a)
                                               it is the master of the transaction in which it asserts PERR#,
                                               or (b) the addressed target asserts PERR#.
                                               0 = Master Module did not detect/generate data parity error
                                               1 = Master Module detected/generated data parity error
     TFBBC             R         P1_RST    0   Target Fast Back to Back Capable
                                               Warning: PowerSpan II cannot accept fast back-to-back
                                               transactions - neither as the same agent nor as a different
                                               agent.
     DEV66             R         P1_RST    1   Device 66 MHz
                                               The device is a 66 MHz capable device
     CAP_L             R         P1_RST PWRUP  Capabilities List
                                               The capabilities list is only supported by the Primary PCI
                                               Interface. When PCI-1 is the Primary Interface, CAP_L in
                                               PCI-1 is set and CAP_L in PCI-2 is cleared. The opposite is
                                               true when PCI-2 is the Primary Interface. The Primary PCI
                                               Interface is determined by the PWRUP_PRI_PCI power-up
                                               option.
                                               0 = capabilities list unsupported
                                               1 = capabilities list supported
     MFBBC             R         P1_RST    0   Master Fast Back to Back Enable
                                               The device does not generate fast back to back transactions
    SERR_EN           R/W        P1_RST    0   SERR# Enable
                                               Setting this and PERESP allows the device to report address
                                               parity errors with SERR# as PCI target.
                                               0 = Disable SERR# driver
                                               1 = Enable SERR# driver
      WAIT             R         P1_RST    0   Wait Cycle Control
                                               0 = No address/data stepping
PowerSpan II User Manual                                                        Integrated Device Technology
80A1010_MA001_09                                                                                   www.idt.com


12. Register Descriptions                                                                                253
                              Reset  Reset
       Name             Type   By    State                             Function
     PERESP              R/W P1_RST    0   Parity Error Response
                                           Controls the device’s response to address and data parity
                                           errors. When enabled, PERR# is asserted and the MDP_D
                                           bit is set in response to data parity errors. When this bit and
                                           SERR_EN are set, the device reports address parity errors
                                           on SERR#. This bit does not affect the device’s parity
                                           generation.
                                           0 = Disable
                                           1 = Enable
      VGAPS               R  P1_RST    0   VGA Palette Snoop
                                           0 = Disable
     MWI_EN               R  P1_RST    0   Memory Write and Invalidate Enable
                                           PowerSpan II does not generate MWI transactions.
                                           0 = Disable
         SC               R  P1_RST    0   Special Cycles
                                           PowerSpan II does not respond to Special cycles as a PCI
                                           target.
                                           0 = Disable
        BM               R/W P1_RST    0   Bus Master
                                    EEPROM Enables the device to generate cycles as a PCI Master.
                                           0 = Disable
                                           1 = Enable
        MS               R/W P1_RST    0   Enables the device to accept Memory cycles as a PCI target.
                                    EEPROM Memory Space
                                           0 = Disable
                                           1 = Enable
        IOS               R  P1_RST    0   IO Space
                                           PowerSpan II does not respond to I/O cycles as a PCI target.
                                           0 = Disable
Integrated Device Technology                                                    PowerSpan II User Manual
www.idt.com                                                                           80A1010_MA001_09


254                                                                                12. Register Descriptions
12.5.3        PCI-1 Class Register
 Register Name: P1_CLASS                                                            Register Offset: 0x008
   PCI                                                                                                  PB
   Bits                                  Function                                                      Bits
  31-24                                   BASE                                                         0-7
  23-16                                    SUB                                                         8-15
  15-08                                   PROG                                                        16-23
  07-00                                    RID                                                        24-31
                             Reset  Reset
      Name            Type    By    State                                Function
    BASE[7:0]       R/WPB   P1_RST   0x06      Base Class Code
                                   EEPROM      When PowerSpan II is an I2O controller, this field must be
                                               programmed with 0x0E either from the Processor Bus or by
                                               EEPROM.
                                               0x06 = Bridge Device (default)
                                               0x0E = I2O controller
     SUB[7:0]        R/WPB  P1_RST   0x80      Sub Class Code
                                   EEPROM      When PowerSpan II is an I2O controller, this field must be
                                               programmed with 0x00 either from the Processor Bus or by
                                               EEPROM.
                                               0x80 = Other bridge device (if BASE = 0x06)
                                               0x00 = I2O Device (if BASE = 0x0E)
    PROG[7:0]       R/WPB   P1_RST   0x00      Programming Interface
                                   EEPROM      When PowerSpan II is an I2O controller, this field must be
                                               programmed with 0x01 either from the Processor Bus or by
                                               EEPROM.
                                               0x00 = Other Bridge Device (if BASE = 06)
                                               0x01 = I2O Inbound and Outbound Queues mapped to
                                               offsets 0x40 and 0x44 respectively, and I2O Interrupt Status
                                               and Mask registers at offsets 0x30 and 0x34 (if BASE =
                                               0x0E)
     RID[7:0]        R/WPB  P1_RST   0x01      Revision ID
                                   EEPROM      0x01 = PowerSpan II
PowerSpan II User Manual                                                      Integrated Device Technology
80A1010_MA001_09                                                                                 www.idt.com


12. Register Descriptions                                                                                             255
12.5.4           PCI-1 Miscellaneous 0 Register
 Register Name: P1_MISC0                                                                       Register Offset: 0x00C
    PCI                                                                                                            PB
    Bits                                          Function                                                        Bits
   31-24      BISTC        SBIST     PCI Reserved                              CCODE                              0-7
   23-16     MFUNCT                                      LAYOUT                                                   8-15
   15-08                                           LTIMER                                                        16-23
   07-00                                            CLINE                                                        24-31
                                  Reset      Reset
       Name             Type       By         State                                 Function
        BIST              R      P1_RST         0       BIST Capable
                                                        0 = device is not BIST capable
       SBIST              R      P1_RST         0       Start BIST
                                                        0 = device is not BIST capable
    CCODE [3:0]           R      P1_RST         0       Completion Code
                                                        0 = device is not BIST capable
      MFUNCT              R      P1_RST         0       Multifunction Device
                                                        0 = device is not a multifunction device
   LAYOUT [6:0]           R      P1_RST         0       Configuration Space Layout
    LTIMER [7:0]         R/W     P1_RST         0       Latency Timer
                                                        Number of PCI bus clocks before the device must initiate
                                                        termination of transaction as a master. Resolution of one
                                                        clock.
                                                        This field specifies the value of the Latency Timer for the
                                                        PCI-1 Master in units of PCI bus clocks. The latency timer
                                                        provides a resolution of one PCI bus clock. This timer always
                                                        has a minimum value of eight PCI bus clocks. The values
                                                        000b-111b correspond to eight clock cycles.
Integrated Device Technology                                                                 PowerSpan II User Manual
www.idt.com                                                                                        80A1010_MA001_09


256                                                                                               12. Register Descriptions
                                    Reset       Reset
      Name              Type         By         State                                  Function
    CLINE[7:0]           R/W       P1_RST         0        Cacheline Size
                                                           Specifies the cacheline size for this interface, in number of
                                                           32-bit words. Valid settings are 4, 8, 16 or 32 words. Default
                                                           setting is 8 words. All other settings default to 8 words.
                                                           0x00 = 8 x 32-bit words
                                                           0x04 = 4 x 32 bit words
                                                           0x08 = 8 x 32-bit words
                                                           0x10 = 16 x 32-bit words
                                                           0x20 = 32 x 32 bit words
                                                           others = 8 x 32-bit words
               CLINE[7:0] The CLINE Size specifies the system cacheline size in units of 32-bit words. The CLINE
               is used by the PowerSpan II PCI Master in determining which PCI Read cycle it generates on PCI
               (MR, MRL, MRM). Table 66 shows the relationship between the read amount and the read command.
               Table 66: Read Amount Versus Read Command
                 Read Amount                     Read Command
                 < 8 bytes                       Memory Read
                 <= CLINE                        Memory Read Line
                 > CLINE                         Memory Read Multiple
PowerSpan II User Manual                                                                    Integrated Device Technology
80A1010_MA001_09                                                                                                www.idt.com


12. Register Descriptions                                                                                                 257
12.5.5          PCI-1 I2O Target Image Base Address Register
                This register specifies the 64 KByte aligned base address of the device’s PCI I2O Target Image in PCI
                Memory space. PowerSpan II only supports the I2O Target Image on the Primary PCI Interface.
                The first 4 Kbytes of this image provides the I2O Shell Interface Inbound and Outbound Queues and the
                Host Interrupt Status and Mask Registers. Cycles claimed by the PowerSpan II I2O Target Image with
                offsets greater than 4 Kbytes is passed on to the Processor Bus. The control information for the
                PowerSpan II I2O Target Image is fully defined in the PCI_TI2O_CTL and PCI_TI2O_TADDR registers.
                A write must occur to this register before the device’s I2O Target Image is accessed through PCI Memory
                transactions. This write can be performed with either a PCI configuration transaction or a register access
                by the local processor.
                A Base Address of 0x00000 is not a supported base address and the register image does not respond to
                PCI transactions as a target device when 0x00000 is written to this field — the image is disabled.
                PowerSpan II supports a Base Address of 0x00000 if the BAR_EQ_0 bit is set in the “Miscellaneous
                Control and Status Register” on page 318.
                The BS field in the “PCI I2O Target Image Control Register” on page 352 determines the size of the
                image requested in PCI Memory space for the PCI I2O Target Image.
                Writes are enabled to this register only if the BAR_EN bit in the PCI_TI2O_CTL register is set.
                This register is not implemented in the Secondary PCI Interface.
 Register Name: P1_BSI2O                                                                             Register Offset: 0x010
    PCI                                                                                                                PB
    Bits                                                  Function                                                    Bits
   31-24                                                      BA                                                      0-7
   23-16                                                      BA                                                      8-15
   15-08        0            0            0            0             0           0              0           0        16-23
   07-00        0            0            0            0         PRFTCH              TYPE                 SPACE      24-31
                                       Reset         Reset
       Name              Type           By           State                                Function
      BA[15:0]           R/W          P1_RST           0         Base Address
      PRFTCH            R/WPB         P1_RST           1         Prefetchable
                                                   EEPROM        Memory is prefetchable
     TYPE [1:0]           R           P1_RST           0         Type
                                                                 00 = locate anywhere in 32-bit address space
       SPACE              R           P1_RST           0         PCI Bus Address Space
                                                                 0 = Memory
Integrated Device Technology                                                                       PowerSpan II User Manual
www.idt.com                                                                                              80A1010_MA001_09


258                                                                                               12. Register Descriptions
12.5.6         PCI-1 Register Image Base Address Register
               This register specifies the 4-KByte aligned base address of the device’s register space in PCI Memory
               Space. The Register space is only 4 KByte, therefore the PCI address lines [11:0] are used to select the
               register.
               A write must occur to this register before the device’s registers can be accessed through PCI memory
               transactions. This write can be performed with a PCI Configuration transaction or a register access by
               the local processor.
               A Base Address of 0x00000 is not a supported base address and the register image does not respond to
               PCI transactions as a target device when 0x00000 is written to this field — the image is disabled.
               PowerSpan II supports a Base Address of 0x00000 if the BAR_EQ_0 bit is set in the “Miscellaneous
               Control and Status Register” on page 318.
               Writes are enabled to this register only when the BSREG_BAR_EN bit in the “PCI-1 Miscellaneous
               Control and Status Register” on page 283 is set.
 Register Name: P1_BSREG                                                                           Register Offset: 0x014
   PCI                                                                                                               PB
   Bits                                                 Function                                                    Bits
  31-24                                                   BA                                                        0-7
  23-16                                                   BA                                                        8-15
  15-08                          BA                               0           0              0            0        16-23
  07-00        0            0            0           0        PRFTCH               TYPE                SPACE       24-31
                                     Reset         Reset
      Name              Type           By          State                               Function
     BA[19:0]            R/W        P1_RST           0        Base Address
     PRFTCH               R         P1_RST           0        Prefetchable
                                                              Memory is not prefetchable
    TYPE [1:0]            R         P1_RST           0        Type
                                                              00 = locate anywhere in 32-bit address space
      SPACE               R         P1_RST           0        PCI Bus Address Space
                                                               0 = Memory
PowerSpan II User Manual                                                                     Integrated Device Technology
80A1010_MA001_09                                                                                              www.idt.com


12. Register Descriptions                                                                                              259
12.5.7          PCI Target Base Address Register
                This register specifies the 64-KByte aligned base address of the device’s PCI Target Image x in PCI
                Memory space.
                A write must occur to this register before the device’s PCI Target Image X is accessed through PCI
                Memory transactions. This write is performed with a PCI Configuration transaction or a register access
                by the local processor.
                A Base Address of 0x00000 is not a supported base address and the register image does not respond to
                PCI transactions as a target device when 0x00000 is written to this field — the image is disabled.
                PowerSpan II supports a Base Address of 0x00000 if the BAR_EQ_0 bit is set in the “Miscellaneous
                Control and Status Register” on page 318.
                The BS field of the “PCI-1 Target Image x Control Register” on page 268 determines the size of the
                image requested in PCI memory space for PCI Target Image X.
                Writes are enabled to this register only when the BAR_EN bit in the P1_TIx_CTL register is set.
                Reads from this image are treated as prefetchable. The PRFTCH field is programmable to provide
                flexibility for the BIOS.
 Register Name: P1_BSTx                                                     Register Offset: 0x018, 0x01C, 0x020, 0x024
    PCI                                                                                                             PB
    Bits                                                 Function                                                  Bits
   31-24                                                   BA                                                      0-7
   23-16                                                   BA                                                      8-15
   15-08        0             0           0           0            0           0              0           0       16-23
   07-00        0             0           0           0        PRFTCH               TYPE                SPACE     24-31
                                       Reset        Reset
       Name              Type           By          State                               Function
      BA[15:0]           R/W          P1_RST          0        Base Address
      PRFTCH           R/WPB          P1_RST          1        Prefetchable
                                                  EEPROM       memory is prefetchable
     TYPE [1:0]            R          P1_RST          0        Type
                                                               00 = locate anywhere in 32-bit address space
       SPACE               R          P1_RST          0        PCI Bus Address Space
                                                               0 = Memory Space
Integrated Device Technology                                                                     PowerSpan II User Manual
www.idt.com                                                                                            80A1010_MA001_09


260                                                                                               12. Register Descriptions
12.5.8         PCI System ID Register
               Writes to the PCI_SID register from the processor propagates to its contents. Writes to the P1_SID
               register from the PCI bus have no effect on its contents.
 Register Name: P1_SID                                                                            Register Offset: 0x02C
   PCI                                                                                                                PB
   Bits                                               Function                                                       Bits
  31-24                                                  SID                                                         0-7
  23-16                                                  SID                                                         8-15
  15-08                                                 SVID                                                        16-23
  07-00                                                 SVID                                                        24-31
                                    Reset        Reset
      Name              Type          By         State                                 Function
    SID[15:0]         R/WPB        P1_RST           0        Subsystem ID
                                                EEPROM       Values for subsystem ID are vendor specific
    SVID[15:0]        R/WPB        P1_RST           0        Subsystem Vendor ID
                                                EEPROM       Subsystem Vendor IDs are obtained from the PCI SIG and
                                                             used to identify the vendor of the add-in board or subsystem.
PowerSpan II User Manual                                                                     Integrated Device Technology
80A1010_MA001_09                                                                                               www.idt.com


12. Register Descriptions                                                                                             261
12.5.9          PCI-1 Capability Pointer Register
                The CAP_PTR indicates the register offset in PCI configuration space of the first capabilities pointer in
                the capabilities linked-list.
                This register is not implemented in the Secondary PCI Interface.
 Register Name: P1_CAP                                                                         Register Offset: 0x034
    PCI                                                                                                            PB
    Bits                                                Function                                                  Bits
   31-24                                              PCI Reserved                                                0-7
   23-16                                              PCI Reserved                                                8-15
   15-08                                              PCI Reserved                                               16-23
   07-00                                     CAP_PTR                                     0            0          24-31
                                       Reset       Reset
       Name             Type            By         State                            Function
  CAP_PTR [7:0]           R           P1_RST       0xE4       Capabilities Pointer
Integrated Device Technology                                                                 PowerSpan II User Manual
www.idt.com                                                                                        80A1010_MA001_09


262                                                                                         12. Register Descriptions
12.5.10         PCI-1 Miscellaneous 1 Register
 Register Name: P1_MISC1                                                         Register Offset: 0x03C
   PCI                                                                                                PB
   Bits                                   Function                                                    Bits
  31-24                                   MAX_LAT                                                     0-7
  23-16                                   MIN_GNT                                                    8-15
  15-08                                    INT_PIN                                                  16-23
  07-00                                   INT_LINE                                                  24-31
P1_MISC1 Description
                           Reset   Reset
 Name            Type      By      State        Function
 MAX_LAT [7:0]      R/W     P1_RST      0       Maximum Latency
                                                This field specifies how often the device needs access to
                                                the PCI bus.
                                                No special latency requirements
 MIN_GNT [7:0]      R/W     P1_RST      0       Minimum Grant
                                                This field indicates how long a master wants to retain
                                                bus ownership whenever it initiates a transaction.
                                                No special requirements
  INT_PIN [7:1]       R     P1_RST      0       Interrupt Pin (7 to 1)
                                                This field represents general purpose interrupt pins.
                                                Interrupt pins are active low and, when configured as
                                                input, are sampled on three successive processor bus
                                                clock edges to ensure appropriate setting of a status bit.
                                                Each pin is bidirectional, open drain, active low and level
                                                sensitive. The input/output character of each interrupt
                                                pin is controlled through a corresponding bit in the
                                                “Interrupt Direction Register” on page 347. Each pin can
                                                be configured as either an input or output. All pins are
                                                configured as inputs by default.
   INT_PIN [0]     R/WPB    P1_RST      1       Interrupt Pin
                                    EEPROM      This interrupt pin is used to enable PCI interrupts. If this
                                                bit is not set, PowerSpan II does not use PCI interrupts.
                                                Setting this bit enables a single function PCI device to
                                                use INTA#.
                                                0 = The device does not use any PCI interrupts
                                                1 = The device uses INTA_
PowerSpan II User Manual                                                              Integrated Device Technology
80A1010_MA001_09                                                                                          www.idt.com


12. Register Descriptions                                                                                 263
P1_MISC1 Description
                             Reset  Reset
 Name             Type       By     State  Function
  INT_LINE [7:0]       R/W   P1_RST      0 Interrupt Line
                                           This read/write interrupt line field is used to identify
                                           which of the system interrupt request lines on the
                                           interrupt controller the device’s interrupt request pin is
                                           routed to.
Integrated Device Technology                                                          PowerSpan II User Manual
www.idt.com                                                                                  80A1010_MA001_09


264                                                                                               12. Register Descriptions
12.5.11        PCI-1 Compact PCI Hot Swap Control and Status Register
               PowerSpan II supports CompactPCI Hot Swap Specification Revision 2.0 and is a Hot Swap Silicon
               Device.
               This register controls CompactPCI Hot Swap support in PowerSpan II. The Hot Swap functionality is
               enabled in the Primary PCI Interface of PowerSpan II. In the Single PCI PowerSpan II the lone PCI
               Interface is enabled as Primary, but in the Dual PCI PowerSpan II only one of the two ports can be
               enabled as Primary.
               This register is not implemented in the Secondary PCI Interface.
 Register Name: P1_HS_CSR                                                                         Register Offset: 0x0E4
   PCI                                                                                                               PB
   Bits                                                 Function                                                    Bits
  31-24                                              PCI Reserved                                                    0-7
  23-16       INS          EXT               PI                  LOO             0          EIM           0         8-15
  15-08                                                NXT_PTR                                                     16-23
  07-00                                                  CAP_ID                                                    24-31
                                      Reset       Reset
      Name             Type            By         State                                 Function
        INS         R/Write 1 to     P1_RST          0        ENUM# Status - Insertion
                       clear                                  1 = ENUM# Asserted
                                                              0 = ENUM# Negated
        EXT         R/Write 1 to     P1_RST          0        ENUM_ Status - Extraction
                       clear                                  1 = ENUM# Asserted
                                                              0 = ENUM# Negated
         PI              R           P1_RST          0        Programming Interface
                                                              Programming interface bit indicates the programming
                                                              interface supported by the board. PowerSpan II implements a
                                                              bit value of 0, which means INS, EXT, LOO, EIM are
                                                              supported. Refer to the CompactPCI Hot Swap Specification
                                                              Revision 2.0 for more information.
                                                              00 = INS, EXT, LOO, EIM supported
                                                              01,10,11 = Reserved
       LOO             R/W           P1_RST          0        LED ON/OFF
                                                              1 = LED On
                                                              0 = LED Off
PowerSpan II User Manual                                                                     Integrated Device Technology
80A1010_MA001_09                                                                                               www.idt.com


12. Register Descriptions                                                                                265
                              Reset  Reset
       Name             Type   By     State                               Function
        EIM              R/W P1_RST     0     ENUM# Signal Mask
                                              1 = Mask Signal
                                              0 = Enable Signal
  NXT_PTR [7:0]           R  P1_RST 0xE8 or 0 Next Pointer
                                              If VPD_EN bit is set in the “Miscellaneous Control and Status
                                              Register” on page 318 and an external EEPROM is detected,
                                              then this field reads back 0xE8. When the VPD_EN bit in the
                                              MISC_CSR register is cleared or an external EEPROM is not
                                              detected, this field reads back 0.
    CAP_ID [7:0]          R  P1_RST   0x06    Capability ID
Integrated Device Technology                                                      PowerSpan II User Manual
www.idt.com                                                                            80A1010_MA001_09


266                                                                                                 12. Register Descriptions
12.5.12         PCI-1 Vital Product Data Capability Register
                PowerSpan II only supports VPD access from the Primary PCI Interface. The Secondary PCI Interface
                reads zero for VPD accesses. VPD writes have no effect.
                VPD can also be disabled when the NXT_PTR bit in the “PCI-1 Compact PCI Hot Swap Control and
                Status Register” on page 264 register is 0.
 Register Name: P1_VPDC                                                                                Register Offset: 0E8
   PCI                                                                                                                     PB
   Bits                                                 Function                                                          Bits
  31-24         F                                             Reserved                                                    0-7
  23-16                                                   VPDA                                                            8-15
  15-08                                                NXT_PTR                                                           16-23
  07-00                                                  CAP_ID                                                          24-31
                                     Reset        Reset
      Name              Type           By          State                                   Function
        F               R/W         P1_RST           0        Data Transfer Complete Flag
                                                              Indicates when the transfer between the VPD Data register
                                                              and the EEPROM is complete. Software clears the bit to
                                                              initiate a read and PowerSpan II sets the bit when the read
                                                              data is available in the VPD Data register. Software sets the
                                                              bit to initiate a write and PowerSpan II clears the bit to
                                                              indicate when the data has been transferred.
    VPDA [7:0]          R/W         P1_RST         0x00       Vital Product Data Address
                                                              The 8-bit address specifies the VPD address offset for the
                                                              VPD-Read or VPD-Write to the serial EEPROM. When I2C
                                                              chip select 0 is used for the VPD EEPROM the VPD address
                                                              translates a maximum of 64 bytes and 192 bytes are
                                                              available for VPD. The first 64 bytes of VPD is VPD-Read
                                                              Only, and the remaining 128 bytes — 192 bytes if separate
                                                              256 byte EEPROM used for VPD — is VPD-Read/Write.
  NXT_PTR [7:0]          R          P1_RST         0x00       Next Pointer
                                                              VPD is the last Extended Capabilities Pointer
   CAP_ID [7:0]          R          P1_RST         0x03       Capability ID
PowerSpan II User Manual                                                                       Integrated Device Technology
80A1010_MA001_09                                                                                                  www.idt.com


12. Register Descriptions                                                                                                267
12.5.13         PCI-1 Vital Product Data Register
                This register is enabled when the VPD_EN bit in the “Miscellaneous Control and Status Register” on
                page 318 is set to 1. If it is disabled, the register always reads zero. VPD is also disabled when the
                NXT_PTR bit in the “PCI-1 Compact PCI Hot Swap Control and Status Register” on page 264 register
                is 0.
                PowerSpan II only supports VPD access from the Primary PCI Interface. The Secondary PCI Interface
                always reads zero for VPD accesses and VPD writes have no effect.
 Register Name: P1_VPDD                                                                            Register Offset: 0x0EC
    PCI                                                                                                               PB
    Bits                                                    Function                                                 Bits
   31-24                                                   VPD_DATA                                                   0-7
   23-16                                                   VPD_DATA                                                  8-15
   15-08                                                   VPD_DATA                                                 16-23
   07-00                                                   VPD_DATA                                                 24-31
                                       Reset          Reset
       Name             Type             By            State                              Function
    VPD_DATA             R/W          P1_RST             0        VPD Data
        [31:0]
Integrated Device Technology                                                                     PowerSpan II User Manual
www.idt.com                                                                                            80A1010_MA001_09


268                                                                                                   12. Register Descriptions
12.5.14        PCI-1 Target Image x Control Register
               This register contains the control information for the PowerSpan II PCI 1 Target Image x. The Image is
               enabled for decode when both IMG_EN and BAR_EN are set.
                         The bits in this register are not dynamic. Do not alter these settings while transactions are
                         being processed through PowerSpan II. Refer to “Translation Address Mapping” on page 293
                         for more information on dynamic address translation.
 Register Name: P1_TIx_CTL                                                      Register Offset: 0x100, 0x110, 0x120, 0x130
   PCI                                                                                                                  PB
   Bits                                                  Function                                                      Bits
  31-24     IMG_EN       TA_EN         BAR_        MD_EN                                BS                              0-7
                                        EN
  23-16      MODE        DEST        MEM_IO                                      RTT                                   8-15
  15-08       GBL          CI            0                                       WTT                                  16-23
  07-00       PR                END                  MRA            0                       RD_AMT                    24-31
             KEEP
                                     Reset          Reset
      Name             Type            By           State                                  Function
     IMG_EN            R/W          P1_RST            0        Image Enable
                                                               The image enable bit is set by the following:
                                                               • Non-Zero write to the P1_BSTx register
                                                               • Register write to IMG_EN
                                                               The Image Enable is cleared by writing 0 to the IMG_EN bit
                                                               or writing a 0 to the “PCI Target Base Address Register” on
                                                               page 259. IMG_EN will always read zero if P1_BSTx is zero.
                                                               0 = Disable
                                                               1 = Enable
      TA_EN            R/W          P1_RST            0        Translation Address Enable
                                                               When set, the Translation Address (P1_TIx_TADDR)
                                                               replaces the upper bits of the PCI x bus address. The new
                                                               address is used on the destination bus. Clearing the enable
                                                               bit results in no address translation.
                                                               0 = Disable
                                                               1 = Enable
PowerSpan II User Manual                                                                        Integrated Device Technology
80A1010_MA001_09                                                                                                  www.idt.com


12. Register Descriptions                                                                                 269
                              Reset  Reset
       Name             Type   By    State                             Function
     BAR_EN              R/W P1_RST    1   PCI Base Address Register Enable
                                    EEPROM When this bit is set, the P1_BSTx register is Read/Write and
                                           visible to PCI BIOS Configuration cycles. When this bit is
                                           disabled, the P1_BSTx register is not visible in PCI-1
                                           Configuration space and is read zero only.
                                           Writes to P1_BSTx have no effect when this bit is cleared.
                                           This effectively disables the PowerSpan II P1_BSTx Image
                                           and PowerSpan II does not request PCI Memory space for
                                           the image. If the user is clearing this bit, they must also clear
                                           P1_BSTx.
                                           0 = Disable
                                           1 = Enable
      MD_EN              R/W P1_RST    0   Master Decode Enable
                                           Enables master decode when the internal PCI arbiter is in
                                           use —when the P1_ARB_EN bit in the “Reset Control and
                                           Status Register” on page 324 is set. If MD_EN is cleared,
                                           only the PCI Address and Command are used for transaction
                                           decode. If MD_EN is set, the originating master is included in
                                           the transaction decode. A transaction is claimed only if it
                                           originates from the master(s) specified in P1_TIx_TADDR.
                                           0=Disable
                                           1=Enable
      BS[3:0]            R/W P1_RST    0   Block Size
                                    EEPROM (64 Kbyte * 2BS)
                                           The block size specifies the size of the image, address lines
                                           compared and address lines translated (see Table 67).
      MODE               R/W P1_RST    0   Image Mode
                                           Determines if the image is used to generate Memory or IO
                                           commands on PCI. The MODE is only applicable if the
                                           destination is the alternate PCI bus.
                                           0 = Memory command generation
                                           1 = I/O command generation or 4 byte memory read (see
                                           Table 68 on page 272)
       DEST              R/W P1_RST    0   Destination Bus
                                           Selects the destination bus for the transaction.
                                           0 = Processor Bus
                                           1 = PCI-2 Bus
                                           Single PCI PowerSpan II: Reserved
                                           Processor Bus is the only destination.
Integrated Device Technology                                                    PowerSpan II User Manual
www.idt.com                                                                             80A1010_MA001_09


270                                                                            12. Register Descriptions
                           Reset  Reset
     Name            Type   By    State                             Function
    MEM_IO            R/W P1_RST    0    MEM_IO mode
                                         PowerSpan II supports 4-byte reads. When this bit is set, I/O
                                         commands to the corresponding image generates Memory
                                         Read commands on the destination PCI bus (Py) with the
                                         same byte enables latched from the source bus transaction. If
                                         the destination of the transaction is the PB Interface, a
                                         minimum 32-bit aligned, 4-byte read is generated on the
                                         processor bus.
                                         The MODE bit and the MEM_IO bit work together to control
                                         the size of the transaction (see Table 68).
                                         0 = Regular IO mode
                                         1 = Enables 4 byte reads on the processor (60x) bus or 1,2,3
                                         or 4 byte memory reads on the PCI bus(es). The bus that the
                                         read occurs on is controlled by the DEST bit.
    RTT[4:0]          R/W P1_RST 0b01010 Processor Bus Read Transfer Type (PB_TT[0:4])
                                         Selects the Transfer Type on the Processor Bus. The register
                                         bits RTT[4:0]/WTT[4:0] are mapped to pins PB_TT[0:4]
                                         01010 = Read
      GBL             R/W P1_RST    0    Global
                                         0 = Assert PB_GBL_
                                         1 = Negate PB_GBL_
       CI             R/W P1_RST    0    Cache Inhibit
                                         0 = Assert PB_CI_
                                         1 = Negate PB_CI_
    WTT[4:0]          R/W P1_RST 0b00010 Processor Bus Write Transfer Type (PB_TT[0:4])
                                         Selects the Transfer Type on the Processor Bus. The register
                                         bits RTT[4:0]/WTT[4:0] are mapped to pins PB_TT[0:4]
                                         00010 = Write with flush
    PRKEEP            R/W P1_RST    0    Prefetch Read Keep Data
                                         Used to hold read data fetched beyond the initial PCI read
                                         cycle. When set, subsequent read requests to the same
                                         image at the next address retrieves the read data directly
                                         from the Switching Fabric instead of causing the destination
                                         bus to fetch more data. The read data is invalidated when a
                                         read with a non-matching address occurs.
                                         0 = Disable
                                         1 = Enable
PowerSpan II User Manual                                                 Integrated Device Technology
80A1010_MA001_09                                                                             www.idt.com


12. Register Descriptions                                                                                                   271
                                     Reset         Reset
       Name             Type          By            State                                  Function
     END[1:0]            R/W        P1_RST          0b10       Endian Conversion Mode
                                                               This bit sets the endian conversion mode. This field is only
                                                               applicable if the destination is the Processor Bus.
                                                               00 = Little-endian
                                                               01 = PowerPC little-endian
                                                               10 = Big-endian
                                                               11 = True little-endian
       MRA               R/W        P1_RST            0        PCI Memory Read Alias to Memory Read Multiple
                                                               0 = Disabled
                                                               1 = Enabled
                                                               When set, the PCI x Target Image X alias a PCI Memory
                                                               Read cycle to a PCI Memory Read Multiple cycle and
                                                               prefetches the number of bytes specified in the RD_AMT[2:0]
                                                               field. When MRA is cleared the Target Image prefetches 8
                                                               bytes when a PCI Memory Read command is decoded.
   RD_AMT[2:0]           R/W        P1_RST            0        Prefetch Size
                                                               Specifies the number of bytes the device prefetches for PCI
                                                               Memory Read Multiple transactions claimed by the target
                                                               image (see Table 69).
                BS: The block size specifies the size of the image, address lines compared and address lines translated.
                Table 67: Block Size
                           BS[3:0]                 Block Size             Address Lines Compared/Translated
                            0000                       64k                              AD31-AD16
                            0001                      128K                              AD31-AD17
                            0010                      256K                              AD31-AD18
                            0011                      512K                              AD31-AD19
                            0100                       1M                               AD31-AD20
                            0101                       2M                               AD31-AD21
                            0110                       4M                               AD31-AD22
                            0111                       8M                               AD31-AD23
                            1000                      16M                               AD31-AD24
                            1001                      32M                               AD31-AD25
                            1010                      64M                               AD31-AD26
Integrated Device Technology                                                                        PowerSpan II User Manual
www.idt.com                                                                                              80A1010_MA001_09


272                                                                                             12. Register Descriptions
              Table 67: Block Size
                          BS[3:0]                 Block Size           Address Lines Compared/Translated
                           1011                      128M                          AD31-AD27
                           1100                      256M                          AD31-AD28
                           1101                      512M                          AD31-AD29
                           1110                       1G                           AD31-AD30
                           1111                       2G                               AD31
              MODE: Determines if the image is used to generate Memory or IO commands on PCI. The MODE is
              only applicable if the destination is the alternate PCI bus.
              •    Memory Command Mode:
                   PCI Memory commands generated on PCI-2.
                   Bursting is supported.
                   PRKEEP and RD_AMT[2:0] are only applicable in Memory Command Mode.
              •    IO Command Mode
                   Causes PCI IO commands to be generated on PCI-2. When the image is selected to perform IO
                   commands, transactions are limited to 4 bytes or less. A PCI Master initiated cycle attempting to
                   burst to the image in this mode will be terminated with a Target Disconnect (Retry) after every data
                   beat.
              The MODE bit and the MEM_IO bit work together to control the size of the transaction (see Table 68).
              Table 68: Setting for MODE and MEM_IO Bits
                MODE Setting                   MEM_IO setting          Transaction size
                            0                         Xa               Memory cycle (minimum
                                                                       8 byte memory read)
                            1                          0               I/O Cycle
                            1                          1               Memory cycle (minimum
                                                                       4 byte memory read)
               a. X means either 0 or 1.
PowerSpan II User Manual                                                                   Integrated Device Technology
80A1010_MA001_09                                                                                            www.idt.com


12. Register Descriptions                                                                                      273
                RD_AMT[2:0]: The read amount setting determines different values to prefetch from the destination
                bus.
                Table 69: Read Amount
                          RD_AMT[2:0]              Data Fetched
                              000                     8 bytes
                              001                    16 bytes
                              010                    32 bytes
                              011                    64 bytes
                              100                   128 bytes
                            101-111                 Reserved
Integrated Device Technology                                                            PowerSpan II User Manual
www.idt.com                                                                                   80A1010_MA001_09


274                                                                                                12. Register Descriptions
12.5.15        PCI-1 Target Image x Translation Address Register
 Register Name: P1_TIx_TADDR                                                 Register Offset: 0x104, 0x114, 0x124, 0x134
   PCI                                                                                                                   PB
   Bits                                                 Function                                                        Bits
  31-24                                                   TADDR                                                          0-7
  23-16                                                   TADDR                                                         8-15
  15-08                                           PowerSpan II Reserved                                                16-23
  07-00       M7           M6           M5           M4           M3           M2            M1             0          24-31
                                     Reset          Reset
      Name             Type            By           State                                Function
   TADDR[15:0]          R/W         P1_RST            0        Translation Address (through substitution)
                                                               When the TA_EN bit in the P1_TIx_CTL register is set,
                                                               TADDR[15:0] replaces the PCI-1 bus upper address bits. It
                                                               replaces the upper address bits up to the size of the image.
                                                               The TADDR[15:0] field can be changed while transactions
                                                               are being processed by PowerSpan II. This is the only
                                                               parameter that can be changed during a transaction. All other
                                                               programmable parameters must stay constant during a
                                                               transaction.
      M7-M1             R/W         P1_RST            0        Master Select
                                                               Indicates which external master(s) are qualified to access the
                                                               image.
                                                               0 = Do not claim transactions generated by this master
                                                               1 = Claim transactions generated by this master
               M7-M1: These bits indicate which external master(s) are qualified to access the image. The image
               supports master decode if the PCI Arbiter is enabled (the P1_ARB_EN bit in the RST_CSR register is
               set) and when the MD_EN bit in the P1_TIx_CTL register is set.
               Table 70 details external arbitration pins associated with bits M7-M1. The shaded combinations in the
               table identify external arbitration pins which can be used for PCI-1, depending on the programming of
               the PCI_M7, PCI_M6,PCI_M5 bits in the MISC_CSR register.
               Table 70: Arbitration Pin Mapping
                       Register Bit              External Arbitration Pins
                            M1                    P1_REQ#[1]/P1_GNT#[1]
                            M2                    P1_REQ#[2]/P1_GNT#[2]
PowerSpan II User Manual                                                                      Integrated Device Technology
80A1010_MA001_09                                                                                                  www.idt.com


12. Register Descriptions                                                                 275
                Table 70: Arbitration Pin Mapping
                        Register Bit        External Arbitration Pins
                            M3               P1_REQ#[3]/P1_GNT#[3]
                            M4               P1_REQ#[4]/P1_GNT#[4]
                            M5              PCI_REQ#[5]/PCI_GNT#[5]
                            M6              PCI_REQ#[6]/PCI_GNT#[6]
                            M7              PCI_REQ#[7]/PCI_GNT#[7]
Integrated Device Technology                                          PowerSpan II User Manual
www.idt.com                                                               80A1010_MA001_09


276                                                                                             12. Register Descriptions
12.5.16       PCI-1 to PCI-2 Configuration Cycle Information Register
              This register is used to set up the address phase of a PCI configuration cycle on PCI-2. This register is
              not implemented in the Single PCI PowerSpan II and must be treated as reserved.
 Register Name: P1_CONF_INFO                                                                     Register Offset: 0x144
   PCI                                                                                                             PB
   Bits                                                 Function                                                  Bits
  31-24                                          PowerSpan II Reserved                                             0-7
  23-16                                                BUS_NUM                                                    8-15
  15-08                            DEV_NUM                                            FUNC_NUM                   16-23
  07-00                                   REG_NUM                                          0         TYPE        24-31
                                     Reset         Reset
      Name            Type            By           State                               Function
 BUS_NUM [7:0]        R/W          P1_RST            0        Bus Number
 DEV_NUM [4:0]        R/W          P1_RST            0        Device Number
      FUNC_           R/W          P1_RST            0        Function Number
    NUM [2:0]
 REG_NUM [5:0]        R/W          P1_RST            0        Register Offset
       TYPE           R/W          P1_RST            0        Configuration Cycle Type
                                                              0 = Type 0
                                                              1 = Type 1
              TYPE: For a Configuration Type 1 cycle — with the TYPE bit set to 1— an access of the PCI-1
              Configuration Data register performs a corresponding Configuration Type 1 cycle on the PCI-2
              Interface. During the address phase of the Configuration Type 1 cycle, the PCI-2 address lines carry the
              values encoded in the P1_CONF_INFO register (P2_AD[31:0] = P1_CONF_INFO[31:0]).
PowerSpan II User Manual                                                                   Integrated Device Technology
80A1010_MA001_09                                                                                            www.idt.com


12. Register Descriptions                                                                                       277
                For a Configuration Type 0 cycle — with the TYPE bit set to 0 — an access of the PCI Configuration
                Data register performs a corresponding Configuration Type 0 cycle on the PCI-2 Interface.
                Programming the Device Number causes one of the upper address lines, P2_AD[31:11], to be asserted
                during the address phase of the Configuration Type 0 cycle as defined in Table 71.
                Table 71: PCI-2 AD[31:11] lines asserted during Configuration Type 0 cycles
                     DEV_NUM[4:0]                        P2_AD[31:11]
                          00000                   0000 0000 0000 0001 0000 0
                          00001                   0000 0000 0000 0010 0000 0
                          00010                   0000 0000 0000 0100 0000 0
                          00011                   0000 0000 0000 1000 0000 0
                          00100                   0000 0000 0001 0000 0000 0
                          00101                   0000 0000 0010 0000 0000 0
                          00110                   0000 0000 0100 0000 0000 0
                          00111                   0000 0000 1000 0000 0000 0
                          01000                   0000 0001 0000 0000 0000 0
                          01001                   0000 0010 0000 0000 0000 0
                          01010                   0000 0100 0000 0000 0000 0
                          01011                   0000 1000 0000 0000 0000 0
                          01100                   0001 0000 0000 0000 0000 0
                          01101                   0010 0000 0000 0000 0000 0
                          01110                   0100 0000 0000 0000 0000 0
                          01111                   1000 0000 0000 0000 0000 0
                          10000                   0000 0000 0000 0000 0000 1
                          10001                   0000 0000 0000 0000 0001 0
                          10010                   0000 0000 0000 0000 0010 0
                          10011                   0000 0000 0000 0000 0100 0
                          10100                   0000 0000 0000 0000 1000 0
                       10101-11111                0000 0000 0000 0000 0000 0
                The remaining address lines are:
                •   P2_AD[10:8] = FUNC_NUM[2:0]
Integrated Device Technology                                                                PowerSpan II User Manual
www.idt.com                                                                                       80A1010_MA001_09


278                                               12. Register Descriptions
              •    P2_AD[7:2] = REG_NUM[5:0]
              •    P2_AD[1:0] = 00
PowerSpan II User Manual                     Integrated Device Technology
80A1010_MA001_09                                              www.idt.com


12. Register Descriptions                                                                                            279
12.5.17         PCI-1 to PCI-2 Configuration Cycle Data Register
                A write to the Configuration Data register from the PCI-1 bus causes a Configuration Write Cycle to be
                generated on the PCI-2 Interface. This is defined by the “PCI-1 to PCI-2 Configuration Cycle
                Information Register” on page 276 (P1_CONF_INFO). A read of this register from the PCI-1 bus
                causes a Configuration Read Cycle to be generated on the PCI-2 Interface. The PCI Bus Configuration
                Cycles generated by accessing the Configuration Data register are handled as a posted write or delayed
                read.
                A write to the PCI Configuration Data register from the PCI-2 Interface or the Processor Bus has no
                effect. A read from PCI-2 Interface or the Processor Bus returns undefined data.
                This register is not implemented in the Single PCI PowerSpan II and must be treated as reserved.
 Register Name: P1_CONF_DATA                                                                    Register Offset: 0x148
    PCI                                                                                                           PB
    Bits                                                Function                                                 Bits
   31-24                                                 CDATA                                                   0-7
   23-16                                                 CDATA                                                   8-15
   15-08                                                 CDATA                                                  16-23
   07-00                                                 CDATA                                                  24-31
                                       Reset       Reset
       Name              Type           By         State                             Function
   CDATA [31:0]          R/W          P1_RST         0                           Configuration data
Integrated Device Technology                                                                 PowerSpan II User Manual
www.idt.com                                                                                         80A1010_MA001_09


280                                                                                           12. Register Descriptions
12.5.18       PCI-1 to PCI-2 Interrupt Acknowledge Cycle Generation Register
              Reading this register from the PCI-1 bus causes an IACK cycle to be generated on the PCI-2 Interface.
              The byte lanes enabled on the PCI-2 bus are determined by P1_CBE#[3:0] of the PCI-1 Memory Read
              cycle. The address on the PCI-1 bus used to access the P1_IACK register is passed directly over to the
              PCI-2 bus during the PCI IACK cycle. However, address information is ignored during PCI IACK
              cycles and has no effect.
              Reads from this register behave as delayed transfers. This means that the PCI-1 bus master is retried
              until the read data is latched from the PCI-2 target. When the IACK cycle completes on the PCI-2 bus,
              the IACK_VEC[31:0] field is returned as read data when the PCI-1 bus master returns after the retry.
              Writing to this register from the Processor Bus or either PCI bus has no effect. Reads from the PCI-2
              Interface and Processor Bus return all zeros.
              This register is not implemented in the Single PCI PowerSpan II and must be treated as reserved.
 Register Name: P1_IACK                                                                       Register Offset: 0x14C
   PCI                                                                                                           PB
   Bits                                                 Function                                                Bits
  31-24                                                IACK_VEC                                                 0-7
  23-16                                                IACK_VEC                                                 8-15
  15-08                                                IACK_VEC                                                16-23
  07-00                                                IACK_VEC                                                24-31
                                      Reset        Reset
      Name             Type            By          State                            Function
    IACK_VEC             R          P1_RST           0        PCI IACK Cycle Vector
       [31:0]
PowerSpan II User Manual                                                                 Integrated Device Technology
80A1010_MA001_09                                                                                          www.idt.com


12. Register Descriptions                                                                                                   281
12.5.19         PCI-1 Bus Error Control and Status Register
                The PCI-1 bus interface logs errors when it detects a Parity Error, Master-Abort, Target-Abort, or
                Maximum Retry conditions
 Register Name: P1_ERRCS                                                                                Register Offset: 150
    PCI                                                                                                                  PB
    Bits                                               Function                                                         Bits
   31-24                            PowerSpan II Reserved                                   MES             ES           0-7
   23-16                                        PowerSpan II Reserved                                                   8-15
   15-08                                        PowerSpan II Reserved                                                  16-23
   07-00                        CMDERR                                     PowerSpan II Reserved                       24-31
                                     Reset        Reset
       Name             Type          By           State                                 Function
        MES               R         P1_RST           0       Multiple Error Status
                                                             Indicates if multiple errors occur. The original error logging is
                                                             not overwritten when MES is set. Clearing ES also clears the
                                                             MES bit.
                                                             1 = a second error occurred before the first error could be
                                                             cleared.
         ES          R/Write 1 to   P1_RST           0       Error Status
                        clear                                When the ES bit is set, it means an error has been logged
                                                             and the contents of the CMDERR[3:0] and PAERR[31:0] of
                                                             the P1_AERR register are valid. Information in the log cannot
                                                             be changed while ES is set. Clearing the ES by writing 1 to
                                                             the bit allows the error log registers to capture future errors.
                                                             0 = no error currently logged
                                                             1 = error currently logged
   CMDERR [3:0]           R         P1_RST           0       PCI Command Error Log
Integrated Device Technology                                                                      PowerSpan II User Manual
www.idt.com                                                                                              80A1010_MA001_09


282                                                                                                12. Register Descriptions
12.5.20        PCI-1 Address Error Log Register
               The PCI-1 Interface logs errors when it detects a Parity Error, Master-Abort, Target-Abort, or
               Maximum Retry conditions.
 Register Name: P1_AERR                                                                             Register Offset: 0x154
   PCI                                                                                                                  PB
   Bits                                               Function                                                         Bits
  31-24                                                PAERR                                                            0-7
  23-16                                                PAERR                                                           8-15
  15-08                                                PAERR                                                          16-23
  07-00                                                PAERR                                                          24-31
                                    Reset        Reset
      Name           Type            By          State                                  Function
  PAERR [31:0]         R          P1_RST           0        PCI Address Error Log
                                                            The address of a PCI-1 bus transaction that generates an
                                                            error condition is logged in this register. When the error
                                                            occurs, the ES bit in the“PCI-1 Bus Error Control and Status
                                                            Register” on page 281 is set, qualifying and freezing the
                                                            contents of this register. This register logs additional errors
                                                            only after the ES bit in the P1_ERRCS register is cleared.
PowerSpan II User Manual                                                                     Integrated Device Technology
80A1010_MA001_09                                                                                                 www.idt.com


12. Register Descriptions                                                                                                283
12.5.21         PCI-1 Miscellaneous Control and Status Register
 Register Name: P1_MISC_CSR                                                                      Register Offset: 0x160
    PCI                                                                                                              PB
    Bits                                              Function                                                       Bits
   31-24                                       PowerSpan II Reserved                                                 0-7
   23-16                                       PowerSpan II Reserved                                                8-15
   15-08    BSREG_B          PowerSpan II Reserved                             MAX_RETRY                           16-23
              AR_
               EN
   07-00      MAC_                                   PowerSpan II Reserved                                         24-31
              ERR
                                     Reset         Reset
         Name             Type        By           State                               Function
    BSREG_BAR_EN           R/W      P1_RST           1       PCI-1 Registers Image Base Address Register enable.
                                                 EEPROM      When this bit is cleared, the “PCI-1 Register Image Base
                                                             Address Register” on page 258 is not visible in PCI-1
                                                             Configuration space and reads zero. Also, when this bit is
                                                             cleared writes have no effect when this bit is cleared.
                                                             When the P1_BSREG register is not visible in PCI-1
                                                             Configuration space, the PowerSpan II PCI-1 register
                                                             image is disabled and PowerSpan II does not request PCI
                                                             Memory space for the image.
                                                             0=disable
                                                             1=enable
    MAX_RETRY[3:0]         R/W      P1_RST           0       Maximum number of PCI Retry Terminations
                                                             0000 = retry forever
                                                             0001 = 64 retries
                                                             other - 224 retries
        MAC_ERR            R/W      P1_RST           1       Master Abort Configuration Error Mapping
                                                             0 = generate target abort when master abort occurs on
                                                             PCI-2 configuration cycles
                                                             1 = return all ones when Master-Abort occurs on PCI-2
                                                             configuration cycles
                                                             Single PCI PowerSpan II: Reserved
Integrated Device Technology                                                                  PowerSpan II User Manual
www.idt.com                                                                                         80A1010_MA001_09


284                                                                                                12. Register Descriptions
12.5.22       PCI-1 Bus Arbiter Control Register
              PowerSpan II’s PCI-1 interface has dedicated support for four external PCI masters. The user can
              assign up to three additional PCI masters to the PCI-1 arbiter by configuring the PCI_M7 bit, the
              PCI_M6 bit, and the PCI_M5 in the “Miscellaneous Control and Status Register” on page 318.
                             Depending on the number of external masters supported, some of bits M4-M7
                             and combinations of BM_PARK are not applicable. Programming these
                             combinations result in unpredictable PowerSpan II behavior.
              The PowerSpan II PCI-1 internal arbiter is enabled by a power-up option. When disabled, an external
              arbiter is used. The signals P1_REQ[1]_/P1_GNT[1]_ are used by the PowerSpan II PCI-1 Master to
              arbitrate for access to the bus.
              The P1_ARB_EN bit in the “Reset Control and Status Register” on page 324 specifies if the PCI-1
              arbiter is enabled or disabled.
 Register Name: P1_ARB_CTRL                                                                         Register Offset: 0x164
   PCI                                                                                                                   PB
   Bits                                               Function                                                          Bits
  31-24                                        PowerSpan II Reserved                                                     0-7
  23-16                                             STATUS_BITS                                                         8-15
  15-08     M7_PRI      M6_PRI       M5_PRI      M4_PRI       M3_PRI         M2_PRI        M1_PRI       PS_PRI         16-23
  07-00         PowerSpan II Reserved           STATUS_        PARK                      BM_PARK                       24-31
                                                   EN
                                     Reset        Reset
      Name             Type            By         State                                  Function
    STATUS_            R/W          P1_RST          0        Operational status of PCI Master Device x
       BITS                                                  These series of bits are separated per master. There is one
                                                             bit designated for each master and is separate from the
                                                             others, but all eight are called STATUS_BITS[7:0]. The
                                                             individual bits are set when a PCI Master does not respond to
                                                             a grant given by the PowerSpan II arbiter for 16 clock cycles.
                                                             Once this bit is set to 1 by the PowerSpan II arbiter, the
                                                             PowerSpan II arbiter does not include the non-functioning
                                                             PCI Master in the arbitration algorithm used by PowerSpan II.
                                                             When the bit is set to 0, the operating status of the PCI
                                                             Master is functioning and it is included in the arbitration
                                                             algorithm used by PowerSpan II.
                                                             0 = functioning
                                                             1 = non-functioning
PowerSpan II User Manual                                                                      Integrated Device Technology
80A1010_MA001_09                                                                                                 www.idt.com


12. Register Descriptions                                                                                                  285
                                      Reset        Reset
       Name             Type           By          State                                  Function
      Mx_PRI             R/W         P1_RST          0        Arbitration Level for PCI Master Device x
                                                              Determines the arbitration priority level for PCI Master agents
                                                              assigned to the PCI-1 arbiter.
                                                              0 = low priority
                                                              1 = high priority
      PS_PRI             R/W         P1_RST          0        Arbitration Level for PowerSpan II
                                                              0 = low priority
                                                              1 = high priority
    STATUS_EN            R/W         P1_RST          0        Enable monitoring of master by arbiter
                                                              Enables internal monitor of the PowerSpan II PCI arbiter. The
                                                              monitor checks that no PCI Master waits longer than 16 PCI
                                                              clock cycles before starting a transaction.
                                                              0 = disabled
                                                              1 = enabled
       PARK              R/W         P1_RST          0        PCI-1 Bus Parking Algorithm
                                                              When this bit is set the arbiter parks the PCI-1 bus on the PCI
                                                              master programmed in the BM_PARK[2:0] field. When
                                                              cleared the arbiter parks the PCI-1 bus on the last PCI master
                                                              to be granted the bus.
                                                              0 = last master
                                                              1 = select master
  BM_PARK [2:0]          R/W         P1_RST          0        Parked Master
                                                              This field instructs the arbiter where to park the bus. The
                                                              shaded combinations in Table 72 identifies potential PCI-1
                                                              external masters. Their presence depends on the
                                                              programming of the PCI_M7,PCI_M6,PCI_M5 bits in the
                                                              “Miscellaneous Control and Status Register” on page 318
                                                              register.
                BM_PARK[2:0]: This field instructs the arbiter where to park the bus. The shaded combinations in
                Table 72 identifies potential PCI-1 external masters. Their presence depends on the programming of
                the PCI_M7,PCI_M6,PCI_M5 bits in the MISC_CSR register.
                Table 72: Parked PCI Master
                      BM_PARK [2:0]            Parked PCI Master                    External Pins
                            000                   PowerSpan II                          None
                            001                        M1                     P1_REQ#[1]/P1_GNT#[1]
                            010                        M2                     P1_REQ#[2]/P1_GNT#[2]
Integrated Device Technology                                                                       PowerSpan II User Manual
www.idt.com                                                                                              80A1010_MA001_09


286                                                                          12. Register Descriptions
              Table 72: Parked PCI Master
                    BM_PARK [2:0]      Parked PCI Master      External Pins
                         011                  M3          P1_REQ#[3]/P1_GNT#[3]
                         100                  M4          P1_REQ#[4]/P1_GNT#[4]
                         101                  M5         PCI_REQ#[5]/PCI_GNT#[5]
                         110                  M6         PCI_REQ#[6]/PCI_GNT#[6]
                         111                  M7         PCI_REQ#[7]/PCI_GNT#[7]
PowerSpan II User Manual                                                Integrated Device Technology
80A1010_MA001_09                                                                         www.idt.com


12. Register Descriptions                                                                                                   287
12.5.23         Processor Bus Slave Image x Control Register
                This register contains the control information for the “Processor Bus Slave Image x Control Register”
                on page 287.
                              The bits in this register are not dynamic. Do not alter these settings while
                              transactions are being processed through PowerSpan II. Refer to “Processor Bus
                              Slave Image x Translation Address Register” on page 292 for more information
                              on dynamic address translation.
                                                                       Register Offset: 0x200, 0x210, 0x220, 0x230, 0x240,
 Register Name: PB_SIx_CTL                                                                                0x250, 0x260, 0x270
    PCI                                                                                                                  PB
    Bits                                                  Function                                                      Bits
   31-24     IMG_EN       TA_EN       MD_EN                                        BS                                   0-7
   23-16      MODE        DEST        MEM_IO                           PowerSpan II Reserved                            8-15
   15-08                                           PowerSpan II Reserved                                               16-23
   07-00    PRKEEP               END                   0             0                      RD_AMT                     24-31
                                      Reset          Reset
       Name             Type            By           State                                 Function
      IMG_EN             R/W         PB_RST       0 EEPROM       Image Enable
                                                                 The Image Enable bit is changed in the following ways:
                                                                 • EEPROM initialization
                                                                 • register write to IMG_EN
                                                                 The IMG_EN is cleared by writing a zero to the bit.
                                                                 0=Disable
                                                                 1=Enable
       TA_EN             R/W         PB_RST       0 EEPROM       Translation Address Enable
                                                                 When set, the Translation Address (“Processor Bus Slave
                                                                 Image x Translation Address Register” on page 292) replaces
                                                                 the upper bits of the Processor Bus address. Clearing the
                                                                 enable results in no address translation.
                                                                 0=Disable
                                                                 1=Enable
Integrated Device Technology                                                                       PowerSpan II User Manual
www.idt.com                                                                                                80A1010_MA001_09


288                                                                               12. Register Descriptions
                           Reset    Reset
     Name            Type   By      State                            Function
    MD_EN             R/W PB_RST      0   Master Decode Enable
                                  EEPROM  Enables Master Decode when the Processor Bus arbiter is in
                                          use — the Processor Bus Arbiter Enable bit, in the “Reset
                                          Control and Status Register” on page 324, is set. If MD_EN is
                                          cleared, only the Processor Bus Address and Transaction
                                          Type are used for transaction decode. If MD_EN is set, the
                                          originating master is included in the transaction decode. A
                                          transaction is claimed only if it originates from the master(s)
                                          specified in “Processor Bus Slave Image x Translation
                                          Address Register” on page 292.
                                          0=Disable
                                          1=Enable
     BS[4:0]          R/W PB_RST 0 EEPROM Block Size
                                          (4 Kbyte*2BS)
                                          Specifies the size of the image, address lines compared and
                                          address lines translated (see Table 73 on page 289).
     MODE             R/W PB_RST      0   Image Mode
                                  EEPROM  Determines if the image is used to generate Memory or IO
                                          commands on PCI.
                                          0 = Memory command generation
                                          1 = I/O command generation or 4 byte memory read (see
                                          Table 74 on page 291)
     DEST             R/W PB_RST      0   Destination Bus
                                  EEPROM  Selects the destination bus for the transaction.
                                          0 = PCI 1 bus
                                          1 = PCI-2 bus
                                          Single PCI PowerSpan II: Reserved
                                          PCI-1 Bus is the only destination.
    MEM_IO            R/W PB_RST      0   MEM_IO mode
                                          PowerSpan II supports 4-byte reads. When this bit is set, the
                                          Memory Read command to the corresponding image
                                          generates the Memory Read command on the destination
                                          PCI bus with a minimum 32 bit aligned 4-byte read.
                                          The MODE bit and the MEM_IO bit work together to control
                                          the size of the transaction (see Table 74 on page 291).
                                          0 = Regular I/O mode
                                          1 = Enables 1,2,3, or 4 byte memory reads on the PCI
                                          bus(es)
PowerSpan II User Manual                                                    Integrated Device Technology
80A1010_MA001_09                                                                               www.idt.com


12. Register Descriptions                                                                                                 289
                                      Reset        Reset
       Name             Type           By          State                                   Function
     PRKEEP              R/W        PB_RST            0       Prefetch Read Keep
                                                 EEPROM       Prefetch Read Keep stores prefetch data beyond an initial
                                                              read. When set, subsequent read requests to the same
                                                              image at the next address retrieves the read data directly
                                                              from the switching fabric instead of causing either PCI bus to
                                                              fetch more data. The read data is invalidated when a read
                                                              with a non-matching address occurs
                                                              0 = purge read data at end of transfer
                                                              1 = keep read data
                                                              Caution: The ARTRY_EN bit must be set to 1 in order for the
                                                              PowerSpan II Prefetch Keep feature to keep prefetched data.
                                                              The ARTRY_EN bit is in the “Processor Bus Miscellaneous
                                                              Control and Status Register” on page 304.
     END[1:0]            R/W         P1_RST         10b       Endian Conversion Mode
                                                 EEPROM       Selects the endian mapping.
                                                              00 = Little-endian
                                                              01 = PowerPC little-endian
                                                              10 = Big-endian
                                                              11 = True little-endian
     RD_AMT              R/W        PB_RST            0       Read Prefetch Amount
        [2:0]                                    EEPROM       Amount of read data fetched from PCI.
                                                              If PRKEEP is not set, it is recommended limiting the RD_AMT
                                                              to 32-bytes (see Table 75 on page 291).
                                                              If the slave image is programmed to be in IO mode (the
                                                              MODE bit in the “Processor Bus Slave Image x Control
                                                              Register” on page 287 set to 1 then the RD_AMT is not used
                                                              and a maximum of 4 bytes will be read from the PCI bus.
                BS: Specifies the size of the image, address lines compared and address lines translated.
                Table 73: Block Size
                          BS[4:0]                Block Size           Address Lines Compared/Translated
                           00000                      4k                              A0-A19
                           00001                      8k                              A0-A18
                           00010                     16k                              A0-A17
                           00011                    32k                               A0-A16
                           00100                     64k                              A0-A15
                           00101                    128k                              A0-A14
Integrated Device Technology                                                                      PowerSpan II User Manual
www.idt.com                                                                                            80A1010_MA001_09


290                                                                                            12. Register Descriptions
              Table 73: Block Size
                        BS[4:0]               Block Size          Address Lines Compared/Translated
                         00110                   256k                            A0-A13
                         00111                   512k                            A0-A12
                         01000                    1M                             A0-A11
                         01001                    2M                             A0-A10
                         01010                    4M                              A0-A9
                         01011                    8M                              A0-A8
                         01100                    16M                             A0-A7
                         01101                    32M                             A0-A6
                         01110                    64M                             A0-A5
                         01111                   128M                             A0-A4
                         10000                   256M                             A0-A3
                         10001                   512M                             A0-A2
                         10010                     1G                             A0-A1
                         10011                     2G                               A0
                      10100-11111              Reserved                         Reserved
              MODE: Determines if the image is used to generate Memory or IO commands on PCI.
              •    Memory Command Mode
                   Causes PCI Memory commands to be generated on PCI. Bursting is supported.
                   PRKEEP and RD_AMT[2:0] are only applicable in Memory Command Mode.
              •    IO Command Mode
                   Causes PCI IO commands to be generated on PCI. When the image is selected to perform IO
                   commands, transactions are limited to 4 bytes or less. A transaction attempting to move more than
                   4 bytes will cause a TEA_ response. The TEA_ can be suppressed by setting the
                   PB_MISC_CSR[TEA_EN] bit.
PowerSpan II User Manual                                                                  Integrated Device Technology
80A1010_MA001_09                                                                                           www.idt.com


12. Register Descriptions                                                                                             291
                The MODE bit and the MEM_IO bit work together to control the size of the transaction (see Table 74).
                Table 74: Setting for MODE and MEM_IO Bits
                 MODE Setting                     MEM_IO setting         Transaction size
                              0                          Xa              Memory cycle (minimum
                                                                         8 byte memory read)
                              1                           0              I/O cycle
                              1                           1              Memory cycle
                                                                         (1,2,3, or 4 byte memory
                                                                         reads on the PCI bus(es))
                a. X means either 0 or 1.
                PRKEEP: Prefetch Read Keep stores prefetch data beyond an initial read. When set, subsequent read
                requests to the same image at the next address retrieves the read data directly from the switching fabric
                instead of causing either PCI bus to fetch more data. The read data is invalidated when a read with a
                non-matching address occurs.
                                The ARTRY_EN bit must be set to 1 in order for the PowerSpan II Prefetch
                                Keep feature to keep prefetched data. The ARTRY_EN bit is in the “Processor
                                Bus Miscellaneous Control and Status Register” on page 304.
                RD_AMT[2:0]: The Read Amount setting determines different values to prefetch from PCI. If
                PRKEEP is not set, it is recommended limiting the RD_AMT to 32-bytes.
                Table 75: Read Amount
                          RD_AMT[2:0]                      Data Fetched
                                000                           8 bytes
                                001                          16 bytes
                                010                          32 bytes
                                011                          64 bytes
                                100                         128 bytes
                             101-111                        Reserved
                If the slave image is programmed to be in IO mode (the MODE bit in the “Processor Bus Slave Image
                x Control Register” on page 287 set to 1 then the RD_AMT is not used and a maximum of 4 bytes will
                be read from the PCI bus.
                                The EEPROM load capability allows a processor on the Processor Bus to boot
                                directly from a device on PCI. Only the control registers for Processor Bus Slave
                                Image 0 are loaded from EEPROM.
Integrated Device Technology                                                                      PowerSpan II User Manual
www.idt.com                                                                                           80A1010_MA001_09


292                                                                                           12. Register Descriptions
12.5.24       Processor Bus Slave Image x Translation Address Register
                                                               Register Offset: 0x204, 0x214, 0x224, 0x234, 0x244,
 Register Name: PB_SIx_TADDR                                                                      0x254, 0x264, 0x274
   PCI                                                                                                            PB
   Bits                                            Function                                                      Bits
  31-24                                             TADDR                                                         0-7
  23-16                                             TADDR                                                        8-15
  15-08                      TADDR                                    PowerSpan II Reserved                     16-23
  07-00               PowerSpan II Reserved                 M3            M2            M1             0        24-31
                                     Reset       Reset
        Name            Type          By         State                                Function
    TADDR[19:0]          R/W        PB_RST         0       Translation Address
                                               EEPROM      The Translation Address register replaces the Processor
                                                           Bus address, up to the size of the image. TADDR[31:12]
                                                           replace the Processor Bus PB_A[0:19] (see Table 76 on
                                                           page 293).
        M3-M1            R/W        PB_RST         0       Master Select
                                               EEPROM      These bits indicate which external master(s) are qualified
                                                           to access the image. The image supports master decode if
                                                           the Processor Bus arbiter is enabled — the Processor Bus
                                                           Arbiter Enable bit, in the “Reset Control and Status
                                                           Register” on page 324, is set and when MD_EN bit in the
                                                           “Processor Bus Slave Image x Control Register” on
                                                           page 287 is set. Bit M3 represents the external master
                                                           connected to PB_BG[3]_ and M1 represents the external
                                                           master connected to PB_BG[1]_.
                                                           0=Do not claim transactions generated by this master
                                                           1=Claim transactions generated by this master
              TADDR: The Translation Address register replaces the Processor Bus address, up to the size of the
              image. TADDR[31:12] replace the Processor Bus PB_A[0:19].
              For example, if TADDR[31:12] = 0x12345 and PB_SIx_CTL[BS]=0 (4 K image) and the address on
              the Processor Bus is PB_A[0:31] = 0x78563412, then the PCI address becomes 0x12345412
PowerSpan II User Manual                                                                 Integrated Device Technology
80A1010_MA001_09                                                                                           www.idt.com


12. Register Descriptions                                                                                         293
                The TADDR[19:0] field can be changed while transactions are being processed by PowerSpan II. This
                is the only parameter that can be changed during a transaction. All other programmable parameters
                must stay constant during a transaction.
Table 76: Translation Address Mapping
  PB_SIx_TADDR[]          Processor Bus Address PB_A              PB_SIx_CTL[BS]                  Block Size
         31                             0                               10011                         2G
        31:30                          0:1                              10010                         1G
        31:29                          0:2                              10001                       512M
        31:28                          0:3                              10000                       256M
        31:27                          0:4                               01111                      128M
        31:26                          0:5                              01110                        64M
        31:25                          0:6                              01101                        32M
        31:24                          0:7                              01100                        16M
        31:23                          0:8                              01011                         8M
        31:22                          0:9                              01010                         4M
        31:21                         0:10                              01001                         2M
        31:20                         0:11                              01000                         1M
        31:19                         0:12                              00111                        512k
        31:18                         0:13                              00110                        256k
        31:17                         0:14                              00101                        128k
        31:16                         0:15                              00100                        64k
        31:15                         0:16                              00011                        32k
        31:14                         0:17                              00010                        16k
        31:13                         0:18                              00001                         8k
        31:12                         0:19                              00000                         4k
                M3-M1: These bits indicate which external master(s) are qualified to access the image. The image
                supports master decode if the Processor Bus arbiter is enabled — the Processor Bus Arbiter Enable bit,
                in the “Reset Control and Status Register” on page 324, is set and when MD_EN bit in the
                PB_SIx_CTL is set. Bit M3 represents the external master connected to PB_BG[3]_ and M1 represents
                the external master connected to PB_BG[1]_.
Integrated Device Technology                                                                 PowerSpan II User Manual
www.idt.com                                                                                       80A1010_MA001_09


294                                                                                                12. Register Descriptions
12.5.25          Processor Bus Slave Image x Base Address Register
                 This register defines the lowest address of the slave image. The minimum image size is 4 Kbyte as
                 defined in BS field in the PB_SIx_CTL.
                 The initial write to this register sets the IMG_EN bit in the “Processor Bus Slave Image x Control
                 Register” on page 287. Subsequent writes to this register will have no effect on the IMG_EN bit.
                               A base address of 0 is valid.
                                                                     Register Offset: 0x208, 0x218, 0x228, 0x238, 0x248,0x
 Register Name: PB_SIx_BADDR                                                                             258, 0x268, 0x278
   PCI                                                                                                                PB
   Bits                                                     Function                                                 Bits
  31-24                                                        BA                                                    0-7
  23-16                                                        BA                                                    8-15
  15-08                             BA                               0           0            0            0        16-23
  07-00                                              PowerSpan II Reserved                                          24-31
                                             Reset          Reset
         Name                 Type             By           State                           Function
        BA[19:0]              R/W           PB_RST       0 EEPROM     Processor Bus Base Address
PowerSpan II User Manual                                                                      Integrated Device Technology
80A1010_MA001_09                                                                                               www.idt.com


12. Register Descriptions                                                                                                295
12.5.26           Processor Bus Register Image Base Address Register
                  This register defines the Processor Bus address offset for PowerSpan II internal registers. The register
                  can be loaded by an external EEPROM.
                                A base address of 0 is valid.
 Register Name: PB_REG_BADDR                                                                        Register Offset: 0x280
    PCI                                                                                                               PB
    Bits                                                  Function                                                   Bits
   31-24                                                      BA                                                      0-7
   23-16                                                      BA                                                     8-15
   15-08                            BA                                      PowerSpan II Reserved                   16-23
   07-00                                     PowerSpan II Reserved                                      END         24-31
                                             Reset        Reset
          Name                 Type           By          State                             Function
         BA[19:0]              R/W          PB_RST      0x30000     Processor Bus Register Base Address
                                                        EEPROM      The base address for the Processor Bus Base Address
                                                                    image represent the upper address bits (A[31:12]). The
                                                                    base address for the processor address bus at reset is
                                                                    0x3000_0000.
          END                  R/W          PB_RST          0       Endian Conversion Mode
                                                        EEPROM      The endian conversion mode for processor access to
                                                                    PowerSpan II registers.
                                                                    0 = Big-endian
                                                                    1 = PowerPC little-endian
Integrated Device Technology                                                                     PowerSpan II User Manual
www.idt.com                                                                                           80A1010_MA001_09


296                                                                                                12. Register Descriptions
12.5.27       Processor Bus PCI Configuration Cycle Information Register
              This register is used to set up the address phase of a PCI Configuration cycle.
 Register Name: PB_CONF_INFO                                                                        Register Offset: 0x290
   PCI                                                                                                                PB
   Bits                                                 Function                                                     Bits
  31-24       0            0            0            0            0             0            0          DEST         0-7
  23-16                                                BUS_NUM                                                       8-15
  15-08                            DEV_NUM                                             FUNC_NUM                     16-23
  07-00                                   REG_NUM                                            0          TYPE        24-31
                                        Reset        Reset
        Name             Type            By           State                              Function
        DEST             R/W          PB_RST            0        Destination Bus
                                                                 0 = PCI 1
                                                                 1 = PCI-2
        DEST             R/W          PB_RST            0        Single PCI PowerSpan II: Reserved
                                                                 PCI-1 Bus is the only destination.
   BUS_NUM[7:0]          R/W          PB_RST            0        Bus Number
   DEV_NUM[4:0]          R/W          PB_RST            0        Device Number
  FUNC_NUM[2:0]          R/W          PB_RST            0        Function Number
   REG_NUM[5:0]          R/W          PB_RST            0        Register Number
        TYPE             R/W          PB_RST            0        Configuration Cycle Type
                                                                 0 = Type 0
                                                                 1 = Type 1
              TYPE: For a Configuration Type 1 cycle — with the TYPE bit set to 1— an access of the PCI
              Configuration Data register performs a corresponding Configuration Type 1 cycle on either PCI bus.
              During the address phase of the Configuration Type 1 cycle, the PCI address lines carry the values
              encoded in the PB_CONF_INFO register (AD[31:0] = PB_CONF_INFO[31:0]). The Destination
              (DEST) field, in the PB_CONF_INFO register, is an exception to this because it is zero on AD[24].
PowerSpan II User Manual                                                                     Integrated Device Technology
80A1010_MA001_09                                                                                               www.idt.com


12. Register Descriptions                                                                                       297
                For a Configuration Type 0 cycle — with the TYPE bit set to 0 — an access of the PCI Configuration
                Data register performs a corresponding Configuration Type 0 cycle on either PCI bus. Programming
                the Device Number causes the assertion of one of the upper address lines, AD[31:11], during the
                address phase of the Configuration Type 0 cycle. This is shown in Table 77.
                Table 77: PCI AD[31:11] lines asserted during Configuration Type 0 cycles
                     DEV_NUM[4:0]                          AD[31:11]
                          00000                   0000 0000 0000 0001 0000 0
                          00001                   0000 0000 0000 0010 0000 0
                          00010                   0000 0000 0000 0100 0000 0
                          00011                   0000 0000 0000 1000 0000 0
                          00100                   0000 0000 0001 0000 0000 0
                          00101                   0000 0000 0010 0000 0000 0
                          00110                   0000 0000 0100 0000 0000 0
                          00111                   0000 0000 1000 0000 0000 0
                          01000                   0000 0001 0000 0000 0000 0
                          01001                   0000 0010 0000 0000 0000 0
                          01010                   0000 0100 0000 0000 0000 0
                          01011                   0000 1000 0000 0000 0000 0
                          01100                   0001 0000 0000 0000 0000 0
                          01101                   0010 0000 0000 0000 0000 0
                          01110                   0100 0000 0000 0000 0000 0
                          01111                   1000 0000 0000 0000 0000 0
                          10000                   0000 0000 0000 0000 0000 1
                          10001                   0000 0000 0000 0000 0001 0
                          10010                   0000 0000 0000 0000 0010 0
                          10011                   0000 0000 0000 0000 0100 0
                          10100                   0000 0000 0000 0000 1000 0
                       10101-11111                0000 0000 0000 0000 0000 0
                The remaining address lines are:
                •   AD[10:8] = FUNC_NUM[2:0]
Integrated Device Technology                                                                PowerSpan II User Manual
www.idt.com                                                                                     80A1010_MA001_09


298                                                                                        12. Register Descriptions
              •    AD[7:2] = REG_NUM[5:0]
              •    AD[1:0] = 00
                           PowerSpan II does not generate configuration cycles to devices connected to
                           AD[15:11].
PowerSpan II User Manual                                                              Integrated Device Technology
80A1010_MA001_09                                                                                       www.idt.com


12. Register Descriptions                                                                                             299
12.5.28         Processor Bus Configuration Cycle Data Register
                A write to the Configuration Data register from the Processor Bus causes a Configuration Write Cycle
                to be generated on either PCI bus as defined by the “Processor Bus PCI Configuration Cycle
                Information Register” on page 296. A read of this register from the Processor Bus causes a
                Configuration Read Cycle to be generated on either PCI bus. The PCI Bus Configuration Cycles
                generated by accessing the Configuration Data register is handled as a posted write or delayed read.
                The byte lanes enabled on the PCI bus are determined by PB_SIZ[0:3] and PB_A[30:31] of the
                Processor Bus read or write cycle.
                A write to the PCI Configuration Data register from the either PCI bus has no effect. A read from either
                PCI bus is undefined.
                The END bit in the “Processor Bus Register Image Base Address Register” on page 295 selects the
                endian conversion scheme used for accesses to PCI through this register. The definition of endian
                conversion scheme is for PCI accesses, not register accesses.
 Register Name: PB_CONF_DATA                                                                     Register Offset: 0x294
    PCI                                                                                                            PB
    Bits                                               Function                                                   Bits
   31-24                                                 CDATA                                                    0-7
   23-16                                                 CDATA                                                    8-15
   15-08                                                 CDATA                                                   16-23
   07-00                                                 CDATA                                                   24-31
                                      Reset        Reset
       Name             Type           By          State                             Function
    CDATA[31:0]          R/W        PB_RST           0        Configuration Data
Integrated Device Technology                                                                 PowerSpan II User Manual
www.idt.com                                                                                        80A1010_MA001_09


300                                                                                            12. Register Descriptions
12.5.29       Processor Bus to PCI-1 Interrupt Acknowledge Cycle Generation Register
              This register is used to generate an Interrupt Acknowledge cycle originating on the Processor Bus and
              destined for the PCI-1 bus. Reading this register from the Processor Bus causes an IACK cycle to be
              generated on the PCI bus. The byte lanes enabled on the PCI bus are determined by PB_SIZ[0:3] and
              PB_A[30:31] of the Processor Bus read cycle. The address on the Processor Bus used to access the
              PB_P1_IACK register is passed directly over to the PCI bus during the PCI IACK cycle. However,
              address information is ignored during PCI IACK cycles, so this has no effect.
 Register Name: PB_P1_IACK                                                                      Register Offset: 0x2A0
   PCI                                                                                                             PB
   Bits                                                Function                                                   Bits
  31-24                                               IACK_VEC                                                    0-7
  23-16                                               IACK_VEC                                                    8-15
  15-08                                               IACK_VEC                                                   16-23
  07-00                                               IACK_VEC                                                   24-31
                                        Reset        Reset
        Name              Type            By         State                             Function
  IACK_VEC[31:0]           R           PB_RST          0        PCI IACK Cycle Vector
              If the Address Retry Enable (ARTRY_EN) bit is set, in the“PCI-1 Miscellaneous 1 Register” on
              page 262, the Processor Bus Master is retried until the read data is latched from the PCI target. When
              the IACK cycle completes on the PCI-1 bus, the IACK_VEC[31:0] field is returned as read data when
              the Processor Bus Master returns after the retry.
              Writing to this register from the Processor Bus or either PCI bus has no effect. Reads from the PCI bus
              return all zeros.
              The END bit in the “Processor Bus Register Image Base Address Register” on page 295 selects the
              endian conversion scheme used for accesses to PCI through this register. The definition of endian
              conversion scheme is for PCI accesses, not register accesses.
PowerSpan II User Manual                                                                  Integrated Device Technology
80A1010_MA001_09                                                                                           www.idt.com


12. Register Descriptions                                                                                              301
12.5.30         Processor Bus to PCI-2 Interrupt Acknowledge Cycle Generation Register
                This register is used to generate an Interrupt Acknowledge cycle originating on the Processor Bus and
                destined for the PCI-2 bus. Reading this register from the Processor Bus causes an IACK cycle to be
                generated on the PCI bus. The byte lanes enabled on the PCI bus are determined by PB_SIZ[0:3] and
                PB_A[30:31] of the Processor Bus read cycle. The address on the Processor Bus used to access the
                PB_P1_IACK register is passed directly over to the PCI bus during the PCI IACK cycle. However this
                has no effect because address information is ignored during PCI IACK cycles.
 Register Name: PB_P2_IACK                                                                       Register Offset: 0x2A4
    PCI                                                                                                             PB
    Bits                                                 Function                                                  Bits
   31-24                                                IACK_VEC                                                    0-7
   23-16                                                IACK_VEC                                                   8-15
   15-08                                                IACK_VEC                                                  16-23
   07-00                                                IACK_VEC                                                  24-31
                                          Reset        Reset
         Name              Type             By         State                             Function
   IACK_VEC[31:0]            R          PB_RST           0        PCI IACK Cycle Vector
                If the Address Retry Enable (ARTRY_EN)) bit is set, in the“PCI-1 Miscellaneous 1 Register” on
                page 262, the Processor Bus Master is retried until the read data is latched from the PCI target. When
                the IACK cycle completes on the PCI-2 bus, the IACK_VEC[31:0] field is returned as read data when
                the Processor Bus Master returns after the retry.
                Writing to this register from the Processor Bus, or either PCI bus, has no effect. Reads from the PCI
                bus return all zeros.
                The END bit in the “Processor Bus Register Image Base Address Register” on page 295 selects the
                endian conversion scheme used for accesses to PCI through this register. The definition of endian
                conversion scheme is for PCI accesses, not register accesses.
                This register is not implemented in the Single PCI PowerSpan II and must be treated as reserved.
Integrated Device Technology                                                                   PowerSpan II User Manual
www.idt.com                                                                                         80A1010_MA001_09


302                                                                                               12. Register Descriptions
12.5.31        Processor Bus Error Control and Status Register
               The Processor Bus Interface logs errors when it detects a maximum retry error, parity error or assertion
               of PB_TEA_ conditions.
 Register Name: PB_ERRCS                                                                            Register Offset: 0x2B0
   PCI                                                                                                                  PB
   Bits                                               Function                                                         Bits
  31-24                            PowerSpan II Reserved                                   MES            ES           0-7
  23-16                                        PowerSpan II Reserved                                                   8-15
  15-08                             TT_ERR                                       PowerSpan II Reserved                16-23
  07-00                       SIZ_ERR                                     PowerSpan II Reserved                       24-31
                                    Reset        Reset
      Name            Type           By          State                                  Function
       MES              R          PB_RST          0        Multiple Error Status
                                                            Determines if multiple errors occur. The Processor Bus error
                                                            logs are not overwritten when MES is set. Clearing ES also
                                                            clears MES.
                                                            1 = a second error occurred before the first error could be
                                                            cleared.
        ES         R/Write 1 to    PB_RST          0        Error Status
                      Clear                                 When the ES bit is set, it means an error has been logged
                                                            and the contents of the TT_ERR, SIZ_ERR and AERR are
                                                            valid. Information in the log cannot be changed while ES is
                                                            set. Clearing the ES by writing a one to the bit allows the error
                                                            log registers to capture future errors.
                                                            0 = no error currently logged
                                                            1 = error currently logged
   TT_ERR[4:0]          R          PB_RST          0        Processor Bus Transaction Type Error Log
  SIZ_ERR[3:0]         R           PB_RST          0        Processor Bus SIZ field Error Log
PowerSpan II User Manual                                                                     Integrated Device Technology
80A1010_MA001_09                                                                                                 www.idt.com


12. Register Descriptions                                                                                                  303
12.5.32         Processor Bus Address Error Log
                The Processor Bus Interface logs errors when it detects a maximum retry error, parity error or assertion
                of PB_TEA_ conditions.
 Register Name: PB_AERR                                                                              Register Offset: 0x2B4
    PCI                                                                                                                 PB
    Bits                                                 Function                                                      Bits
   31-24                                                   AERR                                                         0-7
   23-16                                                   AERR                                                        8-15
   15-08                                                   AERR                                                       16-23
   07-00                                                   AERR                                                       24-31
                                       Reset         Reset
       Name              Type            By          State                                 Function
    AERR[31:0]             R          PB_RST           0        Processor Bus Error Log
                The address of a processor bus transaction that generates an error condition is logged in this register.
                When the error occurs, the ES bit in the “Processor Bus Error Control and Status Register” on page 302
                is set, qualifying and freezing the contents of this register. This register logs additional errors only after
                the ES bit is cleared.
Integrated Device Technology                                                                       PowerSpan II User Manual
www.idt.com                                                                                              80A1010_MA001_09


304                                                                                          12. Register Descriptions
12.5.33        Processor Bus Miscellaneous Control and Status Register
 Register Name: PB_MISC_CSR                                                                   Register Offset: 0x2C0
   PCI                                                                                                            PB
   Bits                                          Function                                                        Bits
  31-24                                    PowerSpan II Reserved                                                  0-7
  23-16                                    PowerSpan II Reserved                                                 8-15
  15-08              PowerSpan II Reserved                                  MAX_RETRY                           16-23
  07-00       EXT      MAC_       MODE_     TEA_EN      ARTRY_          DP_EN        AP_EN        PARITY        24-31
              CYC        TEA       7400                     EN
                                  Reset      Reset
      Name           Type          By        State                                  Function
  MAX_RETRY           R/W        PB_RST        0        Maximum number of retries. Except for 0000, all entries are
        [3:0]                                           multiples of 64 retries
                                                        0000 = retry forever
                                                        0001 = 64 retries
                                                        0010 = 128 retries
                                                        0011 = 192 retries, etc.
     EXTCYC           R/W        PB_RST        0        Determines if the PowerSpan II PB master is enabled to
                                                        generate extended cycles (16 byte or 24 byte)
                                                        This ability improves performance of PowerQUICC II
                                                        systems. The EXTCYC bit must be set to 0 in order to ensure
                                                        compatibility with WinPath and other PowerPC devices.
                                                        0 = Cannot generate extended cycle
                                                        1= Can generate extended cycle
    MAC_TEA           R/W        PB_RST        1        Master-Abort Configuration Error Mapping
                                                        This bit controls the handling of a Master-Abort while a
                                                        PowerSpan II PCI Master is generating a configuration
                                                        transaction initiated by a processor bus master. If MAC_TEA
                                                        is cleared, the processor bus slave returns all ones to the
                                                        initiating processor bus master. If MAC_TEA is cleared and
                                                        TEA_EN is set to 1, the processor bus slave asserts
                                                        PB_TEA_ to terminate the transaction initiated by the
                                                        processor.
                                                        0 = Assert PB_TEA_ when Master-Abort occurs on PCI
                                                        configuration cycles
                                                        1 = Return all “1s” when Master-Abort occurs on PCI
                                                        configuration cycles
PowerSpan II User Manual                                                                Integrated Device Technology
80A1010_MA001_09                                                                                           www.idt.com


12. Register Descriptions                                                                                                   305
                                      Reset        Reset
       Name              Type           By         State                                  Function
    MODE_7400            R/W         PB_RST           1       Determines if PowerSpan II Processor Bus Slave can accept
                                                              misaligned data transfers defined for PowerPC 7400. Refer
                                                              to Table 24 on page 108 for a complete list of data transfers
                                                              supported by PowerSpan II.
                                                              0 = cannot accept PowerPC 7400 misaligned transfers
                                                              1 = can accept PowerPC 7400 misaligned transfers
     TEA_EN              R/W         PB_RST           1       Suppress PB_TEA_ generation
                                                              When this bit is cleared, PowerSpan II never asserts TEA_.
                                                              Error conditions are signalled exclusively with interrupts.
                                                              0 = PowerSpan II does not assert PB_TEA_
                                                              1 = PowerSpan II asserts PB_TEA_
    ARTRY_EN             R/W         PB_RST           0       Address Retry Enable
                                                              0 = PB Slave never asserts PB_ARTRY_
                                                              1 = PB Slave asserts PB_ARTRY_ as required
      DP_EN              R/W         PB_RST           0       Data Parity Enable
                                                              When cleared, the PowerSpan II does not check the parity
                                                              pins for the proper parity value. PowerSpan II still drives out
                                                              parity on master writes and slave read cycles. Parity checking
                                                              is disabled by default.
                                                              0 = Data parity checking disabled
                                                              1 = Data parity checking enabled
      AP_EN              R/W         PB_RST           0       Address Parity Enable
                                                              When cleared, the PowerSpan II does not check the parity
                                                              pins for the proper parity value. PowerSpan II still drives out
                                                              parity on master writes and slave read cycles. Parity checking
                                                              is disabled by default.
                                                              0 = Address parity checking disabled
                                                              1 = Address parity checking enabled
      PARITY             R/W         PB_RST           0       Parity
                                                              0 = Odd Parity
                                                              1 = Even Parity
                ARTRY_EN: Controls PowerSpan II’s use of PB_ARTRY_ during the servicing of transactions.
                When ARTRY_EN is set, the Processor Bus Slave retries a processor (60x) bus master under the
                following conditions:
                •    Register write while an external master connected to another PowerSpan II interface is doing a
                     register write
                •    Register read during I2C load
                •    Posted write when no buffers are available
                •    Read from PCI-1 or PCI-2
Integrated Device Technology                                                                      PowerSpan II User Manual
www.idt.com                                                                                            80A1010_MA001_09


306                                                                                       12. Register Descriptions
              ARTRY_EN is cleared by default. The user will see improved Processor Bus Interface utilization by
              setting ARTRY_EN.
                          The ARTRY_EN bit must be set to 1 in order for the PowerSpan II Prefetch
                          Keep feature to keep prefetched data. Prefetch Keep is enabled by setting the
                          PRKEEP bit in the “Processor Bus Slave Image x Control Register” on
                          page 287.
PowerSpan II User Manual                                                             Integrated Device Technology
80A1010_MA001_09                                                                                       www.idt.com


12. Register Descriptions                                                                                                     307
12.5.34         Processor Bus Arbiter Control Register
                The arbitration control register is used to control the parameters of the on-chip Processor Bus arbiter.
 Register Name: PB_ARB_CTRL                                                                            Register Offset: 0x2D0
    PCI                                                                                                                   PPC
    Bits                                                 Function                                                         Bits
   31-24                                           PowerSpan II Reserved                                                  0-7
   23-16                PowerSpan II Reserved                    M3_EN         M2_EN         M1_EN            0           8-15
   15-08                PowerSpan II Reserved                    M3_PRI        M2_PRI        M1_PRI        PS_PRI       16-23
   07-00                PowerSpan II Reserved                    TS_DLY         PARK              BM_PARK               24-31
                                      Reset          Reset
       Name             Type           By            State                                 Function
       Mx_EN             R/W        PB_RST          PWRUP       External Master x Enable
                                                                When set, the arbiter recognizes address bus requests for
                                                                this master. When cleared, the arbiter ignores address bus
                                                                requests from this master (see Table 78 on page 308).
                                                                0=External requests ignored
                                                                1=External requests recognized
      Mx_PRI             R/W        PB_RST             0        External Master x Priority Level
                                                                Determines the arbitration priority for external masters.
                                                                0 = Low Priority
                                                                1 = High Priority
      PS_PRI             R/W        PB_RST             0        PowerSpan II Priority Level
                                                                0 = Low Priority
                                                                1 = High Priority
      TS_DLY             R/W        PB_RST             0        Controls when arbiter samples requests
                                                                When set, the PB arbiter samples incoming requests two
                                                                clocks after a TS_ signal is received. When cleared, the
                                                                arbiter samples requests one clock after a TS_ signal is
                                                                received. The default state is 0.
                                                                An example application for this feature is some L2 caches
                                                                hold the BR_ signal after the TS_ signal starts. The
                                                                PowerSpan II arbiter could see this as a valid request and
                                                                give the bus to the L2 cache when the bus was not
                                                                requested. This bit delays when the PB arbiter samples the
                                                                signal so a false bus request is not granted.
                                                                0 = sample clock after TS_
                                                                1 = sample 2 clocks after TS_
Integrated Device Technology                                                                        PowerSpan II User Manual
www.idt.com                                                                                                80A1010_MA001_09


308                                                                                              12. Register Descriptions
                                    Reset        Reset
     Name              Type          By          State                                 Function
     PARK              R/W         PB_RST           0       Bus Park Mode
                                                            When set, the arbiter parks the address bus on the Processor
                                                            Bus master programmed in the BM_PARK field. When
                                                            cleared, the arbiter parks the address bus on the last
                                                            Processor Bus master to be granted the bus.
                                                            0 = Park on last bus master
                                                            1 = Park on specific master
    BM_PARK            R/W         PB_RST           0       Bus Master to be Parked
                                                            Identifies the master to be parked (see Table 79 on
                                                            page 308).
                                                            00 = PowerSpan II
                                                            01 = External Master 1
                                                            10 = External Master 2
                                                            11 = External Master 3
              Mx_EN: When set, the arbiter recognizes address bus requests for this master. When cleared, the
              arbiter ignores address bus requests from this master. The default state for these bits is determined by
              the PWRUP_BOOT option as defined by Table 78:
              Table 78: Mx_EN Default State
                  PWRUP_BOOT
                     Selection         RST_CSR Register             M1_EN            M2_EN            M3_EN
                     Boot PCI              PCI_BOOT=1                  0                0               0
                Boot Processor Bus         PCI_BOOT=0                  1                0               0
              BM_PARK: Identifies the master to be parked (see Table 79).
              Table 79: Parked Processor Bus Master
                                                Parked Processor Bus
                      BM_PARK [1:0]                     Master                           External Pins
                             00                       PowerSpan II                           None
                             01                           M1                        PB_BR[1]_/PB_BG[1]_
                             10                           M2                        PB_BR[2]_/PB_BG[2]_
                             11                           M3                        PB_BR[3]_/PB_BG[3]_
PowerSpan II User Manual                                                                    Integrated Device Technology
80A1010_MA001_09                                                                                              www.idt.com


12. Register Descriptions                                                                                                   309
12.5.35         DMA x Source Address Register
                This register specifies the starting byte address on the source port for channel DMAx. The register is
                programmed for Direct mode DMA or updated by the Linked-list when loading the command packet
                The DMAx_SRC_ADDR register is updated during the DMA transaction. Writing to this register
                while the DMA is active has no effect. While the DMA is active, this register provide status
                information on the progress of the transfer.
 Register Name: DMAx_SRC_ADDR                                              Register Offset:    0x304, 0x334, 0x 364, 0x394
    PCI                                                                                                                  PB
    Bits                                                  Function                                                      Bits
   31-24                                                   SADDR                                                        0-7
   23-16                                                   SADDR                                                        8-15
   15-08                                                   SADDR                                                       16-23
   07-00                                                   SADDR                                                       24-31
                                      Reset          Reset
       Name             Type            By           State                                Function
   SADDR[31:0]           R/W          G_RST            0        Starting byte address on the source bus for the port defined
                                                                by SRC_PORT field in the “DMA x Transfer Control Register”
                                                                on page 311.
Integrated Device Technology                                                                      PowerSpan II User Manual
www.idt.com                                                                                             80A1010_MA001_09


310                                                                                                 12. Register Descriptions
12.5.36       DMA x Destination Address Register
              This register specifies the starting byte address on the destination port for channel DMAx. This register
              is programmed for a Direct mode DMA or programmed by the Linked-list when loading the command
              packet.
              The DMAx_DST_ADDR register is updated during the DMA transaction. Writing to this register
              while the DMA is active has no effect. While the DMA is active, this register provides status
              information on the progress of the transfer.
 Register Name: DMAx_DST_ADDR                                              Register Offset: 0x30C, 0x33C, 0x36C, 0x39C
   PCI                                                                                                                  PB
   Bits                                                 Function                                                       Bits
  31-24                                                  DADDR                                                          0-7
  23-16                                                  DADDR                                                         8-15
  15-08                                                  DADDR                                                        16-23
  07-00                              DADDR                                      0             0            0          24-31
                                     Reset         Reset
      Name            Type             By           State                                 Function
  DADDR[31:3]         R/W           G_RST             0       Starting byte address on the destination bus for the port
                                                              defined by DST_PORT field in the “DMA x Transfer Control
                                                              Register” on page 311.
                                                              The lower three bits of the destination address is identical to
                                                              the lower three bits of the source address
                                                              (DMAx_SRC_ADDR)
PowerSpan II User Manual                                                                      Integrated Device Technology
80A1010_MA001_09                                                                                                 www.idt.com


12. Register Descriptions                                                                                               311
12.5.37         DMA x Transfer Control Register
                This register is used to specify parameters for channel DMAx. It is programmed directly for direct
                mode DMA or programmed by the Linked-list when loading the command packet.
                Writing to this register while the DMA is active has no effect. While the DMA is active, this register
                provides status information on the progress of the transfer.
 Register Name: DMAx_TCR                                                     Register Offset: 0x314, 0x344, 0x374, 0x3A4
    PCI                                                                                                              PB
    Bits                                                Function                                                    Bits
   31-24         SRC_PORT                  DST_PORT                     END                        0                 0-7
   23-16                                                   BC                                                       8-15
   15-08                                                   BC                                                      16-23
   07-00                                                   BC                                                      24-31
                                       Reset        Reset
       Name             Type            By          State                               Function
    SRC_PORT             R/W          G_RST           0        Source Port for DMA transfer
         [1:0]                                                 00 = PCI-1
                                                               01 = PCI-2
                                                               10 = PB
                                                               11 = reserved
                                                               Single PCI PowerSpan II:
                                                               00 = PCI-1
                                                               10 = PB
                                                               01, 11 = reserved
    DST_PORT             R/W          G_RST           0        Destination Port for DMA transfer
         [1:0]                                                 00 = PCI-1
                                                               01 = PCI-2
                                                               10 = PB
                                                               11 = reserved
                                                               Single PCI PowerSpan II:
                                                               00 = PCI-1
                                                               10 = PB
                                                               01, 11 = reserved
Integrated Device Technology                                                                     PowerSpan II User Manual
www.idt.com                                                                                           80A1010_MA001_09


312                                                                         12. Register Descriptions
                           Reset Reset
     Name            Type   By   State                            Function
    END[1:0]          R/W P1_RST  10   Endian Conversion Mode
                                       Selects the endian conversion mode for DMA activity
                                       involving the Processor Bus and a PCI Interface. When the
                                       source and destination ports are the same, then the
                                       conversion mode is little-endian, regardless of the value of
                                       this bit.
                                       00 = Little-endian
                                       01 = PowerPC little-endian
                                       10 = Big-endian
                                       11 = True little-endian
    BC[23:0]          R/W G_RST    0   Byte Count
                                       When the initial value of the byte count is non-zero in
                                       Linked-List mode, the DMA starts with a Direct mode transfer.
                                       After the direct mode transfer has completed, the DMA
                                       channel begins processing the linked-list.
                                       The field is updated during the DMA transaction.
PowerSpan II User Manual                                               Integrated Device Technology
80A1010_MA001_09                                                                         www.idt.com


12. Register Descriptions                                                                                                    313
12.5.38         DMA x Command Packet Pointer Register
                This register specifies the 32-byte aligned address of the next command packet in the Linked-List for
                channel DMAx. It is programmed by PowerSpan II from the Linked-list when loading the command
                packet.
                The DMAx_CPP register is updated at the start of a Linked-list transfer and remains constant
                throughout the transfer. Writing to this register while the DMA is active has no effect.
                For a Direct mode DMA transfer, this register does not need to be programmed.
 Register Name: DMAx_CPP                                                     Register Offset: 0x31C, 0x34C, 0x37C, 0x3AC
    PCI                                                                                                                  PB
    Bits                                                 Function                                                       Bits
   31-24                                                   NCP                                                           0-7
   23-16                                                   NCP                                                          8-15
   15-08                                                   NCP                                                         16-23
   07-00                   NCP                                 PowerSpan II Reserved                      LAST         24-31
                                      Reset         Reset
       Name             Type            By          State                                    Function
     NCP[31:5]           R/W          G_RST            0        Next Command Packet Address.
                                                                Points to a 32-byte aligned memory location of a linked-list on
                                                                the port specified by the CP_PORT bit in the DMAx_ATTR
                                                                register.
        LAST             R/W          G_RST            0        Last Item
                                                                0 = more items in linked list
                                                                1 = last item in linked list
Integrated Device Technology                                                                        PowerSpan II User Manual
www.idt.com                                                                                             80A1010_MA001_09


314                                                                                               12. Register Descriptions
12.5.39        DMA x General Control and Status Register
               This register contains general control and status information for channel DMAx. This register is not
               part of a linked-list Command Packet..
                              Writing to the CHAIN and OFF bits while the DMA is active has no effect.
 Register Name: DMAx_GCSR                                                    Register Offset: 0x320, 0x350, 0x380, 0x3B0
   PCI                                                                                                               PB
   Bits                                                Function                                                     Bits
  31-24       GO          CHAIN          0          0             0          STOP_        HALT_          0          0-7
                                                                               REQ         REQ
  23-16      DACT                 DBS             DBS_                                     OFF                      8-15
                                                   EN
  15-08        0            0         P1_ERR     P2_ERR       PB_ERR          STOP        HALT         DONE        16-23
  07-00        0            0        P1_ERR_    P2_ERR_      PB_ERR_         STOP_        HALT_       DONE_E       24-31
                                        EN         EN            EN             EN          EN           N
                                      Reset       Reset
      Name              Type           By         State                                 Function
        GO         Write 1 to Set     G_RST         0         DMA Go bit
                                                              0 = no effect, 1 = Begin DMA transfer
      CHAIN             R/W           G_RST         0         DMA Chaining
                                                              0 = DMA Direct mode
                                                              1 = DMA Linked-List mode
   STOP_REQ        Write 1 to Set     G_RST         0         DMA Stop Request
                                                              0 = no effect
                                                              1 = Stop DMA when all buffered data has been written
    HALT_REQ       Write 1 to Set     G_RST         0         DMA Halt Request
                                                              0 = no effect
                                                              1 = Halt DMA at completion of current command packet
      DACT                R           G_RST         0         DMA Active
                                                              0 = not active
                                                              1 = active
PowerSpan II User Manual                                                                     Integrated Device Technology
80A1010_MA001_09                                                                                              www.idt.com


12. Register Descriptions                                                                                  315
                                  Reset Reset
       Name             Type       By   State                            Function
     DBS[1:0]            R/W      G_RST   0   DMA Block Size (when DBS_EN is set to 1)
                                              Controls the byte size of transactions generated by the DMA
                                              channel. The DBS_EN bit must be set to 1 in order for the
                                              DBS functionality to be enabled.
                                              00=32 bytes
                                              01=16 bytes
                                              10=8 bytes
                                              11=4 bytes
     DBS_EN              R/W      G_RST   0   DMA Block Size Enable
                                              Provides programmable control over the byte size of
                                              transactions generated by the DMA channel. The byte size is
                                              based on values programmed into DBS[1:0].
                                              0 = not active
                                              1 = active
       OFF               R/W      G_RST   0   DMA Channel Off Counter (number of PB clocks)
                                              Provides programmable control over the amount of source
                                              bus traffic generated by the DMA channel. The channel will
                                              interleave source bus transfers with a period of idle
                                              Processor Bus clocks where no source bus requests are
                                              generated. When source and destination ports are different,
                                              256 bytes of source bus traffic occur before the idle period. If
                                              source and destination ports are the same, 64 bytes of
                                              source bus traffic occur before the idle period. This helps
                                              prevent PowerSpan II from interfering with Processor Bus
                                              instruction fetches.
                                              000 = 0
                                              001 = 128
                                              010 = 256
                                              011 = 512
                                              100 = 1024
                                              101 = 2048
                                              110 = 4096
                                              111 = 8192
     P1_ERR          R/Write 1 to G_RST   0   PCI-1 Bus Error
                        Clear                 0 = no error
                                              1 = error
     P2_ERR          R/Write 1 to G_RST   0   PCI-2 Bus Error
                        Clear                 0 = no error
                                              1 = error
                                              Single PCI PowerSpan II: Reserved
Integrated Device Technology                                                      PowerSpan II User Manual
www.idt.com                                                                             80A1010_MA001_09


316                                                                              12. Register Descriptions
                                Reset Reset
      Name            Type       By   State                           Function
     PB_ERR        R/Write 1 to G_RST   0   Processor Bus Error
                     Clear                  0 = no error
                                            1 = error
      STOP         R/Write 1 to G_RST   0   DMA Stopped Flag
                     Clear                  0 = not stopped
                                            1 = stopped
      HALT         R/Write 1 to G_RST   0   DMA Halted Flag
                     Clear                  0 = not halted
                                            1 = halted
      DONE         R/Write 1 to G_RST   0   DMA Done Flag
                     Clear                  The DONE bit is set in the following cases:
                                            • completion of Direct Mode DMA
                                            • completion of Linked-List DMA
                                            The DMA will not proceed until the DONE, and all other
                                            status bits, are cleared
                                            0 = transfer not done
                                            1 = transfer done
   P1_ERR_EN          R/W       G_RST   0   Primary PCI Error Interrupt Enable
                                            0 = no interrupt
                                            1 = enable interrupt
   P2_ERR_EN          R/W       G_RST   0   Normal PCI Error Interrupt Enable
                                            0 = no interrupt
                                            1 = enable interrupt
                                            Single PCI PowerSpan II: Reserved
  PB_ERR_EN           R/W       G_RST   0   Processor Bus Error Interrupt Enable
                                            0 = no interrupt
                                            1 = enable interrupt
    STOP_EN           R/W       G_RST   0   DMA Stop Interrupt Enable
                                            0 = no interrupt
                                            1 = enable interrupt
    HALT_EN           R/W       G_RST   0   DMA Halt Interrupt Enable
                                            0 = no interrupt
                                            1 = enable interrupt
    DONE_EN           R/W       G_RST   0   DMA Done Interrupt Enable
                                            0 = no interrupt
                                            1 = enable interrupt
PowerSpan II User Manual                                                    Integrated Device Technology
80A1010_MA001_09                                                                             www.idt.com


12. Register Descriptions                                                                                                317
12.5.40         DMA x Attributes Register
                This register contains additional parameters for DMA channel x. It is not part of a Linked-List
                Command Packet.
 Register Name: DMAx_ATTR                                                    Register Offset: 0x324, 0x354, 0x384, 0x3B4
    PCI                                                                                                               PB
    Bits                                                Function                                                     Bits
   31-24          CP_PORT                0          GBL_          CI_             PowerSpan II Reserved              0-7
   23-16          PowerSpan II Reserved                                        RTT                                   8-15
   15-08          PowerSpan II Reserved                                       WTT                                   16-23
   07-00                                          PowerSpan II Reserved                                             24-31
                                      Reset        Reset
        Name            Type            By          State                                Function
     CP_PORT             R/W         G_RST            0        Command Packet Port
         [1:0]                                                 00 = PCI-1
                                                               01 = PCI-2,
                                                               10 = PB
                                                               11 = reserved
                                                               Single PCI PowerSpan II:
                                                               00 = PCI-1
                                                               10 = PB
                                                               01, 11 = reserved
     PB_GBL_             R/W         G_RST            0        Processor Bus Global
                                                               0 = Assert PB_GBL_
                                                               1 = Negate PB_GBL_
       PB_CI_            R/W         G_RST            0        Processor Bus Cache Inhibit
                                                               0 = Assert PB_CI_
                                                               1 = Negate PB_CI_
      RTT[4:0]           R/W         G_RST         01010       Processor Bus Read Transfer Type PB_TT[0:4]
                                                               Selects the Transfer Type on the Processor Bus. The register
                                                               bits RTT[4:0]/WTT[4:0] are mapped to pins PB_TT[0:4].
                                                               01010 = Read
     WTT[4:0]            R/W         G_RST         00010       Processor Bus Write Transfer Type PB_TT[0:4]
                                                               Selects the Transfer Type on the Processor Bus. The register
                                                               bits RTT[4:0]/WTT[4:0] are mapped to pins PB_TT[0:4].
                                                               00010 = Write with flush
Integrated Device Technology                                                                     PowerSpan II User Manual
www.idt.com                                                                                           80A1010_MA001_09


318                                                                                      12. Register Descriptions
12.5.41        Miscellaneous Control and Status Register
 Register Name: MISC_CSR                                                                Register Offset:    0x400
   PCI                                                                                                       PB
   Bits                                           Function                                                  Bits
  31-24                                       TUNDRA_DEV_ID                                                 0-7
  23-16                                       TUNDRA_VER_ID                                                 8-15
  15-08     VPD_EN              VPD_CS                   BAR_     Reserved           ELOAD_OPT             16-23
                                                          EQ_0
  07-00    P1_LOCK    P2_LOCK   PowerSpan II Reserved   PCI_ARB    PCI_M7        PCI_M6       PCI_M5       24-31
             OUT         OUT                             _CFG
                                          Reset        Reset
           Name               Type           By        State                         Function
   TUNDRA_DEV_ID[7:0]          R         G_RST          0x00    IDT Internal Device ID
                                                        0x01    Single PCI PowerSpan II
   TUNDRA_VER_ID[7:0]          R         G_RST          0x02    IDT Internal Version ID
                                                                PowerSpan II = 02
                                                                (Original PowerSpan = 01)
          VPD_EN              R/W        G_RST            0     PCI Vital Product Data.
                                                      EEPROM    Enables PCI Vital Product Data (VPD) as
                                                                described in the “I2C/EEPROM” on page 127.
                                                                When enabled, the VPD registers in the PCI
                                                                Interface that has been designated as primary are
                                                                used to access PCI Vital Product Data.
                                                                0=disabled
                                                                1=enabled
        VPD_CS[2:0]           R/W        G_RST            0     PCI Vital Product Data EEPROM Chip Select.
                                                      EEPROM
         BAR_EQ_0             R/W        G_RST            0     Base Address Equivalent to 0x00000
                                                      EEPROM    This bit enables a value of 0x00000 for Px Base
                                                                Address registers.
PowerSpan II User Manual                                                            Integrated Device Technology
80A1010_MA001_09                                                                                      www.idt.com


12. Register Descriptions                                                                                    319
                                            Reset  Reset
            Name                 Type        By    State                       Function
      ELOAD_OPT[1:0]               R        G_RST    0   EEPROM load option
                                                  EEPROM Identifies the load option selected in the first byte
                                                         of the power-up EEPROM.
                                                         00=do not load
                                                         01=short load
                                                         10=long load
                                                         11=reserved
        P1_LOCKOUT           R/Write 1 to   G_RST    1   PCI-1 lockout
                                 Clear            EEPROM When set, all configuration and memory register
                                                         space accesses from PCI are retried. The
                                                         Px_LOCKOUT bit must be cleared for all memory
                                                         space accesses to the PowerSpan II’s PCI target
                                                         images.
                                                         0=not set
                                                         1=set
        P2_LOCKOUT           R/Write 1 to   G_RST    1   PCI-2 lockout
                                 Clear            EEPROM When set, all configuration and memory register
                                                         space accesses from PCI are retried. The
                                                         Px_LOCKOUT bit must be cleared for all memory
                                                         space accesses to the PowerSpan II’s PCI target
                                                         images.
                                                         0=not set
                                                         1=set
                                                         Single PCI PowerSpan II: Reserved
       PCI_ARB_CFG           Write 1 to set G_RST    0   PCI Arbiter Pins Configured
                                                  EEPROM When set, this bit enables recognition of external
                                                         master requests on PCI_REQ#[7:5] (see Table 80
                                                         on page 320)
                                                         0=Floating PCI Arbiter pins not yet configured
                                                         1=Floating PCI Arbiter pins configured
                                                         Single PCI PowerSpan II: Reserved
           PCI_M7                R/W        G_RST    0   PCI Arbiter Master 7
                                                  EEPROM 0=PowerSpan II PCI-1 arbiter
                                                         1=PowerSpan II PCI-2 arbiter
                                                         Single PCI PowerSpan II: Reserved
           PCI_M6                R/W        G_RST    0   PCI Arbiter Master 6
                                                  EEPROM 0=PowerSpan II PCI-1 arbiter
                                                         1=PowerSpan II PCI-2 arbiter
                                                         Single PCI PowerSpan II: Reserved
Integrated Device Technology                                                      PowerSpan II User Manual
www.idt.com                                                                             80A1010_MA001_09


320                                                                                            12. Register Descriptions
                                                Reset         Reset
         Name                     Type           By           State                        Function
        PCI_M5                    R/W          G_RST            0      PCI Arbiter Master 5
                                                            EEPROM     0=PowerSpan II PCI-1 arbiter
                                                                       1=PowerSpan II PCI-2 arbiter
                                                                       Single PCI PowerSpan II: Reserved
              Px_LOCKOUT: When set, all configuration and memory register space accesses from PCI are retried.
              The Px_LOCKOUT bit must be cleared for all memory space accesses to the PowerSpan II’s PCI
              target images.
                         PowerSpan II does not terminate the cycle when the Px_LOCKOUT bit is not cleared during
                         a memory space access to the PCI target images. If PowerSpan II does not terminate the
                         cycle, the PCI bus experiences a deadlock condition.
              The Px_LOCKOUT bit must be cleared before the corresponding PCI Target Image claims a
              transaction. The bit is cleared by an agent on the Processor Bus or by EEPROM load. The bit is cleared
              automatically by PowerSpan II when the PWRUP_BOOT option is set to PCI.
              PCI_ARB_CFG: When set, this bit enables recognition of external master requests on
              PCI_REQ#[7:5]. The user must set this bit after completing configuration all of the PowerSpan II
              floating PCI arbitration pins with bits PCI_M7, PCI_M6 and PCI_M5. When PCI_ARB_CFG is not
              set, requests from external masters connected to PCI_REQ#[7:5] are ignored.
              Initialization of PCI_ARB_CFG is not required for the Single PCI PowerSpan II because
              PCI_REQ#[7:5]/PCI_GNT#[7:5] are dedicated to the PCI-1 Interface.
              PCI_Mx: Each of these PCI Master bits must be explicitly initialized by the user to indicate which
              PowerSpan II PCI arbiter should service the pair of PCI_REQ#/PCI_GNT# pins. Initialization occurs
              through EEPROM load or a register write.
              Table 80 indicates register bit to arbitration pin mappings:
              Table 80: Arbitration Pin Mappings
                    Bit               Arbitration Pins
                 PCI_M5          PCI_REQ#[5]/PCI_GNT#[5]
                 PCI_M6          PCI_REQ#[6]/PCI_GNT#[6]
                 PCI_M7          PCI_REQ#[7]/PCI_GNT#[7]
              The PCI_Mx bits do not affect the behavior of the Single PCI PowerSpan II because
              PCI_REQ#[7:5]#/PCI_GNT#[7:5] are dedicated to the PCI-1 Interface.
PowerSpan II User Manual                                                                  Integrated Device Technology
80A1010_MA001_09                                                                                           www.idt.com


12. Register Descriptions                                                                                                   321
12.5.42         Clock Control Register
                PowerSpan II does not use the TUNE bits for adjusting the PLL parameters. This register does not
                effect PLL performance.
                          This register does not effect the functionality or performance of PowerSpan II. This register
                          makes the device backwards compatible with the PowerSpan II device.
 Register Name: CLOCK_CTL                                                                             Register Offset: 0x404
    PCI                                                                                                                 PB
    Bits                                                 Function                                                       Bits
   31-24                                                 PB_TUNE                                                        0-7
   23-16                                                 P1_TUNE                                                       8-15
   15-08                                                 P2_TUNE                                                      16-23
   07-00                                          PowerSpan II Reserved                                               24-31
                                       Reset        Reset
        Name             Type           By           State                                Function
   PB_TUNE[7:0]           R           G_RST        EEPROM       PB PLL Tune Bits
                                                                Tune bits for the Processor Bus PLL. The reset value is a
                                                                function of the system level applied to the PB_FAST external
                                                                pin. The reset values are:
                                                                • PB_TUNE[7:2] = 000100
                                                                • PB_TUNE[1] = ~PB_FAST
                                                                • PB_TUNE[0] = 1
   P1_TUNE[7:0]           R           G_RST        EEPROM       PCI-1 PLL Tune Bits
                                                                Tune bits for the PCI-1 PLL. The reset value is a function of
                                                                the system level applied to the P1_M66EN external pin. The
                                                                reset values are:
                                                                • P1_TUNE[7:1] = 0001001
                                                                • P1_TUNE[0] = ~P1_M66EN
   P2_TUNE[7:0]           R           G_RST        EEPROM       PCI-2 PLL Tune Bits
                                                                Tune bits for the PCI-2 PLL. The reset value is a function of
                                                                the system level applied to the P2_M66EN external pin. The
                                                                reset values are:
                                                                • P2_TUNE[7:1] = 0001001
                                                                • P2_TUNE[0] = ~P2_M66EN
Integrated Device Technology                                                                       PowerSpan II User Manual
www.idt.com                                                                                               80A1010_MA001_09


322                                                                                                   12. Register Descriptions
12.5.43          I2C/EEPROM Interface Control and Status Register
                 This register supports the PowerSpan II I2C/EEPROM interface.
                 An I2C bus cycle is initiated by writing to this register. Software must wait for the ACT bit to be zero
                 before starting a new I2C cycle. When the ACT bit is 1, writes to this register have no effect and the
                 DATA field is undefined.
                               Both the ACT bit and the ERR bit are updated five PB clocks after a PB write
                               completion (PB_TA asserted)
                 The PCI VPD EEPROM Chip Select (VPD_CS) bit, in the “Miscellaneous Control and Status
                 Register” on page 318, selects the EEPROM where VPD resides. If VPD_CS is 000b, then VPD starts
                 at address offset 0x40 of the first EEPROM. For all other values of VPD_CS, VPD starts at address
                 offset 0x00 of the specified EEPROM.
 Register Name: I2C_CSR                                                                           Register Offset:       0x408
   PCI                                                                                                                    PB
   Bits                                                  Function                                                        Bits
  31-24                                                    ADDR                                                          0-7
  23-16                                                    DATA                                                          8-15
  15-08                        DEV_CODE                                           CS                         RW         16-23
  07-00         ACT         ERR                                 PowerSpan II Reserved                                   24-31
                                          Reset         Reset
        Name                Type            By          State                                Function
      ADDR[7:0]              R/W          G_RST           0         Specifies I2C device address to be accessed.
      DATA[7:0]              R/W          G_RST           0         Specifies the required data for a write. Holds the data at
                                                                    the end of a read.
  DEV_CODE[3:0]              R/W          G_RST         1010        Device select. I2C 4-bit device code.
        CS[2:0]              R/W          G_RST           0         Chip Select
         RW                  R/W          G_RST           0         0=read
                                                                    1=write
PowerSpan II User Manual                                                                        Integrated Device Technology
80A1010_MA001_09                                                                                                   www.idt.com


12. Register Descriptions                                                                                  323
                                     Reset Reset
        Name               Type       By   State                            Function
         ACT                R        G_RST   0   I2C interface active
                                                 The ACT bit is set under of the following conditions:
                                                 • I2C interface is busy servicing a read or write as a result
                                                   of a write to this register
                                                 • I2C interface is busy loading registers at the end of reset
                                                 • I2C interface is busy accessing PCI Vital Product Data
                                                 0=not active
                                                 1=active
         ERR            R/Write 1 to G_RST   0   Error
                          Clear                  0=no error
                                                 1=error condition
Integrated Device Technology                                                      PowerSpan II User Manual
www.idt.com                                                                             80A1010_MA001_09


324                                                                                                  12. Register Descriptions
12.5.44         Reset Control and Status Register
                This register contains the read-only bits that specify all PowerSpan II power-up options and status of a
                number of pins that are normally fixed for each application.
 Register Name: RST_CSR                                                                              Register Offset: 0x40C
   PCI                                                                                                                  PB
   Bits                                                  Function                                                      Bits
  31-24    PB_RST_      PB_ARB_      PB_FAST        PCI_                      PowerSpan II Reserved                     0-7
              DIR           EN                     BOOT
  23-16    P1_RST_      P1_ARB_       P1_M66            PowerSpan II Reserved               P1_R64_      P1_D64        8-15
              DIR           EN           EN                                                    EN
  15-08    P2_RST_      P2_ARB_       P2_M66                   PowerSpan II Reserved                     PRI_PCI      16-23
              DIR           EN           EN
  07-00    Power-Sp       7400_      BYPASS_       ELOAD                      PowerSpan II Reserved                   24-31
           an II Rsvd     MODE           EN
                                      Reset        Reset
      Name              Type            By          State                                  Function
  PB_RST_DIR              R          G_RST        PWRUP         Status of PB_RST_DIR pin.
   PB_ARB_EN              R          G_RST        PWRUP         Processor bus arbiter enable.
                                                                0=Disabled power-up option
                                                                1=Enabled power-up option
     PB_FAST              R          G_RST        PWRUP         Processor Bus Clock Frequency Selection
                                                                Indicates the latched value of the PB_FAST pin. This bit is
                                                                used to optimally configure the Processor Bus Interface PLL
                                                                for the desired operating frequency.
                                                                0=25 MHz to 50 MHz
                                                                1=50 MHz to 100 MHz
    PCI_BOOT              R          G_RST        PWRUP         PCI Boot
                                                                0=Boot from Processor Bus
                                                                1=Boot from PCI
  P1_RST_DIR              R          G_RST        PWRUP         Status of P1_RST_DIR pin.
   P1_ARB_EN              R          G_RST        PWRUP         PCI-1 arbiter enable
                                                                0=Disabled power-up option
                                                                1=Enabled power-up option
PowerSpan II User Manual                                                                        Integrated Device Technology
80A1010_MA001_09                                                                                                 www.idt.com


12. Register Descriptions                                                                             325
                             Reset  Reset
       Name             Type  By    State                            Function
    P1_M66EN              R  G_RST PWRUP  PCI-1 Clock Frequency Selection
                                          Indicates the latched value of the P1_M66EN pin. This bit is
                                          used to optimally configure the PCI-1 interface PLL for the
                                          desired operating frequency.
                                          0=25 MHz to 33 MHz
                                          1=33 MHz to 66 MHz
    P1_R64_EN             R  G_RST PWRUP  P1_REQ64# output enable.
                                          0=PowerSpan II does not assert P1_REQ64# at reset
                                          1=PowerSpan II does assert P1_REQ64# at reset to indicate
                                          the presence of a 64-bit P1_AD[] bus
      P1_D64              R  G_RST PWRUP  PCI-1 Databus Width
                                          Indicates the width of the databus to which the PCI-1
                                          Interface is connected. This is determined by the level on
                                          P1_REQ64# at the negation of P1_RST#, or by the level on
                                          P1_64EN# (See Table 3 on page 33).
                                          0=connected to 32-bit AD bus
                                          1=connected to 64-bit AD bus
   P2_RST_DIR             R  G_RST PWRUP  Status of P2_RST_DIR pin.
                                          Single PCI PowerSpan II: Reserved
    P2_ARB_EN             R  G_RST PWRUP  PCI-2 arbiter enable.
                                          0=Disabled power-up option
                                          1=Enabled power-up option
                                          Single PCI PowerSpan II: Reserved
    P2_M66EN              R  G_RST PWRUP  PCI-2 Clock Frequency Selection
                                          Indicates the latched value of the P2_M66EN pin. This bit is
                                          used to optimally configure the PCI-2 interface PLL for the
                                          desired operating frequency.
                                          0=25 MHz to 50 MHz
                                          1=33 MHz to 66 MHz
                                          Single PCI PowerSpan II: Reserved
      PRI_PCI             R  G_RST PWRUP  Designated Primary PCI Bus.
                                          0=PCI-1 is Primary
                                          1=PCI-2 is Primary
                                          Single PCI PowerSpan II: Reserved
Integrated Device Technology                                                 PowerSpan II User Manual
www.idt.com                                                                        80A1010_MA001_09


326                                                                         12. Register Descriptions
                          Reset  Reset
      Name           Type  By    State                             Function
   7400_MODE           R  G_RST PWRUP  7400 Mode Enable
                                       When enabled, the PB arbiter qualifies bus grants before
                                       issuing a grant to a PB Master. When disabled, the PB arbiter
                                       issues a grant to a PB Master and it is expected that the PB
                                       Master receiving the grant qualifies the grant.
                                       0=Disabled power-up option
                                       1=Enabled power-up option
   BYPASS_EN           R  G_RST PWRUP  Phase Locked Loop Bypass Enable
                                       Indicates the setting of this power-up option. If this bit is set,
                                       the user has elected to bypass all PowerSpan II PLL’s. This
                                       bit supports slow speed emulation of a PowerSpan II based
                                       system.
                                       0=Disabled power-up option
                                       1=Enabled power-up option
     ELOAD             R  G_RST PWRUP  EEPROM load after reset.
                                       0=EEPROM load not enabled
                                       1=EEPROM load enabled
PowerSpan II User Manual                                               Integrated Device Technology
80A1010_MA001_09                                                                            www.idt.com


12. Register Descriptions                                                                                                        327
12.5.45          Interrupt Status Register 0
                 This register is one of two interrupt status registers. ISR0 is used primarily for normal operating status.
                 When set, each bit of this register indicates the corresponding interrupt source is active.
 Register Name: ISR0                                                                                      Register Offset: 0x410
    PCI                                                                                                                       PB
    Bits                                                   Function                                                          Bits
   31-24     ISR1_AC          0        I2O_HOS      I2O_IOP        DMA3           DMA2           DMA1          DMA0          0-7
                TV                         T
   23-16      P2_HW       P1_HW          INT5_        INT4_        INT3_          INT2_          INT1_         INT0_         8-15
                                          HW            HW          HW             HW             HW             HW
   15-08       DB7          DB6           DB5          DB4          DB3            DB2            DB1           DB0         16-23
   07-00      MBOX7       MBOX6         MBOX5        MBOX4        MBOX3          MBOX2          MBOX1         MBOX0         24-31
                                        Reset         Reset
        Name             Type             By           State                                  Function
    ISR1_ACTV              R           G_RST             0       Indicates an interrupt status bit is set in ISR1 register.
                                                                 This bit is a logical OR of all the status bits in the ISR1
                                                                 register. When any status bit in ISR1 is set, ISR1_ACTV is
                                                                 set. When all bits of the ISR1 register are cleared,
                                                                 ISR1_ACTV is cleared. This bit is useful in determining
                                                                 whether or not to read the ISR1 register to determine the
                                                                 source of the interrupt.
     I2O_HOST              R           G_RST             0       Interrupt asserted to the I2O Host to indicate that the
                                                                 Outbound Post List FIFO contains MFAs of messages for the
                                                                 Host to process.
                                                                 This bit is an alias for the I2O Outbound Post List Status
                                                                 Register located at offset 0x030 of the I2O Target Image.
      I2O_IOP        R/Write 1 to      G_RST             0       Interrupt to embedded PowerPC to indicate that the Inbound
                         Clear                                   Post List FIFO contains MFAs of messages for the embedded
                                                                 PowerPC to process.
        DMAx         R/Write 1 to      G_RST             0       Set when DMAx generates an interrupt. See DMAx_GCSR
                         Clear                                   register for details.
       P1_HW         R/Write 1 to      G_RST             0       PCI-1 hardware interrupt. Set when a level interrupt is
                         Clear                                   detected on the PCI-1 INTA# pin.
       P2_HW         R/Write 1 to      G_RST             0       PCI-2 hardware interrupt. Set when a level interrupt is
                         Clear                                   detected on the PCI-2 INTA# pin.
                                                                 Single PCI PowerSpan II: Reserved
Integrated Device Technology                                                                           PowerSpan II User Manual
www.idt.com                                                                                                   80A1010_MA001_09


328                                                                              12. Register Descriptions
                                Reset Reset
      Name             Type      By   State                           Function
    INT0_HW         R/Write 1   G_RST   0   Hardware interrupt. Set when a level interrupt is detected on
                     to Clear               the INT[0]_ pin.
    INT1_HW         R/Write 1   G_RST   0   Hardware interrupt. Set when a level interrupt is detected on
                     to Clear               the INT[1]_ pin.
    INT2_HW         R/Write 1   G_RST   0   Hardware interrupt. Set when a level interrupt is detected on
                     to Clear               the INT[2]_ pin.
    INT3_HW         R/Write 1   G_RST   0   Hardware interrupt. Set when a level interrupt is detected on
                     to Clear               the INT[3]_ pin.
    INT4_HW         R/Write 1   G_RST   0   Hardware interrupt. Set when a level interrupt is detected on
                     to Clear               the INT[4]_ pin.
    INT5_HW         R/Write 1   G_RST   0   Hardware interrupt. Set when a level interrupt is detected on
                     to Clear               the INT[5]_ pin.
    DB7-DB0        R/Write 1 to G_RST   0   Set when a doorbell register is written to in the IER register.
                       Clear
    MBOX[7:0]      R/Write 1 to G_RST   0   Set when a mailbox is written to.
                       Clear
PowerSpan II User Manual                                                   Integrated Device Technology
80A1010_MA001_09                                                                                www.idt.com


12. Register Descriptions                                                                                                       329
12.5.46         Interrupt Status Register 1
                This register is one of two interrupt status registers. ISR1 is organized with error conditions in
                PowerSpan II.
 Register Name: ISR1                                                                                     Register Offset: 0x414
    PCI                                                                                                                      PB
    Bits                                                 Function                                                           Bits
   31-24    ISR0_AC            PowerSpan II Reserved            PB_P1_R        PB_P2_R        PB_PB_R            0           0-7
               TV                                                 ETRY           ETRY           ETRY
   23-16    PB_P1_E      PB_P2_E      PB_PB_E     PB_A_PA       PB_P1_D        PB_P2_D        PB_PB_D            0          8-15
               RR           RR           RR            R          _PAR           _PAR           _PAR
   15-08    P2_P1_E      P2_PB_E      P2_P2_E       P2_A_       P2_P1_R        P2_PB_R        P2_P2_R            0         16-23
               RR           RR           RR          PAR          ETRY           ETRY           ETRY
   07-00    P1_P2_E      P1_PB_E      P1_P1_E      P1_A_PA      P1_P2_R        P1_PB_R        P1_P1_R            0         24-31
               RR           RR           RR            R          ETRY           ETRY           ETRY
                                       Reset        Reset
       Name             Type             By         State                                    Function
    ISR0_ACTV             R           G_RST            0        Indicates an interrupt status bit is set in ISR0 register.
                                                                This bit is a logical OR of all the status bits in the ISR0
                                                                register. If any register is set, ISR0_ACTV is set. When all
                                                                bits of the ISR0 register are cleared, ISR0_ACTV is cleared.
      PB_P1_         R/Write 1 to     G_RST            0        Processor Bus Max Retry Error. Maximum number of retries
       RETRY            Clear                                   detected. The cycle was initiated/destined to the PCI 1 bus.
      PB_P2_         R/Write 1 to     G_RST            0        Processor Bus Max Retry Error. Maximum number of retries
       RETRY            Clear                                   detected. The cycle was initiated/destined to the PCI-2 bus.
                                                                Single PCI PowerSpan II: Reserved
  PB_PB_RETRY        R/Write 1 to     G_RST            0        Processor Bus Max Retry Error. Maximum number of retries
                        Clear                                   detected during Processor Bus to Processor Bus DMA.
    PB_P1_ERR        R/Write 1 to     G_RST            0        Processor Bus interface asserted/received PB_TEA_. The
                        Clear                                   cycle was initiated/destined to the PCI-1 bus.
    PB_P2_ERR        R/Write 1 to     G_RST            0        Processor Bus interface asserted/received PB_TEA_. The
                        Clear                                   cycle was initiated/destined to the PCI-2 bus.
                                                                Single PCI PowerSpan II: Reserved
    PB_PB_ERR        R/Write 1 to     G_RST            0        Processor Bus interface asserted/received PB_TEA_ during
                        Clear                                   Processor Bus to Processor Bus DMA.
Integrated Device Technology                                                                          PowerSpan II User Manual
www.idt.com                                                                                                  80A1010_MA001_09


330                                                                              12. Register Descriptions
                                Reset Reset
      Name            Type       By   State                             Function
    PB_A_PAR       R/Write 1 to G_RST   0   Processor Bus Address Parity Error detected.
                     Clear
  PB_P1_D_PAR      R/Write 1 to G_RST   0   Processor Bus Data Parity Error detected. The cycle was
                     Clear                  initiated/destined to the PCI 1 bus.
  PB_P2_D_PAR      R/Write 1 to G_RST   0   Processor Bus Data Parity Error detected. The cycle was
                     Clear                  initiated/destined to the PCI-2 bus.
                                            Single PCI PowerSpan II: Reserved
  PB_PB_D_PAR      R/Write 1 to G_RST   0   Processor Bus Data Parity Error detected during Processor
                     Clear                  Bus to Processor Bus DMA.
   P2_P1_ERR       R/Write 1 to G_RST   0   PCI-2 interface detected an error. The P2_CSR error bits
                     Clear                  must be checked for the source of the error. The cycle was
                                            initiated/destined to the PCI 1 bus.
                                            Single PCI PowerSpan II: Reserved
   P2_PB_ERR       R/Write 1 to G_RST   0   PCI-2 interface detected an error. The P2_CSR error bits
                     Clear                  must be checked for the source of the error. The cycle was
                                            initiated/destined to the Processor Bus.
                                            Single PCI PowerSpan II: Reserved
   P2_P2_ERR       R/Write 1 to G_RST   0   PCI-2 interface detected an error during P2 to P2 DMA.
                     Clear
                                            2P: Reserved
    P2_A_PAR       R/Write 1 to G_RST   0   PCI-2 interface detected an address parity error.
                     Clear
                                            2P: Reserved
     P2_P1_        R/Write 1 to G_RST   0   PCI-2 Master received too many retries. The cycle was
     RETRY           Clear                  initiated from the PCI 1 bus.
                                            2P: Reserved
     P2_PB_        R/Write 1 to G_RST   0   PCI-2 Master received too many retries. The cycle was
     RETRY           Clear                  initiated from the Processor Bus.
                                            2P: Reserved
     P2_P2_        R/Write 1 to G_RST   0   PCI-2 Master received too many retries during P2 to P2 DMA.
     RETRY           Clear
                                            2P: Reserved
PowerSpan II User Manual                                                    Integrated Device Technology
80A1010_MA001_09                                                                              www.idt.com


12. Register Descriptions                                                                               331
                                  Reset Reset
       Name             Type       By   State                             Function
    P1_P2_ERR        R/Write 1 to G_RST   0   PCI-1 interface detected an error. The P1_CSR error bits
                        Clear                 must be checked for the source of the error. The cycle was
                                              initiated/destined to the PCI-2 bus.
                                              2P: Reserved
    P1_PB_ERR        R/Write 1 to G_RST   0   PCI-1 interface detected an error. The P1_CSR error bits
                        Clear                 must be checked for the source of the error. The cycle was
                                              initiated/destined to the Processor Bus.
    P1_P1_ERR        R/Write 1 to G_RST   0   PCI-1 interface detected an error during P1 to P1 DMA.
                        Clear
     P1_A_PAR        R/Write 1 to G_RST   0   PCI-1 interface detected an address parity error.
                        Clear
      P1_P2_         R/Write 1 to G_RST   0   PCI-1 Master received too many retries. The cycle was
      RETRY             Clear                 initiated from the PCI-2 bus.
                                              2P: Reserved
  P1_PB_RETRY        R/Write 1 to G_RST   0   PCI-1 Master received too many retries. The cycle was
                        Clear                 initiated from the Processor Bus.
  P1_P1_RETRY        R/Write 1 to G_RST   0   PCI-1 Master received too many retries during PCI-1 to PCI-1
                        Clear                 DMA.
Integrated Device Technology                                                     PowerSpan II User Manual
www.idt.com                                                                            80A1010_MA001_09


332                                                                                                    12. Register Descriptions
12.5.47         Interrupt Enable Register 0
                Each bit, when set, allows the corresponding active status bit in ISR0 to generate an interrupt on an
                external pin. The external pin is determined by the Interrupt Mapping Registers and the Interrupt
                Direction Register.
 Register Name: IER0                                                                                  Register Offset:  0x418
    PCI                                                                                                                  PB
    Bits                                                Function                                                        Bits
   31-24    PowerSpan II Reserved    I2O_HOS      I2O_IOP_   DMA3_EN         DMA2_EN         DMA1_EN      DMA0_EN        0-7
                                      T_MASK         EN
   23-16    P2_HW_E     P1_HW_E      INT5_HW      INT4_HW     INT3_HW         INT2_HW         INT1_HW      INT0_HW      8-15
               N            N           _EN          _EN          _EN            _EN            _EN          _EN
   15-08     DB7_EN      DB6_EN       DB5_EN       DB4_EN      DB3_EN          DB2_EN          DB1_EN       DB0_EN     16-23
   07-00    MBOX7_E     MBOX6_E      MBOX5_E      MBOX4_E    MBOX3_E         MBOX2_E         MBOX1_E      MBOX0_E      24-31
               N            N            N            N            N               N              N           N
                                      Reset         Reset
       Name             Type            By          State                                    Function
  I2O_HOST_MA           R/W          G_RST            0        I2O_HOST interrupt mask
         SK                                                    This bit is an alias for the I2O register OPL_IM[OP_ISM] used
                                                               to mask interrupts associated with the I2O Outbound Queue.
                                                               0=interrupt enabled
                                                               1=interrupt masked
    I2O_IOP_EN          R/W          G_RST            0        I2O_IOP interrupt enable
      DMAx_EN           R/W          G_RST            0        DMAx interrupt enable
     P1_HW_EN           R/W          G_RST            0        PCI 1 hardware interrupt enable
     P2_HW_EN           R/W          G_RST            0        PCI-2 hardware interrupt enable
                                                               2P: Reserved
   INT0_HW_EN           R/W          G_RST            0        INT[0]_ hardware interrupt enable
   INT1_HW_EN           R/W          G_RST            0        INT[1]_ hardware interrupt enable
   INT2_HW_EN           R/W          G_RST            0        INT[2]_ hardware interrupt enable
   INT3_HW_EN           R/W          G_RST            0        INT[3]_ hardware interrupt enable
   INT4_HW_EN           R/W          G_RST            0        INT[4]_ hardware interrupt enable
   INT5_HW_EN           R/W          G_RST            0        INT[5]_ hardware interrupt enable
PowerSpan II User Manual                                                                          Integrated Device Technology
80A1010_MA001_09                                                                                                   www.idt.com


12. Register Descriptions                                                                                      333
                                   Reset Reset
       Name             Type        By   State                             Function
     DBx_EN         Write 1 to set G_RST   0   Writing a one to this register sets the doorbell register in the
                                               ISR0 register.
                                               This causes the corresponding doorbell bit in the ISR0
                                               register to be set. In order to clear the doorbell interrupt, the
                                               ISR0 status bit must be cleared.
    MBOXx_EN             R/W       G_RST   0   Mailbox interrupt enable
Integrated Device Technology                                                        PowerSpan II User Manual
www.idt.com                                                                               80A1010_MA001_09


334                                                                                               12. Register Descriptions
12.5.48        Interrupt Enable Register 1
               Each bit, when set, allows the corresponding active status bit in ISR1 to generate an interrupt on an
               external pin. The external pin is determined by the Interrupt Mapping Registers and the Interrupt
               Direction Register.
 Register Name: IER1                                                                               Register Offset: 0x41C
   PCI                                                                                                                PB
   Bits                                                Function                                                      Bits
  31-24                PowerSpan II Reserved                 PB_P1_R        PB_P2_R      PB_PB_R          0          0-7
                                                            ETRY_EN        ETRY_EN      ETRY_EN
  23-16    PB_P1_E     PB_P2_E      PB_PB_E      PB_A_PA     PB_P1_D        PB_P2_D      PB_PB_D          0          8-15
            RR_EN         RR_        RR_EN         R_EN      _PAR_EN       _PAR_EN       _PAR_EN
                           EN
  15-08    P2_P1_E     P2_PB_E      P2_P2_E      P2_A_PA     P2_P1_R        P2_PB_R      P2_P2_R          0         16-23
             RR_          RR_          RR_         R_EN     ETRY_EN        ETRY_EN      ETRY_EN
              EN           EN          EN
  07-00    P1_P2_E     P1_PB_E      P1_P1_E      P1_A_PA     P1_P2_R        P1_PB_R      P1_P1_R          0         24-31
             RR_         RR_EN       RR_EN         R_EN     ETRY_EN        ETRY_EN      ETRY_EN
              N
                                     Reset         Reset
      Name             Type            By          State                                Function
 PB_P1_RETRY_          R/W          G_RST            0       Processor Bus Max Retry Counter enable. The cycle was
        EN                                                   initiated/destined to the PCI-1 bus.
     PB_P2_            R/W          G_RST            0       Processor Bus Max Retry Error enable. The cycle was
   RETRY_EN                                                  initiated/destined to the PCI-2 bus.
                                                             2P: Reserved
 PB_PB_RETRY           R/W          G_RST            0       Processor Bus Max Retry Counter enable. Processor Bus to
                                                             Processor Bus DMA.
  PB_P1_ERR_E          R/W          G_RST            0       Processor Bus Error Enable. The cycle was initiated/destined
        N                                                    to the PCI-1 bus.
  PB_P2_ERR_E          R/W          G_RST            0       Processor Bus Error enable. The cycle was initiated/destined
        N                                                    to the PCI-2 bus.
                                                             2P: Reserved
 PB_PB_ERR_E           R/W          G_RST            0       Processor Bus Error enable. Processor Bus to Processor Bus
        N                                                    DMA.
  PB_A_PAR_EN          R/W          G_RST            0       Processor Bus Address Parity Error enable
PowerSpan II User Manual                                                                     Integrated Device Technology
80A1010_MA001_09                                                                                              www.idt.com


12. Register Descriptions                                                                            335
                             Reset Reset
       Name             Type  By   State                            Function
  PB_P1_D_PAR_           R/W G_RST   0   Processor Bus Data Parity Error enable. The cycle was
        EN                               initiated/destined to the PCI-1 bus.
    PB_P2_D_             R/W G_RST   0   Processor Bus Data Parity Error enable. The cycle was
     PAR_EN                              initiated/destined to the PCI-2 bus.
                                         2P: Reserved
    PB_PB_D_             R/W G_RST   0   Processor Bus Data Parity Error enable. Processor Bus to
     PAR_EN                              Processor Bus DMA.
  P2_P1_ERR_EN           R/W G_RST   0   PCI-2 error enable. The cycle was initiated/destined to the
                                         PCI 1 bus.
                                         2P: Reserved
  P2_PB_ERR_E            R/W G_RST   0   PCI-2 error enable. The cycle was initiated/destined to the
         N                               Processor Bus.
                                         2P: Reserved
  P2_P2_ERR_EN           R/W G_RST   0   PCI-2 error enable.PCI-2 to PCI-2 DMA.
                                         2P: Reserved
    P2_A_PAR_            R/W G_RST   0   PCI-2 address parity error enable.
        EN
                                         2P: Reserved
      P2_P1_             R/W G_RST   0   PCI-2 max retry enable. The cycle was initiated/destined to
    RETRY_EN                             the PCI-1 bus.
                                         2P: Reserved
      P2_PB_             R/W G_RST   0   PCI-2 max retry enable. The cycle was initiated/destined to
    RETRY_EN                             the Processor Bus.
                                         2P: Reserved
      P2_P2_             R/W G_RST   0   PCI-2 max retry enable. PCI-2 to PCI-2 DMA.
    RETRY_EN
                                         2P: Reserved
  P1_P2_ERR_EN           R/W G_RST   0   PCI-1 error enable. The cycle was initiated/destined to the
                                         PCI-2 bus.
                                         2P: Reserved
  P1_PB_ERR_E            R/W G_RST   0   PCI-1 error enable. The cycle was initiated/destined to the
         N                               Processor Bus.
Integrated Device Technology                                                PowerSpan II User Manual
www.idt.com                                                                       80A1010_MA001_09


336                                                                      12. Register Descriptions
                          Reset Reset
      Name           Type  By   State                           Function
 P1_P1_ERR_EN         R/W G_RST   0   PCI-1 error enable. PCI-1 to PCI-1 DMA.
  P1_A_PAR_EN         R/W G_RST   0   PCI-1 address parity error enable.
     P1_P2_           R/W G_RST   0   PCI-1 max retry enable. The cycle was initiated/destined to
   RETRY_EN                           the PCI-2 bus.
                                      2P: Reserved
 P1_PB_RETRY_         R/W G_RST   0   PCI-1 max retry enable. The cycle was initiated/destined to
       EN                             the Processor Bus.
 P1_P1_RETRY_         R/W G_RST   0   PCI-1 max retry enable. PCI-1 to PCI-1 DMA.
       EN
PowerSpan II User Manual                                            Integrated Device Technology
80A1010_MA001_09                                                                       www.idt.com


12. Register Descriptions                                                                                                337
12.5.49         Interrupt Map Register Mail Box
                Each map field assigns an interrupt output pin to the corresponding interrupt source.
 Register Name: IMR_MBOX                                                                            Register Offset: 0x420
    PCI                                                                                                               PB
    Bits                                               Function                                                      Bits
   31-24               MBOX7_MAP                     0                  MBOX6_MAP                         0          0-7
   23-16               MBOX5_MAP                     0                  MBOX4_MAP                         0          8-15
   15-08               MBOX3_MAP                     0                  MBOX2_MAP                         0         16-23
   07-00               MBOX1_MAP                     0                  MBOX0_MAP                         0         24-31
                                       Reset        Reset
         Name             Type          By           State                              Function
  MBOX7_MAP[2:0]          R/W         G_RST            0        Map Mailbox #7 to an interrupt pin.
  MBOX6_MAP[2:0]          R/W         G_RST            0        Map Mailbox #6 to an interrupt pin.
  MBOX5_MAP[2:0]          R/W         G_RST            0        Map Mailbox #5 to an interrupt pin.
  MBOX4_MAP[2:0]          R/W         G_RST            0        Map Mailbox #4 to an interrupt pin.
  MBOX3_MAP[2:0]          R/W         G_RST            0        Map Mailbox #3 to an interrupt pin.
  MBOX2_MAP[2:0]          R/W         G_RST            0        Map Mailbox #2 to an interrupt pin.
  MBOX1_MAP[2:0]          R/W         G_RST            0        Map Mailbox #1 to an interrupt pin.
  MBOX0_MAP[2:0]          R/W         G_RST            0        Map Mailbox #0 to an interrupt pin.
                Table 81 describes the mapping of interrupt sources to the external interrupt pins. The shaded entries
                indicate unsupported combinations for the Single PCI PowerSpan II.
                Table 81: Mapping Definition
                            Map Field                      Interrupt Pin
                               000                           P1_INTA#
                               001                           P2_INTA#
                               010                            INT[0]_
                               011                            INT[1]_
                               100                            INT[2]_
Integrated Device Technology                                                                    PowerSpan II User Manual
www.idt.com                                                                                           80A1010_MA001_09


338                                                           12. Register Descriptions
              Table 81: Mapping Definition
                         Map Field         Interrupt Pin
                           101                INT[3]_
                           110                INT[4]_
                           111                 INT[5_
PowerSpan II User Manual                                 Integrated Device Technology
80A1010_MA001_09                                                          www.idt.com


12. Register Descriptions                                                                                              339
12.5.50         Interrupt Map Register Doorbell
                Each map field assigns an interrupt output pin to the corresponding interrupt source. Table 81 on
                page 337 defines the mapping definitions.
 Register Name: IMR_DB                                                                            Register Offset: 0x424
    PCI                                                                                                             PB
    Bits                                               Function                                                    Bits
   31-24                DB7_MAP                      0                    DB6_MAP                       0          0-7
   23-16                DB5_MAP                      0                    DB4_MAP                       0          8-15
   15-08                DB3_MAP                      0                    DB2_MAP                       0         16-23
   07-00                DB1_MAP                      0                    DB0_MAP                       0         24-31
                                     Reset         Reset
        Name             Type          By          State                                Function
   DB7_MAP[2:0]           R/W        G_RST           0        Map doorbell #7 to an interrupt pin
   DB6_MAP[2:0]           R/W        G_RST           0        Map doorbell #6 to an interrupt pin
   DB5_MAP[2:0]           R/W        G_RST           0        Map doorbell #5 to an interrupt pin
   DB4_MAP[2:0]           R/W        G_RST           0        Map doorbell #4 to an interrupt pin
   DB3_MAP[2:0]           R/W        G_RST           0        Map doorbell #3 to an interrupt pin
   DB2_MAP[2:0]           R/W        G_RST           0        Map doorbell #2 to an interrupt pin
   DB1_MAP[2:0]           R/W        G_RST           0        Map doorbell #1 to an interrupt pin
   DB0_MAP[2:0]           R/W        G_RST           0        Map doorbell #0 to an interrupt pin
Integrated Device Technology                                                                    PowerSpan II User Manual
www.idt.com                                                                                         80A1010_MA001_09


340                                                                                           12. Register Descriptions
12.5.51       Interrupt Map Register DMA
              Each map field assigns an interrupt output pin to the corresponding interrupt source. Table 81 on
              page 337 defines the mapping definitions.
 Register Name: IMR_DMA                                                                        Register Offset: 0x428
   PCI                                                                                                           PB
   Bits                                               Function                                                  Bits
  31-24                                       PowerSpan II Reserved                                              0-7
  23-16                                       PowerSpan II Reserved                                             8-15
  15-08              DMA3_MAP                      0                   DMA2_MAP                      0         16-23
  07-00              DMA1_MAP                      0                   DMA0_MAP                      0         24-31
                                     Reset         Reset
        Name             Type          By           State                             Function
  DMA3_MAP[2:0]          R/W         G_RST            0        Map DMA #3 to an interrupt pin
  DMA2_MAP[2:0]          R/W         G_RST            0        Map DMA #2 to an interrupt pin
  DMA1_MAP[2:0]          R/W         G_RST            0        Map DMA #1 to an interrupt pin
  DMA0_MAP[2:0]          R/W         G_RST            0        Map DMA #0 to an interrupt pin
PowerSpan II User Manual                                                                 Integrated Device Technology
80A1010_MA001_09                                                                                          www.idt.com


12. Register Descriptions                                                                                                341
12.5.52         Interrupt Map Register Hardware
                This register assigns an interrupt output pin to the corresponding interrupt source. All sources are
                associated with errors detected by the PCI-1 Interface.
                Each map field assigns an interrupt output pin to the corresponding interrupt source. Table 81 on
                page 337 defines the mapping definitions
 Register Name: IMR_HW                                                                           Register Offset: 0x42C
    PCI                                                                                                               PB
    Bits                                                Function                                                     Bits
   31-24               P2_HW_MAP                      0                   P1_HW_MAP                      0            0-7
   23-16              INT5_HW_MAP                     0                  INT4_HW_MAP                     0           8-15
   15-08              INT3_HW_MAP                     0                  INT2_HW_MAP                     0          16-23
   07-00              INT1_HW_MAP                     0                  INT0_HW_MAP                     0          24-31
                                                Reset           Reset
           Name                  Type             By            State                        Function
     P1_HW_MAP[2:0]               R/W           G_RST             0        Map PCI-1 hardware interrupt to an interrupt pin
     P2_HW_MAP[2:0]               R/W           G_RST             0        Map PCI-2 hardware interrupt to an interrupt pin
                                                                           2P: Reserved
    INT5_HW_MAP[2:0]              R/W           G_RST             0        Map INT[5]_ hardware interrupt to an interrupt
                                                                           pin
    INT4_HW_MAP[2:0]              R/W           G_RST             0        Map INT[4]_ hardware interrupt to an interrupt
                                                                           pin
    INT3_HW_MAP[2:0]              R/W           G_RST             0        Map INT[3]_ hardware interrupt to an interrupt
                                                                           pin
    INT2_HW_MAP[2:0]              R/W           G_RST             0        Map INT[2]_ hardware interrupt to an interrupt
                                                                           pin
    INT1_HW_MAP[2:0]              R/W           G_RST             0        Map INT[1]_ hardware interrupt to an interrupt
                                                                           pin
    INT0_HW_MAP[2:0]              R/W           G_RST             0        Map INT[0]_ hardware interrupt to an interrupt
                                                                           pin
Integrated Device Technology                                                                   PowerSpan II User Manual
www.idt.com                                                                                          80A1010_MA001_09


342                                                                                               12. Register Descriptions
12.5.53         Interrupt Map Register PCI-1
                Each map field assigns an interrupt output pin to the corresponding interrupt source. Table 81 on
                page 337 defines the mapping definitions.
 Register Name: IMR_P1                                                                             Register Offset: 0x430
   PCI                                                                                                                PB
   Bits                                                 Function                                                     Bits
  31-24            P1_P2_ERR_MAP                     0                P1_PB_ERR_MAP                       0           0-7
  23-16            P1_P1_ERR_MAP                     0                 P1_A_PAR_MAP                       0          8-15
  15-08           P1_P2_RETRY_MAP                    0               P1_PB_RETRY_MAP                      0         16-23
  07-00           P1_P1_RETRY_MAP                                   PowerSpan II Reserved                           24-31
                                        Reset         Reset
         Name              Type           By           State                             Function
 P1_P2_ERR_MAP[2:0          R/W         G_RST            0       Map PCI-1 errors to an interrupt pin
            ]
                                                                 2P: Reserved
 P1_PB_ERR_MAP[2:0          R/W         G_RST            0       Map PCI-1 errors to an interrupt pin
            ]
 P1_P1_ERR_MAP[2:0          R/W         G_RST            0       Map PCI-1 errors to an interrupt pin. PCI-1 to PCI-1 DMA.
            ]
    P1_A_PAR_MAP            R/W         G_RST            0       Map PCI-11 address parity errors to an interrupt pin
          [2:0]
    P1_P2_RETRY_            R/W         G_RST            0       Map PCI-1 max retry error to an interrupt pin
        MAP[2:0]
                                                                 2P: Reserved
    P1_PB_RETRY_            R/W         G_RST            0       Map PCI-1 max retry error to an interrupt pin
        MAP[2:0]
    P1_P1_RETRY_            R/W         G_RST            0       Map PCI-1 max retry error to an interrupt pin. PCI-1 to
        MAP[2:0]                                                 PCI-1 DMA.
PowerSpan II User Manual                                                                    Integrated Device Technology
80A1010_MA001_09                                                                                                www.idt.com


12. Register Descriptions                                                                                                 343
12.5.54         Interrupt Map Register PCI-2
                This register assigns an interrupt output pin to the corresponding interrupt source. All sources are
                associated with errors detected by the PCI-2 Interface. Table 81 on page 337 defines the mapping
                definitions.
                This register is not implemented in the Single PCI PowerSpan II and must be treated as reserved.
  Register Name: IMR_P2                                                                               Register Offset: 434
    PCI                                                                                                               PB
    Bits                                                Function                                                     Bits
   31-24            P2_P1_ERR_MAP                     0                 P2_PB_ERR_MAP                     0           0-7
   23-16            P2_P2_ERR_MAP                     0                  P2_A_PAR_MAP                     0          8-15
   15-08           P2_P1_RETRY_MAP                    0                P2_PB_RETRY_MAP                    0         16-23
   07-00           P2_P2_RETRY_MAP                                    PowerSpan II Reserved                         24-31
I
                                                    Reset         Reset
              Name                     Type          By           State                       Function
          P2_P1_ERR[2:0]               R/W         G_RST            0       Map PCI-2 errors to an interrupt pin
          P2_PB_ERR[2:0]               R/W         G_RST            0       Map PCI-2 errors to an interrupt pin
       P2_P2_ERR_MAP[2:0]              R/W         G_RST            0       Map PCI-2 errors to an interrupt pin. PCI-2 to
                                                                            PCI-2 DMA.
        P2_A_PAR_MAP[2:0]              R/W         G_RST            0       Map PCI-2 address parity errors to an interrupt
                                                                            pin
     P2_P1_RETRY_MAP[2:0]              R/W         G_RST            0       Map PCI-2 max retry error to an interrupt pin
     P2_PB_RETRY_MAP[2:0]              R/W         G_RST            0       Map PCI-2 max retry error to an interrupt pin
     P2_P2_RETRY_MAP[2:0]              R/W         G_RST            0       Map PCI-2 max retry error to an interrupt pin.
                                                                            PCI-2 to PCI-2 DMA.
Integrated Device Technology                                                                   PowerSpan II User Manual
www.idt.com                                                                                           80A1010_MA001_09


344                                                                                                12. Register Descriptions
12.5.55        Interrupt Map Register Processor Bus
                This register assigns an interrupt output pin to the corresponding interrupt source. All sources are
                associated with errors detected by the Processor Bus Interface. Table 81 on page 337 defines the
                mapping definitions.
  Register Name: IMR_PB                                                                             Register Offset: 0x438
    PCI                                                                                                               PB
    Bits                                                Function                                                     Bits
   31-24            PB_P1_ERR_MAP                     0                 PB_P2_ERR_MAP                      0         0-7
   23-16            PB_PB_ERR_MAP                     0                  PB_A_PAR_MAP                      0         8-15
   15-08           PB_P1_D_PAR_MAP                    0               PB_P2_D_PAR_MAP                      0        16-23
   07-00           PB_PB_D_PAR_MAP                                    PowerSpan II Reserved                         24-31
I
                                                    Reset         Reset
              Name                     Type          By           State                         Function
       PB_P1_ERR_MAP[2:0]              R/W         G_RST            0       Map Processor Bus error to an interrupt pin
       PB_P2_ERR_MAP[2:0]              R/W         G_RST            0       Map Processor Bus error to an interrupt pin
                                                                            2P: Reserved
       PB_PB_ERR_MAP[2:0]              R/W         G_RST            0       Map Processor Bus error to an interrupt pin.
                                                                            Processor Bus to Processor Bus DMA.
        PB_A_PAR_MAP[2:0]              R/W         G_RST            0       Map Processor Bus address parity error to an
                                                                            interrupt pin
     PB_P1_D_PAR_MAP[2:0]              R/W         G_RST            0       Map Processor Bus data parity error to an
                                                                            interrupt pin
     PB_P2_D_PAR_MAP[2:0]              R/W         G_RST            0       Map Processor Bus data parity error to an
                                                                            interrupt pin
                                                                            2P: Reserved
     PB_PB_D_PAR_MAP[2:0]              R/W         G_RST            0       Map Processor Bus data parity error to an
                                                                            interrupt pin. Processor Bus to Processor Bus
                                                                            DMA.
PowerSpan II User Manual                                                                      Integrated Device Technology
80A1010_MA001_09                                                                                               www.idt.com


12. Register Descriptions                                                                                               345
12.5.56           Interrupt Map Register Two Processor Bus
                  This register maps Processor Bus maximum retry errors to interrupt pins. Max retry errors that are
                  mapped include PCI-1, PCI-2 and Processor Bus.
 Register Name: IMR2_PB                                                                         Register Offset: 0x43C
    PCI                                                                                                              PB
    Bits                                               Function                                                     Bits
   31-24            PB_P1_RETRY_MAP                  0              PB_P2_RETRY_MAP                     0           0-7
   23-16            PB_PB_RETRY_MAP                                 PowerSpan II Reserved                           8-15
   15-08                                         PowerSpan II Reserved                                             16-23
   07-00                                         PowerSpan II Reserved                                             24-31
                                         Reset       Reset
          Name                Type         By        State                             Function
    PB_P1_RETRY_              R/W        G_RST         0        Map Processor Bus max retry errors to an interrupt pin
         MAP[2:0]
    PB_P2_RETRY_              R/W        G_RST         0        Map Processor Bus max retry errors to an interrupt pin
         MAP[2:0]
                                                                Single PCI PowerSpan II Reserved
    PB_PB_RETRY_              R/W        G_RST         0        Map Processor Bus max retry errors to an interrupt pin.
         MAP[2:0]                                               Processor Bus to Processor Bus DMA.
Integrated Device Technology                                                                 PowerSpan II User Manual
www.idt.com                                                                                         80A1010_MA001_09


346                                                                                               12. Register Descriptions
12.5.57        Interrupt Map Register Miscellaneous
               Each map field assigns an interrupt output pin to the corresponding interrupt source. Table 81 on
               page 337 defines the mapping definitions.
  Register Name: IMR_MISC                                                                           Register Offset: 0x440
     PCI                                                                                                              PB
     Bits                                             Function                                                        Bits
    31-24            I2O_IOP_MAP                    0                 I2O_HOST_MAP                        0           0-7
    23-16                                      PowerSpan II Reserved                                                 8-15
    15-08                                      PowerSpan II Reserved                                                16-23
    07-00                                      PowerSpan II Reserved                                                24-31
 IMR_MISC Description
                                            Reset        Reset
           Name               Type           By           State                             Function
  I2O_HOST_MAP [2:0]          R/W          G_RST            0        Map I2O Host interrupt to an interrupt pin
                                                                     This field must be configured to route the interrupt
                                                                     source to the interrupt pin on PowerSpan II’s Primary
                                                                     PCI Interface.
  I2O_IOP_MAP[2:0]            R/W          G_RST            0        Map I2O IOP interrupt to an interrupt pin
PowerSpan II User Manual                                                                     Integrated Device Technology
80A1010_MA001_09                                                                                               www.idt.com


12. Register Descriptions                                                                                                  347
12.5.58         Interrupt Direction Register
                This register controls the direction of the corresponding interrupt pin. The direction can be to be an
                input or output.
 Register Name: IDR                                                                                   Register Offset: 0x444
    PCI                                                                                                                 PB
    Bits                                                 Function                                                      Bits
   31-24    P2_HW_D     P1_HW_D      INT5_HW       INT4_HW     INT3_HW       INT2_HW       INT1_HW      INT0_HW        0-7
               IR           IR          _DIR         _DIR         _DIR         _DIR           _DIR        _DIR
   23-16                                           PowerSpan II Reserved                                               8-15
   15-08                                           PowerSpan II Reserved                                              16-23
   07-00                                           PowerSpan II Reserved                                              24-31
                                          Reset         Reset
         Name              Type            By           State                                Function
     P2_HW_DIR              R/W          G_RST            0        P2_INTA _ Direction
                                                      EEPROM       0 = Input
                                                                   1 = Output
                                                                   2P: Reserved
     P1_HW_DIR              R/W          G_RST            0        P1_INTA_ Direction
                                                      EEPROM       0 = Input
                                                                   1 = Output
    INT5_HW_DIR             R/W          G_RST            0        INT[5]_ Interrupt Direction
                                                      EEPROM       0 = Input
                                                                   1 = Output
    INT4_HW_DIR             R/W          G_RST            0        INT[4]_ Interrupt Direction
                                                      EEPROM       0 = Input
                                                                   1 = Output
    INT3_HW_DIR             R/W          G_RST            0        INT[3]_ Interrupt Direction
                                                      EEPROM       0 = Input
                                                                   1 = Output
    INT2_HW_DIR             R/W          G_RST            0        INT[2]_ Interrupt Direction
                                                      EEPROM       0 = Input
                                                                   1 = Output
Integrated Device Technology                                                                       PowerSpan II User Manual
www.idt.com                                                                                              80A1010_MA001_09


348                                                                         12. Register Descriptions
                              Reset  Reset
        Name             Type  By    State                           Function
    INT1_HW_DIR          R/W  G_RST    0   INT[1]_ Interrupt Direction
                                    EEPROM 0 = Input
                                           1 = Output
    INT0_HW_DIR          R/W  G_RST    0   INT[0]_ Interrupt Direction
                                    EEPROM 0 = Input
                                           1 = Output
PowerSpan II User Manual                                               Integrated Device Technology
80A1010_MA001_09                                                                        www.idt.com


12. Register Descriptions                                                                                               349
12.5.59         Mailbox x Register
                This register is the General Purpose Mailbox register. When interrupts are enabled in the IER0 register,
                writes to any byte of this register cause an interrupt. The interrupt can be mapped to any of PowerSpan
                II’s interrupt pins. This mapping is set in the IMR_MBOX register.
                                                                      Register Offset: 0x450, 0x454, 0x458, 0x45C, 0x460,
 Register Name: MBOXx                                                                                0x464, 0x468, 0x46C
    PCI                                                                                                              PB
    Bits                                                 Function                                                   Bits
   31-24                                                   MBOXx                                                    0-7
   23-16                                                   MBOXx                                                    8-15
   15-08                                                   MBOXx                                                   16-23
   07-00                                                   MBOXx                                                   24-31
                                       Reset         Reset
       Name              Type            By          State                               Function
       MBOXx              R/W         G_RST            0        Mailbox x
        [31:0]
Integrated Device Technology                                                                    PowerSpan II User Manual
www.idt.com                                                                                           80A1010_MA001_09


350                                                                                                12. Register Descriptions
12.5.60        Semaphore 0 Register
               When a SEMx is 0, this semaphore can be obtained by writing a 1 to the SEMx bit with a unique tag
               TAGx. If on a subsequent read, the SEMx bit is set and the TAGx field contains the same unique tag,
               then the semaphore has been obtained successfully.
               To release a semaphore, write a 0 to the SEMx bit and the same tag that was used to obtain the
               semaphore. If the tag is different from the tag that is in the register, then the write will have no effect.
               Access to a single semaphore in this register requires a byte-wide transaction.
 Register Name: SEMA0                                                                               Register Offset: 0x470
   PCI                                                                                                                PB
   Bits                                                 Function                                                     Bits
  31-24      SEM3                                               TAG3                                                  0-7
  23-16      SEM2                                               TAG2                                                 8-15
  15-08      SEM1                                               TAG1                                                16-23
  07-00      SEM0                                               TAG0                                                24-31
                                    Reset           Reset
      Name             Type           By            State                                 Function
      SEM3             R/W          G_RST             0       Semaphore 3
    TAG3[6:0]          R/W          G_RST             0       Tag 3
      SEM2             R/W          G_RST             0       Semaphore 2
    TAG2[6:0]          R/W          G_RST             0       Tag 2
      SEM1             R/W          G_RST             0       Semaphore 1
    TAG1[6:0]          R/W          G_RST             0       Tag 1
      SEM0             R/W          G_RST             0       Semaphore 0
    TAG0[6:0]          R/W          G_RST             0       Tag 0
PowerSpan II User Manual                                                                      Integrated Device Technology
80A1010_MA001_09                                                                                               www.idt.com


12. Register Descriptions                                                                                                 351
12.5.61         Semaphore 1 Register
                If a SEMx is 0, this semaphore can be obtained by writing a 1 to the SEMx bit with a unique tag TAGx.
                If on a subsequent read, the SEMx bit is set and the TAGx field contains the same unique tag, then the
                semaphore has been obtained successfully.
                To release a semaphore, write a 0 to the SEMx bit and the same tag that was used to obtain the
                semaphore. If the tag is different from the tag that is in the register, then the write will have no effect.
                Access to a single semaphore in this register requires a byte-wide transaction.
 Register Name: SEMA1                                                                               Register Offset: 0x474
    PCI                                                                                                                PB
    Bits                                                 Function                                                     Bits
   31-24      SEM7                                               TAG7                                                  0-7
   23-16      SEM6                                               TAG6                                                 8-15
   15-08      SEM5                                               TAG5                                                16-23
   07-00      SEM4                                               TAG4                                                24-31
                                       Reset         Reset
       Name              Type           By           State                                 Function
       SEM7              R/W          G_RST            0       Semaphore 7
     TAG7[6:0]           R/W          G_RST            0       Tag 7
       SEM6              R/W          G_RST            0       Semaphore 6
     TAG6[6:0]           R/W          G_RST            0       Tag 6
       SEM5              R/W          G_RST            0       Semaphore 5
     TAG5[6:0]           R/W          G_RST            0       Tag 5
       SEM4              R/W          G_RST            0       Semaphore 4
     TAG4[6:0]           R/W          G_RST            0       Tag 4
Integrated Device Technology                                                                      PowerSpan II User Manual
www.idt.com                                                                                             80A1010_MA001_09


352                                                                                                    12. Register Descriptions
12.5.62       PCI I2O Target Image Control Register
              This register contains the control information for the PowerSpan II PCI I2O Target Image. The lower
              4 Kbytes of the image provide the I2O Shell Interface - Inbound and Outbound Queues and the Host
              Interrupt Status and Mask Registers. I2O Message Frames are accessible above the 4-KByte boundary.
              The Queues and the Message Frames reside in memory connected to the processor bus.
              All PCI transactions claimed by the image are destined for the Processor Bus
              The following parameters do not affect Processor Bus transactions generated by I2O Shell accesses:
              •    TA_EN: no address translation for I2O Shell accesses
              •    PRKEEP: no read keep for I2O Shell accesses
              •    END
              •    RD_AMT: prefetch amount fixed at 8 bytes for I2O Shell accesses.
 Register Name: PCI_TI2O_CTL                                                                            Register Offset: 0x500
   PCI                                                                                                                     PB
   Bits                                                 Function                                                          Bits
  31-24    IMG_EN       TA_EN      BAR_EN            0                                  BS                                0-7
  23-16         PowerSpan II Reserved                                            RTT                                      8-15
  15-08      GBL          CI           0                                        WTT                                      16-23
  07-00    PRKEEP               END                MRA            0                         RD_AMT                       24-31
                                     Reset         Reset
      Name            Type            By            State                                   Function
     IMG_EN           R/W          PRI_RST            0        Image Enable
                                                               The Image Enable bit can be changed with the following
                                                               actions:
                                                               • initial write to the BA field in the “PCI-1 I2O Target Image
                                                                 Base Address Register” on page 257
                                                               • register write to IMG_EN
                                                               The image enable is cleared by writing a zero to IMG_EN or
                                                               writing zero to the BA field in the Px_BSI2O. This effectively
                                                               disables I2O functionality.
                                                               0 = Disable
                                                               1 = Enable
PowerSpan II User Manual                                                                         Integrated Device Technology
80A1010_MA001_09                                                                                                   www.idt.com


12. Register Descriptions                                                                                 353
                              Reset   Reset
       Name             Type   By     State                             Function
      TA_EN              R/W PRI_RST    0    Translation Address Enable
                                             When set, the Translation Address (TADDR[15:0]) field, in
                                             the “PCI I2O Target Image Translation Address Register” on
                                             page 356 replaces the upper bits of the PCI bus address.
                                             The new address is used on the Processor Bus. Clearing
                                             the enable will result in no address translation.
                                             0 = Disable
                                             1 = Enable
     BAR_EN              R/W PRI_RST    0    PCI Base Address Register Enable
                                     EEPROM  When this bit is enabled the “PCI-1 I2O Target Image Base
                                             Address Register” on page 257 is Read/Write. When this bit
                                             is disabled the register is not visible and reads zero only.
                                             Writes to Px_BSI2O have no effect when this bit is cleared.
                                             This bit must be enabled for PCI BIOS configuration in order
                                             to map PowerSpan II PCI I2O Target Image into memory
                                             space.
                                             0 = Disable
                                             1 = Enable
      BS[3:0]            R/W PRI_RST    0    Block Size
                                     EEPROM  (64 Kbyte * 2BS)
                                             Specifies the size of the image, address lines compared and
                                             address lines translated (see Table 82 on page 354).
     RTT[4:0]            R/W PRI_RST 0b01010 Processor Bus Read Transaction Type (PB_TT[0:4])
                                             01010 = Read
       GBL               R/W PRI_RST    0    Global
                                             0=Assert PB_GBL_
                                             1=Negate PB_GBL_
         CI              R/W PRI_RST    0    Cache Inhibit
                                             0=Assert PB_CI_
                                             1=Negate PB_CI_
     WTT[4:0]            R/W PRI_RST 0b00010 Processor Bus Write Transaction Type (PB_TT[0:4])
                                             00010=Write with flush
Integrated Device Technology                                                     PowerSpan II User Manual
www.idt.com                                                                            80A1010_MA001_09


354                                                                                                 12. Register Descriptions
                                    Reset         Reset
     Name            Type             By           State                                  Function
    PRKEEP            R/W          PRI_RST           0        Prefetch Read Keep Data
                                                              This bit is used to hold read data is fetched beyond the initial
                                                              PCI read cycle. When set, subsequent read requests to the
                                                              same image at the next address retrieves the read data
                                                              directly from the switching fabric instead of causing the
                                                              destination bus to fetch more data. The read data is
                                                              invalidated when a read with a non-matching address
                                                              occurs.
                                                              0 = Disable
                                                              1 = Enable
    END[1:0]          R/W          PRI_RST          10b       Endian Conversion Mode
                                                              This selects the endian conversion mode.
                                                              00 = Little-endian
                                                              01 = PowerPC little-endian
                                                              10 = Big-endian
                                                              11 = True little-endian
     MRA              R/W          PRI_RST           0        PCI Memory Read Alias to MRM
                                                              When set, the PCI I2O Target Image will alias a PCI Memory
                                                              Read cycle to a PCI Memory Read Multiple cycle and
                                                              prefetches the number of bytes specified in the
                                                              RD_AMT[2:0] field. When MRA is the Target Image
                                                              prefetches 8 bytes when a PCI Memory Read cycle is
                                                              decoded and claimed.
                                                              0 = Disabled
                                                              1 = Enabled
  RD_AMT[2:0]         R/W          PRI_RST           0        Prefetch Size
                                                              Specifies the number of bytes the device will prefetch for
                                                              PCI Memory Read Multiple transactions claimed by the
                                                              target image (see Table 83 on page 355)
              BS: Specifies the size of the image, address lines compared and address lines translated.
              Table 82: Block Size
                        BS[3:0]                 Block Size              Address Lines Compared/Translated
                         0000                       64k                               AD31-AD16
                         0001                      128K                               AD31-AD17
                         0010                      256K                               AD31-AD18
                         0011                      512K                               AD31-AD19
                         0100                        1M                               AD31-AD20
PowerSpan II User Manual                                                                     Integrated Device Technology
80A1010_MA001_09                                                                                                www.idt.com


12. Register Descriptions                                                                                      355
                Table 82: Block Size
                          BS[3:0]               Block Size      Address Lines Compared/Translated
                            0101                     2M                       AD31-AD21
                            0110                     4M                       AD31-AD22
                            0111                     8M                       AD31-AD23
                            1000                    16M                       AD31-AD24
                            1001                    32M                       AD31-AD25
                            1010                    64M                       AD31-AD26
                            1011                   128M                       AD31-AD27
                            1100                   256M                       AD31-AD28
                            1101                   512M                       AD31-AD29
                            1110                     1G                       AD31-AD30
                            1111                     2G                          AD31
                        10100-11111              Reserved                      Reserved
                RD_AMT[2:0]: The read amount setting determines different values to prefetch from the destination
                bus (see Table 83 on page 355).
                Table 83: Read Amount
                      RD_AMT[2:0]               Data Fetched
                           000                     8 bytes
                           001                    16 bytes
                           010                    32 bytes
                           011                    64 bytes
                           100                   128 bytes
                         101-111                 Reserved
Integrated Device Technology                                                            PowerSpan II User Manual
www.idt.com                                                                                   80A1010_MA001_09


356                                                                                            12. Register Descriptions
12.5.63        PCI I2O Target Image Translation Address Register
               Address translation does not occur for I2O Shell Interface accesses.
 Register Name: PCI_TI2O_TADDR                                                                  Register Offset: 0x504
   PCI                                                                                                              PB
   Bits                                               Function                                                     Bits
  31-24                                                TADDR                                                        0-7
  23-16                                                TADDR                                                       8-15
  15-08                                        PowerSpan II Reserved                                              16-23
  07-00                                        PowerSpan II Reserved                                              24-31
                                    Reset          Reset
      Name            Type            By           State                              Function
   TADDR[15:0]        R/W          PRI_RST           0       Translation Address (through substitution)
                                                             When the TA_EN bit in the “PCI I2O Target Image Control
                                                             Register” on page 352 is set, TADDR[15:0] replaces the
                                                             PCI bus upper address bits, up to the size of the image.
PowerSpan II User Manual                                                                  Integrated Device Technology
80A1010_MA001_09                                                                                             www.idt.com


12. Register Descriptions                                                                                             357
12.5.64         I2O Control and Status Register
  Register Name: I2O_CSR                                                                       Register Offset: 0x508
    PCI                                                                                                            PB
    Bits                                       Function                                                           Bits
   31-24                                  PowerSpan II Reserved                                                    0-7
   23-16                                  PowerSpan II Reserved                                                   8-15
   15-08                                  PowerSpan II Reserved                                                  16-23
   07-00                HOPL_SIZE          EMTR          OFL             IPL         XI2O_         I2O_EN        24-31
                                                                                       EN
I
                                   Reset        Reset
       Name             Type        By          State                                 Function
    HOPL_SIZE            R/W      PRI_RST         0         Host Outbound Post List Size
         [2:0]                                              Specifies the size of the Host Outbound Post List
                                                            circular FIFO in the Host memory. The IOP must
                                                            program this field when PowerSpan II extended
                                                            Outbound Option support is enable (see Table 84).
       EMTR              R/W      PRI_RST         0         Empty FIFO Read Response
                                                            The Empty FIFO Read Response bit determines the
                                                            PowerSpan II response to an IOP read of the “I2O
                                                            Inbound Post List Bottom Pointer Register” on
                                                            page 365 or the “I2O Outbound Free List Bottom
                                                            Pointer Register” on page 368. If the EMTR bit is set, a
                                                            read from either of these registers when their
                                                            corresponding FIFO is empty will return 0xffff_ffff as
                                                            read data to the IOP. If the bit is not set, the contents of
                                                            the corresponding Pointer Register will be returned as
                                                            read data.
                                                            0 = return pointer on read when FIFO empty
                                                            1 = return 0xFFFF_FFFF on read when FIFO empty
         OFL              R       PRI_RST         0         Outbound Free List
                                                            Indicates status of the Outbound Free List FIFO. If this
                                                            bit is set, at least one Outbound Message Frame is
                                                            available in Host memory.
                                                            0 = empty
                                                            1 = not empty
Integrated Device Technology                                                              PowerSpan II User Manual
www.idt.com                                                                                       80A1010_MA001_09


358                                                                     12. Register Descriptions
I
                           Reset  Reset
     Name            Type   By    State                          Function
       IPL            R   PRI_RST   0   Inbound Post List
                                        Indicates status of the Inbound Post List FIFO. If this bit
                                        is set, there are Inbound Message Frames for the IOP
                                        to process.
                                        0 = empty
                                        1 = not empty
    XI2O_EN          R/W  PRI_RST   0   Extended MFA Enabled
                                        The IOP programs this bit to enable the PowerSpan II
                                        I2O Extended Capabilities support for the Outbound
                                        Option. The Host Outbound Index Offset Register
                                        needs to be programmed with the offset in the PCI I2O
                                        target Image where the Host Outbound Index Register
                                        can be located for the Outbound Option Support. This
                                        can be accomplished through the Host Outbound Index
                                        Alias register.
                                        The IOP will need to program the following registers to
                                        support I2O extended capabilities:
                                        • I2O IOP Outbound Index register
                                        • I2O Host Outbound Index Offset register
                                        • I2O Host Outbound Index Alias register
    I2O_EN           R/W  PRI_RST   0   I2O Enabled
                                        The local processor sets this bit to enable the
                                        PowerSpan II I2O Shell Interface support. The IOP
                                        must initialize the I2O Inbound Free list and Post list
                                        FIFO’s before enabling the PowerSpan II I2O Shell
                                        Interface. When this bit is cleared, all “PCI-1 I2O Target
                                        Image Base Address Register” on page 257 accesses
                                        on Primary PCI are retried.
                                        0 = I2O disabled
                                        1 = I2O enabled
PowerSpan II User Manual                                           Integrated Device Technology
80A1010_MA001_09                                                                       www.idt.com


12. Register Descriptions                                                                                      359
                HOPL_SIZE: This field specifies the size of the Host Outbound Post List circular FIFO in the Host
                memory. The IOP must program this field when PowerSpan II extended Outbound Option support is
                enabled.
                Table 84: Host Outbound Post List Size
                                                       Memory           PowerSpan II IOP Host
                                                       Required per     Outbound Index
                                  Max No. of MFAs      FIFO             Register bits
                 HOPL_SIZE [2:0]  per FIFO             (Kbytes)         incremented
                 000              256                  1                IOP_OI [9:2]
                 001
                 010              1K                   4                IOP_OI [11:2]
                 100              4K                   16               IOP_OI [13:2]
Integrated Device Technology                                                              PowerSpan II User Manual
www.idt.com                                                                                    80A1010_MA001_09


360                                                                                                       12. Register Descriptions
12.5.65            I2O Queue Base Address Register
                   This register specifies the location and size of the Inbound and Outbound Queues in processor memory
                   space. The IOP must program this register before enabling the PowerSpan II I2O Shell Interface.
 Register Name: I2O_QUEUE_BS                                                                               Register Offset: 0x50C
    PCI                                                                                                                        PB
    Bits                                                    Function                                                          Bits
   31-24                                                   PB_I2O_BS                                                           0-7
   23-16                         PB_I2O_BS                                        PowerSpan II Reserved                       8-15
   15-08                                              PowerSpan II Reserved                                                  16-23
   07-00                          PowerSpan II Reserved                                        FIFO_SIZE                     24-31
I2O_QUEUE_BS Description
                                              Reset           Reset
       Name                Type                By             State                                Function
    PB_I2O_BS              R/W              PRI_RST             0         Processor Bus I2O Base Address
        [11:0]                                                            The PB_I2O_BS field specifies the base address of the
                                                                          1 MB block of embedded PowerPC memory that
                                                                          contains the four FIFOs (Inbound Free List, Inbound
                                                                          Post List, Outbound Free List, Outbound Post List).
                                                                          The four FIFOs are of equal size, but do not need to be
                                                                          in contiguous memory locations. The PB_I2O_BS field
                                                                          is aliased in the most significant 12 bits of each of the
                                                                          PowerSpan II I2O Bottom and Top Pointer Registers.
  FIFO_SIZE [2:0]          R/W              PRI_RST             0         FIFO Size
                                                                          This field specifies the size of the circular FIFOs in the
                                                                          IOP local memory. Total FIFO memory allocation is
                                                                          four times the single FIFO size (see Table 85)
                   FIFO_SIZE: This field specifies the size of the circular FIFOs in the IOP local memory. Total FIFO
                   memory allocation is four times the single FIFO size (see Table 85).
Table 85: I2O FIFO Sizes
                                   Maximum Number of           Memory Required per            PowerSpan II I2O Pointer
       FIFO_SIZE [2:0]                MFAs per FIFO                 FIFO (Kbytes)                 bits incrementeda
               000                           256                           1                         I2O_PTR [9:2]
               001                           1K                             4                       I2O_PTR [11:2]
               010                           4K                            16                       I2O_PTR [13:2]
PowerSpan II User Manual                                                                             Integrated Device Technology
80A1010_MA001_09                                                                                                         www.idt.com


12. Register Descriptions                                                                                           361
Table 85: I2O FIFO Sizes
                                   Maximum Number of           Memory Required per     PowerSpan II I2O Pointer
       FIFO_SIZE [2:0]                 MFAs per FIFO               FIFO (Kbytes)          bits incrementeda
            011                             16K                          64                 I2O_PTR [15:2]
            100                             64K                         256                 I2O_PTR [17:2]
    a. I2O_PTR is one of the following: IFL_BOT, IFL_TOP, IPL_BOT, IPL_TOP, OFL_BOT, OFL_TOP, OPL_BOT, OPL_TOP
Integrated Device Technology                                                                    PowerSpan II User Manual
www.idt.com                                                                                          80A1010_MA001_09


362                                                                                                 12. Register Descriptions
12.5.66         I2O Inbound Free List Bottom Pointer Register
  Register Name: IFL_BOT                                                                             Register Offset: 0x510
    PCI                                                                                                                   PB
    Bits                                                   Function                                                      Bits
   31-24                                                 PB_I2O_BS                                                       0-7
   23-16                      PB_I2O_BS                                               BOT                                8-15
   15-08                                                     BOT                                                        16-23
   07-00                                        BOT                                            0            0           24-31
I
                                            Reset             Reset
       Name             Type                  By              State                           Function
    PB_I2O_BS             R               PRI_RST               0       Processor Bus I2O Base Address
        [11:0]
     BOT [17:0]          R/W              PRI_RST                0      Inbound Free List Bottom Pointer
                                                                        This pointer gives the address offset for the Inbound
                                                                        Free List Bottom Pointer from PB_I2O_BS.
                BOT: This pointer gives the address offset for the Inbound Free List Bottom Pointer from PB_I2O_BS.
                This pointer is initialized by the IOP and maintained by PowerSpan II. This pointer is incremented by
                four for each PCI read from the Inbound Queue.
                              If the initial values of the Inbound Free List Bottom and Top pointers are the
                              same, the inbound free list is empty. The user can program the Top pointer to be
                              four less than the Bottom pointer and then write to the INCR bit in the “Inbound
                              Free List Top Pointer Increment Register” on page 364 to make the inbound free
                              list full.
PowerSpan II User Manual                                                                       Integrated Device Technology
80A1010_MA001_09                                                                                                  www.idt.com


12. Register Descriptions                                                                                                   363
12.5.67         I2O Inbound Free List Top Pointer Register
 Register Name: IFL_TOP                                                                              Register Offset: 0x514
    PCI                                                                                                                  PB
    Bits                                                   Function                                                     Bits
   31-24                                                 PB_I2O_BS                                                      0-7
   23-16                      PB_I2O_BS                                               TOP                               8-15
   15-08                                                     TOP                                                       16-23
   07-00                                         TOP                                           0             0         24-31
                                           Reset            Reset
       Name             Type                  By             State                            Function
    PB_I2O_BS             R              PRI_RST               0      Processor Bus I2O Base Address
        [11:0]
     TOP [17:0]          R/W             PRI_RST               0      Inbound Free List Top Pointer
                                                                      This pointer gives the address offset for the Inbound
                                                                      Free List Top Pointer from PB_I2O_BS.
                TOP: This pointer gives the address offset for the Inbound Free List Top Pointer from PB_I2O_BS.
                This pointer is initialized by the IOP and can be incremented by four by writing a 1 to the INCR bit in
                the “Inbound Free List Top Pointer Increment Register” on page 364.
                              If the initial values of the Inbound Free List Bottom and Top pointers are the
                              same, the inbound free list is empty. The user can program the Top pointer to be
                              four less than the Bottom pointer and then set the INCR bit in the “Inbound Free
                              List Top Pointer Increment Register” on page 364 register to make the inbound
                              free list full.
Integrated Device Technology                                                                      PowerSpan II User Manual
www.idt.com                                                                                             80A1010_MA001_09


364                                                                                            12. Register Descriptions
12.5.68        Inbound Free List Top Pointer Increment Register
  Register Name: IFL_TOP_INC                                                                    Register Offset: 0x518
    PCI                                                                                                           PB
    Bits                                            Function                                                     Bits
   31-24                                    PowerSpan II Reserved                                                 0-7
   23-16                                    PowerSpan II Reserved                                                8-15
   15-08                                    PowerSpan II Reserved                                               16-23
   07-00                               PowerSpan II Reserved                                        INCR        24-31
I
                                   Reset      Reset
       Name            Type         By        State                                 Function
        INCR       Write 1 to set PRI_RST       0         Inbound Free List Top Pointer Increment
                                                          Write 1 to increment the pointer by four.
PowerSpan II User Manual                                                                 Integrated Device Technology
80A1010_MA001_09                                                                                           www.idt.com


12. Register Descriptions                                                                                                   365
12.5.69         I2O Inbound Post List Bottom Pointer Register
 Register Name: IPL_BOT                                                                             Register Offset: 0x51C
    PCI                                                                                                                  PB
    Bits                                                  Function                                                      Bits
   31-24                                                PB_I2O_BS                                                       0-7
   23-16                      PB_I2O_BS                                                BOT                              8-15
   15-08                                                    BOT                                                        16-23
   07-00                                       BOT                                            0               0        24-31
                                         Reset          Reset
       Name             Type               By            State                              Function
    PB_I2O_BS             R             PRI_RST            0       Processor Bus I2O Base Address
        [11:0]
     BOT [17:0]          R/W            PRI_RST            0       Inbound Post List Bottom Pointer
                                                                   This pointer gives the address offset for the Inbound Post
                                                                   List Bottom Pointer from PB_I2O_BS.
                BOT: This pointer gives the address offset for the Inbound Post List Bottom Pointer from PB_I2O_BS.
                This pointer is initialized by the IOP and can be incremented by four by setting the INCR bit in the
                “I2O Inbound Post List Bottom Pointer Increment Register” on page 366.
                              The initial values of the Inbound Post List Bottom and Top pointers must be the
                              same. After these pointers are initialized, the inbound post list is empty.
Integrated Device Technology                                                                      PowerSpan II User Manual
www.idt.com                                                                                              80A1010_MA001_09


366                                                                                        12. Register Descriptions
12.5.70       I2O Inbound Post List Bottom Pointer Increment Register
 Register Name: IPL_BOT_INC                                                                 Register Offset: 0x520
   PCI                                                                                                        PB
   Bits                                            Function                                                  Bits
  31-24                                    PowerSpan II Reserved                                              0-7
  23-16                                    PowerSpan II Reserved                                             8-15
  15-08                                    PowerSpan II Reserved                                            16-23
  07-00                               PowerSpan II Reserved                                       INCR      24-31
                                   Reset           Reset
      Name             Type         By              State                            Function
       INCR        Write 1 to set PRI_RST             0       Inbound Post List Bottom Pointer Increment
                                                              Write 1 to increment the pointer by four.
PowerSpan II User Manual                                                              Integrated Device Technology
80A1010_MA001_09                                                                                        www.idt.com


12. Register Descriptions                                                                                                   367
12.5.71         I2O Inbound Post List Top Pointer Register
 Register Name: IPL_TOP                                                                              Register Offset: 0x524
    PCI                                                                                                                  PB
    Bits                                                  Function                                                      Bits
   31-24                                                PB_I2O_BS                                                       0-7
   23-16                      PB_I2O_BS                                                TOP                              8-15
   15-08                                                    TOP                                                        16-23
   07-00                                       TOP                                            0               0        24-31
                                         Reset          Reset
       Name             Type               By            State                              Function
    PB_I2O_BS             R             PRI_RST            0       Processor Bus I2O Base Address
        [11:0]
     TOP [17:0]          R/W            PRI_RST            0       Inbound Post List Top Pointer
                                                                   This pointer gives the address offset for the Inbound Post
                                                                   List Top Pointer from PB_I2O_BS.
                TOP: This pointer gives the address offset for the Inbound Post List Top Pointer from PB_I2O_BS.
                This pointer is initialized by the IOP and maintained by PowerSpan II. This pointer is incremented by
                four for each PCI write to the Inbound Queue.
                              The initial values of the Inbound Post List Bottom and Top pointers should be
                              the same. After these pointers are initialized, the inbound post list is empty.
Integrated Device Technology                                                                      PowerSpan II User Manual
www.idt.com                                                                                              80A1010_MA001_09


368                                                                                              12. Register Descriptions
12.5.72        I2O Outbound Free List Bottom Pointer Register
 Register Name: OFL_BOT                                                                           Register Offset: 0x528
   PCI                                                                                                               PB
   Bits                                                Function                                                     Bits
  31-24                                               PB_I2O_BS                                                      0-7
  23-16                     PB_I2O_BS                                               BOT                             8-15
  15-08                                                   BOT                                                      16-23
  07-00                                     BOT                                             0              0       24-31
                                     Reset            Reset
      Name           Type              By              State                              Function
   PB_I2O_BS           R           PRI_RST               0         Processor Bus I2O Base Address
       [11:0]
    BOT [17:0]       R/W           PRI_RST               0         Outbound Free List Bottom Pointer
                                                                   This pointer gives the address offset for the
                                                                   Outbound Free List Bottom Pointer from PB_I2O_BS.
               BOT: This pointer gives the address offset for the Outbound Free List Bottom Pointer from
               PB_I2O_BS. This pointer is initialized by the IOP and can be incremented by four by writing a 1 to the
               INCR bit in the OFL_BOT_INC register.
                            The initial values of the Outbound Free List Bottom and Top pointers must be
                            the same. After these pointers are initialized, the outbound free list is empty.
PowerSpan II User Manual                                                                    Integrated Device Technology
80A1010_MA001_09                                                                                                www.idt.com


12. Register Descriptions                                                                                           369
12.5.73         I2O Outbound Free List Bottom Pointer Increment Register
 Register Name: OFL_BOT_INC                                                                   Register Offset: 0x52C
    PCI                                                                                                          PB
    Bits                                            Function                                                    Bits
   31-24                                    PowerSpan II Reserved                                                0-7
   23-16                                    PowerSpan II Reserved                                               8-15
   15-08                                    PowerSpan II Reserved                                              16-23
   07-00                               PowerSpan II Reserved                                        INCR       24-31
                                    Reset         Reset
       Name             Type         By           State                              Function
        INCR        Write 1 to set PRI_RST           0       Outbound Free List Bottom Pointer Increment
                                                             Write 1 to increment the pointer by four.
Integrated Device Technology                                                                PowerSpan II User Manual
www.idt.com                                                                                       80A1010_MA001_09


370                                                                                                12. Register Descriptions
12.5.74        I2O Outbound Free List Top Pointer Register
 Register Name: OFL_TOP                                                                             Register Offset: 0x530
   PCI                                                                                                                  PB
   Bits                                                 Function                                                       Bits
  31-24                                                PB_I2O_BS                                                       0-7
  23-16                      PB_I2O_BS                                               TOP                               8-15
  15-08                                                   TOP                                                         16-23
  07-00                                       TOP                                             0             0         24-31
                                         Reset           Reset
      Name             Type                By            State                               Function
   PB_I2O_BS             R              PRI_RST            0         Processor Bus I2O Base Address
       [11:0]
    TOP [17:0]          R/W             PRI_RST            0         Outbound Free List Top Pointer
                                                                     This pointer gives the address offset for the Outbound
                                                                     Free List Top Pointer from PB_I2O_BS.
               TOP: This pointer gives the address offset for the Outbound Free List Top Pointer from PB_I2O_BS.
               This pointer is initialized by the IOP and maintained by PowerSpan II. This pointer is incremented by
               four for each PCI write to the Outbound Queue.
                             The initial values of the Outbound Free List Bottom and Top pointers must be
                             the same. After these pointers are initialized, the outbound free list is empty.
PowerSpan II User Manual                                                                      Integrated Device Technology
80A1010_MA001_09                                                                                                 www.idt.com


12. Register Descriptions                                                                                                 371
12.5.75         I2O Outbound Post List Bottom Pointer Register
 Register Name: OPL_BOT                                                                            Register Offset: 0x534
    PCI                                                                                                                PB
    Bits                                                Function                                                      Bits
   31-24                                               PB_I2O_BS                                                      0-7
   23-16                     PB_I2O_BS                                               BOT                              8-15
   15-08                                                  BOT                                                        16-23
   07-00                                     BOT                                             0              0        24-31
                                       Reset           Reset
       Name             Type             By            State                              Function
    PB_I2O_BS             R          PRI_RST             0        Processor Bus I2O Base Address
        [11:0]
     BOT [17:0]          R/W         PRI_RST             0        Outbound Post List Bottom Pointer
                                                                  This pointer gives the address offset for the Outbound
                                                                  Post List Bottom Pointer from PB_I2O_BS.
                BOT: This pointer gives the address offset for the Outbound Post List Bottom Pointer from
                PB_I2O_BS. This pointer is initialized by the IOP and maintained by PowerSpan II. This pointer is
                incremented by four for each PCI read from the Outbound Queue.
                             The initial values of the Outbound Post List Bottom and Top pointers must be
                             the same. After these pointers are initialized, the outbound post list is empty.
Integrated Device Technology                                                                    PowerSpan II User Manual
www.idt.com                                                                                            80A1010_MA001_09


372                                                                                               12. Register Descriptions
12.5.76        I2O Outbound Post List Top Pointer Register
 Register Name: OPL_TOP                                                                            Register Offset: 0x538
   PCI                                                                                                                 PB
   Bits                                                  Function                                                     Bits
  31-24                                                PB_I2O_BS                                                      0-7
  23-16                      PB_I2O_BS                                               TOP                              8-15
  15-08                                                    TOP                                                       16-23
  07-00                                        TOP                                           0              0        24-31
                                         Reset         Reset
      Name             Type               By            State                              Function
   PB_I2O_BS            R              PRI_RST            0       Processor Bus I2O Base Address
       [11:0]
    TOP [17:0]         R/W             PRI_RST            0       Outbound Post List Top Pointer
                                                                  This pointer gives the address offset for the Outbound
                                                                  Post List Top Pointer from PB_I2O_BS.
               TOP: This pointer gives the address offset for the Outbound Post List Top Pointer from PB_I2O_BS.
               This pointer is initialized by the IOP and can be incremented by four by writing 1 to the INCR bit in the
               OPL_TOP_INC register.
                             The initial values of the Outbound Post List Bottom and Top pointers must be
                             the same. After these pointers are initialized, the outbound post list is empty.
PowerSpan II User Manual                                                                     Integrated Device Technology
80A1010_MA001_09                                                                                                 www.idt.com


12. Register Descriptions                                                                                             373
12.5.77         I2O Outbound Post List Top Pointer Increment Register
 Register Name: OPL_TOP_INC                                                                     Register Offset: 0x53C
    PCI                                                                                                            PB
    Bits                                             Function                                                     Bits
   31-24                                     PowerSpan II Reserved                                                 0-7
   23-16                                     PowerSpan II Reserved                                                8-15
   15-08                                     PowerSpan II Reserved                                               16-23
   07-00                                PowerSpan II Reserved                                         INCR       24-31
                                    Reset       Reset
       Name             Type         By         State                                Function
        INCR        Write 1 to set PRI_RST         0        Outbound Post List Top Pointer Increment
                                                            Write 1 to increment the pointer by four.
Integrated Device Technology                                                                  PowerSpan II User Manual
www.idt.com                                                                                         80A1010_MA001_09


374                                                                                             12. Register Descriptions
12.5.78       I2O Host Outbound Index Offset Register
 Register Name: HOST_OIO                                                                         Register Offset: 0x540
   PCI                                                                                                             PB
   Bits                                               Function                                                    Bits
  31-24                                        PowerSpan II Reserved                                               0-7
  23-16                                        PowerSpan II Reserved                                              8-15
  15-08                PowerSpan II Reserved                                       OIO                           16-23
  07-00                                     OIO                                           0             0        24-31
                                     Reset        Reset
      Name             Type           By          State                                Function
     OIO[9:0]          R/W         PRI_RST          0        Host Outbound Index Offset
                                                             Specifies the I2O Target Image Offset where the I2O Host
                                                             Outbound Index Register is located within the PowerSpan II
                                                             I2O Target Image.
              OIO[9:0]: Specifies the I2O Target Image Offset where the I2O Host Outbound Index Register is
              located within the PowerSpan II I2O Target Image. The I2O Host Outbound Index register must be in
              the first 4 Kbytes of the PowerSpan II I2O Target Image and be aligned to a 4-byte boundary.
                            This register must not be programmed with the following values: 0x030, 0x034,
                            0x040, 0x044.
PowerSpan II User Manual                                                                  Integrated Device Technology
80A1010_MA001_09                                                                                            www.idt.com


12. Register Descriptions                                                                                               375
12.5.79         I2O Host Outbound Index Alias Register
                This register is required for PowerSpan II IO Outbound Option support. This is an alias to the I2O
                Host Outbound Index Register in the PowerSpan II I2O Target Image. The Host maintains this register.
                This register indicates the address in Host memory from which the Host is to retrieve the next
                Outbound XMFA. This register is initialized by the IOP with an index received from the Host in an I2O
                message. The register will be written by the Host during I2O Outbound Option message passing.
                If the I2O Host Outbound Index Register and the I2O IOP Outbound Index Register differ, then the
                Outbound Post List Interrupt Status bit is set in the OPL_IS register at offset 0x30 of the PCI I2O target
                Image. When these registers contain the same Host memory address, the interrupt is cleared.
                This feature is only supported when the I2O Outbound Option is enabled with XI2O_EN bit in the
                “I2O Control and Status Register” on page 357.
                The HOPL_SIZE field in the “I2O Control and Status Register” on page 357 determines the alignment
                of this Index Register.
 Register Name: HOST_OIA                                                                           Register Offset: 0x544
    PCI                                                                                                              PB
    Bits                                                 Function                                                   Bits
   31-24                                                    OIA                                                     0-7
   23-16                                                    OIA                                                     8-15
   15-08                                                    OIA                                                    16-23
   07-00                                       OIA                                           0            0        24-31
                                       Reset         Reset
       Name              Type            By           State                              Function
     OIA[29:0]           R/W         PRI_RST            0         Host Outbound Index Alias Register
Integrated Device Technology                                                                     PowerSpan II User Manual
www.idt.com                                                                                           80A1010_MA001_09


376                                                                                              12. Register Descriptions
12.5.80        I2O IOP Outbound Index Register
               This register is required for PowerSpan II I2O Outbound Option support. This register indicates the
               address in Host memory to which the IOP is to post the next Outbound XMFA. The IOP maintains this
               register.
               If the I2O Host Outbound Index Register and the I2O IOP Outbound Index Register differ, then the
               Outbound Post List Interrupt Status bit is set in the OPL_IS register at offset 0x30 of the PCI I2O target
               Image. When these registers contain the same Host memory address, the Interrupt is cleared.
               This feature is only supported when the I2O Outbound Option is enabled with the XI2O_EN bit in the
               “I2O Control and Status Register” on page 357.
               The HOPL_SIZE bit in the “I2O Control and Status Register” on page 357 determines the alignment of
               this Index Register.
  Register Name: IOP_OI                                                                           Register Offset: 0x548
    PCI                                                                                                             PB
    Bits                                               Function                                                    Bits
   31-24                                                   OI                                                      0-7
   23-16                                                   OI                                                      8-15
   15-08                                                   OI                                                     16-23
   07-00                                       OI                                           0            0        24-31
I
                                      Reset       Reset
       Name             Type           By         State                                Function
      OI[29:0]           R/W        PRI_RST         0          IOP Outbound Index
PowerSpan II User Manual                                                                    Integrated Device Technology
80A1010_MA001_09                                                                                             www.idt.com


12. Register Descriptions                                                                                             377
12.5.81         I2O IOP Outbound Index Increment Register
                The IOP writes 1 to INCR to increment the IOP Outbound Index Register.
  Register Name: IOP_OI_INC                                                                     Register Offset: 0x54C
    PCI                                                                                                            PB
    Bits                                              Function                                                    Bits
   31-24                                       PowerSpan II Reserved                                               0-7
   23-16                                       PowerSpan II Reserved                                              8-15
   15-08                                       PowerSpan II Reserved                                             16-23
   07-00                                 PowerSpan II Reserved                                         INCR      24-31
I
                                     Reset        Reset
       Name             Type          By          State                               Function
        INCR        Write 1 to set  PRI_RST         0        IOP Outbound Index Increment
                                                             Write 1 to increment the pointer by four.
Integrated Device Technology                                                                  PowerSpan II User Manual
www.idt.com                                                                                         80A1010_MA001_09


378                                                                                                    12. Register Descriptions
12.5.82        PCI-2 Configuration Registers
                                                                                                Register Offset: 0x800-0x8FC
PCI-2 Configuration
                                                            Function
 The PCI-2 Configuration Registers are functionally identical to the PCI-1 Configuration Registers from offsets 0x000-0FC.
 Documentation of the PCI-2 Configuration Space is the same as the PCI-1 Interface, shifting the register offsets up by 0x800
 and swapping PCI-1 and PCI-2 everywhere.
PowerSpan II User Manual                                                                          Integrated Device Technology
80A1010_MA001_09                                                                                                    www.idt.com


12. Register Descriptions                                                                                                   379
12.5.83           PCI-2 Target Image Control and Status Registers
                                                                                               Register Offset: 0x900-0x9FC
PCI-2 Target Image
                                                          Function
 The PCI-2 Target Image Control and Status Registers are functionally identical to the PCI-1 Target Image Control and Status
 Registers from offsets 0x100-1FC. Documentation of the PCI-2 Target Images is the same as the PCI-1 Images, shifting the
 register offsets up by 0x800 and swapping PCI-1 and PCI-2 everywhere.
Integrated Device Technology                                                                         PowerSpan II User Manual
www.idt.com                                                                                               80A1010_MA001_09


380                           12. Register Descriptions
PowerSpan II User Manual Integrated Device Technology
80A1010_MA001_09                          www.idt.com


                                                                                                                      381
13.             Electrical and Signal Characteristics
                This chapter describes the electrical characteristics of the PowerSpan II device. It also details the
                pin-outs of both the Single PCI PowerSpan II and Dual PCI PowerSpan II. The following topics are
                discussed:
                •     “Electrical Characteristics” on page 381
                •     “Power Dissipation” on page 383
                •     “Operating Conditions” on page 384
13.1            Electrical Characteristics
                PowerSpan II’s electrical characteristics are defined by PCI electrical characteristics and non-PCI
                electrical characteristics.
13.1.1          PCI Electrical Characteristics
                PowerSpan II's PCI interfaces are electrically compatible with the 3.3V and the 5.0V signaling
                interfaces as defined by the PCI 2.2 Specification.
                PowerSpan II supports the CompactPCI Hot Swap Specification Revision 2.0 and is classified as Hot
                Swap Silicon. PowerSpan II is compliant with the PCI Local Bus Specification Revision 2.2 regarding
                device accessibility after release of LOCAL_PCI_RST_ through Initially Retrying. Optionally devices
                can choose to Initially Not Respond after release.
13.1.2          Non-PCI Electrical Characteristics
                The following table, Table 86, specifies the required DC characteristics of all non-PCI PowerSpan II
                signal pins.
Table 86: HBGA Electrical Characteristics (non-PCI)a
                  Symbol      Parameter             Condition                    Min           Max            Units
                  VIL         Input low voltage     VOUT  VOH(min) or           - 0.3         0.8            V
                                                    VOUT  VOL(max)
                  VIH         Input high voltage                                 2.0           VDD + 0.3      V
                              (5 V tolerant
                              LVTTL)
                  Iin         Input leakage         VIN = 0 V or VIN = VDD                     5              µA
                              Current
                  Iin         Input leakage         VIN = 0 V or VIN = VDD       -2.0          -100           µA
                              Current
                              (internal pull-up)
Integrated Device Technology                                                                  PowerSpan II User Manual
www.idt.com                                                                                          80A1010_MA001_09


382                                                                         13. Electrical and Signal Characteristics
Table 86: HBGA Electrical Characteristics (non-PCI)a
                Symbol    Parameter             Condition                   Min            Max          Units
                Iin       Input leakage         VIN = 0 V or VIN = VDD      2.0            100          µA
                          Current
                          (internal pull-down)
                VOH       Output high voltage   VDD = min, IOH = -10mA      2.4                         V
                VOL       Output low voltage    VDD = min, IOH = 10mA                      0.4          V
                CIN       Input Capacitance                                                10           pF
                IOLb      Output Low Current    VOL=1.5V                    25             100          mA
                          (65 ohm output)
               a. Non-PCI DC Electrical Characteristics (Ta= -40°C to 85°C)
               b. CompactPCI Hot Swap LED pin
PowerSpan II User Manual                                                              Integrated Device Technology
80A1010_MA001_09                                                                                       www.idt.com


13. Electrical and Signal Characteristics                                                                    383
13.2             Power Dissipation
                 Table 87 shows the Single PCI PowerSpan II power dissipation..
                 Table 87: Single PCI PowerSpan II Power Dissipation
                    Processor
                    Bus Clock      PCI-1 Clock     Vdd I/O     Vdd Core         Maximum
                      50 MHz          33 MHz        0.17          0.93           1.1 W
                      66 MHz          33 MHz         0.2           1.1           1.3 W
                     100 MHz          66 MHz         0.4           1.9           2.3 W
                 Table 88 shows the Dual PCI PowerSpan II power dissipation
                 Table 88: Dual PCI PowerSpan II Power Dissipation
                    Processor
                    Bus Clock      PCI-1 Clock   PCI-2 Clock    Vdd I/O         Vdd Core     Maximum
                      50 MHz          33 MHz       25 MHz         0.17            0.93         1.1 W
                      66 MHz          33 MHz       33 MHz          0.2            1.1          1.3 W
                     100 MHz          66 MHz       66 MHz          0.4            1.9          2.3 W
Integrated Device Technology                                                             PowerSpan II User Manual
www.idt.com                                                                                  80A1010_MA001_09


384                                                                             13. Electrical and Signal Characteristics
13.3          Operating Conditions
13.3.1        Recommended Operating Conditions
              The following table, Table 89, specifies the recommended operating conditions of the PowerSpan II.
              Table 89: Operating and Storage Conditions
                Symbol               Parameter           Min                   Max                   Units
                Vdd I/O              I/O DC Supply       3.15                  3.45                  V
                                     Voltage
                Vdd Core             Core Supply         2.38                  2.63                  V
                                     Voltage
                Px_VDDA              PLL Supply Voltage   2.38                 2.63                  V
                Ta                   Ambient             -40                   +85                   °C
                                     Temperature
                H                    Humidity             0                    80                    % Relative
                                                                                                     Humidity
13.3.2        Handling and Storage Specifications
              After encapsulation, cure cavity down assemblies are JESD22-A112 Moisture Sensitivity Category 3.
              From that point on, parts are to be handled to the following criteria:
              1. From encapsulation cure to BGA/PGA attach, Class 3 modules can be exposed for a maximum
                   cumulative time of eight days to an environment of no more than 30 OC and/or 60% RH. If this
                   condition is exceeded, modules are to be baked at
                   125 O C +/- 10 OC for 24 hours minimum or at other qualified bake parameters.
              2. Modules shall be placed in an ESD carrier. Each module shall be orientated in the same way. When
                   preparing for shipment to stock location, modules are to be baked at 125 O C +/- 10 O C for 24
                   hours minimum or at other qualified bake parameters. Modules are to be sealed within 24 hours for
                   Class 3 modules in a moisture barrier ESD bag with desiccant. This bakeout procedure can be
                   repeated once to remain in compliance.
              3. Failure to comply with this requirement can result in die to die pad, encapsulant to soldermask or
                   encapsulant to die delamination during reflow.
PowerSpan II User Manual                                                                  Integrated Device Technology
80A1010_MA001_09                                                                                            www.idt.com


13. Electrical and Signal Characteristics                                                                                385
13.3.3           Absolute Maximum Ratings
                 The following table, Table 90, specifies the absolute maximum ratings of
                 PowerSpan II.
                 Table 90: Absolute Maximum Ratings
                  Symbol                     Parameter             Limits                     Units
                  Vdd Corea b                Core Supply Voltage   -0.3 to 2.7                V
                  Vdd I/Oa c                 I/O Supply Voltage    -0.3 to 3.6                V
                  Px_VDDAa b                 PLL Supply Voltage    -0.3 to 2.7                V
                  Vina d e                   DC Input Voltage      -0.3 to Vdd + 0.3          V
                                             (LVTTL)
                  Vina d e                   DC Input Voltage (5 V -0.6 to 5.5                V
                                             tolerant LVTTL)
                  Tstg                       Storage Temperature   -65 to 150                 °C
                 a. Functional operation at the maximums is not guaranteed. Stress beyond those listed can affect
                     device reliability or cause permanent damage to PowerSpan II.
                 b. Vdd Core/ Px_VDDA must not exceed Vdd I/O by more than 0.4 V. This includes during
                     power-on reset.
                 c. Vdd I/O must not exceed Vdd Core/ Px_VDDA by more than 1.6 V. This includes during
                     power-on reset.
                 d. These limits only apply to overshoot and undershoot. Cell functionality is not implied.
                 e. Vin must not exceed Vdd I/O by more than 2.5 V at any time. This includes during power-on
                     reset.
Integrated Device Technology                                                                         PowerSpan II User Manual
www.idt.com                                                                                                 80A1010_MA001_09


386                      13. Electrical and Signal Characteristics
PowerSpan II User Manual           Integrated Device Technology
80A1010_MA001_09                                    www.idt.com


                                                                                                                 387
14.             Package Information
                This appendix discusses PowerSpan II’s packaging (mechanical) features. The following topics are
                discussed:
                •   “Package Characteristics” on page 387
                •   “Thermal Characteristics” on page 391
14.1            Package Characteristics
                PowerSpan II’s package characteristics are summarized in the following sections.
14.1.1          Single PCI PowerSpan II 420 HSBGA
                Figure 28 illustrates the top, side, and bottom views of the PowerSpan II package.
                Table 91: Package Characteristics
                          Feature                                Description
                  Package Type                 420 HSBGA
                  Package Body Size            35mm
                  JEDEC Specification          JEDEC MO-151 Variation BAT-1
Integrated Device Technology                                                                 PowerSpan II User Manual
www.idt.com                                                                                        80A1010_MA001_09


388                                                                                               14. Package Information
Figure 28: 420 HSBGA
                                                         Notes:
                                                         1. All dimensions in mm.
                                                         2. All dimension and tolerances conform to ANSI Y14.5M-1994.
                                                         3. Conforms to JEDEC MO-034 Variation BAR-1.
14.1.1.1      Package Notes
              1. All dimensions in mm
              2. All dimensions and tolerance conform to ANSI Y14.5M - 1994
              3. Conforms to JEDEC MS-034 Variation BAR-1
PowerSpan II User Manual                                                                   Integrated Device Technology
80A1010_MA001_09                                                                                              www.idt.com


14. Package Information                                                                                          389
14.1.2          Dual PCI PowerSpan II 480 HSBGA
                Figure 29 illustrates the top, side, and bottom views of the PowerSpan II package.
                Table 92: Package Characteristics
                         Feature                                 Description
                 Package Type                  480 HSBGA
                 Package Body Size             37.5mm
                 JEDEC Specification           JEDEC MO-151 Variation BAT-1
Integrated Device Technology                                                                 PowerSpan II User Manual
www.idt.com                                                                                        80A1010_MA001_09


390                                                                                           14. Package Information
Figure 29: 480 HSBGA
                                                          Notes:
                                                          1. All dimensions in mm.
                                                          2. All dimension and tolerances conform to ANSI
                                                          Y14.5M-1994.
                                                          3. Conforms to JEDEC MO-151 Variation BAT-1.
14.1.2.1      Package Notes
              1. All dimensions in mm
              2. All dimensions and tolerance conform to ANSI Y14.5M - 1994
              3. Conforms to JEDEC MO-151 Variation BAT-1
PowerSpan II User Manual                                                                Integrated Device Technology
80A1010_MA001_09                                                                                          www.idt.com


14. Package Information                                                                                                391
14.2            Thermal Characteristics
                The thermal performance of PowerSpan II package is represented by the following parameters:
                1. JA, Thermal resistance from junction to ambient
                           JA = (TJ - TA) / P
                    Where,
                    TJ is the junction temperature
                    TA is the ambient temperature
                    P is the power dissipation
                    JA represents the resistance to the heat flows from the chip to ambient air. It is an index of heat
                    dissipation capability. Lower JA means better thermal performance.
                2. JT, Thermal characterization parameter from junction-to-top center
                          JT = (TJ - TT) / P
                    Where TT is the temperature of the top-center of the package
                    JT is used to estimate junction temperature by measuring TT in actual environment.
                3. 3. JC, Thermal resistance from junction to case
                           JC = (TJ – TC) / P
                    Where,
                    TC is the case temperature
                    JC is a measure of package internal thermal resistance from chip to package exterior.
                      The value is dependent upon package material and package geometry.
                    JA, JC and JT simulation are carried out to show the thermal performance of the PowerSpan II.
Integrated Device Technology                                                                  PowerSpan II User Manual
www.idt.com                                                                                           80A1010_MA001_09


392                                                                                           14. Package Information
14.2.1        Single PCI 420 HSBGA Package
              The thermal characteristics for the 420 package are based on the parameters in Table 93.
              Table 93: Thermal Parameters
                                         Package Conditions
                Package type                      HSBGA 420
                Package size                      35 x 35 x 2.33 mm3
                Pitch                             1.27 mm
                Pad size                          318 x 318 mil2
                Chip size                         232 x 232 mil2
                Substrate (layers)                4 Layer
                Substrate thickness               0.56 mm
                                   PCB Conditions (JEDEC JESD51-7)
                PCB Layers                        4 Layer
                PCB dimensions                    101.6 x 114.3 mm
                PCB thickness                     1.6 mm
                                        Simulation conditions
                Power dissipation                 3.0 watts
                Ambient temperature               55 C
              Table 94 shows the thermal characterization parameters from junction-to-top center (JT) and the
              thermal resistance from junction to case for the 420 package. These values are based on the parameters
              described in Table 93.
              Table 94: 420 HSBGA Package Performance
                                     Theta ja (C/W)
                      0 m/s              1 m/s               2 m/s         Psijt (C/W)      Theta jc (C/W)
                       16.5               14.6                13.2            5.48                6.80
PowerSpan II User Manual                                                                Integrated Device Technology
80A1010_MA001_09                                                                                         www.idt.com


14. Package Information                                                                                            393
14.2.2          Dual PCI 480 HSBGA Package
                The thermal characteristics for the 480 package are based on the parameters in Table 95.
                Table 95: Thermal Parameters
                                          Package Conditions
                 Package type                      HSBGA 480L
                 Package size                      37.5 x 37.5 x 2.33 mm3
                 Pitch                             1.27 mm
                 Pad size                          303 x 303 mil2
                 Chip size                         253 x 253 mil2
                 Substrate (layers)                4 Layer
                 Substrate thickness               0.56 mm
                                    PCB Conditions (JEDEC JESD51-7)
                 PCB Layers                        4 Layer
                 PCB dimensions                    101.6 x 114.3 mm
                 PCB thickness                     1.6 mm
                                         Simulation Conditions
                 Power dissipation                 3.0 watts
                 Ambient temperature               85 C
                Table 96 shows the thermal characterization parameters from junction-to-top center (JT) and the
                thermal resistance from junction to case for the 480 package. These values are based on the parameters
                described in Table 95.
                Table 96: 480 PBGA Package Performance
                                      Theta ja (C/W)
                       0 m/s              1 m/s               2 m/s          Psijt (C/W)      Theta jc (C/W)
                        15.1               13.2                11.8             4.87               6.00
Integrated Device Technology                                                                 PowerSpan II User Manual
www.idt.com                                                                                        80A1010_MA001_09


394                            14. Package Information
PowerSpan II User Manual Integrated Device Technology
80A1010_MA001_09                          www.idt.com


                                                                                                                   395
15.             AC Timing
                This chapter describes PowerSpan II’s AC Timing parameters. The following topics are discussed:
                •   “Single PCI PowerSpan II Timing Parameters” on page 396
                •   “Dual PCI PowerSpan II Timing Parameters” on page 402
                •   “Timing Diagrams” on page 408
15.1            Overview
                This chapter describes the timing information for the PowerSpan II device. The timing for the both the
                Single and the Dual PCI PowerSpan II’s Processor Bus Interface is 100 MHz, while the PCI
                Interface(s) can operate either at 33 MHz or 66 MHz.
Integrated Device Technology                                                                PowerSpan II User Manual
www.idt.com                                                                                       80A1010_MA001_09


396                                                                                                          15. AC Timing
15.2            Single PCI PowerSpan II Timing Parameters
                The timing parameters specified in this document are guaranteed by design. Test conditions for timing
                parameters in Table 97 to Table 101 are:
                •    Commercial (C): 0ºC to 70ºC, 3.15 - 3.45V, 2.38 - 2.63V
                •    Industrial (I): -40ºC to 85ºC, 3.15 - 3.45V, 2.38 - 2.63V
                Table 97: Reset, and Clock Timing Parameters
                                                                                    CE/IE
      Timing
    Parameter                            Description                            Min        Max         Units        Note
 Reset Timing
 t100             Power-up reset pulse width                                 500                    ns            1
 t101             Back end power stable to back end power-up reset           500                    ns
                  released.
 t102             Clock frequency stable before release of power-up reset    0                      ns            2
 t103             PLL lock time                                              100        400         us            3
 t104             Reset propagation delay                                               20          ns
 t 105            PCI bus reset timing after the negation of PO_RST_         50                     ns
 t428             TRST_ pulse width                                          500                    ns            4
 Power-up Option Timing
 t110             Power-up option setup time on multiplexed system pins      10                     ns
 t111             Power-up option hold time on multiplexed system pins       3.0        10          ns             5
                  INT[4]_                                                    3.2        10          ns             5
 t112             Power-up option setup time to PB_RSTCONF_                  10                     ns
 t113             Power-up option hold time from PB_RSTCONF_                 5                      ns
 t114             PB_RSTCONF_ pulse width                                    1                      PB_CLKs
 Processor Clock Timing
 t120             PB_CLK period                                              10         40          ns
                  PB_CLK frequency                                           25         100         MHz
 t121             PB_CLK high time                                           4                      ns
 t122             PB_CLK low time                                            4                      ns
 t123             PB_CLK slew rate                                           2                      V/ns
PowerSpan II User Manual                                                                     Integrated Device Technology
80A1010_MA001_09                                                                                              www.idt.com


15. AC Timing                                                                                                                                           397
                      Table 97: Reset, and Clock Timing Parameters
                                                                                                          CE/IE
       Timing
    Parameter                                       Description                                     Min           Max             Units            Note
  t124                  PB_CLK cycle to cycle jitter                                                           300            ps
  PCI Clock Timing
  t130                  P1_CLK period                                                           15             40             ns
                        P1_CLK frequency                                                        25             66             MHz
  t131                  P1_CLK high time                                                        6                             ns
  t132                  P1_CLK low time                                                         6                             ns
  t133                  P1_CLK slew rate                                                        2                             V/ns
  t134                  P1_CLK cycle to cycle jitter                                                           300            ps
  Clock to Clock Relationships
  t140                  Clock period ratio                                                      1              <4             -                  6
1.      Pulse width measured from Vdd Core (2.5V), Vdd I/O (3.3V), and Px_VDDA supplies in specification
2.      Required for PB_CLK, and P1_CLK. This parameter ensures that each PLL locks. If a frequency change is required, a new power-up sequence
        must be initiated.
3.      This parameter is a function of the slowest frequency of PB_CLK, and P1_CLK. The minimum occurs at 100 MHz, the maximum at 25 MHz.
        After this time, PowerSpan II is synchronized to external buses and able to participate in transactions once externally applied resets are released.
4.      Assertion of TRST_ is required at power-up to initialize the JTAG controller and configure the Boundary Scan Register for normal system oper-
        ation.
5.      The maximum specification ensures correct power-up levels on PB_FAST, and P1_M66EN and ensures stable system levels on INT[5:1]_ before
        the power-up reset sequence completes. The INT[4]_ signal has a minimum time of 3.2.
6.      The ratio of largest to smallest clock period for PB_CLK, P1_CLK must be strictly less than four. For example, if PB_CLK period is 12 ns, the
        period of P1_CLK must be less than 48 ns.
Integrated Device Technology                                                                                             PowerSpan II User Manual
www.idt.com                                                                                                                      80A1010_MA001_09


398                                                                                                                      15. AC Timing
                     PowerSpan II’s PCI interface can be configured for operating frequencies between 25 and 33 MHz by
                     ensuring that the pin Px_M66EN is connected to logic zero. Table 98 summarizes the timing behavior
                     of a PowerSpan II PCI interface configured in this way. This table is valid for operation in 3.3V or
                     5.0V signaling environments.
Table 98: PCI 33 MHz Timing Parameters
                                                                                                     CE/IE
      Timing
    Parameter                                         Description                                Min      Max        Units      Note
  t200                Float to active delay                                                    2                  ns
  t201                Active to float delay                                                              28       ns
  t202                Signal valid delay
                      Bussed signals                                                           2         11       ns
                      Point to point signals                                                   2         12       ns           1
  t203                Input setup time
                      Bussed signals                                                           7                  ns
                      Point to point signals                                                   10                 ns           2
  t204                Input hold time                                                          0                  ns
  t205                P1_REQ64# to P1_RST# setup time
                      Adapter scenario                                                         10                 PB_CLKs      3
                      Host scenario                                                            10                 PB_CLKs      5
  t206                P1_RST# to P1_REQ64# hold time
                      Adapter scenario                                                         2.3                ns           3, 4
                      Host scenario                                                            0         50       ns           5
  t207                Reset to float                                                                     40       ns
1.     This group of point to point signals include: P1_REQ[1]#, P1_GNT[4:1]#, and PCI_GNT[7:5]#.
2.     This group of point to point signals include: P1_GNT[1]#, P1_REQ[4:1]#, and PCI_REQ[7:5]#.
3.     In the adapter scenario, an external agent controls both P1_REQ64# and P1_RST#.
4.     In the PCI Local Bus Specification (Revision 2.2) this value is required to be 0 ns.
5.     In the host scenario, PowerSpan II controls both P1_REQ64# and P1_RST#.
PowerSpan II User Manual                                                                                  Integrated Device Technology
80A1010_MA001_09                                                                                                           www.idt.com


15. AC Timing                                                                                                                399
                     Each PowerSpan II PCI interface can be configured for 66 MHz operating frequencies by ensuring that
                     the pin Px_M66EN is connected to logic one. Table 99 summarizes the timing behavior of a
                     PowerSpan II PCI interface configured in this way. This table is valid for operation in a 3V signaling
                     environment.
Table 99: PCI 66 MHz Timing Parameters
                                                                                              CE/IE
       Timing
    Parameter                                      Description                             Min     Max    Units    Note
  t200                 Float to active delay                                             1             ns
  t201                 Active to float delay                                                      14   ns
  t202                 Signal valid delay
                       Bussed signals                                                    1        6.0  ns
                       Point to point signals                                            1        6.0  ns          1
  t203                 Input setup time
                       Bussed signals                                                    3.0           ns
                       Point to point signals                                            5.0           ns          2
  t204                 Input hold time                                                   0             ns
  t205                 P1_REQ64# to P1_RST# setup time
                       Adapter scenario                                                  10            PB_CLKs     3
                       Host scenario                                                     10            PB_CLKs     4
  t206                 P1_RST# to P1_REQ64# hold time
                       Adapter scenario                                                  2.3           ns          3
                       Host scenario                                                     0        50   ns          4
  t207                 Reset to float                                                             40   ns
1.     This group of point to point signals include: P1_REQ[1]#, P1_GNT[4:1]#, and PCI_GNT[7:5]#.
2.     This group of point to point signals include: P1_GNT[1]#, P1_REQ[4:1]#, and PCI_REQ[7:5]#.
3.     In the adapter scenario, an external agent controls both P1_REQ64# and P1_RST#.
4.     In the host scenario, PowerSpan II controls both P1_REQ64# and P1_RST#.
Integrated Device Technology                                                                             PowerSpan II User Manual
www.idt.com                                                                                                    80A1010_MA001_09


400                                                                                                                         15. AC Timing
                    The PowerSpan II PB Interface can be configured for 100 MHz operating frequencies. Table 100
                    summarizes the timing behavior of a PowerSpan II PB interface configured for 100 MHz.
Table 100: PB Timing Parameters
                                                                                                   CE/IE
     Timing
   Parameter                                       Description                                Min       Max      Units    Note
  t302              PB_CLK to output valid delay
                    Parameter group outputs                                                 1.0        5.0      ns       1,2
                    Control group outputs                                                   1.0        5.0      ns       1,3
                    PB_ARTRY_                                                               1.0        5.0      ns       1
                    Arbitration group outputs                                               1.0        5.0      ns       1, 4
  t303              Input setup time
                    Bussed signals                                                          3.0                 ns
                    PB_AP                                                                   2.0                 ns
                    Point to point signals                                                  3.0                 ns       5
  t304              Input hold time                                                         0.3                 ns
1.     Numbers measured into lumped 35 pF load.
2.     The transaction parameter group of signals includes: PB_A[0:31], PB_AP[0:3], PB_TSIZ[0:3], PB_TT[0:4], PB_TBST_, PB_GBL_, PB_CI_,
       PB_D[0:63], PB_DP[0:7].
3.     The transaction control group of signals includes: PB_TS_, PB_ABB_, PB_DBB_, PB_TA_, PB_DVA_L, PB_TEA_, PB_AACK_.
4.     The transaction arbitration group outputs includes: PB_BR[1]_, PB_BG[1:3]_, PB_DBG[1:3]_
5.     The point to point signals include: PB_BG[1]_, PB_BR[1:3]_, PB_DBG[1]_
PowerSpan II User Manual                                                                                   Integrated Device Technology
80A1010_MA001_09                                                                                                              www.idt.com


15. AC Timing                                                                                                                                         401
Table 101: Miscellaneous Timing Parameters
                                                                                               CE/IE
     Timing
   Parameter                                   Description                                 Min        Max             Units            Note
  Interrupt Timing
  t400             Float to active delay                                                  2          15         ns                    1
  t401             Active to float delay                                                  2          15         ns                    1
  t402             Input setup time                                                       3                     ns                    2
  t403             Input hold time                                                        0.5                   ns                    2
  t404             Pulse width                                                            4                     PB_CLKs               3
  I2C Timing
  t410             I2C_SCLK period                                                        1024       1024       PB_CLKs
  t411             I2C_SCLK high time                                                     512        512        PB_CLKs
  t412             I2C_SCLK low time                                                      512        512        PB_CLKs
  t413             STOP condition setup time                                              512        512        PB_CLKs
  t414             Bus free time                                                          512                   PB_CLKs
  t415             START condition setup time                                             1024                  PB_CLKs
  t416             START condition hold time                                              512        512        PB_CLKs
  t417             Data output valid time                                                 256        256        PB_CLKs
  t418             Data output hold time                                                  256        256        PB_CLKs
  t419             Data sample time                                                       256        256        PB_CLKs
1.     Numbers measured into 35 pF load.
2.     PowerSpan II synchronizes these inputs before using them. This parameter must be met for deterministic response time.
3.     PowerSpan II filters these inputs to ensure spurious low going pulses are not recognized as active interrupts. An interrupt pin is considered valid
       if three PB_CLK samples yield the same result.
Integrated Device Technology                                                                                            PowerSpan II User Manual
www.idt.com                                                                                                                     80A1010_MA001_09


402                                                                                                        15. AC Timing
15.3            Dual PCI PowerSpan II Timing Parameters
                The timing parameters specified in this document are guaranteed by design. Test conditions for timing
                parameters in Table 102 to Table 106 are:
                •   Commercial (C): 0ºC to 70ºC, 3.15 - 3.45V, 2.38 - 2.63V
                •   Industrial (I): -40ºC to 85ºC, 3.15 - 3.45V, 2.38 - 2.63V
Table 102: Reset, and Clock Timing Parameters
                                                                                   CE/IE
       Timing
     Parameter                            Description                          Min        Max        Units        Note
 Reset Timing
 t100               Power-up reset pulse width                              500                   ns            1
 t101               Back end power stable to back end power-up reset        500                   ns
                    released.
 t102               Clock frequency stable before release of power-up reset 0                     ns            2
 t103               PLL lock time                                           100        400        us            3
 t104               Reset propagation delay                                            20         ns
 t 105              PCI bus reset timing after the negation of PO_RST_      50                    ns
 t428               TRST_ pulse width                                       500                   ns            4
 Power-up Option Timing
 t110               Power-up option setup time on multiplexed system pins   10                    ns
 t111               Power-up option hold time on multiplexed system pins    3.0        10         ns             5
 t112               Power-up option setup time to PB_RSTCONF_               10                    ns
 t113               Power-up option hold time from PB_RSTCONF_              5                     ns
 t114               PB_RSTCONF_ pulse width                                 1                     PB_CLKs
 Processor Clock Timing
 t120               PB_CLK period                                           10         40         ns
                    PB_CLK frequency                                        25         100        MHz
 t121               PB_CLK high time                                        4                     ns
 t122               PB_CLK low time                                         4                     ns
 t123               PB_CLK slew rate                                        2                     V/ns
 t124               PB_CLK cycle to cycle jitter                                       300        ps
PowerSpan II User Manual                                                                   Integrated Device Technology
80A1010_MA001_09                                                                                            www.idt.com


15. AC Timing                                                                                                                                        403
Table 102: Reset, and Clock Timing Parameters
                                                                                                         CE/IE
        Timing
      Parameter                                       Description                                 Min            Max            Units           Note
  PCI Clock Timing
  t130                     P1_CLK, P2_CLK period                                               15            40             ns
                           P1_CLK, P2_CLK frequency                                            25            66             MHz
  t131                     P1_CLK, P2_CLK high time                                            6                            ns
  t132                     P1_CLK, P2_CLK low time                                             6                            ns
  t133                     P1_CLK, P2_CLK slew rate                                            2                            V/ns
  t134                     P1_CLK, P2_CLK cycle to cycle jitter                                              300            ps
  Clock to Clock Relationships
  t140                     Clock period ratio                                                  1             <4             -                 6
1.     Pulse width measured from Vdd Core (2.5V), Vdd I/O (3.3V), and Px_VDDA supplies in specification
2.     Required for PB_CLK, P1_CLK and P2_CLK. This parameter ensures that each PLL locks. If a frequency change is required, a new power-up
       sequence must be initiated.
3.     This parameter is a function of the slowest frequency of PB_CLK, P1_CLK, and P2_CLK. The minimum occurs at 100 MHz, the maximum at 25
       MHz. After this time, PowerSpan II is synchronized to external buses and able to participate in transactions once externally applied resets are
       released.
4.      Assertion of TRST_ is required at power-up to initialize the JTAG controller and configure the Boundary Scan Register for normal system oper-
       ation.
5.     The maximum specification ensures correct power-up levels on PB_FAST, P1_M66EN and P2_M66EN and ensures stable system levels on
       INT[5:1]_ before the power-up reset sequence completes.
6.     The ratio of largest to smallest clock period for PB_CLK, P1_CLK, P2_CLK must be strictly less than four. For example, if PB_CLK period is 12
       ns, the periods of P1_CLK and P2_CLK must be each less than 48 ns.
Integrated Device Technology                                                                                           PowerSpan II User Manual
www.idt.com                                                                                                                   80A1010_MA001_09


404                                                                                                                         15. AC Timing
                     PowerSpan II’s PCI interface can be configured for operating frequencies between 25 and 33 MHz by
                     ensuring that the pin Px_M66EN is connected to logic zero. Table 103 summarizes the timing behavior
                     of a PowerSpan II PCI interface configured in this way. This table is valid for operation in 3.3V or
                     5.0V signaling environments.
Table 103: PCI 33 MHz Timing Parameters
                                                                                                    CE/IE
      Timing
    Parameter                                         Description                               Min       Max         Units        Note
  t200                Float to active delay                                                   2                    ns
  t201                Active to float delay                                                              28        ns
  t202                Signal valid delay
                      Bussed signals                                                          2          11        ns
                      Point to point signals                                                  2          12        ns             1
  t203                Input setup time
                      Bussed signals                                                          7                    ns
                      Point to point signals                                                  10                   ns             2
  t204                Input hold time                                                         0                    ns
  t205                P1_REQ64# to P1_RST# setup time
                      Adapter scenario                                                        10                   PB_CLKs        3
                      Host scenario                                                           10                   PB_CLKs        4
  t206                P1_RST# to P1_REQ64# hold time
                      Adapter scenario                                                        2.3                  ns             3
                      Host scenario                                                           0          50        ns             4
  t207                Reset to float                                                                     40        ns
1.     This group of point to point signals include: P1_REQ[1]#, P2_REQ[1]#, P1_GNT[4:1]#, P2_GNT[4:1]#, and PCI_GNT[7:5]#.
2.     This group of point to point signals include: P1_GNT[1]#, P2_GNT[1]#, P1_REQ[4:1]#, P2_REQ[4:1]#, and PCI_REQ[7:5]#.
3.     In the adapter scenario, an external agent controls both P1_REQ64# and P1_RST#.
4.     In the host scenario, PowerSpan II controls both P1_REQ64# and P1_RST#.
PowerSpan II User Manual                                                                                   Integrated Device Technology
80A1010_MA001_09                                                                                                             www.idt.com


15. AC Timing                                                                                                                     405
                     Each PowerSpan II PCI interface can be configured for 66 MHz operating frequencies by ensuring that
                     the pin Px_M66EN is connected to logic one. Table 104 summarizes the timing behavior of a
                     PowerSpan II PCI interface configured in this way. This table is valid for operation in a 3V signaling
                     environment.
Table 104: PCI 66 MHz Timing Parameters
                                                                                              CE/IE
       Timing
    Parameter                                      Description                            Min      Max         Units      Note
  t200                 Float to active delay                                            1                   ns
  t201                 Active to float delay                                                      14        ns
  t202                 Signal valid delay
                       Bussed signals                                                   1         6.0       ns
                       Point to point signals                                           1         6.0       ns           1
  t203                 Input setup time
                       Bussed signals                                                   3.0                 ns
                       Point to point signals                                           5                   ns           2
  t204                 Input hold time                                                  0                   ns
  t205                 P1_REQ64# to P1_RST# setup time
                       Adapter scenario                                                 10                  PB_CLKs      3
                       Host scenario                                                    10                  PB_CLKs      4
  t206                 P1_RST# to P1_REQ64# hold time
                       Adapter scenario                                                 2.3                 ns           3
                       Host scenario                                                    0         50        ns           4
  t207                 Reset to float                                                             40        ns
1.     This group of point to point signals include: P1_REQ[1]#, P2_REQ[1]#, P1_GNT[4:1]#, P2_GNT[4:1]#, and PCI_GNT[7:5]#.
2.     This group of point to point signals include: P1_GNT[1]#, P2_GNT[1]#, P1_REQ[4:1]#, P2_REQ[4:1]#, and PCI_REQ[7:5]#.
3.     In the adapter scenario, an external agent controls both P1_REQ64# and P1_RST#.
4.     In the host scenario, PowerSpan II controls both P1_REQ64# and P1_RST#.
Integrated Device Technology                                                                                  PowerSpan II User Manual
www.idt.com                                                                                                         80A1010_MA001_09


406                                                                                                                        15. AC Timing
                    The PowerSpan II PB Interface can be configured for 100 MHz operating frequencies. Table 105
                    summarizes the timing behavior of a PowerSpan II PB interface configured for 100 MHz.
Table 105: PB Timing Parameters
                                                                                                          CE/IE
      Timing
    Parameter                                          Description                                    Min       Max      Units     Note
  t302                PB_CLK to output valid delay
                      Parameter group outputs                                                       1.0        5.0      ns       1,2
                      Control group outputs                                                         1.0        5.0      ns       1,3
                      PB_ARTRY_                                                                     1.0        5.0      ns       1
                      Arbitration group outputs                                                     1.0        5.0      ns       1, 4
  t303                Input setup time
                      Bussed signals                                                                3.0                 ns
                      PB_AP                                                                         2.0                 ns
                      Point to point signals                                                        3.0                 ns       5
                      PB_BG[1]_                                                                     3.8                 ns
                      PB_DBG[1]_                                                                    3.2                 ns
                      PB_ARTRY_                                                                     3.2                 ns
  t304                Input hold time
                      PB_DBG[1]_                                                                    0.2                 ns
                      All other inputs                                                              0.3                 ns
1.     Numbers measured into lumped 35 pF load.
2.     The transaction parameter group of signals includes: PB_A[0:31], PB_AP[0:3], PB_TSIZ[0:3], PB_TT[0:4], PB_TBST_, PB_GBL_, PB_CI_,
       PB_D[0:63], PB_DP[0:7].
3.     The transaction control group of signals includes: PB_TS_, PB_ABB_, PB_DBB_, PB_TA_, PB_DVA_L, PB_TEA_, PB_AACK_.
4.     The transaction arbitration group outputs includes: PB_BR[1]_, PB_BG[1:3]_, PB_DBG[1:3]_
5.     The point to point signals include: PB_BR[1:3]_
PowerSpan II User Manual                                                                                   Integrated Device Technology
80A1010_MA001_09                                                                                                             www.idt.com


15. AC Timing                                                                                                                                         407
Table 106: Miscellaneous Timing Parameters
                                                                                                        CE/IE
      Timing
    Parameter                                      Description                                     Min        Max               Units             Note
  Interrupt Timing
  t400              Float to active delay                                                        2           15         ns                       1
  t401              Active to float delay                                                        2           15         ns                       1
  t402              Input setup time                                                             3                      ns                       2
  t403              Input hold time                                                              0.5                    ns                       2
  t404              Pulse width                                                                  4                      PB_CLKs                  3
  I2C Timing
  t410              I2C_SCLK period                                                              1024        1024       PB_CLKs
  t411              I2C_SCLK high time                                                           512         512        PB_CLKs
  t412              I2C_SCLK low time                                                            512         512        PB_CLKs
  t413              STOP condition setup time                                                    512         512        PB_CLKs
  t414              Bus free time                                                                512                    PB_CLKs
  t415              START condition setup time                                                   1024                   PB_CLKs
  t416              START condition hold time                                                    512         512        PB_CLKs
  t417              Data output valid time                                                       256         256        PB_CLKs
  t418              Data output hold time                                                        256         256        PB_CLKs
  t419              Data sample time                                                             256         256        PB_CLKs
1.     Numbers measured into 35 pF load.
2.     PowerSpan II synchronizes these inputs before using them. This parameter must be met for deterministic response time.
3.     PowerSpan II filters these inputs to ensure spurious low going pulses are not recognized as active interrupts. An interrupt pin is considered valid
       if three PB_CLK samples yield the same result.
Integrated Device Technology                                                                                            PowerSpan II User Manual
www.idt.com                                                                                                                     80A1010_MA001_09


408                                                                                                      15. AC Timing
15.4           Timing Diagrams
               The timing diagrams in this section apply to both the Single PCI PowerSpan II and the Dual PCI
               PowerSpan II.
               Figure 30: Power-up Reset: CompactPCI Adapter Scenario
                                                   Reset                              Ready for initialization
                             t100           t101
            HEALTHY_
                                       t100
                                                 t102
             PO_RST_
                               t428
                 TRST_
                 Px_CLK
                                                             t103
              plls locked
         P1_RST_DIR
              P1_RST#                                              t105
         PB_RST_DIR
                                          t104                                    t104
             PB_RST_
         P2_RST_DIR
                                          t104                                    t104
              P2_RST#
               Notes:
               1. P1_RST# configured as input
               2. PB_RST_ and P2_RST# configured as output
               3. If JTAG is not used, the TRST_ signal can be pulled low through a resistor (~2.5 KOhm).
PowerSpan II User Manual                                                               Integrated Device Technology
80A1010_MA001_09                                                                                           www.idt.com


15. AC Timing                                                                                                  409
                Figure 31: Power-up Options: Multiplexed System Pin Approach
                                            t101
              HEALTHY_
                                              t110                  t111
                PO_RST_
                PB_FAST                             System Level                         Power-up Level
              P1_M66EN                              System Level                         Power-up Level
              P2_M66EN                              System Level                         Power-up Level
                 INT[5:1]_                         Power-up Level                         System Level
                Figure 32: Power-up Options: Configuration Slave Mode
                    PB_RST_
                                                              t114
              PB_RSTCONF_
                                                           t112          t113
                   PB_D[0:31]                            Configuration Word
                Notes:
                1. The power-up options latched by the Configuration Slave mode take precedence over those latched
                    by the Multiplexed System Pins mode.
                2. The configuration master runs configuration cycles as part of each HRESET_ sequence.
Integrated Device Technology                                                              PowerSpan II User Manual
www.idt.com                                                                                    80A1010_MA001_09


410                                                                                            15. AC Timing
              Figure 33: Clocking
                                        t120
                                        t120
                                   t121       t122
                PB_CLK
                                                                                 t130
                                                                       t131              t132
                P1_CLK
                                                        t130
                                             t131                         t132
                P2_CLK
              Figure 34: PCI Timing
                                                             t203
                                                                  t204
         PCI Clock (P1_CLK, P2_CLK)
                            PCI Input
                                                   t200              t202                     t201
                          PCI Output
PowerSpan II User Manual                                                       Integrated Device Technology
80A1010_MA001_09                                                                                www.idt.com


15. AC Timing                                                                                                411
                Figure 35: PCI Miscellaneous Timing; Compact PCI Adapter Scenario
             PCI Reset (P1_RST#, P2_RST#)
                                                              t207
                                PCI Outputs
                                                                                         t205        t206
                                  P1_RST#
                                P1_REQ64#
                Figure 36: P1_REQ64_ Assertion Timing
                   PB_RST
            PB_RSTCONF
                 PB_D[0:31]                             Configuration Word
                                                                                    t205           t206
               P1_REQ64#
                                          t104                                                   t104
                  P1_RST#
                Notes:
                1. Assertion of P1_REQ64# is determined by a power-up option. The Configuration Slave mode
                    power-up option is depicted in Figure 32 on page 409.
                2. In a CompactPCI Host application, PowerSpan II controls P1_RST# and P1_REQ64# and can
                    ensure compliance with t205 and t206. In CompactPCI Adapter application, the system must
                    guarantee P1_RST# negated after PowerSpan II power-up options loaded.
Integrated Device Technology                                                            PowerSpan II User Manual
www.idt.com                                                                                    80A1010_MA001_09


412                                                                                                  15. AC Timing
              Figure 37: Processor Bus Timing
                                                                       t303
                                                                            t304
                                PB_CLK
                                PB Input
                                                                               t302
           PB Parameter Group Outputs
                                                        t302
           PB Arbitration Group Outputs
                                                       t302                      t302
              PB Control Group Outputs
                                                       t302                                    t302
                            PB_ARTRY_
              Notes:
              1. The transaction parameter group of signals includes: PB_A[0:31], PB_AP[0:3], PB_TSIZ[0:3],
                   PB_TT[0:4], PB_TBST_, PB_GBL_, PB_CI_, PB_D[0:63], PB_DP[0:7].
              2. The transaction control group of signals includes: PB_TS_, PB_ABB_, PB_DBB_, PB_TA_,
                   PB_DVAL_, PB_TEA-, PB_AACK_.
              3. The transaction arbitration group outputs includes: PB_BR[1]_, PB_BG[1:3]_, PB_DBG[1:3]_.
PowerSpan II User Manual                                                              Integrated Device Technology
80A1010_MA001_09                                                                                       www.idt.com


15. AC Timing                                                                                         413
                Figure 38: Interrupt Timing
                                         PB_CLK
                                                  t400              t401
           P1_INTA#, P2_INTA#, INT[5:0] (output)
                                                                        t404
                                                    t402                                   t403
             P1_INTA#, P2_INTA#, INT[5:0] (input)
                Figure 39: I2C Timing
                                   t410
                               t411    t412                                  t416            t419
           I2C_SCLK
                                                              t415
                                                                t414
                                                         t413
                                          t417    t418
            I2C_SDA                                        STOP/START
Integrated Device Technology                                                      PowerSpan II User Manual
www.idt.com                                                                           80A1010_MA001_09


414                                     15. AC Timing
PowerSpan II User Manual Integrated Device Technology
80A1010_MA001_09                          www.idt.com


                                                                                                                     415
16.             Ordering Information
                This appendix discusses PowerSpan II’s ordering information.
16.1            Ordering Information
                When ordering the PowerSpan II please refer to the device by its full part number, as displayed in
                Table 107.
Table 107: Standard Ordering Information
                                                     Voltage
                                                     (IO/
 Part Number          Description      Frequency     CORE)        Temperature         Package          Diameter (mm)
 CA91L8200B-          Dual PCI         100MHz        3.3/2.5      0° to 70°C          480 HSBGA        37.5 x 37.5 x
 100CE                PowerSpan II                                                                     1.27
 CA91L8200B-          Dual PCI         100MHz        3.3/2.5      -40° to 85°C        480 HSBGA        37.5 x 37.5 x
 100IE                PowerSpan II                                                                     1.27
 CA91L8260B-          Single PCI       100MHz        3.3/2.5      0° to 70°C          420 HSBGA        35 x 35 x 1.27
 100CE                PowerSpan II
 CA91L8260B-          Single PCI       100MHz        3.3/2.5      -40° to 85°C        420 HSBGA        35 x 35 x 1.27
 100IE                PowerSpan II
Integrated Device Technology                                                                 PowerSpan II User Manual
www.idt.com                                                                                       80A1010_MA001_09


416                            16. Ordering Information
PowerSpan II User Manual Integrated Device Technology
80A1010_MA001_09                          www.idt.com


                                                                                                                    417
A.              Hardware Implementation
                This chapter describes hardware implementation issues that can be faced when using the PowerSpan II
                device. The following topics are discussed:
                •   “Recommended Bootstrap Diode” on page 417
                •   “PLL External Decoupling” on page 418
A.1             Overview
                When PowerSpan II is designed into a system, certain hardware implementation requirements must be
                addressed. This chapter deals with design issues in a PowerSpan II system.
A.2             Recommended Bootstrap Diode
                IDT recommends the use of a bootstrap diode between the power rails. The bootstrap diodes that are
                used in the system must be configured so that a nominal Core Supply Voltage (Vdd Core) is sourced
                from the I/O Supply Voltage (Vdd I/O) until the power supply is active. In Figure 40, two Schottky
                barrier diodes are connected in series. Each of the diodes has a forward voltage (VF) of 0.6V at high
                currents which provides a 1.2V current drop. This drop maintains 2.1V on the 2.5V power line. Once
                the Core/PLL power supply stabilizes at 2.5V, the bootstrap diode(s) are reverse biased with small
                leakage current.
                Figure 40: Bootstrap Diodes for Power-up Sequencing
                   I/O Power                                                         3.3 V (Vdd I/O)
                   Core/PLL
                   Power                                                              2.5 V (Vdd Core/Px_VDDA)
                          The forward voltage must be effective at the current levels required by PowerSpan II (< 1
                          amp). Do not use diodes with only a nominal VF which drops to low at high current.
Integrated Device Technology                                                                  PowerSpan II User Manual
www.idt.com                                                                                        80A1010_MA001_09


418                                                                                         A. Hardware Implementation
A.3           PLL External Decoupling
              The PLLs in the PowerSpan II device should be externally decoupled in order to have the cleanest
              possible supply environment. IDT recommends two decoupling scenarios for PowerSpan II. The first
              recommendation is a backwards compatible design that enables migrating PowerSpan II users to
              employ the decoupling scheme used in the original PowerSpan II. The second recommendation is for
              new PowerSpan II designs.
A.3.1         Backwards Compatible PLL Decoupling for Migrating PowerSpan II
              Designs
              VDDA is the voltage supply pin to the analog circuits in the PLL. Noise on VDDA can cause phase
              jitter at the output of the PLL. To provide isolation from the noisy internal digital circuitry, a filter
              circuit can be placed on VDDA (see Figure 41).
              Figure 41: PLL Power Filter
                      Ferrite Bead = Murata BLM32A06 or equivalent
                  VDD                                                                          VDDA
                                            +
                             C= 1μF                                                  C = 0.1μF
              All wire lengths must be kept short in order to minimize coupling from other signals.
A.3.1.1       Recommended Decoupling Capacitors
              PowerSpan II requires the Core Supply Voltage (Vdd Core (2.5V)) and I/O Supply Voltage (Vdd I/O
              (3.3V)) be decoupled to reduce switching noise. One bulk capacitor of 10 uF is recommended for the
              Vdd Core and Vdd I/O supplies. Every third pair of power and ground pins must be decoupled with a
              0.1 uF surface mount capacitor to reduce high frequency switching noise.
              The track lengths from the power and ground pins to the capacitors must be kept as short. Based on this
              recommendation, eight 0.1uF capacitors are required for the I/O supply and twelve 0.1uF capacitors for
              the core supply. In order to keep the track lengths to the capacitors as short as possible, use integrated
              capacitor components. It is possible to obtain components which have four 0.1uF capacitors in a 0612
              size package. Other quantities and values of capacitors can be used at the discretion of the designer.
PowerSpan II User Manual                                                                  Integrated Device Technology
80A1010_MA001_09                                                                                             www.idt.com


A. Hardware Implementation                                                                                                                               419
A.3.2           PowerSpan II External PLL Decoupling for New Designs
                To provide the cleanest possible supply environment for the PLL, the supplies should be decoupled
                externally. Isolation should be provided between the external core supply voltage on the board and the
                supply that goes to the PLL. This can be done in the following ways:
                •     A separate core voltage regulator can be provided and a separate trace run up to the PLL supply
                      pins.
                •     An isolation and decoupling network can be provided for on the board to isolate and minimize
                      noise on the core voltage supply plane before it gets to the PLL supply pins.
                For optimum PLL jitter performance, the PLL should be isolated and decoupled from the main core
                power plane using a surface mount RF inductor and low ESR tantalum surface mount capacitor
                network is recommended. The power supplies for PLLs on a device should come from a single point on
                the board. The power trace should then be isolated from the main power plane using the network
                shown in Figure 42 on page 419.
                The routing parasitic resistance of the trace route from any PLL supply pin to the decoupling capacitors
                in the isolation network must be less than 0.1 Ohms. To minimize the transient IR drops across the
                leads from the isolation network and the PLL supply device pins, the trace routes must be kept short.
                The preferred layout is to have the cripple capacitors, shown in Figure 42 on page 419, placed as close
                to the device pins as possible; potentially on the backside of the board underneath the device.
                Figure 42: PLL Decoupling
                                               The trace routing and
                                                                                                         The trace routing
                                        the Rdc of the inductor accounts
                                                                                                         resistance must be
                                        for this resistance and should be
                                                                                                  less than 0.1Ohms to Cripple1
                                                in the range shown.
                                                                                                            and Cripple2.
                                                       .0.5 Ohms(MIn)
                Core VDD                                4 Ohms(Max)
                                                                                                                         PLL_AVDD
                                Lfilter
                             470nH(Min)
                             4.7uH(Min)                               Cfilter
                              (RF SMT)                                                              Cripple1
                                                                    4.7uF(Min)
                                                                                                      0.1uF
                                                                    33uF(Max)
                                                                                                                          PLL_AVSS
                       Lfilter must
                                                                                                                         PLL_DVDD  PowerSpan II
                      be a high SRF
                     SMT Wire wound                  Cfilter must be a
                       RF inductor.                                                                 Cripple2
                                                    low ESR Tantalum                                  0.1uF
                                                      SMT capacitor.
                                                                                                                          PLL_DVSS
                                                                  The VDD to VSS 0.1uF decoupling caps
                                                               must be as close to the device pins as possible.
                                                              Capacitors should be Low ESR (High Frequency)
                                                                              ceramic chip capacitors.
Integrated Device Technology                                                                                                         PowerSpan II User Manual
www.idt.com                                                                                                                                 80A1010_MA001_09


420                        A. Hardware Implementation
PowerSpan II User Manual Integrated Device Technology
80A1010_MA001_09                          www.idt.com


                                                                                                                   421
B.              Typical Applications
                This chapter describes typical applications for PowerSpan II.
                •   “Overview” on page 421
                •   “WinPath and PowerSpan II Applications” on page 427
                •   “WinPath and PowerSpan II Applications” on page 427
B.1             Overview
                The PowerSpan II Processor Bus Interface supports Motorola, IBM and Wintegra embedded
                processors. In the following sections describe typical applications involving Motorola and WinPath
                processors.
B.2             PowerQUICC II and PowerSpan II Applications
                Motorola’s family of embedded PowerPC processors are widely used in the deployment of
                communications products. The introduction of the PowerQUICC II, with its unsurpassed levels of
                integration and performance, enhances the role of PowerPC in communications systems. PowerSpan II
                has a general purpose Processor Bus (PB) Interface to Motorola’s PowerPC embedded processor
                family, which enables the design of PCI based communication products.
                This section highlights the use of PowerSpan II in PowerPC and CompactPCI applications.
B.2.1           Direct Connect Support
                The PowerSpan II PB Interface provides direct connect support for a number of PowerPC embedded
                processors. The block diagram in Figure 43 illustrates a system where the PowerSpan II and the
                PowerQUICC II and PowerPC 7xx are directly connected.
                The PowerQUICC II is a 64-bit bus master in this system. It can only interact with agents that have a
                64-bit port size. Since the PowerPC 7xx does not generate the extended transaction types of the
                PowerQUICC II, it needs to be configured to meet PowerQUICC II constraints.
                Figure 43 illustrates the system where PowerSpan II provides the following support:
                •   Processor bus
                     — Address and data bus arbitration
                     — Processor bus Master/Slave capability
                •   Single or dual PCI access
                •   Four channel DMA
Integrated Device Technology                                                                  PowerSpan II User Manual
www.idt.com                                                                                       80A1010_MA001_09


422                                                                                                                                                   B. Typical Applications
              The PowerSpan II PB Interface fully supports the multi processing cache coherent aspects of the
              processor bus. The PowerSpan II PB Interface can only interact with 64-bit port size agents.
              The presence of the PowerPC 7xx limits the extent of extended cycle support in the system depicted in
              Figure 43.
                               The SIZ[0] pin is hardwired on PowerSpan II and the PowerQUICC II. PowerSpan II must
                               operate with extended cycles disabled. It is still possible for the PowerQUICC II bus master
                               to target SDRAM with extended cycles.
              Figure 43: PowerSpan II in Multi-processor 60x system
                                                                                                                                       A[10:0]                                        2MX8
                                                                                                                address latch
                                                                                A[0:31]
                                                                                                                                                                                                                      8 SDRAM
                                                                                                                  and mux
                                                                                                                                                                                      2MX8
                                        Clock Source
                                                                                                                                                                                                   WE_DQM_BS_B[0:7]
                                                                                                                                                       POE_SDRAS_GPL2
                                                                                                 SDA10_GPL0          SDAMUX_GPL5         PSDWE_GPL1                     PSDCAS_GPL3
                                                                                                              ALE
                                                                                                                                                                                             CSO
                                                  PB_CLK                                  CLKIN
                                                 PB_BR[3]                                 BR
                                                 PB_BG[3]                                 BG
                                               PB_DBG[3]
                                                                                          ABB
                                                                                          A[0:31], AP[0:3], TT[0:4], TBST
                                                 PB_BR[2]                                 TSIZ[0]
                                                 PB_BG[2]                                 TSIZ[1:3]
                                                                                          GBL, CI
                                               PB_DBG[2]
                                                                                          TS
                                                                                          ARTRY
                                                                                                                                                      MPC8260
                                                 PB_BR[1]                                 AACK
                                                 PB_BG[1]                                 APE
                                                                                          DBG
                                               PB_DBG[1]
                                                                                          DBB
                                                                                          DH[0:31], DL[0:31], DP[0:7]
                     PowerSpan                    PB_ABB
                                                                                          TA
                                                  PB_DBB
                                                                                          DVAL
                                                                                          TEA
               PB_A[0:31], PB_AP[0:3], PB_TT[0:4], PB_TBST
                                               PB_TSIZ[0]
                                             PB_TSIZ[1:3]
                                           PB_GBL, PB_CI
                                                   PB_TS                                  SYSCLK
                                                                                          BR
                                               PB_ARTRY
                                                                                          BG
                                                PB_AACK                                   ABB
                                                                                          A[0:31], AP[0:3], TT[0:4], TBST
                                                                             [1:3]
                                                                                          TSIZ[0:2]
                                                                                          GBL, CI
                                    PB_D[0:63], PB_DP[0:7]
                                                                                          TS
                                                                                          ARTRY
                                                   PB_TA
                                                                                          AACK
                                                                                          APE                                                    MPC740
                                                 PB_DVAL
                                                                                          DBG
                                                  PB_TEA                                  DBB
                                                                                          DH[0:31], DL[0:31], DP[0:7]
                                                                                          TA
                                                                                          TEA
                                                                                          DPE
                                                                                          DBDIS
                                                                                          TLBISYNC
                                                                                          DRTRY
PowerSpan II User Manual                                                                                                           Integrated Device Technology
80A1010_MA001_09                                                                                                                                    www.idt.com


B. Typical Applications                                                                                             423
                 The PowerQUICC II is the system memory controller being used in this application in order to manage
                 64-bit wide SDRAM. The PowerQUICC II has processor bus master and slave capability. As a bus
                 master in this system it can access SDRAM and PCI. The address latch and multiplexor allow the
                 external processor bus agents, the PowerPC 7xx, and PowerSpan II to access PowerQUICC II
                 controlled memory. Additionally, the PowerPC 7xx and PowerSpan II can program PowerQUICC II
                 registers and master the PowerQUICC II local bus.
                 The PowerSpan II processor bus arbiter controls system boot. Boot can be selected from PCI by
                 configuring the arbiter at power-up to ignore all external requests on Bus Request (PB_BR[3:1]_). This
                 allows an external PCI master to configure the PowerQUICC II memory controller and load system
                 boot code before enabling recognition of requests on PB_BR[3:1]_.
                 Alternatively, at power-up the processor bus arbiter is configured to recognize requests on PB_BR[1]_
                 and ignore requests on PB_BR[3:2]_. In this case the processor connected to PB_BR[1]_ enables
                 recognition of requests from other masters when its system configuration tasks are complete.
B.2.2            CompactPCI Adapter Card
                 A common PowerSpan II application is the support of PowerQUICC II based CompactPCI adapter
                 cards. These cards are installed in peripheral slots of the CompactPCI chassis.
                 In Figure 44 PowerSpan II is in a dual PowerQUICC II application. One processor is selected to be the
                 Configuration master (RSTCONF_ is tied low) while the second processor, and PowerSpan II, are
                 configuration slaves.
                 Optionally, the second processor could have the PowerPC core disabled and be used strictly to provide
                 more serial interface capability.
                 PowerSpan II’s PCI-1 Interface is designated as the Primary Interface, through power-up option, and is
                 connected to the CompactPCI backplane. It is possible to designate either PCI-1 or PCI-2 as the
                 Primary Interface with a power-up option. The backplane supplies reset, clock and central resource
                 functionality. The Secondary PCI Interface, PCI- 2, connects to a secondary PCI system on the card
                 and provides reset and arbitration for the secondary bus.
Integrated Device Technology                                                                   PowerSpan II User Manual
www.idt.com                                                                                          80A1010_MA001_09


424                                                                                                                                                                                           B. Typical Applications
              Figure 44: PowerSpan II in CompactPCI Peripheral Slot
                                                                                                                                                                                           Power On       Flash    EEPROM
                                                                                                                                                                                            Reset
                                                                                                                    HEALTHY
                                             P1_RST_DIR                                                              PO_RST                                                                     PORESET
                                             P1_RST                                                                  PB_RST                                                                     HRESET
                                                                                                               PB_RST_DIR
                                             P1_INTA                                                                                                                     A[1]                               MPC8260
                                                                                                                                                                                                                  (master)
                                                                                                              PB_RSTCONF                                                                         RSTCONF
                                             P1_REQ[1]                                                                                                                                           A[0:6]
                                             P1_GNT[1]                                                                      INT[0]                                                               IRQ0
               Compact PCI P1/J1 Connector
                                             P1_CLK                                                                                                                                              CLKIN
                                                                                                                            INT[2]                    Board Interrupts
                                                                                                                          PB_CLK
                                                                          PowerSpan
                                                                                                                                                                                                PORESET
                                                                                                                                                                                                HRESET
                                                                                                                          I2C_SDA
                                                                                                                                                                                A[0]
                                                                                                                                                      EEPROM                                    RSTCONF
                                                                                                                    I2C_SCLK
                                                                                                                                                                                                          MPC8260
                                                                                                                                                                                                              (slave)
                                              P2_RST_DIR
                                                                                                                                                                                                 CLKIN
                                                                                      P2_REQ[2]
                                                                          P2_REQ[1]
                                                           P2_RST                                 P2_GNT[2]     P2_INTA       P2_CLK
                                                                          P2_GNT[1]
                                                                                                                                                                                                      66MHZ
                                                                                                                                                                                                              Clock
                                                                                                                                                                                                            Generataor
                                                                                                                                                                                                      33MHZ    and
                                                                                                                                                                                                               PLL
                                                           RST#
                                                                                                                                       RST#
                                                                                                                                                     GNT#
                                                                          REQ#
                                                                                                                                              REQ#
                                                                    CLK
                                                                          GNT#        INTA#                                             CLK                 INTA#
                                                                                          Secondary PCI Agents
              All PowerSpan II resources are reset when PO_RST_ is asserted by the card’s power on reset logic.
              PB_RST_ and P2_RST# are configured as outputs and are asserted during the power on reset sequence
              (PO_RST_) or during a CompactPCI reset (P1_RST#). The connection between PowerSpan II
              PB_RST_ and PowerQUICC II HRESET _is required for PowerSpan II to load its power-up options
              during Configuration activity generated by the Configuration master.
              The adapter card has two basic configuration scenarios — PowerQUICC II system boots from local
              FLASH or from PCI.
PowerSpan II User Manual                                                                                                                                                               Integrated Device Technology
80A1010_MA001_09                                                                                                                                                                                        www.idt.com


B. Typical Applications                                                                                                  425
                 When the PowerQUICC II system boots from local FLASH there are two possible scenarios which can
                 occur. In the first case, after reset, PowerSpan II retries all accesses to its Primary PCI target. The
                 PowerQUICC II configures the PowerSpan II Primary and Secondary Base Address Registers and then
                 configures all agents on the Secondary bus. The PowerQUICC II then enables accesses to the
                 PowerSpan II Primary PCI target. The CompactPCI Host then completes the configuration of all
                 Primary PCI agents.
                 In the second scenario, an agent on the PCI secondary bus configures all agents there. The PowerSpan
                 II Secondary PCI target retries all accesses until the PowerQUICC II completed configuration of
                 PowerSpan II Secondary Base Address Registers.
                            PowerSpan II supports system boot from PCI with the processor bus arbiter.
B.2.3            CompactPCI Host Card
                 PowerSpan II supports the PowerQUICC II as a Host in a CompactPCI system. The application
                 illustration, Figure 45, shows a directly connected PowerSpan II in a PowerQUICC II system, which is
                 supported by the PowerPC 7xx.
                 PowerSpan II has reset and arbitration functionality for the Primary and Secondary PCI bus segments.
                 PB_RST_ is configured as an input while both P1_RST# and P2_RST# are outputs. A processor
                 power-on reset or hard reset resets both Primary and Secondary PCI bus segments.
                 The card provides clocks for the embedded PowerPCs, PowerSpan II’s PB Interface, all secondary PCI
                 agents, as well as the multiple clocks required for the CompactPCI backplane.
                 PowerSpan II’s bidirectional interrupt pins are used to handle all four CompactPCI interrupts and the
                 Hot Swap system enumeration interrupt. All interrupts are routed to the PowerPC 7xx through
                 PowerSpan II pin INT[5]_.
                 The PowerQUICC II system boots from local FLASH on the card. The PowerQUICC II uses
                 PowerSpan II to configure all PCI agents on the Primary and Secondary PCI buses.
Integrated Device Technology                                                                        PowerSpan II User Manual
www.idt.com                                                                                              80A1010_MA001_09


                                                                                                                                                                                                                                                                                                                           426
PowerSpan II User Manual
                                                                                                                                                                                                                                      Power on      Flash   EEPROM
                               Peripheral Slot 2                                                                        P1_RST_DIR                                                                                                     Reset
                                                                                                                                                                                    HEALTHY
                                         RST#                                                                           P1_RST
                                          CLK                                                                           INT[0]                                                      PO_RST                                                 PORESET
                                       REQ64#                                                                           INT[1]                                                      PB_RST                                                 HRESET
80A1010_MA001_09
                                                                                                                        INT[2]                                                   PB_RST_DIR                                                           MPC8260
                                          REQ#                                                                                                                                                                  A[1]
                                                                                                                        INT[3]                                                                                                             RSTCONF          (master)
                                          GNT#                                                                                                                              PB_RSTCONF
                                          INTA#                                                                                                                                                                                            A[0:6]
                                                                                                                        INT[4]
                                        ENUM#                                                                           P1_INTA
                                                                                                                        P1_REQ64                                                                                                           CLKIN
                               Peripheral Slot 3                                                                        P1_REQ[1]
                                                                                                                        P1_GNT[1]                                                             INT[5]
                                         RST#                                                                           P1_REQ[2]
                                          CLK                                                                           PI_GNT[2]
                                       REQ64#                                                                           PI_REQ[3]                           PowerSpan                                                                      PORESET
                                                                                                                        PI_GNT[3]                                                                                                          HRESET
                                          REQ#                                                                          PI_REQ[4]
                                          GNT#                                                                          PI_GNT[4]                                                                                                                     MPC8260
                                                                                                                                                                                                                               A[0]                          (slave)
                                         ENUM#                                                                                                                                                                                             RSTCONF
                                          INTA#
                                                                                          Compact PCI P1/J1 Connector
                                                                                                                        PI_CLK
                               Peripheral Slot 4                                                                                                                                       PB_CLK
                                                                                                                                                                                                                                           CLKIN
                                           RST#
                                            CLK
                                          REQ#
                                          GNT#
                                          INTA#
                                                                                                                                                                                                                                           HRESET
                               Peripheral Slot 5                                                                                                                        P2_REQ[2]
                                                                                                                                                                                                                                                      MPC740
                                           RST#                                                                                        P2_RST   P2_REQ[1]                                      P2_CLK                                      INT
                                            CLK
                                                                                                                          P2_RST_DIR                        P2_GNT[1]
                                                                                                                                                                        P2_GNT[2]   P2_INTA
                                           REQ#                                                                                                                                                                                            SYSCLK
                                           GNT#
                                                                                                                                                                                                                                                                       Figure 45: PowerSpan II in CompactPCI System Slot
                                          INTA#
                                                                                  INTA#
                                                                                  INTB#
                                                   Compact PCI Peripheral Slots   INTC#                                                RST#                                                     RST#
                                                                                  INTD#                                                 CLK                                                      CLK
                                                                                                                                       REQ#                                                     REQ#               66MHZ
                                                                                                                                       GNT#                              INTA#                  GNT#    INTA#
                                                                                                                                                                                                                       66MHZ
                                                                                                                                                                                                                           CLOCKGENERATOR and PLL
                                                                                                                                                       Secondary PCI Agents
                                                                                                                                                                                                                   33MHZ
                                                                                                                                                                                                                   33MHZ
Integrated Device Technology
                 www.idt.com
                                                                                                                                                                                                                                                                                                                           B. Typical Applications


B. Typical Applications                                                                                          427
B.3              WinPath and PowerSpan II Applications
                 Detailed descriptions of typical applications, design information, signal
                 connection, and register settings involving the Wintegra WinPath processor and PowerSpan II are
                 available in the Interfacing the Wintegra WinPath with the IDT PowerSpan II Application Note.
Integrated Device Technology                                                                 PowerSpan II User Manual
www.idt.com                                                                                       80A1010_MA001_09


428                             B. Typical Applications
PowerSpan II User Manual Integrated Device Technology
80A1010_MA001_09                          www.idt.com


                                                                                                                           429
Glossary
ATPG                       Automatic Test Pattern Generation.
Address Retry Window       Refers to the clock following the assertion of AACK_, which is the latest a snooping master
                           can request for an address tenure re-run.
BAR                        Base Address Register.
BD                         Buffer Descriptor
                           Each serial port in the PowerQUICC II uses BDs to indicate to the SDMA channel the
                           location of packet data in system memory.
Big-endian                 A byte ordering method in memory where the address of a word corresponds to the most
                           significant byte.
BIST                       Built-in Self Test.
CompactPCI                 CompactPCI is an adaptation of the PCI Specification for Industrial and/or embedded
                           applications requiring a more robust mechanical form factor than desktop PCI.
Cycle                      Cycle refers to a single data beat; a transaction is composed of one or more cycles.
DDM                        Device Driver Module. A module that abstracts the service of an I/O device and registers it
                           as an I2O Device.
Device                     An I/O object that refers to an I/O facility or service. Adapters are the objects of hardware
                           configuration, while logical devices are the objects of software configuration.
DMA                        Direct Memory Access
                           A process for transferring data from main memory to a device without passing it through the
                           Host processor.
DRAM                       Dynamic Random Access Memory.
Dual PCI PowerSpan II      PowerSpan II variant     with dual PCI interfaces.
FLASH                      Writable non-volatile memory, often used to store code in embedded systems.
Host Node                  A node composed of one or more application processors and their associated resources. Host
                           nodes execute a single homogeneous operating system and are dedicated to processing
                           applications. The host node is responsible for configuring and initializing the IOP into the
                           system.
Integrated Device Technology                                                                           PowerSpan II User Manual
www.idt.com                                                                                                   80A1010_MA001_09


430                                                                                                                      Glossary
Host Operating System    The control program executing on the host. This may be the BIOS code, the host bootstrap
                         code, or the final operating system for application programs. Also called the host or OS.
Hot Swap                 Refers to the orderly insertion and extraction of CompactPCI boards without adversely
                         affecting system operation.
I2C                      Inter-IC Bus
I2O                      Intelligent I/O
Inbound Queue            A message queue of a particular I/O platform that receives messages from any sender (host
                         or another IOP).
IOP                      I/O platform
                         A platform consisting of processor, memory, I/O adapters and I/O devices. They are managed
                         independently from other processors within the system, solely for processing I/O
                         transactions.
Little-endian            A byte ordering method in memory where the address of a word corresponds to the least
                         significant byte
Master                   Master (initiator) is the owner of the PCI bus. It is used for both the processor (60x) bus and
                         the PCI bus.
MF                       Message Frame
MFA                      Message Frame Address
Outbound Queue           A message queue for a specific I/O platform for posting messages to the local host, in lieu of
                         the host’s Inbound Queue.
PowerPC 740              Embedded PowerPC processor.
PowerPC 750              Embedded PowerPC processor.
PowerPC 7400             Embedded PowerPC processor.
PowerQUICC II            Motorola Integrated Communications Controller with 603ev PowerPC core and external bus
                         (also referred to as the MPC8260)
Prefetchable             A range of Memory space is prefetchable if there are no side effects on reads.
Peripheral Slot          Slots on a CompactPCI bus segment that may contain simple boards, intelligent slaves, or
                         PCI bus masters.
PowerSpan II User Manual                                                                           Integrated Device Technology
80A1010_MA001_09                                                                                                     www.idt.com


Glossary                                                                                                                   431
PMC                        PCI Mezzanine Card
                           A mechanical format for adding PCI based mezzanine cards to a VMEbus card.
Primary PCI Interface      Adds extra functionality to the PCI Interface that is designated as the Primary PCI
                           Interface.The features are associated with the Primary PCI Interface include: CompactPCI
                           Hot Swap Support, Vital Product Data support and I2O Shell Interface.
SDMA                       Serial DMA
                           Used to support the movement of serial data to/from the serial ports of the PowerQUICC II.
Secondary PCI Interface    In the Dual PCI PowerSpan II, this interface is the interface that is not designated as the
                           Primary PCI Interface.
Single PCI PowerSpan II    PowerSpan II variant with      a single PCI interface.
Slave                      Slave (target) is the device which is accessed by the bus master. It is used to refer to the
                           address accessed by the master on the processor (60x) bus.
Strong ordering            A memory access model that requires exclusive access to an address before making an
                           update, to prevent another device from using stale data.
System Slot                The slot on a CompactPCI bus segment that provides arbitration, clock distribution, and reset
                           functions for all boards on the segment
Target                     Target (slave) is the device which is accessed by the bus master. It is used to refer to the
                           address accessed by the master on the PCI bus.
Target image               Target image is a memory range which is mapped between the PCI bus and the processor
                           (60x) bus.
Weak ordering              A memory access model that allows bus operations to be reordered dynamically. This
                           improves overall performance and reduces the effect of memory latency on instruction
                           throughput.
Window of Opportunity      Refers to the clock following the assertion of ARTRY_. The retrying master has to request
                           the bus on this clock to ensure that it is the next bus owner. This enables it to perform the
                           transactions required to maintain cache coherency.
WinPath                    Wintegra Processor
Integrated Device Technology                                                                           PowerSpan II User Manual
www.idt.com                                                                                                   80A1010_MA001_09


432                                          Glossary
PowerSpan II User Manual Integrated Device Technology
80A1010_MA001_09                          www.idt.com


                                                                                          433
                                           PB 100, 142
Index                                      PCI 141, 142
                                      Bus Request
Numerics                                   PCI bus 197, 200
42361
     H1
                                      C
           Chapter 14                 C/BE#[3:0] 196, 199
                                      Cache Coherency 101
                AC Timing 395
                                      CHAIN 116
                                      Chip Select 197, 199
A                                     Clean Block 87
AD[31:0] 196, 199                     CLINE[1:0] 51
Address Bus Arbitration               Clocks
     PB arbiter 142                        PCI 32
Address Only Cycles 143               Command Encoding
Address Parity                             PCI master 47
     PB master 102                         PCI target 38
     PB slave 91                      Command Packet Contents 121
     PCI target 41                    CompactPCI Hot Swap
Address Phase                              Primary PCI 32
     PB master 100                    Concurrent Reads 27, 42
     PB slave 85                      Configuration Cycle Generation
     PCI master 47                         PCI-to-PCI 246
     PCI target 37                         PowerPC-to-PCI 247
Address Pipelining                    Configuration Read 48
     PB master 101                    Configuration Slave Approach 175
Address Retry Window                  Configuration Slave Mode 175
     address bus tenure 89            Configuration Write 48
     defined 83, 429
     multi-processor environment 100  D
     negating address bus request 101
                                      D_PE 44, 51
     PB slave terminations 99
                                      DACT 116
Address Tenure
                                      Data Alignment
     PB Slave 89
                                           PB master 106
Address Translation
                                           PB slave 92
     PB master 102
                                      Data Bus Arbitration and Tenure
     PB slave 89
                                           PB master 103
     PCI master 49
                                           PB slave 92
     PCI target 40
                                      Data Parity
Arbiters
                                           PB master 110
     PCI 137
                                           PB slave 97
     system boot 143
                                           PCI master 51
Arbitration 137
                                           PCI target 44
     PB master 100
                                      Data Phase
     PCI master 47
                                           PB master 103
                                           PB Slave 92
B                                          PCI master 50
BM 46                                 DEST 42
BM_PARK[2:0] 141                      DEVSEL# 196, 199
Bus Errors                            Direct Mode DMA
     interrupts 146                        initializing 118
     PB master 111                         terminating 120
     PB slave 98                           transfer acknowledgment 120
     PCI master 52                    Discard Timer 97
     PCI target 44                    DMA
Bus Parking
Integrated Device Technology                                          PowerSpan II User Manual
www.idt.com                                                               80A1010_MA001_09


434
     command packet addressing 115             PCLK 197, 200
     command packet contents 121               QCLK
     direct mode 118                                QUICC 193
     error handling 124, 166                        QUICC IDMA fast termination 193
     interrupts 124                       Functional Overview 19
     linked-list mode 120
     overview 26                          G
     register description 114             GNT# 197, 199
     source and destination addresses 114 GO 116
     transfer control 115
DMA Controllers 113                       H
document conventions                      HALT 116
     numeric conventions 16               HALT_EN 117
     symbols 16                           HALT_REQ 116
DONE 117                                  Hot Swap
DONE_EN 117                                    card insertion 54
Dual Address Cycle 48                          LED 53
E                                         I
EEPROM 127                                I/O Read 48
     overview 27                          I/O Write 48
     power-up 128                         I2C / EEPROM Interface 127
     SCL signal 202                       I2C_SCL 127
     SDA signal 202                       I2O
     vital product data 60, 135                base address register 62
eieio 88                                       inbound messages 68
Electrical Characteristics 381, 417            IOP functionality 63
END 179                                        messaging interface 64
Endian Mapping 177                             outbound messages 69
     big endian 183                            outbound option 73
     conventions 177                           pull capability 70
     little endian 185                    I2O Shell Interface
     munging/unmunging 181                     Primary PCI 32
     PowerPC little endian 179, 187       IACK Cycle Generation
     PowerPC to PCI 183                        PCI-to-PCI 246
     register accesses 179                     PowerPC-to-PCI 247
ENID 201                                  icbi 88
Error Handling 157                        IDSEL 197, 199
     DMA 124, 166                         INT# 197, 199
     PB Interface 158                     Interrupt Acknowledge 48
     PCI interface 162                    Interrupts 145
Error Logging and Interrupts                   DMA 124
     PB master 111                             enabling 150
     PB slave 99                               mapping 152
     PCI master 52                             normal operations 145
     PCI target 45                             pins 153
Even Parity                                    register description 147
     PB master 103                             sources 145
EXTCYC 111                                     status 148
Extended Cycles 104                            transfer exceptions 146
                                          IRDY# 197, 199
F
Flush Block 87                            K
FRAME# 197, 199                           Kill Block 87
Frequency
PowerSpan II User Manual                                                Integrated Device Technology
80A1010_MA001_09                                                                         www.idt.com


                                                                                        435
L                                      defined 83
                                       overview 26
LAST 121
                                       slave interface 84
Linked-List Mode DMA
                                       terms 83
     initializing 122
                                       window of opportunity 83, 431
     terminating 124
                                  PB Master
LOO 53
                                       address bus arbitration and tenure 100
lwarx 88
                                       address parity 102
                                       address phase 100
M                                      address pipelining 101
Master Interface                       address translation 102
     PCI 46                            cache coherency 101
Master-Abort 52                        data alignment 106
MAX_RETRY 52, 111                      data bus arbitration and tenure 103
MDP_D 51                               data parity 110
mechanical information 387             data phase 103
Memory Read 48                         terminations 111
Memory Read Line 48                    transaction length 104
Memory Read Multiple 48                transaction mapping 102
Memory Write 48                        window of opportunity 101
Memory Write and Invalidate 48    PB Slave
MODE 41                                address parity 91
MRA 43                                 address tenure 89
Munging/Unmunging 181                  data alignment 92
                                       data parity 97
N                                      data phase 92
NCP[31:5] 121                          discard timer 97
Non-transparent PCI-to-PCI 24          errors 99
                                       terminations 98
O                                      transaction length 92
Odd Parity                             writes 97
     PB master 103                PB_ERR 116
     PB slave 98                  PB_ERR_EN 117
OFF 116                           PCI Arbiters
ordering information 415               arbitration levels 138
                                       bus parking 141
P                                      disabling 137
P1_ERR 116                             enabling 137
P1_ERR_EN 117                          overview 137
P1_R64_EN 33                      PCI Interface 31
P2_ERR 116                             bus parking 141, 142
P2_ERR_EN 117                          clock frequencies 32
packaging information 387              data width 32
PAR 197, 199                           errors 162
Parity Monitoring and Generation       interface descriptions 34
     PCI Master 51                     overview 24
PARK 141                               target interface 37
PB Arbiters                       PCI Master
     address bus arbitration 142       address phase 47
     address only cycles 143           address translation 49
     data bus arbitration 142          arbitration 47
PB Interface                           command encoding 47
     address phase 85                  data phase 50
     address retry window 83, 429      error logging and interrupts 52
     bus errors 158                    parity monitoring and generation 51
                                       termination phase 52
Integrated Device Technology                                        PowerSpan II User Manual
www.idt.com                                                               80A1010_MA001_09


436
PCI Target                                    DMA x General Control and Status Register
    address parity 41                              CHAIN 116
    address phase 37                               DACK 116
    address translation 40                         DONE 117
    command encoding 38                            DONE_EN 117
    data transfer 41                               GO 116
    transaction code mapping 40                    HALT 116
PCLK 197, 200                                      HALT_EN 117
PERESP 41, 51                                      HALT_REQ 116
PERR# 197, 200                                     OFF 116
PowerPC                                            P1_ERR 116
    PB defined 83                                  P1_ERR_EN 117
Power-up Options                                   P2_ERR 116
    configuration slave approach 175               P2_ERR_EN 117
    PWRUP_P1_ARB_EN 171                            PB_ERR 116
    PWRUP_P1_R64_EN 32                             PB_ERR_EN 117
    PWRUP_P2_ARB_EN 171                            STOP 116
    PWRUP_PB_ARB_EN 171                            STOP_EN 117
    PWRUP_Px_ARB_EN 140                            STOP_REQ 116
Primary PCI                                   DMA x Source Address Register 115
    defined 31                                Interrupt Status Register 0 148, 150
PRKEEP 44, 96                                 Interrupt Status Register 1 148, 150
Processor Bus Interface 83                    Miscellaneous Control and Status Register
Px_PB_ERR_EN 51                                    VPD_EN 60
                                              PCI 1 Compact PCI Hot Swap Control and Status Register
R                                                  LOO 53
RD_AMT[2:0] 43, 96                            PCI 1 Control and Status Register
Read Atomic 88                                     BM 46
Read with intent to modify 88                      D_PE 44, 51
Read with intent to modify atomic 88               MDP_D 51
Read with no intent to cache 88                    PERESP 41, 44, 51
Register Accesses                                  R_MA 52
    endian mapping 179                             R_TA 52
Register Map 76                                    S_TA 45
Registers                                          SERR_EN 41
    DMA x Attributes Register 117             PCI 1 Miscellaneous 0 Register
    DMA x Command Packet Pointer Register 115      CLINE[1:0] 51
          LAST 121                            PCI 1 Miscellaneous Control and Status Register
          NCP[31:5] 121                            MAX_RETRY 52
    DMA x Destination Address Register 115    PCI 1 Target Image x Base Address Register
                                                   BAR_EN 39
                                                   BS[3:0] 39
                                                   CI_ 39
                                                   DEST 39
                                                   END[1:0] 39
                                                   GBL_ 39
                                                   IMG_EN 38
                                                   MODE 39
                                                   MRA 40
                                                   PRKEEP 39
                                                   RD_AMT[2:0] 40
                                                   RTT[4:0] 39
                                                   TA_EN 38
                                                   WTT[4:0] 39
PowerSpan II User Manual                                               Integrated Device Technology
80A1010_MA001_09                                                                        www.idt.com


                                                                                                           437
     PCI 1 Target Image x Control Register                   SERR_EN 41
          DEST 42                                            SERR# 198, 200
          MRA 43                                             Signal Descriptions 191
          PRKEEP 44                                          Signals
          RD_AMT[2:0] 43                                         AACK 83, 429
          TA_EN 49                                               AD[31:0] 51
     PCI 1 Vital Product Data Capability Register 60             ARTRY 83, 101, 431
     PCI 1 Vital Product Data Data Register 60                   description 191
     PCI x Bus Arbiter Control Register                          ENUM 53
          BM_PARK[2:0] 141                                       HEALTHY 53, 167
          Mx_PRI 140                                             INT[5:0] 153
          PARK 141                                               interrupts 153
     PCI x Target Image x Control Register                       LED 53
          MODE 41                                                miscellaneous 201
          RTT[4:0] 102                                           P1_64EN 33, 53
          WTT[4:0] 102                                           P1_INTA 153
     PCI x to PCI y Configuration Cycle Data Register 246        P1_REQ64 32
     PCI x to PCI y Configuration Cycle Information Register     P1_RST 33, 167
               246                                               P1_RST_DIR 168
     PCI x to PCI y Interrupt Acknowledge Cycle Generation       P2_INTA 153
               Register 246                                      P2_RST 167
     PCI-1 Control and Status Register                           P2_RST_DIR 168
          DEV66 32                                               PB_A[] 85
     Processor Bus Miscellaneous Control and Status Register     PB_AACK 87, 89, 100
          EXTCYC 111                                             PB_ABB 100
          MAX_RETRY 111                                          PB_ARTRY 89, 98, 100, 103, 111
     Processor Bus PCI Configuration Cycle Information           PB_BG 101
               Register 247                                      PB_CI 86, 101, 117
     Processor Bus Register Image Base Address Register          PB_DBB 103
          END 179                                                PB_DP[0:7] 98, 110
     Processor Bus Slave Image x Control Register                PB_DVAL 98, 111
          BS[4:0] 86                                             PB_GBL 86, 101, 117
          DEST 86                                                PB_RST 167
          END[1:0] 86                                            PB_RST_DIR 168
          IMG_EN 86                                              PB_TA 98, 111
          MODE 86                                                PB_TEA 111
          PRKEEP 86, 96                                          PB_TS 89, 103
          RD_AMT[2:0] 86, 96                                     PB_TT[] 85
          TA_EN 86                                               PCI-1 196
     Reset Control and Status Register                           PCI-2 199
          P1_R64_EN 33                                           PO_RST 167
REQ# 197, 200                                                    PowerPC (PB) 192
Reset                                                            Px_AD[31:0] 44
     from PCI bus 198, 200                                       Px_C⁄BE[3:0] 44, 51
     timing parameters 398, 399, 404, 405                        Px_DEVSEL 52
Resets                                                           Px_FRAME 52
     direction control 167                                       Px_IRDY 52
     generation 169                                              Px_M66EN 32
     pins 167                                                    Px_PAR 44, 51
RST# 198, 200                                                    Px_PERR 51
RTT[4:0] 102                                                     Px_TRDY 52
                                                                 test 203
S                                                            SIZ[1:0] 195
SCL 202                                                      Special Cycle 48
SDA 202                                                      STOP 116
                                                             STOP_EN 117
Integrated Device Technology                                                           PowerSpan II User Manual
www.idt.com                                                                                 80A1010_MA001_09


438
STOP_REQ 116
STOP# 196, 197, 198, 200
Sync Block 87
System Boot 143
T
Target-Abort 52
Target-Disconnect 41, 52
Target-Retry 52
Termination Phase
      PB master 111
      PB slave 98
      PCI master 52
      PCI target 44
Test Signals 203
tlb invalidate 88
tlb sync 88
Transaction Length
      PB master 104
      PB slave 92
Transaction Mapping
      PB master 102
      PCI master 48
      PCI target 40
TRDY# 198, 200, 203, 204
Typical Applications 421
V
Vital Product Data
      defined 60
      EEPROM 60
      Primary PCI 32
      reading 60
      writing 61
VPD_EN 60
W
Window of Opportunity 101
      defined 83, 431
Write with Flush 41
Write with flush 88
Write with flush atomic 88
Write with kill 88
WTT[4:0] 102
PowerSpan II User Manual   Integrated Device Technology
80A1010_MA001_09                            www.idt.com


                                                         CORPORATE HEADQUARTERS                                               for SALES:                                                         for Tech Support:
                                                         6024 Silver Creek Valley Road                                        800-345-7015 or 408-284-8200                                       email: EHBhelp@idt.com
                                                         San Jose, CA 95138                                                   fax: 408-284-2775                                                  phone: 408-360-1538
                                                                                                                              www.idt.com                                                        Document: 80A1010_MA001_09
DISCLAIMER Integrated Device Technology, Inc. (IDT) and its subsidiaries reserve the right to modify the products and/or specifications described herein at any time and at IDT’s sole discretion. All information in this document, including descriptions of
product features and performance, is subject to change without notice. Performance specifications and the operating parameters of the described products are determined in the independent state and are not guaranteed to perform the same way when
installed in customer products. The information contained herein is provided without representation or warranty of any kind, whether express or implied, including, but not limited to, the suitability of IDT’s products for any particular purpose, an implied
warranty of merchantability, or non-infringement of the intellectual property rights of others. This document is presented only as a guide and does not convey any license under intellectual property rights of IDT or any third parties.
IDT’s products are not intended for use in life support systems or similar devices where the failure or malfunction of an IDT product can be reasonably expected to significantly affect the health or safety of users. Anyone using an IDT product in such a
manner does so at their own risk, absent an express, written agreement by IDT.
Integrated Device Technology, IDT and the IDT logo are registered trademarks of IDT. Other trademarks and service marks used herein, including protected names, logos and designs, are the property of IDT or their respective third party owners.
Copyright 2009. All rights reserved.
                                                                                                                                                                                                                                   November 2009
  2009 Integrated Device Technology, Inc                                      *Notice: The information in this document is subject to change without notice


 IMPORTANT NOTICE AND DISCLAIMER
 RENESAS ELECTRONICS CORPORATION AND ITS SUBSIDIARIES (“RENESAS”) PROVIDES TECHNICAL
 SPECIFICATIONS AND RELIABILITY DATA (INCLUDING DATASHEETS), DESIGN RESOURCES (INCLUDING
 REFERENCE DESIGNS), APPLICATION OR OTHER DESIGN ADVICE, WEB TOOLS, SAFETY INFORMATION, AND
 OTHER RESOURCES “AS IS” AND WITH ALL FAULTS, AND DISCLAIMS ALL WARRANTIES, EXPRESS OR IMPLIED,
 INCLUDING, WITHOUT LIMITATION, ANY IMPLIED WARRANTIES OF MERCHANTABILITY, FITNESS FOR A
 PARTICULAR PURPOSE, OR NON-INFRINGEMENT OF THIRD PARTY INTELLECTUAL PROPERTY RIGHTS.
 These resources are intended for developers skilled in the art designing with Renesas products. You are solely responsible
 for (1) selecting the appropriate products for your application, (2) designing, validating, and testing your application, and (3)
 ensuring your application meets applicable standards, and any other safety, security, or other requirements. These
 resources are subject to change without notice. Renesas grants you permission to use these resources only for
 development of an application that uses Renesas products. Other reproduction or use of these resources is strictly
 prohibited. No license is granted to any other Renesas intellectual property or to any third party intellectual property.
 Renesas disclaims responsibility for, and you will fully indemnify Renesas and its representatives against, any claims,
 damages, costs, losses, or liabilities arising out of your use of these resources. Renesas' products are provided only subject
 to Renesas' Terms and Conditions of Sale or other applicable terms agreed to in writing. No use of any Renesas resources
 expands or otherwise alters any applicable warranties or warranty disclaimers for these products.
                                                                                                               (Rev.1.0 Mar 2020)
Corporate Headquarters                                                  Contact Information
TOYOSU FORESIA, 3-2-24 Toyosu,                                          For further information on a product, technology, the most
Koto-ku, Tokyo 135-0061, Japan                                          up-to-date version of a document, or your nearest sales
www.renesas.com                                                         office, please visit:
                                                                        www.renesas.com/contact/
Trademarks
Renesas and the Renesas logo are trademarks of Renesas
Electronics Corporation. All trademarks and registered
trademarks are the property of their respective owners.
                                                                      © 2020 Renesas Electronics Corporation. All rights reserved.


Mouser Electronics
Authorized Distributor
Click to View Pricing, Inventory, Delivery & Lifecycle Information:
Renesas Electronics:
 CA91L8260B-100CE CA91L8200B-100CE CA91L8200B-100CEY CA91L8260B-100CEV
