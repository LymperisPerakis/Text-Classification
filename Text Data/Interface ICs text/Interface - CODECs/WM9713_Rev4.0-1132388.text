                                                                                                                                                                                                                          WM9713L
                                     AC’97 Audio and Touchpanel Codec
DESCRIPTION                                                                                                                                                     FEATURES
The WM9713L is a highly integrated input/output device                                                                                                           AC’97 Rev 2.2 compatible stereo CODEC
designed for mobile computing and communications.                                                                                                                  - DAC SNR 94dB, THD –85dB
                                                                                                                                                                   - ADC SNR 87dB, THD –86dB
The chip is architected for dual CODEC operation, supporting                                                                                                       - Variable Rate Audio, supports all WinCE sample rates
hi-fi stereo CODEC functions via the AC link interface, and                                                                                                        - Tone Control, Bass Boost and 3D Enhancement
additionally supporting voice CODEC functions via a PCM type                                                                                                     On-chip 45mW headphone driver
Synchronous Serial Port (SSP). A third, auxiliary DAC is                                                                                                         On-chip 400mW mono or stereo speaker drivers
provided which may be used to support generation of                                                                                                              Stereo, mono or differential microphone input
supervisory tones, or ring-tones at different sample rates to the                                                                                                  - Automatic Level Control (ALC)
main CODEC.                                                                                                                                                        - Mic insert and mic button press detection
The device can connect directly to a 4-wire or 5-wire touch-                                                                                                     Auxiliary mono DAC (ring tone or DC level generation)
panel, mono or stereo microphones, stereo headphones and a                                                                                                       Seamless interface to wireless chipset
stereo speaker, reducing total component count in the system.                                                                                                    Resistive touchpanel interface
Cap-less connections to the headphones, speakers, and                                                                                                              - Supports 4-wire and 5-wire panels
earpiece may be used, saving cost and board area. Additionally,                                                                                                    - 12-bit resolution, INL 2 LSBs (<0.5 pixels)
multiple analogue input and output pins are provided for                                                                                                           - X, Y and touch-pressure (Z) measurement
seamless integration with analogue connected wireless                                                                                                              - Pen-down detection supported in Sleep Mode
communication devices.                                                                                                                                           Additional PCM/I2S interface to support voice CODEC
                                                                                                                                                                 PLL derived audio clocks.
All device functions are accessed and controlled through a                                                                                                       Supports input clock ranging from 2.048MHz to 78.6MHz
single AC-Link interface compliant with the AC’97 standard. The                                                                                                  1.8V to 3.6V supplies (digital down to 1.62V, speaker up to
24.576MHz master clock can be input directly or generated                                                                                                          4.2V)
internally from a 13MHz (or other frequency) clock by an on-chip                                                                                                 7x7mm 48-lead QFN package
PLL. The PLL supports a wide range of input clock from
2.048MHz to 78.6MHz.                                                                                                                                            APPLICATIONS
The WM9713L operates at supply voltages from 1.8V to 3.6V.                                                                                                       Smartphones
Each section of the chip can be powered down under software                                                                                                      Personal Digital Assistants (PDA)
control to save power. The device is available in a small                                                                                                        Handheld and Tablet Computers
leadless 7x7mm QFN package, ideal for use in hand-held
portable systems.
BLOCK DIAGRAM
                        AGND2       AGND       CAP2 AVDD              VREF                DGND1              DGND2                               DCVDD                DBVDD           SPKGND   SPKVDD    HPGND        HPVDD
                                                                                                                                                                                                 AVDD
                                                                                                                                                                                                            POR               rb
                                                                         VREF                                                                                WM9713L                            DCVDD
                                             50K      50K                                                                                                                                                 RESETB
             MICBIAS                                                                                                                                                                                       (pin 11)
                 MIC1
                                    DIFFERENTIAL                                                              ADC                                                                       DAC                              MONO
               MICCM                                                  INPUT PGAs
                                      STEREO or                                                                L                                                          TONE /         L                                          Ear Speaker                  Hands-free
     MIC2A/COMP1/AUX1                MONO MICS                                                                                                       ALC /                 BASS                                                     32R                          32R
     MIC2B/COMP2/AUX2                                                  RECORD                                                                                                                                                 HPL
                                                                                                                                                     NOISE                BOOST                                                                       HP
                                                                       SELECT
                LINEL                                                                                                                                GATE                                                                                           16/32R
                LINER                                                                                         ADC                                                            3D         DAC        HEADPHONE
                                                                       RECORD                                  R                                                                         R
              MONOIN                                                   VOLUME                                                                                                                        MIXER                    HPR
                                        -
              PCBEEP
                               SPKVDD / 3
                                                                                                                                                                                                    SPEAKER               SPKL
                                                            AUX                                                                                                                        AUX           MIXER
                                                            ADC                                                                                                                        DAC
                                                   ADCSEL                                                                                                                                               MONO
                                                                                                                                                                                                        MIXER             SPKR        Stereo                  Stereo
                           DEAD                                                                                                                                                                                                       Speaker (R)             Speaker (L)
                            BAT                                                                                                                                                                                                       8R                      8R
                          -                                                                                                                                                            VOICE                              OUT3
                          +
                                                                                                         2                                                                             DAC
                          VREF /             TOUCH PANEL                                     PCM/I S                                                             AC'97
                          AUX4                 MATRIX                                      INTERFACE                                           PLL            INTERFACE
                          +
                                                                                                                                                                                                                          OUT4
                          -
                              LOW
                              BAT
                                      X+               Y+   X-   Y-
                                                                              GPIO2/IRQ
                                            WIPER/
                                                                                                       GPIO1/PCMCLK
                                                                                                                      MCLKB/GPIO6/(ADA/MASK)
                                                                      TPGND                                                                                                  BITCLK
                                                                                                                                                     MCLKA
                                              AUX4/
                                             GPIO8/                   TPVDD
                                                                                                                                                                              SYNC
                                                                                              GPIO3/PENDOWN/PCMFS
                                            (SPDIF)
                                                                                                                                                                           SDATAIN
                                                                                             GPIO4/ADA/MASK/PCMDAC
                                                                                                                                                                         SDATAOUT
                                       4-wire or 5-wire                                          GPIO5/SPDIF/PCMADC                                          RESETB/GPIO7/PENDOWN
                                       resistive touchpanel
                                                                                                                                                                                                                                                              Rev 4.0
                                                                                Copyright  Cirrus Logic, Inc., 2008–2016                                                                                                                                    DEC ‘16
      http://www.cirrus.com                                                               (All Rights Reserved)


                                                                                                                 WM9713L
                                              TABLE OF CONTENTS
DESCRIPTION ................................................................................................................ 1
FEATURES ..................................................................................................................... 1
APPLICATIONS.............................................................................................................. 1
BLOCK DIAGRAM ......................................................................................................... 1
TABLE OF CONTENTS .................................................................................................. 2
PIN CONFIGURATION ................................................................................................... 4
ORDERING INFORMATION ........................................................................................... 4
PIN DESCRIPTION ......................................................................................................... 4
ABSOLUTE MAXIMUM RATINGS ................................................................................. 6
RECOMMENDED OPERATING CONDITIONS .............................................................. 6
ELECTRICAL CHARACTERISTICS .............................................................................. 7
  AUDIO OUTPUTS ...................................................................................................................... 7
  AUDIO INPUTS .......................................................................................................................... 8
  AUXILIARY MONO DAC (AUXDAC) .......................................................................................... 8
  PCM VOICE DAC (VXDAC) ....................................................................................................... 8
  TOUCHPANEL AND AUXILIARY ADC ...................................................................................... 9
  COMPARATORS ....................................................................................................................... 9
  REFERENCE VOLTAGES ......................................................................................................... 9
  DIGITAL INTERFACE CHARACTERISTICS ........................................................................... 10
POWER CONSUMPTION ............................................................................................. 10
SIGNAL TIMING REQUIREMENTS ............................................................................. 11
  AC97 INTERFACE TIMING...................................................................................................... 11
  PCM AUDIO INTERFACE TIMING – SLAVE MODE ............................................................... 15
  PCM AUDIO INTERFACE TIMING – MASTER MODE............................................................ 16
DEVICE DESCRIPTION ............................................................................................... 17
  INTRODUCTION ...................................................................................................................... 17
  AUDIO PATHS OVERVIEW ..................................................................................................... 19
  CLOCK GENERATION ............................................................................................................ 20
  CLOCK DIVISION MODES ...................................................................................................... 20
  PLL MODE ............................................................................................................................... 22
  DIGITAL INTERFACES ............................................................................................................ 25
  AC97 INTERFACE ................................................................................................................... 26
  PCM INTERFACE .................................................................................................................... 26
AUDIO ADCS ............................................................................................................... 32
  STEREO ADC .......................................................................................................................... 32
  RECORD SELECTOR.............................................................................................................. 33
  RECORD GAIN ........................................................................................................................ 34
  AUTOMATIC LEVEL CONTROL.............................................................................................. 35
AUDIO DACS ............................................................................................................... 39
  STEREO DAC .......................................................................................................................... 39
  VOICE DAC .............................................................................................................................. 41
  AUXILIARY DAC ...................................................................................................................... 42
VARIABLE RATE AUDIO / SAMPLE RATE CONVERSION ....................................... 44
AUDIO INPUTS............................................................................................................. 45
  LINE INPUT .............................................................................................................................. 45
  MICROPHONE INPUT ............................................................................................................. 45
  MONOIN INPUT ....................................................................................................................... 50
  PCBEEP INPUT ....................................................................................................................... 51
  DIFFERENTIAL MONO INPUT ................................................................................................ 52
2                                                                                                                                   Rev 4.0


                                                                                                             WM9713L
AUDIO MIXERS ............................................................................................................ 53
 MIXER OVERVIEW .................................................................................................................. 53
 HEADPHONE MIXERS ............................................................................................................ 53
 SPEAKER MIXER .................................................................................................................... 53
 MONO MIXER .......................................................................................................................... 54
 MIXER OUTPUT INVERTERS ................................................................................................. 54
ANALOGUE AUDIO OUTPUTS ................................................................................... 55
 HEADPHONE OUTPUTS – HPL AND HPR ............................................................................ 55
 MONO OUTPUT....................................................................................................................... 56
 SPEAKER OUTPUTS – SPKL AND SPKR .............................................................................. 57
 AUXILIARY OUTPUTS – OUT3 AND OUT4 ............................................................................ 58
 THERMAL SENSOR ................................................................................................................ 60
 JACK INSERTION AND AUTO-SWITCHING .......................................................................... 60
DIGITAL AUDIO (S/PDIF) OUTPUT ............................................................................. 64
TOUCHPANEL INTERFACE ........................................................................................ 65
 PRINCIPLE OF OPERATION – FOUR-WIRE TOUCHPANEL ................................................ 66
 PRINCIPAL OF OPERATION – FIVE-WIRE TOUCHPANEL .................................................. 68
 CONTROLLING THE TOUCHPANEL DIGITISER ................................................................... 69
ADDITIONAL FEATURES ............................................................................................ 78
 AUXILIARY ADC INPUTS ........................................................................................................ 78
 BATTERY ALARM AND ANALOGUE COMPARATORS ......................................................... 79
 GPIO AND INTERRUPT CONTROL ........................................................................................ 82
POWER MANAGEMENT .............................................................................................. 86
 INTRODUCTION ...................................................................................................................... 86
 AC97 CONTROL REGISTER................................................................................................... 86
 EXTENDED POWERDOWN REGISTERS .............................................................................. 87
 ADDITIONAL POWER MANAGEMENT ................................................................................... 89
 POWER-ON RESET (POR) ..................................................................................................... 90
REGISTER MAP ........................................................................................................... 91
 REGISTER BITS BY ADDRESS .............................................................................................. 92
APPLICATIONS INFORMATION ............................................................................... 123
 RECOMMENDED EXTERNAL COMPONENTS .................................................................... 123
 LINE OUTPUT ........................................................................................................................ 124
 AC-COUPLED HEADPHONE OUTPUT ................................................................................ 124
 DC-COUPLED (CAPLESS) HEADPHONE OUTPUT ............................................................ 125
 BTL LOUDSPEAKER OUTPUT ............................................................................................. 125
 COMBINED HEADSET / BTL EAR SPEAKER ...................................................................... 126
 COMBINED HEADSET / SINGLE-ENDED EAR SPEAKER .................................................. 126
 JACK INSERT DETECTION .................................................................................................. 127
 HOOKSWITCH DETECTION ................................................................................................. 127
 TYPICAL OUTPUT CONFIGURATIONS ............................................................................... 128
PACKAGE DIMENSIONS ........................................................................................... 131
IMPORTANT NOTICE ................................................................................................ 132
REVISION HISTORY .................................................................................................. 133
Rev 4.0                                                                                                                                 3


                                                                                                                                                                                                                                         WM9713L
PIN CONFIGURATION
                                                                 GPIO4 / ADA / MASK / PCMDAC   GPIO3 / PENDOWN / PCMFS
                                        GPIO5 / SPDIF / PCMADC
                                                                                                                                         GPIO1 / PCMCLK
                                                                                                                           GPIO2 / IRQ                    HPVDD   AGND2             HPGND            SPKVDD
                                                                                                                                                                           HPR              HPL               OUT3
                                        48 47 46                                                                           45 44                          43 42            41 40            39 38             37
                         DBVDD     1                                                                                                                                                                                  36   SPKR
                         MCLKA     2                                                                                                                                                                                  35   SPKL
    MCLKB / GPIO6 / (ADA / MASK)   3                                                                                                                                                                                  34   SPKGND
                         DGND1     4                                                                                                                                                                                  33   OUT4
                     SDATAOUT      5                                                                                                                                                                                  32   CAP2
                         BITCLK    6                                                                                                                                                                                  31   MONO
                                                                                                                                                     WM9713L
                         DGND2     7                                                                                                                                                                                  30   MIC2B / COMP2 / AUX2
                        SDATAIN    8                                                                                                                                                                                  29   MIC2A / COMP1 / AUX1
                         DCVDD     9                                                                                                                                                                                  28   MICBIAS
                          SYNC     10                                                                                                                                                                                 27   VREF
    RESETB / GPIO7 / (PENDOWN)     11                                                                                                                                                                                 26   AGND
 WIPER / AUX4 / GPIO8 / (SPDIF)    12                                                                                                                                                                                 25   AVDD
                                        13 14 15                                                                           16 17                          18 19            20 21            22 23             24
                                                                 X+ / BR                       Y+ / TR                                   Y- / BL                                             MICCM   LINEL    LINER
                                                                                                                                                                  PCBEEP
                                        TPVDD                                                                              X- / TL                                                  MIC1
                                                                                                                                                          TPGND            MONOIN
ORDERING INFORMATION
                           TEMPERATURE                                                                                                                                                            MOISTURE SENSITIVITY                      PEAK SOLDERING
          DEVICE                                                                                                                               PACKAGE
                              RANGE                                                                                                                                                                     LEVEL                                TEMPERATURE
                                                                                                                                         48-lead QFN
WM9713CLGEFL/V               -25 to +85oC                                                                                                                                                                             MSL3                        260oC
                                                                                                                                           (Pb-free)
                                                                                                                              48-lead QFN
WM9713CLGEFL/RV              -25 to +85oC                                                                                                                                                                             MSL3                        260oC
                                                                                                                         (Pb-free, tape and reel)
Note:
Reel quantity = 2,200
PIN DESCRIPTION
    PIN                  NAME                                                                                                        TYPE                                                                                  DESCRIPTION
     1                  DBVDD                                                                                                   Supply                                     Digital I/O Buffer Supply
     2                  MCLKA                                                                                            Digital Input                                     Master Clock A Input
     3      MCLKB / GPIO6 / (ADA / MASK)                                                                                 Digital In/Out                                    Master Clock B Input / GPIO6 / (ADA output / MASK input)
     4                  DGND1                                                                                                   Supply                                     Digital Ground (return path for both DCVDD and DBVDD)
     5                SDATAOUT                                                                                           Digital Input                                     Serial Data Output from Controller / Input to WM9713L
     6                  BITCLK                                                                                    Digital Output                                           Serial Interface Clock Output to Controller
4                                                                                                                                                                                                                                                         Rev 4.0


                                                                                                           WM9713L
   PIN                   NAME                       TYPE                                   DESCRIPTION
    7                   DGND2                      Supply       Digital Ground (return path for both DCVDD and DBVDD)
    8                  SDATAIN                  Digital Output  Serial Data Input to Controller / Output from WM9713L
    9                   DCVDD                      Supply       Digital Core Supply
   10                    SYNC                    Digital Input  Serial Interface Synchronisation Pulse from Controller
   11       RESETB / GPIO7 / (PENDOWN)         Digital In / Out Reset (asynchronous, active Low, resets all registers to their
                                                                default) / GPIO7 / (pen down output)
   12      WIPER / AUX4 / GPIO8 / (S/PDIF) Analogue In / Out    Top Sheet Connection for 5-wire Touchpanels / Auxiliary ADC
                                                                input / GPIO8 / (S/PDIF digital audio output)
   13                   TPVDD                      Supply       Touchpanel Driver Supply
   14                   X+/ BR                 Analogue Input   Touchpanel Connection: X+ (Right) for 4-wire / bottom right for 5-
                                                                wire
   15                    Y+/TR                 Analogue Input   Touchpanel Connection: Y+ (Top) for 4-wire / top right for 5-wire
   16                    X-/TL                 Analogue Input   Touchpanel Connection: X- (Left) for 4-wire / top left for 5-wire
   17                    Y-/BL                 Analogue Input   Touchpanel Connection: Y- (Bottom) for 4-wire / bottom left for 5-
                                                                wire
   18                   TPGND                      Supply       Touchpanel Driver Ground
   19                  PCBEEP                  Analogue Input   Line Input to analogue audio mixers, typically used for beeps
   20                  MONOIN                  Analogue Input   Mono Input (RX)
   21                    MIC1                  Analogue Input   Microphone preamp A input 1
   22                   MICCM                  Analogue Input   Microphone common mode input
   23                    LINEL                 Analogue Input   Left Line Input
   24                   LINER                  Analogue Input   Right Line Input
   25                    AVDD                      Supply       Analogue Supply (audio DACs, ADCs, PGAs, mic amps, mixers)
   26                    AGND                      Supply       Analogue Ground
   27                    VREF                 Analogue Output   Internal Reference Voltage (buffered CAP2)
   28                  MICBIAS                Analogue Output   Bias Voltage for Microphones (buffered CAP2  1.8)
   29           MIC2A / COMP1 / AUX1           Analogue Input   Microphone preamp A input 2 / COMP1 input / Auxiliary ADC input
   30           MIC2B / COMP2 / AUX2           Analogue Input   Microphone preamp B input / COMP2 input / Auxiliary ADC input
   31                   MONO                  Analogue output   Mono output driver (line or headphone)
   32                    CAP2                Analogue In / Out  Internal Reference Voltage (normally AVDD/2, if not overdriven)
   33                    OUT4                 Analogue Output   Auxiliary output driver (speaker, line or headphone)
   34                  SPKGND                      Supply       Speaker ground (feeds output buffers on pins 33, 35, 36 and 37)
   35                    SPKL                 Analogue Output   Left speaker driver (speaker, line or headphone)
   36                    SPKR                 Analogue Output   Right speaker driver (speaker, line or headphone)
   37                    OUT3                 Analogue Output   Auxiliary output driver (speaker, line or headphone)
   38                  SPKVDD                      Supply       Speaker supply (feeds output buffers on pins 33, 35, 36 and 37)
   39                     HPL                 Analogue Output   Headphone left driver (line or headphone)
   40                   HPGND                      Supply       Headphone ground (feeds output buffers on pins 39 and 41)
   41                     HPR                 Analogue Output   Headphone right driver (line or headphone)
   42                   AGND2                      Supply       Analogue ground, chip substrate
   43                   HPVDD                      Supply       Headphone supply (feeds output buffers on pins 39 and 41)
   44              GPIO1 / PCMCLK              Digital In / Out GPIO Pin 1 / PCM interface clock
   45                GPIO2 / IRQ               Digital In / Out GPIO Pin 2 / IRQ (Interrupt Request) output
   46        GPIO3 / PENDOWN / PCMFS           Digital In / Out GPIO Pin 3 / pen down output or PCM frame signal
   47       GPIO4 / ADA / MASK / PCMDAC        Digital In / Out GPIO Pin 4 / ADA (ADC data available) output or Mask input /
                                                                PCM input (DAC) data
   48          GPIO5 / S/PDIF / PCMADC         Digital In / Out GPIO Pin 5 / S/PDIF digital audio output / PCM output (ADC) data
   49               GND_PADDLE                                  Die Paddle (Note 1)
Note:
1.    It is recommended that the GND_PADDLE is connected to analogue ground. Refer to “Recommended External Components”
      and “Package Dimensions” for further information.
Rev 4.0                                                                                                                            5


                                                                                                           WM9713L
ABSOLUTE MAXIMUM RATINGS
Absolute Maximum Ratings are stress ratings only. Permanent damage to the device may be caused by continuously operating at
or beyond these limits. Device functional operating limits and guaranteed performance specifications are given under Electrical
Characteristics at the test conditions specified.
                    ESD Sensitive Device. This device is manufactured on a CMOS process. It is therefore generically susceptible to
                    damage from excessive static voltages. Proper ESD precautions must be taken during handling and storage of
                    this device.
Cirrus Logic tests its package types according to IPC/JEDEC J-STD-020B for Moisture Sensitivity to determine acceptable storage
conditions prior to surface mount assembly. These levels are:
MSL1 = unlimited floor life at <30C / 85% Relative Humidity. Not normally stored in moisture barrier bag.
MSL2 = out of bag storage for 1 year at <30C / 60% Relative Humidity. Supplied in moisture barrier bag.
MSL3 = out of bag storage for 168 hours at <30C / 60% Relative Humidity. Supplied in moisture barrier bag.
The Moisture Sensitivity Level for each package type is specified in Ordering Information.
                                 CONDITION                                              MIN                       MAX
Digital supply voltages (DCVDD, DBVDD)                                                 -0.3V                    +3.63V
Analogue supply voltages (AVDD, HPVDD, TPVDD)                                          -0.3V                    +3.63V
Speaker supply voltage (SPKVDD)                                                        -0.3V                     +4.2V
Touchpanel supply voltage (TPVDD)                                                                            AVDD +0.3V
Voltage range digital inputs                                                       DGND -0.3V               DBVDD +0.3V
Voltage range analogue inputs                                                      AGND -0.3V                AVDD +0.3V
Voltage range touchpanel Inputs X+, X-, Y+ and Y-                                                           TPVDD +0.3V
Voltage range touchpanel Inputs X+, X-, Y+ and Y-                                                            AVDD +0.3V
Operating temperature range, TA                                                       -25oC                      +85oC
RECOMMENDED OPERATING CONDITIONS
                                                                        TEST
PARAMETER                                         SYMBOL                                  MIN         TYP     MAX         UNIT
                                                                    CONDITIONS
Digital input/output buffer supply range          DBVDD                                  1.71         3.3      3.6         V
Digital core supply range                         DCVDD                                  1.71         1.8      3.6         V
Analogue supply range                         AVDD, HPVDD,                                 1.8        3.3      3.6         V
                                                   TPVDD
Speaker supply range                              SPKVDD                                   1.8        3.3      4.2         V
Digital ground                                DGND1, DGND2                                             0                   V
Analogue ground                               AGND, HPGND,                                             0                   V
                                             SPKGND, TPGND
Difference AGND to DGND                                                Note 1             -0.3         0      +0.3         V
Notes:
1. AGND is normally the same as DGND1/DGND2
2. DCVDD <= DBVDD and DCVDD <= AVDD
3. DCVDD should be >=2V when using the PLL
6                                                                                                                        Rev 4.0


                                                                                                             WM9713L
ELECTRICAL CHARACTERISTICS
AUDIO OUTPUTS
   Test Conditions
   DBVDD=3.3V, DCVDD = 3.3V, AVDD=HPVDD=SPKVDD =3.3V, TA = +25oC, 1kHz signal, fs = 48kHz, 24-bit audio data unless
   otherwise stated.
            PARAMETER                 SYMBOL          TEST CONDITIONS              MIN            TYP          MAX         UNIT
   DAC to Line-Out (HPL/R, SPKL/R or MONO with 10k / 50pF load)
   Full-scale output (0dBFS)                      AVDD = 3.3V, PGA gains                            1                      V rms
                                                           set to 0dB
   Signal to Noise Ratio                SNR                                         85             94                       dB
   (A-weighted)
   Total Harmonic Distortion             THD              -3dB output                             -85           -74         dB
   Power Supply Rejection               PSRR        100mV, 20Hz to 20kHz                           50                       dB
                                                        signal on AVDD
   Speaker Output (SPKL/SPKR with 8 bridge tied load, INV=1)
   Output Power at 1% THD                 PO               THD = 1%                               400                     mW (rms)
   Abs. max output power               POmax                                                      500                     mW (rms)
   Total Harmonic Distortion             THD              PO = 200mW                              -66                       dB
                                                                                                  0.05                       %
   Signal to Noise Ratio                SNR                                                        90                       dB
   (A-weighted)
   Stereo Speaker Output (SPKL/OUT4 and SPKR/OUT3 with 8 bridge tied load, INV=1)
   Output Power at 1% THD                 PO               THD = 1%                               400                     mW (rms)
   Abs. max output power               POmax                                                      500                     mW (rms)
   Total Harmonic Distortion             THD              PO = 200mW                              -66                       dB
                                                                                                  0.05                       %
   Signal to Noise Ratio                SNR                                                        90                       dB
   (A-weighted)
   Headphone Output (HPL/R, OUT3/4 or SPKL/SPKR with 16 or 32 load)
   Output Power per channel               PO                  Output power is very closely correlated with THD; see below.
   Total Harmonic Distortion             THD          PO=10mW, RL=16                             -80                       dB
                                                      PO=10mW, RL=32                             -80
                                                      PO=20mW, RL=16                             -78
                                                      PO=20mW, RL=32                             -79
   Signal to Noise Ratio                SNR                                                        90                       dB
   (A-weighted)
Note:
1.    All THD values are valid for the output power level quoted above – for example, at HPVDD=3.3V and RL=16, THD is –80dB
      when output power is 10mW. Higher output power is possible, but will result in deterioration in THD.
Rev 4.0                                                                                                                            7


                                                                                                   WM9713L
AUDIO INPUTS
  Test Conditions
  DBVDD=3.3V, DCVDD = 3.3V, AVDD = 3.3V, TA = +25oC, 1kHz signal, fs = 48kHz, 24-bit audio data unless otherwise stated.
            PARAMETER              SYMBOL     TEST CONDITIONS             MIN           TYP           MAX           UNIT
  LINEL/R, MIC1/2A/2B, MONOIN and PCBEEP pins
  Full Scale Input Signal Level      VINFS         AVDD = 3.3V                          1.0                        Vrms
  (0dBFS)                                          AVDD = 1.8V                         0.545
                                             differential input mode                    0.5
                                            (MS = 01) AVDD = 3.3V
                                             differential input mode                   0.273
                                            (MS = 01) AVDD = 1.8V
  Input Resistance                    RIN         0dB PGA gain           25.6            32           38.4           k
                                                 12dB PGA gain           10.4            13           15.6
  Input Capacitance                                                                      5                           pF
  Line input to ADC (LINEL, LINER, MONOIN)
  Signal to Noise Ratio             SNR                                   80             87                          dB
  (A-weighted)
  Total Harmonic Distortion          THD           -3dBFS input                         -86           -80            dB
  Power Supply Rejection            PSRR          20Hz to 20kHz                          50                          dB
  Microphone input to ADC (MIC1/2A/2B pins)
  Signal to Noise Ratio             SNR       20dB boost enabled                         80                          dB
  (A-weighted)
  Total Harmonic Distortion          THD      20dB boost enabled                        -80                          dB
AUXILIARY MONO DAC (AUXDAC)
  Test Conditions
  DBVDD=3.3V, DCVDD = 3.3V, AVDD = 3.3V, TA = +25oC, 1kHz signal, fs = 8kHz, 24-bit audio data unless otherwise stated.
            PARAMETER              SYMBOL     TEST CONDITIONS             MIN           TYP           MAX           UNIT
  Resolution                                                                             12                         bits
  Full scale output voltage                         AVDD=3.3V                            1                         Vrms
  Signal to Noise Ratio             SNR                                   65             71                          dB
  (A-weighted)
  Total Harmonic Distortion          THD            0dBFS input           50             63                          dB
PCM VOICE DAC (VXDAC)
  Test Conditions
  DBVDD=3.3V, DCVDD = 3.3V, AVDD = 3.3V, TA = +25oC, 1kHz signal, fs = 8kHz, 24-bit audio data unless otherwise stated.
            PARAMETER              SYMBOL     TEST CONDITIONS             MIN           TYP           MAX           UNIT
  Resolution                                                                             16                         bits
  Sample rates                                                                           8             16           Ks/s
  Full scale output voltage                         AVDD=3.3V                            1                         Vrms
  Signal to Noise Ratio             SNR                                                  80                          dB
  (A-weighted)
  Total Harmonic Distortion          THD                                                 74                          dB
8                                                                                                                  Rev 4.0


                                                                                                  WM9713L
TOUCHPANEL AND AUXILIARY ADC
 Test Conditions
 DBVDD = 3.3V, DCVDD = 3.3V, AVDD = 3.3V, TA = +25oC, unless otherwise stated.
           PARAMETER                SYMBOL       TEST CONDITIONS         MIN           TYP          MAX           UNIT
 Input Pins X+, X-, Y+, Y-, WIPER/AUX4, COMP1/AUX1, COMP2/AUX2
 Input Voltage                                                         AGND                        AVDD              V
 Input leakage current                         AUX pin not selected as                 <10                          nA
                                                    AUX ADC input
 ADC Resolution                                                                         12                         bits
 Differential Non-Linearity Error  DNL                                                0.25           1          LSB
 Integral Non-Linearity Error      INL                                                                2          LSB
 Offset Error                                                                                         4          LSB
 Gain Error                                                                                           6          LSB
 Power Supply Rejection            PSRR                                                 50                          dB
 Channel-to-channel isolation                                                           80                          dB
 Throughput Rate                                     DEL = 1111                                       48           kHz
                                                  (zero settling time)
 Settling Time (programmable)                    MCLK = 24.576MHz         0                            6           ms
 Switch matrix resistance                                                               20                          
 Programmable Pull-up resistor     RPU              RPU = 000001          1                           63           k
 Pen down detector threshold                                                         VDD/2                           V
 Pressure measurement current      IP                   PIL = 1                        400                         A
                                                        PIL = 0                        200
COMPARATORS
 Test Conditions
 DBVDD = 3.3V, DCVDD = 3.3V, AVDD = 3.3V, TA = +25oC, unless otherwise stated.
           PARAMETER                SYMBOL       TEST CONDITIONS         MIN           TYP          MAX           UNIT
 COMP1/AUX1 and COMP2/AUX2 (pins 29, 30 – when not used as mic inputs)
 Input Voltage                                                         AGND                        AVDD              V
 Input leakage current                         pin not selected as AUX                 <10                          nA
                                                      ADC input
 Comparator Input Offset                                                 -50                         +50           mV
 (COMP1, COMP2 only)
 COMP2 delay (COMP2 only)                        MCLK = 24.576MHz         0                         10.9             s
REFERENCE VOLTAGES
 Test Conditions
 DBVDD=3.3V, DCVDD = 3.3V, AVDD = 3.3V, TA = +25oC, 1kHz signal, fs = 48kHz, 24-bit audio data unless otherwise stated.
           PARAMETER                SYMBOL       TEST CONDITIONS         MIN           TYP          MAX           UNIT
 Audio ADCs, DACs, Mixers
 Reference Input/Output            CAP2 pin                             1.63          1.65          1.66             V
 Buffered Reference Output         VREF pin                             1.64          1.65          1.67             V
 Microphone Bias
 Bias Voltage                        VMICBIAS                           2.92          2.97          3.00             V
 Bias Current Source                  IMICBIAS                                                         3           mA
 Output Noise Voltage                   Vn           1K to 20kHz                        15                       nV/Hz
Rev 4.0                                                                                                                 9


                                                                                                                WM9713L
DIGITAL INTERFACE CHARACTERISTICS
   Test Conditions
   DBVDD = 3.3V, DCVDD = 3.3V, TA = +25oC, unless otherwise stated.
              PARAMETER                   SYMBOL         TEST CONDITIONS             MIN             TYP           MAX          UNIT
   Digital Logic Levels (all digital input or output pins) – CMOS Levels
   Input HIGH level                      VIH                                     DBVDD0.7                                       V
   Input LOW level                       VIL                                                                   DBVDD0.3         V
   Output HIGH level                     VOH            source current = 2mA     DBVDD0.9
   Output LOW level                      VOL             sink current = 2mA                                    DBVDD0.1
   Clock Frequency
   Master clock (MCLKA pin)                                                                        24.576                       MHz
   AC’97 bit clock (BIT_CLK pin)                                                                   12.288                       MHz
   AC’97 sync pulse (SYNC pin)                                                                        48                        kHz
Notes:
1.    All audio and non-audio sample rates and other timing scales proportionately with the master clock.
2.    For signal timing on the AC-Link, please refer to the AC’97 specification (Revision 2.2)
POWER CONSUMPTION
The power consumption of the WM9713L depends on the following factors:
           Supply voltages: Reducing the supply voltages also reduces digital supply currents, and therefore results in significant
            power savings especially in the digital sections of the WM9713L.
           Operating mode: Significant power savings can be achieved by always disabling parts of the WM9713L that are not used
            (e.g. audio ADC, DAC, touchpanel digitiser).
           Sample rates: Running at lower sample rates will reduce power consumption significantly. The figures below are for 48kHz
            (unless otherwise specified), but in many scenarios it is not necessary to run at this frequency, e.g. 8kHz PCM voice call
            scenario uses only 11.4mW (see below).
                                 MODE DESCRIPTION                                           AVDD          DCVDD         DBVDD      Total
                                                                                           Supply          Supply       Supply     Power
                                                                                           Current        Current       Current    (mW)
                                                                                           V / mA          V / mA       V / mA
   Off (lowest possible power)                                                           3.3     0.01    3.3     0    3.3   0.005   0.05
   Clocks stopped. This is the default configuration after power-up.
   LPS (Low Power Standby)                                                               3.3    0.014    3.3     0    3.3   0.005   0.06
   VREF maintained using 1MOhm string
   Touchpanel only (waiting for pen-down)                                                3.3    0.042    3.3     0    3.3   0.005   0.15
   PCM Voice call (fs=8kHz)                                                              2.8     2.37    2.8    1.7   2.8   0.006   11.4
   Record from mono microphone                                                           3.3    3.644    3.3 10.973 3.3     2.974  58.05
   Stereo DAC Playback (AC link to headphone)                                            3.3    3.733    3.3   9.720  3.3   2.789  53.60
   Stereo DAC Playback (AC link to headphone)                                            3.3    4.801    3.3 10.504 3.3     2.814  59.79
   PLL running with 13MHz input to MCLKB
   Maximum Power - everything on                                                         3.3 13.656 3.3 15.472 3.3          2.938 105.82
   Table 1 Supply Current Consumption
   Notes:
   1.    Unless otherwise specified, all figures are at TA = +25C, audio sample rate fs = 48kHz, with zero signal (quiescent), and
         voltage references settled.
   2.    The power dissipated in the headphone, speaker and touchpanel is not included in the above table.
10                                                                                                                             Rev 4.0


                                                                                            WM9713L
SIGNAL TIMING REQUIREMENTS
AC97 INTERFACE TIMING
                 CLOCK SPECIFICATIONS
                                                tCLK_HIGH                   tCLK_LOW
                       BITCLK
                                               tCLK_PERIOD
                                            tSYNC_HIGH                        tSYNC_LOW
                          SYNC
                                                                  tSYNC_PERIOD
                 Figure 1 Clock Specifications (50pF External Load)
                  Test Conditions
                  DBVDD = 3.3V, DCVDD = 3.3V, DGND1 = DGND2 = 0V, TA = -25C to +85C, unless otherwise
                  stated.
                              PARAMETER                        SYMBOL               MIN  TYP   MAX    UNIT
                  BITCLK frequency                                                      12.288        MHz
                  BITCLK period                                tCLK_PERIOD               81.4           ns
                  BITCLK output jitter                                                         750      ps
                  BITCLK high pulse width (Note 1)               tCLK_HIGH          36   40.7  45       ns
                  BITCLK low pulse width (Note 1)                tCLK_LOW           36   40.7  45       ns
                  SYNC frequency                                                          48           kHz
                  SYNC period                                 tSYNC_PERIOD               20.8           s
                  SYNC high pulse width                         tSYNC_HIGH                1.3           s
                  SYNC low pulse width                          tSYNC_LOW                19.5           s
                 Note:
                 1.   Worst case duty cycle restricted to 45/55
Rev 4.0                                                                                                  11


                                                                              WM9713L
   DATA SETUP AND HOLD
                       t CO                tSETUP
                          VIH
         BITCLK                             VIL
     SDATAOUT
                                      VOH
        SDATAIN
            SYNC                      VOL
                                   t HOLD
   Figure 2 Data Setup and Hold (50pF External Load)
   Note:
   Setup and hold times for SDATAIN are with respect to the AC’97 controller, not the WM9713L.
    Test Conditions
    DBVDD = 3.3V, DCVDD = 3.3V, DGND1 = DGND2 = 0V, TA = -25C to +85C, unless otherwise
    stated.
                  PARAMETER                   SYMBOL           MIN         TYP         MAX     UNIT
    Setup to falling edge of BITCLK             tSETUP         10                               ns
    Hold from falling edge of BITCLK             tHOLD         10                               ns
    Output valid delay from rising edge of        tCO                                   15      ns
    BITCLK
12                                                                                          Rev 4.0


                                                                                  WM9713L
        SIGNAL RISE AND FALL TIMES
                         triseCLK                tfallCLK
                 BITCLK
                        triseSYNC               tfallSYNC
                   SYNC
                         triseDIN                tfallDIN
               SDATAIN
                        triseDOUT               tfallDOUT
             SDATAOUT
        Figure 3 Signal Rise and Fall Times (50pF External Load)
          Test Conditions
          DBVDD = 3.3V, DCVDD = 3.3V, DGND1 = DGND2 = 0V, TA = -25C to +85C, unless otherwise
          stated.
                       PARAMETER                          SYMBOL      MIN       TYP      MAX      UNIT
          BITCLK rise time                                 triseCLK    2                   6       ns
          BITCLK fall time                                  tfallCLK   2                   6       ns
          SYNC rise time                                  triseSYNC                        6       ns
          SYNC fall time                                   tfallSYNC                       6       ns
          SDATAIN rise time                                 triseDIN   2                   6       ns
          SDATAIN fall time                                  tfallDIN  2                   6       ns
          SDATAOUT rise time                              triseDOUT                        6       ns
          SDATAOUT fall time                               tfallDOUT                       6       ns
        AC-LINK POWERDOWN
                        SLOT 1      SLOT 2
                 SYNC
               BITCLK
                            WRITE              DON'T
                                      DATA PR4
           SDATAOUT        TO 0X20             CARE
                                   tS2_PDOWN
              SDATAIN
        Figure 4 AC-Link Powerdown Timing
        AC-Link powerdown occurs when PR4 (register 26h, bit 12) is set (see “Power Management”).
                      PARAMETER                           SYMBOL      MIN       TYP      MAX      UNIT
        End of Slot 2 to BITCLK and SDATAIN               tS2_PDOWN                       1.0      s
        low
Rev 4.0                                                                                             13


                                                                             WM9713L
   COLD RESET (ASYNCHRONOUS – RESETS REGISTER SETTINGS)
                                     tRST_LOW
          RESETB
   Figure 5 Cold Reset Timing
   Note:
   For correct operation SDATAOUT and SYNC must be held LOW for entire RESETB active low period
   otherwise the device may enter test mode. See AC'97 specification and Application Note WAN 0104
   for further details.
                  PARAMETER                    SYMBOL          MIN        TYP         MAX      UNIT
     RESETB active low pulse width              tRST_LOW       1.0                              s
   WARM RESET (ASYNCHRONOUS – PRESERVES REGISTER SETTINGS)
                                   tSYNC_HIGH      tSYNC2CLK
            SYNC
         BIT_CLK
   Figure 6 Warm Reset Timing
                  PARAMETER                    SYMBOL          MIN        TYP         MAX      UNIT
     SYNC active high pulse width              tSYNC_HIGH                  1.3                  s
     SYNC inactive to BITCLK startup            tRST2CLK      162.4                             ns
     delay
14                                                                                          Rev 4.0


                                                                                                 WM9713L
PCM AUDIO INTERFACE TIMING – SLAVE MODE
                                                       tCLKH             tCLKL
                                PCMCLK
                                                             tCLKY
                                PCMFS
                                                                             tDS tFSH     tFSSU
                                PCMDAC
                                                                     tDD              tDH
                                PCMADC
                             Figure 7 Digital Audio Data Timing – Slave Mode
   Test Conditions
   DBVDD = 3.3V, DCVDD = 3.3V, DGND1 = DGND2 = 0V, TA = -25C to +85C, unless otherwise stated.
   PARAMETER                                                       SYMBOL          MIN      TYP   MAX UNIT
   Audio Data Input Timing Information
   PCMCLK cycle time                                                tPCMY           50                 ns
   PCMCLK pulse width high                                          tPCMH           20                 ns
   PCMCLK pulse width low                                            tPCML          20                 ns
   PCMFS set-up time to PCMCLK rising edge                           tFSSU          10                 ns
   PCMFS hold time from PCMCLK rising edge                            tFSH          10                 ns
   PCMDAC set-up time from PCMCLK rising edge                          tDS          10                 ns
   PCMDAC hold time from PCMCLK rising edge                            tDH          10                 ns
   PCMADC propagation delay from PCMCLK falling edge                   tDD                        10   ns
Note:
1.   PCMCLK period should always be greater than or equal to Voice CLK period.
Rev 4.0                                                                                                    15


                                                                                                 WM9713L
PCM AUDIO INTERFACE TIMING – MASTER MODE
                               PCMCLK
                               (Output)
                                                                             tDL
                               PCMFS
                               (Output)
                                                                            tDDA
                               PCMADC
                               PCMDAC
                                                          tDST   tDHT
                           Figure 8 Digital Audio Data Timing – Master Mode (see Control Interface)
 Test Conditions
 DBVDD = 3.3V, DCVDD = 3.3V, DGND1 = DGND2 = 0V, TA = -25C to +85C, unless otherwise stated.
 PARAMETER                                                      SYMBOL           MIN       TYP      MAX UNIT
 Audio Data Input Timing Information
 PCMFS propagation delay from PCMCLK falling edge                   tDL                             10   ns
 PCMADC propagation delay from PCMCLK falling edge                 tDDA                             10   ns
 PCMDAC setup time to PCMCLK rising edge                           tDST          10                      ns
 PCMDAC hold time from PCMCLK rising edge                          tDHT          10                      ns
16                                                                                                      Rev 4.0


                                                                                             WM9713L
DEVICE DESCRIPTION
INTRODUCTION
               The WM9713L is a largely pin-compatible upgrade to WM9712, with a PCM voice CODEC added.
               This CODEC is interfaced via a PCM type audio interface which makes use of GPIO pins for
               connection.
               It is designed to meet the mixed-signal requirements of portable and wireless smartphone systems. It
               includes audio recording and playback, touchpanel digitisation, battery monitoring, auxiliary ADC and
               GPIO functions, all controlled through a single 5-wire AC-Link interface. Additionally, PCM voice
               CODEC functions are supported through provision of an additional voice DAC and a PCM audio serial
               interface.
               A PLL is included to allow unrelated reference clocks to be used for generation of the AC link system
               clock. Typically 13MHz or 2.048MHz clock sources might be used as a reference.
               SOFTWARE SUPPORT
               The basic audio features of the WM9713L are software compatible with standard AC’97 device
               drivers. However, to better support the touchpanel and other additional functions, Cirrus Logic
               supplies custom device drivers for selected CPUs and operating systems. Please contact your local
               Cirrus Logic representative for more information.
               AC’97 COMPATIBILITY
               The WM9713L uses an AC’97 interface to communicate with a microprocessor or controller. The
               audio and GPIO functions are largely compliant with AC’97 Revision 2.2. The following differences
               from the AC’97 standard are noted:
                         Pinout: The function of some pins has been changed to support device specific features.
                          The PHONE and PCBEEP pins have been moved to different locations on the device
                          package.
                         Package: The default package for the WM9713L is a 77mm leadless QFN package.
                         Audio mixing: The WM9713L handles all the audio functions of a smartphone, including
                          audio playback, voice recording, phone calls, phone call recording, ring tones, as well as
                          simultaneous use of these features. The AC’97 mixer architecture does not fully support
                          this. The WM9713L therefore uses a modified AC’97 mixer architecture with three separate
                          mixers.
                         Tone Control, Bass Boost and 3D Enhancement: These functions are implemented in the
                          digital domain and therefore affect only signals being played through the audio DACs, not all
                          output signals as stipulated in AC’97.
               Some other functions are additional to AC’97:
                         On-chip BTL loudspeaker driver for mono or stereo speakers
                         On-chip BTL driver for ear speaker (phone receiver)
                         Auxiliary mono DAC for ring tones, system alerts etc.
                         Touchpanel controller
                         Auxiliary ADC Inputs
                         2 Analogue Comparators for Battery Alarm
                         Programmable Filter Characteristics for Tone Control and 3D Enhancement
                         PCM interface to additional Voice DAC and existing audio ADCs
                         PLL to create AC’97 system clock from unrelated reference clock input
Rev 4.0                                                                                                              17


                                                                          WM9713L
   PCM CODEC
   The PCM voice CODEC functions typically required by mobile telephony devices are provided by an
   extra voice DAC on the WM9713L, which is interfaced via a standard PCM type data interface, which
   is constructed through optional use of 4 of the GPIO pins on WM9713L. The audio output data from
   one or both of the audio ADCs can also be output over this PCM interface, allowing a full voice
   CODEC function to be implemented. This PCM interface supports sample rates from 8 to 48ks/s using
   the standard AC’97 master clock.
18                                                                                         Rev 4.0


                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   WM9713L
AUDIO PATHS OVERVIEW
                                                                                                                                                                                                         WM9713 Analogue
                                                                                                                                                                                            Note: all PGAs and summers are inverting
                                                                                                                                                                                                                                                                                                                             RECMUXL        RECMUXR                                                                                                                       MONOMIX
                                                                                                                                                                                               0Ch:12-8
                                                                                                                                                                                                                                   DACL      DACR      LINEL      LINER       MONOIN       PCBEEP                                                         AUXDAC      VXDAC                                                                    HPMIXL       HPMIXR                      SPKMIX
                                                                                                                                     40h:7                                                   00000 = +12dB
                                                                                                                                                                                                                                                                                                       MICA      MIC2                                                                                                                                                                                                        INV1      INV2
                                                                                                                                  (Loopback)                                                11111 = -34.5dB
                                                                                                                AC'97 Link                         Tone and 3D
                                                                                                                                                                         18 Bit DACL                                                                                                                                                                                          DACL
                                                                                                                                                    1Eh / 20h /
                                                                                                                 ADC Left                          40h:13 (3DE)             slot 3
                                                                                                                                                                                                                                                                                                                                                                              LINEL
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       1Eh:15-13
                                                                                                                                                                                                                                                                                                                                                                                                                  0C
                                                                                                                                                                                                                                                                                                                                                                              MONOIN                            0A       5
                                                                                                                                                                                                                                                                                                                                                                                                                      h:1
                                                                                                                                                                                                                                                                                                                                                                                                                    h:1
                                                                                                                                           0Ah:12-8
                                                                                          MONOIN       PCBEEP
                                                                                                                                                                                                                                                                                                                                                                                                               08       5
                                               LINEL      LINER
                                                                                                                                        00000 = +12dB                                                                                                                                                                                                                                   6dB -> -15dB              h:1
                                                                     MICA      MICB                                                                                                                                                                                                                                                                                           PCBEEP
                                                                                                                                                                                                                                                                                                                                                                                                                      5      Headphone
                                                                                                                                       11111 = -34.5dB                                                                                                                                                                                                                                                   16
                                                                                                                                                                                                                                                                                                                                                                                                              h:1             Mixer L
                                                                                                                                                                                                                                                                                                                                                                                        6dB -> -15dB
                                                                                                                                                                                                                                                                                                                                                                                                                  5-1                                                                                                                                                                 04h:12-8
                                                                                                                                                                                                                                                                                                                                                                              MICA                                    2
   LINEL                                                                                                                                                                                                                                                                                                                                                                                                 10h:
                                                                                                                                                                                                                                                                                                                                                                                                                4-0                                                                                                                                                                 00000 = 0dB
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  11111 = -46.5dB
                                                                                                                                                                                                                                                                                                                                                                                        6dB -> -15dB
                                                                                                                                                                                                                                                                                                                                                                              MICB                      10h:4-0                                                                                                                               HPMIXL
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            1Ch:7-6                                        HPL
                                                                                                                                           08h:12-8                                                                                                                                                                                                                                                               1
                                                                                                                                                                                                                                                                                                                                                                                                            15-1
                                                                                                                                        00000 = +12dB                                                                                                                                                                                                                                   6dB -> -15dB   14h:
                                                                                                                                                                                                                                                                                                                                                                              RECMUXL                             1
                                                                                                                                       11111 = -34.5dB                                                                                                                                                                                                                                                         5-1
                                                                                                                                                                                                                                                                                                                                                                                                           h:1
                                                                                                                                                                                                                                                                                                                                                                                                        14          2
                                                                                                                                                                                                                                                                                                                                                                                                                5-1
                                                                                                                                                                                                                                                                                                                                                                                        6dB -> -15dB
                                                                                                                                                                                                                                                                                                                                                                              RECMUXR                                                                                                                                                                Vmid
  MONOIN                                                                                                                                                                                                                                                                                                                                                                                                    h:1 2
                                                                                                                                                                                                                                                                                                                                                                                                         1A 5- 1
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        Zero-cross
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          detect
                                                                                                                                                                                                                                                                                                                                                                                        6dB -> -15dB
                                                                                                                                                                                                                                                                                                                                                                                                              h:1
                                                                                                                                                                                                                                                                                                                                                                                                           18
                                                                                                                                                                                                                                                                                                                                                                              AUXDAC
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         04h:14 (ZC)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     04h:15 (MUTE)
                                                                                                                                                                                                                                                                                                                                                                                        6dB -> -15dB
                                                                                                                                                                                                                                                                                                                                                                              VXDAC
                                                                                                                                                                                       16 Bit PCM                                                                                                                                                                                                                                                                                                                                                                                     02h:12-8
                                                                                                                                                                   PCM Link                                                                                                                                                                                                                                                                                                                                                                   HPMIXL
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    00000 = 0dB
                                                                                                                                                                                         VXDAC                                                                                                                                                                                                                                                                                                                                                                                    11111 = -46.5dB
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            1Ch:13-11
                                                                                                                                                                                                                                                                                                                        RECMUXL        RECMUXR
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              SPKMIX
                                                                                                                                                                                                                                DACL      DACR      LINEL      LINER      MONOIN       PCBEEP       MICA      MICB                                    AUXDAC       VXDAC                                                                                                                                                                      INV1                                                         SPKL
                                                                                                                                                                                                                                                                                                                                                                              DACL
                                                                                                                                                                                                                                                                                                                                                                              DACR                                                                                                                                                                                                      Zero-cross
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          detect
                                                                                                                                                                                                                                                                                                                                                                                                                  0C                                                                                                                                 Vmid
                                                                                                                                                                                                                                                                                                                                                                              LINEL                           0C         3                                                                                                                                                               02h:14 (ZC)
                                                                                                                                                                                                                                                                                                                                                                                                                 h:1  h:1
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     02h:15 (MUTE)
                                                                                                                                                                                                                                                                                                                                                                                                            0A       3
                                                                                                                                                                                                                                                                                                                                                                              LINER                            h:1            MONO
                                                                                                                                                                                                                                                                                                                                                                                                           0A      3
                                                                                                                                                                                                                                                                                                                                                                                                             h:1              Mixer
                                                                                                                                                                                                                                                                                                                                                                                        6dB -> -15dB             3
                                                                                                                                                                                                                                                                                                                                                                              PCBEEP
                                                                                                                                                                                                                                                                                                                                                                                                          16h7                                                                                                                                                                        08h:4-0
                                                                                                                                                                                                                                                                                                                                                                                                               :4
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    00000 = 0dB
                                                                                                                                                                                                                                                                                                                                                                                        0dB / 20dB
                                                                                                                                                                                                                                                                                                                                                                              MICA                      10h:7+5                                                                                                                               MONOMIX                             11111 = -46.5dB
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            1Ch:15-14
                                                                                                                                                                                                                                                                                                                                                                                                             6+5
                                                                                                                                                                                                                                                                                                                                                                              MICB
                                                                                                                                                                                                                                                                                                                                                                                        0dB / 20dB      10h:                                                                                                                                  INV1
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           MONO
  PCBEEP                                                                                                                                                                                                                                                                                                                                                                                                   h:1
                                                                                                                                                                                                                                                                                                                                                                                                               0-8
                                                                                                                                                                                                                                                                                                                                                                                                        14
                                                                                                                                                                                                                                                                                                                                                                              RECMUXL
                                                                                                                                                                                                                                                                                                                                                                                        0dB / 20dB
                                                                                                                                                                                                                                                                                                                                                                                                                0-8
                                                                                                                                                                                                                                                                                                                                                                                                            h:1 4
                                                                                                                                           0Eh:12-8                                                                                                                                                                                                                                                      14        -                                                                                                                                 Vmid
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        Zero-cross
                                                                                                                                        00000 = +12dB                                                                                                                                                                                                                                   0dB / 20dB             h:7                                                                                                                                                                        detect
                                                                                                                                                                                                                                                                                                                                                                              RECMUXR                       1A  h:7
                                                                                                                                                                                                                                                                                                                                                                                                                    -4
                                                                                                                                       11111 = -34.5dB                                                                                                                                                                                                                                                                                                                                                                                                                                   08h:6 (ZC)
                                                                                                                                                                                                                                                                                                                                                                                                              18
                                                                                                                                                                                                                                                                                                                                                                                        6dB -> -15dB                                                                                                                                                                                 08h:7 (MUTE)
                                                                                                                                                                                                                                                                                                                                                                              AUXDAC
                                                                                                                                                                                                                                                                                                                                                                                        6dB -> -15dB
                                                                                                                                                                                                                                                                                                                                                                              VXDAC
                                            LINEL      LINER                          MONOIN       PCBEEP                                                                                                                       DACL      DACR      LINEL      LINER      MONOIN       PCBEEP                           RECMUXL        RECMUXR        AUXDAC       VXDAC                                                                   HPMIXL       HPMIXR       MONOMIX        SPKMIX
                                                                  MICA      MICB                                                                                                                                                                                                                    MICA      MICB                                                                                                                                                                                                        INV1      INV2
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         06h:4-0
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       00000 = 0dB
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     11111 = -46.5dB
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              INV1
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        1Ch:3-2                             OUT3
                                                                                                                                        12h:14 (GRL=0)
                                                                                                                                        12h:11:8
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         Vmid
                                                                                                                                        0000 = 0db                                                                                                                                                                                                                                                                                                                                                                                                                                            Zero-cross
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                detect
                                                                                                                                        1111 = +22.5dB
                                                                                                                                        12h:14 (GRL=1)                                                                                                                                                                                                                                                                                                                                                                                                                                       06h:6 (ZC)
                                                                                                                                        12h:13-8              14h:6                                                                                                                                                                                                                                                                                                                                                                                                                      06h:7 (MUTE)
                                                                                                                                        11111 = +30dB
                                                                                                                             14h:5-3
                                                                                                                                                             0 = 0dB
                                                                                                                                        00000 = -17.25dB    1 = 20dB                                Sent to Both
                                                                                                                                                                                  18 Bit ADC
                                                                                                                                                                                 Variable Slot                     PCM Link                                                                                                                                                                                                                                                                                                                                                              06h:12-8
                                                                                                                                                                                 5C:1-0 (ASS)                                                                                                                                                                                                                                                                                                                                                                                          00000 = 0dB
                                                                                                                                                                                  5C:3 (HPF)                       AC'97 Link                                                                                                                                                                                                                                                                                                                                                        11111 = -46.5dB
                                                                                                                                                                                 5C:4 (ADCO)                                                                                                                                                                                                                                                                                                                                                  INV2
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        1Ch:1-0                             OUT4
                                                                                                                                                                               ALC:5Ch/60h/62h
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         Vmid                                 Zero-cross
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                detect
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             06h:14 (ZC)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         06h:15 (MUTE)
                                                                                                                                                                                                0Ch:4-0
                                                                                                                                                                                                                                                                                                                        RECMUXL        RECMUXR                                                                                                                       MONOMIX
                                                                                                                                     40h:7
                                                                                      MONOIN       PCBEEP                                                                                                                                                                 MONOIN       PCBEEP                                                         AUXDAC
                                                                                                                                                                                             00000 = +12dB
                                            LINEL      LINER      MICA      MICB
                                                                                                                                  (Loopback)                                                11111 = -34.5dB                     DACL      DACR      LINEL      LINER                                MICA      MICB                                                 VXDAC                                                                   HPMIXL       HPMIXR                      SPKMIX                                INV1      INV2
                                                                                                                AC'97 Link                         Tone and 3D           18 Bit DACR                                                                                                                                                                                          DACR
                                                                                                                                                    1Eh / 20h /
                                                                                                                ADC Right                          40h:13 (3DE)             slot 3
                                                                                                                                                                                                                                                                                                                                                                              LINER
                                                                                                                                                                                                                                                                                                                                                                                                                  0C
                                                                                                                                                                                                                                                                                                                                                                              MONOIN                          0A         5
                                                                                                                                                                                                                                                                                                                                                                                                                 h:1  h:1
                                                                                                                                           0Ah:4-0                                                                                                                                                                                                                                                          08       5
                                                                                                                                                                                                                                                                                                                                                                                        6dB -> -15dB           h:1
                                                                                                                                        00000 = +12dB                                                                                                                                                                                                                         PCBEEP                                         Headphone
                                                                                                                                       11111 = -34.5dB                                                                                                                                                                                                                                                   16        5
                                                                                                                                                                                                                                                                                                                                                                                                           h:1                Mixer R
                                                                                                                                                                                                                                                                                                                                                                                        6dB -> -15dB
                                                                                                                                                                                                                                                                                                                                                                                                               5-1                                                                                                                                                                    04h:4-0
                                                                                                                                                                                                                                                                                                                                                                              MICA                                 2
   LINER                                                                                                                                                                                                                                                                                                                                                                                                 10h:
                                                                                                                                                                                                                                                                                                                                                                                                              4-0                                                                                                                                                                   00000 = 0dB
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  11111 = -46.5dB
                                                                                                                                                                                                                                                                                                                                                                                        6dB -> -15dB
                                                                                                                                                                                                                                                                                                                                                                              MICB                      10h:4-0                                                                                                                               HPMIXR
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            1Ch:5-4                                        HPR
                                                                                                                                                                                                                                                                                                                                                                                                                    1
                                                                                                                                                                                                                                                                                                                                                                                                             15-1
                                                                                                                                                                                                                                                                                                                                                                              RECMUXL
                                                                                                                                                                                                                                                                                                                                                                                        6dB -> -15dB   14h:
                                                                                                                                                                                                                                                                                                                                                                                                                    1
                                                                                                                                                                                                                                                                                                                                                                                                               5-1
                                                                                                                                                                                                                                                                                                                                                                                                           h:1
                                                                                                                                                                                                                                                                                                                                                                                                        14           2
                                                                                                                                                                                                                                                                                                                                                                                                                5-1
                                                                                                                                                                                                                                                                                                                                                                                        6dB -> -15dB
                                                                                                                                                                                                                                                                                                                                                                              RECMUXR                                                                                                                                                                Vmid                               Zero-cross
                                                                                                                                                                                                                                                                                                                                                                                                           Ah:1 -12                                                                                                                                                                       detect
                                                                                                                                                                                                                                                                                                                                                                                                         1        5
                                                                                                                                                                                                                                                                                                                                                                                        6dB -> -15dB
                                                                                                                                                                                                                                                                                                                                                                                                              h:1
                                                                                                                                                                                                                                                                                                                                                                                                           18
                                                                                                                                                                                                                                                                                                                                                                              AUXDAC
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         04h:6 (ZC)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     04h:7 (MUTE)
                                                                                                                                                                                                                                                                                                                                                                                        6dB -> -15dB
                                                                                                                                                                                                                                                                                                                                                                              VXDAC
                Vmid
                                                                                                                                                                                       12 Bit Resistor                                                                                                                                                                                                                                                                                                                                                                                02h:4-0
                                                                                                                                                                  AC'97 Link             string DAC                                                                                                                                                                                                                                                                                                                                           HPMIXR
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    00000 = 0dB
                                                                                                                                                                                          2Eh/64h                                                                                                                                                                                                                                                                                                                                                                                 11111 = -46.5dB
    MIC1
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            1Ch:10-8
                                                                                                                                                                                                                                                                                                                        RECMUXL        RECMUXR
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              SPKMIX
                                                                                                                                                                                                                                                                          MONOIN       PCBEEP                                                         AUXDAC
                        22h:
                                                                                                                                                                                                                                                                                                                                                                   VXDAC
                                22h:11-10
                Vmid   13-12   00 = +12dB                                                                                                                                                                                       DACL      DACR      LINEL      LINER                                MICA      MICB
                                                                                                                                                                                                                                                                                                                                                                              LINEL
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              INV2                                                         SPKR
                               11 = +30dB
                                                                                                                                                                                                                                                                                                                                                                              LINER                          0A                                                                                                                                                                         Zero-cross
                                                                                                                                                                                                                                                                                                                                                                                                                h:1
   MIC2A                                                                                                                                                                                                                                                                                                                                                                      DACL
                                                                                                                                                                                                                                                                                                                                                                                                           0A 4
                                                                                                                                                                                                                                                                                                                                                                                                               h1             Speaker
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     Vmid
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          detect
                                                                                                                                                                                                                                                                                                                                                                                                                  4                                                                                                                                                                      02h:6 (ZC)
                                                                                                                                                                                                                                                                                                                                                                                                          0C                   Mixer                                                                                                                                                 02h:7 (MUTE)
                Vmid                                                                                                                                                                                                                                                                                                                                                                                         h:1
                                                                                                                                                                                                                                                                                                                                                                                                                4
                                                                                                                                                                                                                                                                                                                                                                              DACR
                                                                                                                                                                                                                                                                                                                                                                                                         0Ch:
                                                                                                                                                                                                                                                                                                                                                                                                              14
                                                                                                                                                                                                                                                                                                                                                                              MONOIN                     08h:14
   MIC2B                         22h:9-8
                               00 = +12dB                                                                                                  0Eh:4-0
                                                                                                                                                                                                                                                                                                                                                                                                            11-8
                                                                                                                                        00000 = +12dB                                                                                                                                                                                                                                   6dB -> -15dB   16h:
                               11 = +30dB                                                                                                                                                                                                                                                                                                                                     PCBEEP
                                                                                                                                       11111 = -34.5dB                                                                                                                                                                                                                                                        1-8
                                                                                                                                                                                                                                                                                                                                                                                                          h:1
                                                                                                                                                                                                                                                                                                                                                                                                        1A
                                                                                                                                                                                                                                                                                                                                                                              AUXDAC
                                                                                                                                                                                                                                                                                                                                                                                        6dB -> -15dB
                                                                                                                                                                                                                                                                                                                                                                                                                1-8
                                                                                                                                                                                                                                                                                                                                                                                                            h:1
                                                                                                                                                                                                                                                                                                                                                                                                         18
   MICCM                                                                                                                                                                                                                                                                                                                                                                      VXDAC
                                                                                                                                                                                                                                                                                                                                                                                        6dB -> -15dB
                                                                                                                                                                                                                                                                                                                                                                                                                                           HPMIXL       HPMIXR       MONOMIX        SPKMIX
                                                                                      MONOIN       PCBEEP
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          INV1      INV2
                                            LINEL      LINER      MICA      MICB
                                                                                                                                        12h:6 (GRR=0)
                                                                                                                                                                                                                                   DACL      DACR      LINEL      LINER
                                                                                                                                                                                                                                                                                           PCBEEP
                                                                                                                                                                                                                                                                                                       MICA      MICB
                                                                                                                                                                                                                                                                                                                                                                      VXDAC
                                                                                                                                                                                                                                                                                                                             RECMUXL
                                                                                                                                                                                                                                                                              MONOIN
                                                                                                                                                                                                                                                                                                                                            RECMUXR
                                                                                                                                        12h:3:0                                                                                                                                                                                                           AUXDAC
                                                                                                                                        0000 = 0db
                                                                                                                                        1111 = +22.5dB
                                                                                                                                        12h:6 (GRR=1)
                                                                                                                                        12h:5-0               14h:6
                                                                                                                                        11111 = +30dB
                                                                                                                             14h:2-0
                                                                                                                                                             0 = 0dB
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       1Eh:12-10
                                                                                                                                        00000 = -17.25dB    1 = 20dB                                Sent to Both
                                                                                                                                                                                  18 Bit ADC
                                                                                                                                                                                 Variable Slot                     PCM Link
                                                                                                                                                                                 5C:1-0 (ASS)
                                                                                                                                                                                  5C:3 (HPF)                       AC'97 Link
                                                                                                                                                                                 5C:4 (ADCO)
                                                                                                                                                                               ALC:5Ch/60h/62h
                                               LINEL      LINER
                                                                                                       PCBEEP
                                                                     MICA      MICB
                                                                                          MONOIN
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             INV1      INV2
                                                                                                                                                                                                                                                                                                                                                                                                                                               HPMIXL       HPMIXR
                                                                                                                                                                                                                                                                                                                                                                                                                                                                          MONOMIX
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        SPKMIX
                PR Bit Code
           PR0 - Audio ADCs & record mux
           PR1 - Stereo DAC
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       VMICBIAS
           PR2 - Input PGAs & mixers
           PR3 - Refs, input PGAs, mixers & output PGAs
           PR6 - Output PGAs
       Note: PR bits are active low - i.e. 0 = "ON"; 1 = "OFF"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   VREF
                      => Enable when { (PR0 || PR2) && PR3 } are low                                                                                                                                                                                                                                                                                                                                                                     AVDD              AGND                                  CAP
Figure 9 Audio Paths Overview
Rev 4.0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           19


                                                                                                    WM9713L
CLOCK GENERATION
                WM9713L supports clocking from 2 separate sources, which can be selected via the AC’97 interface:
                      External clock input MCLKA
                      External clock input MCLKB
                The source clock is divided to appropriate frequencies in order to run the AC’97 interface, PCM
                interface, voice DAC and hi-fi DSP by means of a programmable divider block. Clock rates may be
                changed during operation via the AC’97 link in order to support alternative modes, for example low
                power mode when voice data is being transmitted only. A PLL is present to add flexibility in selection
                of input clock frequencies, typical choices being 2.048MHz, 4.096MHz or 13MHz.
                INITIALISING THE AC’97 LINK
                By default, the AC’97 link is disabled and therefore will not be running after power on or a COLD reset
                event. Before any register map configuration can begin, it is necessary to start the AC’97 link. This is
                achieved by sending a WARM reset to the CODEC as defined in Figure 6.
                Default mode on power-up also assumes a clock will be present on MCLKA with the PLL powered
                down. After a WARM reset the CODEC will start the AC’97 link using MCLKA as a reference. This
                enables data to be clocked via the AC’97 link to define the desired clock divider mode and whether
                PLL needs to be activated.
                Note: MCLKA can be any available frequency.
                When muxing between MCLKA and MCLKB both clocks must be active for at least two clock cycles
                after the switching event.
CLOCK DIVISION MODES
                Figure 10 shows the clocking strategy for WM9713L. Clocking is controlled by CLK_MUX, CLK_SRC
                and S[6:0].
                          CLKAX2, CLKBX2 – clock doublers on inputs MCLKA and MCLKB.
                          CLK_MUX - selects between MCLKA and MCLKB.
                          CLK_SRC – selects between external or PLL derived clock reference.
                          S[3:0] – sets the voice DAC clock rate and PCM interface clock when in master mode
                           (division ratio 1 to 16 available).
                          S[6:4] - sets the hi-fi clocking rate (division ratio 1 to 8 available).
                The registers used to set these switches can be accessed from register address 44h (see Table 3).
                If a mode change requires switching from an external clock to a PLL generated clock then it is
                recommended to set the clock division ratios required for the PLL clock scheme prior to switching
                between clocks. This option is accommodated by means of two sets of registers. SPLL[6:0] is used to
                set the divide ratio of the clock when in PLL mode and SEXT[6:0] is used to divide the clock when it is
                derived from an external source. If the PLL is selected (CLK_SRC = 0), S[6:0] = SPLL[6:0]. SPLL[6:0] is
                defined in register 46h (see Table 4) and is written to using the page address mode. More details on
                page address mode for controlling the PLL are found on page 25. Register 46h also contains a
                number of separate control bits relating to the PLL’s function. If an external clock is selected
                (CLK_SRC = 1) S[6:0] = SEXT[6:0]. SEXT[6:0] is defined in register address 44h. Writing to registers 44h
                and 46h enables pre-programming of the required clock mode before the PLL output is selected.
20                                                                                                            Rev 4.0


                                                                                                          WM9713L
                                                                                                 data bus
                                                                                                 clock
                        PCMCLK                           MCLKA    MCLKB               AC-Link                     BCLK
                                          CLKAX2           x2      x2        CLKBX2
                                                           0         1
                                                               MUX
                                                                   CLK_MUX
                                                     SYSCLK
                                        CLKSRC
                                                     0
                        PCM                                                           AC'97
                                                 1               PLL
                                                                  AC97 CLK                              DIV 2
                                                           SEXT[3:0] /                           SEXT[6:4] /               PENDIV
                                       DIV 1-16            SPLL[3:0] /                DIV 1-8    SPLL[6:4] /    DIV 1-16   [2:0]
                                                                                            HIFI CLK
                                  VOICE DAC
                                   CLOCK
                                                                         HIFI DSP       AUX DAC                 AUX ADC
                                                                         L/R ADCs
                    VOICE DAC                                            L/R DACs
                                                     WM9713L
          Figure 10 Clocking Architecture for WM9713L
          INTERNAL CLOCK FREQUENCIES
          The internal clock frequencies are defined as follows (refer to Figure 10):
                AC97 CLK – nominally 24.576MHz, used to generate AC97 BITCLK at 12.288MHz
                HIFI CLK – for hi-fi playback at 48ks/s HIFI CLK = 24.576MHz. See Table 2 for voice only
                 playback.
                Voice DAC CLK – see Table 2 for sample rate vs clock frequency.
                       SAMPLE RATE                             VOICE DAC CLK               HIFI CLK
                                                                FREQUENCY                FREQUENCY
              8ks/s voice and hi-fi                            2.048MHz                24.576MHz
              8ks/s voice only (power save)                    2.048MHz                4.096MHz
              16ks/s voice and hi-fi                           4.096MHz                24.576MHz
              16ks/s voice only (power save)                   4.096MHz                8.192MHz
              32ks/s voice and hi-fi                           8.192MHz                24.576MHz
           48ks/s voice and hi-fi           12.288MHz                                  24.576MHz
          Table 2 Clock Division Mode Table
Rev 4.0                                                                                                                             21


                                                                                        WM9713L
         AUXADC
         The clock for the AUXADC nominally runs at 768kHz and is derived from BITCLK. The divisor for the
         clock generator is set by PENDIV. This enables the AUXADC clock frequency to be set according to
         power consumption and conversion rate considerations.
         Clock mode and division ratios are controlled by register 44h as shown in Table 3.
            REGISTER         BIT      LABEL          DEFAULT                      DESCRIPTION
            ADDRESS
           44h             14:12     SEXT[6:4]     000 (div 1)      Hi-fi Block Clock Division Control
                                                                    000 = f
                                                                    001 = f/2
                                                                    …
                                                                    111 = f/8
                           11:8      SEXT[3:0]     0000 (div 1)     Voice DAC Clock Division Control
                                                                    0000 = f
                                                                    0001 = f/2
                                                                     …
                                                                    1111 = f/16
                           7         CLKSRC        1 (ext clk)      AC97 CLK Source Control
                                                                    1 = External clock
                                                                    0 = PLL clock
                           5:3       PENDIV        000 (div 16)     AUXADC Clock Division Control
                                                                    000 = f/16
                                                                    001 = f/12
                                                                    010 = f/8
                                                                    011 = f/6
                                                                    100 = f/4
                                                                    101 = f/3
                                                                    110 = f/2
                                                                    111 = f
                           2         CLKBX2        0 (Off)          MCLKB Multiplier Control
                                                                    0 = Normal
                                                                    1 = Multiply by 2
                           1         CLKAX2        0 (Off)          MCLKA Multiplier Control
                                                                    0 = Normal
                                                                    1 = Multiply by 2
                           0         CLKMUX        0 (MCLKA)        External Clock Source Control
                                                                    0 = Use MCLKA
                                                                    1 = Use MCLKB
                                                                    Note: On power-up clock must be present
                                                                    on MCLKA and must be active for 2 clock
                                                                    cycles after switching to MCLKB
         Table 3 Clock Muxing and Division Control
PLL MODE
         The PLL operation is controlled by register 46h (see Table 4) and has two modes of operation:
                  Integer N
                  Fractional N
         The PLL has been optimized for nominal input clock (PLL_IN) frequencies in the range 8.192MHz –
         19.661MHz (LF=0) and 2.048MHz – 4.9152MHz (LF=1). Through use of a clock divider (div by 2 / 4)
         on the input to the PLL frequencies up to 78.6MHz can be accommodated. The input clock divider is
         enabled by DIVSEL (0=Off) and the division ratio is set by DIVCTL (0=div2, 1=div4).
22                                                                                                   Rev 4.0


                                                                           WM9713L
                        DIVSEL
                                                           PLL_OUT                    CLK_OUT
                          DIV      PLL_IN
           MCLK                                                              DIV 4
                         4/2/1                  PLL
                                                             98.304MHz
                       DIVCTL
                                          DIV N             DIV4/1
                          N[3:0]
                                                               LF
                                              SDM          SDM
                                              K[21:0]
                                                                           WM9713 PLL
        Figure 11 PLL Architecture
          REGISTER       BIT      LABEL     DEFAULT                  DESCRIPTION
          ADDRESS
         46h           15:12     N[3:0]    0000       PLL N Divide Control
                                                      0000 = Divide by 1
                                                      0001 = Divide by 1
                                                      0010 = Divide by 2
                                                      …
                                                      1111 = Divide by 15
                                                      Note: must be set between 05h and 0Ch for
                                                      integer N mode
                       11        LF        0 = off    PLL Low Frequency Input Control
                                                      1 = Low frequency mode (input clock <
                                                      8.192MHz)
                                                      0 = Normal mode
         46h           10        SDM       0 = off    PLL SDM Enable Control
                                                      1 = Enable SDM (required for fractional N
                                                      mode)
                                                      0 = Disable SDM
         46h           9         DIVSEL    0 = off    PLL Input Clock Division Control
                                                      0 = Divide by 1
                                                      1 = Divide according to DIVCTL
                       8         DIVCTL    0          PLL Input Clock Division Value Control
                                                      0 = Divide by 2
                                                      1 = Divide by 4
         46h           6:4       PGADDR    000        Pager Address
                                                      Pager address bits to access programming
                                                      of K[21:0] and SPLL[6:0]
         46h           3:0       PGDATA    0000       Pager Data
                                                      Pager data bits
        Table 4 PLL Clock Control
Rev 4.0                                                                                         23


                                                                                      WM9713L
   INTEGER N MODE
   The nominal output frequency of the PLL (PLL_OUT) is 98.304MHz which is divided by 4 to achieve a
   nominal system clock of 24.576MHz.
   The integer division ratio (N) is determined by: FPLL_out / FPLL_IN , and is set by N[3:0] and must be in the
   range 5 to 12 for integer N operation (0101 = div by 5, 1100 = div by 12). Note that setting LF=1
   enables a further division by 4 required for input frequencies in the range 2.048MHz – 4.096MHz.
   Integer N mode is selected by setting SDM=0.
   FRACTIONAL N MODE
   Fractional N mode provides a divide resolution of 1/222 and is set by K[21:0] (register 46h, see
   section). The relationship between the required division X, the fractional division K[21:0] and the
   integer division N[3:0] is:
               K  2 22  X  N 
              where 0 < (X – N) < 1 and K is rounded to the nearest whole number.
   For example, if the PLL_IN clock is 13MHz and the desired PLL_OUT clock is 98.304MHz then the
   desired division, X, is 7.5618. So N[3:0] will be 7h and K[21:0] will be 23F488h to produce the desired
   98.304MHz clock (see Table 5).
      INPUT CLOCK (PLL_IN)             DESIRED         DIVISION            FRACTIONAL             INTEGER
                                         PLL          REQUIRED             DIVISION (K)         DIVISION (N)
                                       OUTPUT             (X)
                                      (PLL_OUT)
     2.048MHz                        98.304MHz            48                      0                 12x4*
     4.096MHz                        98.304MHz            24                      0                  6x4*
     12.288MHz                       98.304MHz             8                      0                   8
     13MHz                           98.304MHz          7.5618                 0.5618                 7
     27MHz (13.5MHz)**               98.304MHz          7.2818                 0.2818                 7
     *Divide by 4 enabled in PLL feedback path for low frequency inputs. (LF = 1)
     **Divide by 2 enabled at PLL input for frequencies > 14.4MHz > 38MHz (DIVSEL = 1, DIVCTL = 0)
   Table 5 PLL Modes of Operation
24                                                                                                    Rev 4.0


                                                                                               WM9713L
                 PLL REGISTER PAGE ADDRESS MAPPING
                 The clock division control bits SPLL[6:0] and the PLL fractional N division bits are accessed through
                 register 46h using a sub-page address system. The 3-bit pager address allows 8 blocks of 4-bit data
                 words to be accessed whilst the register address is set to 46h. This means that when register address
                 46h is selected a further 7 cycles of programming are required to set all of the page data bits. Control
                 bit allocation for these page addresses is described in Table 6.
                       PAGE            BIT      LABEL       DEFAULT                      DESCRIPTION
                    ADDRESS
                   111               31:28    SPLL[6:4]     0h            Clock division control bus SPLL[6:0]. Clock
                   110               27:24    SPLL[3:0]     0h            divider reads this control word if PLL is
                                                                          enabled. Bits [6:4] and [3:0] have the same
                                                                          functionality as 44h [14:12] and [11:8]
                                                                          respectively
                   101               23:22    Reserved      0h            Reserved bits
                                     21:20    K[21:0]       0h            Sigma Delta Modulator control word for
                   100               19:16                  0h            fractional N division. Division resolution is
                                                                          1/222
                   011               15:12                  0h
                   010               11:8                   0h
                   001               7:4                    0h
                   000               3:0      SPLL[3:0]     0h
                 Table 6 Pager Control Bit Allocation
                 Powerdown for the PLL and internal clocks is via registers 26h and 3Ch (see Table 7).
                    REGISTER           BIT      LABEL       DEFAULT                      DESCRIPTION
                    ADDRESS
                   26h               13       PR5           1 (Off)       Internal Clock Disable Control
                                                                          1 = Disabled
                                                                          0 = Enabled
                   3Ch               9        PLL           1 (Off)       PLL Disable Control
                                                                          1 = Disabled
                                                                          0 = Enabled
                   N.B. both PR5 and PLL must be asserted low before PLL is enabled
                 Table 7 PLL Powerdown Control
DIGITAL INTERFACES
                 The WM9713L has two interfaces, a data and control AC’97 interface and a data only PCM interface.
                 The AC’97 interface is available through dedicated pins (SDATAOUT, SDATAIN, SYNC, BITCLK and
                 RESETB) and is the sole control interface with access to all data streams on the device except for the
                 Voice DAC. The PCM interface is available through the GPIO pins (PCMCLK, PCMFS, PCMDAC and
                 PCMADC) and provides access to the Voice DAC. It can also transmit the data from the Stereo ADC.
                 This can be useful, for example, to allow both sides of a phone conversation to be recorded by mixing
                 the transmit and receive paths on one of the ADC channels and transmitting it over the PCM interface.
Rev 4.0                                                                                                              25


                                                                                            WM9713L
AC97 INTERFACE
               INTERFACE PROTOCOL
               The WM9713L uses an AC’97 interface for both data transfer and control. The AC-Link has 5 wires:
                         SDATAIN (pin 8) carries data from the WM9713L to the controller
                         SDATAOUT (pin 5) carries data from the controller to the WM9713L
                         BITCLK (pin 6) is a clock, derived from either MCLKA or MCLKB inputs and supplied to the
                          controller.
                         SYNC is a synchronization signal generated by the controller and passed to the WM9713L
                         RESETB resets the WM9713L to its default state
                                                 AC-LINK
                                                  SYNC
                    CONTROLLER                   BITCLK                                              ANALOGUE
                                                SDATAIN                  WM9713L                      INPUTS /
                       e.g. CPU                SDATAOUT                                               OUTPUTS
                                                 RESETB
               Figure 12 AC-Link Interface (typical case with BITCLK generated by the AC97 CODEC)
               The SDATAIN and SDATAOUT signals each carry 13 time-division multiplexed data streams (slots 0
               to 12). A complete sequence of slots 0 to 12 is referred to as an AC-Link frame, and contains a total of
               256 bits. The frame rate is 48kHz. This makes it possible to simultaneously transmit and receive
               multiple data streams (e.g. audio, touchpanel, AUXDAC, control) at sample rates up to 48kHz.
               Detailed information can be found in the AC’97 (Revision 2.2) specification, which can be obtained at
               www.intel.com/design/chipsets/audio/
               Note:
               SDATAOUT and SYNC must be held low when RESETB is applied. These signals must be held low
               for the entire duration of the RESETB pulse and especially during the low-to-high transition of
               RESETB. If SDATAOUT or SYNC is high during reset, the WM9713L may enter test modes.
               Information relating to this operation is available in the AC'97 specification and in Application Note
               WAN 0104.
PCM INTERFACE
               OPERATION
               WM9713L can implement a PCM voice CODEC function using the dedicated VXDAC and either one
               or both of the existing hi-fi ADC’s. In PCM CODEC mode, VXDAC input and ADC output are
               interfaced via a PCM style port via GPIO pins.
               This interface can support one ADC channel, or stereo/dual ADC channels if required, (two channels
               of data are sent per PCM frame as back to back words).
               In voice-only mode, the AC link is used only for control information, not audio data. Therefore it will
               generally be shut down (PR4=1), except when control data must be sent.
               The PCM interface makes use of 4 of the GPIO interface pins, for clock, frame, and data in/out. If the
               PCM CODEC function is not enabled then the GPIO pins may be used for other functions.
26                                                                                                          Rev 4.0


                                                                                  WM9713L
        INTERFACE PROTOCOL
        The WM9713L PCM audio interface is used for the input of data to the Voice DAC and the output of
        data from the Stereo ADC. When enabled, the PCM audio interface uses four GPIO pins:
                  GPIO1/PCMCLK: Bit clock
                  GPIO3/PCMFS: Frame Sync
                  GPIO4/PCMDAC: Voice DAC data input
                  GPIO5/PCMADC: Stereo ADC data output
        Depending on the mode of operation (see “PCM Interface Modes”), at least one of these four pins
        must be set up as an output by writing to register 4Ch (see Table 62). When not enabled the GPIOs
        may be used for other functions on the WM9713L.
        PCM INTERFACE MODES
        The WM9713L PCM audio interface may be configured in one of four modes:
                  Disabled Mode: The WM9713L disables and tri-states all PCM interface pins. Any clock
                   input is ignored and ADC/DAC data is not transferred.
                  Slave Mode: The WM9713L accepts PCMCLK and PCMFS as inputs from an external
                   source.
                  Master Mode: The WM9713L generates PCMCLK and PCMFS as outputs.
                  Partial Master Mode: The WM9713L generates PCMCLK as an output, and accepts PCMFS
                   as an external input.
        PCM AUDIO DATA FORMATS
        Four different audio data formats are supported:
                  DSP mode
                  Left justified
                  Right justified
                  I2S
        All four of these modes are MSB first. They are described below. Refer to “Signal Timing
        Requirements” for timing information.
        Note:
        PCMCLK and PCMFS must be synchronized with the BITCLK from the AC’97 interface.
        The PCM Interface may be configured for Mono mode, where only one channel of ADC data is output.
        In this mode the interface should be configured for DSP mode. A short or long frame sync is
        supported and the MSB is available on either the 1st (mode B) or 2nd (mode A) rising edge of VXCLK.
        Note that when operating in stereo mode the mono Voice DAC always uses the left channel data as
        its input.
Rev 4.0                                                                                                 27


                                                                                           WM9713L
                                                                                            1/fs
                               1 PCMCLK
       PCMFS
      PCMCLK
      PCMADC/
                                  1     2       3                   n-2 n-1    n
      PCMDAC
                                MSB                                          LSB
                                                   Input Word Length (WL)
   Figure 13 PCM Interface Mono Mode (mode A, FSP=0)
                                                                                            1/fs
                                1 PCMCLK
        PCMFS
       PCMCLK
       PCMADC/
                           1      2      3                     n-2 n-1     n
       PCMDAC
                         MSB                                             LSB
                                            Input Word Length (WL)
   Figure 14 PCM Interface Mono Mode (mode B, FSP=1)
   In DSP mode, the left channel MSB is available on either the 1st (mode B) or 2nd (mode A) rising
   edge of PCMCLK (selectable by FSP) following a rising edge of PCMFS. Right channel data
   immediately follows left channel data. Depending on word length, PCMCLK frequency and sample
   rate, there may be unused PCMCLK cycles between the LSB of the right channel data and the next
   sample.
                                                                    1/fs
                    1 BCLK / VXCLK
      PCMFS
     PCMCLK
                                 LEFT CHANNEL                       RIGHT CHANNEL
     PCMADC/
                     1   2    3                  n-2 n-1  n  1  2  3             n-2 n-1 n
     PCMDAC
                    MSB                                 LSB
                                Input Word Length (WL)
   Figure 7 DSP Mode Audio Interface (mode A, FSP=0)
28                                                                                               Rev 4.0


                                                                                                      WM9713L
                                                                         1/fs
                          1 BCLK / VXCLK
           PCMFS
          PCMCLK
                                   LEFT CHANNEL                      RIGHT CHANNEL
          PCMADC/
                        1  2   3                  n-2 n-1  n  1  2   3             n-2 n-1  n
          PCMDAC
                       MSB                               LSB
                                 Input Word Length (WL)
        Figure 15 DSP Mode Audio Interface (mode B, FSP=1)
        In Left Justified mode, the MSB is available on the first rising edge of PCMCLK following a PCMFS
        transition. The other bits up to the LSB are then transmitted in order. Depending on word length,
        PCMCLK frequency and sample rate, there may be unused PCMCLK cycles before each PCMFS
        transition.
                                                                          1/fs
                                             LEFT CHANNEL                                  RIGHT CHANNEL
           PCMFS
          PCMCLK
          PCMADC/
                           1   2    3                 n-2 n-1 n                1 2  3              n-2 n-1 n
          PCMDAC
                        MSB                                   LSB        MSB                               LSB
        Figure 16 Left Justified Audio Interface (assuming n-bit word length)
        In Right Justified mode, the LSB is available on the last rising edge of PCMCLK before a PCMFS
        transition. All other bits are transmitted before (MSB first). Depending on word length, PCMCLK
        frequency and sample rate, there may be unused PCMCLK cycles after each PCMFS transition.
                                                                          1/fs
                                              LEFT CHANNEL                                 RIGHT CHANNEL
           PCMFS
          PCMCLK
          PCMADC /
                                         1    2    3            n-2 n-1  n              1   2   3            n-2 n-1  n
          PCMDAC
                                       MSB                              LSB            MSB                           LSB
        Figure 17 Right Justified Audio Interface (assuming n-bit word length)
Rev 4.0                                                                                                                  29


                                                                                   WM9713L
   In I2S mode, the MSB is available on the second rising edge of PCMCLK following a PCMFS
   transition. The other bits up to the LSB are then transmitted in order. Depending on word length,
   PCMCLK frequency and sample rate, there may be unused PCMCLK cycles between the LSB of one
   sample and the MSB of the next.
                                                        1/fs
                                  LEFT CHANNEL                            RIGHT CHANNEL
      PCMFS
     PCMCLK
                        1 BCLK                                  1 BCLK
     PCMADC/
                        1   2  3            n-2 n-1 n           1    2 3             n-2 n-1 n
     PCMDAC
                      MSB                           LSB      MSB                             LSB
   Figure 18 I2S Justified Audio Interface (assuming n-bit word length)
   CONTROL
   The register bits controlling PCM audio format, word length and operating modes are summarised
   below. CTRL must be set to override the normal use of the PCM interface pins as GPIOs, MODE must
   be set to specify master/slave modes.
      REGISTER         BIT       LABEL         DEFAULT                       DESCRIPTION
      ADDRESS
     36h             15        CTRL            0           GPIO Pin Configuration Control
     PCM                                                   0 = GPIO pins as GPIOs
     Control                                               1 = GPIO pins configured as PCM interface
                                                                 and controlled by this register
                     14:13     MODE            10          PCM Interface Mode Control
                                                           00 = PCM interface disabled [PCMCLK tri-
                                                                 stated, PCMFS tri-stated]
                                                           01 = PCM interface in slave mode [PCMCLK
                                                                 as input, PCMFS as input]
                                                           10 = PCM interface in master mode [PCMCLK
                                                                 as output, PCMFS as output]
                                                           11 = PCM interface in partial master mode
                                                                 [PCMCLK as output, PCMFS as input]
                     11:9      DIV             010         PCMCLK Rate Control
                                                           000 = Voice DAC clock
                                                           001 = Voice DAC clock / 2
                                                           010 = Voice DAC clock / 4
                                                           011 = Voice DAC clock / 8
                                                           100 = Voice DAC clock / 16
                                                           All other values are reserved
                     8         VDACOSR         1           Voice DAC Oversampling Rate Control
                                                           0: 128 x fs
                                                           1: 64 x fs
                     7         CP              0           PCMCLK Polarity Control
                                                           0 = Normal
                                                           1 = Inverted
                     6         FSP             0           FMT = 00, 01 or 10           FMT = 11
                                                           PCMFS Polarity               DSP Mode Control
                                                           Control
                                                           0 = Normal                   0 = DSP Mode A
                                                           1 = Inverted                 1 = DSP Mode B
30                                                                                                Rev 4.0


                                                                                 WM9713L
          REGISTER          BIT      LABEL        DEFAULT                     DESCRIPTION
          ADDRESS
                          5:4      SEL            10        PCM ADC Output Channel Control
                                                            00 = Normal stereo
                                                            01 = Reverse stereo
                                                            10 = Output left ADC data only
                                                            11 = Output right ADC data only
                          3:2      WL             00        PCM Data Word Length Control
                                                            00 = 16-bit
                                                            01 = 20-bit
                                                            10 = 24-bit
                                                            11 = 32-bit (not supported when FMT=00)
                          1:0      FMT            11        PCM Data Format Control
                                                            00 = Right justified
                                                            01 = Left justified
                                                            10 = I2S
                                                            11 = DSP mode
        Table 8 PCM CODEC Control
        Note: Right justified does not support 32-bit data.
Rev 4.0                                                                                             31


                                                                                           WM9713L
AUDIO ADCS
STEREO ADC
           The WM9713L has a stereo sigma-delta ADC to digitize audio signals. The ADC achieves high quality
           audio recording at low power consumption. The ADC sample rate can be controlled by writing to a
           control register (see “Variable Rate Audio / Sample Rate Conversion”). It is independent of the DAC
           sample rate.
           To save power, the left and right ADCs can be separately switched off using the Powerdown bits
           ADCL and ADCR (register 3Ch, bits 5:4), whereas PR0 disables both ADCs (see “Power
           Management”). If only one ADC is running, the same ADC data appears on both the left and right AC-
           Link slots.
           The output from the ADC can be sent over either the AC link as usual, or output via the PCM interface
           which may be configured on the GPIO pins.
           HIGH PASS FILTER
           The WM9713L audio ADC incorporates a digital high pass filter that eliminates any DC bias from the
           ADC output data. The filter is enabled by default. For DC measurements, it can be disabled by writing
           a ‘1’ to the HPF bit (register 5Ch, bit 3).
           This high pass filter corner frequency can be selected to have different values in WM9713L, to suit
           applications such as voice where a higher cutoff frequency is required.
              REGISTER          BIT       LABEL          DEFAULT                     DESCRIPTION
               ADDRESS
              5Ch              3         HPF           0               ADC HPF Disable Control
                                                                       0 = HPF enabled (for audio)
                                                                       1 = HPF disabled (for DC measurements)
              5Ah              5:4       HPMODE        00              HPF Cut-Off Control
                                                                       00 = 7Hz @ fs=48kHz
                                                                       01 = 82Hz @ fs=16kHz
                                                                       10 = 82Hz @ fs=8kHz
                                                                       11 = 170Hz @ fs=8kHz
              Note: the filter corner frequency is proportional to the sample rate.
           Table 9 Controlling the ADC High-pass Filter
           ADC SLOT MAPPING
           By default, the output of the left audio ADC appears on slot 3 of the SDATAIN signal (pin 8), and the
           right ADC data appears on slot 4. However, the ADC output data can also be sent to other slots, by
           setting the ASS (ADC slot select) control bits as shown below.
              REGISTER          BIT      LABEL      DEFAULT                         DESCRIPTION
               ADDRESS
              5Ch              1:0       ASS        00             ADC Data Slot Mapping Control
              Additional                                                       Left Data           Right Data
              Functions                                            00 =          Slot 3              Slot 4
              (2)
                                                                   01 =          Slot 7              Slot 8
                                                                   10 =          Slot 6              Slot 9
                                                                   11 =         Slot 10              Slot 11
           Table 10 ADC Slot Mapping
32                                                                                                        Rev 4.0


                                                                                          WM9713L
RECORD SELECTOR
               The record selector determines which input signals are routed into the audio ADC. The left and right
               channels can be selected independently. This is useful for recording a phone call: one channel can be
               used for the RX signal and the other for the TX signal, so that both sides of the conversation are
               digitized.
                 REGISTER        BIT       LABEL        DEFAULT                       DESCRIPTION
                  ADDRESS
                14h             6       RECBST         0               ADC Record Boost Control
                Record                                                 1 = +20dB
                Routing /                                              0 = 0dB
                Mux Select
                                                                       Note: RECBST gain is in addition to the
                                                                       microphone pre-amps (MPABST and
                                                                       MPBBST bits) and record gain (GRL and
                                                                       GRR / GRL bits).
                                5:3     RECSL          000             Left Record Mux Source Control
                                                                       000 = MICA (pre-PGA)
                                                                       001 = MICB (pre-PGA)
                                                                       010 = LINEL (pre-PGA)
                                                                       011 = MONOIN (pre-PGA)
                                                                       100 = HPMIXL
                                                                       101 = SPKMIC
                                                                       110 = MONOMIX
                                                                       111 = Reserved
                                2:0     RECSR          000             Right Record Mux Source Control
                                                                       000 = MICA (pre-PGA)
                                                                       001 = MICB (pre-PGA)
                                                                       010 = LINEL (pre-PGA)
                                                                       011 = MONOIN (pre-PGA)
                                                                       100 = HPMIXL
                                                                       101 = SPKMIC
                                                                       110 = MONOMIX
                                                                       111 = Reserved
               Table 11 Audio Record Selector
Rev 4.0                                                                                                          33


                                                                                         WM9713L
RECORD GAIN
            The amplitude of the signal that enters the audio ADC is controlled by the Record PGA
            (Programmable Gain Amplifier). The PGA gain can be programmed either by writing to the Record
            Gain register, or by the Automatic Level Control (ALC) circuit (see page 35). If the ALC is enabled,
            any writes to the Record Gain register have no effect.
            Two different gain ranges can be implemented: the standard gain range defined in the AC’97
            standard, or an extended gain range with smaller gain steps. The ALC circuit always uses the
            extended gain range, as this has been found to result in better sound quality.
               REGISTER         BIT      LABEL        DEFAULT                      DESCRIPTION
               ADDRESS
              12h             15       RMU           1              Audio ADC Input Mute Control
              Record Gain                                           1 = Mute
                                                                    0 = No mute
                                                                    Note: This control applies to both channels
                              14       GRL           0              Left ADC PGA Gain Range Control
                                                                    1 = Extended
                                                                    0 = Standard
                              13:8     RECVOLL       000000         Left ADC Recording Volume Control
                                                                    Standard (GRL=0)        Extended (GRL=1)
                                                                    XX0000: 0dB             000000: -17.25dB
                                                                    XX0001: +1.5dB          000001: -16.5dB
                                                                    … (1.5dB steps)         … (0.75dB steps)
                                                                    XX1111: +22.5dB         111111: +30dB
                              7        ZC            0              ADC PGA Zero Cross Control
                                                                    1 = Zero cross enabled (volume changes
                                                                    when signal is zero or after time-out)
                                                                    0 = Zero cross disabled (volume changes
                                                                    immediately)
                              6        GRR           0              Right ADC PGA Gain Range Control
                                                                    1 = Extended
                                                                    0 = Standard
                              5:0      RECVOLR       000000         Right ADC Recording Volume Control
                                                                    Standard (GRR=0)        Extended (GRR=1)
                                                                    XX0000 = 0dB            000000 = -17.25dB
                                                                    … (1.5dB steps)         … (0.75dB steps)
                                                                    XX1111 = +22.5dB        XX1111 = +30dB
            Table 12 Record Gain Register
            The output of the Record PGA can also be mixed into the phone and/or headphone outputs (see
            “Audio Mixers”). This makes it possible to use the ALC function for the microphone signal in a
            smartphone application.
34                                                                                                         Rev 4.0


                                                                                               WM9713L
                    REGISTER         BIT      LABEL         DEFAULT                        DESCRIPTION
                    ADDRESS
                  14h              15:14     R2H            11 (mute)     Record Mux to Headphone Mixer Path
                  Record                                                  Control
                  Routing                                                 00 = stereo
                                                                          01 = left ADC only
                                                                          10 = right ADC only
                                                                          11=mute left and right
                                   13:11     R2HVOL         010 (0dB)     Record Mux to Headphone Mixer Path
                                                                          Volume Control
                                                                          000 = +6dB
                                                                          … (+3dB steps)
                                                                          111 = -15dB
                                   10:9      R2M            11 (mute)     Record Mux to Mono Mixer Path Control
                                                                          00 = stereo
                                                                          01 = left record mux only
                                                                          10 = right record mux only
                                                                          11 = mute left and right
                                   8         R2MBST         0 (OFF)       Record Mux to Headphone Mixer Boost
                                                                          Control
                                                                          1 = +20dB
                                                                          0 = 0dB
                Table 13 Record PGA Routing Control
AUTOMATIC LEVEL CONTROL
                The WM9713L has an automatic level control that aims to keep a constant recording volume
                irrespective of the input signal level. This is achieved by continuously adjusting the PGA gain so that
                the signal level at the ADC input remains constant. A digital peak detector monitors the ADC output
                and changes the PGA gain if necessary.
                   input
                  signal
                   PGA
                    gain
                  signal                                                                 ALC
                   after                                                                target
                   ALC                                                                   level
                                        hold  decay               attack
                                        time   time                time
                Figure 19 ALC Operation
                The ALC function is enabled using the ALCSEL control bits. When enabled, the recording volume can
                be programmed between –6dB and –28.5dB (relative to ADC full scale) using the ALCL register bits.
                HLD, DCY and ATK control the hold, decay and attack times, respectively.
Rev 4.0                                                                                                             35


                                                                                 WM9713L
   HOLD TIME
   Hold time is the time delay between the peak level detected being below target and the PGA gain
   beginning to ramp up. It can be programmed in power-of-two (2n) steps, e.g. 2.67ms, 5.33ms,
   10.67ms etc. up to 43.7s. Alternatively, the hold time can also be set to zero. The hold time only
   applies to gain ramp-up, there is no delay before ramping the gain down when the signal level is
   above target.
   DECAY (GAIN RAMP-UP) TIME
   Decay time is the time that it takes for the PGA gain to ramp up across 90% of its range (e.g. from
   –15B up to 27.75dB). The time it takes for the recording level to return to its target value therefore
   depends on both the decay time and on the gain adjustment required. If the gain adjustment is small,
   it will be shorter than the decay time. The decay time can be programmed in power-of-two (2n) steps,
   from 24ms, 48ms, 96ms, etc. to 24.58s.
   ATTACK (GAIN RAMP-DOWN) TIME
   Attack time is the time that it takes for the PGA gain to ramp down across 90% of its range (e.g. from
   27.75dB down to –15B gain). The time it takes for the recording level to return to its target value
   therefore depends on both the attack time and on the gain adjustment required. If the gain adjustment
   is small, it will be shorter than the attack time. The attack time can be programmed in power-of-two
   (2n) steps, from 6ms, 12ms, 24ms, etc. to 6.14s.
   When operating in stereo, the peak detector takes the maximum of left and right channel peak values,
   and any new gain setting is applied to both left and right PGAs, so that the stereo image is preserved.
   However, the ALC function can also be enabled on one channel only. In this case, only one PGA is
   controlled by the ALC mechanism, while the other channel runs independently with its PGA gain set
   through the control register.
   When one ADC channel is unused, the peak detector disregards that channel. The ALC function can
   also operate when the two ADC outputs are mixed to mono in the digital domain, but not if they are
   mixed to mono in the analogue domain, before entering the ADCs.
36                                                                                               Rev 4.0


                                                                                    WM9713L
          REGISTER          BIT        LABEL          DEFAULT                   DESCRIPTION
          ADDRESS
         62h              15:14    ALCSEL             00         ALC Function Channel Control
         ALC / Noise                                  (OFF)      00 = ALC disabled
         Gate Control                                            01 = ALC on right channel only
                                                                 10 = ALC or left channel only
                                                                 11 = ALC on both left and right channels
                          13:11    MAXGAIN            111        ALC PGA Gain Limit Control
                                                      (+30dB)    000 = -12dB
                                                                 … (6dB steps)
                                                                 111 = +30dB
                          10:9     ZCTIMEOUT          11         ALC Zero Cross Timeout Delay
                                                                 Control
                                                                 00 = 214 x tBITCLK (1.33ms)
                                                                 01 = 215 x tBITCLK (2.67ms)
                                                                 10 = 216 x tBITCLK (5.33ms)
                                                                 11 = 217 x tBITCLK (10.67ms)
                                                                 Note: Timeout delay values shown when
                                                                 BITCLK=12.288MHz
         60h              15:12    ALCL               1011       ALC Target Level Control
         ALC Control                                  (-12dB)    0000 = -28.5dBFS
                                                                 … (1.5dB steps)
                                                                 1111 = -6dBFS
                                                                 Note: This is the target signal level at
                                                                 the ADC input
                          11:8     HLD                0000       ALC Hold Time Control
                                                      (0ms)      0000 = 0ms
                                                                 0001 = 2.67ms
                                                                 … (time doubles with every step)
                                                                 1111 = 43.691s
                          7:4      DCY                0011       ALC Decay Time Control
                                                      (192ms)    0000 = 24ms
                                                                 … (time doubles with every step)
                                                                 1010 to 1111 = 24.58s
                          3:0      ATK                0010       ALC Attack Time Control
                                                      (24ms)     0000 = 6ms
                                                                 … (time doubles with every step)
                                                                 1010 to 1111 = 6.14s
        Table 14 ALC Control
        MAXIMUM GAIN
        The MAXGAIN register sets the maximum gain value that the PGA can be set to whilst under the
        control of the ALC. This has no effect on the PGA when ALC is not enabled.
Rev 4.0                                                                                                   37


                                                                                  WM9713L
   PEAK LIMITER
   To prevent clipping when a large signal occurs just after a period of quiet, the ALC circuit includes a
   limiter function. If the ADC input signal exceeds 87.5% of full scale (–1.16dB), the PGA gain is ramped
   down at the maximum attack rate (as when ATK = 0000), until the signal level falls below 87.5% of full
   scale. This function is automatically enabled whenever the ALC is enabled.
   (Note: If ATK = 0000, then the limiter makes no difference to the operation of the ALC. It is designed
   to prevent clipping when long attack times are used).
   NOISE GATE
   When the signal is very quiet and consists mainly of noise, the ALC function may cause “noise
   pumping”, i.e. loud hissing noise during silence periods. The WM9713L has a noise gate function that
   prevents noise pumping by comparing the signal level at the input pins (i.e. before the record PGA)
   against a noise gate threshold, NGTH. Provided that the noise gate function is enabled (NGAT = 1),
   the noise gate cuts in when:
         Signal level at ADC [dB] < NGTH [dB] + PGA gain [dB] + Mic Boost gain [dB]
   This is equivalent to:
         Signal level at input pin [dB] < NGTH [dB]
   The PGA gain is then held constant (preventing it from ramping up as it normally would when the
   signal is quiet). If the NGG bit is set, the ADC output is also muted when the noise gate cuts in.
   Table 15 summarises the noise gate control register. The NGTH control bits set the noise gate
   threshold with respect to the ADC full-scale range. The threshold is adjusted in 1.5dB steps. Levels at
   the extremes of the range may cause inappropriate operation, so care should be taken with set–up of
   the function. Note that the noise gate only works in conjunction with the ALC function, and always
   operates on the same channel(s) as the ALC (left, right, both, or none).
      REGISTER            BIT       LABEL        DEFAULT                     DESCRIPTION
      ADDRESS
     62h                7        NGAT            0             Noise Gate Enable Control
     ALC / Noise                                               0 = Disabled
     Gate Control                                              1 = Enabled
                        5        NGG             0             Noise Gate Function Control
                                                               0 = Hold PGA gain at last value
                                                               1 = Mute ADC output
                        4:0      NGTH(4:0)       00000         Noise Gate Threshold Control
                                                               00000 = -76.5dBFS
                                                               … (1.5dB steps)
                                                               11111 = -30dBFS
   Table 15 Noise Gate Control
38                                                                                                Rev 4.0


                                                                                          WM9713L
AUDIO DACS
STEREO DAC
           The WM9713L has a stereo sigma-delta DAC that achieves high quality audio playback at low power
           consumption. Digital tone control, adaptive bass boost and 3-D enhancement functions operate on the
           digital audio data before it is passed to the stereo DAC. (Contrary to the AC’97 specification, they
           have no effect on analogue input signals or signals played through the auxiliary DAC. Nevertheless,
           the ID2 and ID5 bits in the reset register, 00h, are set to ‘1’ to indicate that the WM9713L supports
           tone control and bass boost.)
           The DAC output has a PGA for volume control. The DAC sample rate can be controlled by writing to a
           control register (see “Variable Rate Audio / Sample Rate Conversion”). It is independent of the ADC
           sample rate.
           When not in use the DACs can be separately powered down using the Powerdown register bits DACL
           and DACR (register 3Ch, bits [7:6]).
           STEREO DAC VOLUME
           The volume of the DAC output signal is controlled by a PGA (Programmable Gain Amplifier). Each
           DAC can be mixed into the headphone, speaker and mono mixer paths (see “Audio Mixers”)
           controlled by register 0Ch.
           Each DAC-to-mixer path has an independent mute bit. When all DAC-to-mixer paths are muted the
           DAC PGA is muted automatically.
           When not in use the DAC PGAs can be powered down using the Powerdown register bits DACL and
           DACR (register 3Ch, bits [7:6]).
              REGISTER          BIT       LABEL      DEFAULT                        DESCRIPTION
              ADDRESS
             0Ch              15       D2H           1             DAC to Headphone Mixer Mute Control
             DAC                                                   1 = Mute
             Volume                                                0 = No mute
                              14       D2S           1             DAC to Speaker Mixer Mute Control
                                                                   1 = Mute
                                                                   0 = No mute
                              13       D2M           1             DAC to Mono Mixer Mute Control
                                                                   1 = Mute
                                                                   0 = No mute
                              12:8     DACL          01000         Left DAC to Mixers Volume Control
                                       VOL           (0dB)         00000 = +12dB
                                                                   … (1.5dB steps)
                                                                   11111 = -34.5dB
                              4:0      DACR          01000         Right DAC to Mixers Volume Control
                                       VOL           (0dB)         00000 = +12dB
                                                                   … (1.5dB steps)
                                                                   11111 = -34.5dB
             5Ch              15       AMUTE         0             DAC Automute Status (Read-Only)
             Additional                                            0 = DAC not muted
             Functions                                             1 = DAC auto-muted
             (2)
                              7        AMEN          0             DAC Automute Control
                                                                   0 = Disabled
                                                                   1 = Enabled (DAC automatically muted when
                                                                   digital input is zero)
           Table 16 Stereo DAC Volume Control
Rev 4.0                                                                                                      39


                                                                                   WM9713L
   TONE CONTROL / BASS BOOST
   The WM9713L provides separate controls for bass and treble with programmable gains and filter
   characteristics. This function operates on digital audio data before it is passed to the audio DACs.
   Bass control can take two different forms:
             Linear bass control: bass signals are amplified or attenuated by a user programmable gain.
              This is independent of signal volume, and very high bass gains on loud signals may lead to
              signal clipping.
             Adaptive bass boost: The bass volume is amplified by a variable gain. When the bass
              volume is low, it is boosted more than when the bass volume is high. This method is
              recommended because it prevents clipping, and usually sounds more pleasant to the
              human ear.
   Treble control applies a user programmable gain, without any adaptive boost function.
   Treble, linear bass and 3D enhancement can all produce signals that exceed full-scale. In order to
   avoid limiting under these conditions, it is recommended to set the DAT bit to attenuate the digital
   input signal by 6dB. The gain at the outputs should be increased by 6dB to compensate for the
   attenuation. Cut-only tone adjustment (i.e. bass and treble gains ≤ 0) and adaptive bass boost cannot
   produce signals above full-scale and therefore do not require the DAT bit to be set.
       REGISTER           BIT     LABEL     DEFAULT                          DESCRIPTION
       ADDRESS
      20h                15      BB         0              Bass Mode Control
      DAC Tone                                             0 = Linear bass control
      Control                                              1 = Adaptive bass boost
                         12      BC         0              Bass Cut-off Frequency Control
                                                           0 = Low (130Hz at 48kHz sampling)
                                                           1 = High (200Hz at 48kHz sampling)
                         11:8    BASS       1111 (off)     Bass Intensity Control
                                                           BB=0                      BB=1
                                                           0000 = +9dB               0000 = 15dB
                                                           0001 = +9dB               … (1dB steps)
                                                           … (1.5dB steps)           1110 = 1dB
                                                           0111 = 0dB                1111 = Bypass (off)
                                                           … (1.5dB steps)
                                                           1011-1110 = -6dB
                                                           1111 = Bypass (off)
                         6       DAT        0              Pre-DAC Attenuation Control
                                                           0 = 0dB
                                                           1 = -6dB
                         4       TC         0              Treble Cut-off Frequency Control
                                                           0 = High (8kHz at 48kHz sampling)
                                                           1 = Low (4kHz at 48kHz sampling)
                         3:0     TRBL       1111           Treble Intensity Control
                                            (Disabled)     0000 = +9dB
                                                           0001 = +9dB
                                                           … (1.5dB steps)
                                                           0111 = 0dB
                                                           … (1.5dB steps)
                                                           1011-1110 = -6dB
                                                           1111 = Bypass (off)
   Table 17 DAC Tone Control
   Note:
   1.   All cut-off frequencies change proportionally with the DAC sample rate.
40                                                                                                 Rev 4.0


                                                                                       WM9713L
          3D STEREO ENHANCEMENT
          The 3D stereo enhancement function artificially increases the separation between the left and right
          channels by amplifying the (L-R) difference signal in the frequency range where the human ear is
          sensitive to directionality. The programmable 3D depth setting controls the degree of stereo
          expansion introduced by the function. Additionally, the upper and lower limits of the frequency range
          used for 3D enhancement can be selected using the 3DFILT control bits.
             REGISTER           BIT       LABEL          DEFAULT                   DESCRIPTION
             ADDRESS
           40h                 13      3DE               0             3D Enhancement Control
           General                                       (disabled)    1 = Enabled
           Purpose                                                     0 = Disabled
           1Eh                 5       3DLC              0             3D Lower Cut-off Frequency Control
           DAC 3D                                                      1 = High (500Hz at 48kHz sampling)
           Control                                                     0 = Low (200Hz at 48kHz sampling)
                               4       3DUC              0             3D Upper Cut-off Frequency Control
                                                                       1 = Low (1.5kHz at 48kHz sampling)
                                                                       0 = High (2.2kHz at 48kHz sampling)
                               3:0     3DDEPTH           0000          3D Depth Control
                                                                       0000 = 0%
                                                                       … (6.67% steps)
                                                                       1111 = 100%
          Table 18 Stereo Enhancement Control
          Note:
          1.   All cut-off frequencies change proportionally with the DAC sample rate.
VOICE DAC
          VXDAC is a 16-bit mono DAC intended for playback of Rx voice signals input via the PCM interface.
          Performance has been optimised for operating at 8ks/s or 16ks/s. The VXDAC will function at other
          sample rates up to 48ks/s, but this is not recommended.
          The analogue output of VXDAC is routed directly into the output mixers. The signal gain into each
          mixer can be adjusted at the mixer inputs using control register 18h.
          When not in use the VXDAC can be powered down using the Powerdown register bit VXDAC (register
          3Ch, bit 12).
Rev 4.0                                                                                                      41


                                                                                           WM9713L
                   REGISTER             BIT        LABEL        DEFAULT               DESCRIPTION
                   ADDRESS
                3Ch                   12        VXDAC          1           VXDAC Disable Control
                Powerdown (1)                                              1 = Disabled
                                                                           0 = Enabled
                18h                   15        V2H            1           VXDAC to Headphone Mixer Mute
                VXDAC Output                                               Control
                Control                                                    1 = Mute
                                                                           0 = No mute
                                      14:12     V2HVOL         010         VXDAC to Headphone Mixer Volume
                                                               (0dB)       Control
                                                                           000 = +6dB
                                                                           … (+3dB steps)
                                                                           111 = -15dB
                                      11        V2S            1           VXDAC to Speaker Mixer Mute
                                                                           Control
                                                                           1 = Mute
                                                                           0 = No mute
                                      10:8      V2SVOL         010         VXDAC to Speaker Mixer Volume
                                                               (0dB)       Control
                                                                           000 = +6dB
                                                                           … (+3dB steps)
                                                                           111 = -15dB
                                      7         V2M            1           VXDAC to Mono Mixer Mute Control
                                                                           1 = Mute
                                                                           0 = No mute
                                      6:4       V2MVOL         010         VXDAC to Mono Mixer Volume
                                                               (0dB)       Control
                                                                           000 = +6dB
                                                                           … (+3dB steps)
                                                                           111 = -15dB
              Table 19 VXDAC Control
              Note:
              1.    In order to minimise power consumption, the following sequence should be executed before
                    disabling the Voice DAC:
                        R44h = 0280h           Run Voice DAC at fs=48 kHz
                        wait at least 3 AC link frames for mode to change
                        R44h = 0F80h           Run Voice DAC at fs=6 kHz
                        R3Ch: bit 12 = 1       Disable Voice DAC. This write must occur immediately after the
                                                write to register R44h.
AUXILIARY DAC
              AUXDAC is a simple 12-bit mono DAC. It can be used to generate DC signals (with the numeric input
              written into a control register), or AC signals such as telephone-quality ring tones or system beeps
              (with the input signal supplied through an AC-Link slot). In AC mode (XSLE = 1), the input data is
              binary offset coded; in DC mode (XSLE = 0), there is no offset.
              The analogue output of AUXDAC is routed directly into the output mixers. The signal gain into each
              mixer can be adjusted at the mixer inputs using control register 12h. In slot mode (XSLE = 1), the
              AUXDAC also supports variable sample rates (See “Variable Rate Audio / Sample Rate Conversion”).
              When not in use the auxiliary DAC can be powered down using the Powerdown register bit AUXDAC
              (register 3Ch, bit 11).
42                                                                                                          Rev 4.0


                                                                 WM9713L
           REGISTER        BIT   LABEL DEFAULT             DESCRIPTION
            ADDRESS
         3Ch             11     AUXDAC 0       AUXDAC Disable Control
         Powerdown (1)                         1 = Disabled
                                               0 = Enabled
         64h             15     XSLE   0       AUXDAC Input Select Control
         AUXDAC Input                          0 = From AUXDACVAL[11:0] (for DC
         Control                               signals)
                                               1 = From AC-Link (for AC signals)
                         14:12  AUXDAC 000     AUXDAC Input Control (XSLE=1)
                                SLT            000 = Slot 5, bits 8-19
                                               001 = Slot 6, bits 8-19
                                               010 = Slot 7, bits 8-19
                                               011 = Slot 8, bits 8-19
                                               100 = Slot 9, bits 8-19
                                               101 = Slot 10, bits 8-19
                                               110 = Slot 11, bits 8-19
                                               111 = Reserved
                         11:0   AUXDAC 000h    AUXDAC Input Control (XSLE=0)
                                VAL            000h = Minimum
                                               FFFh = Full scale
         1Ah             15     A2H    1       AUXDAC to Headphone Mixer Mute
         AUXDAC Output                         Control
         Control                               1 = Mute
                                               0 = No mute
                         14:12  A2HVOL 010     AUXDAC to Headphone Mixer
                                       (0dB)   Volume Control
                                               000 = +6dB
                                               … (+3dB steps)
                                               111 = -15dB
                         11     A2S    1       AUXDAC to Speaker Mixer Mute
                                               Control
                                               1 = Mute
                                               0 = No mute
                         10:8   A2SVOL 010     AUXDAC to Speaker Mixer Volume
                                       (0dB)   Control
                                               000 = +6dB
                                               … (+3dB steps)
                                               111 = -15dB
                         7      A2M    1       AUXDAC to Mono Mixer Mute
                                               Control
                                               1 = Mute
                                               0 = No mute
                         6:4    A2MVOL 010     AUXDAC to Mono Mixer Volume
                                       (0dB)   Control
                                               000 = +6dB
                                               … (+3dB steps)
                                               111 = -15dB
        Table 20 AUXDAC Control
Rev 4.0                                                                          43


                                                                                             WM9713L
VARIABLE RATE AUDIO / SAMPLE RATE CONVERSION
               By using an AC’97 Rev2.2 compliant audio interface, the WM9713L can record and playback at all
               commonly used audio sample rates, and offer full split-rate support (i.e. the DAC, ADC and AUXDAC
               sample rates are completely independent of each other – any combination is possible).
               The default sample rate is 48kHz. If the VRA bit in register 2Ah is set, then other sample rates can be
               selected by writing to registers 2Ch, 32h and 2Eh. The AC-Link continues to run at 48k frames per
               second irrespective of the sample rate selected. However, if the sample rate is less than 48kHz, then
               some frames do not carry an audio sample.
                   REGISTER           BIT       LABEL       DEFAULT                       DESCRIPTION
                   ADDRESS
                  2Ah             0             VRA       0 (OFF)           Variable Rate Audio Control
                  Extended                                                  1 = Enable VRA
                  Audio                                                     0 = Disable VRA (ADC and DAC run at
                  Stat/Ctrl                                                 48kHz)
                                                                            Note: When VRA=1, sample rates are
                                                                            controlled by 2Ch, 2Eh and 32h
                  2Ch             15:0          DACSR     BB80h             Stereo DAC Sample Rate Control
                  Audio DAC                               (48kHz)           1F40h = 8kHz
                  Sample Rate                                               2B11h = 11.025kHz
                                                                            2EE0h = 12kHz
                                                                            3E80h = 16kHz
                                                                            5622h = 22.05kHz
                                                                            5DC0h = 24kHz
                                                                            7D00h = 32kHz
                                                                            AC44h = 44.1kHz
                                                                            BB80h = 48kHz
                                                                            Any other value defaults to the nearest
                                                                            supported sample rate
                  32h             15:0          ADCSR     BB80h             Stereo ADC Sample Rate Control
                  Audio ADC                               (48kHz)           Values as DACSR
                  Sample Rate
                  2Eh             15:0          AUXDA     BB80h             AUXDAC Sample Rate Control
                  AUXDAC                        CSR       (48kHz)           Values as DACSR
                  Sample Rate
               Table 21 Audio Sample Rate Control
               Note:
               Changing the ADC and / or DAC sample rate will only be effective if the ADCs and DACs are enabled
               and powered up before the sample rate is changed. This is done by setting the relevant bits in
               registers 26h and 3Ch, as well as the VRA bit in register 2Ah.
               The process is as follows:
               1.    Enable and power up ADCs and or DACs in registers 26h and 3Ch.
               2.    Enable VRA bit in 2Ah, bit 0.
               3.    Change the sample rate in the respective register.
44                                                                                                           Rev 4.0


                                                                                                WM9713L
AUDIO INPUTS
               The following sections give an overview of the analogue audio input pins and their function. See
               Applications Information” for more information on recommended external components.
LINE INPUT
               The LINEL and LINER inputs are designed to record line level signals, and/or to mix into one of the
               analogue outputs.
               Both pins are directly connected to the record selector. The record PGA adjusts the recording volume,
               controlled by register 12h or by the ALC function.
               For analogue mixing, the line input signals pass through a separate PGA, controlled by register 0Ah.
               The signals can be mixed into the headphone, speaker and mono mixer paths (see “Audio Mixers”).
               Each LINE-to-mixer path has an independent mute bit. When all LINE-to-mixer paths are muted the
               line PGA is muted automatically. When the line inputs are not used, the line PGA can be switched off
               to save power (see “Power Management”).
               LINEL and LINER are biased internally to the reference voltage VREF. Whenever the inputs are
               muted or the device placed into standby mode, the inputs remain biased to VREF using special anti-
               thump circuitry to suppress any audible clicks when changing inputs.
                  REGISTER          BIT        LABEL      DEFAULT                         DESCRIPTION
                  ADDRESS
                 0Ah              15         L2H          1              LINE to Headphone Mixer Mute Control
                                                                         1 = Mute
                                                                         0 = No mute
                                  14         L2S          1              LINE to Speaker Mixer Mute Control
                                                                         1 = Mute
                                                                         0 = No mute
                                  13         L2M          1              LINE to Mono Mixer Mute Control
                                                                         1 = Mute
                                                                         0 = No mute
                                  12:8       LINEL        01000          LINEL to Mixers Volume Control
                                             VOL          (0dB)          00000 = +12dB
                                                                         … (1.5dB steps)
                                                                         11111 = -34.5dB
                                  4:0        LINER        01000          LINER to Mixers Volume Control
                                             VOL          (0dB)          00000 = +12dB
                                                                         … (1.5dB steps)
                                                                         11111 = -34.5dB
               Table 22 Line Input Control
               Additionally, line inputs can be used as single-ended microphone inputs through the record mux to
               provide a click-less ALC function by bypassing offset introduced through the microphone pre-amps.
               Note that the line inputs to the mixers should all be deselected if this is input configuration is used.
MICROPHONE INPUT
               MICROPHONE PRE-AMPS
               There are two microphone pre-amplifiers, MPA and MPB, which can be configured in a variety of ways
               to accommodate up to 3 selectable differential microphone inputs or 2 differential microphone inputs
               operating simultaneously for stereo or noise cancellation. The microphone input circuit is shown in
               Figure 20.
Rev 4.0                                                                                                                 45


                                                                                 WM9713L
                                     Vmid
              MIC1
                                            22h:  22h:11-10
                                     Vmid  13-12 00 = +12dB
                                                 11 = +30dB
            MIC2A                                             MICA
                                     Vmid
                                                              MICB
            MIC2B                                  22h:9-8
                                                 00 = +12dB
                                                 11 = +30dB
           MICCM
   Figure 20 Microphone Input Circuit
   The input pins used for the microphones are MIC1, MICCM, MIC2A and MIC2B. Note that input pins
   MIC2A and MIC2B are multi-function inputs and must be configured for use as microphone inputs
   when required. This is achieved using MICCMPSEL[1:0] in register 22h (see Table 23). The input to
   microphone pre-amp A can be selected from any of the three microphone inputs MIC1, MIC2A and
   MIC2B using MPASEL[1:0]. Each pre-amp has independent boost control from +12dB to +30dB in
   four steps. This is controlled by MPABST[1:0] and MPBBST[1:0].
   When not in use each microphone pre-amp can be powered down using the Powerdown register bits
   MPA and MPB (register 3Eh, bits [1:0]). If disabled, the inputs are tied to Vmid (for MIC2A and MIC2B,
   this only applies if they are selected as microphone inputs – otherwise, they are left floating).
      REGISTER           BIT        LABEL        DEFAULT                     DESCRIPTION
      ADDRESS
     22h              15:14      MICCMPSEL       00           MIC2A/MIC2B Pin Function Control
                                                              00 = MIC2A and MIC2B are mic inputs
                                                              01 = MIC2A mic input only
                                                              10 = MIC2B mic input only
                                                              11 = MIC2A and MIC2B are not mic inputs
                      13:12      MPASEL          00           MPA Pre-Amp Source Control
                                                              00 = MIC1
                                                              01 = MIC2A
                                                              10 = MIC2B
                                                              11 = Reserved
                      11:10      MPABST          00           MPA Pre-Amp Volume Control
                                                              00 = +12dB
                                                              01 = +18dB
                                                              10 = +24dB
                                                              11 = +30dB
                      9:8        MPBBST          00           MPB Pre-Amp Volume Control
                                                              As MPABST
   Table 23 Microphone Pre-amp Control
   SINGLE MIC OPERATION
   Up to three microphones can be connected in a single-ended configuration. Any one of the three MICs
   can be selected as the input to MPA using MPASEL[1:0] (Register 22h, bits 13:12). Only the
   microphone on MIC2B can be selected to MPB. Note that MPABST always sets the gain for the
   selected MPA input microphone. If MIC2B is the selected input for MPA it is recommended that MPB
   is disabled.
46                                                                                                   Rev 4.0


                                                                                    WM9713L
        DUAL MIC OPERATION
        Up to two microphones can be connected in a dual differential configuration. This is suitable for stereo
        microphone or noise cancellation applications. Mic1 is connected between the MIC2A and MICCM
        inputs and mic2 is connected between the MIC2B and MICCM inputs as shown in Figure 21.
        Additionally, another microphone can be supported on MIC1 selected through the MPA input mux.
        Note that the microphones can be connected in a single-ended configuration.
                                                           WM9713L
                                                                             +             Vmid
                                       MICBIAS
                                                                             -
            R            R
                                        MIC2A
                                                                                           Vmid
                                                                                           MPAEN
                                                                       -
                           MIC1
                                                                         MPA               MICA
                                                                       +
                                       MICCM
                R
                           MIC2                                        +
                                                                         MPB               MICB
                                                                       -
                                                                                           MPBEN
                                       MIC2B
                                                                                           Vmid
        Figure 21 Dual Microphone Configuration
        MICROPHONE BIASING CIRCUIT
        The MICBIAS output provides a low noise reference voltage suitable for biasing electret type
        microphones and the associated external resistor biasing network. Refer to “Applications Information”
        for recommended external components. The MICBIAS voltage can be altered via MBVOL in register
        22h. When MBVOL=0, MICBIAS=0.9*AVDD and when MBVOL=1, MICBIAS=0.75*AVDD.
        The microphone bias is driven to a dedicated MICBIAS pin 28 and is enabled by MPOP1EN in
        register 22h. It can also be configured to drive out on GPIO8 pin 12 enabled by MPOP2EN in register
        22h.
        When not in use the microphone bias can be powered down using the Powerdown register bit
        MICBIAS (register 3Eh, bit 14).
Rev 4.0                                                                                                      47


                                                                              WM9713L
      REGISTER       BIT       LABEL         DEFAULT                      DESCRIPTION
      ADDRESS
     22h            7       MBOP2EN          0 (Off)        MICBIAS Output 2 Enable Control
                                                            1 = Enable MICBIAS output on GPIO8 (pin
                                                            12)
                                                            0 = Disable MICBIAS output on GPIO8 (pin
                                                            12)
                    6       MBOP1EN          1 (On)         MICBIAS Output 1 Enable Control
                                                            1 = Enable MICBIAS output on MICBIAS
                                                            (pin 28)
                                                            0 = Disable MICBIAS output on MICBIAS
                                                            (pin 28)
                    5       MBVOL            0              MICBIAS Output Voltage Control
                                                            1 = 0.75 x AVDD
                                                            0 = 0.9 x AVDD
   Table 24 Microphone Bias Voltage Control
   The internal MICBIAS circuitry is shown in Figure 22. Note that the maximum source current capability
   for MICBIAS is 3mA. The external biasing resistors therefore must be large enough to limit the
   MICBIAS current to 3mA.
    CAP2
                                                  MICBIAS
                                                   = 1.8 x CAP2
                                                    = 0.9 X AVDD
                  WM9713L
                                     AGND
   Figure 22 Microphone Bias Schematic
   MICBIAS CURRENT DETECT
   The WM9713L includes a microphone bias current detect circuit with programmable thresholds for the
   microphone bias current, above which an interrupt will be triggered. There are two separate interrupt
   bits, MICDET to e.g. distinguish between one or two microphones connected to the WM9713L, and
   MICSHT to detect a shorted microphone (mic button press). The microphone current detect threshold
   is set by MCDTHR[2:0], for MICDET, and MCDSCTHR[1:0] for MICSHT. Thresholds for each code
   are shown in Table 25
   When not in use the microphone bias current detect circuit can be powered down using the
   Powerdown register bit MCD (register 3Eh, bit 15).
   See the GPIO and Interrupt Controller sections for details on the interrupt and status readback for
   these MICBIAS current detection features.
48                                                                                           Rev 4.0


                                                                                   WM9713L
           REGISTER         BIT       LABEL     DEFAULT                     DESCRIPTION
           ADDRESS
          22h            4:2        MCDTHR      000           Mic Detect Threshold Control
                                                              000 = 100µA
                                                              … (100µA steps)
                                                              111 = 800µA
                                                              Note: These values are for 3.3V supply and
                                                              scale with supply voltage (AVDD).
                         1:0        MCDSCTR     00            Mic Detect Short Circuit Threshold
                                                              Control
                                                              00 = 600µA
                                                              01 = 1200uA
                                                              10 = 1800uA
                                                              11 = 2400µA
                                                              Note: These values are for 3.3V supply and
                                                              scale with supply voltage (AVDD).
        Table 25 Microphone Current Detect Control
        MICROPHONE PGAS
        The microphone pre-amps MPA and MPB drive into two microphone PGAs whose gain is controlled
        by register 0Eh. The PGA signals can be routed into the headphone mixers and the mono mixer, but
        not the speaker mixer (to prevent forming a feedback loop) controlled by register 10h. If the PGA
        signals are not selected as an input to any of the mixers, the outputs of the PGAs are muted
        automatically.
        When not in use the microphone PGAs can be powered down using the Powerdown register bits MA
        and MB (register 3Eh, bits [3:2]).
           REGISTER         BIT       LABEL     DEFAULT                     DESCRIPTION
           ADDRESS
          0Eh             12:8      MICAVOL    01000          MICA PGA Volume Control
          Mic PGA                              (0dB)          00000 = +12dB
          Volume                                              … (1.5dB steps)
                                                              11111 = -34.5dB
                          4:0       MICBVOL    01000          MICB PGA Volume Control
                                               (0dB)          00000 = +12dB
                                                              … (1.5dB steps)
                                                              11111 = -34.5dB
        Table 26 Microphone PGA Volume Control
Rev 4.0                                                                                                 49


                                                                                         WM9713L
               REGISTER         BIT        LABEL        DEFAULT                     DESCRIPTION
                ADDRESS
              10h             7          MA2M           1            MICA to Mono Mixer Mute Control
              MIC Routing                                            1 = Mute
                                                                     0 = No mute
                              6          MB2M           1            MICB to Mono Mixer Mute Control
                                                                     1 = Mute
                                                                     0 = No mute
                              5          MIC2MBST       0            MIC to Mono Mixer Boost Control
                                                                     1 = +20dB
                                                                     0 = 0dB
                              4:3        MIC2H          11           MIC to Headphone Mixer Path Control
                                                                     00 = stereo
                                                                     01 = MICA only
                                                                     10 = MICB only
                                                                     11 = mute MICA and MICB
                              2:0        MIC2HVOL       010          MIC to Headphone Mixer Path Volume
                                                        (0dB)        Control
                                                                     000 = +6dB
                                                                     … (+3dB steps)
                                                                     111 = -15dB
             Table 27 Microphone PGA Routing Control
MONOIN INPUT
             Pin 20 (MONOIN) is a mono input designed to connect to the receive path of a telephony device. The
             pin connects directly to the record selector for phone call recording (Note: to record both sides of a
             phone call, one ADC channel should record the MONOIN signal while the other channel records the
             MIC signal). The record PGA adjusts the recording volume, and is controlled by register 12h or by the
             ALC function (see “Record Gain” and “Automatic Level Control”).
               REGISTER         BIT        LABEL       DEFAULT                      DESCRIPTION
                ADDRESS
              14h             15:14      R2H           11 (mute)    Record Mux to Headphone Mixer Path
              Record                                                Control
              Routing                                               00 = stereo
                                                                    01 = left record mux only
                                                                    10 = right rec mux only
                                                                    11=mute left and right
                              13:11      R2HVOL        010 (0dB)    Record Mux to Headphone Mixer Path
                                                                    Volume Control
                                                                    000 = +6dB
                                                                    … (+3dB steps)
                                                                    111 = -15dB
                              10:9       R2M           11 (mute)    Record Mux to Mono Mixer Path Control
                                                                    00 = stereo
                                                                    01 = left record mux only
                                                                    10 = right record mux only
                                                                    11 = mute left and right
                              8          R2MBST        0 (0dB)      Record Mux to Headphone Mixer Boost
                                                                    Control
                                                                    1 = +20dB
                                                                    0 = 0dB
             Table 28 Record PGA Routing Control
50                                                                                                       Rev 4.0


                                                                                            WM9713L
             To listen to the MONOIN signal, the signal passes through a separate PGA, controlled by register
             08h. The signal can be routed into the headphone mixer (for normal phone call operation) and/or the
             speaker mixer (for speakerphone operation), but not into the mono mixer (to prevent forming a
             feedback loop). When the signal is not selected as an input to any of the mixers the output of the PGA
             is muted automatically.
             When not in use, the MONOIN PGA can be powered down using the Powerdown register bit MOIN
             (register 3Eh, bit 4).
             MONOIN is biased internally to the reference voltage VREF. Whenever the input is muted or the
             device placed into standby mode, the input remains biased to VREF using special anti-thump circuitry
             to suppress any audible clicks when changing inputs.
                REGISTER          BIT        LABEL       DEFAULT                      DESCRIPTION
                 ADDRESS
               08h              15         M2H           1             MONOIN to Headphone Mixer Mute
               MONOIN                                                  Control
               PGA Vol /                                               1 = Mute
               Routing                                                 0 = No mute
                                14         M2S           1             MONOIN to Speaker Mixer Mute Control
                                                                       1 = Mute
                                                                       0 = No mute
                                12:8       MONOIN        01000         MONOIN to Mixers Volume Control
                                           VOL           (0dB)         00000 = +12dB
                                                                       … (1.5dB steps)
                                                                       11111 = -34.5dB
             Table 29 Mono PGA Control
PCBEEP INPUT
             Pin 19 (PCBEEP) is a mono, line level input intended for externally generated signal or warning tones.
             It is routed directly to the record selector and all three output mixers, without an input amplifier. The
             signal gain into each mixer can be independently controlled, with a separate mute bit for each signal
             path.
             PCBEEP is biased internally to the reference voltage VREF. When the signal is not selected as an
             input to any of the mixers the input remains biased to VREF using special anti-thump circuitry to
             suppress any audible clicks when changing inputs.
Rev 4.0                                                                                                             51


                                                                                       WM9713L
                    REGISTER          BIT    LABEL      DEFAULT                   DESCRIPTION
                    ADDRESS
                 16h                15      B2H         1           PCBEEP to Headphone Mixer Mute
                 PCBEEP input                                       Control
                                                                    1 = Mute
                                                                    0 = No mute
                                    14:12   B2HVOL      010         PCBEEP to Headphone Mixer Volume
                                                        (0dB)       Control
                                                                    000 = +6dB
                                                                    … (+3dB steps)
                                                                    111 = -15dB
                                    11      B2S         1           PCBEEP to Speaker Mixer Mute Control
                                                                    1 = Mute
                                                                    0 = No mute
                                    10:8    B2SVOL      010         PCBEEP to Speaker Mixer Volume
                                                        (0dB)       Control
                                                                    000 = +6dB
                                                                    … (+3dB steps)
                                                                    111 = -15dB
                                    7       B2M         1           PCBEEP to Mono Mixer Mute Control
                                                                    1 = Mute
                                                                    0 = No mute
                                    6:4     B2MVOL      010         PCBEEP to Mono Mixer Volume Control
                                                        (0dB)       000 = +6dB
                                                                    … (+3dB steps)
                                                                    111 = -15dB
                Table 30 PCBEEP Control
DIFFERENTIAL MONO INPUT
                PCBEEP and MONOIN inputs can be configured to provide a differential mono input. This is achieved
                by mixing the two inputs together using the headphone mixers or the speaker mixer. Note that the
                gain of the MONOIN PGA must match the gain of the PCBEEP mixer input to achieve a balanced
                differential mono input.
52                                                                                                      Rev 4.0


                                                                                            WM9713L
AUDIO MIXERS
MIXER OVERVIEW
               The WM9713L has four separate low-power audio mixers to cover all audio functions required by
               smartphones, PDAs and handheld computers. These mixers are used to drive the audio outputs HPL,
               HPR, MONO, SPKL, SPKR, OUT3 and OUT4. There are also two inverters used to provide differential
               output signals (e.g. for driving BTL loads)
HEADPHONE MIXERS
               There are two headphone mixers, headphone mixer left and headphone mixer right (HPMIXL and
               HPMIXR). These mixers are the stereo output driver source. They are used to drive the stereo outputs
               HPL and HPR. They can also be used to drive SPKL and SPKR outputs and, when used in
               conjunction with OUT3 and OUT4, they can be configured to drive complementary signals through the
               two output inverters to support bridge-tied load (BTL) stereo loudspeaker outputs. The following
               signals can be mixed into the headphone path:
                         MONOIN (controlled by register 08h, see “Audio Inputs”)
                         LINEL/R (controlled by register 0Ah, see “Audio Inputs”)
                         the output of the Record PGA (controlled by register 14h, see “Audio ADCs”, “Record Gain”)
                         the stereo DAC signal (controlled by register 0Ch, see “Audio DACs”)
                         the MIC signal (controlled by register 10h, see “Audio Inputs”)
                         PC_BEEP (controlled by register 16h, see “Audio Inputs”)
                         the VXDAC signal (controlled by register 18h, see “Audio DACs”)
                         the AUXDAC signal (controlled by register 1Ah, see “Auxiliary DAC”)
               In a typical smartphone application, the headphone signal is a mix of MONOIN / VXDAC and sidetone
               (for phone calls) and the stereo DAC signal (for music playback).
               If not in use, the headphone mixers can be powered down using the Powerdown register bits HPLX
               and HPRX (register 3Ch, bits [3:2]).
SPEAKER MIXER
               The speaker mixer (SPKMIX) is a mono source. It is typically used to drive a mono loudspeaker in
               BTL configuration. The following signals can be mixed into the speaker path:
                         MONOIN (controlled by register 08h, see “Audio Inputs”)
                         LINEL/R (controlled by register 0Ah, see “Audio Inputs”)
                         the stereo DAC signal (controlled by register 0Ch, see “Audio DACs”)
                         PC_BEEP (controlled by register 16h, see “Audio Inputs”)
                         the VXDAC signal (controlled by register 18h, see “Audio DACs”)
                         the AUXDAC signal (controlled by register 1Ah, see “Auxiliary DAC”)
               In a typical smartphone application, the speaker signal is a mix of AUXDAC (for system alerts or ring
               tone playback), MONOIN / VXDAC (for speakerphone function), and PC_BEEP (for externally
               generated ring tones).
               Note that when selected the stereo input pairs LINEL/R and DACL/R are summed and attenuated by -
               6dB so that 0dBFS signals on each channel sum to give a 0dBFS mono signal.
               If not in use, the speaker mixer can be powered down using the Powerdown register bit SPKX
               (register 3Ch, bit 1).
Rev 4.0                                                                                                          53


                                                                                                  WM9713L
MONO MIXER
                The mono mixer drives the MONO pin. The following signals can be mixed into MONO:
                           LINEL/R (controlled by register 0Ah, see “Audio Inputs”)
                           the output of the Record PGA (controlled by register 14h, see “Audio ADCs”, “Record Gain”)
                           the stereo DAC signal (controlled by register 0Ch, see “Audio DACs”)
                           the MIC signal (controlled by register 10h, see “Audio Inputs”)
                           PC_BEEP (controlled by register 16h, see “Audio Inputs”)
                           the VXDAC signal (controlled by register 18h, see “Audio DACs”)
                           the AUXDAC signal (controlled by register 12h, see “Auxiliary DAC”)
                In a typical smartphone application, the MONO signal is a mix of the amplified microphone signal
                (possibly with Automatic Gain Control) and (if enabled) an audio playback signal from the stereo DAC
                or the auxiliary DAC.
                Note that when selected the stereo input pairs LINEL/R and DACL/R are summed and attenuated by -
                6dB so that 0dBFS signals on each channel sum to give a 0dBFS mono signal.
                If not in use, the mono mixer can be powered down using the Powerdown register bit MX (register
                3Ch, bit 0).
MIXER OUTPUT INVERTERS
                There are two general purpose mixer output inverters, INV1 and INV2. Each inverter can be selected
                to drive HPMIXL, HPMIXR, SPKMIX, MONOMIX or { ( HPMIXL + HPMIXR ) / 2 }. The outputs of the
                inverters can be used to generate complimentary signals (to drive BTL configured loads) and to
                provide greater flexibility in output driver configurations. INV1 can be selected as the source for SPKL,
                MONO and OUT3 and INV2 as the source for SPKR and OUT4.
                The input source for each inverter is selected using INV1[2:0] and INV2[2:0] in register 1Eh (see Table
                31). If no input is selected, the inverter is powered down.
                   REGISTER           BIT        LABEL        DEFAULT                     DESCRIPTION
                   ADDRESS
                  1Eh               15:13      INV1           000           INV1 Source Select
                                                              (no input)    000 = No input (tri-stated)
                                                                            001 = MONOMIX
                                                                            010 = SPKMIX
                                                                            011 = HPMIXL
                                                                            100 = HPMIXR
                                                                            101 = HPMIXMONO
                                                                            110 = Reserved
                                                                            111 = VMID
                                    12:10      INV2           000           INV2 Source Select
                                                              (no input)    000 = No input (tri-stated)
                                                                            001 = MONOMIX
                                                                            010 = SPKMIX
                                                                            011 = HPMIXL
                                                                            100 = HPMIXR
                                                                            101 = HPMIXMONO
                                                                            110 = Reserved
                                                                            111 = VMID
                Table 31 Mixer Inverter Source Select
54                                                                                                              Rev 4.0


                                                                                           WM9713L
ANALOGUE AUDIO OUTPUTS
              The following sections give an overview of the analogue audio output pins. The WM9713L has three
              outputs capable of driving loads down to 16 (headphone / line drivers) – HPL, HPR and MONO - and
              four outputs capable of driving loads down to 8 (loudspeaker / line drivers) – SPKL, SPKR, OUT3
              and OUT4. The combination of output drivers, mixers and mixer inverters means that many output
              configurations can be supported.
              For examples of typical output and mixer configurations, see “Typical Output Configurations”. For
              more information on recommended external components, see “Applications Information”.
              Each output is driven by a PGA with a gain range of 0dB to -46.5dB in -1.5dB steps. Each PGA has
              an input source mux, mute and zero-cross detect circuit (delaying gain changes until a zero-cross is
              detected, or after time-out).
HEADPHONE OUTPUTS – HPL AND HPR
              The HPL and HPR outputs (pins 39 and 41) are designed to drive a 16 or 32 headphone load.
              They can also be used as line outputs. They can be used in and AC coupled or DC coupled (capless)
              configuration. The available input sources are HPMIXL/R and Vmid (see Table 32).
                  REGISTER          BIT        LABEL        DEFAULT                   DESCRIPTION
                  ADDRESS
                1Ch                7:6      HPL             00 (Vmid)    HPL Source Control
                Output PGA                                               00 = VMID
                Mux Select                                               01 = No input (tri-stated if HPL is
                                                                         disabled in 3Eh)
                                                                         10 = HPMIXL
                                                                         11 = Reserved
                                   5:4      HPR             00 (Vmid)    HPR Source Control
                                                                         00 = VMID
                                                                         01 = No input (tri-stated if HPR is
                                                                         disabled in 3Eh)
                                                                         10 = HPMIXR
                                                                         11 = Reserved
              Table 32 HPL / HPR PGA Input Source
              The signal volume on HPL and HPR can be independently adjusted under software control by writing
              to register 04h.
              When not in use HPL and HPR can be powered down using the Powerdown register bits HPL and
              HPR (register 3Eh, bits [10:9]). To minimise pops and clicks when the PGA is powered down / up it is
              recommended that the Vmid input is selected during the power down / up cycle. This ensures the
              same DC level is maintained on the output pin throughout.
Rev 4.0                                                                                                       55


                                                                                      WM9713L
                REGISTER         BIT        LABEL       DEFAULT                  DESCRIPTION
                ADDRESS
              04h               15      MUL             1 (Mute)    HPL Mute Control
              Headphone                                             1 = Mute
              Volume                                                0 = No mute
                                14      ZCL             0           HPL Zero Cross Control
                                                                    1 = Zero cross enabled (change volume
                                                                    only on zero crossings, or after time-out)
                                                                    0 = Zero cross disabled (change volume
                                                                    immediately)
                                13:8    HPLVOL          000000      HPL Volume Control
                                                        (0dB)       000000 = 0dB (maximum)
                                                                    … (1.5dB steps)
                                                                    011111 = -46.5dB
                                                                    1xxxxx = -46.5dB
                                7       MUR             1 (Mute)    HPR Mute Control
                                                                    1 = Mute
                                                                    0 = No mute
                                6       ZCR             0           HPR Zero Cross Control
                                                                    1 = Zero cross enabled (change volume
                                                                    only on zero crossings, or after time-out)
                                                                    0 = Zero cross disabled (change volume
                                                                    immediately)
                                5:0     HPRVOL          000000      HPR Volume Control
                                                        (0dB)       000000 = 0dB (maximum)
                                                                    … (1.5dB steps)
                                                                    011111 = -46.5dB
                                                                    1xxxxx = -46.5dB
            Table 33 HPL / HPR PGA Control
MONO OUTPUT
            The MONO output (pin 31) is designed to drive a 16 headphone load and can also be used as a line
            output. The available input sources are MONOMIX, INV1 and Vmid (see Table 34)
                REGISTER          BIT        LABEL      DEFAULT                  DESCRIPTION
                ADDRESS
              1Ch               15:14     MONO          00 (Vmid)   MONO Source Control
              Output PGA                                            00 = VMID
              Mux Select                                            01 = No input (tri-stated if MONO is
                                                                    disabled in 3Eh)
                                                                    10 = MONOMIX
                                                                    11 = INV1
            Table 34 MONO PGA Input Source
            The signal volume on MONO can be independently adjusted under software control by writing to
            register 08h.
            When not in use MONO can be powered down using the Powerdown register bit MONO (register 3Eh,
            bit 13). To minimise pops and clicks when the PGA is powered down / up it is recommended that the
            Vmid input is selected during the power down / up cycle. This ensures the same DC level is
            maintained on the output pin throughout.
56                                                                                                     Rev 4.0


                                                                                            WM9713L
                   REGISTER          BIT       LABEL         DEFAULT                     DESCRIPTION
                   ADDRESS
                 08h                7     MU                 1 (Mute)      MONO Mute Control
                 MONO Vol                                                  1 = Mute
                                                                           0 = No mute
                                    6     ZC                 0             MONO Zero Cross Control
                                                                           1 = Zero cross enabled (change volume
                                                                           only on zero crossings, or after time-out)
                                                                           0 = Zero cross disabled (change volume
                                                                           immediately)
                                    5:0   MONOVOL            000000        MONO Volume Control
                                                             (0dB)         000000 = 0dB (maximum)
                                                                           … (1.5dB steps)
                                                                           011111 = -46.5dB
                                                                           1xxxxx = -46.5dB
               Table 35 Mono PGA Control
SPEAKER OUTPUTS – SPKL AND SPKR
               The SPKL and SPKR (pins 35 and 36) are designed to drive a loudspeaker load down to 8 and can
               also be used as line outputs and headphone outputs. They are designed to drive an 8 load AC
               coupled or in a BTL (capless) configuration. The available input sources are HPMIXL/R, SPKMIXL/R,
               INV1/2 and Vmid (see Table 36).
                   REGISTER           BIT       LABEL        DEFAULT                     DESCRIPTION
                   ADDRESS
                 1Ch                13:11    SPKL            000           SPKL Source Control
                 Output PGA                                  (Vmid)        000 = VMID
                 Mux Select                                                001 = No input (tri-stated if SPKL is
                                                                           disabled in 3Eh)
                                                                           010 = HPMIXL
                                                                           011 = SPKMIX
                                                                           100 = INV1
                                                                           All other values are reserved
                                    10:8     SPKR            000           SPKR Source Control
                                                             (Vmid)        000 = VMID
                                                                           001 = No input (tri-stated if SPKR is
                                                                           disabled in 3Eh)
                                                                           010 = HPMIXR
                                                                           011 = SPKMIX
                                                                           100 = INV2
                                                                           All other values are reserved
               Table 36 SPKL / SPKR PGA Input Source
               The signal volume on SPKL and SPKR can be independently adjusted under software control by
               writing to register 02h.
               When not in use SPKL and SPKR can be powered down using the Powerdown register bits SPKL and
               SPKR (register 3Eh, bits [8:7]). To minimise pops and clicks when the PGA is powered down / up it is
               recommended that the Vmid input is selected during the power down / up cycle. This ensures the
               same DC level is maintained on the output pin throughout.
Rev 4.0                                                                                                             57


                                                                                             WM9713L
                    REGISTER        BIT          LABEL       DEFAULT                    DESCRIPTION
                    ADDRESS
                   02h             15      MUL               1 (Mute)      SPKL Mute Control
                   Speaker                                                 1 = Mute
                   Volume                                                  0 = No mute
                                   14      ZCL               0             SPKL Zero Cross Control
                                                                           1 = Zero cross enabled (change volume
                                                                           only on zero crossings, or after time-out)
                                                                           0 = Zero cross disabled (change volume
                                                                           immediately)
                                   13:8    SPKLVOL           000000        SPKL Volume Control
                                                             (0dB)         000000 = 0dB (maximum)
                                                                           … (1.5dB steps)
                                                                           011111 = -46.5dB
                                                                           1xxxxx = -46.5dB
                                   7       MUR               1 (Mute)      SPKR Mute Control
                                                                           1 = Mute
                                                                           0 = No mute
                                   6       ZCR               0             SPKR Zero Cross Control
                                                                           1 = Zero cross enabled (change volume
                                                                           only on zero crossings, or after time-out)
                                                                           0 = Zero cross disabled (change volume
                                                                           immediately)
                                   5:0     SPKRVOL           000000        SPKR Volume Control
                                                             (0dB)         000000 = 0dB (maximum)
                                                                           … (1.5dB steps)
                                                                           011111 = -46.5dB
                                                                           1xxxxx = -46.5dB
                Table 37 SPKL / SPKR PGA Control
                Note:
                1.    For BTL speaker drive, it is recommended that both PGAs have the same gain setting.
AUXILIARY OUTPUTS – OUT3 AND OUT4
                The OUT3 and OUT4 outputs (pins 37 and 33) are designed to drive a loudspeaker load down to 8
                and can also be used as line outputs and headphone outputs. They are designed to drive an 8 load
                AC coupled or in a BTL (cap-less) configuration and can be used as a mid-rail buffer to drive the
                headphone outputs in a cap-less DC configuration. The available input sources are INV1/2 and Vmid
                (see Table 38).
                    REGISTER        BIT          LABEL       DEFAULT                    DESCRIPTION
                    ADDRESS
                   1Ch             3:2     OUT3              00 (Vmid)     OUT3 Source Control
                   Output PGA                                              00 = VMID
                   Mux Select                                              01 = No input (tri-stated if OUT3 is
                                                                           disabled in 3Eh)
                                                                           10 = INV1
                                                                           11 = Reserved
                                   1:0     OUT4              00 (Vmid)     OUT4 Source Control
                                                                           00 = VMID
                                                                           01 = No input (tri-stated if OUT4 is
                                                                           disabled in 3Eh)
                                                                           10 = INV2
                                                                           11 = Reserved
                Table 38 OUT3 / OUT4 PGA Input Source
58                                                                                                            Rev 4.0


                                                                                  WM9713L
        The signal volume on OUT3 and OUT4 can be independently adjusted under software control by
        writing to register 06h.
        When not in use OUT3 and OUT4 can be powered down using the Powerdown register bits OUT3
        and OUT4 (register 3Eh, bits [11:12]). To minimise pops and clicks when the PGA is powered down /
        up it is recommended that the Vmid input is selected during the power down / up cycle. This ensures
        the same DC level is maintained on the output pin throughout.
            REGISTER          BIT      LABEL         DEFAULT                   DESCRIPTION
            ADDRESS
          06h                15   MU4                1 (Mute)     OUT4 Mute Control
          Speaker                                                 1 = Mute
          Volume                                                  0 = No mute
                             14   ZC4                0            OUT4 Zero Cross Control
                                                                  1 = Zero cross enabled (change volume
                                                                  only on zero crossings, or after time-out)
                                                                  0 = Zero cross disabled (change volume
                                                                  immediately)
                             13:8 OUT4VOL            000000       OUT4 Volume Control
                                                     (0dB)        000000 = 0dB (maximum)
                                                                  … (1.5dB steps)
                                                                  011111 = -46.5dB
                                                                  1xxxxx = -46.5dB
                             7    MU3                1 (Mute)     OUT3 Mute Control
                                                                  1 = Mute
                                                                  0 = No mute
                             6    ZC3                0            OUT3 Zero Cross Control
                                                                  1 = Zero cross enabled (change volume
                                                                  only on zero crossings, or after time-out)
                                                                  0 = Zero cross disabled (change volume
                                                                  immediately)
                             5:0  OUT3VOL            000000       OUT3 Volume Control
                                                     (0dB)        000000 = 0dB (maximum)
                                                                  … (1.5dB steps)
                                                                  011111 = -46.5dB
                                                                  1xxxxx = -46.5dB
        Table 39 OUT3 / OUT4 PGA Control
Rev 4.0                                                                                                    59


                                                                                                                  WM9713L
THERMAL SENSOR
                The speaker and headphone outputs can drive very large currents. To protect the WM9713L from
                becoming too hot, a thermal sensor has been built in. If the chip temperature reaches approximately
                150C, and the TSHUT bit is cleared, and the GP11 bit is set, the WM9713L de-asserts TI, a virtual
                GPIO that can be set up to generate an interrupt to the CPU (see “GPIO and Interrupt Control”).
                   REGISTER          BIT      LABEL     DEFAULT                                              DESCRIPTION
                   ADDRESS
                  3Ch               13       TSHUT      1                       Thermal Sensor Disable Control
                                                        (disabled)              1 = Disabled
                                                                                0 = Enabled
                  4Eh               11       GP11       1                       Thermal Sensor Polarity Control
                                                                                1 = Active Low
                                                                                0 = Active High
                  54h               11       TI         0                       Thermal Sensor Status Bit (Virtual GPIO)
                                                                                See also “GPIO and Interrupt Control” section.
                                                                                GP11 = 1 (default)                 GP11 = 0
                                                                                1 = Temp < 150C                   1 = Temp > 150C
                                                                                0 = Temp > 150C                   0 = Temp < 150C
                Table 40 Thermal Shutdown Control
JACK INSERTION AND AUTO-SWITCHING
                In a phone application, a BTL ear speaker may be connected across MONO and HPL, a stereo
                headphone on HPL and HPR and stereo speakers on SPKL, SPKR, OUT3 and OUT4 (see Figure 23).
                Typically, only one of these three output devices is used at any given time: when no headphone is
                plugged in, the BTL ear speaker or stereo speakers are active, otherwise the headphone is used.
                                               MONO
                                                           Ear Speaker                             Hands-free
                                                           32R                  HP                 32R
                                                                              16/32R
                                                  HPL
                             PHONE               HPR
                              MIXER
                         HEADPHONE              SPKL
                              MIXER
                           SPEAKER
                              MIXER
                                                SPKR              Stereo               Stereo
                                                                  Speaker (R)          Speaker (L)
                                                                  8R                   8R
                                                OUT3
                                                OUT4
                Figure 23 Typical Output Configuration
                The presence of a headphone can be detected using one of GPIO1/6/7/8 (pins 44, 3, 11 & 12) and an
                external pull-up resistor (see Figure 43, page 127 for a circuit diagram). When the jack is inserted, the
                GPIO is pulled low by a switch on the socket. When the jack is removed the GPIO is pulled high by a
                resistor. If the JIEN bit is set, the WM9713L automatically switches between headphone and any other
                output configuration, typically ear speaker or stereo speaker that has been set up in the Powerdown
                and Output PGA Mux Select registers.
60                                                                                                                              Rev 4.0


                                                                                       WM9713L
        Note: Please refer to Application Note WAN 0182 for further information on jack detect configuration.
        In addition to the typical configuration explained above, the WM9713L can also support automatic
        switching between the following three configurations set as BTL ear speaker and headphone.
              REGISTER           BIT        LABEL         DEFAULT                  DESCRIPTION
              ADDRESS
           24h                  1:0      EARSPKSEL         00           Ear Speaker Source Control
           Output Volume                                                00 = Default, no ear speaker
           Mapping (Jack                                                    configuration selected.
           Insert)                                                      01 = MONO and HPL driver selected
                                                                            as BTL ear speaker.
                                                                        10 = OUT3 and HPL driver selected as
                                                                            BTL ear speaker.
                                                                        11 = OUT4 and HPL driver selected as
                                                                            BTL ear speaker.
        Table 41 Ear Speaker Configuration
        For example, if OUT4 and HPL is selected as the BTL ear speaker, the user should select
        EARSPKSEL = 3h, then OUT4 is tri-stated on jack insert to prevent sound across the ear speaker
        during headphone operation and HPL volume is set to OUT4 volume on jack out to ensure correct ear
        speaker operation. It should be noted that all other outputs except HPL, HPR and selected ear
        speaker driver are disabled and internally connected to VREF on jack insert. This maintains VREF at
        those outputs and helps prevent pops when the outputs are enabled.
        Finally if the user wishes to DC couple the headphone outputs the user needs to select between
        OUT3 and OUT4 as the mid-rail output buffer driver. The selected mid-rail output buffer is enabled on
        jack insert. On jack out it defaults to whatever configuration has been set up in the Powerdown and
        Output PGA Mux Select registers.
              REGISTER           BIT       LABEL         DEFAULT                  DESCRIPTION
              ADDRESS
           24h                  3:2      DCDRVSEL        00           Jack Insert Headphone DC Reference
           Output Volume                                              Control
           Mapping (Jack                                              00 = AC coupled headphones, no DC
           Insert)                                                    source
                                                                      01 = OUT3 is mid-rail output buffer
                                                                      10 = Reserved
                                                                      11 = OUT4 is mid-rail output buffer
        Table 42 DC Coupled Headphone Configuration
        In summary:
        JIEN not set: Outputs work as normal as selected in the Powerdown and Output PGA Mux Select
        registers.
        JIEN set: On jack insertion, GPIO1/6/7/8 is pulled low, HPL and HPR are enabled, DCDRVSEL
        decides if the headphones are DC or AC coupled and configures OUT3 or OUT4 to suit, EARSPKSEL
        decides if MONO, OUT3 or OUT4 need to be tri-stated to ensure no sound out on the ear-speaker and
        finally all other outputs are disabled as explained above to prevent pops on re-enabling.
        On jack removal, GPIO1/6/7/8 is pulled high, the outputs work as normal as selected in the
        Powerdown and Output PGA Mux Select registers except that HPL Volume is controlled by
        EARSPKSEL to ensure correct ear speaker operation.
Rev 4.0                                                                                                    61


                                                                          WM9713L
     REGISTER      BIT      LABEL     DEFAULT                    DESCRIPTION
     ADDRESS
    24h Output    4        JIEN       0 (OFF)   Jack Insert Control
    Volume                                      0 = Disable jack insert circuitry
    Mapping
                                                1 = Enable jack insert circuitry
    (Jack
    Insert)
    5Ah           7:6      JSEL       00        Jack Detect Pin Input Control
    Additional                        (GPIO1)   00 = GPIO1
    Functions
                                                01 = GPIO6
    (1)
                                                10 = GPIO7
                                                11 = GPIO8
   Table 43 Jack Insertion / Auto-Switching (1)
62                                                                                Rev 4.0


                                                                                                                                                            WM9713L
             EARSPKSEL    DCDRVSEL                                            HPL STATE     HPL VOLUME     HPR STATE     HPR VOLUME     MONO STATE     OUT3 STATE     OUT4 STATE     SPKL STATE     SPKR STATE
                                                    MODE DESCRIPTION
     JIEN                                GPIO1
 0          XX           XX          X           Jack Insert Detection
                                                                            User          User           User          User           User           User           User           User           User
                                                 Disabled.
                                                                            Controlled    Controlled     Controlled    Controlled     Controlled     Controlled     Controlled     Controlled     Controlled
 1          00           00          0           Jack Insert Detection
                                                                                                                         HPR Volume
                                                 Enabled.
                                                                                            HPL Volume
                                                 Headphone plugged in.
                                                                              Enabled                      Enabled
                                                 No Ear Speaker Selected.
                                                 AC Coupled Headphone
                                                 Selected.                                                                              HZ             HZ             HZ             HZ             HZ
 1          01           00          0           Jack Insert Detection
                                                 Enabled.
                                                                                                                         HPR Volume
                                                 Headphone plugged in.
                                                                                            HPL Volume
                                                 MONO Ear Speaker
                                                                              Enabled                      Enabled                      Tri-Stated
                                                 Selected.
                                                 AC Coupled Headphone
                                                 Selected.                                                                                             HZ             HZ             HZ             HZ
 1          10           00          0           Jack Insert Detection
                                                 Enabled.
                                                                                                                         HPR Volume
                                                 Headphone plugged in.
                                                                                            HPL Volume
                                                 OUT3 Ear Speaker
                                                                              Enabled                      Enabled                                     Tri-Stated
                                                 Selected.
                                                 AC Coupled Headphone
                                                 Selected.                                                                              HZ                            HZ             HZ             HZ
 1          11           00          0           Jack Insert Detection
                                                 Enabled.
                                                                                                                         HPR Volume
                                                 Headphone plugged in.
                                                                                            HPL Volume
                                                 OUT4 Ear Speaker
                                                                              Enabled                      Enabled                                                    Tri-Stated
                                                 Selected.
                                                 AC Coupled Headphone
                                                 Selected.                                                                              HZ             HZ                            HZ             HZ
 1          11           01          0           Jack Insert Detection
                                                 Enabled.
                                                                                                                         HPR Volume
                                                 Headphone plugged in.
                                                                                            HPL Volume
                                                 OUT4 Ear Speaker
                                                                              Enabled                      Enabled                                                    Tri-Stated
                                                 Selected.
                                                                                                                                                       VMID
                                                 OUT3 DC Coupled
                                                 Headphone Selected.                                                                    HZ                                           HZ             HZ
 1          00           XX          1           Jack Insert Detection
                                                                            User          User           User          User           User           User           User           User           User
                                                 Enabled.
                                                 Headphone plugged out.
                                                                            Controlled    Controlled     Controlled    Controlled     Controlled     Controlled     Controlled     Controlled     Controlled
                                                 No Ear Speaker Selected.
 1          11           XX          1           Jack Insert Detection
                                                 Enabled. Headphone
                                                 plugged out.               User                         User          User           User           User           User           User           User
                                                                                          OUT4
                                                                            Controlled                   Controlled    Controlled     Controlled     Controlled     Controlled     Controlled     Controlled
                                                 OUT4 Ear Speaker
                                                 Selected.                                Volume
Table 44 Jack Insertion / Auto-Switching (2)
Rev 4.0                                                                                                                                                                                               63


                                                                                              WM9713L
DIGITAL AUDIO (S/PDIF) OUTPUT
                The WM9713L supports the S/PDIF standard. Pins 48 & 12 can be used to output the S/PDIF data.
                Note that pins 48 & 12 can also be used as GPIO pins. The GE5 & GE8 bits (register 56h, bit 5 & bit
                8) select between GPIO and S/PDIF functionality for pins 48 & 12 respectively (see “GPIO and
                Interrupt Control”).
                Register 3Ah is a read/write register that controls S/PDIF functionality and manages bit fields
                propagated as channel status (or sub-frame in the V case). With the exception of V, this register
                should only be written to when the S/PDIF transmitter is disabled (S/PDIF bit in register 2Ah is ‘0’).
                Once the desired values have been written to this register, the contents should be read back to
                ensure that the sample rate in particular is supported, then S/PDIF validity bit SPCV in register 2Ah
                should be read to ensure the desired configuration is valid. Only then should the S/PDIF enable bit in
                register 2Ah be set. This ensures that control and status information start up correctly at the beginning
                of S/PDIF transmission.
                   REGISTER          BIT     LABEL      DEFAULT                         DESCRIPTION
                   ADDRESS
                  2Ah              10       SPCV        0              S/PDIF Validity Bit (Read Only)
                  Extended                                             1 = Valid
                  Audio                                                0 = Not valid
                                   5:4      SPSA        01             S/PDIF Slot Assignment Control
                                                                       00 = Slots 3 and 4
                                                                       01 = Slots 6 and 9
                                                                       10 = Slots 7 and 8
                                                                       11 = Slots 10 and 11
                                                                       Note: This control is only valid when ADCO=0
                                                                       in 5Ch
                                   2        SEN         0              S/PDIF Output Enable Control
                                                                       1 = Enabled
                                                                       0 = Disabled
                  3Ah              15       V           0              S/PDIF Validity Bit
                  S/PDIF                                               1 = Valid
                  Control                                              0 = Not valid
                  Register
                                   14       DRS         0              Indicates that the WM9713L does not support
                                                                       double rate S/PDIF output (read-only)
                                   13:12    SPSR        10             Indicates that the WM9713L only supports
                                                                       48kHz sampling on the S/PDIF output (read-
                                                                       only)
                                   11       L           0              S/PDIF L-bit Control
                                                                       Programmed as required by user
                                   10:4     CC          0000000        S/PDIF Category Code Control
                                                                       Category code; programmed as required by
                                                                       user
                                   3        PRE         0              S/PDIF Pre-emphasis Indication Control
                                                                       0 = no pre-emphasis
                                                                       1 = 50/15µs pre-emphasis
                                   2        COPY        0              S/PDIF Copyright Indication Control
                                                                       0 = Copyright not asserted
                                                                       1 = Copyright asserted
                                   1        AUDIB       0              S/PDIF Non-audio Indication Control
                                                                       0 = PCM data
                                                                       1 = Non-PCM data (e.g. DD or DTS)
                                   0        PRO         0              S/PDIF Professional Indication Control
                                                                       0 = Consumer mode
                                                                       1 = Professional mode
64                                                                                                              Rev 4.0


                                                                                                    WM9713L
                 REGISTER                      BIT     LABEL     DEFAULT                       DESCRIPTION
                 ADDRESS
                 5Ch                       4           ADCO      0             S/PDIF Data Source Control
                 Additional                                                    0 = From SDATAOUT (pin 5)
                 Function                                                      1 = Output from audio ADC
                 Control
                                                                               Note: Slot selected by SPSA in 2Ah
             Table 45 S/PDIF Output Control
TOUCHPANEL INTERFACE
             The WM9713L includes a touchpanel driver and digitiser circuit for use with 4-wire or 5-wire resistive
             touchpanels. The following functions are implemented:
                    X co-ordinate measurement
                    Y co-ordinate measurement
                    Pen down detection, with programmable sensitivity
                    Touch pressure measurement (4-wire touchpanel only)
                    Auxiliary measurement from COMP1/AUX1 (pin 29), COMP2/AUX2 (pin 30), or WIPER/AUX4
                    (pin 12)
             The touchpanel digitiser uses a very low power, 12-bit successive approximation type ADC. The same
             ADC can also be used for battery and auxiliary measurements (see “Battery Alarm and Analogue
             Comparators” and “Auxiliary ADC Inputs”).
             An on-chip switch matrix connects each touchpanel terminal to the supply voltage TPVDD, to ground
             (TPGND), or to the ADC input, as required.
                                                                         RPU
                              IP                                                  zero power
                                                                                  comparator
                                                                                                PEN
                                                                                               DOWN
                                                                                               SPKVDD
                                                                                        AUX
                                                                                        ADC
                                                                                                    20K
                                                                                         AUX3
                                                                                                   10K
                     TPVDD         TPGND
                                                          X+/BR (14)
                                                            X-/TL (16)
                                                           Y+/TR (15)
                                                            Y-/BL (17)
                                                     WIPER/AUX4 (12)
                                                           AUX1 (29)
                                                           AUX2 (30)
             Figure 24 Touchpanel Switch Matrix
Rev 4.0                                                                                                             65


                                                                                                        WM9713L
PRINCIPLE OF OPERATION – FOUR-WIRE TOUCHPANEL
                Four-wire touchpanels are connected to the WM9713L as follows:
                          Right side contact = X+ (pin 14)
                          Left side contact = X- (pin 16)
                          Top side contact = Y+ (pin 15)
                          Bottom side contact = Y- (pin 17)
                The principle of operation is illustrated in Figure 25 through Figure 28. (Note: the illustrations assume
                that the top plate is used for X and the bottom plate for Y measurements, although the reverse is also
                possible).
                                    pen / finger
                                                 Y+ (15)               WM9713L
                                                               VM = (VREF+ - VREF- ) RX- / (RX- + RX+)
                                                                   = proportional to X position
                                  RX-        RY+
                                                                                             TPVDD
                                             RX+      X+
                                   RY-                           VREF+
                                                     (14)
                                                             VM
                                                                     AUX
                                                                     ADC
                                                 Y- (17)
                                                                  VREF-
                                                 X- (16)
                                                                                             TPGND
                Figure 25 X Co-ordinate Measurement on 4-wire Touchpanel
                For an X co-ordinate measurement, the X+ pin is internally switched to TPVDD and X- to TPGND. The
                X plate becomes a potential divider, and the voltage at the point of contact is proportional to its X co-
                ordinate. This voltage is measured on the Y+ and Y- pins, which carry no current (hence there is no
                voltage drop in RY+ or RY-).
                Due to the ratiometric measurement method, the supply voltage does not affect measurement
                accuracy. The voltage references VREF+ and VREF- are taken from after the matrix switches, so that
                any voltage drop in these switches has no effect on the ADC measurement.
                                    pen / finger
                                                 Y+ (15)
                                                                                             TPVDD
                                                                  VREF+
                                  RX-        RY+             VM      AUX
                                                                                    WM9713L
                                             RX+       X+            ADC
                                   RY-               (14)
                                                                  VREF-
                                                  Y- (17)
                                                                                             TPGND
                                                  X- (16)
                                                                VM = (VREF+ - VREF- ) RY- / (RY- + RY+)
                                                                     = proportional to Y position
                Figure 26 Y Co-ordinate Measurement on 4-wire Touchpanel
                Y co-ordinate measurements are similar to X co-ordinate measurements, with the X and Y plates
                interchanged.
66                                                                                                               Rev 4.0


                                                                                                  WM9713L
                           pen / finger
                                          Y+ (15)              AVDD
                                                                     RPU
                          RX-       RY+
                                    RX+        X+                           PEN
                          RY-                 (14)                          DOWN
                                                              zero power
                                                              comparator
                                           Y- (17)
                                                                  TPGND
                                           X- (16)
                                                            WM9713L
        Figure 27 Pen Down Detection on 4-wire Touchpanel
        Pen down detection uses a zero power comparator (effectively a CMOS logic gate) with an internal,
        programmable pull-up resistor RPU that controls pen-down sensitivity. Increasing RPU makes the
        touchpanel less sensitive to touch, while lowering RPU makes it more sensitive.
        When the touchpanel is not being touched, no current flows in the circuit, and the PENDOWN signal is
        low. When the panel is touched with a pen or finger, current flows through RPU and the panel, and the
        comparator output goes high.
        The PENDOWN signal can be read from bit 15 in register 7Ah (labeled PNDN). It can also be
        observed on pin 46 (GPIO3 / PENDOWN), if the pin is not used for GPIO (GE3=0). Additionally,
        PENDOWN is passed to the GPIO logic block (register 54h, bit 13), where it can generate CPU
        interrupts, and / or to wake up the WM9713L from sleep mode (see “GPIO and Interrupt Control”).
                               pen / finger
                                                Y+ (15)
                                                                          TPVDD
                                                         IP
                                                                       VY- - VX+ = IP RC
                                                             = proportional to contact resistance
                              RX-       RY+
                                        RX+          X+
                              RY-                   (14)
                                                                      AUX
                                                                      ADC
                                                 Y- (17)
                                                 X- (16)                            WM9713L
                                                                    TPGND
        Figure 28 Touch Pressure Measurement on 4-wire Touchpanel
        Touch pressure can be determined indirectly by measuring the contact resistance RC between the top
        and bottom plates. RC decreases as the touch pressure on the panel increases. The WM9713L
        measures RC by sending a constant current IP through the touchpanel and measuring the potential on
        each plate. The two values are subtracted in the digital domain to obtain the potential difference,
        which is proportional to RC.
        To suit different types of touchpanels, the magnitude of IP can be set to either 400A or 200A using
        the PIL control bit.
Rev 4.0                                                                                                   67


                                                                                             WM9713L
PRINCIPAL OF OPERATION – FIVE-WIRE TOUCHPANEL
                Five-wire touchpanels are connected to the WM9713L as follows:
                      Top sheet contact = WIPER/AUX4 (pin 12)
                      Top left corner of bottom sheet = TL (pin 16)
                      Top right corner of bottom sheet = TR (pin 15)
                      Bottom left corner of bottom sheet = BL (pin 17)
                      Bottom right corner of bottom sheet = BR (pin 14)
                                                                VREF+
                                               WIPER (12)   VM
                                                                   AUX
                                                                   ADC
                                                                 VREF-
                                                   TR (15)
                                                                    TPVDD         WM9713L
                                                             VM = proportional to X position
                                                  BR (14)
                                                                    TPVDD
                                                   BL (17)
                                                                    TPGND
                                                   TL (16)
                                                                    TPGND
                Figure 29 X Co-ordinate Measurement on 5-wire Touchpanel
                For an X co-ordinate measurement, the top left and bottom left corners of the touchpanel are
                grounded internally to the WM9713L, while the top right and bottom right contacts are connected to
                TPVDD. The bottom plate becomes a potential divider with a voltage gradient in the X direction. The
                voltage at the point of contact is proportional to its X co-ordinate. This voltage is measured on the
                WIPER pin and converted to a digital value by the ADC.
                Due to the ratiometric measurement method, the supply voltage does not affect measurement
                accuracy. The voltage references VREF+ and VREF- are taken from after the matrix switches, so that
                any voltage drop in these switches has no effect on the ADC measurement.
                                                                VREF+
                                               WIPER (12)   VM
                                                                   AUX
                                                                   ADC
                                                                 VREF-
                                                   TR (15)
                                                                    TPVDD         WM9713L
                                                             VM = proportional to Y position
                                                  BR (14)
                                                                    TPGND
                                                   BL (17)
                                                                    TPGND
                                                   TL (16)
                                                                    TPVDD
                Figure 30 Y Co-ordinate Measurement on 5-wire Touchpanel
                Y co-ordinate measurements are similar to Y co-ordinate measurements. However, the voltage
                gradient on the bottom plate is in the Y direction instead of the X direction. This is achieved by
                grounding the bottom left and bottom right corners of the touchpanel, and connecting the top-left and
                top-right contacts to TPVDD.
68                                                                                                          Rev 4.0


                                                                                               WM9713L
                                                            RPU
                                                                     AVDD
                                            WIPER (12)                        PEN
                                                                              DOWN
                                                                   zero power
                                                                   comparator
                                                TR (15)
                                                                 TPGND
                                                                         WM9713L
                                                BR (14)
                                                                 TPGND
                                                BL (17)
                                                                 TPGND
                                                TL (16)
                                                                 TPGND
               Figure 31 Pen Down Detection on 5-wire Touchpanel
               Pen down detection works in a similar fashion for both 4-wire and 5-wire touchpanels (see “Principle
               of Operation – Four-wire Touchpanel”). On a 5-wire touchpanel, all four contacts of the bottom plate
               are grounded, and the top plate contact is connected to the internal programmable pull-up resistor,
               RPU.
CONTROLLING THE TOUCHPANEL DIGITISER
               All touchpanel functions are accessed and controlled through the AC-Link interface.
               PHYSICAL CHARACTERISTICS
               The physical characteristics of the touchpanel interface are controlled through register 78h, as shown
               in Table 46.
                   REGISTER         BIT     LABEL        DEFAULT                         DESCRIPTION
                    ADDRESS
                 78h               12      45W          0 (4-wire)        Touchpanel Type Control
                                                                          0 = 4-wire
                                                                          1 = 5-wire
                                   8       PIL          0 (200A)         Pressure Measurement Current Control
                                                                          0 = IP = 200A
                                                                          1 = IP = 400A
                                   0:5     RPU          000001            Internal Pull-up Resistor Control
                                                        (64k)            000000 = Reserved
                                                                          000001 = 64kΩ/1 (most sensitive)
                                                                          000010 = 64kΩ/2
                                                                          000011 = 64kΩ/3
                                                                          … (64kΩ/binary value of RPU)
                                                                          111111 = 64kΩ/63 (least sensitive)
                                                                          Note: used to adjust sensitivity of Pen Down
                                                                          detection
               Table 46 Touchpanel Digitiser Control (Physical Characteristics)
Rev 4.0                                                                                                              69


                                                                                     WM9713L
   POWER MANAGEMENT
   To save power, the touchpanel digitiser and the pen-down detector can be independently disabled
   when they are not used. The power consumption of the pen-down detector is normally negligible,
   except when the pen is down.
   The pen ADC is powered-down using PADCPD, register 3Ch bit 15.
   The state of the digitiser and pen-down detector is controlled by using the bits described in Table 47.
       REGISTER            BIT       LABEL         DEFAULT                     DESCRIPTION
       ADDRESS
     3Ch                 15        PADCPD          1 = off      Touchpanel / AUXADC Disable Control
                                                                1 = Disabled
                                                                0 = Enabled
     78h                 15:14     PRP             00           Touchpanel Digitiser Power State
                                                                Control
                                                                00 = Pen digitiser off, pen detect off, no
                                                                wake-up on pen down (default)
                                                                01 = Pen digitiser powered off, pen detect
                                                                enabled, touchpanel digitiser wakes up
                                                                (changes to state 11) on pen-down
                                                                10 = Pen digitiser off, pen detect enabled,
                                                                no wake-up on pen down
                                                                11 = Pen digitiser and pen detect enabled
                         13        RPR             0            Pen Detect Wake-up Mode Control
                                                                0 = Wake-up the AC-Link only (hold
                                                                SDATAIN high until controller sends warm
                                                                reset or cold reset)
                                                                1 = Wake-up the WM9713L without waiting
                                                                for a reset signal from the controller
   Table 47 Touchpanel Digitiser Control (Power Management)
   INITIATION OF MEASUREMENTS
   The WM9713L touchpanel interface supports both polling routines and DMA (direct memory access)
   to control the flow of data from the touchpanel ADC to the host CPU.
   In a polling routine, the CPU starts each measurement individually by writing to the POLL bit (register
   74h, bit 9). This bit automatically resets itself when the measurement is completed.
      REGISTER            BIT       LABEL        DEFAULT                      DESCRIPTION
      ADDRESS
     74h              9            POLL          0            Poll Measurement Control
                                                              Writing “1” initiates a measurement (when
                                                              CTC=0)
                      8            CTC           0            AUXADC Measurement Mode
                                                              0 = Polling mode
                                                              1 = Continuous mode (for DMA)
70                                                                                                   Rev 4.0


                                                                                  WM9713L
           REGISTER         BIT       LABEL     DEFAULT                     DESCRIPTION
           ADDRESS
          76h            9:8         CR         00           Continuous Mode Conversion Rate
                                                             Continuous mode rate (DEL ≠ 1111)
                                                             00: 93.75 Hz (every 512 AC-Link frames)
                                                             01: 120 Hz (every 400 AC-Link frames)
                                                             10: 153.75 Hz (every 312 AC-Link frames)
                                                             11: 187.5Hz (every 256 AC-Link frames)
                                                             Continuous mode “fast rate” (DEL = 1111)
                                                             00: 8 kHz (every six AC-Link frames)
                                                             01: 12 kHz (every four AC-Link frames)
                                                             10: 24 kHz (every other AC-Link frame)
                                                             11: 48 kHz (every AC-Link frame)
                                                             Note: PENDIV bits in 44h [5:3] should be set
                                                             to 111 in 48kHz mode to ensure that
                                                             samples occur synchronously on the AC97
                                                             data channel
          78h            11          PDEN       0            Touchpanel Measurement Pen Status
                                                             Control
                                                             0 = Measure regardless of pen status
                                                             1 = Measure only when pen is down (when
                                                             CTC=0 and POLL=1, measurement is
                                                             delayed until pen-down; when CTC=1,
                                                             measurements are stopped on pen-up)
                         10          PDPOL      0            PENDOWN Polarity Control
                                                             0 = Normal
                                                             1 = Inverted
        Table 48 Touchpanel Digitiser Control (Initiation of Measurements)
        In continuous mode (CTC = 1), the WM9713L autonomously initiates measurements (or sets of
        measurements) at the rate set by CR, and supplies the measured data to the CPU on one of the
        unused AC’97 time slots. DMA-enabled CPUs can write the data directly into a FIFO without any
        intervention by the CPU core. This reduces CPU loading and speeds up the execution of user
        programs in handheld systems.
        Note that the measurement frequency in continuous mode is also affected by the DEL bits (see
        “Touchpanel Settling Time”). The faster rates achieved when DEL = 1111 may be useful when the
        ADC is used for auxiliary measurements.
Rev 4.0                                                                                                71


                                                                                 WM9713L
   MEASUREMENT TYPES
   The ADCSEL control bits determine which type of measurement is performed (seeTable 49).
      REGISTER        BIT           LABEL             DEFAULT                     DESCRIPTION
       ADDRESS
      74h            7       ADCSEL_AUX4              0              AUX4 Measurement Enable Control
                                                                     0 = Disable AUX4 measurement (pin 12)
                                                                     1 = Enable AUX4 measurement (pin 12)
                     6       ADCSEL_AUX3              0              AUX3 Measurement Enable Control
                                                                     0 = Disable AUX3 measurement
                                                                     (SPKVDD/3)
                                                                     1 = Enable AUX3 measurement
                                                                     (SPKVDD/3)
                     5       ADCSEL_AUX2              0              AUX2 Measurement Enable Control
                                                                     0 = Disable AUX2 measurement (pin 30)
                                                                     1 = Enable AUX2 measurement (pin 30)
                     4       ADCSEL_AUX1              0              AUX1 Measurement Enable Control
                                                                     0 = Disable AUX1 measurement (pin 29)
                                                                     1 = Enable AUX1 measurement (pin 29)
                     3       ADCSEL_PRESSURE          0              Pressure Measurement Enable Control
                                                                     0 = Disable pressure measurement
                                                                     1 = Enable pressure measurement
                     2       ADCSEL_Y                 0              Y Co-ordinate Measurement Enable
                                                                     Control
                                                                     0 = Disable Y co-ordinate measurement
                                                                     1 = Enable Y co-ordinate measurement
                     1       ADCSEL_X                 0              X Co-ordinate Measurement Enable
                                                                     Control
                                                                     0 = Disable X co-ordinate measurement
                                                                     1 = Enable X co-ordinate measurement
                     0       COO                      0              Co-ordinate Mode Control
                                                                     0 = Single measurement
                                                                     1 = Co-ordinate measurement
   Table 49 Touchpanel Digitiser Control (Measurement Types)
   When COO is ‘0’, the WM9713L performs a single measurement – either in polling mode or
   continuously, as indicated by the CTC bit. The type of measurement is specified by the ADCSEL[7:1]
   bits. If CTC=0 (polling mode) then only one of the ADCSEL[7:1] bits should be set.
   If operating in continuous mode (CTC=1), then more than one ADCSEL[7:1] bit may be set and
   selected conversions will be performed cyclically in the following order:
              X, Y, PRESSURE, AUX1, AUX2, AUX3, AUX4
   The co-ordinate mode (COO = ‘1’) makes it easier to obtain co-ordinate pairs rather than single co-
   ordinates. In polling-coordinate mode (CTC = ‘0’, COO = ‘1’), the WM9713L performs an X co-
   ordinate, then a Y co-ordinate, followed by a single additional measurement determined by
   ADCSEL[7:1], then stops. In continuous-coordinate mode (CTC = ‘1’, COO = ‘1’), the WM9713L
   continuously repeats a sequence consisting of an X-co-ordinate,Y co-ordinate, then an additional
   measurement determined by ADCSEL[7:1]. At least one of the ADCSEL bits must be set in
   continuous coordinate mode when CTC = COO = 1). Should more than one of the ADCSEL[7:1] bits
   be set during continuous co-ordinate mode then the additional measurement alternates for every set
   of three measurements. For example, if ADCSEL_AUX1 and ADCSEL_AUX3 were both selected
   whilst CTC = ‘1’, COO = ‘1’ then the following sequence of conversions would be performed:
              X, Y, AUX1, X, Y, AUX3, X, Y, AUX1, X, Y, AUX3
72                                                                                               Rev 4.0


                                                                                        WM9713L
        CONVERSION RATE
        As stated previously, the conversion rate is specified by the CR bits (reg 76h).
        CR may be set to 93.75Hz (every 512 AC-Link Frames), 120Hz (every 400 AC-Link Frames),
        153.75Hz (every 312 AC-Link frames) or 187.5Hz (every 256 AC-Link frames).
        If only one ADRSEL[7:1] bit is set, each individual conversion occurs at the rate specified by CR.
        If multiple ADRSEL[7:1] bits are set, the complete set of conversions requested is completed at the
        rate specified by CR.
        DATA READBACK
        This data is stored in register 7Ah, and can be retrieved by reading the register in the usual manner
        (see “AC97 Interface”). Additionally, the data can also be passed to the controller on one of the AC-
        Link time slots not used for audio functions.
        The output data word of the touchpanel interface consists of three parts:
                   Pen Status (1 bit) – this is also passed to the GPIO logic block, which can be programmed
                    to generate an interrupt and/or wake up the WM9713L on pen down (see GPIO and
                    Interrupt Control).
                   Output data from the touchpanel ADC (12 bits)
                   ADCSRC: 3 additional bits that indicate the source of the ADC data. In co-ordinate mode
                    (COO = ‘1’), the WM9713L schedules different types of measurements autonomously and
                    so these register bits may be required.
        If the data is being read back using the polling method, there are several ways to determine when a
        measurement has finished:
                  Reading back the POLL bit. If it has been reset to ‘0’, then the measurement has finished.
                  Monitoring the ADA signal (see “GPIO and Interrupt Control”). ADA goes high after every
                   single conversion. If operating in co-ordinate mode (COO=1) then ADA goes high after
                   every group of 3 conversions.
                  Reading back 7Ah until the new data appears
            REGISTER         BIT        LABEL         DEFAULT                     DESCRIPTION
            ADDRESS
           7Ah             15         PNDN           0             Pen Status (Read-only)
           or                                                      0 = Pen up
           AC-Link slot                                            1 = Pen down
           selected by     14:12      ADCSRC         000           Touchpanel ADC Source
           SLT
                                                                   000 = No measurement
                                                                   001 = X co-ordinate measurement
                                                                   010 = Y co-ordinate measurement
                                                                   011 = Pressure measurement (4-wire only)
                                                                   100 = COMP1/AUX1 measurement (pin 29)
                                                                   101 = COMP2/AUX2 measurement (pin 30)
                                                                   110 = AUX3 measurements (SPKVDD/3)
                                                                   111 = WIPER/AUX4 measurement (pin 12)
                           11:0       ADCD           000h          Touchpanel ADC Data (Read-only)
                                                                   Bit 0 = LSB
                                                                   Bit 11 = MSB
           78h             9          WAIT           0             Touchpanel ADC Data Control
                                                                   0 = Overwrite existing data in 7Ah with new
                                                                   data
                                                                   1 = Retain existing data in 7Ah until it is read
        Table 50 Touchpanel Digitiser Data
Rev 4.0                                                                                                           73


                                                                                           WM9713L
   When operating in co-ordinate mode (COO=1) there will be 3 results to read back from each set of
   measurements – X, Y, and the third additional measurement. After the co-ordinate set has finished
   the X result will be present in register 7Ah. Once this has been read back by the user the Y result will
   overwrite register 7Ah, as indicated by ADCSRC. Finally, after the Y result has been read back, the
   result of the third, additional, measurement will become present in 7Ah, again indicated by ADCSRC.
   To avoid losing data that has not yet been read, the WM9713L can delay overwriting register 7Ah with
   new conversions until the old data has been read. This function is enabled using the WAIT bit, and
   applies to both single and co-ordinate conversion mode.
   The flow diagram in Figure 32 shows the timing of touchpanel conversions, and data readback from
   register 7Ah - dependent on the individual settings of the COO, POLL, ADCSEL and CTC bits.
                            Poll (74h) Set                                         Read Data
                                                                      User reads back single conversion (CO=0)
                       This occurs when user sets
                                                                        OR 1,2,3 in sequential order (CO=1)
                   POLL - or automatically when CTC=1
                                                                                from register 7Ah
     COO=0                          COO=1                                        ADA goes high
                                                                     ADA remains high until data has been
                                                                     read from a register or sent out on an
                      X Measurement(1)
                                                                     AC-LINK slot (dependent on value of
                                                                                       SLEN)
                                                                                   Poll (74h)
                      Y Measurement(2)
                                                                                       Reset
      ADCSELL!=000_0000
                                                                ADCSELL=000_0000
                        Measurement(3)
                           as described by
                            ADCSEL (74h)
     POLL (74h)                       Starts a single measurement
     CTC (74h)                        Starts a co-ordinate measurement at specified conversion rate
     COO (74h)                        Enables Co-ordinate mode
     ADCSEL (74H)                     Specifies the type of measurement to be made
   Figure 32 Touchpanel Conversion Flow Diagram
74                                                                                                             Rev 4.0


                                                                                        WM9713L
        If the SLEN bit is set to ‘1’, then the touchpanel data appears on the AC-Link slot selected by the SLT
        control bits, as shown below. The Slot 0 ‘tag’ bit corresponding to the selected time slot is asserted
        whenever there is new data on that slot.
             REGISTER         BIT        LABEL       DEFAULT                       DESCRIPTION
             ADDRESS
           76h               3         SLEN          0              Slot Readback Enable Control
                                                                    0 = Disabled (readback through register map
                                                                    only)
                                                                    1 = Enabled (readback slot selected by SLT)
                             2:0       SLT           110            AC’97 Slot for Touchpanel Data Control
                                                                    000 = Slot 5
                                                                    001 = Slot 6
                                                                    010 = Slot 7
                                                                    011 = Slot 8
                                                                    100 = Slot 9
                                                                    101 = Slot 10
                                                                    110 = Slot 11
                                                                    111 = Reserved
        Table 51 Returning Touchpanel Data Through an AC-Link Time Slot
        TOUCHPANEL SETTLING TIME
        For accurate touchpanel measurements, some settling time may be required between the switch
        matrix applying a voltage across the touchpanel plate and the ADC sampling the signal. This time
        delay function is built into the WM9713L and can be programmed as shown below.
            REGISTER          BIT         LABEL        DEFAULT                      DESCRIPTION
            ADDRESS
           76h             7:4           DEL           0000           Touchpanel Settling Time Control
                                                       (1 frame)      See Table 53 for details
        Table 52 Touchpanel Settling Time Control (1)
               DEL                 DELAY                    DELAY
                           (AC-LINK FRAMES)                  (TIME)
              0000                     1                     20.8s
              0001                     2                     41.7s
              0010                     4                     83.3s
              0011                     8                     167s
              0100                    16                     333s
              0101                    32                     667s
              0110                    48                      1ms
              0111                    64                    1.33ms
              1000                    96                      2ms
              1001                    128                   2.67ms
              1010                    160                   3.33ms
              1011                    192                     4ms
              1100                    224                   4.67ms
              1101                    256                   5.33ms
              1110                    288                     6ms
              1111               No delay, switch matrix always on
        Table 53 Touchpanel Settling Time Control (2)
Rev 4.0                                                                                                       75


                                                                                  WM9713L
   The total time for co-ordinate or auxiliary measurements to complete is the delay time DEL, plus one
   AC-Link frame (20.8s). For a pressure measurement, the time taken is DEL plus two AC-Link frames
   (41.6s).
   Although the DELAY is variable the maximum value that may be programmed depends on the number
   of ADCSEL[7:1] bits set, as shown in the following table. Setting multiple ADCSEL[7:1] bits leaves
   less spare AC_Link frames for the DELAY.
           NUMBERS OF                 CR SETTING            MAX DELAY
     ADCSEL[1:7] BITS SET                                     SETTING
                   1                  00 (93.75Hz)              288
                   1                   01 (120Hz)               288
                   1                 10 (153.75Hz)              288
                   1                  11 (187.5Hz)              256
                   2                  00 (93.75Hz)              256
                   2                   01 (120Hz)               192
                   2                 10 (153.75Hz)              128
                   2                  11 (187.5Hz)              128
                  3, 4                00 (93.75Hz)               96
                  3, 4                 01 (120Hz)                96
                  3, 4               10 (153.75Hz)               64
                  3, 4                11 (187.5Hz)               48
                 5,6,7                00 (93.75Hz)               48
                 5,6,7                 01 (120Hz)                48
                 5,6,7               10 (153.75Hz)               32
                 5,6,7                11 (187.5Hz)               16
            1 (if COO=1)              00 (93.75Hz)              224
            1 (if COO=1)               01 (120Hz)               192
            1 (if COO=1)             10 (153.75Hz)              128
            1 (if COO=1)              11 (187.5Hz)               96
             2,3,4,5,6,7              00 (93.75Hz)              160
             (if COO=1)
             2,3,4,5,6,7               01 (120Hz)               128
             (if COO=1)
            2,3,4,5,6,7,8            10 (153.75Hz)               96
             (if COO=1)
            2,3,4,5,6,7,8             11 (187.5Hz)               64
             (if COO=1)
   Table 54 Maximum Delay Values
   Setting DEL to ‘1111’ reduces the settling time to zero, i.e. measurements begin immediately. This
   mode is intended for fast sampling on AUX inputs. It is NOT intended for touchpanel digitisation.
   There are several side-effects when DEL is set to ‘1111’:
       Co-ordinate mode does not work, i.e. the WM9713L behaves as if COO = 0, even if COO = 1
        (see “Measurement Types”)
       If X / Y co-ordinate or touch pressure measurements are selected (ADCSEL = 001, 010 or 011),
        then the switch matrix is constantly on, and current constantly flows in the touchpanel. This
        increases power consumption in the system, and is therefore not recommended for battery
        powered systems
       In continuous mode (CTC = 1), setting DEL = 1111 increases the sampling rate of the touchpanel
        ADC (see “Initiation of Measurements”)
76                                                                                                Rev 4.0


                                                                                        WM9713L
        MASK INPUT CONTROL
        Sources of glitch noise, such as the signals driving an LCD display, may feed through to the
        touchpanel plates and affect measurement accuracy. In order to minimise this effect, a signal may be
        applied to MASK (pin 47 / pin 3) to delay or synchronise the sampling of any input to the ADC. The
        effect of the MASK signal depends on the MSK bits of register 78h, as described in Table 55.
             REGISTER         BIT         LABEL      DEFAULT                      DESCRIPTION
             ADDRESS
           78h               7:6       MSK           00            Mask Input Control
                                                                   see Table 56 for details
        Table 55 MASK Input Control
             MSK[1-0]                               EFFECT OF SIGNAL ON MASK PIN
                 00         Mask has no effect on conversions GPIO input disabled (default)
                 01         Static; ‘hi’ on MASK pin stops conversions, ‘lo’ has no effect.
                 10         Edge triggered; rising or falling edge on MASK pin delays conversions
                            by an amount set in the DEL[3-0] register. Conversions are asynchronous to the
                            MASK signal.
                 11         Synchronous mode; conversions wait until rising or falling edge on MASK initiates
                            cycle; screen starts to be driven when the edge arrives, the conversion sample
                            being taken a period set by DEL[3-0] after the edge.
        Table 56 Controlling the MASK Feature
        Note that pin 47 / pin 3 can also be used as a GPIO (see “GPIO and Interrupt Control”), or to output
        the ADA signal (see below).
        ADA (ADC DATA AVAILABLE) SIGNAL
        Whenever data becomes available from the touchpanel ADC, the internal ADA (ADC Data Available)
        signal goes high and remains high until the data has been read from register 7Ah (if SLEN = 0) or until
        it has been sent out on an AC-Link slot (if SLEN = 1).
        ADA goes high either-
                   After every touchpanel ADC conversion (in normal mode, COO=0)
                   After every set of 3 conversions (co-ordinate mode, COO=1)
        ADA can be used to generate an interrupt, if the AW bit (register 52h, bit 12) is set (see “GPIO and
        Interrupt Control”).
        It is also possible to output the ADA signal on pin 47 / pin 3, if this pin is not used as a GPIO. The
        GE4/6 bit must be set to ‘0’ to achieve this (see “GPIO and Interrupt Control”).
        Alternatively, ADA can be read from bit 12 in register 54h.
Rev 4.0                                                                                                     77


                                                                                             WM9713L
ADDITIONAL FEATURES
AUXILIARY ADC INPUTS
                 The ADC used for touchpanel digitisation can also be used for the sole purpose of auxiliary
                 measurements, provided that it is enabled (register 78h, PRP = 11). The WM9713L has three pins
                 that can be used as auxiliary ADC inputs:
                            MIC2A / COMP1 / AUX1 (pin 29)
                            MIC2B / COMP2 / AUX2 (pin 30)
                            WIPER / AUX4 (pin 12)
                 Additionally, the speaker supply (SPKVDD) can be used as an auxiliary ADC input through an on-chip
                 potential divider giving an input to the auxiliary ADC of SPKVDD/3. This input is referred to as the
                 AUX3 input (see Figure 24).
                 Note that pin 12 connects to the wiper of a 5-wire touchpanel wiper function. Auxiliary measurements
                 taken on pin 12 are only meaningful when it is not connected to a touchpanel (i.e. a 4-wire touchpanel,
                 or no touchpanel at all, is used). Pins 29 and 30 are also used as comparator inputs (see “Battery
                 Alarm and Analogue Comparators”), but auxiliary measurements can still be taken on these pins at
                 any time. The ADCSEL control bits select between different ADC inputs, as shown in Table 57.
                 The ADCSEL control bits determine which type of measurement is performed (see Table 57). When
                 performing auxiliary conversions the co-ordinate mode bit, COO, should be off (0).
                 If CTC=0 then only one of the ADCSEL[7:1] bits should be set. If operating in continuous mode
                 (CTC=1), then more than one ADCSEL[7:1] bit may be set, and conversions will be performed
                 cyclically in the following order: AUX1, AUX2, AUX3, AUX4 (dependent on which bits are set).
                    REGISTER          BIT     LABEL       DEFAULT                     DESCRIPTION
                     ADDRESS
                    74h                7     ADCSEL_         0        AUX4 Measurement Enable Control
                                             AUX4                     0 = Disable AUX4 measurement (pin 12)
                                                                      1 = Enable AUX4 measurement (pin 12)
                                       6     ADCSEL_         0        AUX3 Measurement Enable Control
                                             AUX3                     0 = Disable AUX3 measurement (SPKVDD/3)
                                                                      1 = Enable AUX3 measurement (SPKVDD/3)
                                       5     ADCSEL_         0        AUX2 Measurement Enable Control
                                             AUX2                     0 = Disable AUX2 measurement (pin 30)
                                                                      1 = Enable AUX2 measurement (pin 30)
                                       4     ADCSEL_         0        AUX1 Measurement Enable Control
                                             AUX1                     0 = Disable AUX1 measurement (pin 29)
                                                                      1 = Enable AUX1 measurement (pin 29)
                                       0     COO             0        Co-ordinate Mode Control
                                                                      0 = Single measurement
                                                                      1 = Co-ordinate measurement
                                                                      Note: When not measuring a touchpanel, set
                                                                      COO=0
                 Table 57 Auxiliary ADC Measurements
                 Auxiliary ADC measurements are initiated in the same way as touchpanel measurements, and the
                 data is returned in the same manner – see “Controlling the Touchpanel Digitiser”.
78                                                                                                             Rev 4.0


                                                                                             WM9713L
BATTERY ALARM AND ANALOGUE COMPARATORS
               The battery alarm function differs from battery measurement in that it does not actually measure the
               battery voltage. Battery alarm only indicates “OK”, “Low” or “Dead”. The advantage of the battery
               alarm function is that it does not require a clock and can therefore be used in low-power sleep or
               standby modes.
                    VOLTAGE
                   REGULATOR
                                        AVDD, DCVDD, ...
                                                      AUX1/                              WM9713L
                           IALARM    R1             COMP1                        DEAD
                                                                          +       BAT
                                                                          -
                                                   C                                       GPIO /
                                             R2                              VREF       INTERRUPT
                VBATT                                                                      LOGIC
                                                                          -
                                                                          +      LOW
                                                      AUX2/                       BAT
                                             R3     COMP2
                                                                                      GPIO2/   GPIO
                                                                                       IRQ     PINS
               Figure 33 Battery Alarm Example Schematic
               The typical schematic for a dual threshold battery alarm is shown above. This alarm has two
               thresholds, “dead battery” (COMP1) and “low battery” (COMP2). R1, R2 and R3 set the threshold
               voltages. Their values can be up to about 1M in order to keep the battery current [IALARM = VBATT /
               (R1+R2+R3)] to a minimum (higher resistor values may affect the accuracy of the system as leakage
               currents into the input pins become significant).
               Dead battery alarm: COMP1 triggers when VBATT < VREF  (R1+R2+R3) / (R2+R3)
               A dead battery alarm is the highest priority of interrupt in the system. It should immediately save all
               unsaved data and shut down the system. The GP15, GS15 and GW15 bits must be set to generate
               this interrupt.
               Low battery alarm: COMP2 triggers when VBATT < VREF  (R1+R2+R3) / R3
               A low battery alarm has a lower priority than a dead battery alarm. Since the threshold voltage is
               higher than for a dead battery alarm, there is enough power left in the battery to give the user a
               warning and/or shut down “gracefully”. When VBATT gets close to the low battery threshold, spurious
               alarms are filtered out by the COMP2 delay function.
               The purpose of the capacitor C is to remove from the comparator inputs any high frequency noise or
               glitches that may be present on the battery (for example, noise generated by a charge pump). It forms
               a low pass filter with R1, R2 and R3.
                           Low pass cutoff fc [Hz] = 1/ (2 C  (R1 || (R2+R3)))
               Provided that the cutoff frequency is several orders of magnitude lower than the noise frequency fn,
               this simple circuit can achieve excellent noise rejection.
                           Noise rejection [dB] = 20 log (fn / fc)
               The circuit shown above also allows for measuring the battery voltage VBATT. This is achieved simply
               by setting the touchpanel ADC input to be either COMP1 (ADCSEL = 100) or COMP2 (ADCSEL =
               101) (see also Auxiliary ADC Inputs).
Rev 4.0                                                                                                           79


                                                                             WM9713L
   The WM9713L has two on-chip comparators that can be used to implement a battery alarm function,
   or other functions such as a window comparator. Each comparator has one of its inputs tied to
   COMP1 (pin 29) or COMP2 (pin 30), and the other tied to a voltage reference. The voltage reference
   can be either internally generated (VREF = AVDD/2) or externally connected on AUX4 (pin 12).
   The comparator output signals are passed to the GPIO logic block (see “GPIO and Interrupt Control”
   section), where they can be used to send an interrupt to the CPU via the AC-Link or via the IRQ pin,
   and / or to wake up the WM9713L from sleep mode. COMP1/AUX1 (pin 29) corresponds to GPIO bit
   15 and COMP2/AUX2 (pin30) to bit 14.
      REGISTER         BIT      LABEL     DEFAULT                      DESCRIPTION
      ADDRESS
     4Eh              15       CP1        1           COMP1 Polarity Control
                                                      0: Alarm when COMP1 voltage is below VREF
                                                      1: Alarm when COMP1 voltage is above VREF
                                                      Note: see also “GPIO and Interrupt Control”
                      14       CP2        1           COMP2 Polarity Control
                                                      0: Alarm when COMP2 voltage is below VREF
                                                      1: Alarm when COMP2 voltage is above VREF
                                                      Note: see also “GPIO and Interrupt Control”
     5Ah              15:13    COMP2      000         Low Battery Alarm Delay Control
                               DEL                    000 = No delay
                                                      001 = 213 AC-link frames (0.17s)
                                                      010 = 214 AC-link frames (0.34s)
                                                      011 = 215 AC-link frames (0.68s)
                                                      100 = 216 AC-link frames (1.4s)
                                                      101 = 217 AC-link frames (2.7s)
                                                      110 = 218 AC-link frames (5.5s)
                                                      111 = 219 AC-link frames (10.9s)
   Table 58 Comparator Control
      REGISTER         BIT      LABEL     DEFAULT                      DESCRIPTION
      ADDRESS
     5Ch              14       C2REF      0           Comparator 2 Reference Voltage Select
     Additional                                       0 = AVDD/2
     Analogue                                         1 = WIPER/AUX4 (pin 12)
     Functions
                      13:12    C2SRC      00          Comparator 2 Signal Source
                                                      00 = AVDD/2 when C2REF=1, else COMP1
                                                      powered down
                                                      01 = COMP1/AUX1 (pin 29)
                                                      10 = COMP2/AUX2 (pin 30)
                                                      11 = Reserved
                      11       C1REF      0           Comparator 1 Reference Voltage Select
                                                      0 = AVDD/2
                                                      1 = WIPER/AUX4 (pin 12)
                      10:9     C1SRC      00          Comparator 1 Signal Source
                                                      00 = AVDD/2 when C1REF=1, else COMP2
                                                      powered down
                                                      01 = COMP1/AUX1 (pin 29)
                                                      10 = COMP2/AUX2 (pin 30)
                                                      11 = Reserved
   Table 59 Comparator Reference and Source Control
80                                                                                           Rev 4.0


                                                                                        WM9713L
        COMP2 DELAY FUNCTION
        COMP2 has an optional delay function for use when the input signal is noisy. When COMP2 triggers
        and the delay is enabled (i.e. COMP2DEL is non-zero), then GPIO bit 14 does not change state
        immediately, and no interrupt is generated. Instead, the WM9713L starts a delay timer and checks
        COMP2 again after the delay time has passed. If COMP2 is still active, then the GPIO bit is set and
        an interrupt may be generated (depending on the state of the GW14 bit). If COMP2 is no longer
        active, the GPIO bit is not set, i.e. all register bits are as if COMP2 had never triggered.
                          COMP2
                        TRIGGERS
                           C2W?              0               END
                             1
                          COMP2
                           DEL?
                         non-zero
                       START TIMER
                           WAIT
                     time=COMP2DEL
           000
                       SHUT DOWN
                          TIMER
                                                             END
                         COMP2?          Inactive
                                                       [FALSE ALARM]
                           Active
                         SET GI14
                            END
        Figure 34 COMP2 Delay Flow Chart
Rev 4.0                                                                                                  81


                                                                                              WM9713L
GPIO AND INTERRUPT CONTROL
                The WM9713L has eight GPIO pins that operate as defined in the AC’97 Revision 2.2 specification.
                Each GPIO pin can be set up as an input or as an output, and has corresponding bits in register 54h
                and in slot 12. The state of a GPIO output is determined by sending data through slot 12 of outgoing
                frames (SDATAOUT). Data can be returned from a GPIO input by reading the register bit, or
                examining slot 12 of incoming frames (SDATAIN). GPIO inputs can be made sticky, and can be
                programmed to generate an interrupt, transmitted either through the AC-Link or through a dedicated,
                level-mode interrupt pin (GPIO2/IRQ, pin 45).
                In addition, the GPIO pins 1, 3, 4 and 5 can be used for the PCM interface by setting bit 15 of register
                36h (see “PCM Audio Data Formats” section). Setting this bit disables any GPIO functions selected on
                these pins.
                   REGISTER        BIT     LABEL       DEFAULT                        DESCRIPTION
                   ADDRESS
                  36h             15       CTRL       0              GPIO Pin Configuration Control
                  PCM                                                0 = GPIO pins used as GPIOs
                  CODEC                                              1 = GPIO pins used as PCM interface
                  Control
                                                                     Note: For PCM interface, one or more of these
                                                                     pins (depending on master/slave/partial master
                                                                     mode) must be set up as an output by writing to
                                                                     register 4Ch (see Table 62)
                  56h             8:2      GEn        1 (GPIO)       Toggle GPIO pin function
                  GPIO Pin                                           0: secondary function enabled
                  Sharing                                            1: GPIO enabled
                Table 60 GPIO Additional Function Control
                GPIO pins 2 to 8 are multi-purpose pins that can also be used for other (non-GPIO / -PCM) purposes,
                e.g. as a S/PDIF output or to signal pendown. This is controlled by register 56h (see Table 63).
                Note that GPIO6/7/8 each have an additional function independent of the GPIO / auxiliary functions
                discussed above. If these pins are to be used as GPIO then the independent function needs to be
                disabled using its own control registers, e.g. to use pin 11 as a GPIO then the RESETB function
                needs to be disabled (RSTDIS, register 5Ah, bit 8).
                Independently of the GPIO pins, the WM9713L also has seven virtual GPIOs. These are signals from
                inside the WM9713L, which are treated as if they were GPIO input signals. From a software
                perspective, virtual GPIOs are the same as GPIO pins, but they cannot be set up as outputs, and are
                not tied to an actual pin. This allows for simple, uniform processing of different types of signals that
                may generate interrupts (e.g. pen down, battery warnings, jack insertion, high-temperature warning, or
                GPIO signals).
82                                                                                                            Rev 4.0


                                                                                                                                                                                                WM9713L
                                                                                                STATUS
                                                                                       54h.n / SLOT12.n                     0
                                                                                                                                        STATUS READBACK
                                                                                                                             MUX
                                                                                                                0                       54h.n / SLOT12.n
                                                                                                                            1
       58h.n           FUNCTION                                                                                  MUX
                         SELECT                                        XNOR              S         Q            1
                        56h.n
                                                                                            RSFF
                              1                                                          R                               CONFIGURATION
    GPIO                                        POLARITY                                                                    (4Ch.n)
                                                  (4Eh.n)                                                       STICKY
       PIN                                                                                                       (50h.n)
                                                                                                                             0=O/P
                                                                                                                              1=I/P
                                                                                                             0=NOT STICKY
                                                                               WRITE '0'                       1=STICKY
                                                                               TO 54h.n
                                                      STATUS                 CLEAR STICKY
       58h.n                                          (SLOT12.n)
                            OTHER            4C                                          STICKY (50h.n)
                                                                                                                   AND
                          FUNCTION                                                     WAKE-UP (52h.n)
                                                                               CONFIGURATION (4Ch.n)
                                                                                                                                                    WAKEEN
                                                                                                                                                   5Ah, bit 1              IF WM9713L SLEEPING:
 8 circuits like this (one for each GPIO pin)                                                                                                                                 WAKE UP AC-LINK
                                                                                                                                                              AND
                                                                                                                                                                             IF WM9713L AWAKE:
                                                                                                                                                                                SET GPIO_INT
                                                                                                                                                                                (SLOT12, BIT0)
                                                              STICKY (50h.n)
                                                                                                                                                                    GE2=0: CLOSED
                                                           WAKE-UP (52h.n)           AND
                                                                                                                                       OR                            GE2=1: OPEN
                                                                                                                                                                                         IRQ
                                                                                                                                                                XOR
                                                    WRITE '0'                                                                                 IRQINV                                     PIN 45
                                                    TO 54h.n                                                                               5Ah, bit 0
                                                                                  STICKY                                    OTHER
                              POLARITY                                             (50h.n)                                   GPIOs
                                (4Eh.n)
                                                              R
                                                                 RSFF
                                             XNOR             S        Q          1
         WM9713L                                                                                   STATUS READBACK
                                                                                   MUX
    internal signal                                                                                54h.n / SLOT12.n
                                                                                  0
 7 circuits like this (one for each virtual GPIO)
Figure 35 GPIO Logic
  GPIO                    SLOT                       TYPE                              PIN NO.                                                                         DESCRIPTION
     BIT                 12 BIT
       1                       5                  GPIO Pin                                  44                         GPIO1
       2                       6                  GPIO Pin                                  45                         GPIO2 / IRQ
                                                                                                                       enabled only when pin not used as IRQ
       3                       7                  GPIO Pin                                  46                         GPIO3 / PENDOWN
                                                                                                                       enabled only when pin not used as PENDOWN
       4                       8                  GPIO Pin                                  47                         GPIO4 / ADA / MASK
                                                                                                                       enabled only when pin not used as ADA
       5                       9                  GPIO Pin                                  48                         GPIO5 / S/PDIF_OUT
                                                                                                                       enabled only when pin not used as S/PDIF_OUT
       6                     10                   GPIO Pin                                    3                        GPIO6 / ADA / MASK
                                                                                                                       Enabled only when pin not used as ADA
       7                     11                   GPIO Pin                                  11                         GPIO7 / PENDOWN
                                                                                                                       enabled only when pin not used as PENDOWN
       8                     12                   GPIO Pin                                  12                         GPIO8 / S/PDIF_OUT
                                                                                                                       enabled only when pin not used as S/PDIF_OUT
       9                     13                Virtual GPIO                                    -                       Internal microphone bias current detect, generates an interrupt above
                                                                                     [MICDET]                          a threshold (see MICBIAS Current Detect)
      10                     14                Virtual GPIO                                    -                       Internal shorted microphone detect, generates an interrupt above a
                                                                                     [MICSHT]                          threshold (see MICBIAS Current Detect)
      11                     15                Virtual GPIO                                    -                       Internal thermal cutout signal, indicates when internal temperature
                                                                              [Thermal Cutout]                         reaches approximately 150C (see “Thermal Sensor”)
      12                     16                Virtual GPIO                                    -                       Internal ADA (ADC Data Available) Signal
                                                                                         [ADA]                         enabled only when touchpanel ADC is active
      13                     17                Virtual GPIO                                    -                       Internal PENDOWN Signal
                                                                                 [PEN DOWN]                            enabled only when pen-down detection is active
      14                     18                Virtual GPIO                                    -                       Internal COMP2 output (Low Battery Alarm)
                                                                                      [COMP2]                          enabled only when COMP2 is on
      15                     19                Virtual GPIO                                    -                       Internal COMP1 output (Dead Battery Alarm)
                                                                                      [COMP1]                          enabled only when COMP1 is on
Table 61 GPIO Bits and Pins
Rev 4.0                                                                                                                                                                                               83


                                                                                                            WM9713L
Note: GPIO7 (Pin 11) has an independent RESETB function. This must be disabled using RSTDIS (Register 5Ah, bit 8) before
using Pin 11 as a GPIO / PENDOWN.
                             The properties of the GPIOs are controlled through registers 4Ch to 52h, as shown below.
                                REGISTER        BIT     LABEL         DEFAULT                       DESCRIPTION
                                 ADDRESS
                                4Ch            n       GCn            1            GPIO Pin Configuration Control
                                                                                   0 = Output
                                                                                   1 = Input (GC9-15 are always inputs)
                                4Eh            n       GPn            1            GPIO Pin Polarity / Type (Note 1)
                                                                                   Input (GCn = 1)                 Output (GCn = 0)
                                                                                   0 = Active low                  0 = CMOS output
                                                                                   1 = Active high                 1 = Open drain
                                50h            n       GSn            0            GPIO Pin Sticky Control
                                                                                   0 = Not sticky
                                                                                   1 = Sticky
                                52h            n       GWn            0            GPIO Pin Wake-up Control
                                                                                   0 = No wake-up (no interrupts generated by
                                                                                       GPIO)
                                                                                   1 = Wake-up (generate interrupts from GPIO)
                                54h            n       GIn            N/A          GPIO Pin Status
                                                                                   Read = Returns status of GPIO
                                                                                   Write = Writing 0 clears sticky bits
                             Table 62 GPIO Control
                             Note 1: Excludes GP11. For Thermal Sensor Polarity Control (GP11) see Table 40 on page 60.
                             The following procedure is recommended for handling interrupts:
                             When the controller receives an interrupt, check register 54h. For each GPIO bit in descending order
                             of priority, check if the bit is ‘1’. If yes, execute corresponding interrupt routine, then write ‘0’ to
                             corresponding bit in 54h. If no, continue to next lower priority GPIO. After all GPIOs have been
                             checked, check if interrupt still present or no. If yes, repeat procedure. If no, then jump back to
                             process that ran before the interrupt.
                             If the system CPU cannot execute such an interrupt routine, it may be preferable to switch internal
                             signals (such as PENDOWN) directly onto the GPIO pins. However, in this case the interrupt signals
                             cannot be made sticky, and more GPIO pins are tied up both on the WM9713L and on the CPU.
84                                                                                                                           Rev 4.0


                                                                               WM9713L
          REGISTER      BIT    LABEL     DEFAULT                       DESCRIPTION
          ADDRESS
         56h           2      GE2        1           GPIO2 (Pin 45) Function Control
         GPIO pins                                   0 = Pin 45 is not controlled by GPIO logic
         function                                    1 = Pin 45 is controlled by GPIO logic
         select
                                                     Note: When GE2=0,
                                                           set GC2=0 in 4Ch to output IRQ
                       3      GE3        1           GPIO3 (Pin 46) Function Control
                                                     0 = Pin 46 is not controlled by GPIO logic
                                                     1 = Pin 46 is controlled by GPIO logic
                                                     Note: When GE3=0,
                                                           set GC3=0 in 4Ch to output PENDOWN
                       4      GE4        1           GPIO4 (Pin 47) Function Control
                                                     0 = Pin 47 is not controlled by GPIO logic
                                                     1 = Pin 47 is controlled by GPIO logic
                                                     Note: When GE4=0,
                                                           set GC4=0 in 4Ch to output ADA
                                                           set GC4=1 in 4Ch to input MASK
                       5      GE5        1           GPIO5 (Pin 48) Function Control
                                                     0 = Pin 48 is not controlled by GPIO logic
                                                     1 = Pin 48 is controlled by GPIO logic
                                                     Note: When GE5=0,
                                                           set GC5=0 in 4Ch to output S/PDIF
                       6      GE6        1           GPIO6 (Pin 3) Function Control
                                                     0 = Pin 3 is not controlled by GPIO logic
                                                     1 = Pin 3 is controlled by GPIO logic
                                                     Note: When GE6=0,
                                                           set GC6=0 in 4Ch to output ADA signal
                                                           set GC6=1 in 4Ch to input MASK signal
                       7      GE7        1           GPIO7 (Pin 11) Function Control
                                                     0 = Pin 11 is not controlled by GPIO logic
                                                     1 = Pin 11 is controlled by GPIO logic
                                                     Note: When GE7=0,
                                                           set GC7=0 in 4Ch to output PENDOWN
                       8      GE8        1           GPIO8 (Pin 12) Function Control
                                                     0 = Pin 12 is not controlled by GPIO logic
                                                     1 = Pin 12 is controlled by GPIO logic
                                                     Note: When GE8=0,
                                                           set GC8=0 in 4Ch to output S/PDIF
        Table 63 Using GPIO Pins for Non-GPIO Functions
Rev 4.0                                                                                          85


                                                                                                WM9713L
POWER MANAGEMENT
INTRODUCTION
               The WM9713L includes the standard power down control register defined by the AC’97 specification
               (register 26h). Additionally, it also allows more specific control over the individual blocks of the device
               through register Powerdown registers 3Ch and 3Eh. Each particular circuit block is active when both
               the relevant bit in register 26h AND the relevant bit in the Powerdown registers 3Ch and 3Eh are set
               to ‘0’.
               Note that the default power-up condition is all OFF.
AC97 CONTROL REGISTER
                  REGISTER         BIT     LABEL         DEFAULT                       DESCRIPTION
                  ADDRESS
                 26h              14      PR6            1           Output PGAs Disable Control
                 Powerdown/                              (disabled)  1 = Disabled
                 Status                                              0 = Enabled
                 register
                                  13      PR5            1           Internal Clock Disable Control
                                                         (disabled)  1 = Disabled
                                                                     0 = Enabled
                                  12      PR4            1           AC-Link Disable Control
                                                         (disabled)  1 = Disabled
                                                                     0 = Enabled
                                  11      PR3            1           Analogue Disable Control
                                                         (disabled)  1 = Disabled
                                                                     0 = Enabled
                                                                     Note: This control disables VREF, input PGAs,
                                                                     DACs, ADCs, mixers and outputs
                                  10      PR2            1           Input PGAs and Mixers Disable Control
                                                         (disabled)  1 = Disabled
                                                                     0 = Enabled
                                  9       PR1            1           Stereo DAC Disable Control
                                                         (disabled)  1 = Disabled
                                                                     0 = Enabled
                                  8       PR0            1           Stereo ADC and Record Mux Disable Control
                                                         (disabled)  1 = Disabled
                                                                     0 = Enabled
                                  3       REF            0           VREF Ready (Read Only)
                                                                     1 = VREF ready
                                                                     0 = VREF not ready
                                  2       ANL            0           Analogue Mixers Ready (Read Only)
                                                                     1 = Analogue mixers ready
                                                                     0 = Analogue mixers not ready
                                  1       DAC            0           Stereo DAC Ready (Read Only)
                                                                     1 = DAC ready
                                                                     0 = DAC not ready
                                  0       ADC            0           Stereo ADC Ready (Read Only)
                                                                     1 = ADC ready
                                                                     0 = ADC not ready
               Table 64 Powerdown and Status Register (Conforms to AC’97 Rev 2.2)
86                                                                                                               Rev 4.0


                                                                                         WM9713L
EXTENDED POWERDOWN REGISTERS
                REGISTER        BIT       LABEL       DEFAULT                      DESCRIPTION
                ADDRESS
               3Ch            15        PADCPD       1              Touchpanel / AUXADC Disable Control
               Powerdown                             (disabled)     1 = Disabled
               (1)                                                  0 = Enabled
                              14        VMID1M       1              1Meg VMID String Disable Control
                                                     (disabled)     1 = Disabled
                                                                    0 = Enabled
                              13        TSHUT        1              Thermal Shutdown Disable Control
                                                     (disabled)     1 = Disabled
                                                                    0 = Enabled
                              12        VXDAC        1              Voice DAC Disable Control
                                                     (disabled)     1 = Disabled
                                                                    0 = Enabled
                              11        AUXDAC       1              AUXDAC Disable Control
                                                     (disabled)     1 = Disabled
                                                                    0 = Enabled
                              10        VREF         1              VREF Disable Control
                                                     (disabled)     1 = Disabled
                                                                    0 = Enabled
                              9         PLL          1              PLL Disable Control
                                                     (disabled)     1 = Disabled
                                                                    0 = Enabled
                              7         DACL         1              Left DAC Disable Control (see Note 1)
                                                     (disabled)     1 = Disabled
                                                                    0 = Enabled
                              6         DACR         1              Right DAC Disable Control (see Note 1)
                                                     (disabled)     1 = Disabled
                                                                    0 = Enabled
                              5         ADCL         1              Left ADC Disable Control
                                                     (disabled)     1 = Disabled
                                                                    0 = Enabled
                              4         ADCR         1              Right ADC Disable Control
                                                     (disabled)     1 = Disabled
                                                                    0 = Enabled
                              3         HPLX         1              Left Headphone Mixer Disable Control
                                                     (disabled)     1 = Disabled
                                                                    0 = Enabled
                              2         HPRX         1              Right Headphone Mixer Disable Control
                                                     (disabled)     1 = Disabled
                                                                    0 = Enabled
                              1         SPKX         1              Speaker Mixer Disable Control
                                                     (disabled)     1 = Disabled
                                                                    0 = Enabled
                              0         MX           1              Mono Mixer Disable Control
                                                     (disabled)     1 = Disabled
                                                                    0 = Enabled
               Note: When analogue inputs or outputs are disabled, they are internally connected to VREF
               through a large resistor (VREF=AVDD/2 except when VREF and VMID1M are both OFF). This
               maintains the potential at that node and helps to eliminate pops when the pins are re-enabled.
              Table 65 Extended Power Down Register (1) (Additional to AC’97 Rev 2.2)
              Note: When disabling a PGA, always ensure that it is muted first.
Rev 4.0                                                                                                       87


                                                                              WM9713L
     REGISTER        BIT      LABEL      DEFAULT                       DESCRIPTION
     ADDRESS
    3Eh            15        MCD         1             Microphone Current Detect Disable Control
    Powerdown                            (disabled)    1 = Disabled
    (2)                                                0 = Enabled
                   14        MICBIA      1             Microphone Bias Disable Control (see Note 1)
                             S           (disabled)    1 = Disabled
                                                       0 = Enabled
                   13        MONO        1             MONO PGA Disable Control (see Note 1)
                                         (disabled)    1 = Disabled
                                                       0 = Enabled
                   12        OUT4        1             OUT4 PGA Disable Control (see Note 1)
                                         (disabled)    1 = Disabled
                                                       0 = Enabled
                   11        OUT3        1             OUT3 PGA Disable Control (see Note 1)
                                         (disabled)    1 = Disabled
                                                       0 = Enabled
                   10        HPL         1             HPL PGA Disable Control (see Note 1)
                                         (disabled)    1 = Disabled
                                                       0 = Enabled
                   9         HPR         1             HPR PGA Disable Control (see Note 1)
                                         (disabled)    1 = Disabled
                                                       0 = Enabled
                   8         SPKL        1             SPKL PGA Disable Control (see Note 1)
                                         (disabled)    1 = Disabled
                                                       0 = Enabled
                   7         SPKR        1             SPKR PGA Disable Control (see Note 1)
                                         (disabled)    1 = Disabled
                                                       0 = Enabled
                   6         LL          1             LINEL PGA Disable Control (see Note 1)
                                         (disabled)    1 = Disabled
                                                       0 = Enabled
                   5         LR          1             LINER PGA Disable Control (see Note 1)
                                         (disabled     1 = Disabled
                                                       0 = Enabled
                   4         MOIN        1             MONOIN PGA Disable Control (see Note 1)
                                         (disabled)    1 = Disabled
                                                       0 = Enabled
                   3         MA          1             MICA PGA Disable Control (see Note 1)
                                         (disabled)    1 = Disabled
                                                       0 = Enabled
                   2         MB          1             MICB PGA Disable Control (see Note 1)
                                         (disabled)    1 = Disabled
                                                       0 = Enabled
                   1         MPA         1             Mic Pre-amp MPA Disable Control
                                         (disabled)    1 = Disabled
                                                       0 = Enabled
                   0         MPB         1             Mic Pre-amp MPB Disable Control
                                         (disabled)    1 = Disabled
                                                       0 = Enabled
    Note: When analogue inputs or outputs are disabled, they are internally connected to VREF
    through a large resistor (VREF=AVDD/2 except when VREF and VMID1M are both OFF). This
    maintains the potential at that node and helps to eliminate pops when the pins are re-enabled.
   Table 66 Extended Power Down Register (2) (Additional to AC’97 Rev 2.2)
   Note: When disabling a PGA, always ensure that it is muted first.
88                                                                                            Rev 4.0


                                                                                                WM9713L
ADDITIONAL POWER MANAGEMENT
               Mixer output inverters: see “Mixer Output Inverters” section. Inverters are disabled by default.
               Touchpanel Interface: see “Controlling the Touchpanel Digitiser”. The touchpanel digitiser is OFF by
               default.
               SLEEP MODE
               Whenever the PR4 bit (reg. 26h) is set, the AC-Link interface is disabled, and the WM9713L is in
               sleep mode. There is in fact a very large number of different sleep modes, depending on the other
               control bits. For example, the low-power standby mode described below is a sleep mode. It is
               desirable to use sleep modes whenever possible, as this will save power. The following functions do
               not require a clock and can therefore operate in sleep mode:
                          Analogue-to-analogue audio (DACs and ADCs unused), e.g. phone call mode
                          Pen-down detection
                          GPIO and interrupts
                          Battery alarm / analogue comparators
               The WM9713L can awake from sleep mode as a result of
                          A warm reset on the AC-Link (according to the AC’97 specification)
                          A signal on a GPIO pin (if the pin is configured as an input, with wake-up enabled – see
                           “GPIO and Interrupt Control” section)
                          A virtual GPIO event such as pen-down, battery alarm, etc. (see “GPIO and Interrupt
                           Control” section)
               LOW-POWER STANDBY MODE
               If all the bits in registers 26h, 3Ch and 3Eh are set except VMID1M (register 3Ch, bit 14), then the
               WM9713L is in low-power standby mode and consumes very little current. A 1M resistor string
               remains connected across AVDD to generate VREF. This is necessary if the on-chip analogue
               comparators are used (see “Battery Alarm and Analogue Comparators” section), and helps shorten
               the delay between wake-up and playback readiness. If VREF is not required, the 1M resistor string
               can be disabled by setting the VMID1M bit, reducing current consumption further.
               SAVING POWER AT LOW SUPPLY VOLTAGES
               The analogue supplies to the WM9713L can run from 1.8V to 3.6V. By default, all analogue circuitry
               on the IC is optimized to run at 3.3V. This set-up is also good for all other supply voltages down to
               1.8V. However, at lower voltages, it is possible to save power by reducing the internal bias currents
               used in the analogue circuitry. This is controlled as shown below.
                  REGISTER          BIT      LABEL      DEFAULT                         DESCRIPTION
                  ADDRESS
                  5Ch              6:5      VBIAS       00             Analogue Bias Optimization Control
                                                                       0X = Default bias current, optimized for 3.3V
                                                                       10 = Low bias current, optimized for 2.5V
                                                                       11 = Lowest bias current, optimized for 1.8V
               Table 67 Analogue Bias Selection
Rev 4.0                                                                                                              89


                                                                                          WM9713L
POWER-ON RESET (POR)
                The WM9713L has an internal power on reset (PORB) which ensures that a reset is applied to all
                registers until a supply threshold has been exceeded. The POR circuitry monitors the voltage for both
                AVDD and DCVDD and will release the internal reset signal once these supplies are both nominally
                greater than 1.36V. The internal reset signal is an AND of the PORB and RESETB input signal.
                It is recommended that for operation of the WM9713L, all device power rails should be stable before
                configuring the device for operation.
90                                                                                                         Rev 4.0


                                                                                                                                                                                                      WM9713L
REGISTER MAP
R eg             N ame                   15        14        13        12        11        10         9         8         7        6         5         4         3          2         1         0  D e f a u lt
 00h Reset                                0      SE4       SE3        SE2       SE1       SE0        ID9       ID8      ID7       ID6      ID5        ID4       ID3        ID2       ID1       ID0   6174h
 02h Speaker Volume                     M UL     ZCL                              SPKLVOL                              M UR      ZCR                              SPKRVOL                            8080h
 04h Headphone Volume                   M UL     ZCL                               HPLVOL                              M UR      ZCR                              HPRVOL                             8080h
 06h OUT3/4 Volume                      M U4     ZC4                              OUT4VOL                              M U3      ZC3                             OUT3VOL                             8080h
 08h M ONO Vol & M ONOIN PGA Vol        M 2H     M 2S         0                      M ONOINVOL                         MU         ZC                            M ONOVOL                            C880h
     / Routing
 0Ah LINEIN PGA Volume / Routing         L2H     L2S       L2M                         LINELVOL                           0         0        0                        LINERVOL                       E808h
 0Ch DAC PGA Volume / Routing           D2H      D2S       D2M                        DACLVOL                             0         0        0                        DACRVOL                        E808h
 0Eh M IC PGA Volume                      0         0         0                       M ICAVOL                            0         0        0                        M ICBVOL                       0808h
 10h M IC Routing                         0         0         0         0         0         0         0          0    M A2M    M B2M M IC2M               M IC2H                M IC2HVOL           00DAh
                                                                                                                                           BST
 12h Record PGA Volume                  RM U     GRL          (Extended)                    RECVOLL                      ZC      GRR         (Extended)                     RECVOLR                  8000h
 14h Record Routing / M ux Select            R2H                    R2HVOL                     R2M            R2M         0      REC                RECSL                        RECSR               D600h
                                                                                                              BST                BST
 16h PCBEEP Volume / Routing            B2H              B2HVOL                 B2S               B2SVOL               B2M              B2M VOL                  0          0         0         0   AAA0h
 18h VxDAC Volume / Routing             V2H              V2HVOL                 V2S               V2SVOL               V2M              V2M VOL                  0          0         0         0   AAA0h
 1Ah AUXDAC Volume / Routing            A2H              A2HVOL                 A2S               A2SVOL               A2M              A2M VOL                  0          0         0         0   AAA0h
 1Ch Output PGA M ux Select                 M ONO                     SPKL                         SPKR                      HPL                HPR                 OUT3                OUT4         0000h
 1Eh DAC 3D Control & INV M ux                  INVA                           INVB                   0          0        0         0     3DLC      3DUC                     3DDEPTH                 0000h
     Select
 20h DAC Tone Control                    BB         0         0        BC                      BASS                       0      DAT         0         TC                      TRBL                  0F0Fh
 22h M IC Input Select & Bias / Detect   M ICCM PSEL           M PASEL            M PABST              M PBBST        M BOP M BOP1 M BVO                     M CDTHR                M CDSCTHR        0040h
     Ctrl                                                                                                               2EN        EN        L
 24h Output Volume M apping (Jack         0         0         0         0         0         0         0          0        0         0        0       JIEN       DCDRVSEL            EARSPKSEL        0000h
     Insert)
 26h Powerdown Ctrl/Stat                  0      PR6       PR5        PR4       PR3       PR2       PR1       PR0         0         0        0          0      REF        ANL      DAC       ADC     7F00h
 28h Extended Audio ID                   ID1      ID0         0         0      REV1      REV0      AM AP     LDAC     SDAC      CDAC         0          0      VRM       SPDIF     DRA       VRA     0405h
 2Ah Ext'd Audio Stat/Ctrl                0         0         0         0         0      SPCV         0          0        0         0           SPSA             0        SEN         0      VRA     0410h
 2Ch Audio DACs Sample Rate                                                                       DACSR (Audio DACs Sample Rate)                                                                    BB80h
 2Eh AUXDAC Sample Rate                                                                         AUXDACSR (Auxiliary DAC Sample Rate)                                                                BB80h
 32h Audio ADCs Sample Rate                                                                       ADCSR (Audio ADCs Sample Rate)                                                                    BB80h
 36h PCM codec control                  CTRL          M ODE             0                 DIV               VDAC         CP      FSP             SEL                 WL                  FM T        4523h
                                                                                                              OSR
 3Ah SPDIF control                        V      DRS             SPSR             L                             CC (Category Code)                             PRE       COPY    AUD IB       PRO    2000h
 3Ch Powerdown (1)                     PADCP    VM ID     TSHUT      VXDA     AUXD       VREF        PLL         1    DACL      DACR      ADCL      ADCR       HPLX      HPRX      SPKX       MX     FDFFh
                                          D        1M                   C       AC
 3Eh Powerdown (2)                      M CD     M IC     M ONO      OUT4     OUT3        HPL       HPR       SPKL     SPKR        LL       LR      M OIN       MA        MB       M PA      M PB    FFFFh
                                                 BIAS
 40h General Purpose                      0         0      3DE          0         0         0         0          0       LB         0        0          0        0          0         0         0    0000h
 42h Fast Power-Up Control                0         0         0         0         0         0         0          0        0    M ONO      SPKL       SPKR       HPL       HPR      OUT3     OUT4     0000h
 44h M CLK / PLL Control                  0             SEXT[6:4]                           SEXT[3:0]                 CLKSR         0              PENDIV               CLKBX     CLKAX CLKM U       0080h
                                                                                                                          C                                             2             2         X
 46h M CLK / PLL Control                              N[3:0]                     LF       SDM     DIVSEL DIVCTL           0             PGADDR                               PGDATA                  0000h
 4Ch GPIO Pin Configuration               1         1          1        1         1         1          1      GC8      GC7       GC6       GC5       GC4       GC3        GC2       GC1         0    FFFEh
 4Eh GPIO Pin Polarity / Type            C1P     C2P         PP        AP        TP        SP        MP       GP8       GP7      GP6       GP5       GP4       GP3        GP2       GP1         1    FFFFh
 50h GPIO Pin Sticky                     C1S     C2S         PS        AS        TS        SS        MS       GS8       GS7      GS6       GS5       GS4       GS3        GS2       GS1         0    0000h
 52h GPIO Pin Wake-Up                   C1W      C2W        PW        AW        TW         SW       MW        GW8      GW7       GW6      GW5        GW4       GW3        GW2       GW1         0    0000h
 54h GPIO Pin Status                     C1I      C2I         PI       AI        TI         SI        MI       GI8      GI7       GI6      GI5        GI4       GI3        GI2       GI1        0  GPIO pins
 56h GPIO Pin Sharing                     1         1          1        1         1         1          1      GE8       GE7      GE6       GE5       GE4       GE3        GE2         1         0    FFFEh
 58h GPIO Pull UP/DOWN Ctrl             PU8      PU7       PU6        PU5       PU4       PU3       PU2       PU1      PD8       PD7       PD6        PD5      PD4        PD3       PD2       PD1    4000h
 5Ah Additional Functions (1)                 COM P2DEL                 0         0         0         0     RSTDIS          JSEL              HPM ODE           Die Revision     WAKEE IRQ           0000h
                                                                                                                                                                                      N       INV
 5Ch Additional Functions (2)          AMUTE    C2 REF          C2SRC         C1REF           C1SRC              0    AM EN           VBIAS         ADCO        HPF         0            ASS         0000h
 60h ALC Control                               ALCL (target level)                       HLD (hold time)                       DCY (decay time)                         ATK (attack time)            B032h
 62h ALC / Noise Gate Control               ALCSEL                 M AXGAIN               ZCTIM EOUT             0    NGAT          0     NGG                      NGTH (threshold)                  3E00h
 64h AUXDAC input control               XSLE           AUXDACSLT                                                                AUXDAC VAL                                                           0000h
 74h Digitiser Reg 1                      0         0         0         0         0         0       POLL      CTC                                  ADCSEL                                    COO     0000h
 76h Digitiser Reg 2                      0         0         0         0         0         0             CR                           DEL                     SLEN                 SLT              0006h
 78h Digitiser Reg 3                         PRP           RPR        45W     PDEN       PDPOL     WAIT         PIL         M SK                                     RPU                             0001h
 7Ah Digitiser Read Back                PNDN             ADCSRC                                                      ADCD (TOUCHPANEL ADC Y DATA)                                                    0000h
 7Ch Vendor ID1                                                    ASCII character “ W”                                                           ASCII character “ M ”                              574Dh
 7Eh Vendor ID2                                                    ASCII character “ L”                                                             Device Identifier                                4C13h
Table 68 WM9713L Register Map
Note: Register 46h provides access to a sub-page address system to set the SPLL[6:0] and K[21:0] register bits (see Table 6).
Rev 4.0                                                                                                                                                                                                         91


                                                                                                                   WM9713L
 REGISTER BITS BY ADDRESS
  REGISTER            BIT        LABEL            DEFAULT                              DESCRIPTION                              REFER TO
  ADDRESS
00h                14:10      SE [4:0]          11000              Indicates a CODEC from Cirrus Logic                        Intel’s AC’97
read-only          9:6        ID9:6             0101               Indicates 18 bits resolution for ADCs and DACs             Component
                                                                                                                              Specification,
                   5          ID5               1                  Indicates that the WM9713L supports bass boost
                                                                                                                              Revision 2.2,
                   4          ID4               1                  Indicates that the WM9713L has a headphone                 page 50
                                                                   output
                   3          ID3               0                  Indicates that the WM9713L does not support
                                                                   simulated stereo
                   2          ID2               1                  Indicates that the WM9713L supports bass and
                                                                   treble control
                   1          ID1               0                  Indicates that the WM9713L does not support
                                                                   modem functions
                   0          ID0               0                  Indicates that the WM9713L does not have a
                                                                   dedicated microphone ADC
 Register 00h is a read-only register. Writing any value to this register resets all registers to their default, but does not change the
 contents of reg. 00h. Reading the register reveals information about the codec to the driver, as required by the AC’97 Specification,
 Revision 2.2
  REGISTER            BIT        LABEL            DEFAULT                              DESCRIPTION                              REFER TO
  ADDRESS
02h                15         MUL               1 (mute)           SPKL Mute Control                                          Analogue
                                                                   1 = Mute                                                   Audio Outputs
                                                                   0 = No mute
                   14         ZCL               0 (disabled)       SPKL Zero Cross Control
                                                                   1 = Zero cross enabled
                                                                   0 = Zero cross disabled
                   13:8       SPKLVOL           000000 (0dB)       SPKL Volume Control
                                                                   000000 = 0dB (maximum)
                                                                   … (1.5dB steps)
                                                                   011111 = -46.5dB
                                                                   1xxxxx = -46.5dB
                   7          MUR               1 (mute)           SPKR Mute Control
                                                                   1 = Mute
                                                                   0 = No mute
                   6          ZCR               0 (disabled)       SPKR Zero Cross Control
                                                                   1 = Zero cross enabled
                                                                   0 = Zero cross disabled
                   5:0        SPKRVOL           000000 (0dB)       SPKR Volume Control
                                                                   000000 = 0dB (maximum)
                                                                   … (1.5dB steps)
                                                                   011111 = -46.5dB
                                                                   1xxxxx = -46.5dB
 Register 02h controls the output pins SPKL and SPKR.
 92                                                                                                                                 Rev 4.0


                                                                                         WM9713L
 REGISTER          BIT         LABEL           DEFAULT                       DESCRIPTION    REFER TO
  ADDRESS
04h             15          MUL             1 (mute)       HPL Mute Control                Analogue
                                                           1 = Mute                        Audio Outputs
                                                           0 = No mute
                14          ZCL             0 (disabled)   HPL Zero Cross Control
                                                           1 = Zero cross enabled
                                                           0 = Zero cross disabled
                13:8        HPL VOL         000000 (0dB)   HPL Volume Control
                                                           000000 = 0dB (maximum)
                                                           … (1.5dB steps)
                                                           011111 = -46.5dB
                                                           1xxxxx = -46.5dB
                7           MUR             1 (mute)       HPR Mute Control
                                                           1 = Mute
                                                           0 = No mute
                6           ZCR             0 (disabled)   HPR Zero Cross Control
                                                           1 = Zero cross enabled
                                                           0 = Zero cross disabled
                5:0         HPR VOL         000000 (0dB)   HPR Volume Control
                                                           000000 = 0dB (maximum)
                                                           … (1.5dB steps)
                                                           011111 = -46.5dB
                                                           1xxxxx = -46.5dB
Register 04h controls the headphone output pins, HPL and HPR.
 REGISTER          BIT         LABEL           DEFAULT                       DESCRIPTION    REFER TO
  ADDRESS
06h             15          MU4             1 (mute)       OUT4 Mute Control               Analogue
                                                           1 = Mute                        Audio Outputs
                                                           0 = No mute
                14          ZC4             0 (disabled)   OUT4 Zero Cross Control
                                                           1 = Zero cross enabled
                                                           0 = Zero cross disabled
                13:8        OUT4VOL         000000 (0dB)   OUT4 Volume Control
                                                           000000 = 0dB (maximum)
                                                           … (1.5dB steps)
                                                           011111 = -46.5dB
                                                           1xxxxx = -46.5dB
                7           MU3             1 (mute)       OUT3 Mute Control
                                                           1 = Mute
                                                           0 = No mute
                6           ZC3             0 (disabled)   OUT3 Zero Cross Control
                                                           1 = Zero cross enabled
                                                           0 = Zero cross disabled
                5:0         OUT3VOL         000000 (0dB)   OUT3 Volume Control
                                                           000000 = 0dB (maximum)
                                                           … (1.5dB steps)
                                                           011111 = -46.5dB
                                                           1xxxxx = -46.5dB
Register 06h controls the analogue output pins OUT3 and OUT4.
Rev 4.0                                                                                              93


                                                                                                 WM9713L
 REGISTER          BIT         LABEL           DEFAULT                        DESCRIPTION            REFER TO
  ADDRESS
08h             15          M2H             1 (mute)        MONOIN to Headphone Mixer Mute Control Analogue
                                                            1 = Mute                               Inputs;
                                                                                                   Analogue
                                                            0 = No mute
                                                                                                   Audio Outputs
                14          M2S             1 (mute)        MONOIN to Speaker Mixer Mute Control
                                                            1 = Mute
                                                            0 = No mute
                12:8        MONOINVO        01000 (0dB)     MONOIN to Mixers Volume Control
                            L                               00000 = +12dB
                                                            … (1.5dB steps)
                                                            11111 = -34.5dB
                7           MU              1 (mute)        MONO Mute Control
                                                            1 = Mute
                                                            0 = No mute
                6           ZC              0 (disabled)    MONO Zero Cross Control
                                                            1 = Zero cross enabled
                                                            0 = Zero cross disabled
                5:0         MONOVOL         000000 (0dB)    MONO Volume Control
                                                            000000 = 0dB (maximum)
                                                            … (1.5dB steps)
                                                            011111 = -46.5dB
                                                            1xxxxx = -46.5dB
Register 08h controls the analogue output pin MONO and the analogue input pin MONOIN.
 REGISTER          BIT         LABEL           DEFAULT                        DESCRIPTION            REFER TO
  ADDRESS
0Ah             15          L2H             1 (mute)        LINE to Headphone Mixer Mute Control   Analogue
                                                            1 = Mute                               Inputs, Line
                                                                                                   Input
                                                            0 = No mute
                14          L2S             1 (mute)        LINE to Speaker Mixer Mute Control
                                                            1 = Mute
                                                            0 = No mute
                13          L2M             1 (mute)        LINE to Mono Mixer Mute Control
                                                            1 = Mute
                                                            0 = No mute
                12:8        LINELVOL        01000 (0dB)     LINEL to Mixers Volume Control
                                                            00000 = +12dB
                                                            … (1.5dB steps)
                                                            11111 = -34.5dB
                4:0         LINERVOL        01000 (0dB)     LINER to Mixers Volume Control
                                                            00000 = +12dB
                                                            … (1.5dB steps)
                                                            11111 = -34.5dB
Register 0Ah controls the analogue input pins LINEL and LINER.
94                                                                                                     Rev 4.0


                                                                                               WM9713L
 REGISTER          BIT         LABEL          DEFAULT                      DESCRIPTION                  REFER TO
  ADDRESS
0Ch             15           D2H            1 (mute)       DAC to Headphone Mixer Mute Control        Audio DACs
                                                           1 = Mute
                                                           0 = No mute
                14           D2S            1 (mute)       DAC to Speaker Mixer Mute Control
                                                           1 = Mute
                                                           0 = No mute
                13           D2M            1 (mute)       DAC to Mono Mixer Mute Control
                                                           1 = Mute
                                                           0 = No mute
                12:8         DACLVOL        01000 (0dB)    Left DAC to Mixers Volume Control
                                                           00000 = +12dB
                                                           … (1.5dB steps)
                                                           11111 = -34.5dB
                4:0          DACRVOL        01000 (0dB)    Right DAC to Mixers Volume Control
                                                           00000 = +12dB
                                                           … (1.5dB steps)
                                                           11111 = -34.5dB
Register 0Ch controls the audio DACs (but not AUXDAC).
 REGISTER          BIT         LABEL          DEFAULT                      DESCRIPTION                  REFER TO
  ADDRESS
0Eh             12:8         MICAVOL        01000 (0dB)    MICA PGA Volume Control                    Analogue
                                                           00000 = +12dB                              Inputs,
                                                                                                      Microphone
                                                           … (1.5dB steps)
                                                                                                      Input
                                                           11111 = -34.5dB
                4:0          MICBVOL        01000 (0dB)    MICB PGA Volume Control
                                                           00000 = +12dB
                                                           … (1.5dB steps)
                                                           11111 = -34.5dB
Register 0Eh controls the microphone PGA volume (MICA and MICB).
 REGISTER          BIT         LABEL          DEFAULT                      DESCRIPTION                  REFER TO
  ADDRESS
10h             7            MA2M           1 (mute)       MICA to Mono Mixer Mute Control            Analogue
                                                           1 = Mute                                   Inputs,
                                                                                                      Microphone
                                                           0 = No mute
                                                                                                      Input
                6            MB2M           1 (mute)       MICB to Mono Mixer Mute Control
                                                           1 = Mute
                                                           0 = No mute
                5            MIC2MBST       0 (0dB)        MIC to Mono Mixer Boost Control
                                                           1 = +20dB
                                                           0 = 0dB
                4:3          MIC2H          11 (mute)      MIC to Headphone Mixer Path Control
                                                           00 = stereo
                                                           01 = MICA only
                                                           10 = MICB only
                                                           11 = mute MICA and MICB
                2:0          MIC2HVOL       010 (0dB)      MIC to Headphone Mixer Path Volume Control
                                                           000 = +6dB
                                                           … (+3dB steps)
                                                           111 = -15dB
Register 10h controls the microphone routing (MICA and MICB).
Rev 4.0                                                                                                         95


                                                                                            WM9713L
 REGISTER          BIT          LABEL      DEFAULT                      DESCRIPTION              REFER TO
  ADDRESS
12h             15           RMU         1 (mute)     Audio ADC Input Mute Control              Audio ADC,
                                                      1 = Mute                                  Record Gain
                                                      0 = No mute
                14           GRL         0 (standard) Left ADC PGA Gain Range Control
                                                      1 = Extended
                                                      0 = Standard
                13:8         RECVOLL     000000 (0dB) Left ADC Recording Volume Control
                                                      Standard (GRL=0)        Extended (GRL=1)
                                                      XX0000 = 0dB            000000 = -17.25dB
                                                      … (1.5dB steps)         … (0.75dB steps)
                                                      XX1111 = +22.5dB        XX1111 = +30dB
                7            ZC          0 (disabled) ADC PGA Zero Cross Control
                                                      1 = Zero cross enabled
                                                      0 = Zero cross disabled
                6            GRR         0 (standard) Right ADC PGA Gain Range Control
                                                      1 = Extended
                                                      0 = Standard
                5:0          RECVOLR     000000 (0dB) Right ADC Recording Volume Control
                                                      Standard (GRR=0)        Extended (GRR=1)
                                                      XX0000 = 0dB            000000 = -17.25dB
                                                      … (1.5dB steps)         … (0.75dB steps)
                                                      XX1111 = +22.5dB        XX1111 = +30dB
Register 12h controls the record volume.
96                                                                                                  Rev 4.0


                                                                                                 WM9713L
 REGISTER          BIT          LABEL           DEFAULT                        DESCRIPTION                REFER TO
  ADDRESS
14h             15:14        R2H             11 (mute)       Record Mux to Headphone Mixer Path Control  Audio ADC,
                                                             00 = stereo                                 Record
                                                                                                         Selector
                                                             01 = left record mux only
                                                             10 = right rec mux only
                                                             11=mute left and right
                13:11        R2HVOL          010 (0dB)       Record Mux to Headphone Mixer Path Volume
                                                             Control
                                                             000 = +6dB
                                                             … (+3dB steps)
                                                             111 = -15dB
                10:9         R2M             11 (mute)       Record Mux to Mono Mixer Path Control
                                                             00 = stereo
                                                             01 = left record mux only
                                                             10 = right record mux only
                                                             11 = mute left and right
                8            R2MBST          0 (0dB)         Record Mux to Headphone Mixer Boost Control
                                                             1 = +20dB
                                                             0 = 0dB
                6            RECBST          0 (0dB)         ADC Record Boost Control
                                                             1 = +20dB
                                                             0 = 0dB
                5:3          RECSL           000 (mic)       Left Record Mux Source Control
                                                             000 = MICA (pre-PGA)
                                                             001 = MICB (pre-PGA)
                                                             010 = LINEL (pre-PGA)
                                                             011 = MONOIN (pre-PGA)
                                                             100 = HPMIXL
                                                             101 = SPKMIC
                                                             110 = MONOMIX
                                                             111 = Reserved
                2:0          RECSR           000 (mic)       Right Record Mux Source Control
                                                             000 = MICA (pre-PGA)
                                                             001 = MICB (pre-PGA)
                                                             010 = LINEL (pre-PGA)
                                                             011 = MONOIN (pre-PGA)
                                                             100 = HPMIXL
                                                             101 = SPKMIC
                                                             110 = MONOMIX
                                                             111 = Reserved
Register 14h controls the record selector and the ADC to mono mixer path.
Rev 4.0                                                                                                           97


                                                                                               WM9713L
 REGISTER          BIT         LABEL            DEFAULT                  DESCRIPTION                 REFER TO
  ADDRESS
16h             15           B2H              1 (mute)    PCBEEP to Headphone Mixer Mute Control   Analogue
                                                          1 = Mute                                 Inputs,
                                                                                                   PCBEEP Input
                                                          0 = No mute
                14:12        B2HVOL           010 (0dB)   PCBEEP to Headphone Mixer Volume Control
                                                          000 = +6dB
                                                          … (+3dB steps)
                                                          111 = -15dB
                11           B2S              1 (mute)    PCBEEP to Speaker Mixer Mute Control
                                                          1 = Mute
                                                          0 = No mute
                10:8         B2SVOL           010 (0dB)   PCBEEP to Speaker Mixer Volume Control
                                                          000 = +6dB
                                                          … (+3dB steps)
                                                          111 = -15dB
                7            B2M              1 (mute)    PCBEEP to Mono Mixer Mute Control
                                                          1 = Mute
                                                          0 = No mute
                6:4          B2MVOL           010 (0dB)   PCBEEP to Mono Mixer Volume Control
                                                          000 = +6dB
                                                          … (+3dB steps)
                                                          111 = -15dB
Register 16h controls the analogue input pin PCBEEP.
 REGISTER          BIT         LABEL            DEFAULT                  DESCRIPTION                 REFER TO
  ADDRESS
18h             15           V2H              1 (mute)    VXDAC to Headphone Mixer Mute Control    Audio Mixers,
                                                          1 = Mute                                 Side Tone
                                                                                                   Control
                                                          0 = No mute
                14:12        V2HVOL           010 (0dB)   VXDAC to Headphone Mixer Volume Control
                                                          000 = +6dB
                                                          … (+3dB steps)
                                                          111 = -15dB
                11           V2S              1 (mute)    VXDAC to Speaker Mixer Mute Control
                                                          1 = Mute
                                                          0 = No mute
                10:8         V2SVOL           010 (0dB)   VXDAC to Speaker Mixer Volume Control
                                                          000 = +6dB
                                                          … (+3dB steps)
                                                          111 = -15dB
                7            V2M              1 (mute)    VXDAC to Mono Mixer Mute Control
                                                          1 = Mute
                                                          0 = No mute
                6:4          V2MVOL           010 (0dB)   VXDAC to Mono Mixer Volume Control
                                                          000 = +6dB
                                                          … (+3dB steps)
                                                          111 = -15dB
Register 18h controls the output signal of the Voice DAC.
98                                                                                                     Rev 4.0


                                                                                                  WM9713L
 REGISTER          BIT         LABEL            DEFAULT                      DESCRIPTION                REFER TO
 ADDRESS
1Ah             15          A2H               1 (mute)        AUXDAC to Headphone Mixer Mute Control   Auxiliary DAC
                                                              1 = Mute
                                                              0 = No mute
                14:12       A2HVOL            010 (0dB)       AUXDAC to Headphone Mixer Volume Control
                                                              000 = +6dB
                                                              … (+3dB steps)
                                                              111 = -15dB
                11          A2S               1 (mute)        AUXDAC to Speaker Mixer Mute Control
                                                              1 = Mute
                                                              0 = No mute
                10:8        A2SVOL            010 (0dB)       AUXDAC to Speaker Mixer Volume Control
                                                              000 = +6dB
                                                              … (+3dB steps)
                                                              111 = -15dB
                7           A2M               1 (mute)        AUXDAC to Mono Mixer Mute Control
                                                              1 = Mute
                                                              0 = No mute
                6:4         A2MVOL            010 (0dB)       AUXDAC to Mono Mixer Volume Control
                                                              000 = +6dB
                                                              … (+3dB steps)
                                                              111 = -15dB
Register 1Ah controls the output signal of the auxiliary DAC.
Rev 4.0                                                                                                           99


                                                                                                      WM9713L
 REGISTER          BIT          LABEL           DEFAULT                    DESCRIPTION                   REFER TO
 ADDRESS
1Ch             15:14        MONO            00 (VMID)  MONO Source Control                             Analogue
                                                        00 = VMID                                       Audio Outputs
                                                        01 = No input (tri-stated if MONO is disabled)
                                                        10 = MONOMIX
                                                        11 = INV1
                13:11        SPKL            000 (VMID) SPKL Source Control
                                                        000 = VMID
                                                        001 = No input (tri-stated if SPKL is disabled)
                                                        010 = HPMIXL
                                                        011 = SPKMIX
                                                        100 = INV1
                                                        All other values are reserved
                10:8         SPKR            000 (VMID) SPKR Source Control
                                                        000 = VMID
                                                        001 = No input (tri-stated if SPKR is disabled)
                                                        010 = HPMIXR
                                                        011 = SPKMIX
                                                        100 = INV2
                                                        All other values are reserved
                7:6          HPL             00 (VMID)  HPL Source Control
                                                        00 = VMID
                                                        01 = No input (tri-stated if HPL is disabled)
                                                        10 = HPMIXL
                                                        11 = Reserved
                5:4          HPR             00 (VMID)  HPR Source Control
                                                        00 = VMID
                                                        01 = No input (tri-stated if HPR is disabled)
                                                        10 = HPMIXR
                                                        11 = Reserved
                3:2          OUT3            00 (VMID)  OUT3 Source Control
                                                        00 = VMID
                                                        01 = No input (tri-stated if OUT3 is disabled)
                                                        10 = INV1
                                                        11 = Reserved
                1:0          OUT4            00 (VMID)  OUT4 Source Control
                                                        00 = VMID
                                                        01 = No input (tri-stated if OUT4 is disabled)
                                                        10 = INV2
                                                        11 = Reserved
Register 1Ch controls the inputs to the output PGAs.
100                                                                                                         Rev 4.0


                                                                                                      WM9713L
 REGISTER          BIT         LABEL        DEFAULT                            DESCRIPTION                         REFER TO
 ADDRESS
1Eh             15:13       INV1         000 (no input)     INV1 Source Select                                   Audio Mixers,
                                                            000 = No input (tri-stated)                          Mixer Output
                                                                                                                 Inverters
                                                            001 = MONOMIX
                                                            010 = SPKMIX
                                                            011 = HPMIXL
                                                            100 = HPMIXR
                                                            101 = HPMIXMONO
                                                            110 = Reserved
                                                            111 = VMID
                12:10       INV2         000 (no input)     INV2 Source Select
                                                            000 = No input (tri-stated)
                                                            001 = MONOMIX
                                                            010 = SPKMIX
                                                            011 = HPMIXL
                                                            100 = HPMIXR
                                                            101 = HPMIXMONO
                                                            110 = Reserved
                                                            111 = VMID
                5           3DLC         0 (low)            3D Lower Cut-off Frequency Control                   Audio DAC,
                                                            1 = High (500Hz at 48kHz sampling)                   Stereo DAC,
                                                                                                                 3D Stereo
                                                            0 = Low (200Hz at 48kHz sampling)
                                                                                                                 Enhancement
                4           3DUC         0 (high)           3D Upper Cut-off Frequency Control
                                                            1 = Low (1.5kHz at 48kHz sampling)
                                                            0 = High (2.2kHz at 48kHz sampling)
                3:0         3DDEPTH      0000 (0%)          3D Depth Control
                                                            0000 = 0%
                                                            … (6.67% steps)
                                                            1111 = 100%
Register 1Eh controls 3D stereo enhancement for the audio DACs and input muxes to the output inverters INV1 and INV2.
Rev 4.0                                                                                                                    101


                                                                                                         WM9713L
 REGISTER          BIT         LABEL           DEFAULT                           DESCRIPTION                    REFER TO
  ADDRESS
20h             15           BB              0 (linear)         Bass Mode Control                              Audio DACs,
                                                                0 = Linear bass control                        Tone Control /
                                                                                                               Bass Boost
                                                                1 = Adaptive bass boost
                12           BC              0 (low)            Bass Cut-off Frequency Control
                                                                0 = Low (130Hz at 48kHz sampling)
                                                                1 = High (200Hz at 48kHz sampling)
                11:8         BASS            1111 (off)         Bass Intensity Control
                                                                BB=0                       BB=1
                                                                0000 = +9dB                0000 = 15dB
                                                                0001 = +9dB                … (1dB steps)
                                                                … (1.5dB steps)            1110 = 1dB
                                                                0111 = 0dB                 1111 = Bypass (off)
                                                                … (1.5dB steps)
                                                                1011-1110 = -6dB
                                                                1111 = Bypass (off)
                6            DAT             0 (0dB)            Pre-DAC Attenuation Control
                                                                0 = 0dB
                                                                1 = -6dB
                4            TC              0 (high)           Treble Cut-off Frequency Control
                                                                0 = High (8kHz at 48kHz sampling)
                                                                1 = Low (4kHz at 48kHz sampling)
                3:0          TRBL            1111 (off)         Treble Intensity Control
                                                                0000 = +9dB
                                                                0001 = +9dB
                                                                … (1.5dB steps)
                                                                0111 = 0dB
                                                                … (1.5dB steps)
                                                                1011-1110 = -6dB
                                                                1111 = Bypass (off)
Register 20h controls the bass and treble response of the left and right audio DAC (but not AUXDAC).
102                                                                                                                Rev 4.0


                                                                                                       WM9713L
 REGISTER          BIT         LABEL          DEFAULT                         DESCRIPTION                      REFER TO
  ADDRESS
22h             15:14        MICCMP         00 (mics)         MIC2A/MIC2B Pin Function Control               Analogue
                             SEL                              00 = MIC2A and MIC2B are microphone inputs     Inputs,
                                                                                                             Microphone
                                                              01 = MIC2A microphone input only
                                                                                                             Input
                                                              10 = MIC2B microphone input only
                                                              11 = MIC2A and MIC2B are not microphone inputs
                13:12        MPASEL         00 (MIC1)         MPA Pre-Amp Source Control
                                                              00 = MIC1
                                                              01 = MIC2A
                                                              10 = MIC2B
                                                              11 = Reserved
                11:10        MPABST         00 (+12dB)        MPA Pre-Amp Volume Control
                                                              00 = +12dB
                                                              01 = +18dB
                                                              10 = +24dB
                                                              11 = +30dB
                9:8          MPBBST         00 (+12dB)        MPB Pre-Amp Volume Control
                                                              00 = +12dB
                                                              01 = +18dB
                                                              10 = +24dB
                                                              11 = +30dB
                7            MBOP2EN        0 (disabled)      MICBIAS Output 2 Enable Control
                                                              1 = Enable MICBIAS output on GPIO8 (pin 12)
                                                              0 = Disable MICBIAS output on GPIO8 (pin 12)
                6            MBOP1EN        1 (enabled)       MICBIAS Output 1 Enable Control
                                                              1 = Enable MICBIAS output on MICBIAS (pin 28)
                                                              0 = Disable MICBIAS output on MICBIAS (pin 28)
                5            MBVOL          0 (0.9xAVDD)      MICBIAS Output Voltage Control
                                                              1 = 0.75 x AVDD
                                                              0 = 0.9 x AVDD
                4:2          MCDTHR         000 (100uA)       Mic Detect Threshold Control
                                                              000 = 100µA
                                                              … (100µA steps)
                                                              111 = 800µA
                1:0          MCDSCTHR       00 (600uA)        Mic Detect Short Circuit Threshold Control
                                                              00 = 600µA
                                                              01 = 1200uA
                                                              10 = 1800uA
                                                              11 = 2400µA
Register 22h controls the microphone input configuration and microphone bias and detect configuration.
Rev 4.0                                                                                                               103


                                                                                                         WM9713L
 REGISTER           BIT         LABEL          DEFAULT                         DESCRIPTION                             REFER TO
  ADDRESS
24h              4           JIEN           0 (disabled)    Jack Insert Control                                      Jack Insertion
                                                            0 = Disable jack insert circuitry                        and Auto-
                                                                                                                     Switching
                                                            1 = Enable jack insert circuitry
                 3:2         DCDRVSEL       00 (AC)         Jack Insert Headphone DC Reference Control
                                                            00 = AC coupled headphones, no DC source
                                                            01 = OUT3 is mid-rail output buffer
                                                            10 = Reserved
                                                            11 = OUT4 is mid-rail output buffer
                 1:0         EARSPK         00 (none)       Ear Speaker Source Control
                             SEL                            00 = No ear speaker
                                                            01 = MONO and HPL
                                                            10 = OUT3 and HPL
                                                            11 = OUT4 and HPL
Register 24h controls the output volume mapping on headphone jack insertion.
 REGISTER           BIT         LABEL          DEFAULT                         DESCRIPTION                             REFER TO
  ADDRESS
26h              14          PR6            1 (disabled)    Output PGAs Disable Control                              Power
                                                            1 = Disabled                                             Management
                                                            0 = Enabled
                 13          PR5            1 (disabled)    Internal Clock Disable Control
                                                            1 = Disabled
                                                            0 = Enabled
                 12          PR4            1 (disabled)    AC-Link Disable Control
                                                            1 = Disabled
                                                            0 = Enabled
                 11          PR3            1 (disabled)    Analogue Disable Control
                                                            1 = Disabled
                                                            0 = Enabled
                 10          PR2            1 (disabled)    Input PGAs and Mixers Disable Control
                                                            1 = Disabled
                                                            0 = Enabled
                 9           PR1            1 (disabled)    Stereo DAC Disable Control
                                                            1 = Disabled
                                                            0 = Enabled
                 8           PR0            1 (disabled)    Stereo ADC and Record Mux Disable Control
                                                            1 = Disabled
                                                            0 = Enabled
                 3           REF            0 (not ready)   VREF Ready (Read Only)
                                                            1 = VREF ready
                                                            0 = VREF not ready
                 2           ANL            0 (not ready)   Analogue Mixers Ready (Read Only)
                                                            1 = Analogue mixers ready
                                                            0 = Analogue mixers not ready
                 1           DAC            0 (not ready)   Stereo DAC Ready (Read Only)
                                                            1 = DAC ready
                                                            0 = DAC not ready
                 0           ADC            0 (not ready)   Stereo ADC Ready (Read Only)
                                                            1 = ADC ready
                                                            0 = ADC not ready
Register 26h is for power management according to the AC’97 specification. Note that the actual state of many circuit blocks
depends on both register 26h AND registers 3Ch and 3Eh.
104                                                                                                                       Rev 4.0


                                                                                                            WM9713L
  REGISTER           BIT         LABEL            DEFAULT                             DESCRIPTION                      REFER TO
  ADDRESS
28h               15:14       ID                00                 Indicates that the WM9713L is configured as the   Intel’s AC’97
read-only                                                          primary CODEC in the system.                      Component
                  11:10       REV               01                 Indicates that the WM9713L conforms to AC’97      Specification,
                                                                   Rev2.2                                            Revision 2.2,
                                                                                                                     page 59
                  9           AMAP              0                  Indicates that the WM9713L does not support slot
                                                                   mapping
                  8           LDAC              0                  Indicates that the WM9713L does not have an LFE
                                                                   DAC
                  7           SDAC              0                  Indicates that the WM9713L does not have
                                                                   Surround DACs
                  6           CDAC              0                  Indicates that the WM9713L does not have a
                                                                   Centre DAC
                  3           VRM               0                  Indicates that the WM9713L does not have a
                                                                   dedicated, variable rate microphone ADC
                  2           SPDIF             1                  Indicates that the WM9713L supports S/PDIF
                                                                   output
                  1           DRA               0                  Indicates that the WM9713L does not support
                                                                   double rate audio
                  0           VRA               1                  Indicates that the WM9713L supports variable rate
                                                                   audio
 Register 28h is a read-only register that indicates to the driver which advanced AC’97 features the WM9713L supports.
  REGISTER           BIT         LABEL            DEFAULT                             DESCRIPTION                      REFER TO
  ADDRESS
2Ah               10          SPCV              0                  S/PDIF Validity Bit (Read Only)                   Digital Audio
                                                                   1 = Valid                                         (S/PDIF)
                                                                                                                     Output
                                                                   0 = Not valid
                  5:4         SPSA              01 (slots 6, 9)    S/PDIF Slot Assignment Control
                                                                   00 = Slots 3 and 4
                                                                   01 = Slots 6 and 9
                                                                   10 = Slots 7 and 8
                                                                   11 = Slots 10 and 11
                  2           SEN               0 (disabled)       S/PDIF Output Enable Control
                                                                   1 = Enabled
                                                                   0 = Disabled
                  0           VRA               0 (OFF)            Variable Rate Audio Control
                                                                   1 = Enable VRA
                                                                   0 = Disable VRA (ADC and DAC run at 48kHz)
 Register 2Ah controls the S/PDIF output and variable rate audio.
 Rev 4.0                                                                                                                       105


                                                                                                            WM9713L
 REGISTER           BIT         LABEL            DEFAULT                           DESCRIPTION                      REFER TO
  ADDRESS
2Ch             all           DACSR          BB80h               Stereo DAC Sample Rate Control                    Variable Rate
                                             (48kHz)             1F40h = 8kHz                                      Audio /
                                                                                                                   Sample Rate
                                                                 2B11h = 11.025kHz
                                                                                                                   Conversion
                                                                 2EE0h = 12kHz
                                                                 3E80h = 16kHz
                                                                 5622h = 22.05kHz
                                                                 5DC0h = 24kHz
                                                                 7D00h = 32kHz
                                                                 AC44h = 44.1kHz
                                                                 BB80h = 48kHz
                                                                 Any other value defaults to the nearest supported
                                                                 sample rate
2Eh             all           AUXDACSR       BB80h               AUXDAC Sample Rate Control
                                             (48kHz)             1F40h = 8kHz
                                                                 2B11h = 11.025kHz
                                                                 2EE0h = 12kHz
                                                                 3E80h = 16kHz
                                                                 5622h = 22.05kHz
                                                                 5DC0h = 24kHz
                                                                 7D00h = 32kHz
                                                                 AC44h = 44.1kHz
                                                                 BB80h = 48kHz
                                                                 Any other value defaults to the nearest supported
                                                                 sample rate
32h             all           ADCSR          BB80h               Stereo ADC Sample Rate Control
                                             (48kHz)             1F40h = 8kHz
                                                                 2B11h = 11.025kHz
                                                                 2EE0h = 12kHz
                                                                 3E80h = 16kHz
                                                                 5622h = 22.05kHz
                                                                 5DC0h = 24kHz
                                                                 7D00h = 32kHz
                                                                 AC44h = 44.1kHz
                                                                 BB80h = 48kHz
                                                                 Any other value defaults to the nearest supported
                                                                 sample rate
Note: The VRA bit in register 2Ah must be set first to obtain sample rates other than 48kHz
Registers 2Ch, 2Eh 32h and control the sample rates for the stereo DAC, auxiliary DAC and audio ADC, respectively.
106                                                                                                                     Rev 4.0


                                                                                           WM9713L
 REGISTER          BIT        LABEL    DEFAULT                        DESCRIPTION               REFER TO
  ADDRESS
36h             15          CTRL     0 (GPIO reg) GPIO Pin Configuration Control               PCM CODEC
                                                  0 = GPIO pins used as GPIOs
                                                  1 = GPIO pins used as PCM interface
                14:13       MODE     10 (master   PCM Interface Mode Control
                                     mode)        00 = PCM interface disabled
                                                  01 = Slave mode
                                                  10 = Master mode
                                                  11 = Partial master mode
                11:9        DIV      010 (1/4)    PCMCLK Rate Control
                                                  000 = Voice DAC clock
                                                  001 = Voice DAC clock / 2
                                                  010 = Voice DAC clock / 4
                                                  011 = Voice DAC clock / 8
                                                  100 = Voice DAC clock / 16
                                                  All other values are reserved
                8           VDACOSR  0 (64x)      Voice DAC Oversampling Rate Control
                                                  0 = 64 x fs
                                                  1 = 128 x fs
                7           CP       0 (normal)   PCMCLK Polarity Control
                                                  0 = Normal
                                                  1 = Inverted
                6           FSP      0 (normal)   FMT = 00, 01 or 10          FMT = 11
                                                  PCMFS Polarity              DSP Mode Control
                                                  Control
                                                  0 = Normal                  0 = DSP Mode A
                                                  1 = Inverted                1 = DSP Mode B
                5:4         SEL      00 (normal)  PCM ADC Output Channel Control
                                                  00 = Normal stereo
                                                  01 = Reverse stereo
                                                  10 = Output left ADC data only
                                                  11 = Output right ADC data only
                3:2         WL       10 (24 bits) PCM Data Word Length Control
                                                  00 = 16-bit
                                                  01 = 20-bit
                                                  10 = 24-bit
                                                  11 = 32-bit (not supported when FMT=00)
                1:0         FMT      10 (I2S)     PCM Data Format Control
                                                  00 = Right justified
                                                  01 = Left justified
                                                  10 = I2S
                                                  11 = DSP mode
Register 36h controls the PCM CODEC.
Rev 4.0                                                                                               107


                                                                                               WM9713L
 REGISTER         BIT         LABEL          DEFAULT                    DESCRIPTION                   REFER TO
 ADDRESS
3Ah            15          V               0         S/PDIF Validity Bit                            Digital Audio
                                                     1 = Valid                                      (S/PDIF)
                                                                                                    Output
                                                     0 = Not valid
               14          DRS             0         Indicates that the WM9713L does not support
                                                     double rate S/PDIF output (read-only)
               13:12       SPSR            10        Indicates that the WM9713L only supports 48kHz
                                                     sampling on the S/PDIF output (read-only)
               11          L               0         S/PDIF L-bit Control
                                                     Programmed as required by user
               10:4        CC              0000000   S/PDIF Category Code Control
                                                     Category code; programmed as required by user
               3           PRE             0         S/PDIF Pre-emphasis Indication Control
                                                     0 = no pre-emphasis
                                                     1 = 50/15µs pre-emphasis
               2           COPY            0         S/PDIF Copyright Indication Control
                                                     0 = Copyright not asserted
                                                     1 = Copyright asserted
               1           AUDIB           0         S/PDIF Non-audio Indication Control
                                                     0 = PCM data
                                                     1 = Non-PCM data
               0           PRO             0         S/PDIF Professional Indication Control
                                                     0 = Consumer mode
                                                     1 = Professional mode
Register 3Ah Read/Write. Controls the S/PDIF output.
108                                                                                                      Rev 4.0


                                                                                                           WM9713L
  REGISTER           BIT          LABEL            DEFAULT                             DESCRIPTION                        REFER TO
   ADDRESS
3Ch               15           PADCPD            1 (disabled)       Touchpanel / AUXADC Disable Control                 Power
                                                                    1 = Disabled                                        Management
                                                                    0 = Enabled
                  14           VMID1M            1 (disabled)       1Meg VMID String Disable Control
                                                                    1 = Disabled
                                                                    0 = Enabled
                  13           TSHUT             1 (disabled)       Thermal Shutdown Disable Control
                                                                    1 = Disabled
                                                                    0 = Enabled
                  12           VXDAC             1 (disabled)       Voice DAC Disable Control
                                                                    1 = Disabled
                                                                    0 = Enabled
                  11           AUXDAC            1 (disabled)       AUXDAC Disable Control
                                                                    1 = Disabled
                                                                    0 = Enabled
                  10           VREF              1 (disabled)       VREF Disable Control
                                                                    1 = Disabled
                                                                    0 = Enabled
                  9            PLL               1 (disabled)       PLL Disable Control
                                                                    1 = Disabled
                                                                    0 = Enabled
                  7            DACL              1 (disabled)       Left DAC Disable Control
                                                                    1 = Disabled
                                                                    0 = Enabled
                  6            DACR              1 (disabled)       Right DAC Disable Control
                                                                    1 = Disabled
                                                                    0 = Enabled
                  5            ADCL              1 (disabled)       Left ADC Disable Control
                                                                    1 = Disabled
                                                                    0 = Enabled
                  4            ADCR              1 (disabled)       Right ADC Disable Control
                                                                    1 = Disabled
                                                                    0 = Enabled
                  3            HPLX              1 (disabled)       Left Headphone Mixer Disable Control
                                                                    1 = Disabled
                                                                    0 = Enabled
                  2            HPRX              1 (disabled)       Right Headphone Mixer Disable Control
                                                                    1 = Disabled
                                                                    0 = Enabled
                  1            SPKX              1 (disabled)       Speaker Mixer Disable Control
                                                                    1 = Disabled
                                                                    0 = Enabled
                  0            MX                1 (disabled)       Mono Mixer Disable Control
                                                                    1 = Disabled
                                                                    0 = Enabled
* “0” corresponds to “ON”, if and only if the corresponding bit in register 26h is also 0.
 Register 3Ch is for power management additional to the AC’97 specification. Note that the actual state of each circuit block
 depends on both register 3Ch AND register 26h.
 Rev 4.0                                                                                                                        109


                                                                                                           WM9713L
  REGISTER           BIT          LABEL            DEFAULT                             DESCRIPTION                        REFER TO
   ADDRESS
3Eh               15           MCD               1 (disabled)       Microphone Current Detect Disable Control           Power
                                                                    1 = Disabled                                        Management
                                                                    0 = Enabled
                  14           MICBIAS           1 (disabled)       Microphone Bias Disable Control
                                                                    1 = Disabled
                                                                    0 = Enabled
                  13           MONO              1 (disabled)       MONO PGA Disable Control
                                                                    1 = Disabled
                                                                    0 = Enabled
                  12           OUT4              1 (disabled)       OUT4 PGA Disable Control
                                                                    1 = Disabled
                                                                    0 = Enabled
                  11           OUT3              1 (disabled)       OUT3 PGA Disable Control
                                                                    1 = Disabled
                                                                    0 = Enabled
                  10           HPL               1 (disabled)       HPL PGA Disable Control
                                                                    1 = Disabled
                                                                    0 = Enabled
                  9            HPR               1 (disabled)       HPR PGA Disable Control
                                                                    1 = Disabled
                                                                    0 = Enabled
                  8            SPKL              1 (disabled)       SPKL PGA Disable Control
                                                                    1 = Disabled
                                                                    0 = Enabled
                  7            SPKR              1 (disabled)       SPKR PGA Disable Control
                                                                    1 = Disabled
                                                                    0 = Enabled
                  6            LL                1 (disabled)       LINEL PGA Disable Control
                                                                    1 = Disabled
                                                                    0 = Enabled
                  5            LR                1 (disabled)       LINER PGA Disable Control
                                                                    1 = Disabled
                                                                    0 = Enabled
                  4            MOIN              1 (disabled)       MONOIN PGA Disable Control
                                                                    1 = Disabled
                                                                    0 = Enabled
                  3            MA                1 (disabled)       MICA PGA Disable Control
                                                                    1 = Disabled
                                                                    0 = Enabled
                  2            MB                1 (disabled)       MICB PGA Disable Control
                                                                    1 = Disabled
                                                                    0 = Enabled
                  1            MPA               1 (disabled)       Mic Pre-amp MPA Disable Control
                                                                    1 = Disabled
                                                                    0 = Enabled
                  0            MPB               1 (disabled)       Mic Pre-amp MPB Disable Control
                                                                    1 = Disabled
                                                                    0 = Enabled
* “0” corresponds to “ON”, if and only if the corresponding bit in register 26h is also 0.
 Register 3Eh is for power management additional to the AC’97 specification. Note that the actual state of each circuit block
 depends on both register 3Eh AND register 26h.
 110                                                                                                                        Rev 4.0


                                                                                                           WM9713L
 REGISTER           BIT         LABEL           DEFAULT                           DESCRIPTION                           REFER TO
  ADDRESS
40h              13          3DE              0 (disabled)      3D Enhancement Control                                Audio DACs,
                                                                1 = Enabled                                           3D Stereo
                                                                                                                      Enhancement
                                                                0 = Disabled
                 7           LB               0 (disabled)      Digital Loopback Control                              Intel’s AC’97
                                                                1 = Enabled                                           Component
                                                                                                                      Specification,
                                                                0 = Disabled
                                                                                                                      Revision 2.2,
                                                                                                                      page 55
Register 40h is a “general purpose” register as defined by the AC’97 specification. Only two bits are implemented in the WM9713L.
 REGISTER           BIT         LABEL           DEFAULT                           DESCRIPTION                           REFER TO
  ADDRESS
42h              6           MONO             0 (normal)        MONO Fast Power Up Control                            Analogue
                                                                1 = Fast power up                                     Audio Outputs,
                                                                                                                      Power-Up
                                                                0 = Normal power up
                 5           SPKL             0 (normal)        SPKL Fast Power Up Control
                                                                1 = Fast power up
                                                                0 = Normal power up
                 4           SPKR             0 (normal)        SPKR Fast Power Up Control
                                                                1 = Fast power up
                                                                0 = Normal power up
                 3           HPL              0 (normal)        HPL Fast Power Up Control
                                                                1 = Fast power up
                                                                0 = Normal power up
                 2           HPR              0 (normal)        HPR Fast Power Up Control
                                                                1 = Fast power up
                                                                0 = Normal power up
                 1           OUT3             0 (normal)        OUT3 Fast Power Up Control
                                                                1 = Fast power up
                                                                0 = Normal power up
                 0           OUT4             0 (normal)        OUT4 Fast Power Up Control
                                                                1 = Fast power up
                                                                0 = Normal power up
Register 42h controls power-up conditions for output PGAs.
Rev 4.0                                                                                                                         111


                                                                                             WM9713L
 REGISTER          BIT          LABEL          DEFAULT                      DESCRIPTION         REFER TO
  ADDRESS
44h             14:12        SEXT[6:4]       000 (div 1)  Hi-Fi Block Clock Division Control   Clock
                                                          000 = f                              Generation
                                                          001 = f/2
                                                          …
                                                          111 = f/8
                11:8         SEXT[3:0]       0000 (div 1) Voice DAC Clock Division Control
                                                          0000 = f
                                                          0001 = f/2
                                                           …
                                                          1111 = f/16
                7            CLKSRC          1 (external) AC97 CLK Source Control
                                                          1 = External clock
                                                          0 = PLL clock
                5:3          PENDIV          000 (f/16)   AUXADC Clock Division Control
                                                          000 = f/16
                                                          001 = f/12
                                                          010 = f/8
                                                          011 = f/6
                                                          100 = f/4
                                                          101 = f/3
                                                          110 = f/2
                                                          111 = f
                2            CLKBX2          0 (normal)   MCLKB Multiplier Control
                                                          0 = Normal
                                                          1 = Multiply by 2
                1            CLKAX2          0 (Off)      MCLKA Multiplier Control
                                                          0 = Normal
                                                          1 = Multiply by 2
                0            CLKMUX          0 (MCLKA)    External Clock Source Control
                                                          0 = Use MCLKA
                                                          1 = Use MCLKB
Register 44h controls clock division and muxing.
112                                                                                                Rev 4.0


                                                                                                      WM9713L
 REGISTER          BIT         LABEL          DEFAULT                         DESCRIPTION                    REFER TO
  ADDRESS
46h             15:12       N[3:0]          0000 (div by 1) PLL N Divide Control                            PLL Mode
                                                            0000 = Divide by 1
                                                            0001 = Divide by 1
                                                            0010 = Divide by 2
                                                            …
                                                            1111 = Divide by 15
                11          LF              0 (normal)      PLL Low Frequency Input Control
                                                            1 = Low frequency mode (input clock < 8.192MHz)
                                                            0 = Normal mode
                10          SDM             0 (disabled)    PLL SDM Enable Control
                                                            1 = Enable SDM (required for fractional N mode)
                                                            0 = Disable SDM
                9           DIVSEL          0 (div by 1)    PLL Input Clock Division Control
                                                            0 = Divide by 1
                                                            1 = Divide according to DIVCTL
                8           DIVCTL          0               PLL Input Clock Division Value Control
                                                            0 = Divide by 2
                                                            1 = Divide by 4
                6:4         PGADDR          000             Pager Address
                                                            Pager address bits to access programming of
                                                            K[21:0] and SPLL[6:0]
                3:0         PGDATA          0000            Pager Data
                                                            Pager data bits
Register 46h controls PLL clock generation.
Rev 4.0                                                                                                             113


                                                                                                           WM9713L
  REGISTER          BIT         LABEL         DEFAULT                            DESCRIPTION                      REFER TO
  ADDRESS
4Ch              n            GCn           1 (input)          GPIO Pin Configuration Control                   GPIO and
                                                               0 = Output                                       Interrupt
                                                                                                                Control
                                                               1 = Input (GC9-15 are always inputs)
4Eh              n            GPn           1 (active high)    GPIO Pin Polarity / Type
                                                               Input (GCn = 1)              Output (GCn = 0)
                                                               0 = Active low               0 = CMOS output
                                                               1 = Active high              1 = Open drain
50h              n            GSn           0 (not sticky)     GPIO Pin Sticky Control
                                                               0 = Not sticky
                                                               1 = Sticky
52h              n            GWn           0 (no wake-        GPIO Pin Wake-up Control
                                            up)                0 = No wake-up (no interrupts generated by GPIO)
                                                               1 = Wake-up (generate interrupts from GPIO)
54h              n            GIn           N/A                GPIO Pin Status
                                                               Read = Returns status of GPIO
                                                               Write = Writing 0 clears sticky bits
Bit definitions  15                                            Controls Comparator 1 signal (virtual GPIO)
for registers    14                                            Controls Comparator 2 signal (virtual GPIO)
4Ch to 54h
                 13                                            Controls Pen-Down Detector signal (virtual GPIO)
                 12                                            Controls ADA signal (virtual GPIO)
                 11                                            Controls Thermal sensor signal (virtual GPIO)
                 10                                            Controls Microphone short detect (virtual GPIO)
                 9                                             Controls Microphone insert detect (virtual GPIO)
                 8                                             Controls GPIO8 (pin 12)
                 7                                             Controls GPIO7 (pin 11)
                 6                                             Controls GPIO6 (pin 3)
                 5                                             Controls GPIO5 (pin 48)
                 4                                             Controls GPIO4 (pin 47)
                 3                                             Controls GPIO3 (pin 46)
                 2                                             Controls GPIO2 (pin 45)
                 1                                             Controls GPIO1 (pin 44)
 Register 4Ch to 54h control the GPIO pins and virtual GPIO signals.
 114                                                                                                                 Rev 4.0


                                                                                                         WM9713L
 REGISTER          BIT          LABEL          DEFAULT                           DESCRIPTION                 REFER TO
  ADDRESS
56h             8            GE8             1 (GPIO)         GPIO8 (Pin 12) Function Control              GPIO and
                                                              0 = Pin 12 is not controlled by GPIO logic   Interrupt
                                                                                                           Control
                                                              1 = Pin 12 is controlled by GPIO logic
                7            GE7             1 (GPIO)         GPIO7 (Pin 11) Function Control
                                                              0 = Pin 11 is not controlled by GPIO logic
                                                              1 = Pin 11 is controlled by GPIO logic
                6            GE6             1 (GPIO)         GPIO6 (Pin 3) Function Control
                                                              0 = Pin 3 is not controlled by GPIO logic
                                                              1 = Pin 3 is controlled by GPIO logic
                5            GE5             1 (GPIO)         GPIO5 (Pin 48) Function Control
                                                              0 = Pin 48 is not controlled by GPIO logic
                                                              1 = Pin 48 is controlled by GPIO logic
                4            GE4             1 (GPIO)         GPIO4 (Pin 47) Function Control
                                                              0 = Pin 47 is not controlled by GPIO logic
                                                              1 = Pin 47 is controlled by GPIO logic
                3            GE3             1 (GPIO)         GPIO3 (Pin 46) Function Control
                                                              0 = Pin 46 is not controlled by GPIO logic
                                                              1 = Pin 46 is controlled by GPIO logic
                2            GE2             1 (GPIO)         GPIO2 (Pin 45) Function Control
                                                              0 = Pin 45 is not controlled by GPIO logic
                                                              1 = Pin 45 is controlled by GPIO logic
Register 56h controls the use of GPIO pins for non-GPIO functions.
 REGISTER          BIT          LABEL          DEFAULT                           DESCRIPTION                 REFER TO
  ADDRESS
58h             15:8         PU              01000000         GPIO Pin Pull-Up Control                     GPIO and
                                                              1 = Enables weak pull-up on GPIO pins        Interrupt
                                                                                                           Control
                                                              0 = No pull-up on GPIO pins
                7:0          PD              00000000         GPIO Pin Pull-Down Control
                                                              1 = Enables weak pull-down on GPIO pins
                                                              0 = No pull-down on GPIO pins
Register 58h controls GPIO pull-up/down.
Rev 4.0                                                                                                              115


                                                                                                    WM9713L
 REGISTER         BIT          LABEL            DEFAULT                       DESCRIPTION                   REFER TO
 ADDRESS
5Ah           15:13         COMP2DEL         000 (no delay) Low Battery Alarm Delay Control               Battery Alarm
                                                            000 = No delay
                                                            001 = 213 AC-link frames
                                                            010 = 214 AC-link frames
                                                            011 = 215 AC-link frames
                                                            100 = 216 AC-link frames
                                                            101 = 217 AC-link frames
                                                            110 = 218 AC-link frames
                                                            111 = 219 AC-link frames
              8             RSTDIS           0 (RESETB      RESETB Pin Disable Control                    GPIO Interrupt
                                             enabled)       0 = Pin 11 is RESETB                          and Control
                                                            1 = Pin 11 is GPIO (RESETB function disabled)
              7:6           JSEL             00 (GPIO1)     Jack Detect Pin Input Control                 Jack Insertion
                                                            00 = GPIO1                                    & Auto-
                                                                                                          Switching
                                                            01 = GPIO6
                                                            10 = GPIO7
                                                            11 = GPIO8
              5:4           HPMODE           00 (7Hz)       HPF Cut-Off Control                           Audio ADCs
                                                            00 = 7Hz @ fs=48kHz
                                                            01 = 82Hz @ fs=16kHz
                                                            10 = 82Hz @ fs=8kHz
                                                            11 = 170Hz @ fs=8kHz
              3:2           DIE REV          N/A            Device Revision (Read-Only)                   N/A
                                                            00 = Rev.A
                                                            01 = Rev.B
                                                            10 = Rev.C
              1             WAKEEN           0 (disabled)   GPIO Wake Up Control                          GPIO and
                                                            0 = Disable wake-up                           Interrupt
                                                                                                          Control
                                                            1 = Enable wake up
              0             IRQ INV          0 (normal)     IRQ Polarity Control
                                                            0 = Normal
                                                            1 = Inverted
Register 5Ah controls several additional functions.
116                                                                                                            Rev 4.0


                                                                                                    WM9713L
 REGISTER         BIT          LABEL            DEFAULT                       DESCRIPTION                  REFER TO
 ADDRESS
5Ch           15            AMUTE            0               DAC Automute Status (Read-Only)             Audio DACs,
                                                             0 = DAC not muted                           Stereo DACs
                                                             1 = DAC auto-muted
              14            C2REF            0 (AVDD/2)      Comparator 2 Reference Voltage Select       Battery Alarm
                                                             0 = AVDD/2
                                                             1 = WIPER/AUX4 (pin 12)
              13:12         C2SRC            00 (power       Comparator 2 Signal Source
                                             down)           00 = AVDD/2 when C2REF=1, else powered down
                                                             01 = COMP1/AUX1 (pin 29)
                                                             10 = COMP2/AUX2 (pin 30)
                                                             11 = Reserved
              11            C1REF            0 (AVDD/2)      Comparator 1 Reference Voltage Select
                                                             0 = AVDD/2
                                                             1 = WIPER/AUX4 (pin 12)
              10:9          C1SRC            00 (OFF)        Comparator 1 Signal Source
                                                             00 = AVDD/2 when C1REF=1, else powered down
                                                             01 = COMP1/AUX1 (pin 29)
                                                             10 = COMP2/AUX2 (pin 30)
                                                             11 = Reserved
              7             AMEN             0 (OFF)         DAC Automute Control                        Stereo DAC
                                                             0 = Disabled
                                                             1 = Enabled
              6:5           VBIAS            00 (3.3V)       Analogue Bias Optimization Control          Power
                                                             0X = Optimized for 3.3V                     Management
                                                             10 = Optimized for 2.5V
                                                             11 = Optimized for 1.8V
              4             ADCO             0               S/PDIF Data Source Control                  Digital Audio
                                             (SDATAOUT)      0 = From SDATAOUT                           (S/PDIF)
                                                                                                         Output
                                                             1 = Output from audio ADC
              3             HPF              0 (enabled)     ADC HPF Disable Control                     Audio ADC
                                                             0 = HPF enabled
                                                             1 = HPF disabled
              1:0           ASS              00 (slots 3, 4) ADC Data Slot Mapping Control               Audio ADC,
                                                                           Left Data        Right Data   ADC Slot
                                                                                                         Mapping
                                                             00 =            Slot 3             Slot 4
                                                             01 =            Slot 7             Slot 8
                                                             10 =            Slot 6             Slot 9
                                                             11 =           Slot 10           Slot 11
Register 5Ch controls several additional functions.
Rev 4.0                                                                                                            117


                                                                                                     WM9713L
 REGISTER         BIT          LABEL        DEFAULT                             DESCRIPTION             REFER TO
 ADDRESS
60h           15:12        ALCL           1011 (-12dB)      ALC Target Level Control                   Audio ADC,
                                                            0000 = -28.5dBFS                           Automatic
                                                                                                       Level Control
                                                            … (1.5dB steps)
                                                            1111 = -6dBFS
              11:8         HLD            0000 (0ms)        ALC Hold Time Control
                                                            0000 = 0ms
                                                            0001 = 2.67ms
                                                            … (time doubles with every step)
                                                            1111 = 43.691s
              7:4          DCY            0011 (192ms)      ALC Decay Time Control
                                                            0000 = 24ms
                                                            … (time doubles with every step)
                                                            1010 to 1111 = 24.58s
              3:0          ATK            0010 (24ms)       ALC Attack Time Control
                                                            0000 = 6ms
                                                            … (time doubles with every step)
                                                            1010 to 1111 = 6.14s
62h           15:14        ALCSEL         00 (disabled)     ALC Function Channel Control
                                                            00 = ALC disabled
                                                            01 = ALC on right channel only
                                                            10 = ALC or left channel only
                                                            11 = ALC on both left and right channels
              13:11        MAXGAIN        111 (+30dB)       ALC PGA Gain Limit Control
                                                            000 = -12dB
                                                            … (6dB steps)
                                                            111 = +30dB
              10:9         ZC             11 (slowest)      ALC Zero Cross Timeout Delay Control
                           TIMEOUT                          00 = 214 x tBITCLK (1.33ms)
                                                            01 = 215 x tBITCLK (2.67ms)
                                                            10 = 216 x tBITCLK (5.33ms)
                                                            11 = 217 x tBITCLK (10.67ms)
              7            NGAT           0 (disabled)      Noise Gate Enable Control
                                                            0 = Disabled
                                                            1 = Enabled
              5            NGG            0 (hold gain)     Noise Gate Function Control
                                                            0 = Hold PGA gain at last value
                                                            1 = Mute ADC output
              4:0          NGTH           00000 (-          Noise Gate Threshold Control
                                          76.5dB)           00000 = -76.5dBFS
                                                            … (1.5dB steps)
                                                            11111 = -30dBFS
Registers 60h and 62h control the ALC and Noise Gate functions.
118                                                                                                        Rev 4.0


                                                                                                       WM9713L
 REGISTER         BIT           LABEL            DEFAULT                         DESCRIPTION                   REFER TO
 ADDRESS
64h           15             XSLE              0 (DC)        AUXDAC Input Select Control                      Auxiliary DAC
                                                             0 = From AUXDACVAL[11:0] (for DC signals)
                                                             1 = From AC-Link (for AC signals)
              14:12          AUXDAC            000 (Slot 5)  AUXDAC Input Control (XSLE=1)
                             SLT                             000 = Slot 5, bits 8-19
                                                             001 = Slot 6, bits 8-19
                                                             010 = Slot 7, bits 8-19
                                                             011 = Slot 8, bits 8-19
                                                             100 = Slot 9, bits 8-19
                                                             101 = Slot 10, bits 8-19
                                                             110 = Slot 11, bits 8-19
                                                             111 = Reserved
              11:0           AUXDAC            000h (min)    AUXDAC Input Control (XSLE=0)
                             VAL                             000h = Minimum
                                                             FFFh = Full scale
Register 64h controls the input signal of the auxiliary DAC.
 REGISTER         BIT           LABEL            DEFAULT                          DESCRIPTION                   REFER TO
 ADDRESS
74h           9              POLL              0             Poll Measurement Control                          Touchpanel
                                                             Writing “1” initiates a measurement (when CTC is  Interface
                                                             not set)
              8              CTC               0 (Polling)   AUXADC Measurement Mode
                                                             0 = Polling mode
                                                             1 = Continuous mode (for DMA)
              7              ADCSEL_           0 (disabled)  AUX4 Measurement Enable Control
                             AUX4                            0 = Disable AUX4 measurement (pin 12)
                                                             1 = Enable AUX4 measurement (pin 12)
              6              ADCSEL_           0 (disabled)  AUX3 Measurement Enable Control
                             AUX3                            0 = Disable AUX3 measurement (SPKVDD/3)
                                                             1 = Enable AUX3 measurement (SPKVDD/3)
              5              ADCSEL_           0 (disabled)  AUX2 Measurement Enable Control
                             AUX2                            0 = Disable AUX2 measurement (pin 30)
                                                             1 = Enable AUX2 measurement (pin 30)
              4              ADCSEL_           0 (disabled)  AUX1 Measurement Enable Control
                             AUX1                            0 = Disable AUX1 measurement (pin 29)
                                                             1 = Enable AUX1 measurement (pin 29)
              3              ADCSEL_           0 (disabled)  Pressure Measurement Enable Control
                             PRESSURE                        0 = Disable pressure measurement
                                                             1 = Enable pressure measurement
              2              ADCSEL_Y          0 (disabled)  Y Co-ordinate Measurement Enable Control
                                                             0 = Disable Y co-ordinate measurement
                                                             1 = Enable Y co-ordinate measurement
              1              ADCSEL_X          0 (disabled)  X Co-ordinate Measurement Enable Control
                                                             0 = Disable X co-ordinate measurement
                                                             1 = Enable X co-ordinate measurement
              0              COO               0 (single)    Co-ordinate Mode Control
                                                             0 = Single measurement
                                                             1 = Co-ordinate measurement
Register 74h controls the measurements for the touchpanel interface.
Rev 4.0                                                                                                                 119


                                                                                                      WM9713L
 REGISTER         BIT          LABEL           DEFAULT                          DESCRIPTION                     REFER TO
 ADDRESS
76h           9:8            CR              00 (93.75Hz)    Continuous Mode Conversion Rate                   Touchpanel
                                                             DEL < 1111                 DEL = 1111             Interface
                                                             00 = 93.75Hz               00 = 8kHz
                                                             01 = 120Hz                 01 = 12kHz
                                                             10 = 153.75kHz             10 = 24kHz
                                                             11 = 187.5Hz               11 = 48kHz
              7:4            DEL             0000 (20.8s)   Touchpanel Settling Time Control
                                                             0000 = 1 AC-link frame (20.8µs)
                                                             0001 = 2 AC-link frames (41.7µs)
                                                             0010 = 4 AC-link frames (83.3µs)
                                                             0011 = 8 AC-link frames (167µs)
                                                             0100 = 16 AC-link frames (333µs)
                                                             0101 = 32 AC-link frames (667µs)
                                                             0110 = 48 AC-link frames (1ms)
                                                             0111 = 64 AC-link frames (1.33ms)
                                                             1000 = 96 AC-link frame (2ms)
                                                             1001 = 128 AC-link frames (2.67ms)
                                                             1010 = 160 AC-link frames (3.33ms)
                                                             1011 = 192 AC-link frames (4ms)
                                                             1100 = 224 AC-link frames (4.67ms)
                                                             1101 = 256 AC-link frames (5.33ms)
                                                             1110 = 288 AC-link frames (6ms)
                                                             1111 = No delay, switch matrix always on
              3              SLEN            1 (enabled)     Slot Readback Enable Control
                                                             0 = Disabled (readback through register map only)
                                                             1 = Enabled (readback slot selected by SLT)
              2:0            SLT             110 (slot 11)   AC’97 Slot for Touchpanel Data Control
                                                             000 = Slot 5
                                                             001 = Slot 6
                                                             010 = Slot 7
                                                             011 = Slot 8
                                                             100 = Slot 9
                                                             101 = Slot 10
                                                             110 = Slot 11
                                                             111 = Reserved
Register 76h controls the touchpanel interface measurement timing.
120                                                                                                               Rev 4.0


                                                                                                              WM9713L
 REGISTER         BIT           LABEL           DEFAULT                            DESCRIPTION                    REFER TO
 ADDRESS
78h           15:14          PRP              00 (disabled)     Touchpanel Digitiser Power State Control         Touchpanel
                                                                00 = Disabled                                    Interface
                                                                01 = Enable pen detect, wake-up on pen down
                                                                10 = Enable pen detect, no wake-up on pen down
                                                                11 = Pen detect and pen digitizer enabled
              13             RPR              0 (AC-link)       Pen Detect Wake-up Mode Control
                                                                0 = Wake AC-link only
                                                                1 = Wake-up AC-link and WM9713
              12             45W              0 (4-wire)        Touchpanel Type Control
                                                                0 = 4-wire
                                                                1 = 5-wire
              11             PDEN             0 (always)        Touchpanel Measurement Pen Status Control
                                                                0 = Measure regardless of pen status
                                                                1 = Measure only when pen is down
              10             PDPOL            0 (normal)        PENDOWN Polarity Control
                                                                0 = Normal
                                                                1 = Inverted
              9              WAIT             0 (overwrite)     Touchpanel ADC Data Control
                                                                0 = Overwrite existing data in 7Ah with new data
                                                                1 = Retain existing data in 7Ah until it is read
              8              PIL              0 (200A)         Pressure Measurement Current Control
                                                                0 = 200µA
                                                                1 = 400µA
              7:6            MSK              00 (disabled)     Mask Input Control
                                                                00 = Disabled
                                                                01 = Static
                                                                10 = Edge-triggered
                                                                11 = Synchronous
              5:0            RPU              000001            Internal Pull-up Resistor Control
                                              (64k)            000000 = Reserved
                                                                000001 = 64kΩ/1 (most sensitive)
                                                                000010 = 64kΩ/2
                                                                000011 = 64kΩ/3
                                                                … (64kΩ/binary value of RPU)
                                                                111111 = 64kΩ/63 (least sensitive)
Register 78h controls the physical properties of the touchpanel interface.
Rev 4.0                                                                                                                  121


                                                                                                         WM9713L
 REGISTER          BIT          LABEL           DEFAULT                             DESCRIPTION                REFER TO
 ADDRESS
7Ah            15            PNDN             0 (pen up)        Pen Status (Read-only)                        Touchpanel
read only                                                       0 = Pen up                                    Interface
                                                                1 = Pen down
               14:12         ADCSRC           000 (none)        Touchpanel ADC Source
                                                                000 = No measurement
                                                                001 = X co-ordinate measurement
                                                                010 = Y co-ordinate measurement
                                                                011 = Pressure measurement (4-wire only)
                                                                100 = COMP1/AUX1 measurement (pin 29)
                                                                101 = COMP2/AUX2 measurement (pin 30)
                                                                110 = AUX3 measurements (SPKVDD/3)
                                                                111 = WIPER/AUX4 measurement (pin 12)
               11:0          ADCD             000h              Touchpanel ADC Data (Read-only)
                                                                Bit 0 = LSB
                                                                Bit 11 = MSB
 Registers 7Ah is a read-only register which reports the touchpanel interface status and measurement results.
  REGISTER          BIT         LABEL           DEFAULT                             DESCRIPTION                REFER TO
  ADDRESS
7Ch              15:8        F7:0             57h               ASCII character “W” for Wolfson               Intel’s AC’97
read-only        7:0         S7:0             4Dh               ASCII character “M”                           Component
                                                                                                              Specification
7Eh              15:8        T7:0             4Ch               ASCII character “L”
                                                                                                              , Revision
read-only        7:0         REV7:0           13h               Device identifier                             2.2, page 50
 Register 7Ch and 7Eh are read-only registers that indicate to the driver that the CODEC is a WM9713L.
 122                                                                                                             Rev 4.0


                                                 WM9713L
APPLICATIONS INFORMATION
RECOMMENDED EXTERNAL COMPONENTS
Figure 36 Recommended External Component Diagram
Rev 4.0                                                123


                                                                                          WM9713L
LINE OUTPUT
               The headphone outputs, HPL and HPR, can be used as stereo line outputs. The speaker outputs,
               SPKL and SPKR, can also be used as line outputs. Recommended external components are shown
               below.
                                                    C1         R1
                                                    1uF     100 Ohm
                                    HPOUTL /                                  LINE-OUT
                                       SPKL                                    SOCKET
                                                                                (LEFT)
                    WM9713L                                           HPGND/SPKGND
                                    HPOUTR /                                  LINE-OUT
                                       SPKR                                    SOCKET
                                                                               (RIGHT)
                                                    C2         R2
                                                    1uF     100 Ohm  HPGND/SPKGND
               Figure 37 Recommended Circuit for Line Output
               The DC blocking capacitors and the load resistance together determine the lower cut-off frequency, fc.
               Assuming a 10 k load and C1, C2 = 10F:
                          fc = 1 / 2 (RL+R1) C1 = 1 / (2 x 10.1k x 1F) = 16 Hz
               Increasing the capacitance lowers fc, improving the bass response. Smaller values of C1 and C2 will
               diminish the bass response. The function of R1 and R2 is to protect the line outputs from damage
               when used improperly.
AC-COUPLED HEADPHONE OUTPUT
               The circuit diagram below shows how to connect a stereo headphone to the WM9713L.
                                                 C1 220uF
                                   HPL
                                   HPR
                   WM9713L
                                                 C2 220uF
                                   HPGND = 0V
               Figure 38 Simple Headphone Output Circuit Diagram
               The DC blocking capacitors C1 and C2 together with the load resistance determine the lower cut-off
               frequency, fc. Increasing the capacitance lowers fc, improving the bass response. Smaller
               capacitance values will diminish the bass response. For example, with a 16 load and C1 = 220F:
                          fc = 1 / 2 RLC1 = 1 / (2 x 16 x 220F) = 45 Hz
124                                                                                                        Rev 4.0


                                                                                              WM9713L
DC-COUPLED (CAPLESS) HEADPHONE OUTPUT
                In the interest of saving board space and cost, it may be desirable to eliminate the 220F DC blocking
                capacitors. This can be achieved by using OUT3 as a headphone pseudo-ground, as shown below.
                                       HPL
                     WM9713L
                                       HPR
                                       OUT3 = AVDD/2
                Figure 39 Capless Headphone Output Circuit Diagram
                As the OUT3 pin produces a DC voltage of AVDD/2, there is no DC offset between HPL/HPR and
                OUT3, and therefore no DC blocking capacitors are required. However, this configuration has some
                drawbacks:
                          The power consumption of the WM9713L is increased, due to the additional power
                           consumed in the OUT3 output buffer.
                          If the DC coupled output is connected to the line-in of a grounded piece of equipment, then
                           OUT3 becomes short-circuited. Although the built-in short circuit protection will prevent any
                           damage to the WM9713L, the audio signal will not be transmitted properly.
                          OUT3 cannot be used for another purpose
BTL LOUDSPEAKER OUTPUT
                SPKL and SPKR can differentially drive a mono 8 loudspeaker as shown below.
                                                  -1              SPKL
                                                        SPKLVOL
                                                                              Stereo: VSPKR = R-(-L) = L+R
                       WM9713L
                                                                              Mono: VSPKR = M-(-M) = 2M
                                                                  SPKR
                                                        SPKRVOL
                Figure 40 Speaker Output Connection (INV = 1)
                To drive out differentially one of the speaker outputs must be inverted using INV1 or INV2.
Rev 4.0                                                                                                            125


                                                                                         WM9713L
COMBINED HEADSET / BTL EAR SPEAKER
               In smartphone applications with a loudspeaker and separate ear speaker (receiver), a BTL ear
               speaker can be connected at the OUT3 pin, as shown below.
                                OUT3
                                                  BTL ear
                                                  speaker
                                HPL
                   WM9713L
                                HPR
                                HPGND = 0V
               Figure 41 Combined Headset / BTL Ear Speaker
               The ear speaker and the headset play the same signal. Whenever the headset is plugged in, the
               headphone outputs are enabled and OUT3 disabled. When the headset is not plugged in, OUT3 is
               enabled (see “Jack Insertion and Auto-Switching”)
COMBINED HEADSET / SINGLE-ENDED EAR SPEAKER
               Instead of a BTL ear speaker, a single-ended ear speaker can also be used, as shown below.
                                OUT3
                                                    ear speaker
                                                    (single-ended)
                                HPL
                   WM9713L
                                HPR
                                HPGND = 0V
               Figure 42 Combined Headset / Single-ended Ear Speaker
126                                                                                                     Rev 4.0


                                                                                              WM9713L
JACK INSERT DETECTION
                The circuit diagram below shows how to detect when a headphone or headset has been plugged into
                the headphone socket. It generates an interrupt, instructing the controller to enable HPL and HPR and
                disable OUT3.
                                                   DBVDD
                                         HPR               +   -
                                         HPL                                                        L      R
                                                           +   -
                                               100k
                  interrupt
                      logic               GPIO
                                                                       switch closes
                                                                        on insertion
                Figure 43 Jack Insert Detection Circuit
                The circuit requires a headphone socket with a switch that closes on insertion (for using sockets with
                a switch that opens on insertion, please refer to Application Note WAN0182). It detects both
                headphones and phone headsets. Any GPIO pin can be used, provided that it is configured as an
                input.
HOOKSWITCH DETECTION
                Alternatively a headphone socket with a switch that opens on insertion can be used. For this mode of
                operation the GPIO input must be inverted.
                The circuit diagram below shows how to detect when the “hookswitch” of a phone headset is pressed
                (pressing the hookswitch is equivalent to lifting the receiver in a stationary telephone).
                         WM9713L                 HPR           +   -
                                                                                        L     R
                                                 HPL
                                                 AGND          +   -
                                                 MIC1/2A/2B                                             HOOK
                                                                                        MIC
                    interrupt                    GPIO                                                   SWITCH
                        logic
                                                 MICBIAS                                    47
                                                        6802.2k
                                                                                       PHONE HEADSET
                Figure 44 Hookswitch Detection Circuit
                The circuit uses a GPIO pin as a sense input. The impedance of the microphone and the resistor in
                the MICBIAS path must be such that the potential at the GPIO pin is above 0.7DBVDD when the
                hookswitch is open, and below 0.3DBVDD when it is closed.
Rev 4.0                                                                                                          127


                                                                                                                       WM9713L
TYPICAL OUTPUT CONFIGURATIONS
                The WM9713L has three outputs capable of driving loads down to 16 (headphone / line drivers) –
                HPL, HPR and MONO - and four outputs capable of driving loads down to 8 (loudspeaker / line
                drivers) – SPKL, SPKR, OUT3 and OUT4. The combination of output drivers, mixers and mixer
                inverters means that many output configurations can be supported. Below are some examples of
                typical output configurations for smartphone applications.
                STEREO SPEAKER
                Figure 45 shows a typical output configuration for stereo speakers with headphones, ear speaker and
                hands-free operation. The table shows suggested mixer outputs to select for each output PGA for a
                given operating scenario. (Note the inverted mixer outputs can be achieved using the mixer output
                inverters INV1 and INV2).
                                                 MONO
                                                             Ear Speaker                                Hands-free
                                                             32R                  HP                    32R
                                                                                16/32R
                                                   HPL
                                  PHONE            HPR
                                  MIXER
                              HEADPHONE           SPKL
                                  MIXER
                                 SPEAKER
                                  MIXER
                                                  SPKR              Stereo                  Stereo
                                                                    Speaker (R)             Speaker (L)
                                                                    8R                      8R
                                                  OUT3
                                                  OUT4
                  Config/ Hands-free Hands-free Ear Speaker Ear Speaker Ear Speaker Ear Speaker                          Stereo
                   Driver (1:mmix) (2:spkmix)     (1:mmix)   (2:hpmix) (1) + Speaker (2) + Speaker                      Speaker Headphone
                   mono      mmix      spkmix       mmix       -hpmixR                   mmix                 -hpmixR       -        ZH
                    spkl       -          -           -              -                  hpmixL                  hpmixL   hpmixL     (ZH)
                    spkr       -          -           -              -                 hpmixR                  hpmixR    hpmixR       -
                    hpl       ZH         ZH          Vmid       hpmixL                   Vmid                   hpmixL      -     hpmixL
                    hpr        -          -           -              -                    -                        -        -     hpmixR
                   out3        -          -           -              -                 -hpmixR                -hpmixR   -hpmixR       -
                   out4        -          -           -              -                 -hpmixL                 -hpmixL  -hpmixL    (Vmid)
                Figure 45 Stereo Speaker Output Configuration
128                                                                                                                                Rev 4.0


                                                                                                      WM9713L
        MONO SPEAKER
        Figure 46 shows a typical output configuration for mono speaker with headphones, ear speaker and
        hands-free operation. The table shows suggested mixer outputs to select for each output PGA for a
        given operating scenario. (Note the inverted mixer outputs can be achieved using the mixer output
        inverters INV1 and INV2).
                                         MONO
                                                                                       Hands-free
                                                                     HP                32R
                                                                   16/32R
                                           HPL
                         PHONE             HPR
                         MIXER
                      HEADPHONE           SPKL
                         MIXER
                        SPEAKER
                         MIXER
                                         SPKR                                  Mono
                                                       Ear Speaker
                                                                               Speaker
                                                       32R
                                                                               8R
                                          OUT3
                                          OUT4
          Config/ Hands-free Hands-free Ear Speaker Ear Speaker Ear Speaker Ear Speaker                 Mono
           Driver (1:mmix) (2:spkmix)     (1:mmix)   (2:hpmix) (1) + Speaker (2) + Speaker             Speaker Headphone
           mono     mmix      spkmix          -             -                -                    -                  -
            spkl      -          -            -             -              hpmixL              hpmixL   spkmix     (ZH)
            spkr      -          -          mmix      hpmixR                mmix              hpmixR                 -
            hpl       -          -            -             -                -                    -              hpmixL
            hpr       -          -            -             -                -                    -              hpmixR
           out3       -          -          -mmix     -hpmixL              -mmix              -hpmixL                -
           out4       -          -            -             -             -hpmixR            -hpmixR   -spkmix    (Vmid)
        Figure 46 Mono Speaker Output Configuration
Rev 4.0                                                                                                                  129


                                                                                                   WM9713L
    WM9713L MONO SPEAKER
    Figure 47 shows a typical output configuration compatible with the WM9712 for mono speaker with
    headphones, ear speaker and hands-free operation. The table shows suggested mixer outputs to
    select for each output PGA for a given operating scenario. (Note the inverted mixer outputs can be
    achieved using the mixer output inverters INV1 and INV2).
    When using this configuration note that AVDD, HPVDD and SPKVDD must all be at the same voltage
    to achieve the best performance.
                                     MONO
                                                                                    Hands-free
                                                                       HP           32R
                                                                     16/32R
                                       HPL
                     PHONE             HPR
                     MIXER
                  HEADPHONE           SPKL
                     MIXER
                                                             Mono
                                                             Speaker
                    SPEAKER                                  8R
                     MIXER
                                     SPKR
                                                 Ear Speaker
                                                 32R
                                      OUT3
                                      OUT4
      Config/ Hands-free Hands-free Ear Speaker Ear Speaker Ear Speaker Ear Speaker                  Mono
       Driver (1:mmix) (2:spkmix)     (1:mmix)   (2:hpmix) (1) + Speaker (2) + Speaker              Speaker Headphone
       mono     mmix      spkmix          -              -                     -               -                  -
        spkl      -          -            -              -                   hpmixL         hpmixL   spkmix       -
        spkr      -          -                                              -hpmixR        hpmixR   -spkmix       -
        hpl       -          -           Vmid       hpmixL                    mmix          hpmixL            hpmixL
        hpr       -          -            -              -                     -               -              hpmixR
       out3       -          -          mmix       -hpmixR                   -mmix        -hpmixR               (ZH)
       out4       -          -            -              -                     -               -                  -
    Figure 47 WM9713L Mono Speaker Configuration
130                                                                                                            Rev 4.0


                                                                                                                                                                      WM9713L
PACKAGE DIMENSIONS
  FL: 48 PIN QFN PLASTIC PACKAGE 7 X 7 X 0.9 mm BODY, 0.50 mm LEAD PITCH                                                                                                  DM103.A
                                               D2
                                                                                  SEE DETAIL 1
                                                                                                                                                       D
                                                         D2/2
                37                                                          48
                                                                                          L
                                                                                                              INDEX AREA
         36                                                                          1                        (D/2 X E/2)
                                                        EXPOSED
                                                        GROUND 6                          E2/2
                                                        PADDLE
                                                                                                   E2                                                                                 E
                                                                                                    SEE DETAIL 2
         25                                                                          12
                                                                                                        2X        aaa C
                24                                                          13
                                                                                 b
                                                                                                         2X            aaa C
                     e                                                                                                                              TOP VIEW
                                      BOTTOM VIEW
                                                                                                             ccc C
  (A3)                                                                                         A
                                                                                                              0.08 C
   C     SEATING PLANE                  SIDE VIEW                                             A1
                                                                                                                               DETAIL 1                    DETAIL 2
                                                                                 DETAIL 3                                                                                  1   Terminal
                                                                                                                                                                  Datum
                                                         W                                                                                                                     Tip
                                                                                                                                              45°
                                                                    T                                                                                                          e/2
                         (A3)                                                                                                      0.30mm
                                                    H                   G                                                           EXPOSED                                e
                                                                                                                                    GROUND
                                    b                                                                                               PADDLE
                                Exposed lead        Half etch tie bar
                                                                   DETAIL 3
              Symbols                          Dimensions (mm)
                                     MIN       NOM        MAX                                           NOTE
                A                    0.80       0.90      1.00
                A1                     0        0.02      0.05
                A3                           0.20 REF
                 b                  0.18        0.25      0.30                                           1
                D                            7.00 BSC
                D2                  5.55        5.65      5.75
                E                            7.00 BSC
                E2                  5.55        5.65      5.75
                 e                           0.5 BSC
                G                               0.20
                H                               0.10
                L                   0.30         0.4      0.50
                T                              0.103
                W                               0.15
                                  Tolerances of Form and Position
               aaa                              0.15
               bbb                              0.10
               ccc                              0.10
               REF                      JEDEC, MO-220, VARIATION VKKD-4
NOTES:
1. DIMENSION b APPLIED TO METALLIZED TERMINAL AND IS MEASURED BETWEEN 0.15 mm AND 0.30 mm FROM TERMINAL TIP.
2. ALL DIMENSIONS ARE IN MILLIMETRES
3. THE TERMINAL #1 IDENTIFIER AND TERMINAL NUMBERING CONVENTION SHALL CONFORM TO JESD 95-1 SPP-002.
4. COPLANARITY APPLIES TO THE EXPOSED HEAT SINK SLUG AS WELL AS THE TERMINALS.
5. THIS DRAWING IS SUBJECT TO CHANGE WITHOUT NOTICE.
6. REFER TO APPLICATION NOTE WAN_0118 FOR FURTHER INFORMATION REGARDING PCB FOOTPRINTS AND QFN PACKAGE SOLDERING.
Rev 4.0                                                                                                                                                                                   131


                                                                                                                 WM9713L
IMPORTANT NOTICE
Contacting Cirrus Logic Support
For all product questions and inquiries, contact a Cirrus Logic Sales Representative.
To find one nearest you, go to www.cirrus.com.
For the purposes of our terms and conditions of sale, "Preliminary" or "Advanced" datasheets are non-final datasheets that include
but are not limited to datasheets marked as “Target”, “Advance”, “Product Preview”, “Preliminary Technical Data” and/or “Pre-
production.” Products provided with any such datasheet are therefore subject to relevant terms and conditions associated with
"Preliminary" or "Advanced" designations. The products and services of Cirrus Logic International (UK) Limited; Cirrus Logic, Inc.;
and other companies in the Cirrus Logic group (collectively either “Cirrus Logic” or “Cirrus”) are sold subject to Cirrus Logic’s terms
and conditions of sale supplied at the time of order acknowledgment, including those pertaining to warranty, indemnification, and
limitation of liability. Software is provided pursuant to applicable license terms. Cirrus Logic reserves the right to make changes to its
products and specifications or to discontinue any product or service without notice. Customers should therefore obtain the latest
version of relevant information from Cirrus Logic to verify that the information is current and complete. Testing and other quality
control techniques are utilized to the extent Cirrus Logic deems necessary. Specific testing of all parameters of each device is not
necessarily performed. In order to minimize risks associated with customer applications, the customer must use adequate design
and operating safeguards to minimize inherent or procedural hazards. Cirrus Logic is not liable for applications assistance or
customer product design. The customer is solely responsible for its selection and use of Cirrus Logic products. Use of Cirrus Logic
products may entail a choice between many different modes of operation, some or all of which may require action by the user, and
some or all of which may be optional. Nothing in these materials should be interpreted as instructions or suggestions to choose one
mode over another. Likewise, description of a single mode should not be interpreted as a suggestion that other modes should not be
used or that they would not be suitable for operation. Features and operations described herein are for illustrative purposes only.
CERTAIN APPLICATIONS USING SEMICONDUCTOR PRODUCTS MAY INVOLVE POTENTIAL RISKS OF DEATH, PERSONAL
INJURY, OR SEVERE PROPERTY OR ENVIRONMENTAL DAMAGE (“CRITICAL APPLICATIONS”). CIRRUS LOGIC PRODUCTS
ARE NOT DESIGNED, AUTHORIZED OR WARRANTED FOR USE IN PRODUCTS SURGICALLY IMPLANTED INTO THE BODY,
AUTOMOTIVE SAFETY OR SECURITY DEVICES, NUCLEAR SYSTEMS, LIFE SUPPORT PRODUCTS OR OTHER CRITICAL
APPLICATIONS. INCLUSION OF CIRRUS LOGIC PRODUCTS IN SUCH APPLICATIONS IS UNDERSTOOD TO BE FULLY AT
THE CUSTOMER’S RISK AND CIRRUS LOGIC DISCLAIMS AND MAKES NO WARRANTY, EXPRESS, STATUTORY OR
IMPLIED, INCLUDING THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR PARTICULAR PURPOSE,
WITH REGARD TO ANY CIRRUS LOGIC PRODUCT THAT IS USED IN SUCH A MANNER. IF THE CUSTOMER OR
CUSTOMER’S CUSTOMER USES OR PERMITS THE USE OF CIRRUS LOGIC PRODUCTS IN CRITICAL APPLICATIONS,
CUSTOMER AGREES, BY SUCH USE, TO FULLY INDEMNIFY CIRRUS LOGIC, ITS OFFICERS, DIRECTORS, EMPLOYEES,
DISTRIBUTORS AND OTHER AGENTS FROM ANY AND ALL LIABILITY, INCLUDING ATTORNEYS’ FEES AND COSTS, THAT
MAY RESULT FROM OR ARISE IN CONNECTION WITH THESE USES.
This document is the property of Cirrus Logic and by furnishing this information, Cirrus Logic grants no license, express or implied,
under any patents, mask work rights, copyrights, trademarks, trade secrets or other intellectual property rights. Any provision or
publication of any third party’s products or services does not constitute Cirrus Logic’s approval, license, warranty or endorsement
thereof. Cirrus Logic gives consent for copies to be made of the information contained herein only for use within your organization
with respect to Cirrus Logic integrated circuits or other products of Cirrus Logic, and only if the reproduction is without alteration and
is accompanied by all associated copyright, proprietary and other notices and conditions (including this notice). This consent does
not extend to other copying such as copying for general distribution, advertising or promotional purposes, or for creating any work for
resale. This document and its information is provided “AS IS” without warranty of any kind (express or implied). All statutory
warranties and conditions are excluded to the fullest extent possible. No responsibility is assumed by Cirrus Logic for the use of
information herein, including use of this information as the basis for manufacture or sale of any items, or for infringement of patents
or other rights of third parties. Cirrus Logic, Cirrus, the Cirrus Logic logo design, and SoundClear are among the trademarks of
Cirrus Logic. Other brand and product names may be trademarks or service marks of their respective owners.
Copyright © 2008–2016 Cirrus Logic, Inc. All rights reserved.
132                                                                                                                              Rev 4.0


                                                                                      WM9713L
REVISION HISTORY
 DATE    REV ORIGINATOR                                    CHANGES                                    PAGE
13/10/08 3.3     BK     Corrected pin numbers for GPIO6 and GPIO8                                     114
         3.3     BK     Added note with power-down sequence for VXDAC (see CE000296)                  42
24/12/09 3.3     BK     Added AUXDAC THD/SNR min/typ specs
03/08/10 3.3     SS     Made changes to ‘Thermal Sensor’ section and Table 40 to correct and clarify. 60
30/08/10 3.3     SS     Added note in Table 62 ‘GPIO Control’ to exclude Thermal Sensor from polarity 86
                        description and refer to Table 40 ‘Thermal Shutdown Control’.
13/10/11 3.3   JMacD    Order codes updated from WM9713LGEFL/RV and WM9713LGEFL/RV to                 4
                        WM9713CLGEFL/RV and WM9713CLGEFL/RV to reflect change to copper
                        wire bonding
13/10/11 3.3   JMacD    Package Diagram changed to DM103.A                                            136
19/12/16 4.0     PH     Updated to Cirrus Logic template
Rev 4.0                                                                                                  133


Mouser Electronics
Authorized Distributor
Click to View Pricing, Inventory, Delivery & Lifecycle Information:
Cirrus Logic:
 WM9713CLGEFL/V WM9713CLGEFL/RV WM9713LGEFL/V
