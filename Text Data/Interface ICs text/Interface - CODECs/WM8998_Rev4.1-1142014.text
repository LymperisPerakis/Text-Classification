                                                                                                                      WM8998
                             High Performance Audio Hub CODEC
DESCRIPTION                                                              FEATURES
The WM8998 is a highly-integrated low-power audio hub                      Hi-Fi audio hub CODEC for mobile applications
CODEC for smartphones, tablets and other portable audio                    Digital audio processing core
devices. It is optimised for use in multimedia devices where
                                                                            -   Fully flexible digital signal routing and mixing
the audio processing requirements are implemented on the
host applications processor.                                                -   Wind noise, sidetone and other programmable filters
                                                                            -   Dynamic Range Control (compressor, limiter)
The WM8998 digital core combines fixed-function signal
processing blocks with a fully-flexible, all-digital audio mixing           -   Fully parametric EQs
and routing engine, for extensive use-case flexibility. Signal              - Low-pass / High-pass filters
processing blocks include filters, EQ, dynamics processors                 Multi-channel asynchronous sample rate conversion
and sample rate converters.                                                Integrated multi-channel 24-bit hi-fi audio hub CODEC
A SLIMbus® interface supports multi-channel audio paths                     -   3 ADCs, 96dB SNR microphone input (48kHz)
and host control register access. Multiple sample rates are                 - 7 DACs, 122dB SNR headphone playback (48kHz)
supported concurrently via the SLIMbus interface. Three
                                                                           Audio inputs
further digital audio interfaces are provided, each supporting
a wide range of standard audio sample rates and serial                      -   Up to 6 analogue or 3 digital microphone inputs
interface formats. Automatic sample rate detection enables                  - Single-ended or differential mic/line inputs
seamless wideband/narrowband voice call handover.                          Stereo headphone output driver
The stereo headphone driver provides ground-referenced                      -   28mW into 32Ω load at 0.1% THD+N
outputs, with noise levels as low as 1μVRMS for hi-fi quality               -   6.9mW typical headphone playback power consumption
line or headphone output. The CODEC also features a                         -   Pop suppression functions
stereo line output, stereo 2W Class-D speaker outputs, a
                                                                            - 1µVRMS noise floor (A-weighted)
dedicated BTL earpiece output, PDM for external speaker
amplifiers, and an IEC-60958-3 compatible S/PDIF                           Ground-referenced line output driver
transmitter. A signal generator for controlling haptics devices             - Stereo single-ended or Mono differential configuration
is included; vibe actuators can connect directly to the Class-             Mono BTL earpiece output driver
D speaker output, or via an external driver on the PDM                      - 100mW into 32Ω BTL load at 5% THD+N
output interface. All inputs, outputs and system interfaces
                                                                           Stereo (2 x 2W) Class D speaker output drivers
can function concurrently.
                                                                            - Direct drive of external haptics vibe actuators
The WM8998 supports up to six analogue mic/line inputs,
                                                                           Two-channel digital speaker (PDM) output interface
and up to three PDM digital inputs. The input multiplexers
support up to three signal paths. Microphone activity                      IEC-60958-3 compatible S/PDIF transmitter
detection with interrupt is available. A smart accessory                   SLIMbus audio and control interface
interface supports most standard 3.5mm accessories.                        3 full digital audio interfaces
Impedance sensing and measurement is provided for                           -   Standard sample rates from 8kHz up to 192kHz
external accessory and push-button detection.
                                                                            -   TDM support on all AIFs
The WM8998 power, clocking and output driver                                - 6 channel input and output on AIF1 and AIF2
architectures are all designed to maximise battery life in
                                                                           Flexible clocking, derived from MCLKn, BCLKn or SLIMbus
voice, music and standby modes. Low-power ‘Sleep’ is
supported, with configurable wake-up events. The WM8998                    2 low-power FLLs support reference clocks down to 32kHz
is powered from a 1.8V external supply. A separate supply                  Advanced accessory detection functions
is required for the Class D speaker drivers (typically direct               - Low-power standby mode and configurable wake-up
connection to 4.2V battery).                                               Configurable functions on 5 GPIO pins
Two integrated FLLs provide support for a wide range of                    Integrated LDO regulators and charge pumps
system clock frequencies. The WM8998 is configured using                   Support for single 1.8V supply operation
the I2C or SLIMbus interfaces. The fully-differential internal
                                                                           Small W-CSP package, 0.4mm pitch
analogue architecture, minimal analogue signal paths and
on-chip RF noise filters ensure a very high degree of noise
immunity.
                                                                         APPLICATIONS
                                                                           Smartphones and Multimedia handsets
                                                                           Tablets and Mobile Internet Devices (MID)
                                                                                                                                  Rev 4.1
                                                    Copyright  Cirrus Logic, Inc., 2014–2017                                    JAN ‘17
       http://www.cirrus.com                                  (All Rights Reserved)


                                                                                                                                                                                                                                                                                               WM8998
BLOCK DIAGRAM
                                                       MICVDD                      CP2VOUT            CP2CA   CP2CB            CP1CA     CP1CB   CP1VOUTP   CP1VOUTN   CPVDD      CPGND                DBVDD1     DBVDD2   DBVDD3   DCVDD     LDOVDD    LDOENA   LDOVOUT
                                                                                                                                                                                                DGND
          MICBIAS1
                                  MICBIAS
          MICBIAS2               Generators
                                                                         LDO 2                     Charge Pump 2                  Charge Pump 1                                                                                                        LDO 1
          MICBIAS3                                                                                                                                                                                                                                                                                             SPKVDDL
                                                                                                                                                                                                                                                                                                               SPKGNDL
             AVDD                                                                                                                                                                                                                                                                                              SPKVDDR
                                 Reference
             AGND                                                                                                                                                                                                                                                                                              SPKGNDR
                                 Generator
            VREFC
                                                                                                                                                                                                                                                                               DAC                             HPOUTL
                                                                                                                                                                                                                                                                                                               HPOUTFB1/MICDET2
            IN1BLN
                                                                                                                                                                                                                                                                               DAC                             HPOUTR
            IN1BLP
                                              -
IN1ALN/DMICCLK1
                                                                ADC
                                              +                                                                                                                                                                                                                                DAC                             LINEOUTL
            IN1ALP
                                                                                                                                                                                                                                                                                                               LINEOUTFB
                                                                                                                                                                                                                                                                               DAC                             LINEOUTR
           IN1BRN                                                                                                              Digital Core
           IN1BRP
                                              -
IN1ARN/DMICDAT1                                                                                                        5-Band Equaliser (EQ)
                                                                ADC
                                                                                                                                                                                                                                                                                                               EPOUTP
           IN1ARP                             +                                                                     Dynamic Range Control (DRC)                                                                                                                                DAC
                                                                                                                                                                                                                                                                                                               EPOUTN
                                                                                                                  Low Pass / High Pass Filter (LHPF)
                                                  Digital Mic
                                                   Interface
                                                                                                              Asynchronous Sample Rate Conversion
                                                                                                                Automatic Sample Rate Detection                                                                                                                                                                SPKOUTLP
                                                                                                                                                                                                                                                                               DAC
                                                                                                                                                                                                                                                                                                               SPKOUTLN
             IN2BN                                                                                                            Tone Generator
                                                                                                                         PWM Signal Generator                                                                                                                                                                  SPKOUTRP
                                                                                                                                                                                                                                                                               DAC
             IN2BP                                                                                                                                                                                                                                                                                             SPKOUTRN
                                                                                                                      Haptic Control Signal Generator
                                              -
    IN2AN/DMICCLK2
                                                                ADC
                                                                                                                        S/PDIF Output Generator
                                              +
    IN2AP/DMICDAT2                                                                                                                                                                                                                                                                                             SPKCLK
                                                                                                                                                                                                                                                                                      PDM Driver
                                                                                                                                                                                                                                                                                                               SPKDAT
                                                  Digital Mic
                                                   Interface
                                                                                                                                                                                                                                                                                                               JACKDET
                                                                                                                                                                                                                AEC (Echo Cancellation) Loopback                                   External Accessory          MICDET1/HPOUTFB2
                                                                                                                                                                                                                                                                                         Detect                HPDETL
                                                                                                                                                                                                                                                                                                               HPDETR
           MCLK1
           MCLK2                          Clocking
                      AIFnBCLK            Control                     SYSCLK
                                                                                                           Digital Audio                Digital Audio                           Digital Audio           SLIM Bus                                                                                    Control
                     AIFnLRCLK                                        ASYNCCLK                                                                                                                                                               GPIO
                                             2 x FLL                                                      Interface AIF1               Interface AIF2                          Interface AIF3           Interface                                                                                  Interface
                      SLIMCLK
                                                                                                                                                                                                                                            GPIO1                                                ADDR
                                                                                                                                                                                                                                                                           GPSWP
                                                                                 RESET
                                                                                             IRQ
                                                                                                         AIF1TXDAT                     AIF2TXDAT                               AIF3TXDAT
                                                                                                                                                                                                           SLIMCLK                          GPIO2
                                                                                                                                                                                                                                            GPIO3                                                SCLK
                                                                                                         AIF1RXDAT                     AIF2RXDAT                               AIF3RXDAT                                                    GPIO4                                                 SDA
                                                                                                                                                                                                                                                                           GPSWN
                                                                                                                                                                                                           SLIMDAT
                                                                                                                                                                                                                                            GPIO5
                                                                                                          AIF1BCLK                      AIF2BCLK                                AIF3BCLK
                                                                                                         AIF1LRCLK                     AIF2LRCLK                               AIF3LRCLK
2                                                                                                                                                                                                                                                                                                                   Rev 4.1


                                                                                                                                                         WM8998
                                                       TABLE OF CONTENTS
DESCRIPTION ................................................................................................................ 1
FEATURES ..................................................................................................................... 1
APPLICATIONS ............................................................................................................. 1
BLOCK DIAGRAM ......................................................................................................... 2
TABLE OF CONTENTS.................................................................................................. 3
PIN CONFIGURATION ................................................................................................... 7
ORDERING INFORMATION ........................................................................................... 8
PIN DESCRIPTION ......................................................................................................... 8
ABSOLUTE MAXIMUM RATINGS ............................................................................... 12
RECOMMENDED OPERATING CONDITIONS ............................................................ 13
ELECTRICAL CHARACTERISTICS ............................................................................ 14
 TERMINOLOGY ....................................................................................................................... 25
THERMAL CHARACTERISTICS.................................................................................. 26
TYPICAL PERFORMANCE .......................................................................................... 27
 TYPICAL POWER CONSUMPTION ........................................................................................ 27
 TYPICAL SIGNAL LATENCY ................................................................................................... 28
SIGNAL TIMING REQUIREMENTS ............................................................................. 29
 SYSTEM CLOCK & FREQUENCY LOCKED LOOP (FLL) ...................................................... 29
 AUDIO INTERFACE TIMING ................................................................................................... 31
   DIGITAL MICROPHONE (DMIC) INTERFACE TIMING ...............................................................................................................31
   DIGITAL SPEAKER (PDM) INTERFACE TIMING ........................................................................................................................32
   DIGITAL AUDIO INTERFACE - MASTER MODE .........................................................................................................................33
   DIGITAL AUDIO INTERFACE - SLAVE MODE ............................................................................................................................34
   DIGITAL AUDIO INTERFACE - TDM MODE ................................................................................................................................35
 CONTROL INTERFACE TIMING ............................................................................................. 36
 SLIMBUS INTERFACE TIMING ............................................................................................... 37
DEVICE DESCRIPTION ............................................................................................... 38
 INTRODUCTION ...................................................................................................................... 38
   HI-FI AUDIO CODEC.....................................................................................................................................................................38
   DIGITAL AUDIO CORE .................................................................................................................................................................39
   DIGITAL INTERFACES .................................................................................................................................................................39
   OTHER FEATURES ......................................................................................................................................................................40
 INPUT SIGNAL PATH .............................................................................................................. 41
   ANALOGUE MICROPHONE INPUT .............................................................................................................................................42
   ANALOGUE LINE INPUT ..............................................................................................................................................................43
   DIGITAL MICROPHONE INPUT ...................................................................................................................................................43
   INPUT SIGNAL PATH ENABLE ....................................................................................................................................................45
   INPUT SIGNAL PATH SAMPLE RATE CONTROL ......................................................................................................................46
   INPUT SIGNAL PATH CONFIGURATION ....................................................................................................................................46
   INPUT SIGNAL PATH DIGITAL VOLUME CONTROL .................................................................................................................50
   DIGITAL MICROPHONE INTERFACE PULL-DOWN ...................................................................................................................53
 DIGITAL CORE ........................................................................................................................ 54
   DIGITAL CORE MIXERS ...............................................................................................................................................................57
   DIGITAL CORE INPUTS ...............................................................................................................................................................59
   DIGITAL CORE OUTPUTS ...........................................................................................................................................................60
   5-BAND PARAMETRIC EQUALISER (EQ) ...................................................................................................................................63
   DYNAMIC RANGE CONTROL (DRC) ...........................................................................................................................................67
   LOW PASS / HIGH PASS DIGITAL FILTER (LHPF) ....................................................................................................................76
   SPDIF OUTPUT GENERATOR .....................................................................................................................................................79
   TONE GENERATOR .....................................................................................................................................................................81
Rev 4.1                                                                                                                                                                                   3


                                                                                                                                                              WM8998
   HAPTIC SIGNAL GENERATOR ....................................................................................................................................................83
   PWM GENERATOR ......................................................................................................................................................................86
   SAMPLE RATE CONTROL ...........................................................................................................................................................88
   ASYNCHRONOUS SAMPLE RATE CONVERTER (ASRC) .........................................................................................................96
   ISOCHRONOUS SAMPLE RATE CONVERTER (ISRC) ..............................................................................................................99
  DIGITAL AUDIO INTERFACE ................................................................................................ 104
   MASTER AND SLAVE MODE OPERATION ...............................................................................................................................105
   AUDIO DATA FORMATS ............................................................................................................................................................105
   AIF TIMESLOT CONFIGURATION .............................................................................................................................................107
   TDM OPERATION BETWEEN THREE OR MORE DEVICES ....................................................................................................109
  DIGITAL AUDIO INTERFACE CONTROL ............................................................................. 111
   AIF SAMPLE RATE CONTROL ..................................................................................................................................................111
   AIF MASTER / SLAVE CONTROL ..............................................................................................................................................111
   AIF SIGNAL PATH ENABLE .......................................................................................................................................................114
   AIF BCLK AND LRCLK CONTROL .............................................................................................................................................116
   AIF DIGITAL AUDIO DATA CONTROL .......................................................................................................................................120
   AIF TDM AND TRI-STATE CONTROL ........................................................................................................................................123
   AIF DIGITAL PULL-UP AND PULL-DOWN .................................................................................................................................124
  SLIMBUS INTERFACE .......................................................................................................... 127
   SLIMBUS DEVICES ....................................................................................................................................................................127
   SLIMBUS FRAME STRUCTURE ................................................................................................................................................127
   CONTROL SPACE ......................................................................................................................................................................127
   DATA SPACE ..............................................................................................................................................................................128
  SLIMBUS CONTROL SEQUENCES ..................................................................................... 129
   DEVICE MANAGEMENT & CONFIGURATION ..........................................................................................................................129
   INFORMATION MANAGEMENT .................................................................................................................................................129
   VALUE MANAGEMENT (INCLUDING REGISTER ACCESS) ....................................................................................................130
   FRAME & CLOCKING MANAGEMENT ......................................................................................................................................130
   DATA CHANNEL CONFIGURATION ..........................................................................................................................................131
  SLIMBUS INTERFACE CONTROL ........................................................................................ 132
   SLIMBUS DEVICE PARAMETERS .............................................................................................................................................132
   SLIMBUS MESSAGE SUPPORT ................................................................................................................................................132
   SLIMBUS PORT NUMBER CONTROL .......................................................................................................................................135
   SLIMBUS SAMPLE RATE CONTROL ........................................................................................................................................135
   SLIMBUS SIGNAL PATH ENABLE .............................................................................................................................................136
   SLIMBUS CONTROL REGISTER ACCESS ...............................................................................................................................137
   SLIMBUS CLOCKING CONTROL ...............................................................................................................................................139
  OUTPUT SIGNAL PATH ........................................................................................................ 141
   OUTPUT SIGNAL PATH ENABLE ..............................................................................................................................................143
   OUTPUT SIGNAL PATH SAMPLE RATE CONTROL ................................................................................................................145
   OUTPUT SIGNAL PATH CONTROL ...........................................................................................................................................146
   OUTPUT SIGNAL PATH DIGITAL VOLUME CONTROL ...........................................................................................................147
   OUTPUT SIGNAL PATH NOISE GATE CONTROL ....................................................................................................................152
   OUTPUT SIGNAL PATH AEC LOOPBACK ................................................................................................................................153
   HEADPHONE/LINE/EARPIECE OUTPUTS AND MONO MODE ...............................................................................................155
   SPEAKER OUTPUTS (ANALOGUE) ..........................................................................................................................................156
   SPEAKER OUTPUTS (DIGITAL) ................................................................................................................................................157
  EXTERNAL ACCESSORY DETECTION ............................................................................... 159
   JACK DETECT ............................................................................................................................................................................159
   JACK POP SUPPRESSION (MICDET CLAMP AND GP SWITCH) ...........................................................................................161
   MICROPHONE DETECT .............................................................................................................................................................163
   HEADPHONE DETECT ...............................................................................................................................................................168
  LOW POWER SLEEP CONFIGURATION ............................................................................. 173
   SLEEP MODE..............................................................................................................................................................................173
   SLEEP CONTROL SIGNALS - JD1, GP5, MICDET CLAMP ......................................................................................................176
4                                                                                                                                                                                 Rev 4.1


                                                                                                                                                           WM8998
   WAKE-UP TRANSITION .............................................................................................................................................................177
   WRITE SEQUENCE CONTROL..................................................................................................................................................178
   INTERRUPT CONTROL ..............................................................................................................................................................179
 GENERAL PURPOSE INPUT / OUTPUT .............................................................................. 180
   GPIO CONTROL .........................................................................................................................................................................181
   GPIO FUNCTION SELECT .........................................................................................................................................................183
   BUTTON DETECT (GPIO INPUT) ..............................................................................................................................................186
   LOGIC ‘1’ AND LOGIC ‘0’ OUTPUT (GPIO OUTPUT) ................................................................................................................186
   INTERRUPT (IRQ) STATUS OUTPUT .......................................................................................................................................187
   OPCLK AND OPCLK_ASYNC CLOCK OUTPUT .......................................................................................................................187
   FREQUENCY LOCKED LOOP (FLL) STATUS OUTPUT ...........................................................................................................189
   FREQUENCY LOCKED LOOP (FLL) CLOCK OUTPUT .............................................................................................................189
   SPDIF AUDIO OUTPUT ..............................................................................................................................................................190
   PULSE WIDTH MODULATION (PWM) SIGNAL OUTPUT .........................................................................................................190
   HEADPHONE DETECTION STATUS OUTPUT .........................................................................................................................190
   MICROPHONE / ACCESSORY DETECTION STATUS OUTPUT ..............................................................................................190
   OUTPUT SIGNAL PATH ENABLE/DISABLE STATUS OUTPUT ...............................................................................................191
   BOOT DONE STATUS OUTPUT ................................................................................................................................................191
   ASYNCHRONOUS SAMPLE RATE CONVERTER (ASRC) LOCK STATUS OUTPUT .............................................................192
   ASYNCHRONOUS SAMPLE RATE CONVERTER (ASRC) CONFIGURATION ERROR STATUS OUTPUT ...........................192
   ISOCHRONOUS SAMPLE RATE CONVERTER (ISRC) CONFIGURATION ERROR STATUS OUTPUT................................192
   OVER-TEMPERATURE, SHORT CIRCUIT PROTECTION, AND SPEAKER SHUTDOWN STATUS OUTPUT.......................193
   DYNAMIC RANGE CONTROL (DRC) STATUS OUTPUT ..........................................................................................................193
   CONTROL WRITE SEQUENCER STATUS OUTPUT ................................................................................................................194
   CONTROL INTERFACE ERROR STATUS OUTPUT .................................................................................................................194
   SYSTEM CLOCKS ENABLE STATUS OUTPUT ........................................................................................................................194
   CLOCKING ERROR STATUS OUTPUT .....................................................................................................................................195
   GENERAL PURPOSE SWITCH ..................................................................................................................................................196
 INTERRUPTS ........................................................................................................................ 197
 CLOCKING AND SAMPLE RATES ....................................................................................... 210
   SYSTEM CLOCKING ..................................................................................................................................................................210
   SAMPLE RATE CONTROL .........................................................................................................................................................210
   AUTOMATIC SAMPLE RATE DETECTION ................................................................................................................................211
   SYSCLK AND ASYNCCLK CONTROL .......................................................................................................................................212
   MISCELLANEOUS CLOCK CONTROLS ....................................................................................................................................215
   BCLK AND LRCLK CONTROL ....................................................................................................................................................221
   CONTROL INTERFACE CLOCKING ..........................................................................................................................................222
   FREQUENCY LOCKED LOOP (FLL) ..........................................................................................................................................222
   FREE-RUNNING FLL MODE ......................................................................................................................................................232
   SPREAD SPECTRUM FLL CONTROL .......................................................................................................................................234
   FLL INTERRUPTS AND GPIO OUTPUT ....................................................................................................................................235
   EXAMPLE FLL CALCULATION ..................................................................................................................................................235
   EXAMPLE FLL SETTINGS ..........................................................................................................................................................236
 CONTROL INTERFACE ........................................................................................................ 238
 CONTROL WRITE SEQUENCER ......................................................................................... 242
   INITIATING A SEQUENCE..........................................................................................................................................................242
   AUTOMATIC SAMPLE RATE DETECTION SEQUENCES ........................................................................................................243
   JACK DETECT, GPIO, MICDET CLAMP, AND WAKE-UP SEQUENCES .................................................................................244
   DRC SIGNAL DETECT SEQUENCES ........................................................................................................................................245
   BOOT SEQUENCE......................................................................................................................................................................246
   SEQUENCER OUTPUTS AND READBACK ..............................................................................................................................246
   PROGRAMMING A SEQUENCE ................................................................................................................................................247
   SEQUENCER MEMORY DEFINITION .......................................................................................................................................248
 CHARGE PUMPS, REGULATORS AND VOLTAGE REFERENCE ...................................... 250
   CHARGE PUMPS AND LDO2 REGULATOR .............................................................................................................................250
Rev 4.1                                                                                                                                                                                    5


                                                                                                                                                  WM8998
   MICBIAS BIAS (MICBIAS) CONTROL ........................................................................................................................................250
   VOLTAGE REFERENCE CIRCUIT .............................................................................................................................................251
   LDO1 REGULATOR AND DCVDD SUPPLY ..............................................................................................................................251
   BLOCK DIAGRAM AND CONTROL REGISTERS ......................................................................................................................252
  THERMAL SHUTDOWN AND SHORT CIRCUIT PROTECTION .......................................... 257
  POWER-ON RESET (POR) ................................................................................................... 258
  HARDWARE RESET, SOFTWARE RESET, WAKE-UP, AND DEVICE ID ........................... 261
REGISTER MAP ......................................................................................................... 263
APPLICATIONS INFORMATION ............................................................................... 293
  RECOMMENDED EXTERNAL COMPONENTS .................................................................... 293
   ANALOGUE INPUT PATHS ........................................................................................................................................................293
   DIGITAL MICROPHONE INPUT PATHS ....................................................................................................................................293
   MICROPHONE BIAS CIRCUIT ...................................................................................................................................................294
   HEADPHONE/LINE/EARPIECE DRIVER OUTPUT PATH .........................................................................................................296
   SPEAKER DRIVER OUTPUT PATH ...........................................................................................................................................297
   POWER SUPPLY / REFERENCE DECOUPLING ......................................................................................................................299
   CHARGE PUMP COMPONENTS ...............................................................................................................................................300
   EXTERNAL ACCESSORY DETECTION COMPONENTS ..........................................................................................................300
   RECOMMENDED EXTERNAL COMPONENTS DIAGRAM .......................................................................................................302
  RESETS SUMMARY .............................................................................................................. 303
  DIGITAL AUDIO INTERFACE CLOCKING CONFIGURATIONS .......................................... 304
  PCB LAYOUT CONSIDERATIONS ....................................................................................... 307
PACKAGE DIMENSIONS ........................................................................................... 308
IMPORTANT NOTICE ................................................................................................ 309
REVISION HISTORY .................................................................................................. 310
6                                                                                                                                                                     Rev 4.1


                 1          2          3         4          5           6           7           8           9          10          11          12         13
Rev 4.1
                                                                                                                                                        HPOUTFB1/
          A    MICVDD     AGND       AVDD      EPOUTP     EPOUTN     LINEOUTFB     AVDD      HPOUTR      CP1VOUTP    CP1VOUTN     CP2CB      HPDETR
                                                                                                                                                         MICDET2
               IN2AN/     IN2AP/                                                                                                                        MICDET1/
          B                          IN2BN     IN2BP     LINEOUTR    LINEOUTL      AGND       HPOUTL      CP1CA       CP1CB       CP2CA      HPDETL
              DMICCLK2   DMICDAT2                                                                                                                       HPOUTFB2
                                                                                                                                                                    PIN CONFIGURATION
               IN1ALN/               IN1ARN/
          C               IN1ALP               IN1ARP    MICBIAS3    MICBIAS2    MICBIAS1    JACKDET      CPVDD       CPGND      CP2VOUT      VREFC      MICVDD
              DMICCLK1              DMICDAT1
          D    IN1BLN     IN1BLP     IN1BRN    IN1BRP      DGND        DGND        DGND        DGND       RESET        AGND       GPSWN      GPSWP      LDOVOUT
                                                        TOP VIEW – WM8998
          E    SPKVDDL   SPKVDDL    SPKVDDL    DGND        DGND        DGND        DGND        DGND       DGND         DGND       GPIO5       AGND       LDOVDD
          F   SPKOUTLP   SPKOUTLN   SPKVDDL    DGND      AIF3TXDAT     DGND        ADDR        SDA        GPIO1      AIF1LRCLK      IRQ       MCLK2      LDOENA
          G   SPKGNDL    SPKGNDL    SPKVDDL     GPIO3    AIF3RXDAT     DGND      AIF2RXDAT    GPIO4       SPKDAT     AIF1TXDAT   SLIMDAT     DBVDD1       DGND
          H   SPKGNDR    SPKGNDR    SPKVDDR    AGND      AIF3LRCLK     DGND        GPIO2     AIF2TXDAT   AIF2LRCLK    SPKCLK     AIF1RXDAT    MCLK1      DCVDD
          J   SPKOUTRP   SPKOUTRN   SPKVDDR     AVDD      DBVDD3     AIF3BCLK     DBVDD2      DCVDD      AIF2BCLK     DBVDD1       SCLK      AIF1BCLK    SLIMCLK
                                                                                                                                                                                        WM8998
7


                                                                                                                   WM8998
ORDERING INFORMATION
     ORDER CODE               TEMPERATURE                     PACKAGE                      MOISTURE               PEAK SOLDERING
                                   RANGE                                              SENSITIVITY LEVEL             TEMPERATURE
WM8998ECS/R                   -40C to +85C                   W-CSP                         MSL1                       260C
                                                       (Pb-free, Tape and reel)
Note:
Reel quantity = 7000
PIN DESCRIPTION
A description of each pin on the WM8998 is provided below.
Note that a table detailing the associated power domain for every digital input / digital output pin is provided on the following page.
Note that, where multiple pins share a common name, these pins should be tied together on the PCB.
All Digital Output pins are CMOS outputs, unless otherwise stated.
      PIN NO               NAME                     TYPE                                         DESCRIPTION
        F7                ADDR            Digital Input             Control interface (I2C) address select
  A2, B7, D10,            AGND            Supply                    Analogue ground (Return path for AVDD)
     E12, H4
       J12              AIF1BCLK          Digital Input / Output    Audio interface 1 bit clock
       F10             AIF1LRCLK          Digital Input / Output    Audio interface 1 left / right clock
       H11             AIF1RXDAT          Digital Input             Audio interface 1 RX digital audio data
       G10             AIF1TXDAT          Digital Output            Audio interface 1 TX digital audio data
        J9              AIF2BCLK          Digital Input / Output    Audio interface 2 bit clock
        H9             AIF2LRCLK          Digital Input / Output    Audio interface 2 left / right clock
       G7              AIF2RXDAT          Digital Input             Audio interface 2 RX digital audio data
        H8             AIF2TXDAT          Digital Output            Audio interface 2 TX digital audio data
        J6              AIF3BCLK          Digital Input / Output    Audio interface 3 bit clock
        H5             AIF3LRCLK          Digital Input / Output    Audio interface 3 left / right clock
       G5              AIF3RXDAT          Digital Input             Audio interface 3 RXdigital audio data
        F5             AIF3TXDAT          Digital Output            Audio interface 3 TX digital audio data
    A3, A7, J4            AVDD            Supply                    Analogue supply
        B9                CP1CA           Analogue Output           Charge pump 1 fly-back capacitor pin
       B10                CP1CB           Analogue Output           Charge pump 1 fly-back capacitor pin
       A10             CP1VOUTN           Analogue Output           Charge pump 1 negative output decoupling pin
        A9             CP1VOUTP           Analogue Output           Charge pump 1 positive output decoupling pin
       B11                CP2CA           Analogue Output           Charge pump 2 fly-back capacitor pin
       A11                CP2CB           Analogue Output           Charge pump 2 fly-back capacitor pin
       C11              CP2VOUT           Analogue Output           Charge pump 2 output decoupling pin / Supply for LDO2
       C10               CPGND            Supply                    Charge pump 1 & 2 ground (Return path for CPVDD)
        C9               CPVDD            Supply                    Supply for Charge Pump 1 & 2
    G12, J10             DBVDD1           Supply                    Digital buffer (I/O) supply (core functions and Audio Interface 1)
        J7               DBVDD2           Supply                    Digital buffer (I/O) supply (for Audio Interface 2, GPIO2, GPIO4)
        J5               DBVDD3           Supply                    Digital buffer (I/O) supply (for Audio Interface 3, GPIO3)
     H13, J8             DCVDD            Supply                    Digital core supply
   D5, D6, D7,            DGND            Supply                    Digital ground
   D8, E4, E5,                                                      (Return path for DCVDD, DBVDD1, DBVDD2 and DBVDD3)
   E6, E7, E8,
  E9, E10, F4,
  F6, G6, G13,
        H6
        A5               EPOUTN           Analogue Output           Earpiece negative output
        A4               EPOUTP           Analogue Output           Earpiece positive output
8                                                                                                                               Rev 4.1


                                                                                           WM8998
   PIN NO       NAME           TYPE                                      DESCRIPTION
     F9       GPIO1  Digital Input / Output General Purpose pin GPIO1.
                                            The output configuration is selectable CMOS or Open Drain.
     H7       GPIO2  Digital Input / Output General Purpose pin GPIO2.
                                            The output configuration is selectable CMOS or Open Drain.
    G4        GPIO3  Digital Input / Output General Purpose pin GPIO3.
                                            The output configuration is selectable CMOS or Open Drain.
    G8        GPIO4  Digital Input / Output General Purpose pin GPIO4.
                                            The output configuration is selectable CMOS or Open Drain.
    E11       GPIO5  Digital Input / Output General Purpose pin GPIO5.
                                            The output configuration is selectable CMOS or Open Drain.
    D11     GPSWN    Analogue Output        General Purpose analogue switch contact (negative)
    D12     GPSWP    Analogue Input         General Purpose analogue switch contact (positive)
    B12     HPDETL   Analogue Input         Headphone left (HPOUTL) sense input
    A12     HPDETR   Analogue Input         Headphone right (HPOUTR) sense input
    A13   HPOUTFB1/  Analogue Input         HPOUTL and HPOUTR ground feedback pin 1/
            MICDET2                         Microphone & accessory sense input 2
     B8     HPOUTL   Analogue Output        Left headphone output
     A8     HPOUTR   Analogue Output        Right headphone output
     C1     IN1ALN/  Analogue Input /       Left channel negative differential Mic/Line input /
           DMICCLK1  Digital Output         Digital MIC clock output 1
     C2      IN1ALP  Analogue Input         Left channel single-ended Mic/Line input /
                                            Left channel positive differential Mic/Line input
     C3     IN1ARN/  Analogue input /       Right channel negative differential Mic/Line input /
          DMICDAT1   Digital Input          Digital MIC data input 1
     C4      IN1ARP  Analogue Input         Right channel single-ended Mic/Line input /
                                            Right channel positive differential Mic/Line input
     B1       IN2AN/ Analogue Input /       Negative differential Mic/Line input /
           DMICCLK2  Digital Output         Digital MIC clock output 2
     B2       IN2AP/ Analogue Input /       Single-ended Mic/Line input /
          DMICDAT2   Digital Input          Positive differential Mic/Line input/
                                            Digital MIC data input 2
     D1      IN1BLN  Analogue Input         Left channel negative differential Mic/Line input
     D2      IN1BLP  Analogue Input         Left channel single-ended Mic/Line input /
                                            Left channel positive differential Mic/Line input
     D3     IN1BRN   Analogue input         Right channel negative differential Mic/Line input
     D4      IN1BRP  Analogue Input         Right channel single-ended Mic/Line input /
                                            Right channel positive differential Mic/Line input
     B3       IN2BN  Analogue Input         Negative differential Mic/Line input
     B4        IN2BP Analogue Input         Single-ended Mic/Line input /
                                            Positive differential Mic/Line input
    F11         IRQ
                ¯¯¯  Digital Output         Interrupt Request (IRQ) output (default is active low).
                                            The pin configuration is selectable CMOS or Open Drain.
     C8    JACKDET   Analogue Input         Jack detect input
    F13     LDOENA   Digital Input          Enable pin for LDO1 (generates DCVDD supply).
                                            Logic 1 input enables LDO1. If using external DCVDD supply,
                                            then LDO1 is not used, and LDOENA must be held at logic 0.
    E13     LDOVDD   Supply                 Supply for LDO1
    D13    LDOVOUT   Analogue Output        LDO1 output.
                                            If using external DCVDD, then LDOVOUT must be left floating.
     A6   LINEOUTFB  Analogue Input         LINEOUTL and LINEOUTR ground loop noise rejection feedback
     B6    LINEOUTL  Analogue Output        Left line output
     B5    LINEOUTR  Analogue Output        Right line output
    H12      MCLK1   Digital Input          Master clock 1
    F12      MCLK2   Digital Input          Master clock 2
     C7    MICBIAS1  Analogue Output        Microphone bias 1
Rev 4.1                                                                                                  9


                                                                                            WM8998
    PIN NO        NAME            TYPE                                     DESCRIPTION
      C6       MICBIAS2 Analogue Output        Microphone bias 2
      C5       MICBIAS3 Analogue Output        Microphone bias 3
      B13      MICDET1/ Analogue Input         Microphone & accessory sense input 1/
              HPOUTFB2                         HPOUTL and HPOUTR ground feedback pin 2
   A1, C13      MICVDD  Analogue Output        LDO2 output decoupling pin (generated internally by WM8998).
                                               (Can also be used as reference/supply for external microphones.)
      D9        RESET
                 ¯¯¯¯¯¯ Digital Input          Digital Reset input (active low)
      J11         SCLK  Digital Input          Control interface (I2C) clock input
      F8          SDA   Digital Input / Output Control interface (I2C) data input and output
                                               The output function is implemented as an Open Drain circuit.
      J13      SLIMCLK  Digital Input          SLIMBus Clock input
     G11       SLIMDAT  Digital Input / Output SLIMBus Data input / output
     H10        SPKCLK  Digital Output         Digital speaker (PDM) clock output
      G9        SPKDAT  Digital Output         Digital speaker (PDM) data output
   G1, G2      SPKGNDL  Supply                 Left speaker driver ground (Return path for SPKVDDL)
    H1, H2    SPKGNDR   Supply                 Right speaker driver ground (Return path for SPKVDDR)
      F2      SPKOUTLN  Analogue Output        Left speaker negative output
      F1      SPKOUTLP  Analogue Output        Left speaker positive output
       J2     SPKOUTRN  Analogue Output        Right speaker negative output
       J1     SPKOUTRP  Analogue Output        Right speaker positive output
  E1, E2, E3,  SPKVDDL  Supply                 Left speaker driver supply
    F3, G3
    H3, J3     SPKVDDR  Supply                 Right speaker driver supply
     C12        VREFC   Analogue Output        Bandgap reference decoupling capacitor connection
10                                                                                                     Rev 4.1


                                                                                                              WM8998
The following table identifies the power domain and ground reference associated with each of the input / output pins.
  PIN NO              NAME                                     POWER DOMAIN                                    GROUND DOMAIN
    F7                ADDR            DBVDD1                                                                 DGND
   J12             AIF1BCLK           DBVDD1                                                                 DGND
   F10            AIF1LRCLK           DBVDD1                                                                 DGND
   H11            AIF1RXDAT           DBVDD1                                                                 DGND
   G10            AIF1TXDAT           DBVDD1                                                                 DGND
    J9             AIF2BCLK           DBVDD2                                                                 DGND
    H9            AIF2LRCLK           DBVDD2                                                                 DGND
   G7             AIF2RXDAT           DBVDD2                                                                 DGND
    H8            AIF2TXDAT           DBVDD2                                                                 DGND
    J6             AIF3BCLK           DBVDD3                                                                 DGND
    H5            AIF3LRCLK           DBVDD3                                                                 DGND
   G5             AIF3RXDAT           DBVDD3                                                                 DGND
    F5            AIF3TXDAT           DBVDD3                                                                 DGND
    F9               GPIO1            DBVDD1                                                                 DGND
    H7               GPIO2            DBVDD2                                                                 DGND
   G4                GPIO3            DBVDD3                                                                 DGND
   G8                GPIO4            DBVDD2                                                                 DGND
   E11               GPIO5            DBVDD1                                                                 DGND
    C1              IN1ALN/           (when DMICCLK1 function is selected):                                  AGND
                  DMICCLK1            MICVDD, MICBIAS1, MICBIAS2 or MICBIAS3
                                      The DMICCLK1 power domain is selectable using IN1_DMIC_SUP
    C3              IN1ARN/           (when DMICDAT1 function is selected):                                  AGND
                  DMICDAT1            MICVDD, MICBIAS1, MICBIAS2 or MICBIAS3
                                      The DMICDAT1 power domain is selectable using IN1_DMIC_SUP
    B1               IN2AN/           (when DMICCLK2 function is selected):                                  AGND
                  DMICCLK2            MICVDD, MICBIAS1, MICBIAS2 or MICBIAS3
                                      The DMICCLK2 power domain is selectable using IN2_DMIC_SUP
    B2               IN2AP/           (when DMICDAT2 function is selected):                                  AGND
                  DMICDAT2            MICVDD, MICBIAS1, MICBIAS2 or MICBIAS3
                                      The DMICDAT2 power domain is selectable using IN2_DMIC_SUP
   F11                 IRQ
                       ¯¯¯            DBVDD1                                                                 DGND
   F13             LDOENA             DBVDD1                                                                 DGND
   H12               MCLK1            DBVDD1                                                                 DGND
   F12               MCLK2            DBVDD1                                                                 DGND
    D9               RESET
                     ¯¯¯¯¯¯           DBVDD1                                                                 DGND
   J11                SCLK            DBVDD1                                                                 DGND
    F8                 SDA            DBVDD1                                                                 DGND
   J13             SLIMCLK            DBVDD1                                                                 DGND
   G11             SLIMDAT            DBVDD1                                                                 DGND
   H10              SPKCLK            DBVDD1                                                                 DGND
   G9               SPKDAT            DBVDD1                                                                 DGND
Rev 4.1                                                                                                                    11


                                                                                                            WM8998
ABSOLUTE MAXIMUM RATINGS
Absolute Maximum Ratings are stress ratings only. Permanent damage to the device may be caused by continuously operating at or
beyond these limits. Device functional operating limits and guaranteed performance specifications are given under Electrical
Characteristics at the test conditions specified.
                     ESD Sensitive Device. This device is manufactured on a CMOS process. It is therefore generically
                     susceptible to damage from excessive static voltages. Proper ESD precautions must be taken during handling
                     and storage of this device.
Cirrus tests its package types according to IPC/JEDEC J-STD-020 for Moisture Sensitivity to determine acceptable storage
conditions prior to surface mount assembly. These levels are:
MSL1 = unlimited floor life at <30C / 85% Relative Humidity. Not normally stored in moisture barrier bag.
MSL2 = out of bag storage for 1 year at <30C / 60% Relative Humidity. Supplied in moisture barrier bag.
MSL3 = out of bag storage for 168 hours at <30C / 60% Relative Humidity. Supplied in moisture barrier bag.
The Moisture Sensitivity Level for each package type is specified in Ordering Information.
                                    CONDITION                                                MIN                  MAX
Supply voltages (LDOVDD, AVDD, DCVDD, CPVDD)                                               -0.3V                 +2.0V
Supply voltages (DBVDD1, DBVDD2, DBVDD3)                                                   -0.3V                 +4.0V
Supply voltages (SPKVDDL, SPKVDDR)                                                         -0.3V                 +6.0V
Voltage range digital inputs (DBVDD1 domain)                                           AGND - 0.3V          DBVDD1 + 0.3V
Voltage range digital inputs (DBVDD2 domain)                                           AGND - 0.3V          DBVDD2 + 0.3V
Voltage range digital inputs (DBVDD3 domain)                                           AGND - 0.3V          DBVDD3 + 0.3V
Voltage range digital inputs (DMICDATn)                                                AGND - 0.3V          MICVDD + 0.3V
Voltage range analogue inputs                                                          AGND - 0.3V          MICVDD + 0.3V
(IN1A*, IN1B*, IN2A*, MICDETn, HPOUTFBn, LINEOUTFB)
Voltage range analogue inputs (IN2B*)                                                  AGND - 3.3V          MICVDD + 0.3V
Voltage range analogue inputs (JACKDET, HPDETL, HPDETR)                             CP1VOUTN - 0.3V          AVDD + 0.3V
Voltage range analogue inputs (GPSWP, GPSWN)                                           AGND - 0.3V          MICVDD + 0.3V
Ground (DGND, CPGND, SPKGNDL, SPKGNDR)                                                 AGND - 0.3V           AGND + 0.3V
Operating temperature range, TA                                                            -40ºC                 +85ºC
Operating junction temperature, TJ                                                         -40ºC                +125ºC
Storage temperature after soldering                                                        -65ºC                +150ºC
Notes:
1.   DCVDD must not be powered if AVDD is not present.
2.   CP1VOUT2N is an internal supply, generated by the WM8998 Charge Pump (CP1). The CP1VOUT2N voltage may vary
     between AGND and -CPVDD.
12                                                                                                                      Rev 4.1


                                                                                                            WM8998
RECOMMENDED OPERATING CONDITIONS
PARAMETER                                           SYMBOL                MIN           TYP             MAX             UNIT
Digital supply range (Core)                         DCVDD               1.14            1.2             1.9               V
See notes 2, 3, 4, 5                       (≤24.576MHz clocking)
                                                    DCVDD               1.71            1.8             1.9
                                           (>24.576MHz clocking)
Digital supply range (I/O)                         DBVDD1                 1.7                           1.9               V
Digital supply range (I/O)                   DBVDD2, DBVDD3               1.7                          3.47               V
LDO supply range                                   LDOVDD                 1.7           1.8             1.9               V
Charge Pump supply range                            CPVDD                 1.7           1.8             1.9               V
Speaker supply range                       SPKVDDL, SPKVDDR               2.4                           5.5               V
Analogue supply range                                AVDD                 1.7           1.8             1.9               V
See note 2
Ground                                    DGND, AGND, CPGND,                             0                                V
See note 1                                 SPKGNDL, SPKGNDR
Power supply rise time                              DCVDD                 10                          2000               µs
See notes 7, 8, 9, 10                         All other supplies           1
Operating temperature range                           TA                 -40                            85               °C
Notes:
3.    The grounds must always be within 0.3V of AGND.
4.    AVDD must be supplied before DCVDD. DCVDD must not be powered if AVDD is not present. There are no other power
      sequencing requirements.
5.    An internal LDO (powered by LDOVDD) can be used to provide the DCVDD supply.
6.    ‘Sleep’ mode is supported when DCVDD is below the limits noted, provided AVDD and DBVDD1 are present.
7.    Under default conditions, digital core clocking rates above 24.576MHz are inhibited. The register-controlled clocking limit
      should only be raised when the applicable DCVDD voltage is present.
8.    An internal Charge Pump and LDO (powered by CPVDD) provide the microphone bias supply; the MICVDD pin should not be
      connected to an external supply.
9. DCVDD minimum rise time does not apply when this is powered using the internal LDO.
10. If DCVDD is supplied externally, and the rise time exceeds 2ms, then RESET
                                                                           ¯¯¯¯¯¯ must be asserted (low) during the rise, and held
      asserted until after DCVDD is within the recommended operating limits.
11. The specified minimum power supply rise times assume a minimum decoupling capacitance of 100nF per pin. However, Cirrus
      strongly advises that the recommended decoupling capacitors are present on the PCB and that appropriate layout guidelines
      are observed.
12. The specified minimum power supply rise times also assume a maximum PCB inductance of 10nH between decoupling
      capacitor and pin.
Rev 4.1                                                                                                                        13


                                                                                                                   WM8998
ELECTRICAL CHARACTERISTICS
   Test Conditions
   AVDD = 1.8V,
   With the exception of the condition(s) noted above, the following electrical characteristics are valid across the full range of
   recommended operating conditions.
   PARAMETER                                SYMBOL           TEST CONDITIONS              MIN            TYP           MAX          UNIT
   Analogue Input Signal Level (IN1AL, IN1AR, IN1BL, IN1BR, IN2A, IN2B)
   Full-scale input signal level              VINFS       Single-ended PGA input,                        0.5                       VRMS
   (0dBFS output)                                               6dB PGA gain                             -6                         dBV
                                                           Differential PGA input,                        1                        VRMS
                                                                0dB PGA gain                              0                         dBV
Notes:
1. The full-scale input signal level is also the maximum analogue input level, before clipping occurs.
2. The full-scale input signal level changes in proportion with AVDD. For differential input, it is calculated as AVDD / 1.8.
3. A 1.0VRMS differential signal equates to 0.5VRMS/-6dBV per input.
4. A sinusoidal input signal is assumed.
   Test Conditions
   TA = +25ºC
   With the exception of the condition(s) noted above, the following electrical characteristics are valid across the full range of
   recommended operating conditions.
   PARAMETER                                SYMBOL           TEST CONDITIONS              MIN            TYP           MAX          UNIT
   Analogue Input Pin Characteristics (IN1AL, IN1AR, IN1BL, IN1BR, IN2A, IN2B)
   Input resistance                            RIN            Differential input,                        24                          k
                                                            All PGA gain settings
                                                             Single-ended input,                         16
                                                                0dB PGA gain
   Input capacitance                           CIN                                                                       5           pF
   Test Conditions
   The following electrical characteristics are valid across the full range of recommended operating conditions.
   PARAMETER                                SYMBOL           TEST CONDITIONS              MIN            TYP           MAX          UNIT
   Input Programmable Gain Amplifiers (PGAs)
   Minimum programmable gain                                                                              0                          dB
   Maximum programmable gain                                                                             31                          dB
   Programmable gain step size                             Guaranteed monotonic                           1                          dB
   Test Conditions
   The following electrical characteristics are valid across the full range of recommended operating conditions.
   PARAMETER                                SYMBOL           TEST CONDITIONS              MIN            TYP           MAX          UNIT
   Digital Microphone Input Signal Level (DMICDAT1, DMICDAT2)
   Full-scale input signal level                                   0dB gain                              -6                        dBFS
   (0dBFS signal to digital core)
Note:
The digital microphone input signal level is measured in dBFS, where 0dBFS is a signal level equal to the full-scale range (FSR) of
the PDM input. The FSR is defined as the amplitude of a 1kHz sine wave whose positive and negative peaks are represented by the
maximum and minimum digital codes respectively - this is the largest 1kHz sine wave that will fit in the digital output range without
clipping.
14                                                                                                                               Rev 4.1


                                                                                                               WM8998
 Test Conditions
 The following electrical characteristics are valid across the full range of recommended operating conditions.
 PARAMETER                                SYMBOL           TEST CONDITIONS             MIN          TYP         MAX    UNIT
 Headphone Output Driver (HPOUTL, HPOUTR)
 Load resistance,                                            Charge Pump               15                              Ω
 Single-ended output mode                                Normal mode (default)
                                                             Charge Pump                6
                                                         Low Impedance mode
 Load resistance,                                            Charge Pump               30                              Ω
 Differential (BTL) output mode                          Normal mode (default)
                                                             Charge Pump               15
                                                         Low Impedance mode
 Load resistance                                        Device survival with load      0.1                             Ω
                                                           applied indefinitely
 Load capacitance                                          Direct connection,                                   500    pF
                                                          Single-ended mode
                                                           Direct connection,                                   250
                                                        Differential (BTL) mode
                                                          Connection via 16Ω                                     2     nF
                                                             series resistor
 DC offset at Load                                        Single-ended mode                         0.1                mV
                                                        Differential (BTL) mode                     0.2
 Note - to support HPOUT loads less than 15Ω, (or less than 30Ω BTL), the Charge Pump (CP1) must be configured for low
 impedance operation, as described in the “Output Signal Path” section.
 Line Output Driver (LINEOUTL, LINEOUTR)
 Load resistance                                            Normal operation          600                              Ω
                                                        Device survival with load      0.1
                                                           applied indefinitely
 Load capacitance                                          Direct connection,                                   500    pF
                                                          Single-ended mode
                                                           Direct connection,                                   250
                                                        Differential (BTL) mode
                                                          Connection via 16Ω                                     2     nF
                                                             series resistor
 DC offset at Load                                        Single-ended mode                         0.1                mV
                                                        Differential (BTL) mode                     0.2
 Earpiece Output Driver (EPOUTP+EPOUTN)
 Load resistance                                             Charge Pump               30                              Ω
                                                         Normal mode (default)
                                                             Charge Pump               15
                                                         Low Impedance mode
                                                        Device survival with load      0.1
                                                           applied indefinitely
 Load capacitance                                       Direct connection (BTL)                                 250    pF
                                                          Connection via 16Ω                                     2     nF
                                                             series resistor
 DC offset at Load                                                                                  0.1                mV
 Note - to support EPOUT loads less than 30Ω, the Charge Pump (CP1) must be configured for low impedance operation, as
 described in the “Output Signal Path” section.
Rev 4.1                                                                                                                   15


                                                                                                                 WM8998
   Test Conditions
   The following electrical characteristics are valid across the full range of recommended operating conditions.
   PARAMETER                                SYMBOL           TEST CONDITIONS             MIN           TYP           MAX          UNIT
   Speaker Output Driver (SPKOUTLP+SPKOUTLN, SPKOUTRP+SPKOUTRN)
   Load resistance                                            Normal operation            4                                       Ω
                                                          Device survival with load       0
                                                             applied indefinitely
   Load capacitance                                                                                                  200          pF
   DC offset at Load                                                                                    5                         mV
   SPKVDD leakage current                                                                               1                         µA
   Digital Speaker Output (SPKDAT)
   Full-scale output level                                         0dB gain                            -6                       dBFS
   (0dBFS digital core output)
Note:
The digital output signal level is measured in dBFS, where 0dBFS is a signal level equal to the full-scale range (FSR) of the PDM
output. The FSR is defined as the amplitude of a 1kHz sine wave whose positive and negative peaks are represented by the
maximum and minimum digital codes respectively - this is the largest 1kHz sine wave that will fit in the digital output range without
clipping.
   Test Conditions
   DBVDD1 = DBVDD2 = DBVDD3 = LDOVDD = CPVDD = AVDD = 1.8V,
   DCVDD = 1.2V (powered from LDO1), MICVDD = 3.0V (powered from LDO2), SPKVDDL = SPKVDDR = 4.2V,
   TA = +25ºC, 1kHz sinusoid signal, fs = 48kHz, Input PGA gain = 0dB, 24-bit audio data unless otherwise stated.
   PARAMETER                                SYMBOL           TEST CONDITIONS             MIN           TYP           MAX          UNIT
   Analogue Input Paths (IN1AL, IN1AR, IN1BL, IN1BR, IN2A, IN2B) to ADC (Differential Input Mode, INn_SRC = x0)
   Signal to Noise Ratio                      SNR         High performance mode          87            96                         dB
   (A-weighted)                                                (INn_OSR = 1)
                                                                Normal mode                            93
                                                               (INn_OSR = 0)
   Total Harmonic Distortion                  THD                -1dBV input                          -90                         dB
   Total Harmonic Distortion Plus           THD+N                -1dBV input                          -88            -79          dB
   Noise
   Channel separation (Left/Right)                                                                    100                         dB
   Input noise floor                                             A-weighted,                          3.2                       µVRMS
                                                             PGA gain = +18dB
   Common mode rejection ratio               CMRR            PGA gain = +30dB                          65                         dB
                                                              PGA gain = 0dB                           70
   PSRR (DBVDDn, LDOVDD,                     PSRR        100mV (peak-peak) 217Hz                       70                         dB
   CPVDD, AVDD)                                          100mV(peak-peak) 10kHz                        65
   PSRR (SPKVDDL, SPKVDDR)                   PSRR        100mV (peak-peak) 217Hz                       95                         dB
                                                         100mV(peak-peak) 10kHz                        95
16                                                                                                                            Rev 4.1


                                                                                                           WM8998
 Test Conditions
 DBVDD1 = DBVDD2 = DBVDD3 = LDOVDD = CPVDD = AVDD = 1.8V,
 DCVDD = 1.2V (powered from LDO1), MICVDD = 3.0V (powered from LDO2), SPKVDDL = SPKVDDR = 4.2V,
 TA = +25ºC, 1kHz sinusoid signal, fs = 48kHz, Input PGA gain = 0dB, 24-bit audio data unless otherwise stated.
 PARAMETER                             SYMBOL          TEST CONDITIONS              MIN           TYP         MAX  UNIT
 Analogue Input Paths (IN1AL, IN1AR, IN1BL, IN1BR, IN2A, IN2B) to ADC (Single-Ended Input Mode, INn_SRC = x1)
 PGA Gain = +6dB unless otherwise stated.
 Signal to Noise Ratio                   SNR        High performance mode          86             94               dB
 (A-weighted)                                           (INn_OSR = 1)
                                                         Normal mode                              92
                                                        (INn_OSR = 0)
 Total Harmonic Distortion               THD              -7dBV input                            -82               dB
 Total Harmonic Distortion Plus        THD+N              -7dBV input                            -81          -71  dB
 Noise
 Channel separation (Left/Right)                                                                100                dB
 Input noise floor                                        A-weighted,                            4.6              µVRMS
                                                      PGA gain = +18dB
 PSRR (DBVDDn, LDOVDD,                  PSRR       100mV (peak-peak) 217Hz                        70               dB
 CPVDD, AVDD)                                      100mV(peak-peak) 10kHz                         50
 PSRR (SPKVDDL, SPKVDDR)                PSRR       100mV (peak-peak) 217Hz                        85               dB
                                                   100mV(peak-peak) 10kHz                         70
 DAC to Headphone Output (HPOUTL, HPOUTR; RL = 32)
 Maximum output power                     PO             0.1% THD+N                               28               mW
 Signal to Noise Ratio                   SNR              A-weighted,                           122                dB
                                                     Output signal = 1Vrms
 Total Harmonic Distortion               THD              PO = 20mW                              -86               dB
 Total Harmonic Distortion Plus        THD+N              PO = 20mW                              -84               dB
 Noise
 Total Harmonic Distortion               THD               PO = 5mW                              -89               dB
 Total Harmonic Distortion Plus        THD+N               PO = 5mW                              -85               dB
 Noise
 Channel separation (Left/Right)                          PO = 20mW                             110                dB
 Output noise floor                                       A-weighted                               1              µVRMS
 PSRR (DBVDDn, LDOVDD,                  PSRR       100mV (peak-peak) 217Hz                      115                dB
 CPVDD, AVDD)                                      100mV (peak-peak) 10kHz                        80
 PSRR (SPKVDDL, SPKVDDR)                PSRR       100mV (peak-peak) 217Hz                      115                dB
                                                   100mV(peak-peak) 10kHz                         80
 DAC to Headphone Output (HPOUTL, HPOUTR; RL = 16)
 Maximum output power                     PO             0.1% THD+N                               34               mW
 Signal to Noise Ratio                   SNR              A-weighted,              114          122                dB
                                                     Output signal = 1Vrms
 Total Harmonic Distortion               THD              PO = 20mW                              -78               dB
 Total Harmonic Distortion Plus        THD+N              PO = 20mW                              -76               dB
 Noise
 Total Harmonic Distortion               THD               PO = 5mW                              -78               dB
 Total Harmonic Distortion Plus        THD+N               PO = 5mW                              -77          -67  dB
 Noise
 Channel separation (Left/Right)                          PO = 20mW                             110                dB
 Output noise floor                                       A-weighted                               1            2 µVRMS
 PSRR (DBVDDn, LDOVDD,                  PSRR       100mV (peak-peak) 217Hz                      115                dB
 CPVDD, AVDD)                                      100mV (peak-peak) 10kHz                        80
 PSRR (SPKVDDL, SPKVDDR)                PSRR       100mV (peak-peak) 217Hz                      115                dB
                                                   100mV(peak-peak) 10kHz                         80
Rev 4.1                                                                                                               17


                                                                                                           WM8998
 Test Conditions
 DBVDD1 = DBVDD2 = DBVDD3 = LDOVDD = CPVDD = AVDD = 1.8V,
 DCVDD = 1.2V (powered from LDO1), MICVDD = 3.0V (powered from LDO2), SPKVDDL = SPKVDDR = 4.2V,
 TA = +25ºC, 1kHz sinusoid signal, fs = 48kHz, Input PGA gain = 0dB, 24-bit audio data unless otherwise stated.
 PARAMETER                             SYMBOL          TEST CONDITIONS              MIN           TYP         MAX   UNIT
 DAC to Line Output (HPOUTL, HPOUTR; Load = 10k, 50pF)
 Full-scale output signal level          VOUT            0dBFS input                1                              Vrms
                                                                                    0                               dBV
 Signal to Noise Ratio                   SNR              A-weighted,              114          122                  dB
                                                     Output signal = 1Vrms
 Total Harmonic Distortion               THD             0dBFS input                             -89                 dB
 Total Harmonic Distortion Plus        THD+N             0dBFS input                             -88          -73    dB
 Noise
 Channel separation (Left/Right)                                                                110                  dB
 Output noise floor                                       A-weighted                               1            2  µVRMS
 PSRR (DBVDDn, LDOVDD,                  PSRR       100mV (peak-peak) 217Hz                      115                  dB
 CPVDD, AVDD)                                      100mV (peak-peak) 10kHz                        80
 PSRR (SPKVDDL, SPKVDDR)                PSRR       100mV (peak-peak) 217Hz                      115                  dB
                                                   100mV(peak-peak) 10kHz                         80
 DAC to Line Output (LINEOUTL, LINEOUTR; Load = 10k, 50pF)
 Full-scale output signal level          VOUT            0dBFS input                1                              Vrms
                                                                                    0                               dBV
 Signal to Noise Ratio                   SNR              A-weighted,              114          122                  dB
                                                     Output signal = 1Vrms
 Total Harmonic Distortion               THD             0dBFS input                             -90                 dB
 Total Harmonic Distortion Plus        THD+N             0dBFS input                             -89          -73    dB
 Noise
 Channel separation (Left/Right)                                                                110                  dB
 Output noise floor                                       A-weighted                               1            2  µVRMS
 PSRR (DBVDDn, LDOVDD,                  PSRR       100mV (peak-peak) 217Hz                      127                  dB
 CPVDD, AVDD)                                      100mV (peak-peak) 10kHz                        90
 PSRR (SPKVDDL, SPKVDDR)                PSRR       100mV (peak-peak) 217Hz                      130                  dB
                                                   100mV(peak-peak) 10kHz                         85
 DAC to Earpiece Output (EPOUTP+EPOUTN, RL = 32 BTL)
 Maximum output power                     PO             0.1% THD+N                               83                mW
                                                          5% THD+N                              100
 Signal to Noise Ratio                   SNR              A-weighted,              118          127                  dB
                                                     Output signal = 2Vrms
 Total Harmonic Distortion               THD              PO = 50mW                              -92                 dB
 Total Harmonic Distortion Plus        THD+N              PO = 50mW                              -90                 dB
 Noise
 Total Harmonic Distortion               THD              PO = 5mW                               -85                 dB
 Total Harmonic Distortion Plus        THD+N              PO = 5mW                               -83          -73    dB
 Noise
 Output noise floor                                       A-weighted                               1          2.5  µVRMS
 PSRR (DBVDDn, LDOVDD,                  PSRR       100mV (peak-peak) 217Hz                      113                  dB
 CPVDD, AVDD)                                      100mV (peak-peak) 10kHz                      115
 PSRR (SPKVDDL, SPKVDDR)                PSRR       100mV (peak-peak) 217Hz                      130                  dB
                                                   100mV(peak-peak) 10kHz                       100
18                                                                                                                Rev 4.1


                                                                                                           WM8998
 Test Conditions
 DBVDD1 = DBVDD2 = DBVDD3 = LDOVDD = CPVDD = AVDD = 1.8V,
 DCVDD = 1.2V (powered from LDO1), MICVDD = 3.0V (powered from LDO2), SPKVDDL = SPKVDDR = 4.2V,
 TA = +25ºC, 1kHz sinusoid signal, fs = 48kHz, Input PGA gain = 0dB, 24-bit audio data unless otherwise stated.
 PARAMETER                             SYMBOL          TEST CONDITIONS              MIN           TYP         MAX  UNIT
 DAC to Earpiece Output (EPOUTP+EPOUTN, RL = 16 BTL)
 Maximum output power                     PO             0.1% THD+N                               83               mW
                                                         10% THD+N                              110
 Signal to Noise Ratio                   SNR              A-weighted,                           127                dB
                                                     Output signal = 2Vrms
 Total Harmonic Distortion               THD              PO = 50mW                              -92               dB
 Total Harmonic Distortion Plus        THD+N              PO = 50mW                              -90               dB
 Noise
 Total Harmonic Distortion               THD              PO = 5mW                               -90               dB
 Total Harmonic Distortion Plus        THD+N              PO = 5mW                               -88               dB
 Noise
 Output noise floor                                       A-weighted                               1              µVRMS
 PSRR (DBVDDn, LDOVDD,                  PSRR       100mV (peak-peak) 217Hz                      113                dB
 CPVDD, AVDD)                                      100mV (peak-peak) 10kHz                      115
 PSRR (SPKVDDL, SPKVDDR)                PSRR       100mV (peak-peak) 217Hz                      130                dB
                                                   100mV(peak-peak) 10kHz                       100
 DAC to Speaker Output (SPKOUTLP+SPKOUTLN, SPKOUTRP+SPKOUTRN, Load = 8, 22µH, BTL)
 High Performance mode (OUT4_OSR=1)
 Maximum output power                     PO           SPKVDD = 5.0V,                           1.37                W
                                                          1% THD+N
                                                       SPKVDD = 4.2V,                           0.97
                                                          1% THD+N
                                                       SPKVDD = 3.6V,                           0.71
                                                          1% THD+N
 Signal to Noise Ratio                   SNR              A-weighted,              90           100                dB
                                                     Output signal = 3Vrms
 Total Harmonic Distortion               THD              PO = 0.7W                              -74               dB
 Total Harmonic Distortion Plus        THD+N              PO = 0.7W                              -73               dB
 Noise
 Total Harmonic Distortion               THD              PO = 0.5W                              -74               dB
 Total Harmonic Distortion Plus        THD+N              PO = 0.5W                              -73          -57  dB
 Noise
 Channel separation (Left/Right)                          PO = 0.5W                               95               dB
 Output noise floor                                       A-weighted                              30           95 µVRMS
 PSRR (DBVDDn, LDOVDD,                  PSRR       100mV (peak-peak) 217Hz                        80               dB
 CPVDD, AVDD)                                      100mV (peak-peak) 10kHz                        70
 PSRR (SPKVDDL, SPKVDDR)                PSRR       100mV (peak-peak) 217Hz                        70               dB
                                                   100mV (peak-peak) 10kHz                        70
Rev 4.1                                                                                                               19


                                                                                                           WM8998
 Test Conditions
 DBVDD1 = DBVDD2 = DBVDD3 = LDOVDD = CPVDD = AVDD = 1.8V,
 DCVDD = 1.2V (powered from LDO1), MICVDD = 3.0V (powered from LDO2), SPKVDDL = SPKVDDR = 4.2V,
 TA = +25ºC, 1kHz sinusoid signal, fs = 48kHz, Input PGA gain = 0dB, 24-bit audio data unless otherwise stated.
 PARAMETER                             SYMBOL          TEST CONDITIONS              MIN           TYP         MAX   UNIT
 DAC to Speaker Output (SPKOUTLP+SPKOUTLN, SPKOUTRP+SPKOUTRN, Load = 4, 15µH, BTL)
 High Performance mode (OUT4_OSR=1)
 Maximum output power                     PO           SPKVDD = 5.0V,                            2.4                W
                                                          1% THD+N
                                                       SPKVDD = 4.2V,                           1.69
                                                          1% THD+N
                                                       SPKVDD = 3.6V,                           1.24
                                                          1% THD+N
 Signal to Noise Ratio                   SNR             A-weighted,                            100                 dB
                                                     Output signal = 3Vrms
 Total Harmonic Distortion               THD              PO = 1.0W                              -61                dB
 Total Harmonic Distortion Plus        THD+N              PO = 1.0W                              -60                dB
 Noise
 Total Harmonic Distortion               THD              PO = 0.5W                              -64                dB
 Total Harmonic Distortion Plus        THD+N              PO = 0.5W                              -63                dB
 Noise
 Channel separation (Left/Right)                          PO = 0.5W                               85                dB
 Output noise floor                                       A-weighted                              30               µVRMS
 PSRR (DBVDDn, LDOVDD,                  PSRR       100mV (peak-peak) 217Hz                        80                dB
 CPVDD, AVDD)                                      100mV (peak-peak) 10kHz                        70
 PSRR (SPKVDDL, SPKVDDR)                PSRR       100mV (peak-peak) 217Hz                        70                dB
                                                   100mV (peak-peak) 10kHz                        70
20                                                                                                                Rev 4.1


                                                                                                               WM8998
 Test Conditions
 The following electrical characteristics are valid across the full range of recommended operating conditions.
 PARAMETER                                SYMBOL           TEST CONDITIONS              MIN          TYP            MAX    UNIT
 Digital Input / Output (except DMICDATn and DMICCLKn)
 Digital I/O is referenced to DBVDD1, DBVDD2 or DBVDD3. See “Pin Description” for the domain applicable to each pin.
 See “Recommended Operating Conditions” for the valid operating voltage range of each DBVDDn domain.
 Input HIGH Level                            VIH          VDBVDDn =1.8V ±10%          0.65                                 V
                                                                                     VDBVDDn
                                                          VDBVDDn =3.3V ±10%           0.7 
                                                                                     VDBVDDn
 Input LOW Level                             VIL          VDBVDDn =1.8V ±10%                                      0.35     V
                                                                                                                 VDBVDDn
                                                          VDBVDDn =3.3V ±10%                                       0.3 
                                                                                                                 VDBVDDn
 Note that digital input pins should not be left unconnected or floating.
 Output HIGH Level                          VOH                 IOH = 1mA              0.9                                 V
                                                                                     VDBVDDn
 Output LOW Level                           VOL                 IOL = -1mA                                         0.1     V
                                                                                                                 VDBVDDn
 Input capacitance                                                                                   10                     pF
 Input leakage                                                                          -1                           1     µA
 Pull-up resistance                                                                     42           49             56     kΩ
 (where applicable)
 Pull-down resistance                                                                   80          105            130     kΩ
 (where applicable)
 Digital Microphone Input / Output (DMICDATn and DMICCLKn)
 DMICDATn and DMICCLKn are each referenced to a selectable supply, VSUP, according to the INn_DMIC_SUP registers
 DMICDATn input HIGH Level                   VIH                                   0.65  VSUP                              V
 DMICDATn input LOW Level                    VIL                                                               0.35  VSUP  V
 DMICCLKn output HIGH Level                 VOH                 IOH = 1mA           0.8  VSUP                              V
 DMICCLKn output LOW Level                  VOL                 IOL = -1mA                                      0.2  VSUP  V
 Input capacitance                                                                                   10                     pF
 Input leakage                                                                          -1                           1     µA
 SLIMbus Digital Input / Output (SLIMCLK and SLIMDAT)
 1.8V I/O Signalling (ie. 1.65V ≤ DBVDD1 ≤1.95V)
 Input HIGH Level                            VIH                                      0.65                                 V
                                                                                     VDBVDD1
 Input LOW Level                             VIL                                                                  0.35     V
                                                                                                                 VDBVDD1
 Output HIGH Level                          VOH                 IOH = 1mA              0.9                                 V
                                                                                     VDBVDD1
 Output LOW Level                           VOL                 IOL = -1mA                                         0.1     V
                                                                                                                 VDBVDD1
 Pin capacitance                                                                                                     5      pF
 General Purpose Input / Output (GPIOn)
 Clock output frequency                                 GPIO pin configured as                                     26.5    MHz
                                                         OPCLK or FLL output
 General Purpose Switch
 The GPSWP pin should be positive-biased with respect to GPSWN. The GPSWN pin voltage must not exceed GPSWP + 0.3V.
 Switch resistance                         RDS(ON)       Switch closed, I=1mA                        40                     Ω
 Switch resistance                        RDS(OFF)            Switch open                           100                    MΩ
Rev 4.1                                                                                                                        21


                                                                                                           WM8998
 Test Conditions
 DBVDD1 = DBVDD2 = DBVDD3 = LDOVDD = CPVDD = AVDD = 1.8V,
 DCVDD = 1.2V (powered from LDO1), MICVDD = 3.0V (powered from LDO2), SPKVDDL = SPKVDDR = 4.2V,
 TA = +25ºC, 1kHz sinusoid signal, fs = 48kHz, Input PGA gain = 0dB, 24-bit audio data unless otherwise stated.
 PARAMETER                                SYMBOL            TEST CONDITIONS         MIN          TYP           MAX    UNIT
 Microphone Bias (MICBIAS1, MICBIAS2, MICBIAS3)
 Note - No capacitor on MICBIASn
 Note - In regulator mode, it is required that VMICVDD - VMICBIASn > 200mV
 Minimum Bias Voltage                      VMICBIAS          Regulator mode                      1.5                   V
 Maximum Bias Voltage                                     (MICBn_BYPASS=0)                       2.8                   V
 Bias Voltage output step size                            Load current ≤ 1.0mA
                                                                                                 0.1                   V
 Bias Voltage accuracy                                                             -5%                        +5%      V
 Bias Current                                                Regulator mode                                    2.4   mA
                                                          (MICBn_BYPASS=0),
                                                        VMICVDD - VMICBIAS >200mV
                                                               Bypass mode                                     5.0
                                                          (MICBn_BYPASS=1)
 Output Noise Density                                        Regulator mode                      50                 nV/Hz
                                                          (MICBn_BYPASS=0),
                                                            MICBn_LVL = 4h,
                                                           Load current = 1mA,
                                                            Measured at 1kHz
 Integrated noise voltage                                    Regulator mode                       4                 µVrms
                                                          (MICBn_BYPASS=0),
                                                            MICBn_LVL = 4h,
                                                           Load current = 1mA,
                                                       100Hz to 7kHz, A-weighted
 Power Supply Rejection Ratio              PSRR        100mV (peak-peak) 217Hz                   95                   dB
 (DBVDDn, LDOVDD, CPVDD,                               100mV (peak-peak) 10kHz                   65
 AVDD)
 Load capacitance                                            Regulator mode                                    50     pF
                                                          (MICBn_BYPASS=0),
                                                           MICBn_EXT_CAP=0
                                                             Regulator mode         1.8          4.7                  µF
                                                          (MICBn_BYPASS=0),
                                                           MICBn_EXT_CAP=1
 Output discharge resistance                                 MICBn_ENA=0,                         5                   kΩ
                                                            MICBn_DISCH=1
22                                                                                                                 Rev 4.1


                                                                                                           WM8998
 Test Conditions
 DBVDD1 = DBVDD2 = DBVDD3 = LDOVDD = CPVDD = AVDD = 1.8V,
 DCVDD = 1.2V (powered from LDO1), MICVDD = 3.0V (powered from LDO2), SPKVDDL = SPKVDDR = 4.2V,
 TA = +25ºC, 1kHz sinusoid signal, fs = 48kHz, Input PGA gain = 0dB, 24-bit audio data unless otherwise stated.
 PARAMETER                             SYMBOL          TEST CONDITIONS              MIN          TYP           MAX UNIT
 External Accessory Detect
 Load impedance detection range                        HP_IMPEDANCE_                 4                          30 Ω
 Detection via HPDETL pin                                  RANGE=00
 (ACCDET_MODE=001) or                                  HP_IMPEDANCE_                 8                         100
 HPDETR pin                                                RANGE=01
 (ACCDET_MODE=010)
                                                       HP_IMPEDANCE_               100                        1000
                                                           RANGE=10
                                                       HP_IMPEDANCE_              1000                       10000
                                                           RANGE=11
 Load impedance detection range                                                    400                        6000 Ω
 Detection via the MICDET1 or
 MICDET2 pin
 (ACCDET_MODE=100)
 Load impedance detection                                                          -30                        +30  %
 accuracy
 (ACCDET_MODE=001, 010 or
 100)
 Load impedance detection range                       for MICD_LVL[0] = 1            0                           3 Ω
 Detection via the MICDET1 or                         for MICD_LVL[1] = 1           17                          21
 MICDET2 pin
                                                      for MICD_LVL[2] = 1           36                          44
 (ACCDET_MODE=000).
                                                      for MICD_LVL[3] = 1           62                          88
 2.2kΩ (2%) MICBIAS resistor.
 Note these characteristics assume                    for MICD_LVL[4] = 1          115                         160
 no other component is connected                      for MICD_LVL[5] = 1          207                         381
 to MICDETn. See “Applications                        for MICD_LVL[8] = 1          475                       30000
 Information” for recommended
 external components when a
 typical microphone is present.
 Jack Detection input threshold        VJACKDET           Jack insertion                    0.5 x AVDD              V
 voltage (JACKDET)                                        Jack removal                     0.85 x AVDD
 Jack Detect pull-up resistance                                                    0.65           1            1.3 MΩ
Rev 4.1                                                                                                               23


                                                                                                               WM8998
 Test Conditions
 DBVDD1 = DBVDD2 = DBVDD3 = LDOVDD = CPVDD = AVDD = 1.8V,
 DCVDD = 1.2V (powered from LDO1), MICVDD = 3.0V (powered from LDO2), SPKVDDL = SPKVDDR = 4.2V,
 TA = +25ºC, 1kHz sinusoid signal, fs = 48kHz, Input PGA gain = 0dB, 24-bit audio data unless otherwise stated.
 PARAMETER                                SYMBOL           TEST CONDITIONS             MIN          TYP          MAX     UNIT
 MICVDD Charge Pump and Regulator (CP2 and LDO2)
 Output voltage                           VMICVDD                                      1.7          2.7          3.3      V
 Programmable output voltage step                                                                   50                  mV
 size
 Maximum output current                                                                              8                  mA
 Start-up time                                             4.7µF on MICVDD,                         4.5                  ms
                                                              IMICBIASn = 1mA
 Frequency Locked Loop (FLL1, FLL2)
 Output frequency                                           Normal operation,          13                        50    MHz
                                                        input reference supplied
                                                           Free-running mode,                       30
                                                          no reference supplied
 Lock Time                                                    FREF = 32kHz,                         10                   ms
                                                           FOUT = 24.576MHz
                                                              FREF = 12MHz,                          1
                                                           FOUT = 24.576MHz
 RESET pin Input
 RESET input pulse width                                                                1                                µs
 (To trigger a Hardware Reset, the
 RESET input must be asserted for
 longer than this duration)
 Test Conditions
 The following electrical characteristics are valid across the full range of recommended operating conditions.
 Device Reset Thresholds
 AVDD Reset Threshold                      VAVDD                VAVDD rising                                    0.96      V
                                                                VAVDD falling         0.54
 DCVDD Reset Threshold                     VDCVDD              VDCVDD rising                                    1.03      V
                                                               VDCVDD falling         0.48
 DBVDD1 Reset Threshold                   VDBVDD1              VDBVDD1 rising                                   0.96      V
                                                               VDBVDD1 falling        0.54
 Note that the reset thresholds are derived from simulations only, across all operational and process corners.
 Device performance is not assured outside the voltage ranges defined in the “Recommended Operating Conditions” section.
 Refer to this section for the WM8998 power-up sequencing requirements.
24                                                                                                                   Rev 4.1


                                                                                                               WM8998
TERMINOLOGY
1. Signal-to-Noise Ratio (dB) – SNR is a measure of the difference in level between the maximum full scale output signal and the
   output with no input signal applied. (Note that this is measured without any mute function enabled.)
2. Total Harmonic Distortion (dB) – THD is the ratio of the RMS sum of the harmonic distortion products in the specified
   bandwidth (see note below) relative to the RMS amplitude of the fundamental (ie. test frequency) output.
3. Total Harmonic Distortion plus Noise (dB) – THD+N is the ratio of the RMS sum of the harmonic distortion products plus noise
   in the specified bandwidth (see note below) relative to the RMS amplitude of the fundamental (ie. test frequency) output.
4. Power Supply Rejection Ratio (dB) - PSRR is the ratio of a specified power supply variation relative to the output signal that
   results from it. PSRR is measured under quiescent signal path conditions.
5. Common Mode Rejection Ratio (dB) – CMRR is the ratio of a specified input signal (applied to both sides of a differential
   input), relative to the output signal that results from it.
6. Channel Separation (L/R) (dB) – left-to-right and right-to-left channel separation is the difference in level between the active
   channel (driven to maximum full scale output) and the measured signal level in the idle channel at the test signal frequency.
   The active channel is configured and supplied with an appropriate input signal to drive a full scale output, with signal measured
   at the output of the associated idle channel.
7. Multi-Path Crosstalk (dB) – is the difference in level between the output of the active path and the measured signal level in the
   idle path at the test signal frequency. The active path is configured and supplied with an appropriate input signal to drive a full
   scale output, with signal measured at the output of the specified idle path.
8. Mute Attenuation – This is a measure of the difference in level between the full scale output signal and the output with mute
   applied.
9. All performance measurements are specified with a 20kHz low pass ‘brick-wall’ filter and, where noted, an A-weighted filter.
   Failure to use these filters will result in higher THD and lower SNR readings than are found in the Electrical Characteristics.
   The low pass filter removes out-of-band noise.
Rev 4.1                                                                                                                           25


                                                                                                             WM8998
THERMAL CHARACTERISTICS
                            PARAMETER                                   SYMBOL             MIN       TYP         MAX          UNIT
   Junction-to-ambient thermal resistance                                 ΘJA                       33.8                    °C/W
   Junction-to-board thermal resistance                                   ΘJB                       10.5                    °C/W
   Junction-to-case thermal resistance                                    ΘJC                        0.7                    °C/W
   Junction-to-board thermal characterisation parameter                   ΨJB                        9.4                    °C/W
   Junction-to-top thermal characterisation parameter                     ΨJT                       0.01                    °C/W
Notes:
1.    The Thermal Characteristics data is based on simulated test results, with reference to JEDEC JESD51 standards.
2.    The thermal resistance (Θ) parameters describe the thermal behaviour in a standardised measurement environment.
3.    The thermal characterisation (Ψ) parameters describe the thermal behaviour in the environment of a typical application.
26                                                                                                                         Rev 4.1


                                                                                                        WM8998
TYPICAL PERFORMANCE
TYPICAL POWER CONSUMPTION
Typical power consumption data is provided below for a number of different operating conditions.
Test Conditions:
DCVDD = 1.2V, DBVDD1 = DBVDD2 = DBVDD3 = LDOVDD = CPVDD = AVDD = 1.8V,
SPKVDDL = SPKVDDR = 4.2V, TA = +25ºC.
          OPERATING MODE                     TEST CONDITIONS                SUPPLY         SUPPLY    SUPPLY    TOTAL
                                                                           CURRENT        CURRENT   CURRENT   POWER
                                                                              (1.2V)         (1.8V)    (4.2V)
Music Playback to Headphone
AIF1 to DAC to HPOUT (stereo)            Quiescent                           2.42mA         2.20mA    0.00mA   6.86mW
SYSCLK=11.2896MHz,                       1kHz sine wave, PO=10mW             2.61mA        36.73mA    0.00mA  66.25mW
(direct MCLK input, FLL disabled)
fs=44.1kHz, 24-bit I2S, Slave mode
Load = 32
Music Playback to Line Output
AIF1 to DAC to LINEOUT (stereo)          Quiescent                           2.78mA         2.01mA    0.00mA   6.96mW
SYSCLK=24.576MHz,
(direct MCLK input, FLL disabled)
fs=48kHz, 24-bit I2S, Slave mode
Load = 10k, 50pF
Music Playback to Earpiece
AIF1 to DAC to EPOUT                     Quiescent                           1.97mA         1.27mA    0.00mA   4.65mW
SYSCLK=24.576MHz,                        1kHz sine wave, PO=30mW             2.05mA        57.52mA    0.00mA  106.0mW
(direct MCLK input, FLL disabled)
fs=48kHz, 24-bit I2S, Slave mode
Load = 32, BTL
Music Playback to Speaker
AIF1 to DAC to SPKOUT (stereo)           Quiescent                           2.58mA         2.72mA    3.48mA  22.58mW
SYSCLK=24.576MHz,                        1kHz sine wave, PO=700mW            2.62mA         2.77mA    412mA   1738mW
(direct MCLK input, FLL disabled)
fs=48kHz, 24-bit I2S, Slave mode
Load = 8, 22µH, BTL
Full Duplex Voice Call
Analogue Mic to ADC to AIF1 (out)        Quiescent                           1.84mA         3.09mA    0.00mA   7.78mW
AIF1 (in) to DAC to EPOUT (mono)
SYSCLK=24.576MHz,
(direct MCLK input, FLL disabled)
fs=8kHz, 16-bit I2S, Slave mode
MICVDD=3.0V (powered from LDO2),
MICBIAS=1.8V (regulator mode)
Earpiece load = 32, BTL
Power dissipated in the microphone is
not included.
Stereo Line Record
Analogue Line to ADC to AIF1             1kHz sine wave, -1dBFS out          1.18mA         1.68mA    0.00mA   4.44mW
SYSCLK=11.2896MHz,
(direct MCLK input, FLL disabled)
fs=44.1kHz, 24-bit I2S, Slave mode
MICVDD=1.8V (CP2/LDO2 bypass)
Sleep Mode
Accessory detect enabled                                                    0.000mA        0.013mA   0.000mA  0.024mW
(JD1_ENA=1)
Rev 4.1                                                                                                             27


                                                                           WM8998
TYPICAL SIGNAL LATENCY
       OPERATING MODE                         TEST CONDITIONS              LATENCY
                                      INPUT       OUTPUT      DIGITAL CORE
AIF to DAC Stereo Path
Digital input (AIFn) to analogue  fs = 48kHz    fs = 48kHz    Synchronous   378µs
output (HPOUT).                  fs = 44.1kHz  fs = 44.1kHz   Synchronous   410µs
Signal is routed via the digital
                                  fs = 16kHz    fs = 16kHz    Synchronous   592µs
core ASRC function in the
asynchronous test cases only.      fs = 8kHz     fs = 8kHz    Synchronous  1148µs
                                   fs = 8kHz   fs = 44.1kHz   Asynchronous 1730µs
                                  fs = 16kHz   fs = 44.1kHz   Asynchronous 1096µs
ADC to AIF Stereo Path
Analogue input (INn) to digital   fs = 48kHz    fs = 48kHz    Synchronous   170µs
output (AIFn).                   fs = 44.1kHz  fs = 44.1kHz   Synchronous   199µs
Input path High Pass Filter
                                  fs = 16kHz    fs = 16kHz    Synchronous   557µs
(HPF) enabled.
                                   fs = 8kHz     fs = 8kHz    Synchronous  1087µs
Signal is routed via the digital
core ASRC function in the        fs = 44.1kHz    fs = 8kHz    Asynchronous 1181µs
asynchronous test cases only.    fs = 44.1kHz   fs = 16kHz    Asynchronous  644µs
28                                                                                 Rev 4.1


                                                                                                      WM8998
SIGNAL TIMING REQUIREMENTS
SYSTEM CLOCK & FREQUENCY LOCKED LOOP (FLL)
                                                                              tMCLKY
                                                                                                             VIH
                                   MCLK                                                                      VIL
                                                                         tMCLKL   tMCLKH
                             Figure 1 Master Clock Timing
 Test Conditions
 The following timing information is valid across the full range of recommended operating conditions.
 PARAMETER                                     TEST CONDITIONS                      MIN           TYP    MAX   UNIT
 Master Clock Timing (MCLK1, MCLK2)
                                             MCLK as input to FLL,                                      13.5  MHz
                                            FLLn_REFCLK_DIV=00
                                             MCLK as input to FLL,                                       27
                                            FLLn_REFCLK_DIV=01
 MCLK frequency
                                             MCLK as input to FLL,                                       40
                                         FLLn_REFCLK_DIV=10 or 11
                                          MCLK as direct SYSCLK or                                       25
                                              ASYNCCLK source
                                             MCLK as input to FLL                 80:20                20:80    %
 MCLK duty cycle                          MCLK as direct SYSCLK or                60:40                40:60
                                              ASYNCCLK source
 MCLK2 frequency                                  Sleep Mode                                          32.768   kHz
 Frequency Locked Loops (FLL1, FLL2)
 FLL input frequency                        FLLn_REFCLK_DIV=00                    0.032                 13.5  MHz
                                            FLLn_REFCLK_DIV=01                    0.064                  27
                                            FLLn_REFCLK_DIV=10                    0.128                  40
                                            FLLn_REFCLK_DIV=11                    0.256                  40
 FLL synchroniser input                    FLLn_SYNCCLK_DIV=00                    0.032                 13.5  MHz
 frequency                                 FLLn_SYNCCLK_DIV=01                    0.064                  27
                                           FLLn_SYNCCLK_DIV=10                    0.128                  40
                                           FLLn_SYNCCLK_DIV=11                    0.256                  40
Rev 4.1                                                                                                            29


                                                                                                      WM8998
 Test Conditions
 The following timing information is valid across the full range of recommended operating conditions.
 PARAMETER                                     TEST CONDITIONS                      MIN           TYP  MAX         UNIT
 Internal Clocking
 SYSCLK frequency                 SYSCLK_FREQ=000, SYSCLK_FRAC=0                   -1%          6.144 +1%        MHz
                                  SYSCLK_FREQ=000, SYSCLK_FRAC=1                   -1%         5.6448 +1%
                                  SYSCLK_FREQ=001, SYSCLK_FRAC=0                   -1%         12.288 +1%
                                  SYSCLK_FREQ=001, SYSCLK_FRAC=1                   -1%        11.2896 +1%
                                  SYSCLK_FREQ=010, SYSCLK_FRAC=0                   -1%         24.576 +1%
                                  SYSCLK_FREQ=010, SYSCLK_FRAC=1                   -1%        22.5792 +1%
                                  SYSCLK_FREQ=011, SYSCLK_FRAC=0                   -1%         49.152 +1%
                                  SYSCLK_FREQ=011, SYSCLK_FRAC=1                   -1%        45.1584 +1%
 ASYNCCLK frequency                        ASYNC_CLK_FREQ=000                      -1%          6.144 +1%        MHz
                                                                                   -1%         5.6448 +1%
                                           ASYNC_CLK_FREQ=001                      -1%         12.288 +1%
                                                                                   -1%        11.2896 +1%
                                           ASYNC_CLK_FREQ=010                      -1%         24.576 +1%
                                                                                   -1%        22.5792 +1%
                                           ASYNC_CLK_FREQ=011                      -1%         49.152 +1%
                                                                                   -1%        45.1584 +1%
Note:
When MCLK1 or MCLK2 is selected as a source for SYSCLK or ASYNCCLK (either directly or via one of the FLLs), the frequency
must be within 1% of the applicable SYSCLK_FREQ or ASYNCCLK_FREQ register setting.
30                                                                                                              Rev 4.1


                                                                                                           WM8998
AUDIO INTERFACE TIMING
                              DIGITAL MICROPHONE (DMIC) INTERFACE TIMING
                                                                                          tCY
                                   DMICCLK                                                                 VOH
                                      (output)                                                             VOL
                                                                            tr                     tf
                                                                tRSU tRH              tLSU    tLH
                                   DMICDAT                                                                 VIH
                                                                 (right data)          (left data)
                                        (input)                                                            VIL
                              Figure 2 Digital Microphone Interface Timing
 Test Conditions
 The following timing information is valid across the full range of recommended operating conditions.
                           PARAMETER                                       SYMBOL               MIN    TYP     MAX UNIT
 Digital Microphone Interface Timing
 DMICCLKn cycle time                                                           tCY             320    326      716 ns
 DMICCLKn duty cycle                                                                            45             55  %
 DMICCLKn rise/fall time (25pF load, 1.8V supply - see note)                  tr , tf            5             30  ns
 DMICDATn (Left) setup time to falling DMICCLK edge                           tLSU              15                 ns
 DMICDATn (Left) hold time from falling DMICCLK edge                           tLH               0                 ns
 DMICDATn (Right) setup time to rising DMICCLK edge                           tRSU              15                 ns
 DMICDATn (Right) hold time from rising DMICCLK edge                           tRH               0                 ns
Notes:
DMICDATn and DMICCLKn are each referenced to a selectable supply, VSUP.
The applicable supply is selected using the INn_DMIC_SUP registers.
Rev 4.1                                                                                                                31


                                                                                                                        WM8998
                             DIGITAL SPEAKER (PDM) INTERFACE TIMING
                                                                           tCY
                                SPKCLK                                                                              VOH
                                                                                                                    VOL
                                 (output)
                                                                                 tr                      tf
                                                                                      tLH                    tRH
                                SPKDAT                                                                              VOH
                                                               (left data)             (right data)
                                 (output)                                                                           VOL
                                                                   tLSU                     tRSU
                             Figure 3 Digital Speaker (PDM) Interface Timing - Mode A
 Test Conditions
 The following timing information is valid across the full range of recommended operating conditions.
                            PARAMETER                                           SYMBOL               MIN          TYP    MAX  UNIT
 PDM Audio Interface Timing
 SPKCLKn cycle time                                                                  tCY            160          163     358   ns
 SPKCLKn duty cycle                                                                                  45                   55   %
 SPKCLKn rise/fall time (25pF load)                                                 tr , tf           5                   30   ns
 SPKDATn set-up time to SPKCLKn rising edge (Left channel)                          tLSU             30                        ns
 SPKDATn hold time from SPKCLKn rising edge (Left channel)                           tLH             30                        ns
 SPKDATn set-up time to SPKCLKn falling edge (Right channel)                       tRSU              30                        ns
 SPKDATn hold time from SPKCLKn falling edge (Right channel)                         tRH             30                        ns
                                                                            tCY
                                SPKCLK                                                                            VOH
                                 (output)                                                                         VOL
                                                                                   tr                     tf
                                             tLEN                                         tREN
                                SPKDAT                                                                            VOH
                                                            (left data)          (right data)
                                 (output)                                                                         VOL
                                                             tLDIS                                      tRDIS
                             Figure 4 Digital Speaker (PDM) Interface Timing - Mode B
 Test Conditions
 The following timing information is valid across the full range of recommended operating conditions.
                            PARAMETER                                           SYMBOL               MIN          TYP    MAX  UNIT
 PDM Audio Interface Timing
 SPKCLKn cycle time                                                                  tCY            160          163     358   ns
 SPKCLKn duty cycle                                                                                  45                   55   %
 SPKCLKn rise/fall time (25pF load)                                                 tr , tf           5                   30   ns
 SPKDATn enable from SPKCLK rising edge (Right channel)                            tREN                                   15   ns
 SPKDATn disable to SPKCLK falling edge (Right channel)                            tRDIS                                   5   ns
 SPKDATn enable from SPKCLK falling edge (Left channel)                             tLEN                                  15   ns
 SPKDATn disable to SPKCLK rising edge (Left channel)                              tLDIS                                   5   ns
32                                                                                                                           Rev 4.1


                                                                                                             WM8998
                             DIGITAL AUDIO INTERFACE - MASTER MODE
                                                              tBCY
                                        BCLK
                                     (output)
                                                         tBCH      tBCL
                                      LRCLK
                                     (output)
                                                                                        tLRD
                                      TXDAT
                                     (output)
                                                                                        tDD
                                     RXDAT
                                       (input)
                                                                   tDSU    tDH
                             Figure 5 Audio Interface Timing - Master Mode
                             Note that BCLK and LRCLK outputs can be inverted if required; Figure 5 shows the default, non-
                             inverted polarity.
 Test Conditions
 The following timing information is valid across the full range of recommended operating conditions, unless otherwise noted.
 CLOAD = 15pF to 25pF (output pins). BCLK slew (10% to 90%) = 3.7ns to 5.6ns.
                           PARAMETER                                     SYMBOL         MIN         TYP         MAX        UNIT
 Audio Interface Timing - Master Mode
 AIFnBCLK cycle time                                                      tBCY          80                                  ns
 AIFnLRCLK propagation delay from BCLK falling edge                       tLRD           0                      12          ns
 AIFnTXDAT propagation delay from BCLK falling edge                        tDD           0                      12          ns
 AIFnRXDAT setup time to BCLK rising edge                                 tDSU           7                                  ns
 AIFnRXDAT hold time from BCLK rising edge                                 tDH           5                                  ns
Note:
The descriptions above assume non-inverted polarity of AIFnBCLK.
Rev 4.1                                                                                                                        33


                                                                                                         WM8998
                              DIGITAL AUDIO INTERFACE - SLAVE MODE
                                                                tBCY
                                         BCLK
                                        (input)
                                                          tBCH       tBCL
                                       LRCLK
                                        (input)
                                                                              tLRH  tLRSU
                                       TXDAT
                                      (output)
                                                        tDD
                                      RXDAT
                                        (input)
                                                                    tDSU        tDH
                              Figure 6 Audio Interface Timing - Slave Mode
                              Note that BCLK and LRCLK inputs can be inverted if required; Figure 6 shows the default, non-
                              inverted polarity.
  Test Conditions
  The following timing information is valid across the full range of recommended operating conditions.
                          PARAMETER                                       SYMBOL          MIN        TYP MAX      UNIT
  Audio Interface Timing - Slave Mode
  AIFnBCLK cycle time                                                       tBCY          80                       ns
  AIFnBCLK pulse width high                                                 tBCH          12                       ns
  AIFnBCLK pulse width low                                                  tBCL          12                       ns
  AIFnLRCLK set-up time to BCLK rising edge                                tLRSU           7                       ns
  AIFnLRCLK hold time from BCLK rising edge                                 tLRH           5                       ns
  AIFnRXDAT hold time from BCLK rising edge                                  tDH           5                       ns
  AIFnTXDAT propagation delay from BCLK falling edge                         tDD           0              12       ns
  AIFnRXDAT set-up time to BCLK rising edge                                 tDSU           7                       ns
Notes:
The descriptions above assume non-inverted polarity of AIFnBCLK.
When AIFnBCLK or AIFnLRCLK is selected as a source for SYSCLK or ASYNCCLK (either directly or via one of the FLLs), the
frequency must be within 1% of the applicable SYSCLK_FREQ or ASYNCCLK_FREQ register setting.
34                                                                                                               Rev 4.1


                                                                                                               WM8998
                                DIGITAL AUDIO INTERFACE - TDM MODE
                                When TDM operation is used on the AIFnTXDAT pins, it is important that two devices do not attempt
                                to drive the AIFnTXDAT pin simultaneously. To support this requirement, the AIFnTXDAT pins can be
                                configured to be tri-stated when not outputting data.
                                The timing of the AIFnTXDAT tri-stating at the start and end of the data transmission is described in
                                Figure 7 below.
         BCLK
       TXDAT         AIFnTXDAT undriven (tri-state)   AIFnTXDAT valid (CODEC output)    AIFnTXDAT valid     AIFnTXDAT undriven (tri-state)
                             AIFnTXDAT enable time                                     AIFnTXDAT disable time
Figure 7 Audio Interface Timing - TDM Mode
  Test Conditions
  The following timing information is valid across the full range of recommended operating conditions.
                                     PARAMETER                                        MIN             TYP       MAX               UNIT
  TDM Timing - Master Mode
  AIFnTXDAT enable time from BCLK falling edge                                         0                                           ns
  AIFnTXDAT disable time from BCLK falling edge                                                                  15                ns
  TDM Timing - Slave Mode
  AIFnTXDAT enable time from BCLK falling edge                                         5                                           ns
  AIFnTXDAT disable time from BCLK falling edge                                                                  32                ns
Rev 4.1                                                                                                                                    35


                                                                                                         WM8998
CONTROL INTERFACE TIMING
                      START              t1      t2                                           t6                 STOP
     SCLK
    (input)
                      t4      t3                                                                     t7       t8
      SDA
                                                              t5           t9          t10
Figure 8 Control Interface Timing
  Test Conditions
  The following timing information is valid across the full range of recommended operating conditions.
                     PARAMETER                                       SYMBOL                MIN       TYP  MAX       UNIT
  SCLK Frequency                                                                                         1000       kHz
  SCLK Low Pulse-Width                                                  t1               500                         ns
  SCLK High Pulse-Width                                                 t2               260                         ns
  Hold Time (Start Condition)                                           t3               260                         ns
  Setup Time (Start Condition)                                          t4               260                         ns
  SDA, SCLK Rise Time (20% to 80%)                                      t6                                120        ns
  SDA, SCLK Fall Time (80% to 20%)                                      t7                                120        ns
  Setup Time (Stop Condition)                                           t8               260                         ns
  SDA Setup Time (data input)                                           t5                50                         ns
  SDA Hold Time (data input)                                            t9                 0                         ns
  SDA Valid Time (data/ACK output)                                     t10                                450        ns
  Pulse width of spikes that will be suppressed                        tps                 0              50         ns
36                                                                                                                 Rev 4.1


                                                                                                               WM8998
SLIMBUS INTERFACE TIMING
                                                                                                                              VIH
                                      SLIMCLK                                                                                 VIL
                                                                                      TCLKIL            TCKLIH
                                                                                                                              VIH
                                      SLIMDAT                                                                                 VIL
                                                                TDV TSETUP                  TH
                                    VIL, VIH are the 35%/65% levels of the respective inputs.
                                    The SLIMDAT output delay (TDV) is with respect to the input pads of all receiving devices.
                             Figure 9 SLIMbus Interface Timing
                             The signal timing information shown in Figure 9 describe the timing requirements of the SLIMbus
                             interface as a whole, not just the WM8998 device. Accordingly, the following should be noted:
                                        TDV is the propagation delay from the rising SLIMCLK edge (at WM8998 input) to the
                                         SLIMDAT output being achieved at the input to all devices across the bus.
                                        TSETUP is the set-up time for SLIMDAT input (at WM8998), relative to the falling SLIMCLK
                                         edge (at WM8998).
                                        TH is the hold time for SLIMDAT input (at WM8998) relative to the falling SLIMCLK edge (at
                                         WM8998).
                             For more details of the interface timing, refer to the MIPI Alliance Specification for Serial Low-power
                             Inter-chip Media Bus (SLIMbus).
 Test Conditions
 The following timing information is valid across the full range of recommended operating conditions, unless otherwise noted.
                           PARAMETER                                     SYMBOL          MIN        TYP           MAX        UNIT
 SLIMCLK Input
 SLIMCLK cycle time                                                                      35                                   ns
 SLIMCLK pulse width high                                                 TCLKIH         13                                   ns
 SLIMCLK pulse width low                                                  TCLKIL         13                                   ns
 SLIMDAT Input
 SLIMDAT setup time to SLIMCLK falling edge                              TSETUP         3.5                                   ns
 SLIMDAT hold time from SLIMCLK falling edge                               TH             2                                   ns
 SLIMDAT Output
 SLIMDAT time for data             CLOAD = 15pF,                           TDV                      6.7           8.6         ns
 output valid (wrt SLIMCLK         VDBVDD1 = 1.62V
 rising edge)                      CLOAD = 35pF,                                                    9.8          12.5
                                   VDBVDD1 = 1.62V
 SLIMDAT slew rate                 CLOAD = 15pF                          SRDATA                                 0.54 x       V/ns
 (20% to 80%)                                                                                                  VDBVDD1
                                   CLOAD = 35pF                                                                 0.34 x
                                                                                                               VDBVDD1
 Other Parameters
 Driver disable time                                                       TDD                                     6          ns
 Bus holder output impedance       0.1 x VDBVDD1 < V <                   RDATAS          18                       50          kΩ
                                   0.9 x VDBVDD1
Rev 4.1                                                                                                                           37


                                                                                                  WM8998
DEVICE DESCRIPTION
INTRODUCTION
               The WM8998 is a highly integrated low-power audio hub CODEC for mobile telephony and portable
               devices. It provides flexible, high-performance audio interfacing for handheld devices in a small and
               cost-effective package. It is optimised for the needs of tablet devices and multimedia phones using
               SLIMbus application processors.
               The WM8998 digital core provides configurable capability for signal processing algorithms, including
               parametric equalisation (EQ) and dynamic range control (DRC). Highly flexible digital mixing,
               including stereo full-duplex asynchronous sample rate conversion, provides use-case flexibility across
               a broad range of system architectures. A signal generator for controlling haptics vibe actuators is
               included.
               The WM8998 provides multiple digital audio interfaces, including SLIMbus, in order to provide
               independent and fully asynchronous connections to different processors (eg. application processor,
               baseband processor and wireless transceiver).
               A flexible clocking arrangement supports a wide variety of external clock references, including
               clocking derived from the digital audio interface. Two integrated Frequency Locked Loop (FLL) circuits
               provide additional flexibility.
               Unused circuitry can be disabled under software control, in order to save power; low leakage currents
               enable extended standby/off time in portable battery-powered applications. Configurable ‘Wake-Up’
               actions can be associated with the low-power standby (Sleep) mode.
               Versatile GPIO functionality is provided, and support for external accessory / push-button detection
               inputs. Comprehensive Interrupt (IRQ) logic and status readback are also provided.
               HI-FI AUDIO CODEC
               The WM8998 is a high-performance low-power audio CODEC which uses a simple analogue
               architecture. Input path multiplexers select from up to 6 analogue mic/line and 3 digital microphone
               inputs; combinations of up to 3 inputs can be supported. 7 DACs are incorporated, providing a
               dedicated DAC for each output channel.
               The analogue outputs comprise a 28mW (122dB SNR) stereo headphone amplifier with ground-
               referenced output, a flexible (single-ended or differential) line output, a 100mW differential (BTL)
               earpiece driver, and a Class D stereo speaker driver capable of delivering 2W per channel into a 4Ω
               load. Six analogue inputs are provided, each supporting single-ended or differential input modes. In
               differential mode, the input path SNR is 96dB. Up to 3 analogue or digital input paths can be
               supported at one time.
               The audio CODEC is controlled directly via register access. The simple analogue architecture,
               combined with the integrated tone generator, enables simple device configuration and testing,
               minimising debug time and reducing software effort.
               The WM8998 output drivers are designed to support as many different system architectures as
               possible. Each output has a dedicated DAC which allows mixing, equalisation, filtering, gain and other
               audio processing to be configured independently for each channel. This allows each signal path to be
               individually tailored for the load characteristics. All outputs have integrated pop and click suppression
               features.
               The headphone, line and earpiece output drivers are ground-referenced, powered from an integrated
               charge pump, enabling high quality, power efficient headphone playback without any requirement for
               DC blocking capacitors. Ground loop feedback is incorporated, providing rejection of noise on the
               ground connections.
               The Class D speaker drivers deliver excellent power efficiency. High PSRR, low leakage and
               optimised supply voltage ranges enable powering from switching regulators or directly from the
               battery. Battery current consumption is minimised across a wide variety of voice communication and
               multimedia playback use cases.
               The WM8998 is cost-optimised for a wide range of mobile phone applications, and features two
               channels of Class D power amplification. For applications requiring more than two channels of power
               amplification (or when using the integrated Class D path to drive a haptics actuator), the PDM output
               channels can be used to drive two external PDM-input speaker drivers. In applications where stereo
               loudspeakers are physically widely separated, the PDM outputs can ease layout and EMC by avoiding
               the need to run the Class-D speaker outputs over long distances and interconnects.
38                                                                                                             Rev 4.1


                                                                                        WM8998
        DIGITAL AUDIO CORE
        The WM8998 uses a core architecture based on all-digital signal routing, making digital audio effects
        available on all signal paths, regardless of whether the source data input is analogue or digital. The
        digital mixing desk allows different audio effects to be applied simultaneously on many independent
        paths, whilst also supporting a variety of sample rates concurrently. This helps support many new
        audio use-cases. Soft mute and un-mute control allows smooth transitions between use-cases without
        interrupting existing audio streams elsewhere.
        Highly flexible digital mixing, including mixing between audio interfaces, is possible. The WM8998
        performs stereo full-duplex asynchronous sample rate conversion, providing use-case flexibility
        across a broad range of system architectures. Automatic sample rate detection is provided, enabling
        seamless wideband/narrowband voice call handover.
        Dynamic Range Controller (DRC) functions are available for optimising audio signal levels. In
        playback modes, the DRC can be used to maximise loudness, while limiting the signal level to avoid
        distortion, clipping or battery droop, in particular for high-power output drivers such as speaker
        amplifiers. In record modes, the DRC assists in applications where the signal level is unpredictable.
        The 5-band parametric equaliser (EQ) functions can be used to compensate for the frequency
        characteristics of the output transducers. EQ functions can be cascaded to provide additional
        frequency control. Programmable high-pass and low-pass filters are also available for general filtering
        applications such as removal of wind and other low-frequency noise.
        DIGITAL INTERFACES
        Three serial digital audio interfaces (AIFs) each support PCM, TDM and I2S data formats for
        compatibility with most industry-standard chipsets. AIF1 and AIF2 support six input/output channels
        each; AIF3 supports two input/output channels. Bidirectional operation at sample rates up to 192kHz
        is supported.
        Three digital PDM input channels are available (one stereo, and one mono interface); these are
        typically used for digital microphones, powered from the integrated MICBIAS power supply regulators.
        Two PDM output channels are also available (one stereo interface); these are typically used for
        external power amplifiers. Embedded mute codes provide a control mechanism for external PDM-
        input devices.
        The WM8998 features a MIPI-compliant SLIMbus interface, providing 4 input, and 6 output channels
        of audio support. Mixed audio sample rates are supported on the SLIMbus interface. The SLIMbus
        interface also supports read/write access to the WM8998 control registers.
        An IEC-60958-3 compatible S/PDIF transmitter is incorporated, enabling stereo S/PDIF output on a
        GPIO pin. Standard S/PDIF sample rates of 32kHz up to 192kHz are all supported.
        The WM8998 is equipped with an I2C slave port (at up to 1MHz). Full access to the register map is
        also provided via the SLIMbus port.
Rev 4.1                                                                                                      39


                                                                                     WM8998
   OTHER FEATURES
   The WM8998 incorporates two 1kHz tone generators which can be used for ‘beep’ functions through
   any of the audio signal paths. The phase relationship between the two generators is configurable,
   providing flexibility in creating differential signals, or for test scenarios.
   Two Pulse Width Modulation (PWM) signal generators are incorporated. The duty cycle of each PWM
   signal can be modulated by an audio source, or can be set to a fixed value using a control register
   setting. The PWM signal generators can be output directly on a GPIO pin.
   The WM8998 provides 5 GPIO pins, supporting selectable input/output functions for interfacing,
   detection of external hardware, and to provide logic outputs to other devices. Comprehensive Interrupt
   (IRQ) functionality is also provided for monitoring internal and external event conditions.
   A signal generator for controlling haptics devices is included, compatible with both Eccentric Rotating
   Mass (ERM) and Linear Resonant Actuator (LRA) haptic devices. The haptics signal generator is
   highly configurable, and can execute programmable drive event profiles, including reverse drive
   control. An external vibe actuator can be driven directly by the Class D speaker output.
   The WM8998 can be powered from a 1.8V external supply. A separate supply (4.2V) is typically
   required for the Class D speaker driver. Integrated Charge Pump and LDO Regulators circuits are
   used to generate supply rails for internal functions and to support powering or biasing of external
   microphones.
   A smart accessory interface is included, supporting most standard 3.5mm accessories. Jack
   detection, accessory sensing and impedance measurement is provided, for external accessory and
   push-button detection. Accessory detection can be used as a ‘Wake-Up’ trigger from low-power
   standby. Microphone activity detection with interrupt is also available.
   System clocking can be derived from the MCLK1 or MCLK2 input pins. Alternatively, the SLIMbus
   interface, or the audio interfaces (configured in Slave mode), can be used to provide a clock
   reference. Two integrated Frequency Locked Loop (FLL) circuits provide support for a wide range of
   clocking configurations, including the use of a 32kHz input clock reference.
40                                                                                              Rev 4.1


                                                                                                                                   WM8998
INPUT SIGNAL PATH
                           The WM8998 has six highly flexible input channels. Selectable combinations of analogue (mic or line)
                           and digital inputs are multiplexed into three input signal paths.
                           The analogue input paths support single-ended and differential modes, programmable gain control
                           and are digitised using a high performance 24-bit sigma-delta ADC.
                           The digital input paths interface directly with up to three external digital microphones; two separate
                           interfaces are provided (stereo and mono respectively), with an independent clock output for each.
                           Digital delay can be applied to any of the digital input paths; this can be used for phase adjustment of
                           any digital input, including directional control of multiple microphones.
                           Three microphone bias (MICBIAS) generators are available, which provide a low noise reference for
                           biasing electret condenser microphones (ECMs) or for use as a low noise supply for MEMS
                           microphones and digital microphones.
                           Digital volume control is available on all inputs (analogue and digital), with programmable ramp
                           control for smooth, glitch-free operation.
                           The input signal paths and control registers are illustrated in Figure 10.
                                        IN1L_SRC [1:0]                                IN1_OSR (Analogue input mode)
                                        00 = Differential IN1ALP – IN1ALN             00 = Low Power mode
            IN1BLN                      01 = Single-ended IN1ALP (non-inverting)      01 = High Performance mode
                                        10 = Differential IN1BLP – IN1BLN             1X = Reserved
                                        11 = Single-ended IN1BLP (non-inverting)                                 IN_HPF_CUT[2:0]
            IN1BLP                                                                                      IN1_MODE
  IN1ALN/DMICCLK1                                           -
                                                                                   ADC
                                                            +
            IN1ALP
                                                         IN1L_PGA_VOL [6:0]
                                                                                                                      IN1L_HPF     IN1L_VOL [7:0]
                                           IN1R_SRC [1:0]
                                           00 = Differential IN1ARP – IN1ARN
            IN1BRN                         01 = Single-ended IN1ARP (non-inverting)                                                IN1L_ENA
                                           10 = Differential IN1BRP – IN1BRN
                                           11 = Single-ended IN1BRP (non-inverting)
            IN1BRP
 IN1ARN/DMICDAT1                                            -
                                                                                   ADC
                                                            +
            IN1ARP
                                                         IN1R_PGA_VOL [6:0]
                                                                                                                      IN1R_HPF     IN1R_VOL [7:0]
                                                    DAT
                                                                 Digital Mic
                                                    CLK                                                                            IN1R_ENA
                                                                  Interface
                          IN1_OSR (Digital input mode)       IN1_DMIC_SUP [1:0]
                          00 = 1.536MHz                      IN1L_DMIC_DLY [5:0]
                          01 = 3.072MHz                      IN1R_DMIC_DLY [5:0]
                          10 = Reserved
                          11 = 768kHz
                                        IN2_SRC [1:0]                                 IN2_OSR (Analogue input mode)
                                        00 = Differential IN2AP – IN2AN               00 = Low Power mode
             IN2BN                      01 = Single-ended IN2AP (non-inverting)       01 = High Performance mode
                                        10 = Differential IN2BP – IN2BN               1X = Reserved
                                        11 = Single-ended IN2BP (non-inverting)
             IN2BP
   IN2AN/DMICCLK2                                           -
                                                                                   ADC
                                                            +
   IN2AP/DMICDAT2
                                                         IN2_PGA_VOL [6:0]
                                                                                                       IN2_MODE       IN2_HPF      IN2_VOL [7:0]
                                                    DAT
                                                                 Digital Mic
                                                    CLK                                                                            IN2_ENA
                                                                  Interface
                          IN2_OSR (Digital input mode)       IN2_DMIC_SUP [1:0]
                          00 = 1.536MHz                      IN2_DMIC_DLY [5:0]
                          01 = 3.072MHz
                          10 = Reserved
                          11 = 768kHz
Figure 10 Input Signal Paths
Rev 4.1                                                                                                                                             41


                                                                                                                           WM8998
                         ANALOGUE MICROPHONE INPUT
                         Up to six analogue microphones can be connected to the WM8998, either in single-ended or
                         differential mode. The applicable mode, and input pin selection, is controlled using the INnx_SRC
                         registers, as described later.
                         The WM8998 includes external accessory detection circuits, which can detect the presence of a
                         microphone, and the status of a hookswitch or other push-buttons. When using this function, it is
                         recommended to use the IN2B analogue microphone input paths, to ensure best immunity to electrical
                         transients arising from the push-buttons.
                         For single-ended input, the microphone signal is connected to the non-inverting input of the PGAs
                         (INnLP, INnRP, or INnP). The inverting inputs of the PGAs are connected to an internal reference in
                         this configuration.
                         For differential input, the non-inverted microphone signal is connected to the non-inverting input of the
                         PGAs (INnLP, INnRP, or INnP), whilst the inverted (or ‘noisy ground’) signal is connected to the
                         inverting input pins (INnLN, INnRN, or INnN).
                         The gain of the input PGAs is controlled via register settings, as defined in Table 4. Note that the input
                         impedance of the analogue input paths is fixed across all PGA gain settings.
                         The Electret Condenser Microphone (ECM) analogue input configurations are illustrated in Figure 11
                         and Figure 12. The integrated MICBIAS generators provide a low noise reference for biasing the
                         ECMs.
                                 MICBIAS                                                        MICBIAS
                                            IN1AxP,                                                              IN1AxP,
                                            IN1BxP,                                                              IN1BxP,
                                            IN2AP,                                                               IN2AP,
                                            IN2BP                                                                IN2BP
                                            IN1AxN,             +                                                IN1AxN,         +
                                MIC         IN1BxN,             PGA       To ADC               MIC               IN1BxN,         PGA     To ADC
                                            IN2AN,              -                                                IN2AN,          -
                                            IN2BN                                                                IN2BN
                                      GND
                                                VMID                                                               VMID
                                                                                                     GND
                          Figure 11 Single-Ended ECM Input                                   Figure 12 Differential ECM Input
                         Analogue MEMS microphones can be connected to the WM8998 in a similar manner to the ECM
                         configurations described above; typical configurations are illustrated in Figure 13 and Figure 14. In
                         this configuration, the integrated MICBIAS generators provide a low-noise power supply for the
                         microphones.
        MICBIAS
                      IN1AxP,                                                                          IN1AxP,
                      IN1BxP,                                                      MICBIAS             IN1BxP,
          VDD         IN2AP,                                                                           IN2AP,
                      IN2BP                                                                            IN2BP
 MEMS
                OUT
 Mic                                                                                VDD
          GND         IN1AxN,               +                                                          IN1AxN,             +
                                                                       MEMS            OUT-P
                      IN1BxN,                PGA       To ADC                                          IN1BxN,             PGA         To ADC
                                                                       Mic            OUT-N            IN2AN,              -
                      IN2AN,                -
                      IN2BN
                                                                                    GND                IN2BN
          GND
                        VREF                                                                               VREF
                                                                                    GND
Figure 13 Single-Ended MEMS Input                                     Figure 14 Differential MEMS Input
                         Note that the MICVDD pin can also be used (instead of MICBIASn) as a reference or power supply for
                         external microphones. The MICBIAS outputs are recommended, as these offer better noise
                         performance and independent enable/disable control.
42                                                                                                                                      Rev 4.1


                                                                                           WM8998
          ANALOGUE LINE INPUT
          Line inputs can be connected to the WM8998 in a similar manner to the microphone inputs described
          above. Single-ended and differential modes are supported on each of the six analogue input paths.
          The applicable mode (single-ended or differential) is selected using the INnx_SRC registers, as
          described later.
          The analogue line input configurations are illustrated in Figure 15 and Figure 16. Note that the
          microphone bias (MICBIAS) is not used for line input connections.
                         IN1AxP,                                                IN1AxP,
                         IN1BxP,                                                IN1BxP,
                         IN2AP,                                                 IN2AP,
                         IN2BP                                                  IN2BP
             Line
                                                                      Line
                         IN1AxN,          +                                     IN1AxN,          +
                         IN1BxN,           PGA     To ADC                       IN1BxN,           PGA      To ADC
                         IN2AN,           -                                     IN2AN,           -
                         IN2BN                                                  IN2BN
                GND
                           VMID                                                   VMID
          Figure 15 Single-Ended Line Input                       Figure 16 Differential Line Input
          DIGITAL MICROPHONE INPUT
          Up to three digital microphones can be connected to the WM8998. The digital microphone mode is
          selected using the INn_MODE registers, as described later. Note that the IN1_MODE setting is
          applicable to a stereo pair of inputs; the Left and Right channels of any stereo pair of inputs are
          always in the same mode.
          In digital microphone mode, audio data is input on the DMICDAT1 or DMICDAT2 pins. The
          DMICDAT1 pin carries two multiplexed channels of audio data; the DMICDAT2 pin supports a single
          channel of audio data. These interfaces are clocked using the respective DMICCLK1 or DMICCLK2
          pin.
          When digital microphone input is enabled, the WM8998 outputs a clock signal on the applicable
          DMICCLKn pin(s). The DMICCLKn frequency is controlled by the respective INn_OSR register, as
          described in Table 1. See Table 3 for details of the INn_OSR registers.
          Note that, if the 768kHz DMICCLKn frequency is selected for one or more of the digital microphone
          input paths, then the Input Path sample rate (all input paths) is valid in the range 8kHz to 16kHz only.
          Note that the DMICCLKn frequencies noted in Table 1 assume that the SYSCLK frequency is a
          multiple of 6.144MHz (SYSCLK_FRAC=0). If the SYSCLK frequency is a multiple of 5.6448MHz
          (SYSCLK_FRAC=1), then the DMICCLKn frequencies will be scaled accordingly.
                       CONDITION                   DMICCLKn FREQUENCY                     SIGNAL PASSBAND
                      INn_OSR = 00                          1.536MHz                         up to 20kHz
                      INn_OSR = 01                          3.072MHz                         up to 20kHz
                      INn_OSR = 11                           768kHz                          up to 8kHz
          Table 1 DMICCLK Frequency
          The voltage reference for each digital microphone interface is selectable, using the INn_DMIC_SUP
          registers. Each interface may be referenced to MICVDD, or to the MICBIAS1, MICBIAS2 or
          MICBIAS3 levels.
          A stereo pair of digital microphones is connected as illustrated in Figure 17. In this configuration, the
          microphones must be configured to ensure that the Left mic transmits a data bit when DMICCLK is
          high, and the Right mic transmits a data bit when DMICCLK is low. The WM8998 samples the digital
          microphone data at the end of each DMICCLK phase. Each microphone must tri-state its data output
          when the other microphone is transmitting.
          The DMICDAT2 pin supports mono input on the Left interface channel only. The DMIC2 microphone
Rev 4.1                                                                                                         43


                                                                                  WM8998
   ust be configured to ensure that it transmits a data bit when DMICCLK is high.
   Note that the WM8998 provides integrated pull-down resistors on the DMICDAT1 and DMICDAT2
   pins. This provides a flexible capability for interfacing with other devices.
                                                                       MICVDD or
                                                                       MICBIASn
                                                                       DMICCLKn
                                                                                     Digital
                                                                       DMICDATn   Microphone
                                                                                   Interface
            VDD    CLK  DATA               VDD    CLK  DATA
     VDD      Digital Mic                     Digital Mic
            CHAN                           CHAN
                                                                       AGND
   Figure 17 Digital Microphone Input
   Two digital microphone channels are interleaved on DMICDATn. The digital microphone interface
   timing is illustrated in Figure 18. Each microphone must tri-state its data output when the other
   microphone is transmitting.
   The DMICDAT2 pin supports mono input on the Left interface channel only. The DMIC2 microphone
   ust be configured to ensure that it transmits a data bit when DMICCLK is high.
             DMICCLKn pin
                                                        hi-Z
             Left Mic output            1              1             1
           Right Mic output                     2             2            2
             DMICDATn pin                1      2       1     2      1      2
                 (Left & Right
     channels interleaved)
   Figure 18 Digital Microphone Interface Timing
   When digital microphone input is enabled, the WM8998 outputs a clock signal on the applicable
   DMICCLK pin(s). The DMICCLK frequency is selectable, as described in Table 1.
   Note that SYSCLK must be present and enabled when using the Digital Microphone inputs; see
   “Clocking and Sample Rates” for details of SYSCLK and the associated register control fields.
44                                                                                            Rev 4.1


                                                                                           WM8998
        INPUT SIGNAL PATH ENABLE
        The input signal paths are enabled using the register bits described in Table 2. The respective bit(s)
        must be enabled for analogue or digital input on the respective input path(s).
        The input signal paths are muted by default. It is recommended that de-selecting the mute should be
        the final step of the path enable control sequence. Similarly, the mute should be selected as the first
        step of the path disable control sequence. The input signal path mute functions are controlled using
        the register bits described in Table 4.
        The MICVDD power domain must be enabled when using the analogue input signal path(s). This
        power domain is provided using an internal Charge Pump (CP2) and LDO Regulator (LDO2). See
        “Charge Pumps, Regulators and Voltage Reference” for details of these circuits.
        The system clock, SYSCLK, must be configured and enabled before any audio path is enabled. The
        ASYNCCLK and 32kHz clock may also be required, depending on the path configuration. See
        “Clocking and Sample Rates” for details of the system clocks.
        The WM8998 performs automatic checks to confirm that the SYSCLK frequency is high enough to
        support the input signal paths and associated ADCs. If an attempt is made to enable an input signal
        path, and there are insufficient SYSCLK cycles to support it, then the attempt will be unsuccessful.
        (Note that any signal paths that are already active will not be affected under these circumstances.)
        The Underclocked Error condition can be monitored using the GPIO and/or Interrupt functions. See
        “General Purpose Input / Output” and “Interrupts” for further details.
        The status bits in Register R769 indicate the status of each of the input signal paths. If an
        Underclocked Error condition occurs, then these bits provide readback of which input signal path(s)
        have been successfully enabled.
           REGISTER        BIT          LABEL         DEFAULT                       DESCRIPTION
           ADDRESS
          R768             3      IN2_ENA                  0         Input Path 2 Enable
          (0300h)                                                    0 = Disabled
          Input                                                      1 = Enabled
          Enables          1      IN1L_ENA                 0         Input Path 1 (Left) Enable
                                                                     0 = Disabled
                                                                     1 = Enabled
                           0      IN1R_ENA                 0         Input Path 1 (Right) Enable
                                                                     0 = Disabled
                                                                     1 = Enabled
          R769             3      IN2_ENA_STS              0         Input Path 2 Enable Status
          (0301h)                                                    0 = Disabled
          Input                                                      1 = Enabled
          Enables          1      IN1L_ENA_STS             0         Input Path 1 (Left) Enable Status
          Status
                                                                     0 = Disabled
                                                                     1 = Enabled
                           0      IN1R_ENA_STS             0         Input Path 1 (Right) Enable Status
                                                                     0 = Disabled
                                                                     1 = Enabled
        Table 2 Input Signal Path Enable
Rev 4.1                                                                                                      45


                                                                                     WM8998
   INPUT SIGNAL PATH SAMPLE RATE CONTROL
   The input signal paths may be selected as input to the digital mixers or signal processing functions
   within the WM8998 digital core. The sample rate for the input signal paths is configured using the
   IN_RATE register - see Table 19 within the “Digital Core” section.
   Note that sample rate conversion is required when routing the input signal paths to any signal chain
   that is asynchronous and/or configured for a different sample rate.
   INPUT SIGNAL PATH CONFIGURATION
   The WM8998 supports six input channels. Selectable combinations of analogue (mic or line) and
   digital inputs are multiplexed into three input signal paths.
   The input signal path configuration is selected using the INn_MODE and INnx_SRC registers (where
   ‘n’ identifies the associated input, and ‘x’ identifies the left/right channel, where applicable). The
   external circuit configurations are illustrated on the previous pages.
   A configurable high pass filter (HPF) is provided on the left and right channels of each input path. The
   applicable cut-off frequency is selected using the IN_HPF_CUT register. The filter can be enabled on
   each path independently using the IN1L_HPF, IN1R_HPF and IN2_HPF bits.
   The analogue input signal paths (single-ended or differential) each incorporate a PGA to provide gain
   in the range 0dB to +31dB in 1dB steps. Note that these PGAs do not provide pop suppression
   functions; it is recommended that the gain should not be adjusted whilst the respective signal path is
   enabled.
   The analogue input PGA gain is controlled using the IN1L_PGA_VOL, IN1R_PGA_VOL and
   IN2_PGA_VOL registers.
   When the input signal path is configured for digital microphone input, the voltage reference for the
   associated input/output pins is selectable using the INn_DMIC_SUP registers - each interface may be
   referenced to MICVDD, or to the MICBIAS1, MICBIAS2 or MICBIAS3 levels.
   When the input signal path is configured for digital microphone input, the respective DMICCLKn
   frequency can be configured using the INn_OSR register bits.
   A digital delay may be applied to any of the digital microphone input channels. This feature can be
   used for phase adjustment of any digital input, including directional control of multiple microphones.
   The delay is controlled using the IN1L_DMIC_DLY, IN1R_DMIC_DLY and IN2_DMIC_DLY registers.
   The MICVDD voltage is generated by an internal Charge Pump and LDO Regulator. The MICBIAS1,
   MICBIAS2 and MICBIAS3 outputs are derived from MICVDD - see “Charge Pumps, Regulators and
   Voltage Reference”.
   Under default register conditions, the input signal paths are configured for highest performance. This
   can be adjusted using the INn_OSR registers, which provide control of the DMICCLKn frequency and
   the ADC oversample rate.
   The input signal paths are configured using the register bits described in Table 3.
46                                                                                                Rev 4.1


                                                                       WM8998
         REGISTER   BIT       LABEL    DEFAULT                 DESCRIPTION
         ADDRESS
        R780       2:0  IN_HPF_CUT      010    Input Path HPF Select
        (030Ch)         [2:0]                  Controls the cut-off frequency of the input
        HPF                                    path HPF circuits.
        Control                                000 = 2.5Hz
                                               001 = 5Hz
                                               010 = 10Hz
                                               011 = 20Hz
                                               100 = 40Hz
                                               All other codes are Reserved
        R784       15   IN1L_HPF         0     Input Path 1 (Left) HPF Enable
        (0310h)                                0 = Disabled
        IN1L                                   1 = Enabled
        Control
                  14:13 IN1_OSR [1:0]    01    Input Path 1 DMIC Oversample Rate
                                               When analogue input is selected
                                               (IN1_MODE=0), this bit controls the
                                               performance mode
                                               00 = Low Power mode
                                               01 = High Performance mode
                                               1X = Reserved
                                               When digital microphone input is selected
                                               (IN1_MODE=1), this field controls the
                                               sample rate as below:
                                               00 = 1.536MHz
                                               01 = 3.072MHz
                                               10 = Reserved
                                               11 = 768kHz
                                               When IN1_OSR=11, the Input Path
                                               sample rate (for all input paths) must be in
                                               the range 8kHz to 16kHz.
                  12:11 IN1_DMIC_SUP     00    Input Path 1 DMIC Reference Select
                        [1:0]                  (Sets the DMICDAT1 and DMICCLK1
                                               logic levels)
                                               00 = MICVDD
                                               01 = MICBIAS1
                                               10 = MICBIAS2
                                               11 = MICBIAS3
                   10   IN1_MODE         0     Input Path 1 Mode
                                               0 = Analogue input
                                               1 = Digital input
                   7:1  IN1L_PGA_VOL    40h    Input Path 1 (Left) PGA Volume
                        [6:0]                  (Applicable to analogue inputs only)
                                               00h to 3Fh = Reserved
                                               40h = 0dB
                                               41h = 1dB
                                               42h = 2dB
                                               … (1dB steps)
                                               5F = 31dB
                                               60h to 7Fh = Reserved
        R785      14:13 IN1L_SRC [1:0]   00    Input Path 1 (Left) Source
        (0311h)                                00 = Differential (IN1ALP - IN1ALN)
        ADC                                    01 = Single-ended (IN1ALP)
        Digital                                10 = Differential (IN1BLP-IN1BLN)
        Volume 1L                              11 = Single-ended (IN1BLP)
        R786       5:0  IN1L_DMIC_DLY   00h    Input Path 1 (Left) Digital Delay
        (0312h)         [5:0]                  (Applicable to digital input only)
        DMIC1L                                 LSB = 1 sample, Range is 0 to 63.
        Control                                (Sample rate is controlled by IN1_OSR.)
Rev 4.1                                                                                   47


                                                                  WM8998
    REGISTER   BIT       LABEL    DEFAULT                 DESCRIPTION
    ADDRESS
   R788       15   IN1R_HPF         0     Input Path 1 (Right) HPF Enable
   (0314h)                                0 = Disabled
   IN1R                                   1 = Enabled
   Control
              7:1  IN1R_PGA_VOL    40h    Input Path 1 (Right) PGA Volume
                   [6:0]                  (Applicable to analogue inputs only)
                                          00h to 3Fh = Reserved
                                          40h = 0dB
                                          41h = 1dB
                                          42h = 2dB
                                          … (1dB steps)
                                          5F = 31dB
                                          60h to 7Fh = Reserved
   R789      14:13 IN1R_SRC [1:0]   00    Input Path 1 (Right) Source
   (0315h)                                00 = Differential (IN1ARP - IN1ARN)
   ADC                                    01 = Single-ended (IN1ARP)
   Digital                                10 = Differential (IN1BRP-IN1BRN)
   Volume                                 11 = Single-ended (IN1BRP)
   1R
   R790       5:0  IN1R_DMIC_DLY   00h    Input Path 1 (Right) Digital Delay
   (0316h)         [5:0]                  (Applicable to digital input only)
   DMIC1R                                 LSB = 1 sample, Range is 0 to 63.
   Control                                (Sample rate is controlled by IN1_OSR.)
   R792       15   IN2_HPF          0     Input Path 2 HPF Enable
   (0318h)                                0 = Disabled
   IN2L                                   1 = Enabled
   Control
             14:13 IN2_OSR [1:0]    01    Input Path 2 DMIC Oversample Rate
                                          When analogue input is selected
                                          (IN1_MODE=0), this bit controls the
                                          performance mode
                                          00 = Low Power mode
                                          01 = High Performance mode
                                          1X = Reserved
                                          When digital microphone input is selected
                                          (IN2_MODE=1), this field controls the
                                          sample rate as below:
                                          00 = 1.536MHz
                                          01 = 3.072MHz
                                          10 = Reserved
                                          11 = 768kHz
                                          When IN2_OSR=11, the Input Path
                                          sample rate (for all input paths) must be in
                                          the range 8kHz to 16kHz.
             12:11 IN2_DMIC_SUP     00    Input Path 2 DMIC Reference Select
                   [1:0]                  (Sets the DMICDAT2 and DMICCLK2
                                          logic levels)
                                          00 = MICVDD
                                          01 = MICBIAS1
                                          10 = MICBIAS2
                                          11 = MICBIAS3
              10   IN2_MODE         0     Input Path 2 Mode
                                          0 = Analogue input
                                          1 = Digital input
48                                                                            Rev 4.1


                                                                                WM8998
          REGISTER      BIT         LABEL       DEFAULT                DESCRIPTION
          ADDRESS
                       7:1    IN2_PGA_VOL        40h    Input Path 2 PGA Volume
                              [6:0]                     (Applicable to analogue inputs only)
                                                        00h to 3Fh = Reserved
                                                        40h = 0dB
                                                        41h = 1dB
                                                        42h = 2dB
                                                        … (1dB steps)
                                                        5F = 31dB
                                                        60h to 7Fh = Reserved
         R793         14:13   IN2_SRC [1:0]       00    Input Path 2 Source
         (0319h)                                        00 = Differential (IN2AP - IN2AN)
         ADC                                            01 = Single-ended (IN2AP)
         Digital                                        10 = Differential (IN2BP-IN2BN)
         Volume 2L                                      11 = Single-ended (IN2BP)
         R794          5:0    IN2_DMIC_DLY       00h    Input Path 2 Digital Delay
         (031Ah)              [5:0]                     (Applicable to digital input only)
         DMIC2L                                         LSB = 1 sample, Range is 0 to 63.
         Control                                        (Sample rate is controlled by IN2_OSR.)
        Table 3 Input Signal Path Configuration
Rev 4.1                                                                                         49


                                                                                        WM8998
   INPUT SIGNAL PATH DIGITAL VOLUME CONTROL
   A digital volume control is provided on each of the input signal paths, providing -64dB to +31.5dB gain
   control in 0.5dB steps. An independent mute control is also provided for each input signal path.
   Whenever the gain or mute setting is changed, the signal path gain is ramped up or down to the new
   settings at a programmable rate. For increasing gain (or un-mute), the rate is controlled by the
   IN_VI_RAMP register. For decreasing gain (or mute), the rate is controlled by the IN_VD_RAMP
   register. Note that the IN_VI_RAMP and IN_VD_RAMP registers should not be changed while a
   volume ramp is in progress.
   The IN_VU bits control the loading of the input signal path digital volume and mute controls. When
   IN_VU is set to 0, the digital volume and mute settings will be loaded into the respective control
   register, but will not actually change the signal path gain. The digital volume and mute settings on all
   of the input signal paths are updated when a 1 is written to IN_VU. This makes it possible to update
   the gain of multiple signal paths simultaneously.
   Note that, although the digital volume control registers provide 0.5dB steps, the internal circuits
   provide signal gain adjustment in 0.125dB steps. This allows a very high degree of gain control, and
   smooth volume ramping under all operating conditions.
   The 0dBFS level of the IN1/IN2 digital input paths is not equal to the 0dBFS level of the WM8998
   digital core. The maximum digital input signal level is -6dBFS (see “Electrical Characteristics”). Under
   0dBFS gain conditions, a -6dBFS input signal corresponds to a 0dBFS input to the WM8998 digital
   core functions.
   The digital volume control register fields are described in Table 4 and Table 5.
      REGISTER         BIT          LABEL          DEFAULT                      DESCRIPTION
      ADDRESS
     R777             6:4    IN_VD_RAMP              010        Input Volume Decreasing Ramp Rate
     (0309h)                 [2:0]                              (seconds/6dB)
     Input                                                      000 = 0ms
     Volume                                                     001 = 0.5ms
     Ramp                                                       010 = 1ms
                                                                011 = 2ms
                                                                100 = 4ms
                                                                101 = 8ms
                                                                110 = 15ms
                                                                111 = 30ms
                                                                This register should not be changed while
                                                                a volume ramp is in progress.
                      2:0    IN_VI_RAMP              010        Input Volume Increasing Ramp Rate
                             [2:0]                              (seconds/6dB)
                                                                000 = 0ms
                                                                001 = 0.5ms
                                                                010 = 1ms
                                                                011 = 2ms
                                                                100 = 4ms
                                                                101 = 8ms
                                                                110 = 15ms
                                                                111 = 30ms
                                                                This register should not be changed while
                                                                a volume ramp is in progress.
     R785              9     IN_VU                              Input Signal Paths Volume and Mute
     (0311h)                                                    Update
     ADC                                                        Writing a 1 to this bit will cause the Input
     Digital                                                    Signal Paths Volume and Mute settings to
     Volume 1L                                                  be updated simultaneously
                       8     IN1L_MUTE                1         Input Path 1 (Left) Digital Mute
                                                                0 = Un-mute
                                                                1 = Mute
50                                                                                                    Rev 4.1


                                                                                  WM8998
          REGISTER      BIT        LABEL          DEFAULT                 DESCRIPTION
          ADDRESS
                       7:0    IN1L_VOL [7:0]       80h    Input Path 1 (Left) Digital Volume
                                                          -64dB to +31.5dB in 0.5dB steps
                                                          00h = -64dB
                                                          01h = -63.5dB
                                                          … (0.5dB steps)
                                                          80h = 0dB
                                                          … (0.5dB steps)
                                                          BFh = +31.5dB
                                                          C0h to FFh = Reserved
                                                          (See Table 5 for volume range)
         R789           9     IN_VU                       Input Signal Paths Volume and Mute
         (0315h)                                          Update
         ADC                                              Writing a 1 to this bit will cause the Input
         Digital                                          Signal Paths Volume and Mute settings to
         Volume                                           be updated simultaneously
         1R             8     IN1R_MUTE             1     Input Path 1 (Right) Digital Mute
                                                          0 = Un-mute
                                                          1 = Mute
                       7:0    IN1R_VOL [7:0]       80h    Input Path 1 (Right) Digital Volume
                                                          -64dB to +31.5dB in 0.5dB steps
                                                          00h = -64dB
                                                          01h = -63.5dB
                                                          … (0.5dB steps)
                                                          80h = 0dB
                                                          … (0.5dB steps)
                                                          BFh = +31.5dB
                                                          C0h to FFh = Reserved
                                                          (See Table 5 for volume range)
         R793           9     IN_VU                       Input Signal Paths Volume and Mute
         (0319h)                                          Update
         ADC                                              Writing a 1 to this bit will cause the Input
         Digital                                          Signal Paths Volume and Mute settings to
         Volume 2L                                        be updated simultaneously
                        8     IN2_MUTE              1     Input Path 2 Digital Mute
                                                          0 = Un-mute
                                                          1 = Mute
                       7:0    IN2_VOL [7:0]        80h    Input Path 2 Digital Volume
                                                          -64dB to +31.5dB in 0.5dB steps
                                                          00h = -64dB
                                                          01h = -63.5dB
                                                          … (0.5dB steps)
                                                          80h = 0dB
                                                          … (0.5dB steps)
                                                          BFh = +31.5dB
                                                          C0h to FFh = Reserved
                                                          (See Table 5 for volume range)
        Table 4 Input Signal Path Digital Volume Control
Rev 4.1                                                                                                51


                                                                         WM8998
    Input Volume  Volume   Input Volume  Volume  Input Volume Volume Input Volume Volume
      Register     (dB)      Register     (dB)     Register    (dB)    Register    (dB)
         00h       -64.0        40h       -32.0       80h       0.0       C0h     Reserved
         01h       -63.5        41h       -31.5       81h       0.5       C1h     Reserved
         02h       -63.0        42h       -31.0       82h       1.0       C2h     Reserved
         03h       -62.5        43h       -30.5       83h       1.5       C3h     Reserved
         04h       -62.0        44h       -30.0       84h       2.0       C4h     Reserved
         05h       -61.5        45h       -29.5       85h       2.5       C5h     Reserved
         06h       -61.0        46h       -29.0       86h       3.0       C6h     Reserved
         07h       -60.5        47h       -28.5       87h       3.5       C7h     Reserved
         08h       -60.0        48h       -28.0       88h       4.0       C8h     Reserved
         09h       -59.5        49h       -27.5       89h       4.5       C9h     Reserved
         0Ah       -59.0        4Ah       -27.0       8Ah       5.0       CAh     Reserved
         0Bh       -58.5        4Bh       -26.5       8Bh       5.5       CBh     Reserved
         0Ch       -58.0        4Ch       -26.0       8Ch       6.0       CCh     Reserved
         0Dh       -57.5        4Dh       -25.5       8Dh       6.5       CDh     Reserved
         0Eh       -57.0        4Eh       -25.0       8Eh       7.0       CEh     Reserved
         0Fh       -56.5        4Fh       -24.5       8Fh       7.5       CFh     Reserved
         10h       -56.0        50h       -24.0       90h       8.0       D0h     Reserved
         11h       -55.5        51h       -23.5       91h       8.5       D1h     Reserved
         12h       -55.0        52h       -23.0       92h       9.0       D2h     Reserved
         13h       -54.5        53h       -22.5       93h       9.5       D3h     Reserved
         14h       -54.0        54h       -22.0       94h      10.0       D4h     Reserved
         15h       -53.5        55h       -21.5       95h      10.5       D5h     Reserved
         16h       -53.0        56h       -21.0       96h      11.0       D6h     Reserved
         17h       -52.5        57h       -20.5       97h      11.5       D7h     Reserved
         18h       -52.0        58h       -20.0       98h      12.0       D8h     Reserved
         19h       -51.5        59h       -19.5       99h      12.5       D9h     Reserved
         1Ah       -51.0        5Ah       -19.0       9Ah      13.0       DAh     Reserved
         1Bh       -50.5        5Bh       -18.5       9Bh      13.5       DBh     Reserved
         1Ch       -50.0        5Ch       -18.0       9Ch      14.0       DCh     Reserved
         1Dh       -49.5        5Dh       -17.5       9Dh      14.5       DDh     Reserved
         1Eh       -49.0        5Eh       -17.0       9Eh      15.0       DEh     Reserved
         1Fh       -48.5        5Fh       -16.5       9Fh      15.5       DFh     Reserved
         20h       -48.0        60h       -16.0       A0h      16.0       E0h     Reserved
         21h       -47.5        61h       -15.5       A1h      16.5       E1h     Reserved
         22h       -47.0        62h       -15.0       A2h      17.0       E2h     Reserved
         23h       -46.5        63h       -14.5       A3h      17.5       E3h     Reserved
         24h       -46.0        64h       -14.0       A4h      18.0       E4h     Reserved
         25h       -45.5        65h       -13.5       A5h      18.5       E5h     Reserved
         26h       -45.0        66h       -13.0       A6h      19.0       E6h     Reserved
         27h       -44.5        67h       -12.5       A7h      19.5       E7h     Reserved
         28h       -44.0        68h       -12.0       A8h      20.0       E8h     Reserved
         29h       -43.5        69h       -11.5       A9h      20.5       E9h     Reserved
         2Ah       -43.0        6Ah       -11.0       AAh      21.0       EAh     Reserved
         2Bh       -42.5        6Bh       -10.5       ABh      21.5       EBh     Reserved
         2Ch       -42.0        6Ch       -10.0       ACh      22.0       ECh     Reserved
         2Dh       -41.5        6Dh        -9.5       ADh      22.5       EDh     Reserved
         2Eh       -41.0        6Eh        -9.0       AEh      23.0       EEh     Reserved
         2Fh       -40.5        6Fh        -8.5       AFh      23.5       EFh     Reserved
         30h       -40.0        70h        -8.0       B0h      24.0       F0h     Reserved
         31h       -39.5        71h        -7.5       B1h      24.5       F1h     Reserved
         32h       -39.0        72h        -7.0       B2h      25.0       F2h     Reserved
         33h       -38.5        73h        -6.5       B3h      25.5       F3h     Reserved
         34h       -38.0        74h        -6.0       B4h      26.0       F4h     Reserved
         35h       -37.5        75h        -5.5       B5h      26.5       F5h     Reserved
         36h       -37.0        76h        -5.0       B6h      27.0       F6h     Reserved
         37h       -36.5        77h        -4.5       B7h      27.5       F7h     Reserved
         38h       -36.0        78h        -4.0       B8h      28.0       F8h     Reserved
         39h       -35.5        79h        -3.5       B9h      28.5       F9h     Reserved
         3Ah       -35.0        7Ah        -3.0       BAh      29.0       FAh     Reserved
         3Bh       -34.5        7Bh        -2.5       BBh      29.5       FBh     Reserved
         3Ch       -34.0        7Ch        -2.0       BCh      30.0       FCh     Reserved
         3Dh       -33.5        7Dh        -1.5       BDh      30.5       FDh     Reserved
         3Eh       -33.0        7Eh        -1.0       BEh      31.0       FEh     Reserved
         00.       -32.5        7Fh        -0.5       BFh      31.5       FFh     Reserved
   Table 5 Input Signal Path Digital Volume Range
52                                                                                 Rev 4.1


                                                                                        WM8998
        DIGITAL MICROPHONE INTERFACE PULL-DOWN
        The WM8998 provides integrated pull-down resistors on the DMICDAT1 and DMICDAT2 pins. This
        provides a flexible capability for interfacing with other devices.
        Each of the pull-down resistors can be configured independently using the register bits described in
        Table 6. Note that, if the DMICDAT1 or DMICDAT2 digital microphone input paths are disabled, then
        the pull-down will be disabled on the respective pin.
          REGISTER        BIT            LABEL            DEFAULT                  DESCRIPTION
          ADDRESS
          R3106            1     DMICDAT2_PD                 0        DMICDAT2 Pull-Down Control
          (0C22h)                                                     0 = Disabled
          Misc Pad                                                    1 = Enabled
          Ctrl 3           0     DMICDAT1_PD                 0        DMICDAT1 Pull-Down Control
                                                                      0 = Disabled
                                                                      1 = Enabled
        Table 6 Digital Microphone Interface Pull-Down Control
Rev 4.1                                                                                                  53


                                                                                                WM8998
DIGITAL CORE
             The WM8998 digital core provides extensive mixing and processing capabilities for multiple signal
             paths. The configuration is highly flexible, and virtually every conceivable input/output connection can
             be supported between the available processing blocks.
             The digital core provides parametric equalisation (EQ) functions, dynamic range control (DRC), and
             low-pass / high-pass filters (LHPF).
             The WM8998 supports multiple signal paths through the digital core. Stereo full-duplex sample rate
             conversion is provided to allow digital audio to be routed between input (ADC) paths, output (DAC)
             paths, Digital Audio Interfaces (AIF1, AIF2 and AIF3) and SLIMbus paths operating at different
             sample rates and/or referenced to asynchronous clock domains.
             The digital core incorporates a S/PDIF transmitter, which can provide a stereo S/PDIF output on a
             GPIO pin. Standard S/PDIF sample rates of 32kHz up to 192kHz can be supported.
             The WM8998 incorporates two 1kHz tone generators which can be used for ‘beep’ functions through
             any of the audio signal paths.
             A haptic signal generator is provided, for use with external haptic devices (eg. mechanical vibration
             actuators). Two Pulse Width Modulation (PWM) signal generators are also provided; the PWM
             waveforms can be modulated by an audio source within the digital core, and can be output on a GPIO
             pin.
             An overview of the digital core processing and mixing functions is provided in Figure 19. An overview
             of the external digital interface paths is provided in Figure 20.
             The control registers associated with the digital core signal paths are shown in Figure 21 through to
             Figure 36. The full list of digital mixer control registers is provided in the “Register Map” section
             (Register R1600 through to R2920). Generic register definitions are provided in Table 7.
54                                                                                                         Rev 4.1


                                                                Silence (mute) (00h)
Rev 4.1
                                                                AEC1 Loopback (08h)                                                                         ISRC2 INT1 (A8h)                                            ISRC1 INT1 (A0h)
                                                                AEC2 Loopback (09h)
                                                                                                                                          Isochronous
                                                                                                                                                            ISRC2 INT2 (A9h)                                            ISRC1 INT2 (A1h)
                                                                                                                                         Sample Rate
                                                                                                                                        Converter (ISRC)
                                                                                                                    ISRC2 DEC1 (ACh)                                                                                    ISRC1 INT3 (A2h)
                                                                                                                                                                                                     Isochronous
                                                                IN1L signal path (10h)                              ISRC2 DEC2 (ADh)                                                                                    ISRC1 INT4 (A3h)
                                                                                                                                                                                                    Sample Rate
                                                                                                                                                                                                   Converter (ISRC)
                                                                IN1R signal path (11h)                                                                                          ISRC1 DEC1 (A4h)
                                                                IN2 signal path (12h)                                                                                           ISRC1 DEC2 (A5h)
                                                                                                                                                                                ISRC1 DEC3 (A6h)
                                                                                                                                                            ASRC1 Left (90h)    ISRC1 DEC4 (A7h)
                                                                                                                                         Asynchronous
                                                                                                                                                            ASRC1 Right (91h)
                                                                                                                                          Sample Rate
                                                                                                                                        Converter (ASRC)
                                                                                                                     ASRC2 Left (92h)
                                                                                         S/PDIF
                                                                                                   (To GPIO pin)
                                                                                                                    ASRC2 Right (93h)
          Figure 19 Digital Core - Internal Signal Processing
                                                                                                                                               EQ
                                                                                   +        LHPF                                                           EQ1 (50h)                                       Tone Generator 1 (04h)
                                                                                                      LHPF1 (60h)                                                                       Tone Generator
                                                                                                                                                                                                           Tone Generator 2 (05h)
                                                                                                                                               EQ
                                                                                                                                                           EQ2 (51h)
                                                                                   +        LHPF
                                                                                                      LHPF2 (61h)
                                                                                                                                                                                          Haptic Signal
                                                                                                                                               EQ                                          Generator       Haptic Output (06h)
                                                                                                                                                           EQ3 (52h)
                                                                                   +        LHPF                                               EQ
                                                                                                      LHPF3 (62h)                                          EQ4 (53h)
                                                                                                                                                                                                   +      PWM
                                                                                                                                                                                                                        (To GPIO pin)
                                                                                   +        LHPF
                                                                                                      LHPF4 (63h)                              DRC
                                                                                                                                                           DRC1 Left (58h)
                                                                                                                                                                                                   +      PWM
                                                                                                                                                                                                                        (To GPIO pin)
                                                                                                                                               DRC
                                                                                                                                                           DRC1 Right (59h)
                                                                                                                                                                                                                                           WM8998
55


56
                                                                        AIF1 RX6 (25h)          AIF2 RX6 (2Dh)                           AIF3 RX2 (31h)
                                                                        AIF1 RX5 (24h)          AIF2 RX5 (2Ch)                           AIF3 RX1 (30h)      +
                                                                                                                                                                 OUT1L output
                                                                        AIF1 RX4 (23h)          AIF2 RX4 (2Bh)
                                                                        AIF1 RX3 (22h)          AIF2 RX3 (2Ah)              +
                                                                                                                                      AIF3 TX2 output
                                                                        AIF1 RX2 (21h)          AIF2 RX2 (29h)                                               +
                                                                                                                                                                 OUT1R output
                                                                        AIF1 RX1 (20h)          AIF2 RX1 (28h)
                                                                                                                            +
                                                                                                                                      AIF3 TX1 output
                                                                 +                       +
                                                                     AIF1 TX6 output         AIF2 TX6 output                                                 +
                                                                                                                                                                 OUT2L output
                                                                 +                       +
                                                                     AIF1 TX5 output         AIF2 TX5 output                                                 +
          Figure 20 Digital Core - External Digital Interfaces
                                                                                                                                         SLIMbus RX4 (3Bh)       OUT2R output
                                                                                                                                         SLIMbus RX3 (3Ah)
                                                                                                                                         SLIMbus RX2 (39h)
                                                                 +                       +
                                                                     AIF1 TX4 output         AIF2 TX4 output                             SLIMbus RX1 (38h)   +
                                                                                                                                                                 OUT3 output
                                                                                                                 SLIMbus TX6 output
                                                                 +                       +
                                                                     AIF1 TX3 output         AIF2 TX3 output                                                 +
                                                                                                                                                                 OUT4L output
                                                                                                                 SLIMbus TX5 output
                                                                                                                 SLIMbus TX4 output
                                                                 +                       +
                                                                     AIF1 TX2 output         AIF2 TX2 output                                                 +
                                                                                                                 SLIMbus TX3 output                              OUT4R output
                                                                                                                 SLIMbus TX2 output
                                                                 +                       +                       SLIMbus TX1 output
                                                                     AIF1 TX1 output         AIF2 TX1 output                                                 +
                                                                                                                                                                 OUT5L output
                                                                                                                                                             +
                                                                                                                                                                 OUT5R output
Rev 4.1
                                                                                                                                                                                WM8998


                                                                                              WM8998
        DIGITAL CORE MIXERS
        The WM8998 provides an extensive digital mixing capability. The digital core signal processing blocks
        and audio interface paths are illustrated in Figure 19 and Figure 20.
        A 4-input digital mixer is associated with many of these functions, as illustrated. The digital mixer
        circuit is identical in each instance, providing up to 4 selectable input sources, with independent
        volume control on each input.
        The control registers associated with the digital core signal paths are shown in Figure 21 through to
        Figure 36. The full list of digital mixer control registers is provided in the “Register Map” section
        (Register R1600 through to R2920).
        Further description of the associated control registers is provided below. Generic register definitions
        are provided in Table 7.
        The digital mixer input sources are selected using the associated *_SRCn registers; the volume
        control is implemented via the associated *_VOLn registers.
        The ASRC, ISRC, SLIMbus, EQ and DRC functions support selectable input sources, but do not
        incorporate any digital mixing. The respective input source (*_SRCn) registers are identical to those of
        the digital mixers.
        The *_SRCn registers select the input source(s) for the respective mixer or signal processing block.
        Note that the selected input source(s) must be configured for the same sample rate as the block(s) to
        which they are connected. Sample rate conversion functions are available to support flexible
        interconnectivity - see “Asynchronous Sample Rate Converter (ASRC)” and “Isochronous Sample
        Rate Converter (ISRC)”.
        A status bit associated with each of the configurable input sources provides readback for the
        respective signal path. If an Underclocked Error condition occurs, then these bits provide readback of
        which signal path(s) have been successfully enabled.
        The generic register definition for the digital mixers is provided in Table 7.
            REGISTER         BIT          LABEL           DEFAULT                      DESCRIPTION
            ADDRESS
          R1600             15    *_STSn                      0         [Digital Core function] input n status
          (0640h)                                                       0 = Disabled
                                  Valid for every                       1 = Enabled
          to                      digital core
                                  function input
          R2920                   (digital mixers,
          (0B68h)                 SLIMbus TX,
                                  ASRC, ISRC,
                                  SLIMbus, EQ and
                                  DRC inputs).
                            7:1   *_VOLn                     40h        [Digital Core mixer] input n volume
                                                                        -32dB to +16dB in 1dB steps
                                  Valid for every                       00h to 20h = -32dB
                                  digital mixer,                        21h = -31dB
                                  SLIMbus TX, EQ                        22h = -30dB
                                  and DRC input.                        ... (1dB steps)
                                                                        40h = 0dB
                                                                        ... (1dB steps)
                                                                        50h = +16dB
                                                                        51h to 7Fh = +16dB
                            8:0   *_SRCn                     00h        [Digital Core function] input n source
                                                                        select
                                  Valid for every                       00h = Silence (mute)
                                  digital core                          04h = Tone generator 1
                                  function input                        05h = Tone generator 2
                                  (digital mixers,                      06h = Haptic generator
                                  SLIMbus TX,                           08h = AEC1 loopback
                                  ASRC, ISRC, EQ                        09h = AEC2 loopback
Rev 4.1                                                                                                        57


                                                                          WM8998
     REGISTER       BIT        LABEL          DEFAULT              DESCRIPTION
     ADDRESS
                          and DRC inputs).            10h = IN1L signal path
                                                      11h = IN1R signal path
                                                      12h = IN2 signal path
                                                      20h = AIF1 RX1
                                                      21h = AIF1 RX2
                                                      22h = AIF1 RX3
                                                      23h = AIF1 RX4
                                                      24h = AIF1 RX5
                                                      25h = AIF1 RX6
                                                      28h = AIF2 RX1
                                                      29h = AIF2 RX2
                                                      2Ah = AIF2 RX3
                                                      2Bh = AIF2 RX4
                                                      2Ch = AIF2 RX5
                                                      2Dh = AIF2 RX6
                                                      30h = AIF3 RX1
                                                      31h = AIF3 RX2
                                                      38h = SLIMbus RX1
                                                      39h = SLIMbus RX2
                                                      3Ah = SLIMbus RX3
                                                      3Bh = SLIMbus RX4
                                                      50h = EQ1
                                                      51h = EQ2
                                                      52h = EQ3
                                                      53h = EQ4
                                                      58h = DRC1 Left
                                                      59h = DRC1 Right
                                                      60h = LHPF1
                                                      61h = LHPF2
                                                      62h = LHPF3
                                                      63h = LHPF4
                                                      90h = ASRC1 Left
                                                      91h = ASRC1 Right
                                                      92h = ASRC2 Left
                                                      93h = ASRC2 Right
                                                      A0h = ISRC1 INT1
                                                      A1h = ISRC1 INT2
                                                      A2h = ISRC1 INT3
                                                      A3h = ISRC1 INT4
                                                      A4h = ISRC1 DEC1
                                                      A5h = ISRC1 DEC2
                                                      A6h = ISRC1 DEC3
                                                      A7h = ISRC1 DEC4
                                                      A8h = ISRC2 INT1
                                                      A9h = ISRC2 INT2
                                                      ACh = ISRC2 DEC1
                                                      ADh = ISRC2 DEC2
   Table 7 Digital Core Mixer Control Registers
58                                                                             Rev 4.1


                                                                                         WM8998
        DIGITAL CORE INPUTS
        The digital core comprises multiple input paths as illustrated in Figure 21. Any of these inputs may be
        selected as a source to the digital mixers or signal processing functions within the WM8998 digital
        core.
        Note that the outputs from other blocks within the Digital Core may also be selected as input to the
        digital mixers or signal processing functions within the WM8998 digital core. Those input sources,
        which are not shown in Figure 21, are described separately in other sections of the “Digital Core”
        description.
        The bracketed numbers in Figure 21, eg. “(10h)” indicate the corresponding *_SRCn register setting
        for selection of that signal as an input to another digital core function.
        The sample rate for the input signal paths is configured using the applicable IN_RATE, AIFn_RATE or
        SLIMRXn_RATE register - see Table 19. Note that sample rate conversion is required when routing
        the input signal paths to any signal chain that is asynchronous and/or configured for a different
        sample rate.
                 Silence (mute) (00h)
                 AEC1 Loopback (08h)
                 AEC2 Loopback (09h)
                 IN1L signal path (10h)
                 IN1R signal path (11h)
                 IN2 signal path (12h)
                 AIF1 RX1 (20h)
                 AIF1 RX2 (21h)
                 AIF1 RX3 (22h)
                 AIF1 RX4 (23h)
                 AIF1 RX5 (24h)
                 AIF1 RX6 (25h)
                 AIF2 RX1 (28h)
                 AIF2 RX2 (29h)
                 AIF2 RX3 (2Ah)
                 AIF2 RX4 (2Bh)
                 AIF2 RX5 (2Ch)
                 AIF2 RX6 (2Dh)
                 AIF3 RX1 (30h)
                 AIF3 RX2 (31h)
                 SLIMbus RX1 (38h)
                 SLIMbus RX2 (39h)
                 SLIMbus RX3 (3Ah)
                 SLIMbus RX4 (3Bh)
        Figure 21 Digital Core Inputs
Rev 4.1                                                                                                     59


                                                                                        WM8998
   DIGITAL CORE OUTPUTS
   The digital core comprises multiple output paths. The output paths associated with AIF1, AIF2 and
   AIF3 are illustrated in Figure 22. The output paths associated with OUT1, OUT2, OUT3, OUT4 and
   OUT5 are illustrated in Figure 23. The output paths associated with the SLIMbus interface are
   illustrated in Figure 24.
   A 4-input mixer is associated with each of the AIFn or OUTn signal paths. The 4 input sources are
   selectable in each case, and independent volume control is provided for each path. Note that there
   are no mixers associated with the SLIMbus output paths.
   The AIF1, AIF2 and AIF3 output mixer control registers (see Figure 22) are located at register
   addresses R1792 (700h) through to R1935 (78Fh). The OUT1, OUT2, OUT3, OUT4 and OUT5 output
   mixer control registers (see Figure 23) are located at addresses R1664 (680h) through to R1743
   (06CFh). The SLIMbus output control registers (see Figure 24) are located at addresses R1984
   (7C0h) through to R2025 (7E9h).
   The full list of digital mixer control registers is provided in the “Register Map” section (Register R1600
   through to R2920). Generic register definitions are provided in Table 7.
   The *_SRCn registers select the input source(s) for the respective signal paths. Note that the selected
   input source(s) must be configured for the same sample rate as the mixer to which they are
   connected. Sample rate conversion functions are available to support flexible interconnectivity - see
   “Asynchronous Sample Rate Converter (ASRC)” and “Isochronous Sample Rate Converter (ISRC)”.
   The sample rate for the output signal paths is configured using the applicable OUT_RATE,
   AIFn_RATE or SLIMTXn_RATE register - see Table 19. Note that sample rate conversion is required
   when routing the output signal paths to any signal chain that is asynchronous and/or configured for a
   different sample rate.
   The WM8998 performs automatic checks to confirm that the SYSCLK frequency is high enough to
   support the output mixer paths. If an attempt is made to enable an output mixer path, and there are
   insufficient SYSCLK cycles to support it, then the attempt will be unsuccessful. (Note that any signal
   paths that are already active will not be affected under these circumstances.)
   The Underclocked Error condition can be monitored using the GPIO and/or Interrupt functions. See
   “General Purpose Input / Output” and “Interrupts” for further details.
   The status bits in Registers R1600 to R2920 indicate the status of each of the digital mixers. If an
   Underclocked Error condition occurs, then these bits provide readback of which mixer(s) have been
   successfully enabled.
60                                                                                                  Rev 4.1


                                                                                       WM8998
                 AIF1TXnMIX_SRC1
                                    AIF1TXnMIX_VOL1
                 AIF1TXnMIX_SRC2
                                    AIF1TXnMIX_VOL2
                                                        +
                                                                            AIF1 TXn
                 AIF1TXnMIX_SRC3
                                    AIF1TXnMIX_VOL3
                 AIF1TXnMIX_SRC4
                                    AIF1TXnMIX_VOL4
                           WM8998 supports 6 AIF1 Output mixers, ie. n = 1, 2, 3, 4, 5 or 6
                 AIF2TXnMIX_SRC1
                                    AIF2TXnMIX_VOL1
                 AIF2TXnMIX_SRC2
                                    AIF2TXnMIX_VOL2
                                                        +
                                                                            AIF2 TXn
                 AIF2TXnMIX_SRC3
                                    AIF2TXnMIX_VOL3
                 AIF2TXnMIX_SRC4
                                    AIF2TXnMIX_VOL4
                           WM8998 supports 6 AIF2 Output mixers, ie. n = 1, 2, 3, 4, 5 or 6
                 AIF3TXnMIX_SRC1
                                    AIF3TXnMIX_VOL1
                 AIF3TXnMIX_SRC2
                                    AIF3TXnMIX_VOL2
                                                        +
                                                                            AIF3 TXn
                 AIF3TXnMIX_SRC3
                                    AIF3TXnMIX_VOL3
                 AIF3TXnMIX_SRC4
                                    AIF3TXnMIX_VOL4
                                   WM8998 supports 2 AIF3 Output mixers, ie. n = 1 or 2
        Figure 22 Digital Core AIF Outputs
Rev 4.1                                                                                     61


                                                                                   WM8998
             OUTnLMIX_SRC1
                               OUTnLMIX_VOL1
             OUTnLMIX_SRC2
                               OUTnLMIX_VOL2
                                                   +
                                                                       OUTn Left
             OUTnLMIX_SRC3
                               OUTnLMIX_VOL3
             OUTnLMIX_SRC4
                               OUTnLMIX_VOL4
            OUTnRMIX_SRC1
                               OUTnRMIX_VOL1
            OUTnRMIX_SRC2
                               OUTnRMIX_VOL2
                                                   +
                                                                       OUTn Right
            OUTnRMIX_SRC3
                               OUTnRMIX_VOL3
            OUTnRMIX_SRC4
                               OUTnRMIX_VOL4
                    WM8998 supports 4 Stereo Output mixer pairs, ie. n = 1, 2, 4 or 5
              OUT3MIX_SRC1
                                OUT3MIX_VOL1
              OUT3MIX_SRC2
                                OUT3MIX_VOL2
                                                   +
                                                                       OUT3
              OUT3MIX_SRC3
                                OUT3MIX_VOL3
              OUT3MIX_SRC4
                                OUT3MIX_VOL4
                                WM8998 supports 1 Mono Output mixer, ie. OUT3
   Figure 23 Digital Core OUTn Outputs
62                                                                                    Rev 4.1


                                                                                              WM8998
                  SLIMTXnMIX_SRC                                                  SLIMbus TXn
                                         SLIMTXnMIX_VOL
                     WM8998 supports 6 SLIMbus Output (TX) paths, ie. n = 1, 2, 3, 4, 5 or 6
        Figure 24 Digital Core SLIMbus Outputs
        5-BAND PARAMETRIC EQUALISER (EQ)
        The digital core provides four EQ processing blocks as illustrated in Figure 25. The input source for
        each EQ is selectable, and a digital volume control is provided for each path. Each EQ block supports
        1 input and 1 output.
        The EQ provides selective control of 5 frequency bands as described below.
        The low frequency band (Band 1) filter can be configured either as a peak filter or a shelving filter.
        When configured as a shelving filter, is provides adjustable gain below the Band 1 cut-off frequency.
        As a peak filter, it provides adjustable gain within a defined frequency band that is centred on the
        Band 1 frequency.
        The mid frequency bands (Band 2, Band 3, Band 4) filters are peak filters, which provide adjustable
        gain around the respective centre frequency.
        The high frequency band (Band 5) filter is a shelving filter, which provides adjustable gain above the
        Band 5 cut-off frequency.
                                                              EQ
                     EQnMIX_SRC                                                       EQ1 (50h)
                                         EQnMIX_VOL
                                                                                      EQ2 (51h)
                                                                5-band Equaliser      EQ3 (52h)
                                                                                      EQ4 (53h)
                                                 WM8998 supports 4 EQ blocks, ie. n = 1, 2, 3 or 4
        Figure 25 Digital Core EQ Blocks
Rev 4.1                                                                                                    63


                                                                                         WM8998
   The EQ1, EQ2, EQ3 and EQ4 input control registers (see Figure 25) are located at register addresses
   R2176 (880h) through to R2201 (899h).
   The full list of digital mixer control registers is provided in the “Register Map” section (Register R1600
   through to R2920). Generic register definitions are provided in Table 7.
   The *_SRCn registers select the input source for the respective EQ processing blocks. Note that the
   selected input source(s) must be configured for the same sample rate as the EQ to which they are
   connected. Sample rate conversion functions are available to support flexible interconnectivity - see
   “Asynchronous Sample Rate Converter (ASRC)” and “Isochronous Sample Rate Converter (ISRC)”.
   The bracketed numbers in Figure 25, eg. “(50h)” indicate the corresponding *_SRCn register setting
   for selection of that signal as an input to another digital core function.
   The sample rate for the EQ function is configured using the FX_RATE register - see Table 19. Note
   that the EQ, DRC and LHPF functions must all be configured for the same sample rate. Sample rate
   conversion is required when routing the EQ signal paths to any signal chain that is asynchronous
   and/or configured for a different sample rate.
   The control registers associated with the EQ functions are described in Table 9.
   The cut-off or centre frequencies for the 5-band EQ are set using the coefficients held in the registers
   identified in Table 8. These coefficients are derived using tools provided in Cirrus’s WISCE™
   evaluation board control software; please contact your local Cirrus representative for more details.
             EQ                       REGISTER ADDRESSES
     EQ1                     R3602 (0E10h) to R3620 (0E24h)
     EQ2                     R3624 (0E28h) to R3642 (0E3Ah)
     EQ3                     R3646 (0E3Eh) to R3664 (0E53h)
     EQ4                     R3668 (0E54h) to R3686 (0E66h)
   Table 8 EQ Coefficient Registers
     REGISTER           BIT          LABEL            DEFAULT                     DESCRIPTION
     ADDRESS
     R3585            15:4     FX_STS [11:0]            000h       LHPF, DRC, EQ Enable Status
     (0E01h)                                                       Indicates the status of each of the
     FX_Ctrl2                                                      respective signal processing functions.
                                                                   [11] = EQ4
                                                                   [10] = EQ3
                                                                   [9] = EQ2
                                                                   [8] = EQ1
                                                                   [7] = Reserved
                                                                   [6] = Reserved
                                                                   [5] = DRC1 (Right)
                                                                   [4] = DRC1 (Left)
                                                                   [3] = LHPF4
                                                                   [2] = LHPF3
                                                                   [1] = LHPF2
                                                                   [0] = LHPF1
                                                                   Each bit is coded as:
                                                                   0 = Disabled
                                                                   1 = Enabled
     R3600           15:11     EQ1_B1_GAIN             01100       EQ1 Band 1 Gain
     (0E10h)                   [4:0]                               -12dB to +12dB in 1dB steps
     EQ1_1                                                         (see Table 10 for gain range)
                      10:6     EQ1_B2_GAIN             01100       EQ1 Band 2 Gain
                               [4:0]                               -12dB to +12dB in 1dB steps
                                                                   (see Table 10 for gain range)
                       5:1     EQ1_B3_GAIN             01100       EQ1 Band 3 Gain
                               [4:0]                               -12dB to +12dB in 1dB steps
                                                                   (see Table 10 for gain range)
64                                                                                                     Rev 4.1


                                                                  WM8998
        REGISTER   BIT       LABEL DEFAULT                 DESCRIPTION
        ADDRESS
                   0   EQ1_ENA        0    EQ1 Enable
                                           0 = Disabled
                                           1 = Enabled
        R3601    15:11 EQ1_B4_GAIN  01100  EQ1 Band 4 Gain
        (0E11h)        [4:0]               -12dB to +12dB in 1dB steps
        EQ1_2                              (see Table 10 for gain range)
                 10:6  EQ1_B5_GAIN  01100  EQ1 Band 5 Gain
                       [4:0]               -12dB to +12dB in 1dB steps
                                           (see Table 10 for gain range)
                   0   EQ1_B1_MODE    0    EQ1 Band 1 Mode
                                           0 = Shelving filter
                                           1 = Peak filter
        R3602    15:0  EQ1_B1_*            EQ1 Frequency Coefficients
        (0E12h)        EQ1_B2_*            Refer to WISCE evaluation board control
        to             EQ1_B3_*            software for the deriviation of these field
        R3620          EQ1_B4_*            values.
        (E24h)         EQ1_B5_*
        R3622    15:11 EQ2_B1_GAIN  01100  EQ2 Band 1 Gain
        (0E26h)        [4:0]               -12dB to +12dB in 1dB steps
        EQ2_1                              (see Table 10 for gain range)
                 10:6  EQ2_B2_GAIN  01100  EQ2 Band 2 Gain
                       [4:0]               -12dB to +12dB in 1dB steps
                                           (see Table 10 for gain range)
                  5:1  EQ2_B3_GAIN  01100  EQ2 Band 3 Gain
                       [4:0]               -12dB to +12dB in 1dB steps
                                           (see Table 10 for gain range)
                   0   EQ2_ENA        0    EQ2 Enable
                                           0 = Disabled
                                           1 = Enabled
        R3623    15:11 EQ2_B4_GAIN  01100  EQ2 Band 4 Gain
        (0E27h)        [4:0]               -12dB to +12dB in 1dB steps
        EQ2_2                              (see Table 10 for gain range)
                 10:6  EQ2_B5_GAIN  01100  EQ2 Band 5 Gain
                       [4:0]               -12dB to +12dB in 1dB steps
                                           (see Table 10 for gain range)
                   0   EQ2_B1_MODE    0    EQ2 Band 1 Mode
                                           0 = Shelving filter
                                           1 = Peak filter
        R3624    15:0  EQ2_B1_*            EQ2 Frequency Coefficients
        (0E28h)        EQ2_B2_*            Refer to WISCE evaluation board control
        to             EQ2_B3_*            software for the deriviation of these field
        R3642          EQ2_B4_*            values.
        (E3Ah)         EQ2_B5_*
        R3644    15:11 EQ3_B1_GAIN  01100  EQ3 Band 1 Gain
        (0E3Ch)        [4:0]               -12dB to +12dB in 1dB steps
        EQ3_1                              (see Table 10 for gain range)
                 10:6  EQ3_B2_GAIN  01100  EQ3 Band 2 Gain
                       [4:0]               -12dB to +12dB in 1dB steps
                                           (see Table 10 for gain range)
                  5:1  EQ3_B3_GAIN  01100  EQ3 Band 3 Gain
                       [4:0]               -12dB to +12dB in 1dB steps
                                           (see Table 10 for gain range)
                   0   EQ3_ENA        0    EQ3 Enable
                                           0 = Disabled
                                           1 = Enabled
Rev 4.1                                                                                65


                                                                     WM8998
    REGISTER      BIT        LABEL    DEFAULT                 DESCRIPTION
    ADDRESS
    R3645       15:11  EQ3_B4_GAIN     01100  EQ3 Band 4 Gain
    (0E3Dh)            [4:0]                  -12dB to +12dB in 1dB steps
    EQ3_2                                     (see Table 10 for gain range)
                10:6   EQ3_B5_GAIN     01100  EQ3 Band 5 Gain
                       [4:0]                  -12dB to +12dB in 1dB steps
                                              (see Table 10 for gain range)
                  0    EQ3_B1_MODE       0    EQ3 Band 1 Mode
                                              0 = Shelving filter
                                              1 = Peak filter
    R3646       15:0   EQ3_B1_*               EQ3 Frequency Coefficients
    (0E3Eh)            EQ3_B2_*               Refer to WISCE evaluation board control
    to                 EQ3_B3_*               software for the deriviation of these field
    R3664              EQ3_B4_*               values.
    (E50h)             EQ3_B5_*
    R3666       15:11  EQ4_B1_GAIN     01100  EQ4 Band 1 Gain
    (0E52h)            [4:0]                  -12dB to +12dB in 1dB steps
    EQ4_1                                     (see Table 10 for gain range)
                10:6   EQ4_B2_GAIN     01100  EQ4 Band 2 Gain
                       [4:0]                  -12dB to +12dB in 1dB steps
                                              (see Table 10 for gain range)
                 5:1   EQ4_B3_GAIN     01100  EQ4 Band 3 Gain
                       [4:0]                  -12dB to +12dB in 1dB steps
                                              (see Table 10 for gain range)
                  0    EQ4_ENA           0    EQ4 Enable
                                              0 = Disabled
                                              1 = Enabled
    R3667       15:11  EQ4_B4_GAIN     01100  EQ4 Band 4 Gain
    (0E53h)            [4:0]                  -12dB to +12dB in 1dB steps
    EQ4_2                                     (see Table 10 for gain range)
                10:6   EQ4_B5_GAIN     01100  EQ4 Band 5 Gain
                       [4:0]                  -12dB to +12dB in 1dB steps
                                              (see Table 10 for gain range)
                  0    EQ4_B1_MODE       0    EQ4 Band 1 Mode
                                              0 = Shelving filter
                                              1 = Peak filter
    R3668       15:0   EQ4_B1_*               EQ4 Frequency Coefficients
    (0E54h)            EQ4_B2_*               Refer to WISCE evaluation board control
    to                 EQ4_B3_*               software for the deriviation of these field
    R3686              EQ4_B4_*               values.
    (E66h)             EQ4_B5_*
   Table 9 EQ Enable and Gain Control
66                                                                                Rev 4.1


                                                                                          WM8998
                   EQ GAIN SETTING                        GAIN (dB)
                         00000                              -12
                         00001                              -11
                         00010                              -10
                         00011                               -9
                         00100                               -8
                         00101                               -7
                         00110                               -6
                         00111                               -5
                         01000                               -4
                         01001                               -3
                         01010                               -2
                         01011                               -1
                         01100                                0
                         01101                               +1
                         01110                               +2
                         01111                               +3
                         10000                               +4
                         10001                               +5
                         10010                               +6
                         10011                               +7
                         10100                               +8
                         10101                               +9
                         10110                              +10
                         10111                              +11
                         11000                              +12
                    11001 to 11111                       Reserved
        Table 10 EQ Gain Control Range
        The WM8998 performs automatic checks to confirm that the SYSCLK frequency is high enough to
        support the commanded EQ and digital mixing functions. If an attempt is made to enable an EQ signal
        path, and there are insufficient SYSCLK cycles to support it, then the attempt will be unsuccessful.
        (Note that any signal paths that are already active will not be affected under these circumstances.)
        The Underclocked Error can be monitored using the GPIO and/or Interrupt functions. See “General
        Purpose Input / Output” and “Interrupts” for further details.
        The FX_STS field in Register R3585 indicates the status of each of the EQ, DRC and LHPF signal
        paths. If an Underclocked Error condition occurs, then this register provides readback of which EQ,
        DRC or LHPF signal path(s) have been successfully enabled.
        The status bits in Registers R1600 to R2920 indicate the status of each of the digital mixers. If an
        Underclocked Error condition occurs, then these bits provide readback of which mixer(s) have been
        successfully enabled.
        DYNAMIC RANGE CONTROL (DRC)
        The digital core provides a stereo Dynamic Range Control (DRC) processing block as illustrated in
        Figure 26. The input sources to the DRC are selectable for each channel (ie. Left and Right), and
        independent volume control is provided for each path.
        The function of the DRC is to adjust the signal gain in conditions where the input amplitude is
        unknown or varies over a wide range, e.g. when recording from microphones built into a handheld
        system, or to restrict the dynamic range of an output signal path.
        The DRC can apply Compression and Automatic Level Control to the signal path. It incorporates ‘anti-
        clip’ and ‘quick release’ features for handling transients in order to improve intelligibility in the
        presence of loud impulsive noises.
Rev 4.1                                                                                                      67


                                                                                        WM8998
   The DRC also incorporates a Noise Gate function, which provides additional attenuation of very low-
   level input signals. This means that the signal path is quiet when no signal is present, giving an
   improvement in background noise level under these conditions.
   A Signal Detect function is provided within the DRC; this can be used to detect the presence of an
   audio signal, and used to trigger other events. The Signal Detect function can be used as an Interrupt
   event, or as a GPIO output, or used to trigger the Control Write Sequencer.
                                                                     DRC
                DRC1LMIX_SRC
                                         DRC1LMIX_VOL                                      DRC1 Left (58h)
                                                          Dynamic Range Controller
                                                                     DRC
               DRC1RMIX_SRC
                                        DRC1RMIX_VOL                                       DRC1 Right (59h)
                                                          Dynamic Range Controller
   Figure 26 Dynamic Range Control (DRC) Block
   The DRC1 input control registers (see Figure 26) are located at register addresses R2240 (8C0h)
   through to R2249 (08C9h).
   The full list of digital mixer control registers is provided in the “Register Map” section (Register R1600
   through to R2920). Generic register definitions are provided in Table 7.
   The *_SRCn registers select the input source for the respective DRC processing blocks. Note that the
   selected input source(s) must be configured for the same sample rate as the DRC to which they are
   connected. Sample rate conversion functions are available to support flexible interconnectivity - see
   “Asynchronous Sample Rate Converter (ASRC)” and “Isochronous Sample Rate Converter (ISRC)”.
   The bracketed numbers in Figure 26, eg. “(58h)” indicate the corresponding *_SRCn register setting
   for selection of that signal as an input to another digital core function.
   The sample rate for the DRC function is configured using the FX_RATE register - see Table 19. Note
   that the EQ, DRC and LHPF functions must all be configured for the same sample rate. Sample rate
   conversion is required when routing the DRC signal paths to any signal chain that is asynchronous
   and/or configured for a different sample rate.
   The DRC functions are enabled using the control registers described in Table 11.
        REGISTER             BIT           LABEL            DEFAULT                 DESCRIPTION
        ADDRESS
     R3712                   1      DRC1L_ENA                  0         DRC1 (Left) Enable
     (0E80h)                                                             0 = Disabled
     DRC1 ctrl1                                                          1 = Enabled
                             0      DRC1R_ENA                  0         DRC1 (Right) Enable
                                                                         0 = Disabled
                                                                         1 = Enabled
   Table 11 DRC Enable
68                                                                                                  Rev 4.1


                                                                                                    WM8998
          DRC Compression / Expansion / Limiting
          The DRC supports two different compression regions, separated by a “Knee” at a specific input
          amplitude. In the region above the knee, the compression slope DRC1_HI_COMP applies; in the
          region below the knee, the compression slope DRC1_LO_COMP applies.
          The DRC also supports a noise gate region, where low-level input signals are heavily attenuated. This
          function can be enabled or disabled according to the application requirements. The DRC response in
          this region is defined by the expansion slope DRC1_NG_EXP.
          For additional attenuation of signals in the noise gate region, an additional “knee” can be defined
          (shown as “Knee2” in Figure 27). When this knee is enabled, this introduces an infinitely steep drop-
          off in the DRC response pattern between the DRC1_LO_COMP and DRC1_NG_EXP regions.
          The overall DRC compression characteristic in “steady state” (i.e. where the input amplitude is near-
          constant) is illustrated in Figure 27.
            DRC1 Output Amplitude (dB)
                          (Y0)
                                                                      Knee1              MP
                                                                                     _ CO
             DRC1_KNEE_OP                                                      1 _ HI
                                                                            DRC
                                                                        P
                                                                     OM
                                                                _C
                                                              LO
                                                        C   1_
                                                   DR
                                      Knee2
           DRC1_KNEE2_OP
                                          G_
                                             EX
                                               P
                                         _N
                                     C1
                                    DR
                                   DRC1_KNEE2_IP               DRC1_KNEE_IP               0dB
                                                                                DRC1 Input Amplitude (dB)
          Figure 27 DRC Response Characteristic
          The slope of the DRC response is determined by register fields DRC1_HI_COMP and
          DRC1_LO_COMP. A slope of 1 indicates constant gain in this region. A slope less than 1 represents
          compression (i.e. a change in input amplitude produces only a smaller change in output amplitude). A
          slope of 0 indicates that the target output amplitude is the same across a range of input amplitudes;
          this is infinite compression.
          When the noise gate is enabled, the DRC response in this region is determined by the
          DRC1_NG_EXP register. A slope of 1 indicates constant gain in this region. A slope greater than 1
          represents expansion (ie. a change in input amplitude produces a larger change in output amplitude).
          When the DRC1_KNEE2_OP knee is enabled (“Knee2” in Figure 27), this introduces the vertical line
          in the response pattern illustrated, resulting in infinitely steep attenuation at this point in the response.
          The DRC parameters are listed in Table 12.
              REF           PARAMETER                                              DESCRIPTION
              1       DRC1_KNEE_IP                  Input level at Knee1 (dB)
              2       DRC1_KNEE_OP                  Output level at Knee2 (dB)
              3       DRC1_HI_COMP                  Compression ratio above Knee1
              4       DRC1_LO_COMP                  Compression ratio below Knee1
              5       DRC1_KNEE2_IP                 Input level at Knee2 (dB)
              6       DRC1_NG_EXP                   Expansion ratio below Knee2
              7       DRC1_KNEE2_OP                 Output level at Knee2 (dB)
          Table 12 DRC Response Parameters
Rev 4.1                                                                                                            69


                                                                                      WM8998
   The noise gate is enabled when the DRC1_NG_ENA register is set. When the noise gate is not
   enabled, parameters 5, 6, 7 above are ignored, and the DRC1_LO_COMP slope applies to all input
   signal levels below Knee1.
   The DRC1_KNEE2_OP knee is enabled when the DRC1_KNEE2_OP_ENA register is set. When this
   bit is not set, then parameter 7 above is ignored, and the Knee2 position always coincides with the
   low end of the DRC1_LO_COMP region.
   The “Knee1” point in Figure 27 is determined by register fields DRC1_KNEE_IP and
   DRC1_KNEE_OP.
   Parameter Y0, the output level for a 0dB input, is not specified directly, but can be calculated from the
   other parameters, using the equation:
               Y0 = DRC1_KNEE_OP - (DRC1_KNEE_IP x DRC1_HI_COMP)
   Gain Limits
   The minimum and maximum gain applied by the DRC is set by register fields DRC1_MINGAIN,
   DRC1_MAXGAIN and DRC1_NG_MINGAIN. These limits can be used to alter the DRC response
   from that illustrated in Figure 27. If the range between maximum and minimum gain is reduced, then
   the extent of the dynamic range control is reduced.
   The minimum gain in the Compression regions of the DRC response is set by DRC1_MINGAIN. The
   mimimum gain in the Noise Gate region is set by DRC1_NG_MINGAIN. The minimum gain limit
   prevents excessive attenuation of the signal path.
   The maximum gain limit set by DRC1_MAXGAIN prevents quiet signals (or silence) from being
   excessively amplified.
   Dynamic Characteristics
   The dynamic behaviour determines how quickly the DRC responds to changing signal levels. Note
   that the DRC responds to the average (RMS) signal amplitude over a period of time.
   The DRC1_ATK determines how quickly the DRC gain decreases when the signal amplitude is high.
   The DRC1_DCY determines how quickly the DRC gain increases when the signal amplitude is low.
   These register fields are described in Table 13. Note that the register defaults are suitable for general
   purpose microphone use.
   Anti-Clip Control
   The DRC includes an Anti-Clip feature to avoid signal clipping when the input amplitude rises very
   quickly. This feature uses a feed-forward technique for early detection of a rising signal level. Signal
   clipping is avoided by dynamically increasing the gain attack rate when required. The Anti-Clip feature
   is enabled using the DRC1_ANTICLIP bit.
   Note that the feed-forward processing increases the latency in the input signal path.
   Note that the Anti-Clip feature operates entirely in the digital domain. It cannot be used to prevent
   signal clipping in the analogue domain nor in the source signal. Analogue clipping can only be
   prevented by reducing the analogue signal gain or by adjusting the source signal.
   Quick Release Control
   The DRC includes a Quick-Release feature to handle short transient peaks that are not related to the
   intended source signal. For example, in handheld microphone recording, transient signal peaks
   sometimes occur due to user handling, key presses or accidental tapping against the microphone.
   The Quick Release feature ensures that these transients do not cause the intended signal to be
   masked by the longer time constant of DRC1_DCY.
   The Quick-Release feature is enabled by setting the DRC1_QR bit. When this bit is enabled, the DRC
   measures the crest factor (peak to RMS ratio) of the input signal. A high crest factor is indicative of a
   transient peak that may not be related to the intended source signal. If the crest factor exceeds the
70                                                                                                Rev 4.1


                                                                                            WM8998
        level set by DRC1_QR_THR, then the normal decay rate (DRC1_DCY) is ignored and a faster decay
        rate (DRC1_QR_DCY) is used instead.
        Signal Activity Detect
        The DRC incorporates a configurable signal detect function, allowing the signal level at the DRC input
        to be monitored and to be used to trigger other events. This can be used to detect the presence of a
        microphone signal on an ADC or digital mic channel, or can be used to detect an audio signal
        received over the digital audio interface.
        The DRC Signal Detect function is enabled by setting DRC1_SIG_DET register bit. (Note that DRC1
        must also be enabled.) The detection threshold is either a Peak level (Crest Factor) or an RMS level,
        depending on the DRC1_SIG_DET_MODE register bit. When Peak level is selected, the threshold is
        determined by DRC1_SIG_DET_PK, which defines the applicable Crest Factor (Peak to RMS ratio)
        threshold. If RMS level is selected, then the threshold is set using DRC1_SIG_DET_RMS.
        The DRC Signal Detect function is an input to the Interrupt control circuit and can be used to trigger
        an Interrupt event - see “Interrupts”.
        The DRC Signal Detect signal can be output directly on a GPIO pin as an external indication of the
        Signal Detection. See “General Purpose Input / Output” to configure a GPIO pin for this function.
        The Control Write Sequencer can be triggered by the DRC Signal Detect function. This is enabled
        using the DRC1_WSEQ_SIG_DET_ENA register bit. See “Control Write Sequencer” for further
        details.
        GPIO Outputs from DRC
        The Dynamic Range Control (DRC) circuit provides a number of status outputs, which can be output
        directly on a GPIO pin as an external indication of the DRC Status. See “General Purpose Input /
        Output” to configure a GPIO pin for these functions.
        Each of the DRC status outputs is described below.
        The DRC Signal Detect flag indicates that a signal is present on the respective signal path. The
        threshold level for signal detection is configurable using the register fields are described in Table 13.
        The DRC Anti-Clip flag indicates that the DRC Anti-Clip function has been triggered. In this event, the
        DRC gain is decreasing in response to a rising signal level. The flag is asserted until the DRC gain
        stablises.
        The DRC Decay flag indicates that the DRC gain is increasing in response to a low level signal input.
        The flag is asserted until the DRC gain stabilises.
        The DRC Noise Gate flag indicates that the DRC Noise Gate function has been triggered, indicating
        that an idle condition has been detected in the signal path.
        The DRC Quick Release flag indicates that the DRC Quick Release function has been triggered. In
        this event, the DRC gain is increasing rapidly following detection of a short transient peak. The flag is
        asserted until the DRC gain stabilises.
Rev 4.1                                                                                                         71


                                                                              WM8998
   DRC Register Controls
   The DRC control registers are described in Table 13.
      REGISTER          BIT          LABEL           DEFAULT             DESCRIPTION
       ADDRESS
    R3585              15:4     FX_STS [11:0]           000h LHPF, DRC, EQ Enable Status
    (0E01h)                                                  Indicates the status of each of the
    FX_Ctrl2                                                 respective signal processing
                                                             functions.
                                                             [11] = EQ4
                                                             [10] = EQ3
                                                             [9] = EQ2
                                                             [8] = EQ1
                                                             [7] = Reserved
                                                             [6] = Reserved
                                                             [5] = DRC1 (Right)
                                                             [4] = DRC1 (Left)
                                                             [3] = LHPF4
                                                             [2] = LHPF3
                                                             [1] = LHPF2
                                                             [0] = LHPF1
                                                             Each bit is coded as:
                                                             0 = Disabled
                                                             1 = Enabled
    R3712             15:11     DRC1_SIG_DET             00h DRC1 Signal Detect RMS
    (0E80h)                     _RMS [4:0]                   Threshold.
    DRC1 ctrl1                                               This is the RMS signal level for
                                                             signal detect to be indicated when
                                                             DRC1_SIG_DET_MODE=1.
                                                             00h = -30dB
                                                             01h = -31.5dB
                                                             …. (1.5dB steps)
                                                             1Eh = -75dB
                                                             1Fh = -76.5dB
                       10:9     DRC1_SIG_DET              00 DRC1 Signal Detect Peak
                                _PK [1:0]                    Threshold.
                                                             This is the Peak/RMS ratio, or Crest
                                                             Factor, level for signal detect to be
                                                             indicated when
                                                             DRC1_SIG_DET_MODE=0.
                                                             00 = 12dB
                                                             01 = 18dB
                                                             10 = 24dB
                                                             11 = 30dB
                        8       DRC1_NG_ENA                0 DRC1 Noise Gate Enable
                                                             0 = Disabled
                                                             1 = Enabled
                        7       DRC1_SIG_DET               0 DRC1 Signal Detect Mode
                                _MODE                        0 = Peak threshold mode
                                                             1 = RMS threshold mode
                        6       DRC1_SIG_DET               0 DRC1 Signal Detect Enable
                                                             0 = Disabled
                                                             1 = Enabled
                        5       DRC1_KNEE2_                0 DRC1 KNEE2_OP Enable
                                OP_ENA                       0 = Disabled
                                                             1 = Enabled
                        4       DRC1_QR                    1 DRC1 Quick-release Enable
                                                             0 = Disabled
                                                             1 = Enabled
72                                                                                         Rev 4.1


                                                               WM8998
          REGISTER   BIT       LABEL    DEFAULT            DESCRIPTION
           ADDRESS
                     3   DRC1_ANTICLI       1   DRC1 Anti-clip Enable
                         P                      0 = Disabled
                                                1 = Enabled
                     2   DRC1_WSEQ_S        0   DRC1 Signal Detect Write
                         IG_DET_ENA             Sequencer Select
                                                0 = Disabled
                                                1 = Enabled
        R3713      12:9  DRC1_ATK [3:0]  0100   DRC1 Gain attack rate
        (0E81h)                                 (seconds/6dB)
        DRC1 ctrl2                              0000 = Reserved
                                                0001 = 181us
                                                0010 = 363us
                                                0011 = 726us
                                                0100 = 1.45ms
                                                0101 = 2.9ms
                                                0110 = 5.8ms
                                                0111 = 11.6ms
                                                1000 = 23.2ms
                                                1001 = 46.4ms
                                                1010 = 92.8ms
                                                1011 = 185.6ms
                                                1100 to 1111 = Reserved
                    8:5  DRC1_DCY [3:0]  1001   DRC1 Gain decay rate
                                                (seconds/6dB)
                                                0000 = 1.45ms
                                                0001 = 2.9ms
                                                0010 = 5.8ms
                                                0011 = 11.6ms
                                                0100 = 23.25ms
                                                0101 = 46.5ms
                                                0110 = 93ms
                                                0111 = 186ms
                                                1000 = 372ms
                                                1001 = 743ms
                                                1010 = 1.49s
                                                1011 = 2.97s
                                                1100 to1111 = Reserved
                    4:2  DRC1_MINGAIN     100   DRC1 Minimum gain to attenuate
                         [2:0]                  audio signals
                                                000 = 0dB
                                                001 = -12dB
                                                010 = -18dB
                                                011 = -24dB
                                                100 = -36dB
                                                101 = Reserved
                                                11X = Reserved
                    1:0  DRC1_MAXGAI       11   DRC1 Maximum gain to boost audio
                         N [1:0]                signals (dB)
                                                00 = 12dB
                                                01 = 18dB
                                                10 = 24dB
                                                11 = 36dB
Rev 4.1                                                                        73


                                                         WM8998
     REGISTER   BIT       LABEL DEFAULT             DESCRIPTION
      ADDRESS
   R3714      15:12 DRC1_NG_MIN  0000   DRC1 Minimum gain to attenuate
   (0E82h)          GAIN [3:0]          audio signals when the noise gate is
   DRC1 ctrl3                           active.
                                        0000 = -36dB
                                        0001 = -30dB
                                        0010 = -24dB
                                        0011 = -18dB
                                        0100 = -12dB
                                        0101 = -6dB
                                        0110 = 0dB
                                        0111 = 6dB
                                        1000 = 12dB
                                        1001 = 18dB
                                        1010 = 24dB
                                        1011 = 30dB
                                        1100 = 36dB
                                        1101 to 1111 = Reserved
              11:10 DRC1_NG_EXP    00   DRC1 Noise Gate slope
                    [1:0]               00 = 1 (no expansion)
                                        01 = 2
                                        10 = 4
                                        11 = 8
               9:8  DRC1_QR_THR    00   DRC1 Quick-release threshold
                    [1:0]               (crest factor in dB)
                                        00 = 12dB
                                        01 = 18dB
                                        10 = 24dB
                                        11 = 30dB
               7:6  DRC1_QR_DCY    00   DRC1 Quick-release decay rate
                    [1:0]               (seconds/6dB)
                                        00 = 0.725ms
                                        01 = 1.45ms
                                        10 = 5.8ms
                                        11 = Reserved
               5:3  DRC1_HI_COM   011   DRC1 Compressor slope (upper
                    P [2:0]             region)
                                        000 = 1 (no compression)
                                        001 = 1/2
                                        010 = 1/4
                                        011 = 1/8
                                        100 = 1/16
                                        101 = 0
                                        110 = Reserved
                                        111 = Reserved
               2:0  DRC1_LO_COM   000   DRC1 Compressor slope (lower
                    P [2:0]             region)
                                        000 = 1 (no compression)
                                        001 = 1/2
                                        010 = 1/4
                                        011 = 1/8
                                        100 = 0
                                        101 = Reserved
                                        11X = Reserved
74                                                                 Rev 4.1


                                                                                       WM8998
            REGISTER          BIT           LABEL            DEFAULT               DESCRIPTION
             ADDRESS
          R3715             10:5      DRC1_KNEE_IP            000000   DRC1 Input signal level at the
          (0E83h)                     [5:0]                            Compressor ‘Knee’.
          DRC1 ctrl4                                                   000000 = 0dB
                                                                       000001 = -0.75dB
                                                                       000010 = -1.5dB
                                                                       … (-0.75dB steps)
                                                                       111100 = -45dB
                                                                       111101 = Reserved
                                                                       11111X = Reserved
                             4:0      DRC1_KNEE_O              00000   DRC1 Output signal at the
                                      P [4:0]                          Compressor ‘Knee’.
                                                                       00000 = 0dB
                                                                       00001 = -0.75dB
                                                                       00010 = -1.5dB
                                                                       … (-0.75dB steps)
                                                                       11110 = -22.5dB
                                                                       11111 = Reserved
          R3716              9:5      DRC1_KNEE2_I             00000   DRC1 Input signal level at the Noise
          (0E84h)                     P [4:0]                          Gate threshold ‘Knee2’.
          DRC1 ctrl5                                                   00000 = -36dB
                                                                       00001 = -37.5dB
                                                                       00010 = -39dB
                                                                       … (-1.5dB steps)
                                                                       11110 = -81dB
                                                                       11111 = -82.5dB
                                                                       Only applicable when
                                                                       DRC1_NG_ENA = 1.
                             4:0      DRC1_KNEE2_              00000   DRC1 Output signal at the Noise
                                      OP [4:0]                         Gate threshold ‘Knee2’.
                                                                       00000 = -30dB
                                                                       00001 = -31.5dB
                                                                       00010 = -33dB
                                                                       … (-1.5dB steps)
                                                                       11110 = -75dB
                                                                       11111 = -76.5dB
                                                                       Only applicable when
                                                                       DRC1_KNEE2_OP_ENA = 1.
        Table 13 DRC1 Control Registers
        The WM8998 performs automatic checks to confirm that the SYSCLK frequency is high enough to
        support the commanded DRC and digital mixing functions. If an attempt is made to enable a DRC
        signal path, and there are insufficient SYSCLK cycles to support it, then the attempt will be
        unsuccessful. (Note that any signal paths that are already active will not be affected under these
        circumstances.)
        The Underclocked Error can be monitored using the GPIO and/or Interrupt functions. See “General
        Purpose Input / Output” and “Interrupts” for further details.
        The FX_STS field in Register R3585 indicates the status of each of the EQ, DRC and LHPF signal
        paths. If an Underclocked Error condition occurs, then this register provides readback of which EQ,
        DRC or LHPF signal path(s) have been successfully enabled.
        The status bits in Registers R1600 to R2920 indicate the status of each of the digital mixers. If an
        Underclocked Error condition occurs, then these bits provide readback of which mixer(s) have been
        successfully enabled.
Rev 4.1                                                                                                   75


                                                                                             WM8998
   LOW PASS / HIGH PASS DIGITAL FILTER (LHPF)
   The digital core provides four Low Pass Filter (LPF) / High Pass Filter (HPF) processing blocks as
   illustrated in Figure 28. A 4-input mixer is associated with each filter. The 4 input sources are
   selectable in each case, and independent volume control is provided for each path. Each Low/High
   Pass Filter (LHPF) block supports 1 output.
   The Low Pass Filter / High Pass Filter can be used to remove unwanted out-of-band noise from a
   signal path. Each filter can be configured either as a Low Pass filter or High Pass filter.
              LHPFnMIX_SRC1
                                   LHPFnMIX_VOL1
              LHPFnMIX_SRC2
                                   LHPFnMIX_VOL2                  LHPF
                                                      +
                                                                                     LHPF1 (60h)
                                                                                     LHPF2 (61h)
              LHPFnMIX_SRC3                                 Low-Pass filter (LPF) /  LHPF3 (62h)
                                   LHPFnMIX_VOL3
                                                            High-Pass filter (HPF)   LHPF4 (63h)
              LHPFnMIX_SRC4
                                   LHPFnMIX_VOL4
                                             WM8998 supports 4 LHPF blocks, ie. n = 1, 2, 3 or 4
   Figure 28 Digital Core LPF/HPF Blocks
   The LHPF1, LHPF2, LHPF3 and LHPF4 mixer control registers (see Figure 28) are located at register
   addresses R2304 (900h) through to R2335 (91Fh).
   The full list of digital mixer control registers is provided in the “Register Map” section (Register R1600
   through to R2920). Generic register definitions are provided in Table 7.
   The *_SRCn registers select the input source(s) for the respective LHPF processing blocks. Note that
   the selected input source(s) must be configured for the same sample rate as the LHPF to which they
   are connected. Sample rate conversion functions are available to support flexible interconnectivity -
   see “Asynchronous Sample Rate Converter (ASRC)” and “Isochronous Sample Rate Converter
   (ISRC)”.
   The bracketed numbers in Figure 28, eg. “(60h)” indicate the corresponding *_SRCn register setting
   for selection of that signal as an input to another digital core function.
   The sample rate for the LHPF function is configured using the FX_RATE register - see Table 19. Note
   that the EQ, DRC and LHPF functions must all be configured for the same sample rate. Sample rate
   conversion is required when routing the LHPF signal paths to any signal chain that is asynchronous
   and/or configured for a different sample rate.
   The control registers associated with the LHPF functions are described in Table 14.
   The cut-off frequencies for the LHPF blocks are set using the coefficients held in registers R3777,
   R3781, R3785 and R3789 for LHPF1, LHPF2, LHPF3 and LHPF4 respectively. These coefficients are
   derived using tools provided in Cirrus’s WISCE™ evaluation board control software; please contact
   your local Cirrus representative for more details.
76                                                                                                  Rev 4.1


                                                                  WM8998
        REGISTER  BIT        LABEL  DEFAULT                DESCRIPTION
        ADDRESS
        R3585    15:4 FX_STS [11:0]  000h   LHPF, DRC, EQ Enable Status
        (0E01h)                             Indicates the status of each of the
        FX_Ctrl2                            respective signal processing functions.
                                            [11] = EQ4
                                            [10] = EQ3
                                            [9] = EQ2
                                            [8] = EQ1
                                            [7] = Reserved
                                            [6] = Reserved
                                            [5] = DRC1 (Right)
                                            [4] = DRC1 (Left)
                                            [3] = LHPF4
                                            [2] = LHPF3
                                            [1] = LHPF2
                                            [0] = LHPF1
                                            Each bit is coded as:
                                            0 = Disabled
                                            1 = Enabled
        R3776     1   LHPF1_MODE       0    Low/High Pass Filter 1 Mode
        (0EC0h)                             0 = Low-Pass
        HPLPF1_                             1 = High-Pass
        1         0   LHPF1_ENA        0    Low/High Pass Filter 1 Enable
                                            0 = Disabled
                                            1 = Enabled
        R3777    15:0 LHPF1_COEFF    0000h  Low/High Pass Filter 1 Frequency
        (0EC1h)       [15:0]                Coefficient
        HPLPF1_                             Refer to WISCE evaluation board control
        2                                   software for the derivation of this field
                                            value.
        R3780     1   LHPF2_MODE       0    Low/High Pass Filter 2 Mode
        (0EC4h)                             0 = Low-Pass
        HPLPF2_                             1 = High-Pass
        1         0   LHPF2_ENA        0    Low/High Pass Filter 2 Enable
                                            0 = Disabled
                                            1 = Enabled
        R3781    15:0 LHPF2_COEFF    0000h  Low/High Pass Filter 2 Frequency
        (0EC5h)       [15:0]                Coefficient
        HPLPF2_                             Refer to WISCE evaluation board control
        2                                   software for the derivation of this field
                                            value.
        R3784     1   LHPF3_MODE       0    Low/High Pass Filter 3 Mode
        (0EC8h)                             0 = Low-Pass
        HPLPF3_                             1 = High-Pass
        1         0   LHPF3_ENA        0    Low/High Pass Filter 3 Enable
                                            0 = Disabled
                                            1 = Enabled
        R3785    15:0 LHPF3_COEFF    0000h  Low/High Pass Filter 3 Frequency
        (0EC9h)       [15:0]                Coefficient
        HPLPF3_                             Refer to WISCE evaluation board control
        2                                   software for the derivation of this field
                                            value.
        R3788     1   LHPF4_MODE       0    Low/High Pass Filter 4 Mode
        (0ECCh)                             0 = Low-Pass
        HPLPF4_                             1 = High-Pass
        1         0   LHPF4_ENA        0    Low/High Pass Filter 4 Enable
                                            0 = Disabled
                                            1 = Enabled
Rev 4.1                                                                               77


                                                                                       WM8998
     REGISTER        BIT          LABEL           DEFAULT                       DESCRIPTION
     ADDRESS
     R3789         15:0    LHPF4_COEFF              0000h        Low/High Pass Filter 4 Frequency
     (0ECDh)               [15:0]                                Coefficient
     HPLPF4_                                                     Refer to WISCE evaluation board control
     2                                                           software for the derivation of this field
                                                                 value.
   Table 14 Low Pass Filter / High Pass Filter Control
   The WM8998 performs automatic checks to confirm that the SYSCLK frequency is high enough to
   support the commanded LHPF and digital mixing functions. If an attempt is made to enable an LHPF
   signal path, and there are insufficient SYSCLK cycles to support it, then the attempt will be
   unsuccessful. (Note that any signal paths that are already active will not be affected under these
   circumstances.)
   The Underclocked Error can be monitored using the GPIO and/or Interrupt functions. See “General
   Purpose Input / Output” and “Interrupts” for further details.
   The FX_STS field in Register R3585 indicates the status of each of the EQ, DRC and LHPF signal
   paths. If an Underclocked Error condition occurs, then this register provides readback of which EQ,
   DRC or LHPF signal path(s) have been successfully enabled.
   The status bits in Registers R1600 to R2920 indicate the status of each of the digital mixers. If an
   Underclocked Error condition occurs, then these bits provide readback of which mixer(s) have been
   successfully enabled.
78                                                                                                     Rev 4.1


                                                                                             WM8998
        SPDIF OUTPUT GENERATOR
        The WM8998 incorporates an IEC-60958-3 compatible S/PDIF output generator, as illustrated in
        Figure 29; this provides a stereo S/PDIF output on a GPIO pin. The S/PDIF transmitter allows full
        control over the S/PDIF validity bits and channel status information.
        The input sources to the S/PDIF transmitter are selectable for each channel, and independent volume
        control is provided for each path. The *TX1 and *TX2 registers control channels ‘A’ and ‘B’
        (respectively) of the S/PDIF output.
        The S/PDIF signal can be output directly on a GPIO pin. See “General Purpose Input / Output” to
        configure a GPIO pin for this function.
        Note that the S/PDIF signal cannot be selected as input to the digital mixers or signal processing
        functions within the WM8998 digital core.
                                                                Channel ‘A’
                SPDIF1TX1MIX_SRC
                                         SPDIF1TX1MIX_VOL
                                                                               S/PDIF
                                                                                                   GPIO
                                                                                                   (GPn = 07h)
                                                                Channel ‘B’    SPD1_ENA
                SPDIF1TX2MIX_SRC                                               SPD1_RATE
                                         SPDIF1TX2MIX_VOL
        Figure 29 Digital Core S/PDIF Output Generator
        The S/PDIF input control registers (see Figure 29) are located at register addresses R2048 (800h)
        through to R2057 (809h).
        The full list of digital mixer control registers is provided in the “Register Map” section (Register R1600
        through to R2920). Generic register definitions are provided in Table 7.
        The *_SRCn registers select the input source(s) for the two S/PDIF channels. Note that the selected
        input source(s) must be synchronised to the SYSCLK clocking domain, and configured for the same
        sample rate as the S/PDIF generator. Sample rate conversion functions are available to support
        flexible interconnectivity - see “Asynchronous Sample Rate Converter (ASRC)” and “Isochronous
        Sample Rate Converter (ISRC)”.
        The sample rate of the S/PDIF generator is configured using the SPD1_RATE register - see Table 19.
        The S/PDIF transmitter supports sample rates in the range 32kHz up to 192kHz. Note that sample
        rate conversion is required when linking the S/PDIF generator to any signal chain that is
        asynchronous and/or configured for a different sample rate.
        The S/PDIF generator is enabled using the SPD1_ENA register bit, as described in Table 15.
        The S/PDIF output contains audio data derived from the selected sources. Audio samples up to 24-bit
        width can be accommodated. The Validity bits and the Channel Status bits in the S/PDIF data are
        configured using the corresponding fields in registers R1474 (5C2h) to R1477 (5C5h).
        Refer to S/PDIF specification (IEC 60958-3) for full details of the S/PDIF protocol and configuration
        parameters.
Rev 4.1                                                                                                         79


                                                                                    WM8998
      REGISTER        BIT          LABEL            DEFAULT                   DESCRIPTION
       ADDRESS
     R1474            13    SPD1_VAL2                   0       S/PDIF validity (Subframe B)
     (05C2h)          12    SPD1_VAL1                   0       S/PDIF validity (Subframe A)
     SPD1 TX
                      0     SPD1_ENA                    0       S/PDIF Generator Enable
     Control
                                                                0 = Disabled
                                                                1 = Enabled
     R1475           15:8   SPD1_CATCODE               00h      S/PDIF Category code
     (05C3h)                [7:0]
     SPD1 TX         7:6    SPD1_CHSTMO                00       S/PDIF Channel Status mode
     Channel                DE [1:0]
     Status 1
                     5:3    SPD1_PREEMPH               000      S/PDIF De-emphasis mode
                            [2:0]
                      2     SPD1_NOCOPY                 0       S/PDIF Copyright status
                      1     SPD1_NOAUDIO                0       S/PDIF Audio / Non-audio indication
                      0     SPD1_PRO                    0       S/PDIF Consumer / Professional Mode
     R1476          15:12   SPD1_FREQ [3:0]           0000      S/PDIF Indicated sample frequency
     (05C4h)         11:8   SPD1_CHNUM2               1011      S/PDIF Channel number (Subframe B)
     SPD1 TX                [3:0]
     Channel
                     7:4    SPD1_CHNUM1               0000      S/PDIF Channel number (Subframe A)
     Status 2
                            [3:0]
                     3:0    SPD1_SRCNUM               0001      S/PDIF Source number
                            [3:0]
     R1477           11:8   SPD1_ORGSAM               0000      S/PDIF Original sample frequency
     (05C5h)                P [3:0]
     SPD1 TX         7:5    SPD1_TXWL [2:0]            000      S/PDIF Audio sample word length
     Channel
                      4     SPD1_MAXWL                  0       S/PDIF Maximum audio sample word
     Status 3
                                                                length
                     3:2    SPD1_SC31_30               00       S/PDIF Channel Status [31:30]
                            [1:0]
                     1:0    SPD1_CLKACU                00       Transmitted clock accuracy
                            [1:0]
   Table 15 S/PDIF Output Generator Control
   The WM8998 performs automatic checks to confirm that the SYSCLK frequency is high enough to
   support the digital mixer paths. If an attempt is made to enable the SPDIF generator, and there are
   insufficient SYSCLK cycles to support it, then the attempt will be unsuccessful. (Note that any signal
   paths that are already active will not be affected under these circumstances.)
   The Overclocked Error condition can be monitored using the GPIO and/or Interrupt functions. See
   “General Purpose Input / Output” and “Interrupts” for further details.
   The status bits in Registers R1600 to R2920 indicate the status of each of the digital mixers. If an
   Underclocked Error condition occurs, then these bits provide readback of which mixer(s) have been
   successfully enabled.
80                                                                                              Rev 4.1


                                                                                       WM8998
        TONE GENERATOR
        The WM8998 incorporates two 1kHz tone generators which can be used for ‘beep’ functions through
        any of the audio signal paths. The phase relationship between the two generators is configurable,
        providing flexibility in creating differential signals, or for test scenarios.
                         1kHz                  Tone Generator 1 (04h)
                 Tone Generator
                                               Tone Generator 2 (05h)
               TONE1_ENA             TONE1_OVD
               TONE2_ENA             TONE1_LVL
               TONE_OFFSET           TONE2_OVD
               TONE_RATE             TONE2_LVL
        Figure 30 Digital Core Tone Generator
        The tone generators can be selected as input to any of the digital mixers or signal processing
        functions within the WM8998 digital core. The bracketed numbers in Figure 30, eg. “(04h)” indicate
        the corresponding *_SRCn register setting for selection of that signal as an input to another digital
        core function.
        The sample rate for the tone generators is configured using the TONE_RATE register - see Table 19.
        Note that sample rate conversion is required when routing the tone generator output(s) to any signal
        chain that is asynchronous and/or configured for a different sample rate.
        The tone generators are enabled using the TONE1_ENA and TONE2_ENA register bits as described
        in Table 16. The phase relationship is configured using TONE_OFFSET.
        The tone generators can also provide a configurable DC signal level, for use as a test signal. The DC
        output is selected using the TONEn_OVD register bits, and the DC signal amplitude is configured
        using the TONEn_LVL registers, as described in Table 16.
Rev 4.1                                                                                                    81


                                                                       WM8998
    REGISTER      BIT         LABEL    DEFAULT                 DESCRIPTION
    ADDRESS
    R32          9:8   TONE_OFFSET        00   Tone Generator Phase Offset
    (0020h)            [1:0]                   Sets the phase of Tone Generator 2
    Tone                                       relative to Tone Generator 1
    Generator                                  00 = 0 degrees (in phase)
    1                                          01 = 90 degrees ahead
                                               10 = 180 degrees ahead
                                               11 = 270 degrees ahead
                  5    TONE2_OVD          0    Tone Generator 2 Override
                                               0 = Disabled (1kHz tone output)
                                               1 = Enabled (DC signal output)
                                               The DC signal level, when selected, is
                                               configured using TONE2_LVL[23:0]
                  4    TONE1_OVD          0    Tone Generator 1 Override
                                               0 = Disabled (1kHz tone output)
                                               1 = Enabled (DC signal output)
                                               The DC signal level, when selected, is
                                               configured using TONE1_LVL[23:0]
                  1    TONE2_ENA          0    Tone Generator 2 Enable
                                               0 = Disabled
                                               1 = Enabled
                  0    TONE1_ENA          0    Tone Generator 1 Enable
                                               0 = Disabled
                                               1 = Enabled
    R33         15:0   TONE1_LVL        1000h  Tone Generator 1 DC output level
    (0021h)            [23:8]                  TONE1_LVL [23:8] is coded as 2’s
    Tone                                       complement. Bits [23:20] contain the
    Generator                                  integer portion; bits [19:0] contain the
    2                                          fractional portion.
                                               The digital core 0dBFS level corresponds
                                               to 1000_00h (+1) or F000_00h (-1).
    R34          7:0   TONE1_LVL [7:0]   00h   Tone Generator 1 DC output level
    (0022h)                                    TONE1_LVL [23:8] is coded as 2’s
    Tone                                       complement. Bits [23:20] contain the
    Generator                                  integer portion; bits [19:0] contain the
    3                                          fractional portion.
                                               The digital core 0dBFS level corresponds
                                               to 1000_00h (+1) or F000_00h (-1).
    R35         15:0   TONE2_LVL        1000h  Tone Generator 2 DC output level
    (0023h)            [23:8]                  TONE2_LVL [23:8] is coded as 2’s
    Tone                                       complement. Bits [23:20] contain the
    Generator                                  integer portion; bits [19:0] contain the
    4                                          fractional portion.
                                               The digital core 0dBFS level corresponds
                                               to 1000_00h (+1) or F000_00h (-1).
    R36          7:0   TONE2_LVL [7:0]   00h   Tone Generator 2 DC output level
    (0024h)                                    TONE2_LVL [23:8] is coded as 2’s
    Tone                                       complement. Bits [23:20] contain the
    Generator                                  integer portion; bits [19:0] contain the
    5                                          fractional portion.
                                               The digital core 0dBFS level corresponds
                                               to 1000_00h (+1) or F000_00h (-1).
   Table 16 Tone Generator Control
82                                                                                  Rev 4.1


                                                                                                                  WM8998
                            HAPTIC SIGNAL GENERATOR
                            The WM8998 incorporates a signal generator for use with haptic devices (eg. mechanical vibration
                            actuators). The haptic signal generator is compatible with both Eccentric Rotating Mass (ERM) and
                            Linear Resonant Actuator (LRA) haptic devices.
                            The haptic signal generator is highly configurable, and includes the capability to execute a
                            programmable event profile comprising three distinct operating phases.
                            The resonant frequency of the haptic signal output (for LRA devices) is selectable, providing support
                            for many different actuator components.
                            The haptic signal generator is a digital signal generator which is incorporated within the digital core of
                            the WM8998. The haptic signal may be routed, via one of the digital core output mixers, to a Class D
                            speaker output for connection to the external haptic device, as illustrated in Figure 31. (Note that the
                            digital PDM output paths may also be used for haptic signal output.)
                                               Digital Core Output Mixer Output Volume  DAC       Class D Speaker Driver
        Haptic Signal
          Generator        Haptic Output (06h)                     +                     DAC
     HAP_ACT                                                                                                             Haptic Device
     HAP_CTRL
     ONESHOT_TRIG                               OUTnxMIX_SRCn
     LRA_FREQ                                   OUTnxMIX_VOLn
     HAP_RATE
Figure 31 Digital Core Haptic Signal Generator
                            The bracketed number (06h) in Figure 31 indicates the corresponding *_SRCn register setting for
                            selection of the haptic signal generator as an input to another digital core function.
                            The haptic signal generator is selected as input to one of the digital core output mixers by setting the
                            *_SRCn register of the applicable output mixer to (06h).
                            The sample rate for the haptic signal generator is configured using the HAP_RATE register - see
                            Table 19. Note that sample rate conversion is required when routing the haptic signal generator
                            output to any signal chain that is asynchronous and/or configured for a different sample rate.
                            The haptic signal generator is configured for an ERM or LRA actuator using the HAP_ACT register bit.
                            The required resonant frequency is configured using the LRA_FREQ field. (Note that the resonant
                            frequency is only applicable to LRA actuators.)
                            The signal generator can be enabled in Continuous mode or configured for One-Shot mode using the
                            HAP_CTRL register, as described in Table 17. In One-Shot mode, the output is triggered by writing to
                            the ONESHOT_TRIG bit.
                            In One-Shot mode, the signal generator profile comprises the distinct phases (1, 2, 3). The duration
                            and intensity of each output phase is programmable.
                            In Continuous mode, the signal intensity is controlled using the PHASE2_INTENSITY field only.
                            In the case of an ERM actuator (HAP_ACT = 0), the haptic output is a DC signal level, which may be
                            positive or negative, as selected by the *_INTENSITY registers.
                            For an LRA actuator (HAP_ACT = 1), the haptic output is an AC signal; selecting a negative signal
                            level corresponds to a 180 degree phase inversion. In some applications, phase inversion may be
                            desirable during the final phase, to halt the physical motion of the haptic device.
Rev 4.1                                                                                                                              83


                                                                  WM8998
   REGISTER    BIT        LABEL   DEFAULT                 DESCRIPTION
   ADDRESS
   R144        4   ONESHOT_TRIG      0    Haptic One-Shot Trigger
   (0090h)                                Writing ‘1’ starts the one-shot profile (ie.
   Haptics                                Phase 1, Phase 2, Phase 3)
   Control 1  3:2  HAP_CTRL [1:0]    00   Haptic Signal Generator Control
                                          00 = Disabled
                                          01 = Continuous
                                          10 = One-Shot
                                          11 = Reserved
               1   HAP_ACT           0    Haptic Actuator Select
                                          0 = Eccentric Rotating Mass (ERM)
                                          1 = Linear Resonant Actuator (LRA)
   R145      14:0  LRA_FREQ        7FFFh  Haptic Resonant Frequency
   (0091h)         [14:0]                 Selects the haptic signal frequency (LRA
   Haptics                                actuator only, HAP_ACT = 1)
   Control 2
                                          Haptic Frequency (Hz) =
                                          System Clock / (2 x (LRA_FREQ+1))
                                          where System Clock = 6.144MHz or
                                          5.6448MHz, derived by division from
                                          SYSCLK or ASYNCCLK.
                                          If HAP_RATE<1000, then SYSCLK is the
                                          clock source, and the applicable System
                                          Clock frequency is determined by
                                          SYSCLK.
                                          If HAP_RATE>=1000, then ASYNCCLK is
                                          the clock source, and the applicable
                                          System Clock frequency is determined by
                                          ASYNCCLK.
                                          Valid for Haptic Frequency in the range
                                          100Hz to 250Hz
                                          For 6.144MHz System Clock:
                                          77FFh = 100Hz
                                          4491h = 175Hz
                                          2FFFh = 250Hz
                                          For 5.6448MHz System Clock:
                                          6E3Fh = 100Hz
                                          3EFFh = 175Hz
                                          2C18h = 250Hz
   R146       7:0  PHASE1_INTEN     00h   Haptic Output Level (Phase 1)
   (0092h)         SITY [7:0]             Selects the signal intensity of Phase 1 in
   Haptics                                one-shot mode.
   phase 1                                Coded as 2’s complement.
   intensity                              Range is +/- Full Scale (FS).
                                          For ERM actuator, this selects the DC
                                          signal level for the haptic output.
                                          For LRA actuator, this selects the AC peak
                                          amplitude; Negative values correspond to
                                          a 180 degree phase shift.
84                                                                             Rev 4.1


                                                                                WM8998
         REGISTER       BIT        LABEL         DEFAULT                 DESCRIPTION
         ADDRESS
         R147          8:0   PHASE1_DURAT         000h   Haptic Output Duration (Phase 1)
         (0093h)             ION [8:0]                   Selects the duration of Phase 1 in one-
         Haptics                                         shot mode.
         Control                                         000h = 0ms
         phase 1                                         001h = 0.625ms
         duration                                        002h = 1.25ms
                                                         … (0.625ms steps)
                                                         1FFh = 319.375ms
         R148          7:0   PHASE2_INTEN          00h   Haptic Output Level (Phase 2)
         (0094h)             SITY [7:0]                  Selects the signal intensity in Continuous
         Haptics                                         mode or Phase 2 of one-shot mode.
         phase 2                                         Coded as 2’s complement.
         intensity                                       Range is +/- Full Scale (FS).
                                                         For ERM actuator, this selects the DC
                                                         signal level for the haptic output.
                                                         For LRA actuator, this selects the AC peak
                                                         amplitude; Negative values correspond to
                                                         a 180 degree phase shift.
         R149         10:0   PHASE2_DURAT         000h   Haptic Output Duration (Phase 2)
         (0095h)             ION [10:0]                  Selects the duration of Phase 2 in one-
         Haptics                                         shot mode.
         phase 2                                         000h = 0ms
         duration                                        001h = 0.625ms
                                                         002h = 1.25ms
                                                         … (0.625ms steps)
                                                         7FFh = 1279.375ms
         R150          7:0   PHASE3_INTEN          00h   Haptic Output Level (Phase 3)
         (0096h)             SITY [7:0]                  Selects the signal intensity of Phase 3 in
         Haptics                                         one-shot mode.
         phase 3                                         Coded as 2’s complement.
         intensity                                       Range is +/- Full Scale (FS).
                                                         For ERM actuator, this selects the DC
                                                         signal level for the haptic output.
                                                         For LRA actuator, this selects the AC peak
                                                         amplitude; Negative values correspond to
                                                         a 180 degree phase shift.
         R151          8:0   PHASE3_DURAT         000h   Haptic Output Duration (Phase 3)
         (0097h)             ION [8:0]                   Selects the duration of Phase 3 in one-
         Haptics                                         shot mode.
         phase 3                                         000h = 0ms
         duration                                        001h = 0.625ms
                                                         002h = 1.25ms
                                                         … (0.625ms steps)
                                                         1FFh = 319.375ms
         R152           0    ONESHOT_STS            0    Haptic One-Shot status
         (0098h)                                         0 = One-Shot event not in progress
         Haptics                                         1 = One-Shot event in progress
         Status
        Table 17 Haptic Signal Generator Control
Rev 4.1                                                                                             85


                                                                                                   WM8998
   PWM GENERATOR
   The WM8998 incorporates two Pulse Width Modulation (PWM) signal generators as illustrated in
   Figure 32. The duty cycle of each PWM signal can be modulated by an audio source, or can be set to
   a fixed value using a control register setting.
   A 4-input mixer is associated with each PWM generator. The 4 input sources are selectable in each
   case, and independent volume control is provided for each path.
   The PWM signal generators can be output directly on a GPIO pin. See “General Purpose Input /
   Output” to configure a GPIO pin for this function.
   Note that the PWM output should always be disabled whenever the system clock, SYSCLK, is
   disabled. Failure to do this may result in a persistent logic ‘1’ DC output from the PWM generator. See
   “Clocking and Sample Rates” for details of system clocking and the associated control requirements.
   Note that the PWM signal generators cannot be selected as input to the digital mixers or signal
   processing functions within the WM8998 digital core.
           When PWMn_OVD = 0, the PWM duty cycle is controlled by the respective digital audio mixer.
           When PWMn_OVD = 1, the PWM duty cycle is set by PWMn_LVL.
           The PWM sample rate and clocking frequency are selected using PWM_RATE and PWM_CLK_SEL.
                 PWM1MIX_SRC1
                                         PWM1MIX_VOL1
                 PWM1MIX_SRC2
                                         PWM1MIX_VOL2                             PWM1
                                                                   +
                                                                                                        GPIO
                                                                                                        (GPn = 08h)
                 PWM1MIX_SRC3                                                   PWM1_ENA
                                         PWM1MIX_VOL3                           PWM1_OVD
                                                                                PWM1_LVL
                 PWM1MIX_SRC4
                                         PWM1MIX_VOL4
                                                                                                      PWM_RATE
                                                                                                      PWM_CLK_SEL
                 PWM2MIX_SRC1
                                         PWM2MIX_VOL1
                 PWM2MIX_SRC2
                                         PWM2MIX_VOL2                             PWM2
                                                                   +
                                                                                                        GPIO
                                                                                                        (GPn = 09h)
                 PWM2MIX_SRC3                                                   PWM2_ENA
                                         PWM2MIX_VOL3                           PWM2_OVD
                                                                                PWM2_LVL
                 PWM2MIX_SRC4
                                         PWM2MIX_VOL4
   Figure 32 Digital Core Pulse Width Modulation (PWM) Generator
   The PWM1 and PWM2 mixer control registers (see Figure 32) are located at register addresses
   R1600 (640h) through to R1615 (64Fh).
   The full list of digital mixer control registers is provided in the “Register Map” section (Register R1600
   through to R2920). Generic register definitions are provided in Table 7.
   The *_SRCn registers select the input source(s) for the respective mixers. Note that the selected input
   source(s) must be configured for the same sample rate as the mixer to which they are connected.
   Sample rate conversion functions are available to support flexible interconnectivity - see
86                                                                                                            Rev 4.1


                                                                                              WM8998
        “Asynchronous Sample Rate Converter (ASRC)” and “Isochronous Sample Rate Converter (ISRC)”.
        The PWM sample rate (cycle time) is configured using the PWM_RATE register - see Table 19. Note
        that sample rate conversion is required when linking the PWM generators to any signal chain that is
        asynchronous and/or configured for a different sample rate.
        The PWM generators are enabled using PWM1_ENA and PWM2_ENA respectively, as described in
        Table 18.
        Under default conditions (PWMn_OVD = 0), the duty cycle of the PWM generators is controlled by an
        audio signal path; a 4-input mixer is associated with each PWM generator, as illustrated in Figure 32.
        When the PWMn_OVD bit is set, the duty cycle of the respective PWM generator is set to a fixed
        ratio; in this case, the duty cycle ratio is configurable using the PWMn_LVL registers.
        The PWM generator clock frequency is selected using PWM_CLK_SEL. For best performance, this
        register should be set to the highest available setting. Note that the PWM generator clock must not be
        set to a higher frequency than SYSCLK (if PWM_RATE<1000) or ASYNCCLK (if PWM_RATE≥1000).
            REGISTER         BIT          LABEL             DEFAULT                    DESCRIPTION
            ADDRESS
          R48 (0030h)      10:8    PWM_CLK_SEL                000        PWM Clock Select
          PWM Drive                [2:0]                                 000 = 6.144MHz (5.6448MHz)
          1                                                              001 = 12.288MHz (11.2896MHz)
                                                                         010 = 24.576MHz (22.5792MHz)
                                                                         All other codes are Reserved
                                                                         The frequencies in brackets apply for
                                                                         44.1kHz-related sample rates only.
                                                                         PWM_CLK_SEL controls the resolution
                                                                         of the PWM generator; higher settings
                                                                         correspond to higher resolution.
                                                                         The PWM Clock must be less than or
                                                                         equal to SYSCLK (if PWM_RATE<1000)
                                                                         or less than or equal to ASYNCCLK (if
                                                                         PWM_RATE>=1000).
                             5     PWM2_OVD                    0         PWM2 Generator Override
                                                                         0 = Disabled (PWM duty cycle is
                                                                         controlled by audio source)
                                                                         1 = Enabled (PWM duty cycle is
                                                                         controlled by PWM2_LVL).
                             4     PWM1_OVD                    0         PWM1 Generator Override
                                                                         0 = Disabled (PWM1 duty cycle is
                                                                         controlled by audio source)
                                                                         1 = Enabled (PWM1 duty cycle is
                                                                         controlled by PWM1_LVL).
                             1     PWM2_ENA                    0         PWM2 Generator Enable
                                                                         0 = Disabled
                                                                         1 = Enabled
                             0     PWM1_ENA                    0         PWM1 Generator Enable
                                                                         0 = Disabled
                                                                         1 = Enabled
          R49 (0031h)       9:0    PWM1_LVL [9:0]            100h        PWM1 Override Level
          PWM Drive                                                      Sets the PWM1 duty cycle when
          2                                                              PWM1_OVD=1.
                                                                         Coded as 2’s complement.
                                                                         000h = 50% duty cycle
                                                                         200h = 0% duty cycle
          R50 (0032h)       9:0    PWM2_LVL [9:0]            100h        PWM2 Override Level
          PWM Drive                                                      Sets the PWM2 duty cycle when
          3                                                              PWM2_OVD=1.
                                                                         Coded as 2’s complement.
                                                                         000h = 50% duty cycle
                                                                         200h = 0% duty cycle
        Table 18 Pulse Width Modulation (PWM) Generator Control
Rev 4.1                                                                                                        87


                                                                                    WM8998
   The WM8998 performs automatic checks to confirm that the SYSCLK frequency is high enough to
   support the digital mixer paths. If an attempt is made to enable a PWM signal mixer path, and there
   are insufficient SYSCLK cycles to support it, then the attempt will be unsuccessful. (Note that any
   signal paths that are already active will not be affected under these circumstances.)
   The Underclocked Error condition can be monitored using the GPIO and/or Interrupt functions. See
   “General Purpose Input / Output” and “Interrupts” for further details.
   The status bits in Registers R1600 to R2920 indicate the status of each of the digital mixers. If an
   Underclocked Error condition occurs, then these bits provide readback of which mixer(s) have been
   successfully enabled.
   SAMPLE RATE CONTROL
   The WM8998 supports multiple signal paths through the digital core. Stereo full-duplex sample rate
   conversion is provided to allow digital audio to be routed between interfaces operating at different
   sample rates and/or referenced to asynchronous clock domains.
   Two independent clock domains are supported, referenced to SYSCLK and ASYNCCLK respectively,
   as described in “Clocking and Sample Rates”. Every digital signal path must be synchronised either to
   SYSCLK or to ASYNCCLK.
   Up to five different sample rates may be in use at any time on the WM8998. Three of these sample
   rates must be synchronised to SYSCLK; the remaining two, where required, must be synchronised to
   ASYNCCLK.
   Sample rate conversion is required when routing any audio path between digital functions that are
   asynchronous and/or configured for different sample rates.
   The Asynchronous Sample Rate Converter (ASRC) provides two signal paths between the SYSCLK
   and ASYNCCLK domains. The ASRC is described later, and is illustrated in Figure 35.
   There are two Isochronous Sample Rate Converters (ISRCs). These provide signal paths between
   different sample rates on the SYSCLK domain, or between sample rates on the ASYNCCLK domain.
   ISRC1 supports up to 4 signal paths; ISRC2 supports up to 2 signal paths. The ISRCs are described
   later, and are illustrated in Figure 36.
   The sample rate of different blocks within the WM8998 digital core are controlled as illustrated in
   Figure 33 and Figure 34 - the *_RATE registers select the applicable sample rate for each respective
   group of digital functions.
   The *_RATE registers should not be changed if any of the *_SRCn registers associated with the
   respective functions is non-zero. The associated *_SRCn registers should be cleared to 00h before
   writing new values to the *_RATE registers. A minimum delay of 125µs should be allowed between
   clearing the *_SRCn registers and writing to the associated *_RATE registers. See Table 19 for
   further details.
88                                                                                            Rev 4.1


                                                                                      Silence (mute) (00h)
Rev 4.1
                                                                                      AEC1 Loopback (08h)                                                                         ISRC2 INT1 (A8h)                                            ISRC1 INT1 (A0h)
                                                                                      AEC2 Loopback (09h)
                                                                                                                                                                Isochronous
                                                                                                                                                                                  ISRC2 INT2 (A9h)                                            ISRC1 INT2 (A1h)
                                                                                                                                                               Sample Rate
                                                                                    OUT_RATE                                                                  Converter (ISRC)
                                                                                                                                          ISRC2 DEC1 (ACh)                                                                                    ISRC1 INT3 (A2h)
                                                                                                                                                                                                                           Isochronous
                                                                                      IN1L signal path (10h)                              ISRC2 DEC2 (ADh)                                                                                    ISRC1 INT4 (A3h)
                                                                                                                                                                                                                          Sample Rate
                                                                                                                                                                                                                         Converter (ISRC)
                                                                                      IN1R signal path (11h)                                 ISRC2_FSL                             ISRC2_FSH          ISRC1 DEC1 (A4h)
                                                                                      IN2 signal path (12h)                                                                                           ISRC1 DEC2 (A5h)
                                                                                    IN_RATE                                                                                                           ISRC1 DEC3 (A6h)
                                                                                                                                                                                  ASRC1 Left (90h)    ISRC1 DEC4 (A7h)
                                                                                                                         SPD1_RATE                             Asynchronous
                                                                                                                                                                                  ASRC1 Right (91h)      ISRC1_FSL                             ISRC1_FSH
                                                                                                                                                                Sample Rate
                                                                                                                                                              Converter (ASRC)
                                                                                                                                           ASRC2 Left (92h)
                                                                                                               S/PDIF
                                                                                                                         (To GPIO pin)
                                                                                                                                          ASRC2 Right (93h)
                                                                                                                                            ASRC_RATE1                            ASRC_RATE2
                                                                                                                                                                                          FX_RATE
                                                                                                                                                                                                                                             TONE_RATE
                                                                                                                                                                     EQ
                                                                                                         +        LHPF                                                           EQ1 (50h)                                       Tone Generator 1 (04h)
                                                                                                                            LHPF1 (60h)                                                                       Tone Generator
                                                                                                                                                                                                                                 Tone Generator 2 (05h)
          Figure 33 Digital Core Sample Rate Control (Internal Signal Processing)
                                                                                                                                                                     EQ
                                                                                                                                                                                 EQ2 (51h)
                                                                                                                                                                                                                                               HAP_RATE
                                                                                                         +        LHPF
                                                                                                                            LHPF2 (61h)
                                                                                                                                                                                                                Haptic Signal
                                                                                                                                                                     EQ                                          Generator       Haptic Output (06h)
                                                                                                                                                                                 EQ3 (52h)
                                                                                                         +        LHPF                                               EQ
                                                                                                                            LHPF3 (62h)                                          EQ4 (53h)                                                    PWM_RATE
                                                                                                                                                                                                                         +      PWM
                                                                                                                                                                                                                                              (To GPIO pin)
                                                                                                         +        LHPF
                                                                                                                            LHPF4 (63h)                              DRC
                                                                                                                                                                                 DRC1 Left (58h)
                                                                                                                                                                                                                         +      PWM
                                                                                                                                                                                                                                              (To GPIO pin)
                                                                                                                                                                     DRC
                                                                                                                                                                                 DRC1 Right (59h)
                                                                                                                                                                                                                                                                 WM8998
89


90
                                                                                                                                                                                           OUT_RATE
                                                                                            AIF1 RX6 (25h)            AIF2 RX6 (2Dh)                             AIF3 RX2 (31h)
                                                                                            AIF1 RX5 (24h)            AIF2 RX5 (2Ch)                             AIF3 RX1 (30h)      +
                                                                                                                                                                                         OUT1L output
                                                                                            AIF1 RX4 (23h)            AIF2 RX4 (2Bh)
                                                                                            AIF1 RX3 (22h)            AIF2 RX3 (2Ah)                +
                                                                                                                                                              AIF3 TX2 output
                                                                                            AIF1 RX2 (21h)            AIF2 RX2 (29h)                                                 +
                                                                                                                                                                                         OUT1R output
                                                                                            AIF1 RX1 (20h)            AIF2 RX1 (28h)
                                                                                                                                                    +
                                                                                                                                                              AIF3 TX1 output
                                                                                     +                         +
                                                                                         AIF1 TX6 output           AIF2 TX6 output                                                   +
                                                                                                                                                                                         OUT2L output
                                                                                                                                                                        AIF3_RATE
                                                                                     +                         +                         SLIMRX4_RATE
                                                                                         AIF1 TX5 output           AIF2 TX5 output                                                   +
                                                                                                                                                                 SLIMbus RX4 (3Bh)       OUT2R output
                                                                                                                                         SLIMRX3_RATE
                                                                                                                                                                 SLIMbus RX3 (3Ah)
                                                                                                                                         SLIMRX2_RATE
                                                                                                                                                                 SLIMbus RX2 (39h)
                                                                                     +                         +                         SLIMRX1_RATE
                                                                                         AIF1 TX4 output           AIF2 TX4 output                               SLIMbus RX1 (38h)   +
                                                                                                                                                                                         OUT3 output
                                                                                                                                                                SLIMTX6_RATE
          Figure 34 Digital Core Sample Rate Control (External Digital Interfaces)
                                                                                                                                         SLIMbus TX6 output
                                                                                     +                         +
                                                                                         AIF1 TX3 output           AIF2 TX3 output                                                   +
                                                                                                                                                                SLIMTX5_RATE             OUT4L output
                                                                                                                                         SLIMbus TX5 output
                                                                                                                                                                SLIMTX4_RATE
                                                                                                                                         SLIMbus TX4 output
                                                                                     +                         +                                                SLIMTX3_RATE
                                                                                         AIF1 TX2 output           AIF2 TX2 output                                                   +
                                                                                                                                         SLIMbus TX3 output                              OUT4R output
                                                                                                                                                                SLIMTX2_RATE
                                                                                                                                         SLIMbus TX2 output
                                                                                                                                                                SLIMTX1_RATE
                                                                                     +                         +                         SLIMbus TX1 output
                                                                                         AIF1 TX1 output           AIF2 TX1 output                                                   +
                                                                                                                                                                                         OUT5L output
                                                                                                   AIF1_RATE                 AIF2_RATE
                                                                                                                                                                                     +
                                                                                                                                                                                         OUT5R output
Rev 4.1
                                                                                                                                                                                                        WM8998


                                                                                         WM8998
        The input signal paths may be selected as input to the digital mixers or signal processing functions.
        The sample rate for the input signal paths is configured using the IN_RATE register.
        The output signal paths are derived from the respective output mixers. The sample rate for the output
        signal paths is configured using the OUT_RATE register. The sample rate of the AEC Loopback path
        is also set by the OUT_RATE register.
        The AIFn RX inputs may be selected as input to the digital mixers or signal processing functions. The
        AIFn TX outputs are derived from the respective output mixers. The sample rates for digital audio
        interfaces (AIF1, AIF2 and AIF3) are configured using the AIF1_RATE, AIF2_RATE and AIF3_RATE
        registers respectively.
        The SLIMbus interface supports up to 4 input channels and 6 output channels. The sample rate of
        each channel can be configured independently, using the SLIMTXn_RATE and SLIMRXn_RATE
        registers.
        Note that the SLIMbus interface provides simultaneous support for SYSCLK-referenced and
        ASYNCCLK-referenced sample rates on different channels. For example, 48kHz and 44.1kHz
        SLIMbus audio paths can be simultaneously supported.
        The EQ, LHPF and DRC functions can be enabled in any signal path within the digital core. The
        sample rate for these functions is configured using the FX_RATE register. Note that the EQ, DRC and
        LHPF functions must all be configured for the same sample rate.
        The S/PDIF transmitter can be enabled on a GPIO pin. Stereo inputs to this function can be
        configured from any of the digital core inputs, mixers, or signal processing functions. The sample rate
        of the S/PDIF transmitter is configured using the SPD1_RATE register.
        The tone generators can be selected as input to any of the digital mixers or signal processing
        functions. The associated sample rate is configured using the TONE_RATE register.
        The haptic signal generator can be used to control an external vibe actuator, which can be driven
        directly by the Class D speaker output. The sample rate for the haptic signal generator is configured
        using the HAP_RATE register.
        The PWM signal generators can be modulated by an audio source, derived from the associated signal
        mixers. The sample rate (cycle time) for the PWM signal generators is configured using the
        PWM_RATE register.
        The sample rate control registers are described in Table 19. Refer to the register descriptions for
        details of the valid selections in each case. Note that the input (ADC) and output (DAC) signal paths
        must always be associated with the SYSCLK clocking domain; different sample rates may be selected
        concurrently, but both these rates must be synchronised to SYSCLK.
        The control registers associated with the ASRC and ISRCs are described in Table 20 and Table 21
        respectively within the following sections.
          REGISTER         BIT          LABEL          DEFAULT                     DESCRIPTION
          ADDRESS
          R32            14:11    TONE_RATE              0000       Tone Generator Sample Rate
          (0020h)                 [3:0]                             0000 = SAMPLE_RATE_1
          Tone                                                      0001 = SAMPLE_RATE_2
          Generator                                                 0010 = SAMPLE_RATE_3
          1                                                         1000 = ASYNC_SAMPLE_RATE_1
                                                                    1001 = ASYNC_SAMPLE_RATE_2
                                                                    All other codes are Reserved.
                                                                    The selected sample rate is valid in the
                                                                    range 8kHz to 192kHz.
          R48            14:11    PWM_RATE [3:0]         0000       PWM Frequency (sample rate)
          (0030h)                                                   0000 = SAMPLE_RATE_1
          PWM                                                       0001 = SAMPLE_RATE_2
          Drive 1                                                   0010 = SAMPLE_RATE_3
                                                                    1000 = ASYNC_SAMPLE_RATE_1
                                                                    1001 = ASYNC_SAMPLE_RATE_2
                                                                    All other codes are Reserved.
                                                                    The selected sample rate is valid in the
                                                                    range 8kHz to 192kHz.
                                                                    All PWMnMIX_SRCm registers should be
                                                                    set to 00h before changing PWM_RATE.
Rev 4.1                                                                                                      91


                                                                 WM8998
   REGISTER     BIT      LABEL      DEFAULT                DESCRIPTION
   ADDRESS
   R144       14:11 HAP_RATE [3:0]   0000   Haptic Signal Generator Sample Rate
   0090h)                                   0000 = SAMPLE_RATE_1
   Haptics                                  0001 = SAMPLE_RATE_2
   Control 1                                0010 = SAMPLE_RATE_3
                                            1000 = ASYNC_SAMPLE_RATE_1
                                            1001 = ASYNC_SAMPLE_RATE_2
                                            All other codes are Reserved.
                                            The selected sample rate is valid in the
                                            range 8kHz to 192kHz.
   R776       14:11 IN_RATE [3:0]    0000   Input Signal Paths Sample Rate
   (0308h)                                  0000 = SAMPLE_RATE_1
   Input Rate                               0001 = SAMPLE_RATE_2
                                            0010 = SAMPLE_RATE_3
                                            All other codes are Reserved.
                                            The selected sample rate is valid in the
                                            range 8kHz to 192kHz.
   R1032      14:11 OUT_RATE [3:0]   0000   Output Signal Paths Sample Rate
   (0408h)                                  0000 = SAMPLE_RATE_1
   Output                                   0001 = SAMPLE_RATE_2
   Rate 1                                   0010 = SAMPLE_RATE_3
                                            All other codes are Reserved.
                                            The selected sample rate is valid in the
                                            range 8kHz to 192kHz.
                                            All OUTnxMIX_SRCm registers should be
                                            set to 00h before changing OUT_RATE.
   R1283      14:11 AIF1_RATE [3:0]  0000   AIF1 Audio Interface Sample Rate
   (0503h)                                  0000 = SAMPLE_RATE_1
   AIF1 Rate                                0001 = SAMPLE_RATE_2
   Ctrl                                     0010 = SAMPLE_RATE_3
                                            1000 = ASYNC_SAMPLE_RATE_1
                                            1001 = ASYNC_SAMPLE_RATE_2
                                            All other codes are Reserved.
                                            The selected sample rate is valid in the
                                            range 8kHz to 192kHz.
                                            All AIF1TXMIX_SRCn registers should be
                                            set to 00h before changing AIF1_RATE.
   R1347      14:11 AIF2_RATE [3:0]  0000   AIF2 Audio Interface Sample Rate
   (0543h)                                  0000 = SAMPLE_RATE_1
   AIF2 Rate                                0001 = SAMPLE_RATE_2
   Ctrl                                     0010 = SAMPLE_RATE_3
                                            1000 = ASYNC_SAMPLE_RATE_1
                                            1001 = ASYNC_SAMPLE_RATE_2
                                            All other codes are Reserved.
                                            The selected sample rate is valid in the
                                            range 8kHz to 192kHz.
                                            All AIF2TXMIX_SRCn registers should be
                                            set to 00h before changing AIF2_RATE.
   R1411      14:11 AIF3_RATE [3:0]  0000   AIF3 Audio Interface Sample Rate
   (0583h)                                  0000 = SAMPLE_RATE_1
   AIF3 Rate                                0001 = SAMPLE_RATE_2
   Ctrl                                     0010 = SAMPLE_RATE_3
                                            1000 = ASYNC_SAMPLE_RATE_1
                                            1001 = ASYNC_SAMPLE_RATE_2
                                            All other codes are Reserved.
                                            The selected sample rate is valid in the
                                            range 8kHz to 192kHz.
                                            All AIF3TXMIX_SRCn registers should be
                                            set to 00h before changing AIF3_RATE.
92                                                                             Rev 4.1


                                                                  WM8998
        REGISTER   BIT       LABEL  DEFAULT                DESCRIPTION
        ADDRESS
        R1474     7:4  SPD1_RATE     0000   S/PDIF Transmitter Sample Rate
        (05C2h)        [3:0]                0000 = SAMPLE_RATE_1
        SPD1 TX                             0001 = SAMPLE_RATE_2
        Control                             0010 = SAMPLE_RATE_3
                                            All other codes are Reserved.
                                            The selected sample rate is valid in the
                                            range 32kHz to 192kHz.
                                            The SPDIF1TX1_SRC and
                                            SPDIF1TX2_SRC registers should be set
                                            to 00h before changing SPD1_RATE.
        R1509    14:11 SLIMRX2_RATE  0000   SLIMbus RX Channel 2 Sample Rate
        (05E5h)        [3:0]                0000 = SAMPLE_RATE_1
        SLIMbus                             0001 = SAMPLE_RATE_2
        Rates 1                             0010 = SAMPLE_RATE_3
                                            1000 = ASYNC_SAMPLE_RATE_1
                                            1001 = ASYNC_SAMPLE_RATE_2
                                            All other codes are Reserved.
                                            The selected sample rate is valid in the
                                            range 8kHz to 192kHz.
                  6:3  SLIMRX1_RATE  0000   SLIMbus RX Channel 1 Sample Rate
                       [3:0]                0000 = SAMPLE_RATE_1
                                            0001 = SAMPLE_RATE_2
                                            0010 = SAMPLE_RATE_3
                                            1000 = ASYNC_SAMPLE_RATE_1
                                            1001 = ASYNC_SAMPLE_RATE_2
                                            All other codes are Reserved.
                                            The selected sample rate is valid in the
                                            range 8kHz to 192kHz.
        R1510    14:11 SLIMRX4_RATE  0000   SLIMbus RX Channel 4 Sample Rate
        (05E6h)        [3:0]                0000 = SAMPLE_RATE_1
        SLIMbus                             0001 = SAMPLE_RATE_2
        Rates 2                             0010 = SAMPLE_RATE_3
                                            1000 = ASYNC_SAMPLE_RATE_1
                                            1001 = ASYNC_SAMPLE_RATE_2
                                            All other codes are Reserved.
                                            The selected sample rate is valid in the
                                            range 8kHz to 192kHz.
                  6:3  SLIMRX3_RATE  0000   SLIMbus RX Channel 3 Sample Rate
                       [3:0]                0000 = SAMPLE_RATE_1
                                            0001 = SAMPLE_RATE_2
                                            0010 = SAMPLE_RATE_3
                                            1000 = ASYNC_SAMPLE_RATE_1
                                            1001 = ASYNC_SAMPLE_RATE_2
                                            All other codes are Reserved.
                                            The selected sample rate is valid in the
                                            range 8kHz to 192kHz.
        R1513    14:11 SLIMTX2_RATE  0000   SLIMbus TX Channel 2 Sample Rate
        (05E9h)        [3:0]                0000 = SAMPLE_RATE_1
        SLIMbus                             0001 = SAMPLE_RATE_2
        Rates 5                             0010 = SAMPLE_RATE_3
                                            1000 = ASYNC_SAMPLE_RATE_1
                                            1001 = ASYNC_SAMPLE_RATE_2
                                            All other codes are Reserved.
                                            The selected sample rate is valid in the
                                            range 8kHz to 192kHz.
                                            All SLIMTX2MIX_SRCn registers should
                                            be set to 00h before changing
                                            SLIMTX2_RATE.
Rev 4.1                                                                              93


                                                             WM8998
   REGISTER   BIT       LABEL  DEFAULT                DESCRIPTION
   ADDRESS
             6:3  SLIMTX1_RATE  0000   SLIMbus TX Channel 1 Sample Rate
                  [3:0]                0000 = SAMPLE_RATE_1
                                       0001 = SAMPLE_RATE_2
                                       0010 = SAMPLE_RATE_3
                                       1000 = ASYNC_SAMPLE_RATE_1
                                       1001 = ASYNC_SAMPLE_RATE_2
                                       All other codes are Reserved.
                                       The selected sample rate is valid in the
                                       range 8kHz to 192kHz.
                                       All SLIMTX1MIX_SRCn registers should
                                       be set to 00h before changing
                                       SLIMTX1_RATE.
   R1514    14:11 SLIMTX4_RATE  0000   SLIMbus TX Channel 4 Sample Rate
   (05EAh)        [3:0]                0000 = SAMPLE_RATE_1
   SLIMbus                             0001 = SAMPLE_RATE_2
   Rates 6                             0010 = SAMPLE_RATE_3
                                       1000 = ASYNC_SAMPLE_RATE_1
                                       1001 = ASYNC_SAMPLE_RATE_2
                                       All other codes are Reserved.
                                       The selected sample rate is valid in the
                                       range 8kHz to 192kHz.
                                       All SLIMTX4MIX_SRCn registers should
                                       be set to 00h before changing
                                       SLIMTX4_RATE.
             6:3  SLIMTX3_RATE  0000   SLIMbus TX Channel 3 Sample Rate
                  [3:0]                0000 = SAMPLE_RATE_1
                                       0001 = SAMPLE_RATE_2
                                       0010 = SAMPLE_RATE_3
                                       1000 = ASYNC_SAMPLE_RATE_1
                                       1001 = ASYNC_SAMPLE_RATE_2
                                       All other codes are Reserved.
                                       The selected sample rate is valid in the
                                       range 8kHz to 192kHz.
                                       All SLIMTX3MIX_SRCn registers should
                                       be set to 00h before changing
                                       SLIMTX3_RATE.
   R1515    14:11 SLIMTX6_RATE  0000   SLIMbus TX Channel 6 Sample Rate
   (05EBh)        [3:0]                0000 = SAMPLE_RATE_1
   SLIMbus                             0001 = SAMPLE_RATE_2
   Rates 7                             0010 = SAMPLE_RATE_3
                                       1000 = ASYNC_SAMPLE_RATE_1
                                       1001 = ASYNC_SAMPLE_RATE_2
                                       All other codes are Reserved.
                                       The selected sample rate is valid in the
                                       range 8kHz to 192kHz.
                                       All SLIMTX6MIX_SRCn registers should
                                       be set to 00h before changing
                                       SLIMTX6_RATE.
94                                                                        Rev 4.1


                                                                               WM8998
         REGISTER       BIT         LABEL        DEFAULT                DESCRIPTION
         ADDRESS
                       6:3    SLIMTX5_RATE        0000   SLIMbus TX Channel 5 Sample Rate
                              [3:0]                      0000 = SAMPLE_RATE_1
                                                         0001 = SAMPLE_RATE_2
                                                         0010 = SAMPLE_RATE_3
                                                         1000 = ASYNC_SAMPLE_RATE_1
                                                         1001 = ASYNC_SAMPLE_RATE_2
                                                         All other codes are Reserved.
                                                         The selected sample rate is valid in the
                                                         range 8kHz to 192kHz.
                                                         All SLIMTX5MIX_SRCn registers should
                                                         be set to 00h before changing
                                                         SLIMTX5_RATE.
         R3584        14:11   FX_RATE [3:0]       0000   FX Sample Rate (EQ, LHPF, DRC)
         (0E00h)                                         0000 = SAMPLE_RATE_1
         FX_Ctrl                                         0001 = SAMPLE_RATE_2
                                                         0010 = SAMPLE_RATE_3
                                                         1000 = ASYNC_SAMPLE_RATE_1
                                                         1001 = ASYNC_SAMPLE_RATE_2
                                                         All other codes are Reserved.
                                                         The selected sample rate is valid in the
                                                         range 8kHz to 192kHz.
                                                         All EQnMIX_SRCm, DRC1xMIX_SRCm,
                                                         and LHPFnMIX_SRCm registers should
                                                         be set to 00h before changing FX_RATE.
        Table 19 Digital Core Sample Rate Control
Rev 4.1                                                                                           95


                                                                                     WM8998
   ASYNCHRONOUS SAMPLE RATE CONVERTER (ASRC)
   The WM8998 supports multiple signal paths through the digital core. Two independent clock domains
   are supported, referenced to SYSCLK and ASYNCCLK respectively, as described in “Clocking and
   Sample Rates”. Every digital signal path must be synchronised either to SYSCLK or to ASYNCCLK.
   The Asynchronous Sample Rate Converter (ASRC) provides two stereo signal paths between the
   SYSCLK and ASYNCCLK domains, as illustrated in Figure 35.
   The sample rate on the SYSCLK domain is selected using the ASRC_RATE1 register - the rate can
   be set equal to SAMPLE_RATE_1, SAMPLE_RATE_2 or SAMPLE_RATE_3.
   The sample rate on the ASYNCCLK domain is selected using the ASRC_RATE2 register - the rate
   can be set equal to ASYNC_SAMPLE_RATE_1 or ASYNC_SAMPLE_RATE_2.
   See “Clocking and Sample Rates” for details of the sample rate control registers.
   The ASRC_RATE1 and ASRC_RATE2 registers should not be changed if any of the respective
   *_SRCn registers is non-zero. The associated *_SRCn registers should be cleared to 00h before
   writing new values to ASRC_RATE1 or ASRC_RATE2. A minimum delay of 125µs should be allowed
   between clearing the *_SRCn registers and writing to the associated ASRC_RATE1 or ASRC_RATE2
   registers. See Table 20 for further details.
   The ASRC supports sample rates 11.025kHz, 12kHz, 22.05kHz, 24kHz, 44.1kHz and 48kHz only.
   The applicable SAMPLE_RATE_n and ASYNC_SAMPLE_RATE_n registers must each select one of
   these valid sample rates.
   The ASRC1 Left and ASRC1 Right paths convert from the SYSCLK domain to the ASYNCCLK
   domain. These paths are enabled using the ASRC1L_ENA and ASRC1R_ENA register bits
   respectively.
   The ASRC2 Left and ASRC2 Right paths convert from the ASYNCCLK domain to the SYSCLK
   domain. These paths are enabled using the ASRC2L_ENA and ASRC2R_ENA register bits
   respectively.
   Synchronisation (lock) between different clock domains is not instantaneous when the clocking or
   sample rate configurations are updated. The lock status of each ASRC path is an input to the Interrupt
   control circuit and can be used to trigger an Interrupt event - see “Interrupts”.
   The ASRC Lock status of each ASRC path can be output directly on a GPIO pin as an external
   indication of ASRC Lock. See “General Purpose Input / Output” to configure a GPIO pin for this
   function.
   The WM8998 performs automatic checks to confirm that the SYSCLK or ASYNCCLK frequency is
   high enough to support the commanded ASRC and digital mixing functions. If an attempt is made to
   enable an ASRC signal path, and there are insufficient SYSCLK or ASYNCCLK cycles to support it,
   then the attempt will be unsuccessful. (Note that any signal paths that are already active will not be
   affected under these circumstances.)
   The Underclocked Error can be monitored using the GPIO and/or Interrupt functions. See “General
   Purpose Input / Output” and “Interrupts” for further details.
   The status bits in Register R3809 indicate the status of each of the ASRC signal paths. If an
   Underclocked Error condition occurs, then these bits provide readback of which ASRC signal path(s)
   have been successfully enabled.
   The status bits in Registers R1600 to R2920 indicate the status of each of the digital mixers. If an
   Underclocked Error condition occurs, then these bits provide readback of which mixer(s) have been
   successfully enabled.
   The Asynchronous Sample Rate Converter (ASRC) signal paths and control registers are illustrated in
   Figure 35.
96                                                                                            Rev 4.1


                                                                                                              WM8998
          The ASRC provides asynchronous conversion between the SYSCLK and ASYNCCLK CLOCK domains.
          ASRC_RATE1 identifies the SYSCLK-related sample rate (SAMPLE_RATE_n).
          ASRC_RATE2 identifies the ASYNCCLK-related sample rate (ASYNC_SAMPLE_RATE_n).
                                           ASRC_RATE1                   ASRC_RATE2
                                    (= SAMPLE_RATE_n)                   (= ASYNC_SAMPLE_RATE_n)
                        ASRC1L_SRC                                                                 ASRC1 Left (90h)
                                                                            ASRC1L_ENA
                       ASRC1R_SRC                                                               ASRC1 Right (91h)
                                                                            ASRC1R_ENA
          ASRC2 Left (92h)                                                             ASRC2L_SRC
                                        ASRC2L_ENA
          ASRC2 Right (93h)                                                            ASRC2R_SRC
                                        ASRC2R_ENA
        Figure 35 Asynchronous Sample Rate Converters (ASRCs)
        The ASRC1 and ASRC2 input control registers (see Figure 35) are located at register addresses
        R2688 (A80h) through to R2712 (A98h).
        The full list of digital mixer control registers is provided in the “Register Map” section (Register R1600
        through to R2920). Generic register definitions are provided in Table 7.
        The *_SRCn registers select the input source(s) for the respective ASRC processing blocks. Note that
        the selected input source(s) must be configured for the same sample rate as the ASRC to which they
        are connected.
        The bracketed numbers in Figure 35, eg. “(90h)” indicate the corresponding *_SRCn register setting
        for selection of that signal as an input to another digital core function.
        The register bits associated with the ASRCs are described in Table 20.
          REGISTER             BIT              LABEL                DEFAULT                         DESCRIPTION
          ADDRESS
          R3808                3        ASRC2L_ENA                        0        ASRC2 Left Enable
          (0EE0h)                                                                  (Left ASRC channel from ASYNCCLK
          ASRC_EN                                                                  domain to SYSCLK domain)
          ABLE                                                                     0 = Disabled
                                                                                   1 = Enabled
                               2        ASRC2R_ENA                        0        ASRC2 Right Enable
                                                                                   (Right ASRC channel from ASYNCCLK
                                                                                   domain to SYSCLK domain)
                                                                                   0 = Disabled
                                                                                   1 = Enabled
                               1        ASRC1L_ENA                        0        ASRC1 Left Enable
                                                                                   (Left ASRC channel from ASYNCCLK
                                                                                   domain to SYSCLK domain)
                                                                                   0 = Disabled
                                                                                   1 = Enabled
Rev 4.1                                                                                                              97


                                                                   WM8998
    REGISTER       BIT         LABEL  DEFAULT               DESCRIPTION
    ADDRESS
                   0     ASRC1R_ENA     0     ASRC1 Right Enable
                                              (Right ASRC channel from ASYNCCLK
                                              domain to SYSCLK domain)
                                              0 = Disabled
                                              1 = Enabled
    R3809          3     ASRC2L_ENA_S   0     ASRC2 Left Enable Status
    (0EE1h)              TS                   (Left ASRC channel from ASYNCCLK
    ASRC_ST                                   domain to SYSCLK domain)
    ATUS                                      0 = Disabled
                                              1 = Enabled
                   2     ASRC2R_ENA_S   0     ASRC2 Right Enable Status
                         TS                   (Right ASRC channel from ASYNCCLK
                                              domain to SYSCLK domain)
                                              0 = Disabled
                                              1 = Enabled
                   1     ASRC1L_ENA_S   0     ASRC1 Left Enable Status
                         TS                   (Left ASRC channel from ASYNCCLK
                                              domain to SYSCLK domain)
                                              0 = Disabled
                                              1 = Enabled
                   0     ASRC1R_ENA_S   0     ASRC1 Right Enable Status
                         TS                   (Right ASRC channel from ASYNCCLK
                                              domain to SYSCLK domain)
                                              0 = Disabled
                                              1 = Enabled
    R3810        14:11   ASRC_RATE1    0000   ASRC Sample Rate select for SYSCLK
    (0EE2h)              [3:0]                domain
    ASRC_RA                                   0000 = SAMPLE_RATE_1
    TE1                                       0001 = SAMPLE_RATE_2
                                              0010 = SAMPLE_RATE_3
                                              All other codes are Reserved.
                                              The selected sample rate is valid for
                                              11.025kHz, 12kHz, 22.05kHz, 24kHz,
                                              44.1kHz and 48kHz only.
                                              The ASRC_IN1L_SRC and
                                              ASRC_IN1R_SRC registers should be set
                                              to 00h before ASRC_RATE1.
    R3811        14:11   ASRC_RATE2    1000   ASRC Sample Rate select for
    (0EE3h)              [3:0]                ASYNCCLK domain
    ASRC_RA                                   1000 = ASYNC_SAMPLE_RATE_1
    TE2                                       1001 = ASYNC_SAMPLE_RATE_2
                                              All other codes are Reserved.
                                              The selected sample rate is valid for
                                              11.025kHz, 12kHz, 22.05kHz, 24kHz,
                                              44.1kHz and 48kHz only.
                                              The ASRC_IN2L_SRC and
                                              ASRC_IN2R_SRC registers should be set
                                              to 00h before ASRC_RATE2.
   Table 20 Digital Core ASRC Control
98                                                                               Rev 4.1


                                                                                          WM8998
        ISOCHRONOUS SAMPLE RATE CONVERTER (ISRC)
        The WM8998 supports multiple signal paths through the digital core. The Isochronous Sample Rate
        Converters (ISRCs) provide sample rate conversion between synchronised sample rates on the
        SYSCLK clock domain, or between synchronised sample rates on the ASYNCCLK clock domain.
        There are two Isochronous Sample Rate Converters (ISRCs). ISRC1 provides four signal paths
        between two different sample rates; ISRC2 provides two signal paths between two different sample
        rates, as illustrated in Figure 36.
        The sample rates associated with each ISRC can be set independently. Note that the two sample
        rates associated with any single ISRC must both be referenced to the same clock domain (SYSCLK
        or ASYNCCLK).
        When an ISRC is used on the SYSCLK domain, then the associated sample rates may be selected
        from SAMPLE_RATE_1, SAMPLE_RATE_2 or SAMPLE_RATE_3.
        When an ISRC is used on the ASYNCCLK domain, then the associated sample rates are
        ASYNC_SAMPLE_RATE_1 and ASYNC_SAMPLE_RATE_2.
        See “Clocking and Sample Rates” for details of the sample rate control registers.
        Each ISRC supports sample rates in the range 8kHz to 192kHz. The higher of the sample rates
        associated with each ISRC must be an integer multiple of the lower sample rate; integer ratios in the
        range 1 to 6 are supported on ISRC1; integer ratios in the range 1 to 24 are supported on ISRC2.
        Each ISRC converts between a sample rate selected by ISRCn_FSL and a sample rate selected by
        ISRCn_FSH, (where ‘n’ identifies the applicable ISRC 1 or 2). Note that, in each case, the higher of
        the two sample rates must be selected by ISRCn_FSH.
        The ISRCn_FSL and ISRCn_FSH registers should not be changed if any of the respective *_SRCn
        registers is non-zero. The associated *_SRCn registers should be cleared to 00h before writing new
        values to ISRCn_FSL or ISRCn_FSH. A minimum delay of 125µs should be allowed between clearing
        the *_SRCn registers and writing to the associated ISRCn_FSL or ISRCn_FSH registers. See Table
        21 for further details.
        The ISRCn ‘interpolation’ paths (increasing sample rate) are enabled using the ISRCn_INTm_ENA
        register bits, (where ‘m’ identifies the applicable channel).
        The ISRCn ‘decimation’ paths (decreasing sample rate) are enabled using the ISRCn_DECm_ENA
        register bits.
        A notch filter is provided in each of the ISRC paths; these are enabled using the
        ISRCn_NOTCH_ENA bits. The filter is configured automatically according to the applicable sample
        rate(s). It is recommended to enable the filter for typical applications. Disabling the filter will provide
        maximum ‘pass’ bandwidth, at the expense of degraded stopband attenuation.
        The WM8998 performs automatic checks to confirm that the SYSCLK frequency is high enough to
        support the commanded ISRC and digital mixing functions. If an attempt is made to enable an ISRC
        signal path, and there are insufficient SYSCLK cycles to support it, then the attempt will be
        unsuccessful. (Note that any signal paths that are already active will not be affected under these
        circumstances.)
        The Underclocked Error condition can be monitored using the GPIO and/or Interrupt functions. See
        “General Purpose Input / Output” and “Interrupts” for further details.
        The status bits in Registers R1600 to R2920 indicate the status of each of the digital mixers. If an
        Underclocked Error condition occurs, then these bits provide readback of which mixer(s) have been
        successfully enabled.
        The Isochronous Sample Rate Converter (ISRC) signal paths and control registers are illustrated in
        Figure 36.
Rev 4.1                                                                                                         99


                                                                                                     WM8998
      The ISRC provides synchronous conversion between two sample rates on either the SYSCLK or ASYNCCLK domain.
      ISRCn_FSL identifies the lower of the two sample rates.
      ISRCn_FSH identifies the higher of the two sample rates.
      Both sample rates must be referenced to the same clock domain (SYSCLK or ASYNCCLK).
                                              ISRC1_FSL                 ISRC1_FSH
                  ISRC1INT1_SRC                                                                      ISRC1 INT1 (A0h)
                                                                           ISRC1_INT1_ENA
                  ISRC1INT2_SRC                                                                      ISRC1 INT2 (A1h)
                                                                           ISRC1_INT2_ENA
                  ISRC1INT3_SRC                                                                      ISRC1 INT3 (A2h)
                                                                           ISRC1_INT3_ENA
                  ISRC1INT4_SRC                                                                      ISRC1 INT4 (A3h)
                                                                           ISRC1_INT4_ENA
     ISRC1 DEC1 (A4h)                                                                     ISRC1DEC1_SRC
                                    ISRC1_DEC1_ENA
     ISRC1 DEC2 (A5h)                                                                     ISRC1DEC2_SRC
                                    ISRC1_DEC2_ENA
     ISRC1 DEC3 (A6h)                                                                     ISRC1DEC3_SRC
                                    ISRC1_DEC3_ENA
     ISRC1 DEC4 (A7h)                                                                     ISRC1DEC4_SRC
                                    ISRC1_DEC4_ENA
                                              ISRC2_FSL                 ISRC2_FSH
                  ISRC2INT1_SRC                                                                      ISRC2 INT1 (A8h)
                                                                           ISRC2_INT1_ENA
                  ISRC2INT2_SRC                                                                      ISRC2 INT2 (A9h)
                                                                           ISRC2_INT2_ENA
     ISRC2 DEC1 (ACh)                                                                     ISRC2DEC1_SRC
                                    ISRC2_DEC1_ENA
     ISRC2 DEC2 (ADh)                                                                     ISRC2DEC2_SRC
                                    ISRC2_DEC2_ENA
    Figure 36 Isochronous Sample Rate Converters (ISRCs)
100                                                                                                               Rev 4.1


                                                                                              WM8998
        The ISRC input control registers (see Figure 36) are located at register addresses R2816 (B00h)
        through to R2920 (0B68h).
        The full list of digital mixer control registers is provided in the “Register Map” section (Register R1600
        through to R2920). Generic register definitions are provided in Table 7.
        The *_SRC registers select the input source(s) for the respective ISRC processing blocks. Note that
        the selected input source(s) must be configured for the same sample rate as the ISRC to which they
        are connected.
        The bracketed numbers in Figure 36, eg. “(A4h)” indicate the corresponding *_SRC register setting for
        selection of that signal as an input to another digital core function.
        The register bits associated with the ISRCs are described in Table 21.
          REGISTER          BIT          LABEL             DEFAULT                     DESCRIPTION
          ADDRESS
          R3824           14:11    ISRC1_FSH [3:0]           0000       ISRC1 High Sample Rate
          (0EF0h)                                                       (Sets the higher of the ISRC1 sample
          ISRC 1                                                        rates)
          CTRL 1                                                        0000 = SAMPLE_RATE_1
                                                                        0001 = SAMPLE_RATE_2
                                                                        0010 = SAMPLE_RATE_3
                                                                        1000 = ASYNC_SAMPLE_RATE_1
                                                                        1001 = ASYNC_SAMPLE_RATE_2
                                                                        All other codes are Reserved.
                                                                        The selected sample rate is valid in the
                                                                        range 8kHz to 192kHz.
                                                                        The ISRC1_FSH and ISRC1_FSL fields
                                                                        must both select sample rates referenced
                                                                        to the same clock domain (SYSCLK or
                                                                        ASYNCCLK).
                                                                        All ISRC1_DECn_SRC registers should
                                                                        be set to 00h before changing
                                                                        ISRC1_FSH.
          R3825           14:11    ISRC1_FSL [3:0]           0000       ISRC1 Low Sample Rate
          (0EF1h)                                                       (Sets the lower of the ISRC1 sample
          ISRC 1                                                        rates)
          CTRL 2                                                        0000 = SAMPLE_RATE_1
                                                                        0001 = SAMPLE_RATE_2
                                                                        0010 = SAMPLE_RATE_3
                                                                        1000 = ASYNC_SAMPLE_RATE_1
                                                                        1001 = ASYNC_SAMPLE_RATE_2
                                                                        All other codes are Reserved.
                                                                        The selected sample rate is valid in the
                                                                        range 8kHz to 192kHz.
                                                                        The ISRC1_FSH and ISRC1_FSL fields
                                                                        must both select sample rates referenced
                                                                        to the same clock domain (SYSCLK or
                                                                        ASYNCCLK).
                                                                        All ISRC1_INTn_SRC registers should be
                                                                        set to 00h before changing ISRC1_FSL.
          R3826             15     ISRC1_INT1_EN               0        ISRC1 INT1 Enable
          (0EF2h)                  A                                    (Interpolation Channel 1 path from
          ISRC 1                                                        ISRC1_FSL rate to ISRC1_FSH rate)
          CTRL 3                                                        0 = Disabled
                                                                        1 = Enabled
                            14     ISRC1_INT2_EN               0        ISRC1 INT2 Enable
                                   A                                    (Interpolation Channel 2 path from
                                                                        ISRC1_FSL rate to ISRC1_FSH rate)
                                                                        0 = Disabled
                                                                        1 = Enabled
Rev 4.1                                                                                                          101


                                                                    WM8998
    REGISTER   BIT      LABEL      DEFAULT                  DESCRIPTION
    ADDRESS
              13   ISRC1_INT3_EN     0     ISRC1 INT3 Enable
                   A                       (Interpolation Channel 3 path from
                                           ISRC1_FSL rate to ISRC1_FSH rate)
                                           0 = Disabled
                                           1 = Enabled
              12   ISRC1_INT4_EN     0     ISRC1 INT4 Enable
                   A                       (Interpolation Channel 4 path from
                                           ISRC1_FSL rate to ISRC1_FSH rate)
                                           0 = Disabled
                                           1 = Enabled
               9   ISRC1_DEC1_EN     0     ISRC1 DEC1 Enable
                   A                       (Decimation Channel 1 path from
                                           ISRC1_FSH rate to ISRC1_FSL rate)
                                           0 = Disabled
                                           1 = Enabled
               8   ISRC1_DEC2_EN     0     ISRC1 DEC2 Enable
                   A                       (Decimation Channel 2 path from
                                           ISRC1_FSH rate to ISRC1_FSL rate)
                                           0 = Disabled
                                           1 = Enabled
               7   ISRC1_DEC3_EN     0     ISRC1 DEC3 Enable
                   A                       (Decimation Channel 3 path from
                                           ISRC1_FSH rate to ISRC1_FSL rate)
                                           0 = Disabled
                                           1 = Enabled
               6   ISRC1_DEC4_EN     0     ISRC1 DEC4 Enable
                   A                       (Decimation Channel 4 path from
                                           ISRC1_FSH rate to ISRC1_FSL rate)
                                           0 = Disabled
                                           1 = Enabled
               0   ISRC1_NOTCH_      0     ISRC1 Notch Filter Enable
                   ENA                     0 = Disabled
                                           1 = Enabled
                                           It is recommended to enable the notch
                                           filter for typical applications.
    R3827    14:11 ISRC2_FSH [3:0]  0000   ISRC2 High Sample Rate
    (0EF3h)                                (Sets the higher of the ISRC2 sample
    ISRC 2                                 rates)
    CTRL 1                                 0000 = SAMPLE_RATE_1
                                           0001 = SAMPLE_RATE_2
                                           0010 = SAMPLE_RATE_3
                                           1000 = ASYNC_SAMPLE_RATE_1
                                           1001 = ASYNC_SAMPLE_RATE_2
                                           All other codes are Reserved.
                                           The selected sample rate is valid in the
                                           range 8kHz to 192kHz.
                                           The ISRC2_FSH and ISRC2_FSL fields
                                           must both select sample rates referenced
                                           to the same clock domain (SYSCLK or
                                           ASYNCCLK).
                                           All ISRC2_DECn_SRC registers should
                                           be set to 00h before changing
                                           ISRC2_FSH.
102                                                                           Rev 4.1


                                                                               WM8998
         REGISTER       BIT        LABEL      DEFAULT                  DESCRIPTION
         ADDRESS
         R3828        14:11   ISRC2_FSL [3:0]  0000   ISRC2 Low Sample Rate
         (0EF4h)                                      (Sets the lower of the ISRC2 sample
         ISRC 2                                       rates)
         CTRL 2                                       0000 = SAMPLE_RATE_1
                                                      0001 = SAMPLE_RATE_2
                                                      0010 = SAMPLE_RATE_3
                                                      1000 = ASYNC_SAMPLE_RATE_1
                                                      1001 = ASYNC_SAMPLE_RATE_2
                                                      All other codes are Reserved.
                                                      The selected sample rate is valid in the
                                                      range 8kHz to 192kHz.
                                                      The ISRC2_FSH and ISRC2_FSL fields
                                                      must both select sample rates referenced
                                                      to the same clock domain (SYSCLK or
                                                      ASYNCCLK).
                                                      All ISRC2_INTn_SRC registers should be
                                                      set to 00h before changing ISRC2_FSL.
         R3829         15     ISRC2_INT1_EN     0     ISRC2 INT1 Enable
         (0EF5h)              A                       (Interpolation Channel 1 path from
         ISRC 2                                       ISRC2_FSL rate to ISRC2_FSH rate)
         CTRL 3                                       0 = Disabled
                                                      1 = Enabled
                       14     ISRC2_INT2_EN     0     ISRC2 INT2 Enable
                              A                       (Interpolation Channel 2 path from
                                                      ISRC2_FSL rate to ISRC2_FSH rate)
                                                      0 = Disabled
                                                      1 = Enabled
                        9     ISRC2_DEC1_EN     0     ISRC2 DEC1 Enable
                              A                       (Decimation Channel 1 path from
                                                      ISRC2_FSH rate to ISRC2_FSL rate)
                                                      0 = Disabled
                                                      1 = Enabled
                        8     ISRC2_DEC2_EN     0     ISRC2 DEC2 Enable
                              A                       (Decimation Channel 2 path from
                                                      ISRC2_FSH rate to ISRC2_FSL rate)
                                                      0 = Disabled
                                                      1 = Enabled
                        0     ISRC2_NOTCH_      0     ISRC2 Notch Filter Enable
                              ENA                     0 = Disabled
                                                      1 = Enabled
                                                      It is recommended to enable the notch
                                                      filter for typical applications.
        Table 21 Digital Core ISRC Control
Rev 4.1                                                                                        103


                                                                                                       WM8998
DIGITAL AUDIO INTERFACE
                 The WM8998 provides three audio interfaces, AIF1, AFI2 and AIF3. Each of these is independently
                 configurable on the respective transmit (TX) and receive (RX) paths. AIF1 and AIF2 support up to 6
                 channels of input and output signal paths each; AIF3 supports up to 2 channels of input and output
                 signal paths.
                 The data source(s) for the audio interface transmit (TX) paths can be selected from any of the
                 WM8998 input signal paths, or from the digital core processing functions. The audio interface receive
                 (RX) paths can be selected as inputs to any of the digital core processing functions or digital core
                 outputs. See “Digital Core” for details of the digital core routing options.
                 The digital audio interfaces provide flexible connectivity for multiple processors and other audio
                 devices. Typical connections include Applications Processor, Baseband Processor and Wireless
                 Transceiver. Note that the SLIMbus interface also provides digital audio input/output paths, providing
                 options for additional interfaces. A typical configuration is illustrated in Figure 37.
                 The audio interfaces AIF1, AIF2 and AIF3 are referenced to DBVDD1, DBVDD2 and DBVDD3
                 respectively, allowing the WM8998 to connect between application sub-systems on different voltage
                 domains.
                    Applications
                                                SLIMbus interface
                      Processor
                         HDMI
                                                Audio Interface 1
                        Device
                      Baseband
                                                Audio Interface 2
                      Processor
                       Wireless
                                                Audio Interface 3
                     Transceiver
                                                                  WM8998
                 Figure 37 Typical AIF Connections
                 In the general case, the digital audio interface uses four pins:
                           TXDAT: Data output
                           RXDAT: Data input
                           BCLK: Bit clock, for synchronisation
                           LRCLK: Left/Right data alignment clock
                 In master interface mode, the clock signals BCLK and LRCLK are outputs from the WM8998. In slave
                 mode, these signals are inputs, as illustrated below.
104                                                                                                          Rev 4.1


                                                                                             WM8998
        Four different audio data formats are supported by the digital audio interface:
                   DSP mode A
                   DSP mode B
                   I2S
                   Left Justified
        The Left Justified and DSP-B modes are valid in Master mode only (ie. BCLK and LRCLK are outputs
        from the WM8998). These modes cannot be supported in Slave mode.
        All four of these modes are MSB first. Data words are encoded in 2’s complement format. Each of the
        audio interface modes is described in the following sections. Refer to the “Signal Timing
        Requirements” section for timing information.
        Two variants of DSP mode are supported - ‘Mode A’ and ‘Mode B’. Mono PCM operation can be
        supported using the DSP modes.
        MASTER AND SLAVE MODE OPERATION
        The WM8998 digital audio interfaces can operate as a master or slave as shown in Figure 38 and
        Figure 39. The associated control bits are described in “Digital Audio Interface Control”.
                          BCLK                                                    BCLK
                          LRCLK
                                                                                  LRCLK
               WM8998     TXDAT                  Processor              WM8998                           Processor
                                                                                  TXDAT
                          RXDAT
                                                                                  RXDAT
        Figure 38 Master Mode                                     Figure 39 Slave Mode
        AUDIO DATA FORMATS
        The WM8998 digital audio interfaces can be configured to operate in I2S, Left-Justified, DSP-A or
        DSP-B interface modes. Note that Left-Justified and DSP-B modes are valid in Master mode only (ie.
        BCLK and LRCLK are outputs from the WM8998).
        The digital audio interfaces also provide flexibility to support multiple ‘slots’ of audio data within each
        LRCLK frame. This flexibility allows multiple audio channels to be supported within a single LRCLK
        frame.
        The data formats described in this section are generic descriptions, assuming only one stereo pair of
        audio samples per LRCLK frame. In these cases, the AIF is configured to transmit (or receive) in the
        first available position in each frame (ie. the Slot 0 position).
        The options for multi-channel operation are described in the following section (“AIF Timeslot
        Configuration”).
        The audio data modes supported by the WM8998 are described below. Note that the polarity of the
        BCLK and LRCLK signals can be inverted if required; the following descriptions all assume the
        default, non-inverted polarity of these signals.
Rev 4.1                                                                                                        105


                                                                                                                                       WM8998
    In DSP mode, the left channel MSB is available on either the 1st (mode B) or 2nd (mode A) rising edge
    of BCLK following a rising edge of LRCLK. Right channel data immediately follows left channel data.
    Depending on word length, BCLK frequency and sample rate, there may be unused BCLK cycles
    between the LSB of the right channel data and the next sample.
    In master mode, the LRCLK output will resemble the frame pulse shown in Figure 40 and Figure 41.
    In slave mode, it is possible to use any length of frame pulse less than 1/fs, providing the falling edge
    of the frame pulse occurs at least one BCLK period before the rising edge of the next frame pulse.
                                                                                            1/fs
          LRCLK                                               In Slave mode, the falling edge can occur anywhere in this area
                             1 BCLK                                                                                                          1 BCLK
           BCLK
                                           LEFT CHANNEL                                          RIGHT CHANNEL
         RXDAT/
                              1   2      3                      n-2   n-1    n     1      2      3                    n-2    n-1 n
          TXDAT
                            MSB                                           LSB
                                          Input Word Length (WL)
    Figure 40 DSP Mode A Data Format
                                                                                            1/fs
          LRCLK                                               In Slave mode, the falling edge can occur anywhere in this area
                             1 BCLK                                                                                                          1 BCLK
           BCLK
                                    LEFT CHANNEL                                          RIGHT CHANNEL
         RXDAT/
                          1   2   3                      n-2    n-1    n     1     2      3                    n-2    n-1     n
          TXDAT
                         MSB                                        LSB
                                   Input Word Length (WL)
    Figure 41 DSP Mode B Data Format
    PCM operation is supported in DSP interface mode. WM8998 data that is output on the Left Channel
    will be read as mono PCM data by the receiving equipment. Mono PCM data received by the
    WM8998 will be treated as Left Channel data. This data may be routed to the Left/Right playback
    paths using the control fields described in the “Digital Core” section.
    In I2S mode, the MSB is available on the second rising edge of BCLK following a LRCLK transition.
    The other bits up to the LSB are then transmitted in order. Depending on word length, BCLK
    frequency and sample rate, there may be unused BCLK cycles between the LSB of one sample and
    the MSB of the next.
                                                                                           1/fs
                                             LEFT CHANNEL                                                           RIGHT CHANNEL
          LRCLK
           BCLK
                             1 BCLK                                                                 1 BCLK
         RXDAT/
                              1   2      3                     n-2   n-1    n                        1     2     3                 n-2 n-1 n
          TXDAT
                            MSB                                           LSB
                                             Input Word Length (WL)
    Figure 42 I2S Data Format (assuming n-bit word length)
106                                                                                                                                          Rev 4.1


                                                                                                 WM8998
        In Left Justified mode, the MSB is available on the first rising edge of BCLK following a LRCLK
        transition. The other bits up to the LSB are then transmitted in order. Depending on word length,
        BCLK frequency and sample rate, there may be unused BCLK cycles before each LRCLK transition.
                                                                      1/fs
                                             LEFT CHANNEL                        RIGHT CHANNEL
              LRCLK
               BCLK
             RXDAT/
                              1   2  3                   n-2  n-1   n      1 2 3         n-2 n-1 n
              TXDAT
                             MSB                                  LSB
                                       Input Word Length (WL)
        Figure 43 Left Justified Data Format (assuming n-bit word length)
        AIF TIMESLOT CONFIGURATION
        Digital audio interfaces AIF1 and AIF2 supports multi-channel operation; up to 6 input (RX) channels
        and 6 output (TX) channels can be supported simultaneously. A high degree of flexibility is provided to
        define the position of the audio samples within each LRCLK frame; the audio channel samples may
        be arranged in any order within the frame.
        AIF3 also provides flexible configuration options, but supports only 1 stereo input and 1 stereo output
        pair.
        Note that, on each interface, all input and output channels must operate at the same sample rate (fs).
        Each of the audio channels can be enabled or disabled independently on the transmit (TX) and
        receive (RX) signal paths. For each enabled channel, the audio samples are assigned to one timeslot
        within the LRCLK frame.
        In DSP modes, the timeslots are ordered consecutively from the start of the LRCLK frame. In I2S and
        Left-Justified modes, the even-numbered timeslots are arranged in the first half of the LRCLK frame,
        and the odd-numbered timeslots are arranged in the second half of the frame.
        The timeslots are assigned independently for the transmit (TX) and receive (RX) signal paths. There
        is no requirement to assign every available timeslot to an audio sample; some slots may be unused, if
        desired. Care is required, however, to ensure that no timeslot is allocated to more than one audio
        channel.
        The number of BCLK cycles within a slot is configurable; this is the Slot Length. The number of valid
        data bits within a slot is also configurable; this is the Word Length. The number of BCLK cycles per
        LRCLK frame must be configured; it must be ensured that there are enough BCLK cycles within each
        LRCLK frame to transmit or receive all of the enabled audio channels.
        Examples of the AIF Timeslot Configurations are illustrated in Figure 44 to Figure 47. One example is
        shown for each of the four possible data formats.
Rev 4.1                                                                                                   107


                                                                                                     WM8998
    Figure 44 shows an example of DSP Mode A format. Four enabled audio channels are shown,
    allocated to timeslots 0 through to 3.
         LRCLK
          BCLK
        TXDAT/
                       Slot 0   Slot 1   Slot 2   Slot 3   Slot 4  Slot 5   Slot 6   Slot 7      ...
         RXDAT
        Channel 1      Slot 0  AIF1[TX1/RX1]_SLOT = 0
        Channel 2               Slot 1  AIF1[TX2/RX2]_SLOT = 1
        Channel 3                        Slot 2  AIF1[TX3/RX3]_SLOT = 2
        Channel 4                                 Slot 3  AIF1[TX4/RX4]_SLOT = 3
    Figure 44 DSP Mode A Example
    Figure 45 shows an example of DSP Mode B format. Six enabled audio channels are shown, with
    timeslots 4 and 5 unused.
         LRCLK
          BCLK
        TXDAT/
                     Slot 0   Slot 1   Slot 2   Slot 3   Slot 4   Slot 5  Slot 6   Slot 7      ...
         RXDAT
        Channel 1                      Slot 2   AIF1[TX1/RX1]_SLOT = 2
        Channel 2                               Slot 3   AIF1[TX2/RX2]_SLOT = 3
        Channel 3    Slot 0   AIF1[TX3/RX3]_SLOT = 0
        Channel 4             Slot 1   AIF1[TX4/RX4]_SLOT = 1
        Channel 5                                                         Slot 6   AIF1[TX5/RX5]_SLOT = 6
        Channel 6                                                                  Slot 7   AIF1[TX6/RX6]_SLOT = 7
    Figure 45 DSP Mode B Example
108                                                                                                                Rev 4.1


                                                                                                            WM8998
        Figure 46 shows an example of I2S format. Four enabled channels are shown, allocated to timeslots 0
        through to 3.
              LRCLK
               BCLK
             TXDAT/
                          Slot 0   Slot 2   Slot 4      ...               Slot 1   Slot 3   Slot 5      ...
             RXDAT
            Channel 1     Slot 0  AIF1[TX1/RX1]_SLOT = 0
            Channel 2                                                     Slot 1  AIF1[TX2/RX2]_SLOT = 1
            Channel 3              Slot 2  AIF1[TX3/RX3]_SLOT = 2
            Channel 4                                                              Slot 3  AIF1[TX4/RX4]_SLOT = 3
        Figure 46 I2S Example
        Figure 47 shows an example of Left Justified format. Six enabled channels are shown.
              LRCLK
               BCLK
             TXDAT/
                         Slot 0  Slot 2   Slot 4      ...                Slot 1  Slot 3   Slot 5      ...
             RXDAT
            Channel 1                                                                     Slot 5   AIF1[TX1/RX1]_SLOT = 5
            Channel 2                     Slot 4   AIF1[TX2/RX2]_SLOT = 4
            Channel 3                                                    Slot 1  AIF1[TX3/RX3]_SLOT = 1
            Channel 4                                                            Slot 3   AIF1[TX4/RX4]_SLOT = 3
            Channel 5    Slot 0  AIF1[TX5/RX5]_SLOT = 0
            Channel 6            Slot 2   AIF1[TX6/RX6]_SLOT = 2
        Figure 47 Left Justifed Example
        TDM OPERATION BETWEEN THREE OR MORE DEVICES
        The AIF operation described above illustrates how multiple audio channels can be interleaved on a
        single TXDAT or RXDAT pin. The interface uses Time Division Multiplexing (TDM) to allocate time
        periods to each of the audio channels in turn.
        This form of TDM is implemented between two devices, using the electrical connections illustrated in
        Figure 38 or Figure 39.
        It is also possible to implement TDM between three or more devices. This allows one CODEC to
        receive audio data from two other devices simultaneously on a single audio interface, as illustrated in
        Figure 48, Figure 49 and Figure 50.
        The WM8998 provides full support for TDM operation. The TXDAT pin can be tri-stated when not
        transmitting data, in order to allow other devices to transmit on the same wire. The behaviour of the
        TXDAT pin is configurable, to allow maximum flexibility to interface with other devices in this way.
        Typical configurations of TDM operation between three devices are illustrated in Figure 48, Figure 49
        and Figure 50.
Rev 4.1                                                                                                                   109


                                                                                      WM8998
                        BCLK                                                 BCLK
                        LRCLK                                                LRCLK
              WM8998                        Processor               WM8998                         Processor
                        TXDAT                                                TXDAT
                        RXDAT                                                RXDAT
                        BCLK                                                 BCLK
           WM8998       LRCLK                                    WM8998      LRCLK
            or similar                                            or similar
             CODEC      TXDAT                                      CODEC     TXDAT
                        RXDAT                                                RXDAT
    Figure 48 TDM with WM8998 as Master                      Figure 49 TDM with Other CODEC as Master
                       BCLK
                       LRCLK
            WM8998                         Processor
                       TXDAT
                       RXDAT
                       BCLK
         WM8998        LRCLK
          or similar
           CODEC       TXDAT
                       RXDAT
    Figure 50 TDM with Processor as Master
    Note:
    The WM8998 is a 24-bit device. If the user operates the WM8998 in 32-bit mode then the 8 LSBs will
    be ignored on the receiving side and not driven on the transmitting side. It is therefore recommended
    to add a pull-down resistor if necessary to the RXDAT line and the TXDAT line in TDM mode.
110                                                                                               Rev 4.1


                                                                                                   WM8998
DIGITAL AUDIO INTERFACE CONTROL
                 This section describes the configuration of the WM8998 digital audio interface paths.
                 AIF1 and AIF2 support up to 6 input signal paths and up to 6 output signal paths each. AIF3 supports
                 up to 2 input and output signal paths. The digital audio interfaces AIF1, AIF2 and AIF3 can be
                 configured as Master or Slave interfaces; mixed master/slave configurations are also possible.
                 Each input and output signal path can be independently enabled or disabled. The AIF output (TX) and
                 AIF input (RX) paths use shared BCLK and LRCLK control signals.
                 The digital audio interface supports flexible data formats, selectable word-length, configurable timeslot
                 allocations and TDM tri-state control.
                 The audio interfaces can be re-configured whilst enabled, including changes to the LRCLK frame
                 length and the channel timeslot configurations. Care is required to ensure that any ‘on-the-fly’ re-
                 configuration does not cause corruption to the active signal paths. Wherever possible, it is
                 recommended to disable all channels before changing the AIF configuration.
                 As noted in the applicable register descriptions, some of the AIF control fields are locked and cannot
                 be updated whilst AIF channels are enabled; this is to ensure continuity of the respective BCLK and
                 LRCLK signals.
                 AIF SAMPLE RATE CONTROL
                 The AIF RX inputs may be selected as input to the digital mixers or signal processing functions within
                 the WM8998 digital core. The AIF TX outputs are derived from the respective output mixers.
                 The sample rate for each digital audio interface AIFn is configured using the respective AIFn_RATE
                 register - see Table 19 within the “Digital Core” section.
                 Note that sample rate conversion is required when routing the AIF paths to any signal chain that is
                 asynchronous and/or configured for a different sample rate.
                 AIF MASTER / SLAVE CONTROL
                 The digital audio interfaces can operate in Master or Slave modes and also in mixed master/slave
                 configurations. In Master mode, the BCLK and LRCLK signals are generated by the WM8998 when
                 any of the respective digital audio interface channels is enabled. In Slave mode, these outputs are
                 disabled by default to allow another device to drive these pins.
                 Master mode is selected on the AIFnBCLK pin using the AIFn_BCLK_MSTR register bit. In Master
                 mode, the AIFnBCLK signal is generated by the WM8998 when one or more AIFn channels is
                 enabled.
                 When the AIFn_BCLK_FRC bit is set in BCLK master mode, the AIFnBCLK signal is output at all
                 times, including when none of the AIFn channels is enabled.
                 The AIFnBCLK signal can be inverted in Master or Slave modes using the AIFn_BCLK_INV register.
                 Master mode is selected on the AIFnLRCLK pin using the AIFn_LRCLK_MSTR register bit. In Master
                 mode, the AIFnLRCLK signal is generated by the WM8998 when one or more AIFn channels is
                 enabled.
                 When the AIFn_LRCLK_FRC bit is set in LRCLK master mode, the AIFnLRCLK signal is output at all
                 times, including when none of the AIFn channels is enabled. Note that AIFnLRCLK is derived from
                 AIFnBCLK, and an internal or external AIFnBCLK signal must be present to generate AIFnLRCLK.
                 The AIFnLRCLK signal can be inverted in Master or Slave modes using the AIFn_LRCLK_INV
                 register.
Rev 4.1                                                                                                              111


                                                                       WM8998
     REGISTER      BIT         LABEL     DEFAULT                 DESCRIPTION
     ADDRESS
     R1280         7     AIF1_BCLK_INV     0     AIF1 Audio Interface BCLK Invert
     (0500h)                                     0 = AIF1BCLK not inverted
     AIF1                                        1 = AIF1BCLK inverted
     BCLK Ctrl                                   This bit is locked when AIF1 channels are
                                                 enabled; it can only be changed when all
                                                 AIF1 channels are disabled.
                   6     AIF1_BCLK_FRC     0     AIF1 Audio Interface BCLK Output Control
                                                 0 = Normal
                                                 1 = AIF1BCLK always enabled in Master
                                                 mode
                   5     AIF1_BCLK_MST     0     AIF1 Audio Interface BCLK Master Select
                         R                       0 = AIF1BCLK Slave mode
                                                 1 = AIF1BCLK Master mode
                                                 This bit is locked when AIF1 channels are
                                                 enabled; it can only be changed when all
                                                 AIF1 channels are disabled.
     R1282         2     AIF1_LRCLK_IN     0     AIF1 Audio Interface LRCLK Invert
     (0502h)             V                       0 = AIF1LRCLK not inverted
     AIF1 Rx                                     1 = AIF1LRCLK inverted
     Pin Ctrl                                    This bit is locked when AIF1 channels are
                                                 enabled; it can only be changed when all
                                                 AIF1 channels are disabled.
                   1     AIF1_LRCLK_FR     0     AIF1 Audio Interface LRCLK Output
                         C                       Control
                                                 0 = Normal
                                                 1 = AIF1LRCLK always enabled in Master
                                                 mode
                   0     AIF1_LRCLK_MS     0     AIF1 Audio Interface LRCLK Master
                         TR                      Select
                                                 0 = AIF1LRCLK Slave mode
                                                 1 = AIF1LRCLK Master mode
                                                 This bit is locked when AIF1 channels are
                                                 enabled; it can only be changed when all
                                                 AIF1 channels are disabled.
    Table 22 AIF1 Master / Slave Control
     REGISTER      BIT         LABEL     DEFAULT                 DESCRIPTION
     ADDRESS
     R1344         7     AIF2_BCLK_INV     0     AIF2 Audio Interface BCLK Invert
     (0540h)                                     0 = AIF2BCLK not inverted
     AIF2                                        1 = AIF2BCLK inverted
     BCLK Ctrl                                   This bit is locked when AIF2 channels are
                                                 enabled; it can only be changed when all
                                                 AIF2 channels are disabled.
                   6     AIF2_BCLK_FRC     0     AIF2 Audio Interface BCLK Output Control
                                                 0 = Normal
                                                 1 = AIF2BCLK always enabled in Master
                                                 mode
                   5     AIF2_BCLK_MST     0     AIF2 Audio Interface BCLK Master Select
                         R                       0 = AIF2BCLK Slave mode
                                                 1 = AIF2BCLK Master mode
                                                 This bit is locked when AIF2 channels are
                                                 enabled; it can only be changed when all
                                                 AIF2 channels are disabled.
112                                                                                Rev 4.1


                                                                           WM8998
         REGISTER      BIT         LABEL     DEFAULT                 DESCRIPTION
         ADDRESS
         R1346         2     AIF2_LRCLK_IN     0     AIF2 Audio Interface LRCLK Invert
         (0542h)             V                       0 = AIF2LRCLK not inverted
         AIF2 Px                                     1 = AIF2LRCLK inverted
         Pin Ctrl                                    This bit is locked when AIF2 channels are
                                                     enabled; it can only be changed when all
                                                     AIF2 channels are disabled.
                       1     AIF2_LRCLK_FR     0     AIF2 Audio Interface LRCLK Output
                             C                       Control
                                                     0 = Normal
                                                     1 = AIF2LRCLK always enabled in Master
                                                     mode
                       0     AIF2_LRCLK_MS     0     AIF2 Audio Interface LRCLK Master
                             TR                      Select
                                                     0 = AIF2LRCLK Slave mode
                                                     1 = AIF2LRCLK Master mode
                                                     This bit is locked when AIF2 channels are
                                                     enabled; it can only be changed when all
                                                     AIF2 channels are disabled.
        Table 23 AIF2 Master / Slave Control
         REGISTER      BIT         LABEL     DEFAULT                 DESCRIPTION
         ADDRESS
         R1408         7     AIF3_BCLK_INV     0     AIF3 Audio Interface BCLK Invert
         (0580h)                                     0 = AIF3BCLK not inverted
         AIF3                                        1 = AIF3BCLK inverted
         BCLK Ctrl                                   This bit is locked when AIF3 channels are
                                                     enabled; it can only be changed when all
                                                     AIF3 channels are disabled.
                       6     AIF3_BCLK_FRC     0     AIF3 Audio Interface BCLK Output Control
                                                     0 = Normal
                                                     1 = AIF3BCLK always enabled in Master
                                                     mode
                       5     AIF3_BCLK_MST     0     AIF3 Audio Interface BCLK Master Select
                             R                       0 = AIF3BCLK Slave mode
                                                     1 = AIF3BCLK Master mode
                                                     This bit is locked when AIF3 channels are
                                                     enabled; it can only be changed when all
                                                     AIF3 channels are disabled.
         R1410         2     AIF3_LRCLK_IN     0     AIF3 Audio Interface LRCLK Invert
         (0582h)             V                       0 = AIF3LRCLK not inverted
         AIF3 Rx                                     1 = AIF3LRCLK inverted
         Pin Ctrl                                    This bit is locked when AIF3 channels are
                                                     enabled; it can only be changed when all
                                                     AIF3 channels are disabled.
                       1     AIF3_LRCLK_FR     0     AIF3 Audio Interface LRCLK Output
                             C                       Control
                                                     0 = Normal
                                                     1 = AIF3LRCLK always enabled in Master
                                                     mode
                       0     AIF3_LRCLK_MS     0     AIF3 Audio Interface LRCLK Master
                             TR                      Select
                                                     0 = AIF3LRCLK Slave mode
                                                     1 = AIF3LRCLK Master mode
                                                     This bit is locked when AIF3 channels are
                                                     enabled; it can only be changed when all
                                                     AIF3 channels are disabled.
        Table 24 AIF3 Master / Slave Control
Rev 4.1                                                                                     113


                                                                                     WM8998
    AIF SIGNAL PATH ENABLE
    The AIF1 and AIF2 interfaces support up to 6 input (RX) channels and up to 6 output (TX) channels.
    Each of these channels can be enabled or disabled using the register bits defined in Table 25.
    The AIF3 interface supports up to 2 input (RX) channels and up to 2 output (TX) channels. Each of
    these channels can be enabled or disabled using the register bits defined in Table 26 and Table 27.
    The system clock, SYSCLK, must be configured and enabled before any audio path is enabled. The
    ASYNCCLK may also be required, depending on the path configuration. See “Clocking and Sample
    Rates” for details of the system clocks.
    The audio interfaces can be re-configured whilst enabled, including changes to the LRCLK frame
    length and the channel timeslot configurations. Care is required to ensure that this ‘on-the-fly’ re-
    configuration does not cause corruption to the active signal paths. Wherever possible, it is
    recommended to disable all channels before changing the AIF configuration.
    As noted in the applicable register descriptions, some of the AIF control fields are locked and cannot
    be updated whilst AIF channels are enabled; this is to ensure continuity of the respective BCLK and
    LRCLK signals.
    The WM8998 performs automatic checks to confirm that the SYSCLK and ASYNCCLK frequencies
    are high enough to support the commanded signal paths and processing functions. If an attempt is
    made to enable an AIF signal path, and there are insufficient SYSCLK or ASYNCCLK cycles to
    support it, then the attempt will be unsuccessful. (Note that any signal paths that are already active
    will not be affected under these circumstances.)
    The Underclocked Error conditions can be monitored using the GPIO and/or Interrupt functions. See
    “General Purpose Input / Output” and “Interrupts” for further details.
       REGISTER        BIT         LABEL          DEFAULT                    DESCRIPTION
       ADDRESS
      R1305            5      AIF1TX6_ENA             0        AIF1 Audio Interface TX Channel 6
      (0519h)                                                  Enable
      AIF1 Tx                                                  0 = Disabled
      Enables                                                  1 = Enabled
                       4      AIF1TX5_ENA             0        AIF1 Audio Interface TX Channel 5
                                                               Enable
                                                               0 = Disabled
                                                               1 = Enabled
                       3      AIF1TX4_ENA             0        AIF1 Audio Interface TX Channel 4
                                                               Enable
                                                               0 = Disabled
                                                               1 = Enabled
                       2      AIF1TX3_ENA             0        AIF1 Audio Interface TX Channel 3
                                                               Enable
                                                               0 = Disabled
                                                               1 = Enabled
                       1      AIF1TX2_ENA             0        AIF1 Audio Interface TX Channel 2
                                                               Enable
                                                               0 = Disabled
                                                               1 = Enabled
                       0      AIF1TX1_ENA             0        AIF1 Audio Interface TX Channel 1
                                                               Enable
                                                               0 = Disabled
                                                               1 = Enabled
      R1306            5      AIF1RX6_ENA             0        AIF1 Audio Interface RX Channel 6
      (051Ah)                                                  Enable
      AIF1 Rx                                                  0 = Disabled
      Enables                                                  1 = Enabled
                       4      AIF1RX5_ENA             0        AIF1 Audio Interface RX Channel 5
                                                               Enable
                                                               0 = Disabled
                                                               1 = Enabled
114                                                                                              Rev 4.1


                                                                      WM8998
          REGISTER     BIT         LABEL DEFAULT               DESCRIPTION
          ADDRESS
                       3     AIF1RX4_ENA   0     AIF1 Audio Interface RX Channel 4
                                                 Enable
                                                 0 = Disabled
                                                 1 = Enabled
                       2     AIF1RX3_ENA   0     AIF1 Audio Interface RX Channel 3
                                                 Enable
                                                 0 = Disabled
                                                 1 = Enabled
                       1     AIF1RX2_ENA   0     AIF1 Audio Interface RX Channel 2
                                                 Enable
                                                 0 = Disabled
                                                 1 = Enabled
                       0     AIF1RX1_ENA   0     AIF1 Audio Interface RX Channel 1
                                                 Enable
                                                 0 = Disabled
                                                 1 = Enabled
        Table 25 AIF1 Signal Path Enable
          REGISTER     BIT         LABEL DEFAULT               DESCRIPTION
          ADDRESS
         R1369         5     AIF2TX6_ENA   0     AIF2 Audio Interface TX Channel 6
         (0559h)                                 Enable
         AIF2 TX                                 0 = Disabled
         Enables                                 1 = Enabled
                       4     AIF2TX5_ENA   0     AIF2 Audio Interface TX Channel 5
                                                 Enable
                                                 0 = Disabled
                                                 1 = Enabled
                       3     AIF2TX4_ENA   0     AIF2 Audio Interface TX Channel 4
                                                 Enable
                                                 0 = Disabled
                                                 1 = Enabled
                       2     AIF2TX3_ENA   0     AIF2 Audio Interface TX Channel 3
                                                 Enable
                                                 0 = Disabled
                                                 1 = Enabled
                       1     AIF2TX2_ENA   0     AIF2 Audio Interface TX Channel 2
                                                 Enable
                                                 0 = Disabled
                                                 1 = Enabled
                       0     AIF2TX1_ENA   0     AIF2 Audio Interface TX Channel 1
                                                 Enable
                                                 0 = Disabled
                                                 1 = Enabled
         R1370         5     AIF2RX6_ENA   0     AIF2 Audio Interface RX Channel 6
         (055Ah)                                 Enable
         AIF2 RX                                 0 = Disabled
         Enables                                 1 = Enabled
                       4     AIF2RX5_ENA   0     AIF2 Audio Interface RX Channel 5
                                                 Enable
                                                 0 = Disabled
                                                 1 = Enabled
                       3     AIF2RX4_ENA   0     AIF2 Audio Interface RX Channel 4
                                                 Enable
                                                 0 = Disabled
                                                 1 = Enabled
Rev 4.1                                                                            115


                                                                                   WM8998
        REGISTER      BIT          LABEL          DEFAULT                   DESCRIPTION
        ADDRESS
                      2      AIF2RX3_ENA             0        AIF2 Audio Interface RX Channel 3
                                                              Enable
                                                              0 = Disabled
                                                              1 = Enabled
                      1      AIF2RX2_ENA             0        AIF2 Audio Interface RX Channel 2
                                                              Enable
                                                              0 = Disabled
                                                              1 = Enabled
                      0      AIF2RX1_ENA             0        AIF2 Audio Interface RX Channel 1
                                                              Enable
                                                              0 = Disabled
                                                              1 = Enabled
    Table 26 AIF2 Signal Path Enable
        REGISTER      BIT          LABEL          DEFAULT                   DESCRIPTION
        ADDRESS
       R1433          1      AIF3TX2_ENA             0        AIF3 Audio Interface TX Channel 2
       (0599h)                                                Enable
       AIF3 TX                                                0 = Disabled
       Enables                                                1 = Enabled
                      0      AIF3TX1_ENA             0        AIF3 Audio Interface TX Channel 1
                                                              Enable
                                                              0 = Disabled
                                                              1 = Enabled
       R1434          1      AIF3RX2_ENA             0        AIF3 Audio Interface RX Channel 2
       (059Ah)                                                Enable
       AIF3 RX                                                0 = Disabled
       Enables                                                1 = Enabled
                      0      AIF3RX1_ENA             0        AIF3 Audio Interface RX Channel 1
                                                              Enable
                                                              0 = Disabled
                                                              1 = Enabled
    Table 27 AIF3 Signal Path Enable
    AIF BCLK AND LRCLK CONTROL
    The AIFnBCLK frequency is selected by the AIFn_BCLK_FREQ register. For each value of this
    register, the actual frequency depends upon whether AIFn is configured for a 48kHz-related sample
    rate or a 44.1kHz-related sample rate, as described below.
    If AIFn_RATE<1000 (see Table 19), then AIFn is referenced to the SYSCLK clocking domain and the
    applicable frequency depends upon the SAMPLE_RATE_1, SAMPLE_RATE_2 or SAMPLE_RATE_3
    registers.
    If AIFn_RATE≥1000, then AIFn is referenced to the ASYNCCLK clocking domain and the applicable
    frequency depends upon the ASYNC_SAMPLE_RATE_1 or ASYNC_SAMPLE_RATE_2 registers.
    The selected AIFnBCLK rate must be less than or equal to SYSCLK/2, or ASYNCCLK/2, as
    applicable. See “Clocking and Sample Rates” for details of SYSCLK and ASYNCCLK domains, and
    the associated control registers.
    The AIFnLRCLK frequency is controlled relative to AIFnBCLK by the AIFn_BCPF divider.
    Note that the BCLK rate must be configured in Master or Slave modes, using the AIFn_BCLK_FREQ
    registers. The LRCLK rate(s) only require to be configured in Master mode.
116                                                                                           Rev 4.1


                                                                            WM8998
         REGISTER      BIT         LABEL     DEFAULT                  DESCRIPTION
         ADDRESS
         R1280        4:0   AIF1_BCLK_FRE     01100  AIF1BCLK Rate
         (0500h)            Q [4:0]                  00000 = Reserved
         AIF1                                        00001 = Reserved
         BCLK Ctrl                                   00010 = 64kHz (58.8kHz)
                                                     00011 = 96kHz (88.2kHz)
                                                     00100 = 128kHz (117.6kHz)
                                                     00101 = 192kHz (176.4kHz)
                                                     00110 = 256kHz (235.2kHz)
                                                     00111 = 384kHz (352.8kHz)
                                                     01000 = 512kHz (470.4kHz)
                                                     01001 = 768kHz (705.6kHz)
                                                     01010 = 1.024MHz (940.8kHz)
                                                     01011 = 1.536MHz (1.4112MHz)
                                                     01100 = 2.048MHz (1.8816MHz)
                                                     01101 = 3.072MHz (2.8824MHz)
                                                     01110 = 4.096MHz (3.7632MHz)
                                                     01111 = 6.144MHz (5.6448MHz)
                                                     10000 = 8.192MHz (7.5264MHz)
                                                     10001 = 12.288MHz (11.2896MHz)
                                                     The frequencies in brackets apply for
                                                     44.1kHz-related sample rates only.
                                                     If AIF1_RATE<1000, then AIF1 is
                                                     referenced to SYSCLK and the 44.1kHz-
                                                     related frequencies apply if
                                                     SAMPLE_RATE_n = 01XXX.
                                                     If AIF1_RATE>=1000, then AIF1 is
                                                     referenced to ASYNCCLK and the
                                                     44.1kHz-related frequencies apply if
                                                     ASYNC_SAMPLE_RATE_n = 01XXX.
                                                     The AIF1BCLK rate must be less than or
                                                     equal to SYSCLK/2, or ASYNCCLK/2, as
                                                     applicable.
                                                     This field is locked when AIF1 channels
                                                     are enabled; it can only be changed when
                                                     all AIF1 channels are disabled.
         R1286        12:0  AIF1_BCPF         0040h  AIF1LRCLK Rate
         (0506h)            [12:0]                   This register selects the number of BCLK
         AIF1 Tx                                     cycles per AIF1LRCLK frame.
         BCLK                                        AIF1LRCLK clock = AIF1BCLK /
         Rate                                        AIF1_BCPF
                                                     Integer (LSB = 1), Valid from 8..8191
        Table 28 AIF1 BCLK and LRCLK Control
Rev 4.1                                                                                     117


                                                                        WM8998
     REGISTER      BIT         LABEL     DEFAULT                  DESCRIPTION
     ADDRESS
     R1344        4:0   AIF2_BCLK_FRE     01100  AIF2BCLK Rate
     (0540h)            Q [4:0]                  00000 = Reserved
     AIF2                                        00001 = Reserved
     BCLK Ctrl                                   00010 = 64kHz (58.8kHz)
                                                 00011 = 96kHz (88.2kHz)
                                                 00100 = 128kHz (117.6kHz)
                                                 00101 = 192kHz (176.4kHz)
                                                 00110 = 256kHz (235.2kHz)
                                                 00111 = 384kHz (352.8kHz)
                                                 01000 = 512kHz (470.4kHz)
                                                 01001 = 768kHz (705.6kHz)
                                                 01010 = 1.024MHz (940.8kHz)
                                                 01011 = 1.536MHz (1.4112MHz)
                                                 01100 = 2.048MHz (1.8816MHz)
                                                 01101 = 3.072MHz (2.8824MHz)
                                                 01110 = 4.096MHz (3.7632MHz)
                                                 01111 = 6.144MHz (5.6448MHz)
                                                 10000 = 8.192MHz (7.5264MHz)
                                                 10001 = 12.288MHz (11.2896MHz)
                                                 The frequencies in brackets apply for
                                                 44.1kHz-related sample rates only.
                                                 If AIF2_RATE<1000, then AIF2 is
                                                 referenced to SYSCLK and the 44.1kHz-
                                                 related frequencies apply if
                                                 SAMPLE_RATE_n = 01XXX.
                                                 If AIF2_RATE>=1000, then AIF2 is
                                                 referenced to ASYNCCLK and the
                                                 44.1kHz-related frequencies apply if
                                                 ASYNC_SAMPLE_RATE_n = 01XXX.
                                                 The AIF2BCLK rate must be less than or
                                                 equal to SYSCLK/2, or ASYNCCLK/2, as
                                                 applicable.
                                                 This field is locked when AIF2 channels
                                                 are enabled; it can only be changed when
                                                 all AIF2 channels are disabled.
     R1350        12:0  AIF2_BCPF         0040h  AIF2LRCLK Rate
     (0546h)            [12:0]                   This register selects the number of BCLK
     AIF2 Rx                                     cycles per AIF2LRCLK frame.
     BCLK                                        AIF2LRCLK clock = AIF2BCLK /
     Rate                                        AIF2_BCPF
                                                 Integer (LSB = 1), Valid from 8..8191
    Table 29 AIF2 BCLK and LRCLK Control
118                                                                                 Rev 4.1


                                                                            WM8998
         REGISTER      BIT         LABEL     DEFAULT                  DESCRIPTION
         ADDRESS
         R1408        4:0   AIF3_BCLK_FRE     01100  AIF3BCLK Rate
         (0580h)            Q [4:0]                  00000 = Reserved
         AIF3                                        00001 = Reserved
         BCLK Ctrl                                   00010 = 64kHz (58.8kHz)
                                                     00011 = 96kHz (88.2kHz)
                                                     00100 = 128kHz (117.6kHz)
                                                     00101 = 192kHz (176.4kHz)
                                                     00110 = 256kHz (235.2kHz)
                                                     00111 = 384kHz (352.8kHz)
                                                     01000 = 512kHz (470.4kHz)
                                                     01001 = 768kHz (705.6kHz)
                                                     01010 = 1.024MHz (940.8kHz)
                                                     01011 = 1.536MHz (1.4112MHz)
                                                     01100 = 2.048MHz (1.8816MHz)
                                                     01101 = 3.072MHz (2.8824MHz)
                                                     01110 = 4.096MHz (3.7632MHz)
                                                     01111 = 6.144MHz (5.6448MHz)
                                                     10000 = 8.192MHz (7.5264MHz)
                                                     10001 = 12.288MHz (11.2896MHz)
                                                     The frequencies in brackets apply for
                                                     44.1kHz-related sample rates only.
                                                     If AIF3_RATE<1000, then AIF3 is
                                                     referenced to SYSCLK and the 44.1kHz-
                                                     related frequencies apply if
                                                     SAMPLE_RATE_n = 01XXX.
                                                     If AIF3_RATE>=1000, then AIF3 is
                                                     referenced to ASYNCCLK and the
                                                     44.1kHz-related frequencies apply if
                                                     ASYNC_SAMPLE_RATE_n = 01XXX.
                                                     The AIF3BCLK rate must be less than or
                                                     equal to SYSCLK/2, or ASYNCCLK/2, as
                                                     applicable.
                                                     This field is locked when AIF3 channels
                                                     are enabled; it can only be changed when
                                                     all AIF3 channels are disabled.
         R1414        12:0  AIF3_BCPF         0040h  AIF3LRCLK Rate
         (0586h)            [12:0]                   This register selects the number of BCLK
         AIF3 Rx                                     cycles per AIF3LRCLK frame.
         BCLK                                        AIF3LRCLK clock = AIF3BCLK /
         Rate                                        AIF3_BCPF
                                                     Integer (LSB = 1), Valid from 8..8191
        Table 30 AIF3 BCLK and LRCLK Control
Rev 4.1                                                                                     119


                                                                                       WM8998
    AIF DIGITAL AUDIO DATA CONTROL
    The register bits controlling the audio data format, word lengths and slot configurations for AIF1, AIF2
    and AIF3 are described in Table 31, Table 32 and Table 33 respectively.
    Note that Left-Justified and DSP-B modes are valid in Master mode only (ie. BCLK and LRCLK are
    outputs from the WM8998).
    The AIFn Slot Length is the number of BCLK cycles in one timeslot within the overall LRCLK frame.
    The Word Length is the number of valid data bits within each timeslot. (If the word length is less than
    the slot length, then there will be unused BCLK cycles at the end of each timeslot.) The AIFn word
    length and slot length is independently selectable for the input (RX) and output (TX) paths.
    For each AIF input (RX) and AIF output (TX) channel, the position of the audio data sample within the
    LRCLK frame is configurable. The _SLOT registers define the timeslot position of the audio sample
    for the associated audio channel. Valid selections are Slot 0 upwards. The timeslots are numbered as
    illustrated in Figure 44 through to Figure 47.
    Note that, in DSP modes, the timeslots are ordered consecutively from the start of the LRCLK frame.
    In I2S and Left-Justified modes, the even-numbered timeslots are arranged in the first half of the
    LRCLK frame, and the odd-numbered timeslots are arranged in the second half of the frame.
       REGISTER         BIT         LABEL           DEFAULT                      DESCRIPTION
       ADDRESS
       R1284           2:0    AIF1_FMT [2:0]         000        AIF1 Audio Interface Format
       (0504h)                                                  000 = DSP Mode A
       AIF1                                                     001 = DSP Mode B
       Format                                                   010 = I2S mode
                                                                011 = Left Justified mode
                                                                Other codes are Reserved
                                                                This field is locked when AIF1 channels
                                                                are enabled; it can only be changed when
                                                                all AIF1 channels are disabled.
       R1287          13:8    AIF1TX_WL [5:0]        18h        AIF1 TX Word Length
       (0507h)                                                  (Number of valid data bits per slot)
       AIF1                                                     Integer (LSB = 1); Valid from 16 to 32
       Frame Ctrl      7:0    AIF1TX_SLOT_L          18h        AIF1 TX Slot Length
       1                      EN [7:0]                          (Number of BCLK cycles per slot)
                                                                Integer (LSB = 1); Valid from 16 to 128
       R1288          13:8    AIF1RX_WL [5:0]        18h        AIF1 RX Word Length
       (0508h)                                                  (Number of valid data bits per slot)
       AIF1                                                     Integer (LSB = 1); Valid from 16 to 32
       Frame Ctrl      7:0    AIF1RX_SLOT_L          18h        AIF1 RX Slot Length
       2                      EN [7:0]                          (Number of BCLK cycles per slot)
                                                                Integer (LSB = 1); Valid from 16 to 128
       R1289           5:0    AIF1TX1_SLOT            0h        AIF1 TX Channel n Slot position
       (0509h)                [5:0]                             Defines the TX timeslot position of the
                       5:0    AIF1TX2_SLOT            1h        Channel n audio sample
       to                     [5:0]                             Integer (LSB=1); Valid from 0 to 63
                       5:0    AIF1TX3_SLOT            2h
       R1296                  [5:0]
       (0510h)         5:0    AIF1TX4_SLOT            3h
                              [5:0]
                       5:0    AIF1TX5_SLOT            4h
                              [5:0]
                       5:0    AIF1TX6_SLOT            5h
                              [5:0]
120                                                                                                 Rev 4.1


                                                                                WM8998
         REGISTER       BIT         LABEL        DEFAULT                  DESCRIPTION
         ADDRESS
         R1297         5:0    AIF1RX1_SLOT         0h    AIF1 RX Channel n Slot position
         (0511h)              [5:0]                      Defines the RX timeslot position of the
                       5:0    AIF1RX2_SLOT         1h    Channel n audio sample
         to                   [5:0]                      Integer (LSB=1); Valid from 0 to 63
                       5:0    AIF1RX3_SLOT         2h
         R1304                [5:0]
         (0518h)       5:0    AIF1RX4_SLOT         3h
                              [5:0]
                       5:0    AIF1RX5_SLOT         4h
                              [5:0]
                       5:0    AIF1RX6_SLOT         5h
                              [5:0]
        Table 31 AIF1 Digital Audio Data Control
         REGISTER       BIT         LABEL        DEFAULT                  DESCRIPTION
         ADDRESS
         R1348         2:0    AIF2_FMT [2:0]      000    AIF2 Audio Interface Format
         (0544h)                                         000 = DSP Mode A
         AIF2                                            001 = DSP Mode B
         Format                                          010 = I2S mode
                                                         011 = Left Justified mode
                                                         Other codes are Reserved
                                                         This field is locked when AIF2 channels
                                                         are enabled; it can only be changed when
                                                         all AIF2 channels are disabled.
         R1351        13:8    AIF2TX_WL [5:0]     18h    AIF2 TX Word Length
         (0547h)                                         (Number of valid data bits per slot)
         AIF2                                            Integer (LSB = 1); Valid from 16 to 32
         Frame Ctrl    7:0    AIF2TX_SLOT_L       18h    AIF2 TX Slot Length
         1                    EN [7:0]                   (Number of BCLK cycles per slot)
                                                         Integer (LSB = 1); Valid from 16 to 128
         R1352        13:8    AIF2RX_WL [5:0]     18h    AIF2 RX Word Length
         (0548h)                                         (Number of valid data bits per slot)
         AIF2                                            Integer (LSB = 1); Valid from 16 to 32
         Frame Ctrl    7:0    AIF2RX_SLOT_L       18h    AIF2 RX Slot Length
         2                    EN [7:0]                   (Number of BCLK cycles per slot)
                                                         Integer (LSB = 1); Valid from 16 to 128
         R1353         5:0    AIF2TX1_SLOT         0h    AIF2 TX Channel n Slot position
         (0549h)              [5:0]                      Defines the TX timeslot position of the
                       5:0    AIF2TX2_SLOT         1h    Channel n audio sample
         to                   [5:0]                      Integer (LSB=1); Valid from 0 to 63
                       5:0    AIF2TX3_SLOT         2h
         R1358                [5:0]
         (054Eh)       5:0    AIF2TX4_SLOT         3h
                              [5:0]
                       5:0    AIF2TX5_SLOT         4h
                              [5:0]
                       5:0    AIF2TX6_SLOT         5h
                              [5:0]
Rev 4.1                                                                                          121


                                                                            WM8998
     REGISTER       BIT         LABEL        DEFAULT                  DESCRIPTION
     ADDRESS
     R1361         5:0    AIF2RX1_SLOT         0h    AIF2 RX Channel n Slot position
     (0551h)              [5:0]                      Defines the RX timeslot position of the
                   5:0    AIF2RX2_SLOT         1h    Channel n audio sample
     to                   [5:0]                      Integer (LSB=1); Valid from 0 to 63
                   5:0    AIF2RX3_SLOT         2h
     R1366                [5:0]
     (0556h)       5:0    AIF2RX4_SLOT         3h
                          [5:0]
                   5:0    AIF2RX5_SLOT         4h
                          [5:0]
                   5:0    AIF2RX6_SLOT         5h
                          [5:0]
    Table 32 AIF2 Digital Audio Data Control
     REGISTER       BIT         LABEL        DEFAULT                  DESCRIPTION
     ADDRESS
     R1412         2:0    AIF3_FMT [2:0]      000    AIF3 Audio Interface Format
     (0584h)                                         000 = DSP Mode A
     AIF3                                            001 = DSP Mode B
     Format                                          010 = I2S mode
                                                     011 = Left Justified mode
                                                     Other codes are Reserved
                                                     This field is locked when AIF3 channels
                                                     are enabled; it can only be changed when
                                                     all AIF3 channels are disabled.
     R1415        13:8    AIF3TX_WL [5:0]     18h    AIF3 TX Word Length
     (0587h)                                         (Number of valid data bits per slot)
     AIF3                                            Integer (LSB = 1); Valid from 16 to 32
     Frame Ctrl    7:0    AIF3TX_SLOT_L       18h    AIF3 TX Slot Length
     1                    EN [7:0]                   (Number of BCLK cycles per slot)
                                                     Integer (LSB = 1); Valid from 16 to 128
     R1416        13:8    AIF3RX_WL [5:0]     18h    AIF3 RX Word Length
     (0588h)                                         (Number of valid data bits per slot)
     AIF3                                            Integer (LSB = 1); Valid from 16 to 32
     Frame Ctrl    7:0    AIF3RX_SLOT_L       18h    AIF3 RX Slot Length
     2                    EN [7:0]                   (Number of BCLK cycles per slot)
                                                     Integer (LSB = 1); Valid from 16 to 128
     R1417         5:0    AIF3TX1_SLOT         0h    AIF3 TX Channel 1 Slot position
     (0589h)              [5:0]                      Defines the TX timeslot position of the
     AIF3                                            Channel 1 audio sample
     Frame Ctrl                                      Integer (LSB=1); Valid from 0 to 63
     3
     R1418         5:0    AIF3TX2_SLOT         1h    AIF3 TX Channel 2 Slot position
     (058Ah)              [5:0]                      Defines the TX timeslot position of the
     AIF3                                            Channel 2 audio sample
     Frame Ctrl                                      Integer (LSB=1); Valid from 0 to 63
     4
     R1425         5:0    AIF3RX1_SLOT         0h    AIF3 RX Channel 1 Slot position
     (0591h)              [5:0]                      Defines the RX timeslot position of the
     AIF3                                            Channel 1 audio sample
     Frame Ctrl                                      Integer (LSB=1); Valid from 0 to 63
     11
122                                                                                      Rev 4.1


                                                                                          WM8998
          REGISTER        BIT          LABEL           DEFAULT                    DESCRIPTION
          ADDRESS
          R1426          5:0     AIF3RX2_SLOT             1h       AIF3 RX Channel 2 Slot position
          (0592h)                [5:0]                             Defines the RX timeslot position of the
          AIF3                                                     Channel 2 audio sample
          Frame Ctrl                                               Integer (LSB=1); Valid from 0 to 63
          12
        Table 33 AIF3 Digital Audio Data Control
        AIF TDM AND TRI-STATE CONTROL
        The AIFn output pins are tri-stated when the AIFn_TRI register is set.
        Under default conditions, the AIFnTXDAT output is held at logic 0 when the WM8998 is not
        transmitting data (ie. during timeslots that are not enabled for output by the WM8998). When the
        AIFnTX_DAT_TRI register is set, the WM8998 tri-states the respective AIFnTXDAT pin when not
        transmitting data, allowing other devices to drive the AIFnTXDAT connection.
           REGISTER       BIT          LABEL           DEFAULT                    DESCRIPTION
           ADDRESS
          R1281           5      AIF1TX_DAT_TR             0       AIF1TXDAT Tri-State Control
          (0501h)                I                                 0 = Logic 0 during unused timeslots
          AIF1 Tx                                                  1 = Tri-stated during unused timeslots
          Pin Ctrl
          R1283           6      AIF1_TRI                  0       AIF1 Audio Interface Tri-State Control
          (0503h)                                                  0 = Normal
          AIF1 Rate                                                1 = AIF1 Outputs are tri-stated
          Ctrl
        Table 34 AIF1 TDM and Tri-State Control
           REGISTER       BIT          LABEL           DEFAULT                    DESCRIPTION
           ADDRESS
          R1345           5      AIF2TX_DAT_TR             0       AIF2TXDAT Tri-State Control
          (0541h)                I                                 0 = Logic 0 during unused timeslots
          AIF2 Tx                                                  1 = Tri-stated during unused timeslots
          Pin Ctrl
          R1347           6      AIF2_TRI                  0       AIF2 Audio Interface Tri-State Control
          (0543h)                                                  0 = Normal
          AIF2 Rate                                                1 = AIF2 Outputs are tri-stated
          Ctrl
        Table 35 AIF2 TDM and Tri-State Control
           REGISTER       BIT          LABEL           DEFAULT                    DESCRIPTION
           ADDRESS
          R1409           5      AIF3TX_DAT_TR             0       AIF3TXDAT Tri-State Control
          (0581h)                I                                 0 = Logic 0 during unused timeslots
          AIF3 Tx                                                  1 = Tri-stated during unused timeslots
          Pin Ctrl
          R1411           6      AIF3_TRI                  0       AIF3 Audio Interface Tri-State Control
          (0583h)                                                  0 = Normal
          AIF3 Rate                                                1 = AIF3 Outputs are tri-stated
          Ctrl
        Table 36 AIF3 TDM and Tri-State Control
Rev 4.1                                                                                                    123


                                                                                      WM8998
    AIF DIGITAL PULL-UP AND PULL-DOWN
    The WM8998 provides integrated pull-up and pull-down resistors on each of the AIFnLRCLK,
    AIFnBCLK and AIFnRXDAT pins. This provides a flexible capability for interfacing with other devices.
    Each of the pull-up and pull-down resistors can be configured independently using the register bits
    described in Table 37, Table 38 and Table 39. When the pull-up and pull-down resistors are both
    enabled, the WM8998 provides a ‘bus keeper’ function on the respective pin. The bus keeper function
    holds the logic level unchanged whenever the pin is undriven (eg. if the signal is tri-stated).
       REGISTER       BIT         LABEL         DEFAULT                       DESCRIPTION
       ADDRESS
      R3107            5     AIF1LRCLK_PU           0         AIF1LRCLK Pull-Up Control
      (0C23h)                                                 0 = Disabled
      Misc Pad                                                1 = Enabled
      Ctrl 4                                                  Note - when AIF1LRCLK_PD and
                                                              AIF1LRCLK_PU are both set to ‘1’, then a
                                                              ‘bus keeper’ function is enabled on the
                                                              AIF1LRCLK pin.
                       4     AIF1LRCLK_PD           0         AIF1LRCLK Pull-Down Control
                                                              0 = Disabled
                                                              1 = Enabled
                                                              Note - when AIF1LRCLK_PD and
                                                              AIF1LRCLK_PU are both set to ‘1’, then a
                                                              ‘bus keeper’ function is enabled on the
                                                              AIF1LRCLK pin.
                       3     AIF1BCLK_PU            0         AIF1BCLK Pull-Up Control
                                                              0 = Disabled
                                                              1 = Enabled
                                                              Note - when AIF1BCLK_PD and
                                                              AIF1BCLK_PU are both set to ‘1’, then a
                                                              ‘bus keeper’ function is enabled on the
                                                              AIF1BCLK pin.
                       2     AIF1BCLK_PD            0         AIF1BCLK Pull-Down Control
                                                              0 = Disabled
                                                              1 = Enabled
                                                              Note - when AIF1BCLK_PD and
                                                              AIF1BCLK_PU are both set to ‘1’, then a
                                                              ‘bus keeper’ function is enabled on the
                                                              AIF1BCLK pin.
                       1     AIF1RXDAT_PU           0         AIF1RXDAT Pull-Up Control
                                                              0 = Disabled
                                                              1 = Enabled
                                                              Note - when AIF1RXDAT_PD and
                                                              AIF1RXDAT_PU are both set to ‘1’, then a
                                                              ‘bus keeper’ function is enabled on the
                                                              AIF1RXDAT pin.
                       0     AIF1RXDAT_PD           0         AIF1RXDAT Pull-Down Control
                                                              0 = Disabled
                                                              1 = Enabled
                                                              Note - when AIF1RXDAT_PD and
                                                              AIF1RXDAT_PU are both set to ‘1’, then a
                                                              ‘bus keeper’ function is enabled on the
                                                              AIF1RXDAT pin.
    Table 37 AIF1 Digital Pull-Up and Pull-Down Control
124                                                                                                 Rev 4.1


                                                                                   WM8998
          REGISTER     BIT          LABEL         DEFAULT                  DESCRIPTION
          ADDRESS
         R3108         5      AIF2LRCLK_PU           0      AIF2LRCLK Pull-Up Control
         (0C24h)                                            0 = Disabled
         Misc Pad                                           1 = Enabled
         Ctrl 5                                             Note - when AIF2LRCLK_PD and
                                                            AIF2LRCLK_PU are both set to ‘1’, then a
                                                            ‘bus keeper’ function is enabled on the
                                                            AIF2LRCLK pin.
                       4      AIF2LRCLK_PD           0      AIF2LRCLK Pull-Down Control
                                                            0 = Disabled
                                                            1 = Enabled
                                                            Note - when AIF2LRCLK_PD and
                                                            AIF2LRCLK_PU are both set to ‘1’, then a
                                                            ‘bus keeper’ function is enabled on the
                                                            AIF2LRCLK pin.
                       3      AIF2BCLK_PU            0      AIF2BCLK Pull-Up Control
                                                            0 = Disabled
                                                            1 = Enabled
                                                            Note - when AIF2BCLK_PD and
                                                            AIF2BCLK_PU are both set to ‘1’, then a
                                                            ‘bus keeper’ function is enabled on the
                                                            AIF2BCLK pin.
                       2      AIF2BCLK_PD            0      AIF2BCLK Pull-Down Control
                                                            0 = Disabled
                                                            1 = Enabled
                                                            Note - when AIF2BCLK_PD and
                                                            AIF2BCLK_PU are both set to ‘1’, then a
                                                            ‘bus keeper’ function is enabled on the
                                                            AIF2BCLK pin.
                       1      AIF2RXDAT_PU           0      AIF2RXDAT Pull-Up Control
                                                            0 = Disabled
                                                            1 = Enabled
                                                            Note - when AIF2RXDAT_PD and
                                                            AIF2RXDAT_PU are both set to ‘1’, then a
                                                            ‘bus keeper’ function is enabled on the
                                                            AIF2RXDAT pin.
                       0      AIF2RXDAT_PD           0      AIF2RXDAT Pull-Down Control
                                                            0 = Disabled
                                                            1 = Enabled
                                                            Note - when AIF2RXDAT_PD and
                                                            AIF2RXDAT_PU are both set to ‘1’, then a
                                                            ‘bus keeper’ function is enabled on the
                                                            AIF2RXDAT pin.
        Table 38 AIF2 Digital Pull-Up and Pull-Down Control
Rev 4.1                                                                                             125


                                                                               WM8998
      REGISTER     BIT          LABEL         DEFAULT                  DESCRIPTION
      ADDRESS
     R3109         5      AIF3LRCLK_PU           0      AIF3LRCLK Pull-Up Control
     (0C25h)                                            0 = Disabled
     Misc Pad                                           1 = Enabled
     Ctrl 6                                             Note - when AIF3LRCLK_PD and
                                                        AIF3LRCLK_PU are both set to ‘1’, then a
                                                        ‘bus keeper’ function is enabled on the
                                                        AIF3LRCLK pin.
                   4      AIF3LRCLK_PD           0      AIF3LRCLK Pull-Down Control
                                                        0 = Disabled
                                                        1 = Enabled
                                                        Note - when AIF3LRCLK_PD and
                                                        AIF3LRCLK_PU are both set to ‘1’, then a
                                                        ‘bus keeper’ function is enabled on the
                                                        AIF3LRCLK pin.
                   3      AIF3BCLK_PU            0      AIF3BCLK Pull-Up Control
                                                        0 = Disabled
                                                        1 = Enabled
                                                        Note - when AIF3BCLK_PD and
                                                        AIF3BCLK_PU are both set to ‘1’, then a
                                                        ‘bus keeper’ function is enabled on the
                                                        AIF3BCLK pin.
                   2      AIF3BCLK_PD            0      AIF3BCLK Pull-Down Control
                                                        0 = Disabled
                                                        1 = Enabled
                                                        Note - when AIF3BCLK_PD and
                                                        AIF3BCLK_PU are both set to ‘1’, then a
                                                        ‘bus keeper’ function is enabled on the
                                                        AIF3BCLK pin.
                   1      AIF3RXDAT_PU           0      AIF3RXDAT Pull-Up Control
                                                        0 = Disabled
                                                        1 = Enabled
                                                        Note - when AIF3RXDAT_PD and
                                                        AIF3RXDAT_PU are both set to ‘1’, then a
                                                        ‘bus keeper’ function is enabled on the
                                                        AIF3RXDAT pin.
                   0      AIF3RXDAT_PD           0      AIF3RXDAT Pull-Down Control
                                                        0 = Disabled
                                                        1 = Enabled
                                                        Note - when AIF3RXDAT_PD and
                                                        AIF3RXDAT_PU are both set to ‘1’, then a
                                                        ‘bus keeper’ function is enabled on the
                                                        AIF3RXDAT pin.
    Table 39 AIF3 Digital Pull-Up and Pull-Down Control
126                                                                                        Rev 4.1


                                                                                                  WM8998
SLIMBUS INTERFACE
                The SLIMbus protocol is highly configurable and adaptable, supporting multiple audio signal paths,
                and mixed sample rates simultaneously. It also supports control messaging and associated
                communications between devices.
                SLIMBUS DEVICES
                The SLIMbus components comprise different device classes (Manager, Framer, Interface, Generic).
                Each component on the bus has an Interface Device, which provides bus management services for
                the respective component. One or more components on the bus will provide Manager and Framer
                Device functions; the Manager has the capabilities to administer the bus, whilst the Framer is
                responsible for driving the CLK line and for driving the DATA required to establish the Frame
                Structure on the bus. Note that only one Manager and one Framer Device will be active at any time.
                The Framer function can be transferred between Devices when required. Generic Devices provide the
                basic SLIMbus functionality for the associated Port(s), and for the Transport Protocol by which audio
                signal paths are established on the bus.
                SLIMBUS FRAME STRUCTURE
                The SLIMbus bit stream is formatted within a defined structure of Cells, Slots, Subframes, Frames,
                and Superframes:
                          A single data bit is known as a Cell
                          4 Cells make a Slot
                          192 Slots make a Frame
                          8 Frames make a Superframe
                The bit stream structure is configurable to some extent, but the Superframe definition always
                comprises 1536 slots. The transmitted/received bit rate is not fixed; it can be configured according to
                system requirements, and can be changed dynamically without interruption to active audio paths.
                The SLIMbus CLK frequency (also the bus bit rate) is defined by a Root Frequency (RF) and a Clock
                Gear (CG). In the top Clock Gear (Gear 10), the CLK frequency is equal to the Root Frequency. Each
                reduction in the Clock Gear halves the CLK frequency, and doubles the duration of the Superframe.
                The SLIMbus bandwidth will typically comprise Control space (for bus messages, synchronisation
                etc.) and Data space (for audio paths). The precise allocation is configurable, and can be entirely
                Control space, if required.
                The Subframe definition comprises the number of Slots per Subframe (6, 8, 24 or 32 Slots), and the
                number of these Slots (per Subframe) allocated as Control space. The applicable combination of
                Subframe length and Control space width are defined by the Subframe Mode (SM) parameter.
                The SLIMbus Frame always comprises 192 Slots, regardless of the Subframe definition. A number of
                Slots are allocated to Control space, as noted above; the remaining Slots are allocated to Data space.
                Some of the Control space is required for Framing Information and for the Guide Channel (described
                below); the remainder of the Control space are allocated to the Message Channel.
                CONTROL SPACE
                Framing Information is provided in Slots 0 and 96 of every Frame. Slot 0 contains a 4-bit
                synchronisation code; Slot 96 contains the 32-bit Framing Information, transmitted 4 bits at a time
                over the 8 Frames that make up the SLIMbus Superframe. The Clock Gear, Root Frequency,
                Subframe configuration, along with some other parameters, are encoded within the Framing
                Information.
                The Guide Channel occupies two Slots within Frame 0. This provides the necessary information for a
                SLIMbus component to acquire and verify the frame synchronisation. The Guide Channel occupies
                the first two Control space Slots within the first Frame of the bit stream, excluding the Framing
                Information Slots. Note that the exact Slot allocation will depend upon the applicable Subframe mode.
Rev 4.1                                                                                                           127


                                                                                    WM8998
    The Message Channel is allocated all of the Control space not used by the Framing Information or the
    Guide Channel. The Message Channel enables SLIMbus devices to communicate with each other,
    using a priority-based mechanism defined in the MIPI specification.
    Messages may be broadcast to all devices on the bus, or can be addressed to specific devices using
    their allocated Logical Address (LA) or Enumeration Address (EA). Note that, device-specific
    messages are directed to a particular device (ie. Manager, Framer, Interface or Generic) within a
    component on the bus.
    DATA SPACE
    The Data space can be organised into a maximum of 256 Data Channels. Each Channel, identified by
    a unique Channel Number (CN), is a stream of one or more contiguous Slots, organised in a
    consistent data structure that repeats at a fixed interval.
    A Data Channel is defined by its Segment Length (SL) (number of contiguous Slots allocated),
    Segment Interval (spacing between the first Slots of successive Segments), and Segment Offset (the
    Slot Number of the first allocated Slot within the Superframe). The Segment Interval and Segment
    Offset are collectively defined by a Segment Distribution (SD), by which the SLIMbus Manager may
    configure (or re-configure) any Data Channel.
    Each Segment may comprise TAG, AUX and DATA portions. Any of these portions may be 0-length;
    the exact composition depends on the Transport Protocol (TP) for the associated Channel (see
    below). The DATA portion must be wide enough to accommodate one full word of the Data Channel
    contents (data words cannot be spread across multiple segments).
    The Segment Interval for each Data Channel represents the minimum spacing between consecutive
    data samples for that Channel. (Note - the minimum spacing applies if every allocated segment is
    populated with new data; in many cases, additional bandwidth is allocated, as described below, and
    not every allocated segment is used.)
    The Segment Interval gives rise to Segment Windows for each Data Channel, aligned to the start of
    every Superframe. The Segment Window boundaries define the times within which each new data
    sample must be buffered, ready for transmission - adherence to these fixed boundaries allows Slot
    allocations to be moved within a Segment Window, without altering the signal latency. The Segment
    Interval may be either shorter or longer than the Frame length, but there is always an integer number
    of Segment Windows per Superframe.
    The Transport Protocol (TP) defines the flow control or handshaking method used by the Ports
    associated with a Data Channel. The applicable flow control mode(s) depend on the relationship
    between the audio sample rate (flow rate) and the SLIMbus CLK frequency. If the two rates are
    synchronised and integer-related, then no flow control is needed; in other cases, the flow may be
    regulated by the use of a ‘Presence’ bit. The Presence bit can either be set by the source Device
    (‘pushed’ protocol), or by the sink Device (‘pulled’ protocol).
    The Data Channel structure is defined in terms of the Transport Protocol (TP), Segment Distribution
    (SD), and the Segment Length (SL) parameters. Each of these is described above.
    The Data Channel content definition includes a Presence Rate (PR) parameter (describing the
    nominal sample rate for the audio channel) and a Frequency Locked (FL) bit (identifying whether the
    data source is synchronised to the SLIMbus CLK). The Data Length (DL) parameter defines the size
    of each data sample (number of Slots). The Auxiliary Bits Format (AF) and Data Type (DT)
    parameters provide support for non-PCM encoded data channels; the Channel Link (CL) parameter is
    an indicator that channel CN is related to the previous channel, CN-1.
    For a given Root Frequency and Clock Gear, the Segment Length (SL) and Segment Distribution
    (SD) parameters define the amount of SLIMbus bandwidth that is allocated to a given Data Channel.
    The minimum bandwidth requirements of a Data Channel are represented by the Presence Rate (PR)
    and Data Length (DL) parameters. The allocated SLIMbus bandwidth must be equal to or greater than
    the bandwidth of the data to be transferred.
    The Segment Interval defines the repetition rate of the SLIMbus Slots allocated to consecutive data
    samples for a given Data Channel. The Presence Rate (PR) is the nominal sample rate of the audio
    path. The Segment Rate (determined by the Segment Interval value) must be equal to or greater than
    the Presence Rate for a given data channel. The following constraints must be observed, when
    configuring a SLIMbus channel:
              If Pushed or Pulled Transport Protocol is selected, the Segment Rate must be greater than
               the Presence Rate, to ensure that samples are not dropped as a result of clock drift.
              If Isochronous Transport Protocol is selected, the Segment Rate must be equal to the
128                                                                                              Rev 4.1


                                                                                                 WM8998
                          Presence Rate. Isochronous Transport Protocol should only be selected if the data source
                          is frequency-locked to the SLIMbus CLK (ie. the data source is synchronised to the
                          SLIMbus Framer device).
SLIMBUS CONTROL SEQUENCES
               This section describes the messages and general protocol associated with most aspects of the
               SLIMbus system.
               Note that the SLIMbus specification permits some flexibility in Core Message support for different
               components. See “SLIMbus Interface Control” for details of which message(s) are supported on each
               of the SLIMbus devices that are present on the WM8998.
               DEVICE MANAGEMENT & CONFIGURATION
               This section describes the SLIMbus messages associated with configuring all devices on the SLIMbus
               interface.
               When the SLIMbus interface starts up, it is required that one (and only one) of the components
               provides the Manager and Framer Device functions. Other devices can request connection to the bus
               after they have gained synchronisation.
               The REPORT_PRESENT (DC, DCV) message may be issued by devices attempting to connect to
               the bus. The payload of this message contains the Device Class (DC) and Device Class Version
               (DCV) parameters, describing the type of device that is attempting to connect. This message may be
               issued     autonomously     by     the   connecting     device,   or    else   in   response     to    a
               REQUEST_SELF_ANNOUNCEMENT message from the Manager Device.
               After positively acknowledging the REPORT_PRESENT message, the Manager Device will then issue
               the ASSIGN_LOGICAL_ADDRESS (LA) message to allow the other device to connect to the bus.
               The payload of this message contains the Logical Address (LA) parameter only; this is the unique
               address by which the connected device will send and receive SLIMbus messages. The device is then
               said to be ‘enumerated’.
               Once a device has been successfully connected to the bus, the Logical Address (LA) parameter can
               be changed at any time using the CHANGE_LOGICAL_ADDRESS (LA) message.
               The RESET_DEVICE message commands an individual SLIMbus device to perform its reset
               procedure. As part of the reset, all associated ports will be reset, and any associated Data Channels
               will be cancelled. Note that, if the RESET_DEVICE command is issued to an Interface Device, it will
               cause a Component Reset (ie. all Devices within the associated component are reset). Under a
               Component Reset, every associated Device will release its Logical Address, and the Component will
               become disconnected from the bus.
               INFORMATION MANAGEMENT
               A memory map of Information Elements is defined for each Device. This is arranged in 3 x 1kByte
               blocks, comprising Core Information elements, Device Class-specific Information elements, and User
               Information elements respectively, as described in the MIPI specification. Note that the contents of the
               User Information portion for each WM8998 SLIMbus Device are reserved.
               Read/Write access is implemented using the messages described below. Specific elements within the
               Information Map are identified using the Element Code (EC) parameter. In the case of Read access, a
               unique Transaction ID (TID) is assigned to each message relating to a particular read/write request.
               The REQUEST_INFORMATION (TID, EC) message is used to instruct a device to respond with the
               indicated information. The payload of this message contains the Transaction ID (TID) and the Element
               Code (EC).
               The REQUEST_CLEAR_INFORMATION (TID, EC, CM) message is used to instruct a device to
               respond with the indicated information, and also to clear all, or parts, of the same information slice.
               The payload of this message contains the Transaction ID (TID), Element Code (EC), and Clear Mask
               (CM). The Clear Mask field is used to select which element(s) are to be cleared as part of the
               instruction.
               The REPLY_INFORMATION (TID, IS) message is used to provide readback of a requested
               parameter. The payload of this message contains the Transaction ID (TID) and the Information Slice
               (IS). The Information Slice byte(s) contain the value of the requested parameter.
Rev 4.1                                                                                                           129


                                                                                   WM8998
    The CLEAR_INFORMATION (EC, CM) message is used to clear all, or parts, of the indicated
    information slice. The payload of this message contains the Element Code (EC) and Clear Mask
    (CM). The Clear Mask field is used to select which element(s) are to be cleared as part of the
    instruction.
    The REPORT_INFORMATION (EC, IS) message is used to inform other devices about a change in a
    specified element in the Information Map. The payload of this message contains the Element Code
    (EC) and the Information Slice (IS). The Information Slice byte(s) contain the new value of the
    applicable parameter.
    VALUE MANAGEMENT (INCLUDING REGISTER ACCESS)
    A memory map of Value Elements is defined for each Device. This is arranged in 3 x 1kByte blocks,
    comprising Core Value elements, Device Class-specific Value elements, and User Value elements
    respectively, as described in the MIPI specification. These elements are typically parameters used to
    configure Device behaviour.
    The User Value elements of the Interface Device are used on WM8998 to support Read/Write access
    to the Register Map. Details of how to access specific registers are described in the “SLIMbus
    Interface Control” section.
    Note that, with the exception of the User Value elements of the Interface Device, the contents of the
    User Value portion for each WM8998 SLIMbus Device are reserved.
    Read/Write access is implemented using the messages described below. Specific elements within the
    Value Map are identified using the Element Code (EC) parameter. In the case of Read access, a
    unique Transaction ID (TID) is assigned to each message relating to a particular read/write request.
    The REQUEST_VALUE (TID, EC) message is used to instruct a device to respond with the indicated
    information. The payload of this message contains the Transaction ID (TID) and the Element Code
    (EC).
    The REPLY_VALUE (TID, VS) message is used to provide readback of a requested parameter. The
    payload of this message contains the Transaction ID (TID) and the Value Slice (VS). The Value Slice
    byte(s) contain the value of the requested parameter.
    The CHANGE_VALUE (EC, VU) message is used to write data to a specified element in the Value
    Map. The payload of this message contains the Element Code (EC) and the Value Update (VU). The
    Value Update byte(s) contain the new value of the applicable parameter.
    FRAME & CLOCKING MANAGEMENT
    This section describes the SLIMbus messages associated with changing the Frame or Clocking
    configuration. One or more configuration messages may be issued as part of a Reconfiguration
    Sequence; all of the updated parameters become active at once, when the Reconfiguration boundary
    is reached.
    The BEGIN_RECONFIGURATION message is issued to define a Reconfiguration Boundary point:
    subsequent NEXT_* messages will become active at the first valid Superframe boundary following
    receipt of the RECONFIGURE_NOW message. (A valid boundary must be at least two Slots after the
    end of the RECONFIGURE_NOW message.) Both of these messages have no payload content.
    The NEXT_ACTIVE_FRAMER (LAIF, NCo, NCi) message is used to select a new device as the
    active Framer. The payload of this message includes the Logical Address, Incoming Framer (LAIF).
    Two other fields (NCo, NCi) define the number of clock cycles for which the CLK line shall be inactive
    during the handover.
    The NEXT_SUBFRAME_MODE (SM) and NEXT_CLOCK_GEAR (CG) messages are used to re-
    configure the SLIMbus clocking or framing definition. The payload of each is the respective Subframe
    Mode (SM) or Clock Gear (CG) respectively.
    The NEXT_PAUSE_CLOCK (RT) message instructs the active Framer to pause the bus. The
    payload of the message contains the Restart Time (RT), which indicates whether the interruption is to
    be of a specified time and/or phase duration.
    The NEXT_RESET_BUS message instructs all components on the bus to be reset. In this case, all
    Devices on the bus are reset and are disconnected from the bus. Subsequent re-connection to the
    bus follows the same process as when the bus is first initialised.
    The NEXT_SHUTDOWN_BUS message instructs all devices that the bus is to be shut down.
130                                                                                              Rev 4.1


                                                                                         WM8998
        DATA CHANNEL CONFIGURATION
        This section describes the procedure for configuring a SLIMbus Data Channel. Note that the Manager
        Device is responsible for allocating the available bandwidth as required for each Data Channel.
        The CONNECT_SOURCE (PN, CN) and CONNECT_SINK (PN, CN) messages are issued to the
        respective devices, defining the Port(s) between which a Data Channel is to be established. Note that
        multiple destinations (sinks) can be configured for a channel, if required. The payload of each
        message contains the Port Number (PN) and the Channel Number (CN) parameters.
        The BEGIN_RECONFIGURATION message is issued to define a Reconfiguration Boundary point:
        subsequent NEXT_* messages will become active at the first valid Superframe boundary following
        receipt of the RECONFIGURE_NOW message. (A valid boundary must be at least two Slots after the
        end of the RECONFIGURE_NOW message.)
        The NEXT_DEFINE_CHANNEL (CN, TP, SD, SL) message informs the associated devices of the
        structure of the Data Channel. The payload of this message contains the Channel Number (CN),
        Transport Protocol (TP), Segment Distribution (SD), and the Segment Length (SL) parameters for the
        Data Channel.
        The NEXT_DEFINE_CONTENT (CN, FL, PR, AF, DT, CL, DL), or CHANGE_CONTENT (CN, FL,
        PR, AF, DT, CL, DL) message provides more detailed information about the Data Channel contents.
        The payload of this message contains the Channel Number (CN), Frequency Locked (FL), Presence
        Rate (PR), Auxiliary Bits Format (AF), Data Type (DT), Channel Link (CL), and Data Length (DL)
        parameters.
        The NEXT_ACTIVATE_CHANNEL (CN) message instructs the channel to be activated at the next
        Reconfiguration boundary. The payload of this message contains the Channel Number (CN) only.
        The RECONFIGURE_NOW message completes the Reconfiguration sequence, causing all of the
        ‘NEXT_’ messages since the BEGIN_RECONFIGURATION to become active at the next valid
        Superframe boundary. (A valid boundary must be at least two Slots after the end of the
        RECONFIGURE_NOW message.)
        Active channels can be reconfigured using the CHANGE_CONTENT, NEXT_DEFINE_CONTENT, or
        NEXT_DEFINE_CHANNEL messages. Note that these changes can be effected without interrupting
        the data channel; the NEXT_DEFINE_CHANNEL, for example, may be used to change a Segment
        Distribution, in order to reallocate the SLIMbus bandwidth.
        An active channel can be paused using the NEXT_DEACTIVATE_CHANNEL message, and re-
        instated using the NEXT_ACTIVATE_CHANNEL message.
        Data channels can be disconnected using the DISCONNECT_PORT or NEXT_REMOVE_CHANNEL
        messages. These messages provide equivalent functionality, but use different parameters (PN or CN
        respectively) to identify the affected signal path.
Rev 4.1                                                                                                 131


                                                                                                       WM8998
SLIMBUS INTERFACE CONTROL
                         The WM8998 features a MIPI-compliant SLIMbus interface, providing 4 channels of audio input and 6
                         channels of audio output. Mixed audio sample rates are supported on the SLIMbus interface. The
                         SLIMbus interface also supports read/write access to the WM8998 control registers.
                         The SLIMbus interface on WM8998 comprises a Generic Device and an Interface Device. A
                         maximum of 10 Ports can be configured, providing up to 4 input (RX) channels and up to 6 output
                         (TX) channels.
                         The audio paths associated with the SLIMbus interface are described in the “Digital Core” section.
                         The SLIMbus interface supports read/write access to the WM8998 control registers, as described later
                         in this section.
                         The SLIMbus clocking rate and channel allocations are controlled by the Manager Device. The
                         Message Channel and Data Channel bandwidth may be dynamically adjusted according to the
                         application requirements. Note that the Manager Device functions are not implemented on the
                         WM8998, and these bandwidth allocation requirements are outside the scope of this datasheet.
                         SLIMBUS DEVICE PARAMETERS
                         The SLIMbus interface on the WM8998 comprises two Devices. The Enumeration Address of each
                         Device within the SLIMbus interface is derived from the parameters noted in Table 40.
 DESCRIPTION      MANUFACTURER             PRODUCT            DEVICE ID            INSTANCE            ENUMERATION
                          ID                 CODE                                    VALUE                 ADDRESS
     Generic           0x012F               0x6349               0x00                0x00             012F_6349_0000
    Interface          0x012F               0x6349               0x7F                0x00             012F_6349_7F00
Table 40 SLIMbus Device Parameters
                         SLIMBUS MESSAGE SUPPORT
                         The SLIMbus interface on the WM8998 supports bus messages as noted in Table 41.
                         Additional notes regarding SLIMbus message support are noted below, and also in Table 42.
132                                                                                                                  Rev 4.1


                                                                                                      WM8998
MESSAGE CODE                           DESCRIPTION                             GENERIC        INTERFACE
     MC[6:0]
Device Management Messages
      0x01        REPORT_PRESENT (DC, DCV)                                        S               S
      0x02        ASSIGN_LOGICAL_ADDRESS (LA)                                     D               D
      0x04        RESET_DEVICE ()                                                 D               D
      0x08        CHANGE_LOGICAL_ADDRESS (LA)                                     D               D
      0x09        CHANGE_ARBITRATION_PRIORITY (AP)
      0x0C        REQUEST_SELF_ANNOUNCEMENT ()                                    D               D
      0x0F        REPORT_ABSENT ()
Data Channel Management Messages
      0x10        CONNECT_SOURCE (PN, CN)                                         D
      0x11        CONNECT_SINK (PN, CN)                                           D
      0x14        DISCONNECT_PORT (PN)                                            D
      0x18        CHANGE_CONTENT (CN, FL, PR, AF, DT, CL, DL)                     D
Information Management Messages
      0x20        REQUEST_INFORMATION (TID, EC)                                   D               D
      0x21        REQUEST_CLEAR_INFORMATION (TID, EC, CM)                         D               D
      0x24        REPLY_INFORMATION (TID, IS)                                     S               S
      0x28        CLEAR_INFORMATION (EC, CM)                                      D               D
      0x29        REPORT_INFORMATION (EC, IS)                                                     S
Reconfiguration Messages
      0x40        BEGIN_RECONFIGURATION ()                                        D               D
      0x44        NEXT_ACTIVE_FRAMER (LAIF, NCo, NCi)
      0x45        NEXT_SUBFRAME_MODE (SM)                                                         D
      0x46        NEXT_CLOCK_GEAR (CG)
      0x47        NEXT_ROOT_FREQUENCY (RF)
      0x4A        NEXT_PAUSE_CLOCK (RT)
      0x4B        NEXT_RESET_BUS ()
      0x4C        NEXT_SHUTDOWN_BUS ()
      0x50        NEXT_DEFINE_CHANNEL (CN, TP, SD, SL)                            D
      0x51        NEXT_DEFINE_CONTENT (CN, FL, PR, AF, DT, CL, DL)                D
      0x54        NEXT_ACTIVATE_CHANNEL (CN)                                      D
      0x55        NEXT_DEACTIVATE_CHANNEL (CN)                                    D
      0x58        NEXT_REMOVE_CHANNEL (CN)                                        D
      0x5F        RECONFIGURE_NOW ()                                              D               D
Value Management Messages
      0x60        REQUEST_VALUE (TID, EC)                                                         D
      0x61        REQUEST_CHANGE_VALUE (TID, EC, VU)
      0x64        REPLY_VALUE (TID, VS)                                                           S
      0x68        CHANGE_VALUE (EC, VU)                                                           D
Table 41 SLIMbus Message Support
                         S = supported as a Source Device only. D = supported as a Destination Device only.
                         The WM8998 SLIMbus component must be reset prior to scheduling a Hardware Reset or Power-On
                         Reset. This can be achieved using the RESET_DEVICE message (issued to the WM8998 Interface
                         Device), or else using the NEXT_RESET_BUS message.
Rev 4.1                                                                                                         133


                                                                                                     WM8998
PARAMETER                      DESCRIPTION                                        COMMENTS
   CODE
     AF        Auxiliary Bits Format
     CG        Clock Gear
     CL        Channel Link
     CM        Clear Mask                             WM8998 does not fully support this function.
                                                      The CM bytes of the REQUEST_CLEAR_INFORMATION or
                                                      CLEAR_INFORMATION messages must not be sent to WM8998
                                                      Devices. When either of these messages is received, all bits
                                                      within the specified Information Slice will be cleared.
     CN        Channel Number
     DC        Device Class
    DCV        Device Class Variation
     DL        Data Length
     DT        Data Type                              WM8998 supports the following DT codes:
                                                      0h - Not indicated
                                                      1h - LPCM audio
                                                      Note that 2’s complement PCM can be supported with DT=0h.
     EC        Element Code
     FL        Frequency Locked
      IS       Information Slice
     LA        Logical Address
    LAIF       Logical Address, Incoming Framer
     NCi       Number of Incoming Framer Clock Cycles
    NCo        Number of Outgoing Framer Clock Cycles
     PN        Port Number                            Note that the Port Numbers of the WM8998 SLIMbus paths are
                                                      register-configurable, as described in Table 43.
     PR        Presence Rate                          Note that the Presence Rate must be the same as the Sample
                                                      Rate selected for the associated WM8998 SLIMbus path.
     RF        Root Frequency
     RT        Restart Time                           WM8998 supports the following RT codes:
                                                      0h -Fast Recovery
                                                      2h - Unspecified Delay
                                                      When either of these values is specified, the WM8998 will
                                                      resume toggling the CLK line within four cycles of the CLK line
                                                      frequency.
     SD        Segment Distribution                   Note that any data channels that are assigned the same
                                                      SAMPLE_RATE_n or ASYNC_SAMPLE_RATE_n value must
                                                      also be assigned the same Segment Interval.
     SL        Segment Length
     SM        Subframe Mode
     TID       Transaction ID
     TP        Transport Protocol                     WM8998 supports the following TP codes for TX channels:
                                                      0h - Isochronous Protocol
                                                      1h - Pushed Protocol
                                                      WM8998 supports the following TP codes for RX channels:
                                                      0h - Isochronous Protocol
                                                      2h - Pulled Protocol
     VS        Value Slice
     VU        Value Update
Table 42 SLIMbus Parameter Support
134                                                                                                            Rev 4.1


                                                                                     WM8998
        SLIMBUS PORT NUMBER CONTROL
        The WM8998 SLIMbus interface supports up to 4 input (RX) channels and up to 6 output (TX)
        channels. The SLIMbus port numbers for these audio channels are configurable using the registers
        described in Table 43.
           REGISTER      BIT        LABEL            DEFAULT                    DESCRIPTION
           ADDRESS
          R1490        13:8    SLIMRX2_PORT              1       SLIMbus RX Channel n Port number
          (05D2h)              _ADDR [5:0]                       Valid from 0..63
          SLIMbus       5:0    SLIMRX1_PORT              0
          RX Ports0            _ADDR [5:0]
          R1491        13:8    SLIMRX4_PORT              3
          (05D3h)              _ADDR [5:0]
          SLIMbus       5:0    SLIMRX3_PORT              2
          RX Ports1            _ADDR [5:0]
          R1494        13:8    SLIMTX2_PORT              9       SLIMbus TX Channel n Port number
          (05D6h)              _ADDR [5:0]                       Valid from 0..63
          SLIMbus       5:0    SLIMTX1_PORT              8
          TX Ports0            _ADDR [5:0]
          R1495        13:8    SLIMTX4_PORT             11
          (05D7h)              _ADDR [5:0]
          SLIMbus       5:0    SLIMTX3_PORT             10
          TX Ports1            _ADDR [5:0]
          R1496        13:8    SLIMTX6_PORT             13
          (05D8)               _ADDR [5:0]
          SLIMbus       5:0    SLIMTX5_PORT             12
          TX Ports2            _ADDR [5:0]
        Table 43 SLIMbus Port Numbers
        SLIMBUS SAMPLE RATE CONTROL
        The SLIMbus RX inputs may be selected as input to the digital mixers or signal processing functions
        within the WM8998 digital core. The SLIMbus TX outputs are derived from the respective output
        mixers.
        The sample rate for each SLIMbus channel is configured using the SLIMRXn_RATE and
        SLIMTXn_RATE registers - see Table 19 within the “Digital Core” section.
        Note that the SLIMbus interface provides simultaneous support for SYSCLK-referenced and
        ASYNCCLK-referenced sample rates on different channels. For example, 48kHz and 44.1kHz
        SLIMbus audio paths can be simultaneously supported.
        Sample rate conversion is required when routing the SLIMbus paths to any signal chain that is
        asynchronous and/or configured for a different sample rate.
Rev 4.1                                                                                               135


                                                                                     WM8998
    SLIMBUS SIGNAL PATH ENABLE
    The SLIMbus interface supports up to 4 input (RX) channels and up to 6 output (TX) channels. Each
    of these channels can be enabled or disabled using the register bits defined in Table 44.
    Note that the SLIMbus audio channels can only be supported when the corresponding ports have
    been enabled by the Manager Device (ie. in addition to setting the respective enable bits). The status
    bits in Registers R1527 and R1528 indicate the status of each of the SLIMbus ports.
    The system clock, SYSCLK, must be configured and enabled before any audio path is enabled. The
    ASYNCCLK may also be required, depending on the path configuration. See “Clocking and Sample
    Rates” for details of the system clocks.
      REGISTER        BIT              LABEL           DEFAULT                   DESCRIPTION
      ADDRESS
      R1525            3      SLIMRX4_ENA                  0        SLIMbus RX Channel n Enable
      (05F5h)          2      SLIMRX3_ENA                  0        0 = Disabled
      SLIMbus                                                       1 = Enabled
                       1      SLIMRX2_ENA                  0
      RX
      Channel          0      SLIMRX1_ENA                  0
      Enable
      R1526            5      SLIMTX6_ENA                  0        SLIMbus TX Channel n Enable
      (05F6h)          4      SLIMTX5_ENA                  0        0 = Disabled
      SLIMbus                                                       1 = Enabled
                       3      SLIMTX4_ENA                  0
      TX
      Channel          2      SLIMTX3_ENA                  0
      Enable           1      SLIMTX2_ENA                  0
                       0      SLIMTX1_ENA                  0
      R1527            3      SLIMRX4_PORT_STS             0        SLIMbus RX Channel n Port Status
      (05F7h)          2      SLIMRX3_PORT_STS             0        (Read only)
      SLIMbus                                                       0 = Disabled
                       1      SLIMRX2_PORT_STS             0
      RX Port                                                       1 = Configured and active
      Status           0      SLIMRX1_PORT_STS             0
      R1528            5      SLIMTX6_PORT_STS             0        SLIMbus TX Channel n Port Status
      (05F8h)          4      SLIMTX5_PORT_STS             0        (Read only)
      SLIMbus                                                       0 = Disabled
                       3      SLIMTX4_PORT_STS             0
      TX Port                                                       1 = Configured and active
      Status           2      SLIMTX3_PORT_STS             0
                       1      SLIMTX2_PORT_STS             0
                       0      SLIMTX1_PORT_STS             0
    Table 44 SLIMbus Signal Path Enable
136                                                                                              Rev 4.1


                                                                                            WM8998
        SLIMBUS CONTROL REGISTER ACCESS
        Control register access is supported via the SLIMbus interface. Full read/write access to all registers
        is possible, via the “User Value Elements” portion of the Value Map.
        Register Write operations are implemented using the “CHANGE_VALUE” message. A maximum of
        two messages may be required, depending on circumstances: the first “CHANGE_VALUE” message
        selects the register page (bits [23:8] of the Control Register address); the second message contains
        the data and bits [7:0] of the register address. The first message may be omitted if the register page is
        unchanged from the previous Read or Write operation.
        The associated parameters are described in Table 45 and Table 46, for the generic case of writing the
        value 0xVVVV to control register address 0xYYYYZZ.
          Write Message 1 – CHANGE_VALUE
                PARAMETER                   VALUE                              DESCRIPTION
          Source Address               0xSS               ‘SS’ is the 8-bit Logical Address of the message
                                                          source. This could be any active device on the bus,
                                                          but is typically the Manager Device (0xFF).
          Destination Address          0xLL               ‘LL’ is the 8-bit Logical Address of the message
                                                          destination (ie. the WM8998 SLIMbus Interface
                                                          Device). The value is assigned by the SLIMbus
                                                          Manager Device.
          Access Mode                  0b1                Selects Byte-based access mode.
          Byte Address                 0x800              Identifies the User Value element for selecting the
                                                          Control Register page address.
          Slice Size                   0b001              Selects 2-byte slice size
          Value Update                 0xYYYY             ‘YYYY’ is bits [23:8] of the applicable Control
                                                          Register address.
        Table 45 Register Write Message (1)
          Write Message 2 – CHANGE_VALUE
                PARAMETER                   VALUE                              DESCRIPTION
          Source Address               0xSS               ‘SS’ is the 8-bit Logical Address of the message
                                                          source. This could be any active device on the bus,
                                                          but is typically the Manager Device (0xFF).
          Destination Address          0xLL               ‘LL’ is the 8-bit Logical Address of the message
                                                          destination (ie. the WM8998 SLIMbus Interface
                                                          Device). The value is assigned by the SLIMbus
                                                          Manager Device.
          Access Mode                  0b1                Selects Byte-based access mode.
          Byte Address                 0xUUU              Specifies the Value Map address, calculated as
                                                          0xA00 + (2 x 0xZZ), where ‘ZZ’ is bits [7:0] of the
                                                          applicable Control Register address.
          Slice Size                   0b001              Selects 2-byte slice size
          Value Update                 0xVVVV             ‘VVVV’ is the 16-bit data to be written.
        Table 46 Register Write Message (2)
        Note that the first message may be omitted if its contents are unchanged from the previous
        CHANGE_VALUE message sent to the WM8998.
Rev 4.1                                                                                                       137


                                                                                      WM8998
    Register Read operations are implemented using the “CHANGE_VALUE” and “REQUEST_VALUE”
    messages. A maximum of two messages may be required, depending on circumstances: the
    “CHANGE_VALUE” message selects the register page (bits [23:8] of the Control Register address);
    the “REQUEST_VALUE” message contains bits [7:0] of the register address. The first message may
    be omitted if the register page is unchanged from the previous Read or Write operation.
    The associated parameters are described in Table 47 and Table 48, for the generic case of reading
    the contents of control register address 0xYYYYZZ.
       Read Message 1 – CHANGE_VALUE
             PARAMETER                  VALUE                            DESCRIPTION
       Source Address             0xSS              ‘SS’ is the 8-bit Logical Address of the message
                                                    source. This could be any active device on the bus,
                                                    but is typically the Manager Device (0xFF).
       Destination Address        0xLL              ‘LL’ is the 8-bit Logical Address of the message
                                                    destination (ie. the WM8998 SLIMbus Interface
                                                    Device). The value is assigned by the SLIMbus
                                                    Manager Device.
       Access Mode                0b1               Selects Byte-based access mode.
       Byte Address               0x800             Identifies the User Value element for selecting the
                                                    Control Register page address.
       Slice Size                 0b001             Selects 2-byte slice size
       Value Update               0xYYYY            ‘YYYY’ is bits [23:8] of the applicable Control
                                                    Register address.
    Table 47 Register Read Message (1)
       Read Message 2 – REQUEST_VALUE
             PARAMETER                  VALUE                            DESCRIPTION
       Source Address             0xSS              ‘SS’ is the 8-bit Logical Address of the message
                                                    source. This could be any active device on the bus,
                                                    but is typically the Manager Device (0xFF).
       Destination Address        0xLL              ‘LL’ is the 8-bit Logical Address of the message
                                                    destination (ie. the WM8998 SLIMbus Interface
                                                    Device). The value is assigned by the SLIMbus
                                                    Manager Device.
       Access Mode                0b1               Selects Byte-based access mode.
       Byte Address               0xUUU             Specifies the Value Map address, calculated as
                                                    0xA00 + (2 x 0xZZ), where ‘ZZ’ is bits [7:0] of the
                                                    applicable Control Register address.
       Slice Size                 0b001             Selects 2-byte slice size
       Transaction ID             0xTTTT            ‘TTTT’ is the 16-bit Transaction ID for the
                                                    message. The value is assigned by the SLIMbus
                                                    Manager Device.
    Table 48 Register Read Message (2)
    Note that the first message may be omitted if its contents are unchanged from the previous
    CHANGE_VALUE message sent to the WM8998.
    The WM8998 will respond to the Register Read commands in accordance with the normal SLIMbus
    protocols.
    Note that the WM8998 assumes that sufficient Control Space Slots are available in which to provide
    its response before the next REQUEST_VALUE message is received. The WM8998 response is
    made using a REPLY_VALUE message; the SLIMbus Manager should wait until the REPLY_VALUE
    message has been received before sending the next REQUEST_VALUE message. If additional
    REQUEST_VALUE message(s) are received before the WM8998 response has been made, then the
    earlier REQUEST_VALUE message(s) will be ignored (ie. only the last REQUEST_VALUE message
    will be serviced)
138                                                                                                Rev 4.1


                                                                                       WM8998
        SLIMBUS CLOCKING CONTROL
        The clock frequency of the SLIMbus interface is not fixed, and may be set according to the application
        requirements. The clock frequency can be reconfigured dynamically as required.
        The WM8998 SLIMbus interface does not include a Framer Device. Accordingly, the SLIMCLK pin is
        always an input pin on the WM8998.
        The supported Root Frequencies are as defined in the MIPI Alliance specification for SLIMbus.
        Under normal operating conditions, the SLIMbus interface operates with a fixed Root Frequency (RF);
        dynamic updates to the bus rate are applied using a selectable Clock Gear (CG) function. The Root
        Frequency and the Clock Gear setting are controlled by the Manager Device; these parameters are
        transmitted in every SLIMbus superframe to all devices on the bus.
        In Gear 10 (the highest Clock Gear setting), the SLIMCLK input frequency is equal to the Root
        Frequency. In lower gears, the SLIMCLK frequency is reduced by increasing powers of 2.
        The Clock Gear definition is shown in Table 49. Note that 24.576MHz Root Frequency is an example
        only; other frequencies are also supported.
              CLOCK GEAR            DESCRIPTION                        SLIMCLK FREQUENCY
                                                               (assuming 24.576MHz Root Frequency)
                   10                 Divide by 1                           24.576MHz
                    9                 Divide by 2                           12.288MHz
                    8                 Divide by 4                            6.144MHz
                    7                 Divide by 8                            3.072MHz
                    6                Divide by 16                            1.536MHz
                    5                Divide by 32                             768kHz
                    4                Divide by 64                             384kHz
                    3               Divide by 128                             192kHz
                    2               Divide by 256                              96kHz
                    1               Divide by 512                              48kHz
        Table 49 SLIMbus Clock Gear Selection
        The SLIMCLK input can be used to provide a reference source for the Frequency Locked Loops
        (FLLs). The frequency of this reference is controlled using the SLIMCLK_REF_GEAR register, as
        described in Table 50.
        The SLIMbus clock reference is generated using an adaptive divider on the SLIMCLK input. The
        divider automatically adapts to the SLIMbus Clock Gear (CG), giving a constant reference frequency
        for the FLL input.
        Note that, if the Clock Gear (CG) on the bus is lower than the SLIMCLK_REF_GEAR, then the
        selected reference frequency cannot be supported, and the SLIMbus clock reference is disabled.
        The SLIMbus clock reference is selected as input to the FLLs using the FLLn_REFCLK_SRC
        registers. See “Clocking and Sample Rates” for details of system clocking and the FLLs.
Rev 4.1                                                                                                  139


                                                                        WM8998
     REGISTER      BIT       LABEL         DEFAULT                DESCRIPTION
     ADDRESS
     R1507        3:0   SLIMCLK_REF_         4h    SLIMbus Clock Reference control.
     (05E3h)            GEAR [3:0]                 Sets the SLIMbus reference clock relative
     SLIMbus                                       to the SLIMbus Root Frequency (RF).
     Framer                                        0h = Clock stopped
     Ref Gear                                      1h = Gear 1 (RF / 512)
                                                   2h = Gear 2 (RF / 256)
                                                   3h = Gear 3 (RF / 128)
                                                   4h = Gear 4 (RF / 64)
                                                   5h = Gear 5 (RF / 32)
                                                   6h = Gear 6 (RF / 16)
                                                   7h = Gear 7 (RF / 8)
                                                   8h = Gear 8 (RF / 4)
                                                   9h = Gear 9 (RF / 2)
                                                   Ah = Gear 10 (RF)
                                                   All other codes are Reserved
    Table 50 SLIMbus Clock Reference Control
140                                                                                 Rev 4.1


                                                                                                   WM8998
OUTPUT SIGNAL PATH
                The WM8998 provides four stereo and one mono analogue output signal paths. These outputs
                comprise a ground-referenced headphone driver, ground-referenced line output driver, differential
                earpiece driver, differential speaker drivers and a digital output interface suitable for external speaker
                drivers. The output signal paths are summarised in Table 51.
                      SIGNAL PATH                           DESCRIPTIONS                          OUTPUT PINS
                     OUT1L, OUT1R             Ground-referenced headphone output          HPOUTL, HPOUTR
                     OUT2L, OUT2R                 Ground-referenced line output           LINEOUTL, LINEOUTR
                          OUT3                   Differential (BTL) earpiece output       EPOUTP, EPOUTN
                     OUT4L, OUT4R                    Differential speaker output          SPKOUTLN, SPKOUTLP,
                                                                                          SPKOUTRP, SPKOUTRN
                     OUT5L, OUT5R                  Digital speaker (PDM) output           SPKDAT, SPKCLK
                Table 51 Output Signal Path Summary
                The analogue output paths incorporate high performance 24-bit sigma-delta DACs.
                Under default conditions, the headphone and line drivers each provide a stereo, single-ended output.
                A mono mode is also available on these outputs, providing a differential (BTL) configuration. The
                ground-referenced headphone and line output paths incorporate a common mode feedback path for
                rejection of system-related noise. These outputs support direct connection to external loads, with no
                requirement for AC coupling capacitors.
                The earpiece path provides a differential (BTL) output, suitable for a typical earpiece load. The
                differential configuration offers built-in common mode noise rejection.
                The speaker output paths are configured to drive a stereo pair of differential (BTL) outputs. The Class
                D design offers high efficiency at large signal levels. With a suitable choice of external speaker, the
                Class D output can drive loudspeakers directly, without any additional filter components.
                The digital output path provides a stereo Pulse Density Modulation (PDM) output interface, for
                connection to external audio devices.
                Digital volume control is available on all outputs (analogue and digital), with programmable ramp
                control for smooth, glitch-free operation. Any two of the output signal paths may be selected as input
                to the Acoustic Echo Cancellation (AEC) loopback paths.
                The WM8998 output signal paths are illustrated in Figure 51.
Rev 4.1                                                                                                               141


                                                                                               WM8998
                                                   OUT1_OSR
         Digital Core                              0 = Normal mode
                                                   1 = High Performance mode
          OUT1L output                                       DAC                                         HPOUTL
                         OUT1L_VOL [6:0]                                              HPL_ENA
                                                   OUT1_MONO
                                                             DAC                                         HPOUTR
         OUT1R output
                                                                                      HPR_ENA
                         OUT1R_VOL [6:0]
                                                   OUT2_OSR
                                                   0 = Normal mode
                                                   1 = High Performance mode
          OUT2L output                                       DAC                                         LINEOUTL
                         OUT2L_VOL [6:0]                                              LINEL_ENA
                                                   OUT2_MONO
                                                             DAC                                         LINEOUTR
         OUT2R output
                                                                                      LINER_ENA
                         OUT2R_VOL [6:0]
                                                                                                         EPOUTP
          OUT3L output                                       DAC
                                                                                                         EPOUTN
                         OUT3_VOL [6:0]
                                                                                     EP_ENA
                                                   OUT4_OSR
                                                   0 = Normal mode
                                                   1 = High Performance mode
                                                                                                         SPKOUTLP
          OUT4L output                                       DAC
                                                                                                         SPKOUTLN
                         OUT4L_VOL [6:0]                                         OUT4L_ENA
                                                                                                         SPKOUTRP
         OUT4R output                                        DAC
                                                                                                         SPKOUTRN
                         OUT4R_VOL [6:0]                                         OUT4R_ENA
          OUT5L output                                                              OUT5_OSR
                                                                                    0 = Normal mode
                                                                SPK1L_MUTE          1 = High Performance
                         OUT5L_VOL [6:0]
                                                                                       PDM Output        SPKCLK
                                                                                           Driver        SPKDAT
                                                                                          SPK1_FMT
                                                                                         OUT5L_ENA
         OUT5R output
                                                                                         OUT5R_ENA
                                                                SPK1R_MUTE
                         OUT5R_VOL [6:0]
                                                                                       SPK1_MUTE_ENDIAN
                                                                    Mute Sequence
                                                                                       SPK1_MUTE_SEQ
                    AEC    AEC1_LOOPBACK_ENA
              Loopback     AEC1_LOOPBACK_SRC [1:0]
                  inputs
                           AEC2_LOOPBACK_ENA
                           AEC2_LOOPBACK_SRC [1:0]
    Figure 51 Output Signal Paths
142                                                                                                        Rev 4.1


                                                                                          WM8998
        OUTPUT SIGNAL PATH ENABLE
        The output signal paths are enabled using the register bits described in Table 52. The respective
        bit(s) must be enabled for analogue or digital output on the respective output path(s).
        The output signal paths are muted by default. It is recommended that de-selecting the mute should be
        the final step of the path enable control sequence. Similarly, the mute should be selected as the first
        step of the path disable control sequence. The output signal path mute functions are controlled using
        the register bits described in Table 57.
        The supply rails for outputs (OUT1, OUT2 and OUT3) are generated using an integrated dual-mode
        Charge Pump, CP1. The Charge Pump is enabled automatically by the WM8998 when required by
        the output drivers. See the “Charge Pumps, Regulators and Voltage Reference” section for further
        details.
        Note that, to support HPOUT single-ended loads less than 15Ω, or HPOUT/EPOUT differential (BTL)
        loads less than 30Ω, the Charge Pump (CP1) must be configured for low impedance operation, as
        described in Table 53.
        The WM8998 schedules a pop-suppressed control sequence to enable or disable the OUT1, OUT2,
        OUT3 and OUT4 signal paths. This is automatically managed in response to setting the respective
        HPx_ENA, LINEx_ENA, EP_ENA, or SPKOUTx_ENA register bits. See “Control Write Sequencer” for
        further details.
        The output signal path enable/disable control sequences are inputs to the Interrupt circuit, and can be
        used to trigger an Interrupt event when a sequence completes. See “Interrupts” for further details.
        The output signal path enable/disable control sequences can also generate a GPIO output, providing
        an external indication of the sequence status. See “General Purpose Input / Output” to configure a
        GPIO pin for this function.
        The system clock, SYSCLK, must be configured and enabled before any audio path is enabled. The
        ASYNCCLK may also be required, depending on the path configuration. See “Clocking and Sample
        Rates” for details of the system clocks.
        The WM8998 performs automatic checks to confirm that the SYSCLK frequency is high enough to
        support the output signal paths and associated DACs. If an attempt is made to enable an output
        signal path, and there are insufficient SYSCLK cycles to support it, then the attempt will be
        unsuccessful. (Note that any signal paths that are already active will not be affected under these
        circumstances.)
        The Underclocked Error condition can be monitored using the GPIO and/or Interrupt functions. See
        “General Purpose Input / Output” and “Interrupts” for further details.
        The status bits in Register R1025 and R1030 indicate the status of each of the output signal paths. If
        an Underclocked Error condition occurs, then these bits provide readback of which signal path(s)
        have been successfully enabled.
           REGISTER        BIT          LABEL          DEFAULT                    DESCRIPTION
           ADDRESS
          R1024            9      OUT5L_ENA                0        Output Path 5 (Left) Enable
          (0400h)                                                   0 = Disabled
          Output                                                    1 = Enabled
          Enables 1        8      OUT5R_ENA                0        Output Path 5 (Right) Enable
                                                                    0 = Disabled
                                                                    1 = Enabled
                           7      SPKOUTL_ENA              0        Output Path 4 (Left) Enable
                                                                    0 = Disabled
                                                                    1 = Enabled
                           6      SPKOUTR_ENA              0        Output Path 4 (Right) Enable
                                                                    0 = Disabled
                                                                    1 = Enabled
                           5      EP_ENA                   0        Output Path 3 Enable
                                                                    0 = Disabled
                                                                    1 = Enabled
                           3      LINEL_ENA                0        Output Path 2 (Left) Enable
                                                                    0 = Disabled
                                                                    1 = Enabled
Rev 4.1                                                                                                     143


                                                                     WM8998
      REGISTER     BIT         LABEL   DEFAULT               DESCRIPTION
      ADDRESS
                   2     LINER_ENA       0     Output Path 2 (Right) Enable
                                               0 = Disabled
                                               1 = Enabled
                   1     HPL_ENA         0     Output Path 1 (Left) Enable
                                               0 = Disabled
                                               1 = Enabled
                   0     HPR_ENA         0     Output Path 1 (Right) Enable
                                               0 = Disabled
                                               1 = Enabled
     R1025         9     OUT5L_ENA_ST    0     Output Path 5 (Left) Enable Status
     (0401h)             S                     0 = Disabled
     Output                                    1 = Enabled
     Status 1      8     OUT5R_ENA_ST    0     Output Path 5 (Right) Enable Status
                         S                     0 = Disabled
                                               1 = Enabled
                   7     OUT4L_ENA_ST    0     Output Path 4 (Left) Enable Status
                         S                     0 = Disabled
                                               1 = Enabled
                   6     OUT4R_ENA_ST    0     Output Path 4 (Right) Enable Status
                         S                     0 = Disabled
                                               1 = Enabled
     R1030         5     OUT3_ENA_STS    0     Output Path 3 Enable Status
     (0406h)                                   0 = Disabled
     Raw                                       1 = Enabled
     Output        3     OUT2L_ENA_ST    0     Output Path 2 (Left) Enable Status
     Status 1            S                     0 = Disabled
                                               1 = Enabled
                   2     OUT2R_ENA_ST    0     Output Path 2 (Right) Enable Status
                         S                     0 = Disabled
                                               1 = Enabled
                   1     OUT1L_ENA_ST    0     Output Path 1 (Left) Enable Status
                         S                     0 = Disabled
                                               1 = Enabled
                   0     OUT1R_ENA_ST    0     Output Path 1 (Right) Enable Status
                         S                     0 = Disabled
                                               1 = Enabled
    Table 52 Output Signal Path Enable
144                                                                              Rev 4.1


                                                                                        WM8998
        Note that, to support HPOUT single-ended loads less than 15Ω, or HPOUT/EPOUT differential (BTL)
        loads less than 30Ω, the Charge Pump (CP1) must be configured for low impedance operation, as
        described in Table 53.
        Note that the low impedance mode, when required, should be configured before enabling any of the
        OUT1, OUT2 or OUT3 signal paths.
                      LOW IMPEDANCE MODE CONFIGURATION
               1       Write 0x0C01 to Register R1132 (0x046C)
               2       Write 0x0C01 to Register R1134 (0x046E)
               3       Write 0x0C01 to Register R1136 (0x0470)
        Table 53 Charge Pump (CP1) Configuration for Low Impedance operation
        For optimal power consumption, it is recommended to use the default Charge Pump (CP1)
        configuration whenever possible (ie. excluding the conditions described above). The default Charge
        Pump operation can be configured using the control sequence described in Table 54.
        Note that the following control sequence is only required if Low Impedance operation has previously
        been selected. The OUT1, OUT2 and OUT3 signal paths should all be disabled when changing the
        Charge Pump configuration.
                           NORMAL MODE CONFIGURATION
               1       Write 0x0801 to Register R1132 (0x046C)
               2       Write 0x0801 to Register R1134 (0x046E)
               3       Write 0x0801 to Register R1136 (0x0470)
        Table 54 Charge Pump (CP1) Configuration for Normal operation
        OUTPUT SIGNAL PATH SAMPLE RATE CONTROL
        The output signal paths are derived from the respective output mixers within the WM8998 digital core.
        The sample rate for the output signal paths is configured using the OUT_RATE register - see Table
        19 within the “Digital Core” section.
        Note that sample rate conversion is required when routing the output signal paths to any signal chain
        that is asynchronous and/or configured for a different sample rate.
Rev 4.1                                                                                                  145


                                                                                WM8998
    OUTPUT SIGNAL PATH CONTROL
    A high performance mode can be selected on the output signal paths by setting the OUTn_OSR bit
    for the respective paths. When the OUTn_OSR bit is set, the audio performance is improved, but
    power consumption is also increased. It is recommended to always select the high performance
    setting (OUTn_OSR = 1) for Output Path 1 and Output Path 2.
    The SPKCLK frequency of the PDM output path (OUT5) is controlled by the OUT5_OSR register, as
    described in Table 55. When the OUT5_OSR bit is set, the audio performance is improved, but power
    consumption is also increased.
    Note that the SPKCLK frequencies noted in Table 55 assume that the SYSCLK frequency is a
    multiple of 6.144MHz (SYSCLK_FRAC=0). If the SYSCLK frequency is a multiple of 5.6448MHz
    (SYSCLK_FRAC=1), then the SPKCLK frequencies will be scaled accordingly.
                   CONDITION                       SPKCLK FREQUENCY
                 OUT5_OSR = 0                            3.072MHz
                 OUT5_OSR = 1                            6.144MHz
    Table 55 SPKCLK Frequency
      REGISTER       BIT         LABEL         DEFAULT                   DESCRIPTION
      ADDRESS
      R1040          13     OUT1_OSR              0        Output Path 1 Oversample Rate
      (0410h)                                              0 = Normal mode
      Output                                               1 = High Performance mode
      Path
      Config 1L
      R1048          13     OUT2_OSR              0        Output Path 2 Oversample Rate
      (0418h)                                              0 = Normal mode
      Output                                               1 = High Performance mode
      Path
      Config 2L
      R1064          13     OUT4_OSR              0        Output Path 4 Oversample Rate
      (0428h)                                              0 = Normal mode
      Output                                               1 = High Performance mode
      Path
      Config 4L
      R1072          13     OUT5_OSR              0        Output Path 5 Oversample Rate
      (0430h)                                              0 = Normal mode
      Output                                               1 = High Performance mode
      Path
      Config 5L
    Table 56 Output Signal Path Control
146                                                                                         Rev 4.1


                                                                                             WM8998
        OUTPUT SIGNAL PATH DIGITAL VOLUME CONTROL
        A digital volume control is provided on each of the output signal paths, providing -64dB to +31.5dB
        gain control in 0.5dB steps. An independent mute control is also provided for each output signal path.
        Whenever the gain or mute setting is changed, the signal path gain is ramped up or down to the new
        settings at a programmable rate. For increasing gain (or un-mute), the rate is controlled by the
        OUT_VI_RAMP register. For decreasing gain (or mute), the rate is controlled by the OUT_VD_RAMP
        register. Note that the OUT_VI_RAMP and OUT_VD_RAMP registers should not be changed while a
        volume ramp is in progress.
        The OUT_VU bits control the loading of the output signal path digital volume and mute controls. When
        OUT_VU is set to 0, the digital volume and mute settings will be loaded into the respective control
        register, but will not actually change the signal path gain. The digital volume and mute settings on all
        of the output signal paths are updated when a 1 is written to OUT_VU. This makes it possible to
        update the gain of multiple signal paths simultaneously.
        For correct gain ramp behaviour, the OUT_VU bits should not be written during the 0.28ms after any
        of the output path enable bits (see Table 52) have been asserted. It is recommended that the output
        path mute bit be set when the respective output driver is enabled; the signal path can then be un-
        muted after the 0.28ms has elapsed.
        Note that, although the digital volume control registers provide 0.5dB steps, the internal circuits
        provide signal gain adjustment in 0.125dB steps. This allows a very high degree of gain control, and
        smooth volume ramping under all operating conditions.
        The 0dBFS level of the OUT5 digital output path is not equal to the 0dBFS level of the WM8998 digital
        core. The maximum digital output level is -6dBFS (see “Electrical Characteristics”). Under 0dBFS gain
        conditions, a 0dBFS output from the digital core corresponds to a -6dBFS level in the PDM output.
        The digital volume control register fields are described in Table 57 and Table 58.
           REGISTER         BIT          LABEL          DEFAULT                      DESCRIPTION
           ADDRESS
          R1033            6:4    OUT_VD_RAMP             010        Output Volume Decreasing Ramp Rate
          (0409h)                 [2:0]                              (seconds/6dB)
          Output                                                     000 = 0ms
          Volume                                                     001 = 0.5ms
          Ramp                                                       010 = 1ms
                                                                     011 = 2ms
                                                                     100 = 4ms
                                                                     101 = 8ms
                                                                     110 = 15ms
                                                                     111 = 30ms
                                                                     This register should not be changed while
                                                                     a volume ramp is in progress.
                           2:0    OUT_VI_RAMP             010        Output Volume Increasing Ramp Rate
                                  [2:0]                              (seconds/6dB)
                                                                     000 = 0ms
                                                                     001 = 0.5ms
                                                                     010 = 1ms
                                                                     011 = 2ms
                                                                     100 = 4ms
                                                                     101 = 8ms
                                                                     110 = 15ms
                                                                     111 = 30ms
                                                                     This register should not be changed while
                                                                     a volume ramp is in progress.
          R1041             9     OUT_VU                             Output Signal Paths Volume Update
          (0411h)                                                    Writing a 1 to this bit will cause the Output
          DAC                                                        Signal Paths Volume and Mute settings to
          Digital                                                    be updated simultaneously
          Volume 1L         8     OUT1L_MUTE               1         Output Path 1 (Left) Digital Mute
                                                                     0 = Un-mute
                                                                     1 = Mute
Rev 4.1                                                                                                        147


                                                                   WM8998
     REGISTER  BIT       LABEL     DEFAULT                 DESCRIPTION
     ADDRESS
              7:0  OUT1L_VOL [7:0]  80h    Output Path 1 (Left) Digital Volume
                                           -64dB to +31.5dB in 0.5dB steps
                                           00h = -64dB
                                           01h = -63.5dB
                                           … (0.5dB steps)
                                           80h = 0dB
                                           … (0.5dB steps)
                                           BFh = +31.5dB
                                           C0h to FFh = Reserved
                                           (See Table 58 for volume range)
    R1045      9   OUT_VU                  Output Signal Paths Volume Update
    (0415h)                                Writing a 1 to this bit will cause the Output
    DAC                                    Signal Paths Volume and Mute settings to
    Digital                                be updated simultaneously
    Volume     8   OUT1R_MUTE        1     Output Path 1 (Right) Digital Mute
    1R                                     0 = Un-mute
                                           1 = Mute
              7:0  OUT1R_VOL        80h    Output Path 1 (Right) Digital Volume
                   [7:0]                   -64dB to +31.5dB in 0.5dB steps
                                           00h = -64dB
                                           01h = -63.5dB
                                           … (0.5dB steps)
                                           80h = 0dB
                                           … (0.5dB steps)
                                           BFh = +31.5dB
                                           C0h to FFh = Reserved
                                           (See Table 58 for volume range)
    R1049      9   OUT_VU                  Output Signal Paths Volume Update
    (0419h)                                Writing a 1 to this bit will cause the Output
    DAC                                    Signal Paths Volume and Mute settings to
    Digital                                be updated simultaneously
    Volume 2L  8   OUT2L_MUTE        1     Output Path 2 (Left) Digital Mute
                                           0 = Un-mute
                                           1 = Mute
              7:0  OUT2L_VOL [7:0]  80h    Output Path 2 (Left) Digital Volume
                                           -64dB to +31.5dB in 0.5dB steps
                                           00h = -64dB
                                           01h = -63.5dB
                                           … (0.5dB steps)
                                           80h = 0dB
                                           … (0.5dB steps)
                                           BFh = +31.5dB
                                           C0h to FFh = Reserved
                                           (See Table 58 for volume range)
    R1053      9   OUT_VU                  Output Signal Paths Volume Update
    (041Dh)                                Writing a 1 to this bit will cause the Output
    DAC                                    Signal Paths Volume and Mute settings to
    Digital                                be updated simultaneously
    Volume     8   OUT2R_MUTE        1     Output Path 2 (Right) Digital Mute
    2R                                     0 = Un-mute
                                           1 = Mute
148                                                                              Rev 4.1


                                                                       WM8998
         REGISTER  BIT       LABEL     DEFAULT                 DESCRIPTION
         ADDRESS
                  7:0  OUT2R_VOL        80h    Output Path 2 (Right) Digital Volume
                       [7:0]                   -64dB to +31.5dB in 0.5dB steps
                                               00h = -64dB
                                               01h = -63.5dB
                                               … (0.5dB steps)
                                               80h = 0dB
                                               … (0.5dB steps)
                                               BFh = +31.5dB
                                               C0h to FFh = Reserved
                                               (See Table 58 for volume range)
        R1057      9   OUT_VU                  Output Signal Paths Volume Update
        (0421h)                                Writing a 1 to this bit will cause the Output
        DAC                                    Signal Paths Volume and Mute settings to
        Digital                                be updated simultaneously
        Volume 3L  8   OUT3_MUTE         1     Output Path 3 Digital Mute
                                               0 = Un-mute
                                               1 = Mute
                  7:0  OUT3_VOL [7:0]   80h    Output Path 3 Digital Volume
                                               -64dB to +31.5dB in 0.5dB steps
                                               00h = -64dB
                                               01h = -63.5dB
                                               … (0.5dB steps)
                                               80h = 0dB
                                               … (0.5dB steps)
                                               BFh = +31.5dB
                                               C0h to FFh = Reserved
                                               (See Table 58 for volume range)
        R1065      9   OUT_VU                  Output Signal Paths Volume Update
        (0429h)                                Writing a 1 to this bit will cause the Output
        DAC                                    Signal Paths Volume and Mute settings to
        Digital                                be updated simultaneously
        Volume 4L  8   OUT4L_MUTE        1     Output Path 4 (Left) Digital Mute
                                               0 = Un-mute
                                               1 = Mute
                  7:0  OUT4L_VOL [7:0]  80h    Output Path 4 (Left) Digital Volume
                                               -64dB to +31.5dB in 0.5dB steps
                                               00h = -64dB
                                               01h = -63.5dB
                                               … (0.5dB steps)
                                               80h = 0dB
                                               … (0.5dB steps)
                                               BFh = +31.5dB
                                               C0h to FFh = Reserved
                                               (See Table 58 for volume range)
        R1069      9   OUT_VU                  Output Signal Paths Volume Update
        (042Dh)                                Writing a 1 to this bit will cause the Output
        DAC                                    Signal Paths Volume and Mute settings to
        Digital                                be updated simultaneously
        Volume     8   OUT4R_MUTE        1     Output Path 4 (Right) Digital Mute
        4R                                     0 = Un-mute
                                               1 = Mute
Rev 4.1                                                                                  149


                                                                               WM8998
      REGISTER     BIT         LABEL         DEFAULT                   DESCRIPTION
      ADDRESS
                  7:0    OUT4R_VOL             80h     Output Path 4 (Right) Digital Volume
                         [7:0]                         -64dB to +31.5dB in 0.5dB steps
                                                       00h = -64dB
                                                       01h = -63.5dB
                                                       … (0.5dB steps)
                                                       80h = 0dB
                                                       … (0.5dB steps)
                                                       BFh = +31.5dB
                                                       C0h to FFh = Reserved
                                                       (See Table 58 for volume range)
     R1073         9     OUT_VU                        Output Signal Paths Volume Update
     (0431h)                                           Writing a 1 to this bit will cause the Output
     DAC                                               Signal Paths Volume and Mute settings to
     Digital                                           be updated simultaneously
     Volume 5L     8     OUT5L_MUTE             1      Output Path 5 (Left) Digital Mute
                                                       0 = Un-mute
                                                       1 = Mute
                  7:0    OUT5L_VOL [7:0]       80h     Output Path 5 (Left) Digital Volume
                                                       -64dB to +31.5dB in 0.5dB steps
                                                       00h = -64dB
                                                       01h = -63.5dB
                                                       … (0.5dB steps)
                                                       80h = 0dB
                                                       … (0.5dB steps)
                                                       BFh = +31.5dB
                                                       C0h to FFh = Reserved
                                                       (See Table 58 for volume range)
     R1077         9     OUT_VU                        Output Signal Paths Volume Update
     (0435h)                                           Writing a 1 to this bit will cause the Output
     DAC                                               Signal Paths Volume and Mute settings to
     Digital                                           be updated simultaneously
     Volume        8     OUT5R_MUTE             1      Output Path 5 (Right) Digital Mute
     5R                                                0 = Un-mute
                                                       1 = Mute
                  7:0    OUT5R_VOL             80h     Output Path 5 (Right) Digital Volume
                         [7:0]                         -64dB to +31.5dB in 0.5dB steps
                                                       00h = -64dB
                                                       01h = -63.5dB
                                                       … (0.5dB steps)
                                                       80h = 0dB
                                                       … (0.5dB steps)
                                                       BFh = +31.5dB
                                                       C0h to FFh = Reserved
                                                       (See Table 58 for volume range)
    Table 57 Output Signal Path Digital Volume Control
150                                                                                          Rev 4.1


                                                                         WM8998
           Output                Output                 Output          Output
          Volume     Volume      Volume      Volume    Volume   Volume Volume   Volume
          Register     (dB)     Register       (dB)    Register  (dB)  Register   (dB)
             00h       -64.0       40h         -32.0     80h      0.0    C0h    Res erved
             01h       -63.5       41h         -31.5     81h      0.5    C1h    Res erved
             02h       -63.0       42h         -31.0     82h      1.0    C2h    Res erved
             03h       -62.5       43h         -30.5     83h      1.5    C3h    Res erved
             04h       -62.0       44h         -30.0     84h      2.0    C4h    Res erved
             05h       -61.5       45h         -29.5     85h      2.5    C5h    Res erved
             06h       -61.0       46h         -29.0     86h      3.0    C6h    Res erved
             07h       -60.5       47h         -28.5     87h      3.5    C7h    Res erved
             08h       -60.0       48h         -28.0     88h      4.0    C8h    Res erved
             09h       -59.5       49h         -27.5     89h      4.5    C9h    Res erved
             0Ah       -59.0       4Ah         -27.0     8Ah      5.0    CAh    Res erved
             0Bh       -58.5       4Bh         -26.5     8Bh      5.5    CBh    Res erved
            0Ch        -58.0       4Ch         -26.0     8Ch      6.0    CCh    Res erved
            0Dh        -57.5       4Dh         -25.5     8Dh      6.5    CDh    Res erved
             0Eh       -57.0       4Eh         -25.0     8Eh      7.0    CEh    Res erved
             0Fh       -56.5       4Fh         -24.5     8Fh      7.5    CFh    Res erved
             10h       -56.0       50h         -24.0     90h      8.0    D0h    Res erved
             11h       -55.5       51h         -23.5     91h      8.5    D1h    Res erved
             12h       -55.0       52h         -23.0     92h      9.0    D2h    Res erved
             13h       -54.5       53h         -22.5     93h      9.5    D3h    Res erved
             14h       -54.0       54h         -22.0     94h      10.0   D4h    Res erved
             15h       -53.5       55h         -21.5     95h      10.5   D5h    Res erved
             16h       -53.0       56h         -21.0     96h      11.0   D6h    Res erved
             17h       -52.5       57h         -20.5     97h      11.5   D7h    Res erved
             18h       -52.0       58h         -20.0     98h      12.0   D8h    Res erved
             19h       -51.5       59h         -19.5     99h      12.5   D9h    Res erved
             1Ah       -51.0       5Ah         -19.0     9Ah      13.0   DAh    Res erved
             1Bh       -50.5       5Bh         -18.5     9Bh      13.5   DBh    Res erved
            1Ch        -50.0       5Ch         -18.0     9Ch      14.0   DCh    Res erved
            1Dh        -49.5       5Dh         -17.5     9Dh      14.5   DDh    Res erved
             1Eh       -49.0       5Eh         -17.0     9Eh      15.0   DEh    Res erved
             1Fh       -48.5       5Fh         -16.5     9Fh      15.5   DFh    Res erved
             20h       -48.0       60h         -16.0     A0h      16.0   E0h    Res erved
             21h       -47.5       61h         -15.5     A1h      16.5   E1h    Res erved
             22h       -47.0       62h         -15.0     A2h      17.0   E2h    Res erved
             23h       -46.5       63h         -14.5     A3h      17.5   E3h    Res erved
             24h       -46.0       64h         -14.0     A4h      18.0   E4h    Res erved
             25h       -45.5       65h         -13.5     A5h      18.5   E5h    Res erved
             26h       -45.0       66h         -13.0     A6h      19.0   E6h    Res erved
             27h       -44.5       67h         -12.5     A7h      19.5   E7h    Res erved
             28h       -44.0       68h         -12.0     A8h      20.0   E8h    Res erved
             29h       -43.5       69h         -11.5     A9h      20.5   E9h    Res erved
             2Ah       -43.0       6Ah         -11.0     AAh      21.0   EAh    Res erved
             2Bh       -42.5       6Bh         -10.5     ABh      21.5   EBh    Res erved
            2Ch        -42.0       6Ch         -10.0     ACh      22.0   ECh    Res erved
            2Dh        -41.5       6Dh          -9.5     ADh      22.5   EDh    Res erved
             2Eh       -41.0       6Eh          -9.0     AEh      23.0   EEh    Res erved
             2Fh       -40.5       6Fh          -8.5     AFh      23.5   EFh    Res erved
             30h       -40.0       70h          -8.0     B0h      24.0   F0h    Res erved
             31h       -39.5       71h          -7.5     B1h      24.5   F1h    Res erved
             32h       -39.0       72h          -7.0     B2h      25.0   F2h    Res erved
             33h       -38.5       73h          -6.5     B3h      25.5   F3h    Res erved
             34h       -38.0       74h          -6.0     B4h      26.0   F4h    Res erved
             35h       -37.5       75h          -5.5     B5h      26.5   F5h    Res erved
             36h       -37.0       76h          -5.0     B6h      27.0   F6h    Res erved
             37h       -36.5       77h          -4.5     B7h      27.5   F7h    Res erved
             38h       -36.0       78h          -4.0     B8h      28.0   F8h    Res erved
             39h       -35.5       79h          -3.5     B9h      28.5   F9h    Res erved
             3Ah       -35.0       7Ah          -3.0     BAh      29.0   FAh    Res erved
             3Bh       -34.5       7Bh          -2.5     BBh      29.5   FBh    Res erved
            3Ch        -34.0       7Ch          -2.0     BCh      30.0   FCh    Res erved
            3Dh        -33.5       7Dh          -1.5     BDh      30.5   FDh    Res erved
             3Eh       -33.0       7Eh          -1.0     BEh      31.0   FEh    Res erved
             3Fh       -32.5       7Fh          -0.5     BFh      31.5   FFh    Res erved
        Table 58 Output Signal Path Digital Volume Range
Rev 4.1                                                                                 151


                                                                                        WM8998
    OUTPUT SIGNAL PATH NOISE GATE CONTROL
    The WM8998 provides a digital noise gate function for each of the output signal paths. The noise gate
    ensures best noise performance when the signal path is idle. When the noise gate is enabled, and the
    applicable signal level is below the noise gate threshold, then the noise gate is activated, causing the
    signal path to be muted.
    The noise gate function is enabled using the NGATE_ENA register, as described in Table 59.
    For each output path, the noise gate may be associated with one or more of the signal path threshold
    detection functions using the _NGATE_SRC register fields. When more than one signal threshold is
    selected, then the output path noise gate is only activated (ie. muted) when all of the respective signal
    thresholds are satisfied.
    For example, if the OUT1L noise gate is associated with the OUT1L and OUT1R signal paths, then
    the OUT1L signal path will only be muted if both the OUT1L and OUT1R signal levels are below the
    respective thresholds.
    The noise gate threshold (the signal level below which the noise gate is activated) is set using
    NGATE_THR. Note that, for each output path, the noise gate threshold represents the signal level at
    the respective output pin(s) - the threshold is therefore independent of the digital volume and PGA
    gain settings.
    Note that, although there is only one noise gate threshold level (NGATE_THR), each of the output
    path noise gates may be activated independently, according to the respective signal content and the
    associated threshold configuration(s).
    To prevent erroneous triggering, a time delay is applied before the gate is activated; the noise gate is
    only activated (ie. muted) when the output levels are below the applicable signal level threshold(s) for
    longer than the noise gate ‘hold time’. The ‘hold time’ is set using the NGATE_HOLD register.
    When the noise gate is activated, the WM8998 gradually attenuates the respective signal path at the
    rate set by the OUT_VD_RAMP register (see Table 57). When the noise gate is de-activated, the
    output volume increases at the rate set by the OUT_VI_RAMP register.
      REGISTER        BIT          LABEL           DEFAULT                       DESCRIPTION
      ADDRESS
      R1043          11:0     OUT1L_NGATE_           001h        Output Signal Path Noise Gate Source
      (0413h)                 SRC [11:0]                         Enables one of more signal paths as
      Noise                                                      inputs to the respective noise gate.
      Gate                                                       If more than one signal path is enabled as
      Select 1L                                                  an input, the noise gate is only activated
      R1047          11:0     OUT1R_NGATE_           002h        (ie. muted) when all of the respective
      (0417h)                 SRC [11:0]                         signal thresholds are satisfied.
      Noise
      Gate                                                       [11] = Reserved
      Select 1R                                                  [10] = Reserved
      R1051          11:0     OUT2L_NGATE_           004h        [9] = OUT5R
      (041Bh)                 SRC [11:0]                         [8] = OUT5L
      Noise                                                      [7] = OUT4R
      Gate                                                       [6] = OUT4L
      Select 2L                                                  [5] = Reserved
      R1055          11:0     OUT2R_NGATE_           008h        [4] = OUT3
      (041Fh)                 SRC [11:0]                         [3] = OUT2R
      Noise                                                      [2] = OUT2L
      Gate                                                       [1] = OUT1R
      Select 2R                                                  [0] = OUT1L
      R1059          11:0     OUT3_NGATE_S           010h
      (0423h)                 RC [11:0]                          Each bit is coded as:
      Noise                                                      0 = Disabled
      Gate
                                                                 1 = Enabled
      Select 3L
152                                                                                                  Rev 4.1


                                                                                       WM8998
          REGISTER         BIT          LABEL          DEFAULT                  DESCRIPTION
          ADDRESS
          R1067          11:0     OUT4L_NGATE_            040h
          (042Bh)                 SRC [11:0]
          Noise
          Gate
          Select 4L
          R1071          11:0     OUT4R_NGATE_            080h
          (042Fh)                 SRC [11:0]
          Noise
          Gate
          Select 4R
          R1075          11:0     OUT5L_NGATE_            040h
          (0433h)                 SRC [11:0]
          Noise
          Gate
          Select 5L
          R1079          11:0     OUT5R_NGATE_            080h
          (0437h)                 SRC [11:0]
          Noise
          Gate
          Select 5R
          R1112           5:4     NGATE_HOLD               00   Output Signal Path Noise Gate Hold Time
          (0458h)                 [1:0]                         (delay before noise gate is activated)
          Noise                                                 00 = 30ms
          Gate                                                  01 = 120ms
          Control                                               10 = 250ms
                                                                11 = 500ms
                          3:1     NGATE_THR                000  Output Signal Path Noise Gate Threshold
                                  [2:0]                         000 = -60dB
                                                                001 = -66dB
                                                                010 = -72dB
                                                                011 = -78dB
                                                                100 = -84dB
                                                                101 = -90dB
                                                                110 = -96dB
                                                                111 = -102dB
                           0      NGATE_ENA                 1   Output Signal Path Noise Gate Enable
                                                                0 = Disabled
                                                                1 = Enabled
        Table 59 Output Signal Path Noise Gate Control
        OUTPUT SIGNAL PATH AEC LOOPBACK
        The WM8998 incorporates two loopback signal paths, which are ideally suited as a reference for
        Acoustic Echo Cancellation (AEC) processing. Any two of the output signal paths may be selected as
        the AEC loopback sources.
        Note that the WM8998 cannot provide an integrated AEC capability, but the AEC loopback feature
        enables convenient hook-up to an external device for implementing the required signal processing
        algorithms.
        The AEC Loopback sources are connected after the respective digital volume controls, as illustrated
        in Figure 51.
        The AEC Loopback signals can be selected as input to any of the digital mixers within the WM8998
        digital core. The sample rate for the AEC Loopback paths is configured using the OUT_RATE register
        - see Table 19 within the “Digital Core” section.
        The AEC loopback function is enabled using the AECn_LOOPBACK_ENA register bits, (where ‘n’
        identifies the applicable path, AEC1 or AEC2). The source signals for the Transmit Path AEC function
        are selected using the AECn_LOOPBACK_SRC bits.
        The WM8998 performs automatic checks to confirm that the SYSCLK frequency is high enough to
Rev 4.1                                                                                                153


                                                                                     WM8998
    support the AEC Loopback function. If an attempt is made to enable this function, and there are
    insufficient SYSCLK cycles to support it, then the attempt will be unsuccessful. (Note that any signal
    paths that are already active will not be affected under these circumstances.)
    The Underclocked Error condition can be monitored using the GPIO and/or Interrupt functions. See
    “General Purpose Input / Output” and “Interrupts” for further details.
    The AECn_ENA_STS register bits indicate the status of the AEC Loopback functions. If an
    Underclocked Error condition occurs, then these bits can provide indication of whether the AEC
    Loopback function has been successfully enabled.
      REGISTER        BIT          LABEL            DEFAULT                    DESCRIPTION
      ADDRESS
      R1104          5:2    AEC1_LOOPBAC              0000      Input source for Tx AEC1 function
      (0450h)               K_SRC [3:0]                         0000 = OUT1L
      DAC AEC                                                   0001 = OUT1R
      Control 1                                                 0010 = OUT2L
                                                                0011 = OUT2R
                                                                0100 = OUT3
                                                                0110 = OUT4L
                                                                0111 = OUT4R
                                                                1000 = OUT5L
                                                                1001 = OUT5R
                                                                All other codes are Reserved
                      1     AEC1_ENA_STS                0       Transmit (Tx) Path AEC1 Control Status
                                                                0 = Disabled
                                                                1 = Enabled
                      0     AEC1_LOOPBAC                0       Transmit (Tx) Path AEC1 Control
                            K_ENA                               0 = Disabled
                                                                1 = Enabled
      R1105          5:2    AEC2_LOOPBAC              0000      Input source for Tx AEC2 function
      (0451h)               K_SRC [3:0]                         0000 = OUT1L
      DAC AEC                                                   0001 = OUT1R
      Control 2                                                 0010 = OUT2L
                                                                0011 = OUT2R
                                                                0100 = OUT3
                                                                0110 = OUT4L
                                                                0111 = OUT4R
                                                                1000 = OUT5L
                                                                1001 = OUT5R
                                                                All other codes are Reserved
                      1     AEC2_ENA_STS                0       Transmit (Tx) Path AEC2 Control Status
                                                                0 = Disabled
                                                                1 = Enabled
                      0     AEC2_LOOPBAC                0       Transmit (Tx) Path AEC2 Control
                            K_ENA                               0 = Disabled
                                                                1 = Enabled
    Table 60 Output Signal Path AEC Loopback Control
154                                                                                               Rev 4.1


                                                                                            WM8998
        HEADPHONE/LINE/EARPIECE OUTPUTS AND MONO MODE
        The headphone and line drivers can provide a mono differential (BTL) output; this is selected using
        the OUTn_MONO register bits. When the OUTn_MONO bit is set, then the respective Right channel
        output is an inverted copy of the Left channel output signal; this creates a differential output between
        the respective OUTnL and OUTnR pins.
        In mono configuration, the effective gain of the signal path is increased by 6dB.
        The mono (BTL) signal paths are illustrated in Figure 51.
        The OUT1L and OUT1R output signal paths are associated with the analogue outputs HPOUTL and
        HPOUTR respectively.
        The OUT2L and OUT2R output signal paths are associated with the analogue outputs LINEOUTL and
        LINEOUTR respectively.
        The OUT3 output signal path is associated with the analogue outputs EPOUTP and EPOUTN.
          REGISTER         BIT          LABEL            DEFAULT                    DESCRIPTION
          ADDRESS
          R1040            12     OUT1_MONO                  0       Output Path 1 Mono Mode
          (0410h)                                                    (Configures HPOUTL and HPOUTR as a
          Output                                                     mono differential output.)
          Path                                                       0 = Disabled
          Config 1L                                                  1 = Enabled
                                                                     The gain of the signal path is increased by
                                                                     6dB in differential (mono) mode.
          R1048            12     OUT2_MONO                  0       Output Path 2 Mono Mode
          (0418h)                                                    (Configures LINEOUTL and LINEOUTR
          Output                                                     as a mono differential output.)
          Path                                                       0 = Disabled
          Config 2L                                                  1 = Enabled
                                                                     The gain of the signal path is increased by
                                                                     6dB in differential (mono) mode.
        Table 61 Headphone Driver Mono Mode Control
        The headphone and line driver outputs HPOUTL, HPOUTR, LINEOUTL and LINEOUTR are suitable
        for direct connection to external loads. The outputs are ground-referenced, eliminating any
        requirement for AC coupling capacitors.
        The headphone and line outputs incorporate a common mode, or ground loop, feedback path which
        provides rejection of system-related ground noise. The feedback pins must be connected to ground
        for normal operation of the respective outputs.
        Note that the feedback pins should be connected to GND close to the respective headphone/line jack,
        as illustrated in Figure 52. In mono (differential) mode, the feedback pin(s) should be connected to the
        ground plane that is physically closest to the earpiece output PCB tracks.
        The ground feedback path for HPOUTL and HPOUTR is provided via the HPOUTFB1 or HPOUTFB2
        pins; the applicable connection must be selected using the ACCDET_SRC register, as described in
        Table 62.
        The ground feedback path for LINEOUTL and LINEOUTR is provided via the LINEOUTFB pin. No
        register configuration is required for the LINEOUTFB connection.
          REGISTER         BIT          LABEL            DEFAULT                    DESCRIPTION
          ADDRESS
          R659             13     ACCDET_SRC                 0       Accessory Detect / Headphone Feedback
          (0293h)                                                    pin select
          Accessory                                                  0 = Accessory detect on MICDET1,
          Detect                                                     Headphone ground feedback on
          Mode 1                                                     HPOUTFB1
                                                                     1 = Accessory detect on MICDET2,
                                                                     Headphone ground feedback on
                                                                     HPOUTFB2
        Table 62 Headphone Output (HPOUT) Ground Feedback Control
Rev 4.1                                                                                                      155


                                                                                            WM8998
    The earpiece driver outputs EPOUTP and EPOUTN are suitable for direct connection to an earpiece.
    The output configuration is differential (BTL), driving both ends of the external load directly - note that
    there is no associated ground connection.
    The headphone, line, and earpiece connections are illustrated in Figure 52.
                                  HPOUTL
                                 HPOUTR
                               HPOUTFB1
                                                                      The HPOUTFB1 or HPOUTFB2 pin is
                               HPOUTFB2                               selected by the ACCDET_SRC register bit.
                                LINEOUTL
                   WM8998
                               LINEOUTR
                              LINEOUTFB
                                                                      Note that the headphone and line outputs support
                                                                      stereo (single-ended) or mono (differential) output.
                                  EPOUTP
                                                                      Earpiece
                                  EPOUTN
    Figure 52 Headphone, Line, and Earpiece Connection
    SPEAKER OUTPUTS (ANALOGUE)
    The speaker driver outputs SPKOUTLP, SPKOUTLN, SPKOUTLP and SPKOUTLN provide two
    differential (BTL) outputs suitable for direct connection to external loudspeakers. The integrated Class
    D speaker driver provides high efficiency at large signal levels.
    The speaker driver signal paths incorporate a boost function which shifts the signal levels between the
    AVDD and SPKVDD voltage domains. The boost is pre-configured (+12dB) for the recommended
    AVDD and SPKVDD operating voltages (see “Recommended Operating Conditions”).
    Ultra-low leakage and high PSRR allow the speaker supply SPKVDD to be connected directly to a
    lithium battery. Note that SPKVDDL powers the Left Speaker driver, and SPKVDDR powers the Right
    Speaker driver; it is assumed that SPKVDDL = SPKVDDR = SPKVDD.
    Note that SYSCLK must be present and enabled when using the Class D speaker output; see
    “Clocking and Sample Rates” for details of SYSCLK and the associated register control fields.
    The OUT4L and OUT4R output signal paths are associated with the analogue outputs SPKOUTLP,
    SPKOUTLN, SPKOUTLP and SPKOUTLN.
    The Class D speaker output is a pulse width modulated signal, and requires external filtering in order
    to recreate the audio signal. With a suitable choice of external speakers, the speakers themselves can
    provide the necessary filtering. See “Applications Information” for further information on Class D
    speaker connections.
    The external speaker connection is illustrated in Figure 53, assuming suitable speakers are chosen to
    provide the PWM filtering.
                                    SPKOUTLN
                                                                      Left
                                    SPKOUTLP
                      WM8998
                                    SPKOUTRN
                                                                      Right
                                    SPKOUTRP
    Figure 53 Speaker Connection
156                                                                                                          Rev 4.1


                                                                                    WM8998
        SPEAKER OUTPUTS (DIGITAL)
        The WM8998 supports a two-channel Pulse Density Modulation (PDM) digital speaker interface; the
        PDM outputs are associated with the OUT5L and OUT5R output signal paths.
        The PDM digital speaker interface is illustrated in Figure 54.
        The OUT5L and OUT5R output signal paths are interleaved on the SPKDAT output pin, and clocked
        using SPKCLK.
        Note that the PDM interface supports two different operating modes; these are selected using the
        SPK1_FMT register bit. See “Signal Timing Requirements” for detailed timing information in both
        modes.
        When SPK1_FMT = 0 (Mode A), then the Left PDM channel is valid at the rising edge of SPKCLK; the
        Right PDM channel is valid at the falling edge of SPKCLK.
        When SPK1_FMT = 1 (Mode B), then the Left PDM channel is valid during the low phase of SPKCLK;
        the Right PDM channel is valid during the high phase of SPKCLK.
                      SPKCLK output (Mode A)
                      SPKCLK output (Mode B)
                             Left channel output              1        1          1
                           Right channel output                     2       2            2
                                 SPKDAT output
                                                               1     2 1     2     1     2
             (left & right channels interleaved)
        Figure 54 Digital Speaker (PDM) Interface Timing
        Clocking for the PDM interface is derived from SYSCLK. Note that the SYSCLK_ENA register must
        also be set. See “Clocking and Sample Rates” for further details of the system clocks and control
        registers.
        When the OUT5L or OUT5R output signal path is enabled, the PDM interface clock signal is output on
        the SPKCLK pin.
        The output signal paths support normal and high performance operating modes, as described in the
        “Output Signal Path” section. The SPKCLK frequency is set according to the operating mode of the
        OUT5 output signal path, as described in Table 63.
        Note that the SPKCLK frequencies noted in Table 63 assume that the SYSCLK frequency is a
        multiple of 6.144MHz (SYSCLK_FRAC=0). If the SYSCLK frequency is a multiple of 5.6448MHz
        (SYSCLK_FRAC=1), then the SPKCLK frequency will be scaled accordingly.
                    OUT5_OSR                          DESCRIPTION              SPKCLK FREQUENCY
                        0                             Normal mode                    3.072MHz
                        1                       High Performance mode                6.144MHz
        Table 63 SPKCLK Frequency
        The PDM output channels can be independently muted. When muted, the default output on each
        channel is a DSD-compliant silent stream (0110_1001b). The mute output code can be programmed
Rev 4.1                                                                                              157


                                                                                                                 WM8998
                            to other values if required, using the SPK1_MUTE_SEQ register field. The mute output code can be
                            transmitted MSB-first or LSB-first; this is selectable using the SPK1_MUTE_ENDIAN register.
                            Note that the PDM Mute function is not a soft-mute; the audio output is interrupted immediately when
                            the PDM mute is asserted. It is recommended to use the Output Signal Path mute function before
                            applying the PDM mute. See Table 57 for details of the OUT5L_MUTE and OUT5R_MUTE registers.
                            The PDM output interface registers are described in Table 64.
                              REGISTER        BIT          LABEL             DEFAULT                      DESCRIPTION
                              ADDRESS
                              R1168          13      SPK1R_MUTE                 0         PDM Speaker Output 1 (Right) Mute
                              (0490h)                                                     0 = Audio output (OUT5R)
                              PDM                                                         1 = Mute Sequence output
                              SPK1           12      SPK1L_MUTE                 0         PDM Speaker Output 1 (Left) Mute
                              CTRL 1
                                                                                          0 = Audio output (OUT5L)
                                                                                          1 = Mute Sequence output
                                              8      SPK1_MUTE_EN               0         PDM Speaker Output 1 Mute Sequence
                                                     DIAN                                 Control
                                                                                          0 = Mute sequence is LSB first
                                                                                          1 = Mute sequence output is MSB first
                                             7:0     SPK1_MUTE_SE              69h        PDM Speaker Output 1 Mute Sequence
                                                     Q [7:0]                              Defines the 8-bit code that is output on
                                                                                          SPKDAT (left) or SPKDAT (right) when
                                                                                          muted.
                              R1169           0      SPK1_FMT                   0         PDM Speaker Output 1 timing format
                              (0491h)                                                     0 = Mode A (PDM data is valid at the
                              PDM                                                         rising/falling edges of SPKCLK)
                              SPK1                                                        1 = Mode B (PDM data is valid during the
                              CTRL 2                                                      high/low phase of SPKCLK)
                            Table 64 Digital Speaker (PDM) Output Control
                            The digital speaker (PDM) outputs SPKDAT and SPKCLK are intended for direct connection to a
                            compatible external speaker driver. A typical configuration is illustrated in Figure 55.
                               SPKCLK
                                                                                       Speaker Driver                           Left
                              SPKDAT
               WM8998
                                                                                       Speaker Driver                           Right
Figure 55 Digital Speaker (PDM) Connection
158                                                                                                                          Rev 4.1


                                                                                                   WM8998
EXTERNAL ACCESSORY DETECTION
               The WM8998 provides external accessory detection functions which can sense the presence and
               impedance of external components. This can be used to detect the insertion or removal of an external
               headphone or headset, and to provide an indication of key/button push events.
               Jack insertion is detected using the JACKDET pin, which must be connected to a switch contact
               within the jack socket. An Interrupt event is generated whenever a jack insertion or jack removal event
               is detected. The jack detect function can also be used to trigger a Wake-Up transition (ie. exit from
               Sleep mode) and/or to trigger the Control Write Sequencer.
               Suppression of pops and clicks caused by jack insertion or removal is provided using the MICDET
               clamp function. This function can also be used to trigger interrupt events, a Wake-Up transition (ie.
               exit from Sleep mode) and/or to trigger the Control Write Sequencer. The integrated General Purpose
               Switch can be synchronised with the MICDET clamp, to provide additional pop suppression capability.
               Microphones, push-buttons and other accessories can be detected via the MICDET1 or MICDET2
               pins. The presence of a microphone, and the status of a hookswitch can be detected. This feature can
               also be used to detect push-button operation.
               Headphone impedance can be detected via the HPDETL and HPDETR pins; this can be used to set
               different gain levels or other configuration settings according to the type of load connected. For
               example, different settings may be applicable to Headphone or Line output loads.
               The MICVDD power domain must be enabled when using the Microphone Detect function. (Note that
               MICVDD is not required for the Jack Detect or Headphone Detect functions.) The MICVDD power
               domain is provided using an internal Charge Pump (CP2) and LDO Regulator (LDO2). See “Charge
               Pumps, Regulators and Voltage Reference” for details of these circuits.
               The internal 32kHz clock must be present and enabled when using the jack insertion or accessory
               detection functions; see “Clocking and Sample Rates” for details of the internal 32kHz clock and
               associated register control fields.
               JACK DETECT
               The WM8998 provides support for jack insertion switch detection. The jack insertion status can be
               read using the relevant register status bit. A jack insertion or removal can also be used to trigger an
               interrupt (IRQ) event or to trigger the Control Write Sequencer.
               When the WM8998 is in the low-power Sleep mode (see “Low Power Sleep Configuration”), the jack
               detect function can be used as a ‘wake-up’ input; a typical use case is where an application is idle in
               standby mode until a headphone or headset jack is inserted.
               Jack insertion and removal is detected using the JACKDET pin. The recommended external
               connection circuit is illustrated in Figure 56.
               The jack detect feature is enabled using JD1_ENA; the jack insertion status can be read using the
               JD1_STS register.
               The JACKDET input de-bounce is selected using the JD1_DB register, as described in Table 65. Note
               that the de-bounce circuit uses the 32kHz clock, which must be enabled whenever input de-bounce
               functions are required.
               Note that the Jack Detect signal, JD1, can be used as an input to the MICDET Clamp function. This
               provides additional functionality relating to jack insertion or jack removal events.
               An Interrupt Request (IRQ) event is generated whenever a jack insertion or jack removal is detected
               (see “Interrupts”). Separate ‘mask’ bits are provided to enable IRQ events on the rising and/or falling
               edge of the JD1 status.
               The Control Write Sequencer can be triggered by a jack insertion or jack removal detection. This is
               enabled using register bits described in the “Low Power Sleep Configuration” section.
               The control registers associated with the Jack Detect function are described in Table 65.
Rev 4.1                                                                                                           159


                                                                                                                WM8998
        REGISTER                 BIT                 LABEL                DEFAUL                          DESCRIPTION
        ADDRESS                                                                 T
      R723                       0         JD1_ENA                             0             JACKDET enable
      (02D3h)                                                                                0 = Disabled
      Jack detect                                                                            1 = Enabled
      analogue
      R3413                      0         JD1_STS                             0             JACKDET input status
      (0D55h)                                                                                0 = Jack not detected
      AOD IRQ                                                                                1 = Jack is detected
      Raw Status                                                                             (Assumes the JACKDET pin is
                                                                                             pulled ‘low’ on Jack insertion.)
      R3414                      0         JD1_DB                              0             JACKDET input de-bounce
      (0D56h)                                                                                0 = Disabled
      Jack detect                                                                            1 = Enabled
      debounce
    Table 65 Jack Detect Control
    A recommended connection circuit, including headphone output and microphone connections, is
    shown in Figure 56. See “Applications Information” for details of recommended external components.
                                                         2.2k (+/-2%)
                                            MICBIASn
                                                                    C
                                              * IN2BP
                                             MICDET1
                                             HPOUTL
                         WM8998
                                             HPOUTR
                                           HPOUTFB1
                                                                                                            Note: The illustrated circuit assumes
     * Note that the IN2B analogue input    JACKDET                                                         the jack insertion switch contacts are
     channel is recommended with the                                   (jack insertion switch)              closed when jack is inserted.
     external accessory detect function
    Figure 56 Jack Detect and External Accessory Connections
    The internal comparator circuit used to detect the JACKDET status is illustrated in Figure 57.
    The threshold voltages for the jack detect circuit are noted in the “Electrical Characteristics”. Note that
    separate thresholds are defined for jack insertion and jack removal.
                                                 AVDD
                                                                                                 Note: The illustrated circuit assumes the
                                                      1M                                        jack insertion switch contacts are closed
                                                                                                 when jack is inserted.
                                                                 JACKDET
     Jack Detect logic                   +
                                                                         (jack insertion switch)
                                         -     reference
    Figure 57 Jack Detect Comparator
160                                                                                                                                   Rev 4.1


                                                                                                               WM8998
        JACK POP SUPPRESSION (MICDET CLAMP AND GP SWITCH)
        Under typical configuration of a 3.5mm headphone/accessory jack connection, there is a risk of pops
        and clicks arising from jack insertion or removal. This can occur when the headphone load makes
        momentary contact with the MICBIAS output when the jack is not fully inserted, as illustrated in Figure
        58.
        The WM8998 provides a MICDET Clamp function to suppress pops and clicks caused by jack
        insertion or removal. The clamp is activated by a configurable logic function derived from external
        logic inputs. The clamp status can be read using the relevant register status bit. The clamp status can
        also be used to trigger an interrupt (IRQ) event or to trigger the Control Write Sequencer.
        When the WM8998 is in the low-power Sleep mode, the MICDET Clamp function can be used as a
        ‘wake-up’ input; a typical use case is where an application is idle in standby mode until a headphone
        or headset jack is inserted. This feature is enabled using the control bits described in Table 73 within
        the “Low Power Sleep Configuration” section.
        The MICDET Clamp function is controlled by a selectable logic condition, derived from the JD1 and/or
        GP5 signals. The function is enabled and configured using the MICD_CLAMP_MODE register.
        The JD1 signal is derived from the Jack Detect function (see Table 65). The GP5 signal is derived
        from the GPIO5 input pin (see “General Purpose Input / Output”).
        When the MICDET Clamp is active, the MICDET1/HPOUTFB2 and HPOUTFB1/MICDET2 pins are
        short-circuited together. The grounding of the MICDET pin is achieved via the applicable HPOUTFB
        pin - it is assumed that the HPOUTFB connection is grounded externally, as shown in Figure 58.
        The configurable logic provides flexibility in selecting the appropriate conditions for activating the
        MICDET Clamp. The clamp status can be read using the MICD_CLAMP_STS register.
        The MICDET Clamp de-bounce is selected using the MICD_CLAMP_DB register, as described in
        Table 66. Note that the de-bounce circuit uses the 32kHz clock, which must be enabled whenever
        input de-bounce functions are required.
        An Interrupt Request (IRQ) event is generated whenever the MICDET Clamp is asserted or de-
        asserted (see “Interrupts”). Separate ‘mask’ bits are provided to enable IRQ events on the rising
        and/or falling edge of the MICDET Clamp status.
        The Control Write Sequencer can be triggered by the MICDET Clamp status. This is enabled using
        register bits described in the “Low Power Sleep Configuration” section.
        The MICDET Clamp function is illustrated in Figure 58. Note that the jack plug is shown partially
        removed, with the MICDET1 pin in contact with the headphone load.
           WM8998                                        2.2k (+/-2%)
                                               MICBIASn
                                                                    C
                                                 * IN2BP
                       MICD_CLAMP_MODE
                                                                                                      * Note: The Jack plug is shown partially
                       MICD_CLAMP_STS                                                                 removed, with the MICDET1 pin in
                       MICD_CLAMP_DB           MICDET1/                                               contact with the headphone load.
                                              HPOUTFB2
                                                                                                        * see note
                                              HPOUTFB1/
                                                MICDET2
                              MICDET
                           Clamp Control
                                                                    When the MICDET Clamp is active in the configuration shown, the
                                                                    MICDET1 pin is grounded via the headphone jack ground connection.
          * Note that the IN2B analogue input
          channel is recommended with the
          external accessory detect function
        Figure 58 MICDET Clamp circuit
Rev 4.1                                                                                                                                   161


                                                                                                     WM8998
    In applications where a large de-coupling capacitance is present on the MICBIAS output, the MICDET
    Clamp function alone may be unable to discharge the capacitor sufficiently to eliminate pops and
    clicks associated with jack insertion and removal. In this case, it may be desirable to use the General
    Purpose Switch within the WM8998 to provide isolation from the MICBIAS output; an example circuit
    is shown in Figure 59.
    The General Purpose Switch is configured using SW1_MODE. This register allows the switch to be
    disabled, enabled, or synchronised to the MICDET Clamp status, as described in Table 66.
    For jack pop suppression, it is recommended to set SW1_MODE=11. In this case, the switch contacts
    are open whenever the MICDET Clamp is active, and the switch contacts are closed whenever the
    MICDET Clamp is inactive.
    Normal accessory functions are supported when the switch contacts (GPSWP and GPSWN) are
    closed, and the MICDET Clamp is inactive. Ground clamping of MICDET, and isolation of MICBIAS
    are achieved when the switch contacts are open, and the MICDET Clamp is active.
    Note that the MICDET Clamp function must also be configured appropriately when using this method
    of pop suppression control.
                                                      R1     R1+R2 = 2.2k (+/-2%)
        WM8998
                                            MICBIASn
                                              GPSWP                           C
                                              GPSWN
                      General Purpose
                        Switch Control
                                                                    R2
                    SW1_MODE
                                                         C
                                              * IN2BP
                    MICD_CLAMP_MODE
                                                                                            * Note: The Jack plug is shown partially
                    MICD_CLAMP_STS                                                          removed, with the MICDET1 pin in
                    MICD_CLAMP_DB           MICDET1/                                        contact with the headphone load.
                                           HPOUTFB2
                                                                                              * see note
                                           HPOUTFB1/
                                             MICDET2
                           MICDET
                        Clamp Control
                                                          When the MICDET Clamp is active in the configuration shown, the
                                                          MICDET1 pin is grounded via the headphone jack ground connection.
       * Note that the IN2B analogue input
       channel is recommended with the
       external accessory detect function
    Figure 59 General Purpose Switch Circuit
162                                                                                                                     Rev 4.1


                                                                                         WM8998
        The control registers associated with the MICDET Clamp and General Purpose Switch functions are
        described in Table 66.
            REGISTER        BIT           LABEL           DEFAULT                   DESCRIPTION
            ADDRESS
          R674             3:0      MICD_CLAMP_M            0000       MICDET Clamp Mode
          (02A2h)                   ODE [3:0]                          0h = Disabled
          Micd Clamp                                                   1h = Active (MICDET1 and MICDET2
          control                                                      are shorted together)
                                                                       2h = Reserved
                                                                       3h = Reserved
                                                                       4h = Active when JD1=0
                                                                       5h = Active when JD1=1
                                                                       6h = Active when GP5=0
                                                                       7h = Active when GP5=1
                                                                       8h = Active when JD1=0 or GP5=0
                                                                       9h = Active when JD1=0 or GP5=1
                                                                       Ah = Active when JD1=1 or GP5=0
                                                                       Bh = Active when JD1=1 or GP5=1
                                                                       Ch = Active when JD1=0 and GP5=0
                                                                       Dh = Active when JD1=0 and GP5=1
                                                                       Eh = Active when JD1=1 and GP5=0
                                                                       Fh = Active when JD1=1 and GP5=1
          R3096            1:0      SW1_MODE [1:0]           00        General Purpose Switch control
          (0C18h)                                                      00 = Disabled (open)
          GP Switch 1                                                  01 = Enabled (closed)
                                                                       10 = Enabled when MICDET Clamp is
                                                                       active
                                                                       11 = Enabled when MICDET Clamp is
                                                                       not active
          R3413             3       MICD_CLAMP_S              0        MICDET Clamp status
          (0D55h)                   TS                                 0 = Clamp not active
          AOD IRQ                                                      1 = Clamp active
          Raw Status
          R3414             3       MICD_CLAMP_D              0        MICDET Clamp de-bounce
          (0D56h)                   B                                  0 = Disabled
          Jack detect                                                  1 = Enabled
          debounce
        Table 66 MICDET Clamp and General Purpose Switch Control
        MICROPHONE DETECT
        The WM8998 microphone detection circuit measures the impedance of an external load connected to
        one of the MICDET pins. This feature can be used to detect the presence of a microphone, and the
        status of the associated hookswitch. It can also be used to detect push-button status or the
        connection of other external accessories.
        The microphone detection circuit measures the impedance connected to MICDET1 or MICDET2. In
        the discrete measurement mode (ACCDET_MODE=000), the function reports whether the measured
        impedance lies within one of 8 pre-defined levels. In the ADC measurement mode
        (ACCDET_MODE=111), a more specific result is provided in the form of a 7-bit ADC output.
        The microphone detection circuit typically uses one of the MICBIAS outputs as a reference. The
        WM8998 will automatically enable the appropriate MICBIAS when required in order to perform the
        detection function; this allows the detection function to be supported in low-power standby operating
        conditions.
        Note that the MICVDD power domain must be enabled when using the microphone detection function.
        This power domain is provided using an internal Charge Pump (CP2) and LDO Regulator (LDO2).
        See “Charge Pumps, Regulators and Voltage Reference” for details of these circuits.
        To select microphone detection on one of the MICDET pins, the ACCDET_MODE register must be
        set to 000 or 111 (depending on the desired measurement mode). The ACCDET_MODE register is
        defined in Table 67.
Rev 4.1                                                                                                 163


                                                                                      WM8998
    The WM8998 can only support one headphone or microphone detection function at any time. When
    the detection function is not in use, it is recommended to set ACCDET_MODE=000.
    The microphone detection circuit can be enabled on the MICDET1 pin or the MICDET2 pin, selected
    by the ACCDET_SRC register.
    The microphone detection circuit uses MICVDD, MICBIAS1, MICBIAS2 or MICBIAS3 as a reference.
    The applicable source is configured using the MICD_BIAS_SRC register.
    When ACCDET_MODE is set to 000 or 111, then Microphone detection is enabled by setting
    MICD_ENA.
    When microphone detection is enabled, the WM8998 performs a number of measurements in order to
    determine the MICDET impedance. The measurement process is repeated at a cyclic rate controlled
    by MICD_RATE. (The MICD_RATE register selects the delay between completion of one
    measurement and the start of the next.) When the microphone detection result has settled, the
    WM8998 indicates valid data by setting the MICD_VALID bit.
    When the discrete measurement mode is selected (ACCDET_MODE=000), the measured impedance
    is only deemed valid after more than one successive measurement has produced the same result.
    The MICD_DBTIME register provides control of the de-bounce period; this can be either 2
    measurements or 4 measurements.
    When the microphone detection result has settled (ie. after the applicable de-bounce period), the
    WM8998 indicates valid data by setting the MICD_VALID bit. The measured impedance is indicated
    using the MICD_LVL and MICD_STS register bits, as described in Table 67.
    The MICD_VALID bit, when set, remains asserted for as long as the microphone detection function is
    enabled (ie. while MICD_ENA = 1). If the detected impedance changes, then the MICD_LVL and
    MICD_STS fields will change, but the MICD_VALID bit will remain set, indicating valid data at all
    times.
    The 8 pre-defined impedance levels (including the ‘no accessory detected’ level) allow detection of a
    typical microphone and up to 6 push-buttons. Each measurement level can be enabled or disabled
    independently; this provides flexibility according to the required thresholds, and offers a faster
    measurement time in some applications. The MICD_LVL_SEL register is described in detail later in
    this section.
    Note that the impedance levels quoted in the MICD_LVL description assume that a microphone
    (475Ω to 30kΩ impedance) is also present on the MICDET pin. The limits quoted in the “Electrical
    Characteristics” refer to the combined effective impedance on the MICDET pin. Typical external
    components are described in the “Applications Information” section.
    When the ADC measurement mode is selected (ACCDET_MODE=111), the detection function must
    be disabled before the measurement can be read. When the WM8998 indicates valid data
    (MICD_VALID=1), the detection must be disabled by setting MICD_ENA=0.
    The ADC measurement mode generates two output results, contained within the MICDET_ADCVAL
    and MICDET_ADCVAL_DIFF registers. These registers contain the most recent measurement value
    (MICDET_ADCVAL) and the measurement difference value (MICDET_ADCVAL_DIFF). The
    difference value indicates the difference between the latest measurement and the previous
    measurement; this can be used to determine whether the measurement is stable and reliable.
    Note that the MICDET_ADCVAL and MICDET_ADCVAL_DIFF registers do not follow a linear coding.
    The appropriate test condition for accepting the measurement value (or for re-scheduling the
    measurement) will vary depending on the application requirements, and depending on the expected
    impedance value.
    The microphone detection function is an input to the Interrupt control circuit and can be used to trigger
    an Interrupt event every time an accessory insertion, removal or impedance change is detected. See
    “Interrupts” for further details.
    The microphone detection function can also generate a GPIO output, providing an external indication
    of the microphone detection. This GPIO output is pulsed every time an accessory insertion, removal
    or impedance change is detected. See “General Purpose Input / Output” to configure a GPIO pin for
    this function.
    The register fields associated with Microphone Detection (or other accessories) are described in
164                                                                                               Rev 4.1


                                                                                             WM8998
        Table 67. The external circuit configuration is illustrated in Figure 60.
          REGISTER        BIT          LABEL          DEFAULT                          DESCRIPTION
           ADDRESS
         R659            13      ACCDET_SRC                 0        Accessory Detect / Headphone Feedback pin
         (0293h)                                                     select
         Accessory                                                   0 = Accessory detect on MICDET1,
         Detect                                                      Headphone ground feedback on HPOUTFB1
         Mode 1                                                      1 = Accessory detect on MICDET2,
                                                                     Headphone ground feedback on HPOUTFB2
                         2:0     ACCDET_MOD                00        Accessory Detect Mode Select
                                 E [2:0]                             000 = Microphone detect (MICDETn, discrete
                                                                     mode)
                                                                     001 = Headphone detect (HPDETL)
                                                                     010 = Headphone detect (HPDETR)
                                                                     011 = Reserved
                                                                     100 = Headphone detect (MICDETn)
                                                                     101 = Reserved
                                                                     110 = Reserved
                                                                     111 = Microphone detect (MICDETn, ADC
                                                                     mode)
                                                                     Note that the MICDETn measurements are
                                                                     implemented on either the MICDET1 or
                                                                     MICDET2 pins, depending on the
                                                                     ACCDET_SRC register bit.
         R675          15:12     MICD_BIAS_S             0001        Mic Detect Bias Startup Delay
         (02A3h)                 TARTTIME                            (If MICBIAS is not enabled already, this field
         Mic Detect 1            [3:0]                               selects the delay time allowed for MICBIAS to
                                                                     startup prior to performing the MICDET
                                                                     function.)
                                                                     0000 = 0ms (continuous)
                                                                     0001 = 0.25ms
                                                                     0010 = 0.5ms
                                                                     0011 = 1ms
                                                                     0100 = 2ms
                                                                     0101 = 4ms
                                                                     0110 = 8ms
                                                                     0111 = 16ms
                                                                     1000 = 32ms
                                                                     1001 = 64ms
                                                                     1010 = 128ms
                                                                     1011 = 256ms
                                                                     1100 to 1111 = 512ms
                        11:8     MICD_RATE               0001        Mic Detect Rate
                                 [3:0]                               (Selects the delay between successive
                                                                     MICDET measurements.)
                                                                     0000 = 0ms (continuous)
                                                                     0001 = 0.25ms
                                                                     0010 = 0.5ms
                                                                     0011 = 1ms
                                                                     0100 = 2ms
                                                                     0101 = 4ms
                                                                     0110 = 8ms
                                                                     0111 = 16ms
                                                                     1000 = 32ms
                                                                     1001 = 64ms
                                                                     1010 = 128ms
                                                                     1011 = 256ms
                                                                     1100 to 1111 = 512ms
Rev 4.1                                                                                                        165


                                                                       WM8998
      REGISTER      BIT        LABEL    DEFAULT                  DESCRIPTION
       ADDRESS
                   5:4   MICD_BIAS_S       00   Accessory Detect (MICDET) reference select
                         RC [1:0]               00 = MICVDD
                                                01 = MICBIAS1
                                                10 = MICBIAS2
                                                11 = MICBIAS3
                    1    MICD_DBTIME        1   Mic Detect De-bounce
                                                0 = 2 measurements
                                                1 = 4 measurements
                                                Only valid when ACCDET_MODE=000.
                    0    MICD_ENA           0   Mic Detect Enable
                                                0 = Disabled
                                                1 = Enabled
     R676          7:0   MICD_LVL_SE     1001_  Mic Detect Level Select
     (02A4h)             L [7:0]          1111  (enables Mic/Accessory Detection in specific
     Mic Detect 2                               impedance ranges)
                                                [7] = Enable >475 ohm detection
                                                [6] = Not used - must be set to 0
                                                [5] = Not used - must be set to 0
                                                [4] = Enable 375 ohm detection
                                                [3] = Enable 155 ohm detection
                                                [2] = Enable 73 ohm detection
                                                [1] = Enable 40 ohm detection
                                                [0] = Enable 18 ohm detection
                                                Note that the impedance values quoted
                                                assume that a microphone (475ohm-30kohm)
                                                is also present on the MICDET pin.
                                                Only valid when ACCDET_MODE=000.
     R677         10:2   MICD_LVL       0_0000_ Mic Detect Level
     (02A5h)             [8:0]            0000  (indicates the measured impedance)
     Mic Detect 3                               [8] = >475 ohm, <30k ohm
                                                [7] = Not used
                                                [6] = Not used
                                                [5] = 375 ohm
                                                [4] = 155 ohm
                                                [3] = 73 ohm
                                                [2] = 40 ohm
                                                [1] = 18 ohm
                                                [0] = <3 ohm
                                                Note that the impedance values quoted
                                                assume that a microphone (475ohm-30kohm)
                                                is also present on the MICDET pin.
                                                Only valid when ACCDET_MODE=000.
                    1    MICD_VALID         0   Mic Detect Data Valid
                                                0 = Not Valid
                                                1 = Valid
                    0    MICD_STS           0   Mic Detect Status
                                                0 = No Mic/Accessory present (impedance is
                                                >30k ohm)
                                                1 = Mic/Accessory is present (impedance is
                                                <30k ohm)
                                                Only valid when ACCDET_MODE=000.
     R683         15:8   MICDET_ADC        00h  Mic Detect ADC Level (Difference)
     02ABh               VAL_DIFF [7:0]         Only valid when ACCDET_MODE=111.
     Mic Detect 4  6:0   MICDET_ADC        00h  Mic Detect ADC Level
                         VAL [6:0]              Only valid when ACCDET_MODE=111.
    Table 67 Microphone Detect Control
166                                                                                Rev 4.1


                                                                                                 WM8998
        The external connections for the Microphone Detect circuit are illustrated in Figure 60. In typical
        applications, it can be used to detect a microphone or button press.
        Note that, when using the Microphone Detect circuit, it is recommended to use one of the Right
        channel analogue microphone input paths, to ensure best immunity to electrical transients arising
        from the external accessory.
        The voltage reference for the microphone detection is configured using the MICD_BIAS_SRC
        register, as described in Table 67. The microphone detection function will automatically enable the
        applicable reference when required for MICDET impedance measurement.
        If the selected reference (MICBIAS1, MICBIAS2 or MICBIAS3) is not already enabled (ie. if
        MICBn_ENA = 0, where n is 1, 2 or 3 as appropriate), then the applicable MICBIAS source will be
        enabled for short periods of time only, every time the impedance measurement is scheduled. To allow
        time for the MICBIAS source to start-up, a time delay is applied before the measurement is
        performed; this is configured using the MICD_BIAS_STARTTIME register, as described in Table 67.
        The MICD_BIAS_STARTTIME register should be set to 16ms or more if MICBn_RATE = 1 (pop-free
        start-up / shut-down). The MICD_BIAS_STARTTIME register should be set to 0.25ms or more if
        MICBn_RATE = 0 (fast start-up / shut-down).
        If the selected reference is not enabled continuously (ie. if MICBn_ENA = 0), then the applicable
        MICBIAS discharge bit (MICBn_DISCH) should be set to 0.
        The MICBIAS sources are configured using the registers described in the “Charge Pumps, Regulators
        and Voltage Reference” section.
                                                                MICVDD                                      LDO2
                                                                                                          Regulator
                                                              MICBIAS1
                                                              MICBIAS2
                                                              MICBIAS3
                                                                                   Microphone Supply selected by MICD_BIAS_SRC
                                                                                   (MICVDD, MICBIAS1, MICBIAS2, MICBIAS3)
                                               2.2k
                                              (+/-2%)
           External accessories :-
                                                                MICDET
                                                                                                      Accessory /
                                                                                                     Button Detect
                                                                                      Microphone/Accessory detection
                                                                                      selected by ACCDET_MODE
                                                            C
                                                                  *IN2BP
                                                                                               Analogue Input
                                                                   AGND              * Note that the IN2B analogue input
                                                                                     channel is recommended with the
                                                                                     external accessory detect function
           button 2      Hookswitch
                                     Microphone
                          / button 1
        Figure 60 Microphone and Accessory Detect Interface
        When the discrete measurement mode is selected (ACCDET_MODE=000), the MICD_LVL_SEL [7:0]
        register bits allow each of the impedance measurement levels to be enabled or disabled
        independently. This allows the function to be tailored to the particular application requirements.
        If one or more bits within the MICD_LVL_SEL register is set to 0, then the corresponding impedance
        level will be disabled. Any measured impedance which lies in a disabled level will be reported as the
        next lowest, enabled level.
        For example, the MICD_LVL_SEL [2] bit enables the detection of impedances around 73. If
        MICD_LVL_SEL [2] = 0, then an external impedance of 73 will not be indicated as 73 but will be
        indicated as 40; this would be reported in the MICD_LVL register as MICD_LVL [2] = 1.
        With all measurement levels enabled, the WM8998 can detect the presence of a typical microphone
        and up to 6 push-buttons. The microphone detect function is specifically designed to detect a video
        accessory (typical 75) load if required.
        See “Applications Information” for typical recommended external components for microphone, video
Rev 4.1                                                                                                                      167


                                                                                                                  WM8998
                              or push-button accessory detection.
                              The accuracy of the microphone detect function is assured whenever the connected load is within the
                              applicable limits specified in the “Electrical Characteristics”. It is required that a 2.2k (2%) resistor
                              must also be connected between MICDET and the selected MICBIAS reference; note that different
                              resistor values will lead to inaccuracy in the impedance measurement.
                              Note that the connection of a microphone will change the measured impedance on the MICDET pin;
                              see “Applications Information” for recommended components for typical applications.
                              The measurement time varies between 100s and 500s, depending on the impedance of the
                              external load. A high impedance will be measured faster than a low impedance.
                              The timing of the microphone detect function is illustrated in Figure 61. Two different cases are
                              shown, according to whether MICBIASn is enabled periodically by the impedance measurement
                              function (MICBn_ENA=0), or is enabled at all times (MICBn_ENA=1).
                                          MICBn_ENA=0 :
                                          MICBIASn is enabled periodically for measurement function
                                              Measurement time
                                              (100us to 500us)
                                                                                                                               time
                                                              MICD_RATE
                                                     (0ms to 512ms; 0.25ms default)
    MICD_BIAS_STARTTIME
  (0ms to 512ms; 0.25ms default)
                                          MICBn_ENA=1 :
                                          MICBIASn is enabled constantly
                                              Measurement time
                                              (100us to 500us)
                                                                                                                               time
                                                              MICD_RATE
                                                     (0ms to 512ms; 0.25ms default)
Figure 61 Microphone and Accessory Detect Timing
                              HEADPHONE DETECT
                              The WM8998 headphone detection circuit measures the impedance of an external headphone load.
                              This feature can be used to set different gain levels or to apply other configuration settings according
                              to the type of load connected. Separate monitor pins are provided for headphone detection on the left
                              and right channels of HPOUT.
                              Headphone detection can be enabled on the HPDETL pin or the HPDETR pin. Under recommended
                              configuration, these pins provide measurement of the HPOUTL and HPOUTR loads respectively.
                              The headphone detect function can also be enabled on the MICDET1 pin or the MICDET2 pin. Note
                              that, in this configuration, any MICBIAS output that is connected to the selected MICDET pin must be
                              disabled and floating (MICBn_ENA=0, MICBn_DISCH=0).
168                                                                                                                           Rev 4.1


                                                                                         WM8998
        The applicable headphone detection pin is selected using the ACCDET_MODE register. When
        MICDETn is selected (ACCDET_MODE=100), the applicable MICDETn pin is determined by the
        ACCDET_SRC register, as described in Table 69.
        The WM8998 can only support one headphone or microphone detection function at any time. When
        the detection function is not in use, it is recommended to set ACCDET_MODE=000.
        The impedance measurement range is configured using the HP_IMPEDANCE_RANGE register. This
        register should be set in accordance with the expected load impedance.
        Note that setting the HP_IMPEDANCE_RANGE register is not required for detection on the MICDETn
        pins (ACCDET_MODE=100). Note also that the impedance measurement range in this mode is
        different to the HPDETL and HPDETR measurement modes.
        Headphone detection on the selected channel is commanded by writing a ‘1’ to the HP_POLL register
        bit.
        For correct operation, the respective output driver(s) must be disabled when headphone detection is
        commanded on HPOUTL or HPOUTR. The required register settings are shown in Table 68.
        See Table 52 for details of the HPL_ENA and HPR_ENA register bits. The applicable headphone
        output(s) must not be enabled until after the headphone detection has completed.
                       DESCRIPTION                                        REQUIREMENT
          HPOUTL Impedance measurement                  HPL_ENA = 0
          HPOUTR Impedance measurement                  HPR_ENA = 0
        Table 68 Output Configuration for Headphone Detect
        When headphone detection is commanded, the WM8998 uses an adjustable current source to
        determine the connected impedance. A sweep of measurement currents is applied. The rate of this
        sweep can be adjusted using the HP_CLK_DIV register.
        The timing of the current source ramp is also controlled by the HP_HOLDTIME register. It is
        recommended that the default setting (000b) be used for this parameter.
        Completion of the headphone detection is indicated by the HP_DONE register bit. When this bit is set,
        the measured load impedance can be read from the HP_LVL register. Note that, after the HP_DONE
        bit has been asserted, it will remain asserted until a subsequent headphone detection measurement is
        commanded.
        The headphone detection result (HP_LVL) is restricted to values that are close to the range defined
        by the HP_IMPEDANCE_RANGE register. If the HP_LVL register reports an impedance that is
        outside the selected range, then it is recommended to adjust the HP_IMPEDANCE_RANGE value
        and repeat the measurement. For minimum measurement time, the lowest impedance range
        (HP_IMPEDANCE_RANGE=00) should be selected in the first instance.
        The headphone detection function is an input to the Interrupt control circuit and can be used to trigger
        an Interrupt event on completion of the headphone detection - see “Interrupts”.
        The headphone detection function can also generate a GPIO output, providing an external indication
        of the headphone detection. See “General Purpose Input / Output” to configure a GPIO pin for this
        function.
        The register fields associated with Headphone Detection are described in Table 69. The external
        circuit configuration is illustrated in Figure 62.
Rev 4.1                                                                                                     169


                                                              WM8998
     REGISTER   BIT       LABEL  DEFAULT               DESCRIPTION
     ADDRESS
    R659       13   ACCDET_SRC     0     Accessory Detect / Headphone
    (0293h)                              Feedback pin select
    Accessory                            0 = Accessory detect on MICDET1,
    Detect                               Headphone ground feedback on
    Mode 1                               HPOUTFB1
                                         1 = Accessory detect on MICDET2,
                                         Headphone ground feedback on
                                         HPOUTFB2
               2:0  ACCDET_MODE    00    Accessory Detect Mode Select
                    [2:0]                000 = Microphone detect (MICDETn,
                                         discrete mode)
                                         001 = Headphone detect (HPDETL)
                                         010 = Headphone detect (HPDETR)
                                         011 = Reserved
                                         100 = Headphone detect (MICDETn)
                                         101 = Reserved
                                         110 = Reserved
                                         111 = Microphone detect (MICDETn,
                                         ADC mode)
                                         Note that the MICDETn measurements
                                         are implemented on either the MICDET1
                                         or MICDET2 pins, depending on the
                                         ACCDET_SRC register bit.
    R667      10:9  HP_IMPEDANCE   00    Headphone Detect Range
    (029Bh)         _RANGE [1:0]         00 = 4 ohms to 30 ohms
    Headphone                            01 = 8 ohms to 100 ohms
    Detect 1                             10 = 100 ohms to 1k ohms
                                         11 = 1k ohms to 10k ohms
                                         Only valid when ACCDET_MODE=001
                                         or ACCDET_MODE=010.
               7:5  HP_HOLDTIME   000    Headphone Detect Hold Time
                    [2:0]                (Selects the hold time between ramp up
                                         and ramp down of the headphone detect
                                         current source. The clock cycle rate is
                                         set by HP_CLK_DIV.)
                                         000 = 1 clock cycle
                                         001 = 4 clock cycles
                                         010 = 16 clock cycles
                                         011 = 64 clock cycles
                                         100 = 256 clock cycles
                                         101 = 512 clock cycles
                                         110 = 768 clock cycles
                                         111 =1024 clock cycles
               4:3  HP_CLK_DIV     00    Headphone Detect Clock Rate
                    [1:0]                (Selects the clocking rate of the
                                         headphone detect adjustable current
                                         source.)
                                         00 = 32kHz
                                         01 = 16kHz
                                         10 = 8kHz
                                         11 = 4kHz
                0   HP_POLL        0     Headphone Detect Enable
                                         Write 1 to start HP Detect function
170                                                                        Rev 4.1


                                                                        WM8998
          REGISTER     BIT        LABEL   DEFAULT                  DESCRIPTION
          ADDRESS
         R668          15   HP_DONE          0    Headphone Detect Status
         (029Ch)                                  0 = HP Detect not complete
         Headphone                                1 = HP Detect done
         Detect 2     14:0  HP_LVL [14:0]  0000h  Headphone Detect Level
                                                  LSB = 0.5ohm
                                                  8 = 4ohm or less
                                                  9 = 4.5 ohm
                                                  10 = 5 ohm
                                                  11 = 5.5 ohm
                                                  ….
                                                  20,000 = 10k ohm or more
                                                  When ACCDET_MODE=001 or 010, this
                                                  field is valid from 4ohm to10k ohm.
                                                  When ACCDET_MODE=100, this field is
                                                  valid from 400ohm to 6k ohm.
                                                  Note that, when ACCDET_MODE=001
                                                  or 010, the HP_LVL readback is only
                                                  valid within the range selected by
                                                  HP_IMPEDANCE_RANGE.
                                                  If HP_LVL reports a value outside the
                                                  selected range, then the range should be
                                                  adjusted and the measurement
                                                  repeated.
                                                  A result of 0 ohms may be reported if the
                                                  measurement is less than the minimum
                                                  value for the selected range.
        Table 69 Headphone Detect Control
Rev 4.1                                                                                  171


                                                                                                                   WM8998
                                     (optional series resistors)
                                                                 HPOUTL
                                                                 HPOUTR
                                                                                                  MICDET1/HPOUTFB2 or
                                                                                                  HPOUTFB1/MICDET2
                                                   MICDET1/HPOUTFB2                               selected by ACCDET_SRC
                                                   HPOUTFB1/MICDET2
                                                                                                           Headphone Detect /
                                                                  HPDETL                                Impedance measurement
                                                                 HPDETR
 (Note: HPOUTFB* ground
 connection close to headset jack)
                                                                                              Headphone Detect selected by
                                                                                              ACCDET_MODE
Figure 62 Headphone Detect Interface
                               The external connections for the Headphone Detect circuit are illustrated in Figure 62. Note that only
                               the HPOUTL or HPOUTR headphone outputs should be connected to HPDETL or HPDETR pins -
                               impedance measurement is not supported on LINEOUTL, LINEOUTR, EPOUTP or EPOUTN.
                               Note that, where external resistors are connected in series with the headphone load, as illustrated, it
                               is recommended that the HPDETx connection is to the headphone side of the resistors. If the
                               HPDETx connection is made to the WM8998 ‘end’ of these resistors, this will lead to a corresponding
                               offset in the measured impedance.
                               Note that the measurement accuracy of the headphone detect function may be up to +/-20%.
                               Under default conditions, the measurement time varies between 17ms and 244ms, depending on the
                               impedance of the external load. A high impedance will be measured faster than a low impedance.
172                                                                                                                        Rev 4.1


                                                                                              WM8998
LOW POWER SLEEP CONFIGURATION
               The WM8998 supports a low-power ‘Sleep’ mode, where most functions are disabled, and power
               consumption is minimised. A selectable ‘Wake-Up’ event can be configured to return the device to full
               operation and/or execute a specific response to the particular Wake-Up condition.
               A Wake-Up event is triggered via hardware input pin(s); in typical applications, these inputs are
               associated with jack insert (via the JACKDET analogue input) or external push-button detection (via
               the GPIO5 digital input). A Wake-Up transition can also be triggered using the LDOENA pin to enable
               LDO1 (assuming that DCVDD is supplied by LDO1).
               The WM8998 enters Sleep mode when LDO1 is disabled, causing the DCVDD supply to be removed.
               The AVDD, DBVDD1, and LDOVDD supplies must be present throughout the Sleep mode duration.
               Note that it is assumed that DCVDD is supplied by LDO1; see the “Charge Pumps, Regulators and
               Voltage Reference” for specific control requirements where DCVDD is not powered from LDO1.
               SLEEP MODE
               The WM8998 enters Sleep mode when LDO1 is disabled, causing the DCVDD supply to be removed.
               (LDO1 can be controlled using the LDO1_ENA register bit, or using the LDOENA pin; both of these
               controls must be de-asserted to disable the LDO.) The AVDD, DBVDD1, and LDOVDD supplies must
               be present throughout the Sleep mode; under these conditions, and with LDO1 disabled, most of the
               Digital Core (and control registers) are held in reset.
               Note that it is assumed that DCVDD is supplied by LDO1; see the “Charge Pumps, Regulators and
               Voltage Reference” for specific control requirements where DCVDD is not powered from LDO1.
               The system clocks (SYSCLK, ASYNCCLK) are not required in Sleep mode, and the external clock
               inputs (MCLKn) may be stopped, except as described below.
               If de-bounce is enabled on any of the configured Wake-Up signals (JACKDET or GPIO5), then the
               32kHz clock must be active during Sleep mode (see “Clocking and Sample Rates”). The 32kHz clock
               must be derived from the MCLK2 pin in this case. The 32kHz clock must be configured using
               CLK_32K_ENA and CLK_32K_SRC before Sleep mode is entered.
               The MCLK2 frequency limit in Sleep mode (see “Signal Timing Requirements”) must be observed
               before entering Sleep mode, and maintained until after Wake-Up.
               Selected functions and control registers are maintained via an ‘Always-On’ internal supply domain in
               Sleep mode. The ‘Always-On’ control registers are listed in Table 70. These registers are maintained
               (ie. not reset) in Sleep mode.
               Note that the Control Interface is not supported in Sleep mode. Read/Write access to the ‘Always-On’
               registers is not possible in Sleep mode.
Rev 4.1                                                                                                        173


                                                             WM8998
    REGISTER            LABEL                          REFERENCE
     ADDRESS
    40h      WKUP_MICD_CLAMP_FALL     See Table 73
             WKUP_MICD_CLAMP_RISE
             WKUP_GP5_FALL
             WKUP_GP5_RISE
             WKUP_JD1_FALL
             WKUP_JD1_RISE
    41h      WSEQ_ENA_MICD_CLAMP_FAL  See Table 74
             L
             WSEQ_ENA_MICD_CLAMP_RIS
             E
             WSEQ_ENA_GP5_FALL
             WSEQ_ENA_GP5_RISE
             WSEQ_ENA_JD1_FALL
             WSEQ_ENA_JD1_RISE
    66h      WSEQ_MICD_CLAMP_RISE_IND See “Control Write Sequencer”
             EX
    67h      WSEQ_MICD_CLAMP_FALL_IND
             EX
    68h      WSEQ_GP5_RISE_INDEX
    69h      WSEQ_GP5_FALL_INDEX
    6Ah      WSEQ_JD1_RISE_INDEX
    6Bh      WSEQ_JD1_FALL_INDEX
    100h     CLK_32K_ENA              See “Clocking and Sample Rates”
             CLK_32K_SRC
    210h     LDO1_VSEL                See “Charge Pumps, Regulators and
             LDO1_DISCH               Voltage Reference”
             LDO1_BYPASS
             LDO1_ENA
    02A2h    MICD_CLAMP_MODE          See “External Accessory Detection”
    02D3h    JD1_ENA                  See “External Accessory Detection”
    0C04h    GP5_DIR                  See “General Purpose Input / Output”
             GP5_PU
             GP5_PD
             GP5_POL
             GP5_OP_CFG
             GP5_DB
             GP5_LVL
             GP5_FN
    0C0Fh    IRQ_POL                  See “Interrupts”
             IRQ_OP_CFG
    0C10h    GP_DBTIME                See “General Purpose Input / Output”
    0C18h    SW1_MODE
    0C20h    LDO1ENA_PD               See “Charge Pumps, Regulators and
             LDO1ENA_PU               Voltage Reference”
             MCLK2_PD                 See “Clocking and Sample Rates”
             RESET_PU                 See “Hardware Reset, Software Reset,
             RESET_PD                 Wake-Up, and Device ID”
    0D0Fh    IM_IRQ1                  See “Interrupts”
    0D1Fh    IM_IRQ2
    0D50h    MICD_CLAMP_FALL_TRIG_STS See Table 72
             MICD_CLAMP_RISE_TRIG_STS
             GP5_FALL_TRIG_STS
174                                                                      Rev 4.1


                                                                                             WM8998
           REGISTER                      LABEL                                      REFERENCE
           ADDRESS
                          GP5_RISE_TRIG_STS
                          JD1_FALL_TRIG_STS
                          JD1_RISE_TRIG_STS
          0D51h           MICD_CLAMP_FALL_EINT1                    See “Interrupts”
                          MICD_CLAMP_RISE_EINT1
                          GP5_FALL_EINT1
                          GP5_RISE_EINT1
                          JD1_FALL_EINT1
                          JD1_RISE_EINT1
          0D52h           MICD_CLAMP_FALL_EINT2                    See “Interrupts”
                          MICD_CLAMP_RISE_EINT2
                          GP5_FALL_EINT2
                          GP5_RISE_EINT2
                          JD1_FALL_EINT2
                          JD1_RISE_EINT2
          0D53h           IM_MICD_CLAMP_FALL_EINT1                 See “Interrupts”
                          IM_MICD_CLAMP_RISE_EINT1
                          IM_GP5_FALL_EINT1
                          IM_GP5_RISE_EINT1
                          IM_JD1_FALL_EINT1
                          IM_JD1_RISE_EINT1
          0D54h           IM_MICD_CLAMP_FALL_EINT2                 See “Interrupts”
                          IM_MICD_CLAMP_RISE_EINT2
                          IM_GP5_FALL_EINT2
                          IM_GP5_RISE_EINT2
                          IM_JD1_FALL_EINT2
                          IM_JD1_RISE_EINT2
          0D56h           MICD_CLAMP_DB                            See “External Accessory Detection”
                          JD1_DB
          3000h to        WSEQ_DATA_WIDTHn                         See “Control Write Sequencer”
          31FFh           WSEQ_ADDRn
                          WSEQ_DELAYn
                          WSEQ_DATA_STARTn
                          WSEQ_DATAn
        Table 70 Sleep Mode ‘Always-On’ Control Registers
        The ‘Always-On’ digital input / output pins are listed in Table 71. All other digital input pins will have no
        effect in Sleep mode. The IRQ
                                    ¯¯¯ output is normally de-asserted in Sleep mode.
        Note that, in Sleep mode, the IRQ
                                        ¯¯¯ output can only be asserted in response to the JD1 or GP5 control
        signals (these described in the following section). If the IRQ
                                                                    ¯¯¯ output is asserted in Sleep mode, it can
        only be de-asserted after a Wake-Up transition.
           PIN NAME                  DESCRIPTION                                    REFERENCE
          LDOENA          Enable pin for LDO1                      See “Charge Pumps, Regulators and
                                                                   Voltage Reference”
          RESET
          ¯¯¯¯¯¯          Digital Reset input (active low)         See “Hardware Reset, Software Reset,
                                                                   Wake-Up, and Device ID”
          MCLK2           Master clock 2                           See “Clocking and Sample Rates”
          GPIO5           General Purpose pin GPIO5                See “General Purpose Input / Output”
          IRQ
          ¯¯¯             Interrupt Request (IRQ) output           See “Interrupts”
        Table 71 Sleep Mode ‘Always-On’ Digital Input Pins
Rev 4.1                                                                                                          175


                                                                                          WM8998
    A Wake-Up transition is triggered using the JD1 or GP5 control signals (defined below).
    It is assumed that DCVDD is supplied by LDO1. The AVDD, DBVDD1 and LDOVDD supplies must be
    present throughout the Sleep mode duration. See “Charge Pumps, Regulators and Voltage
    Reference” for specific control requirements where DCVDD is not powered from LDO1.
    Note that a logic ‘1’ applied to the LDOENA pin will also cause a Wake-Up transition. In this event,
    however, the configurable Wake-Up events (described below) are not applicable.
    SLEEP CONTROL SIGNALS - JD1, GP5, MICDET CLAMP
    The internal control signals JD1 and GP5 are provided to support the low-power Sleep mode. The
    MICDET Clamp status is controlled by a selectable logic function, derived from JD1 and/or GP5. A
    rising or falling edge of these signals can be used to trigger a Wake-Up transition (ie. exit from Sleep
    mode).
    The JD1, GP5 and MICDET Clamp status signals can also be used to trigger the Control Write
    Sequencer and/or the Interrupt Controller.
    Note that it is possible to enable more than one response from these control signals. For example, a
    particular edge transition could trigger a Wake-Up transition, and also a Control Write Sequence.
    The JD1, GP5 and MICDET Clamp status signals are described in this section. The Wake-Up, Write
    Sequencer, and Interrupt actions are described in the sections that follow.
    The JD1 signal is derived from the Jack Detect function (see “External Accessory Detection”). This
    input can be used to trigger Wake-Up or other actions in response to a jack insertion or jack removal
    detection.
    When the JD1 signal is enabled, it indicates the status of the JACKDET input pin. See Table 65 for
    details of the associated control registers.
    The GP5 signal is derived from the GPIO5 input pin (see “General Purpose Input / Output”). This input
    can be used to trigger Wake-Up or other actions in response to a logic level input detected on the
    GPIO5 pin.
    When using the GP5 signal, the GPIO5 pin must be configured as a GPIO input (GP5_DIR=1,
    GP5_FN=01h). An internal pull-up or pull-down resistor may be enabled on the GPIO5 pin if required.
    The GPIO pin control registers are defined in Table 75.
    The MICDET Clamp status is controlled by the JD1 and/or GP5 signals (see “External Accessory
    Detection”). The configurable logic provides flexibility in selecting the appropriate conditions for
    activating the MICDET Clamp. The clamp status can be used to trigger Wake-Up or other actions in
    response to a jack insertion or jack removal detection.
    The MICDET Clamp function is configured using the MICD_CLAMP_MODE register, as described in
    Table 66.
    Whenever a rising or falling edge is detected on JD1, GP5 or MICDET Clamp status, the WM8998 will
    assert the respective trigger status (_TRIG_STS) bit. The trigger status bits are latching fields and,
    once they are set, they are not reset until a ‘1’ is written to the respective register bit(s).
    The JD1, GP5 and MICDET Clamp trigger status bits are described in Table 72.
    The trigger status bits can be used to control Wake-Up and Write Sequencer actions. The JD1, GP5
    and MICDET Clamp signals are inputs to the Interrupt Controller. Each of these functions is described
    in the following sections.
176                                                                                                 Rev 4.1


                                                                                           WM8998
             REGISTER      BIT               LABEL              DEFAULT                 DESCRIPTION
             ADDRESS
           R3408           7       MICD_CLAMP_FALL_                 0        MICDET Clamp Trigger Status
           (0D50h)                 TRIG_STS                                  (Falling edge triggered)
           AOD wkup                                                          Note: Cleared when a ‘1’ is written
           and trig        6       MICD_CLAMP_RISE_                 0        MICDET Clamp Trigger Status
                                   TRIG_STS                                  (Rising edge triggered)
                                                                             Note: Cleared when a ‘1’ is written
                           5       GP5_FALL_TRIG_STS                0        GP5 Trigger Status
                                                                             (Falling edge triggered)
                                                                             Note: Cleared when a ‘1’ is written
                           4       GP5_RISE_TRIG_STS                0        GP5 Trigger Status
                                                                             (Rising edge triggered)
                                                                             Note: Cleared when a ‘1’ is written
                           3       JD1_FALL_TRIG_STS                0        JD1 Trigger Status
                                                                             (Falling edge triggered)
                                                                             Note: Cleared when a ‘1’ is written
                           2       JD1_RISE_TRIG_STS                0        JD1 Trigger Status
                                                                             (Rising edge triggered)
                                                                             Note: Cleared when a ‘1’ is written
        Table 72 JD1, GP5 and MICDET Clamp Trigger Status Registers
        Note that the de-bounce function on all inputs (including JD1, GP5 and MICDET Clamp status) use
        the 32kHz clock (see “Clocking and Sample Rates”). The 32kHz clock must be enabled whenever
        input de-bounce functions are required.
        Note that the MCLK2 input pin is on the ‘Always-On’ domain, and is supported in Sleep mode.
        (MCLK1 input is not supported in Sleep mode.)
        If input de-bounce is enabled in Sleep mode, the 32kHz clock must use MCLK2 (direct) input as its
        source (CLK_32K_SRC = 01).
        WAKE-UP TRANSITION
        A Wake-Up transition (exit from Sleep) can be associated with any of the JD1, GP5 or MICDET
        Clamp trigger status bits. This is selected using the register bits described in Table 73.
             REGISTER      BIT               LABEL              DEFAULT                 DESCRIPTION
             ADDRESS
           R64 (0040h)     7       WKUP_MICD_CLAMP                 0         MICDET Clamp (Falling) Wake-Up
           Wake                    _FALL                                     Select
           Control                                                           0 = Disabled
                                                                             1 = Enabled
                           6       WKUP_MICD_CLAMP                 0         MICDET Clamp (Rising) Wake-Up
                                   _RISE                                     Select
                                                                             0 = Disabled
                                                                             1 = Enabled
                           5       WKUP_GP5_FALL                   0         GP5 (Falling) Wake-Up Select
                                                                             0 = Disabled
                                                                             1 = Enabled
                           4       WKUP_GP5_RISE                   0         GP5 (Rising) Wake-Up Select
                                                                             0 = Disabled
                                                                             1 = Enabled
                           3       WKUP_JD1_FALL                   0         JD1 (Falling) Wake-Up Select
                                                                             0 = Disabled
                                                                             1 = Enabled
                           2       WKUP_JD1_RISE                   0         JD1 (Rising) Wake-Up Select
                                                                             0 = Disabled
                                                                             1 = Enabled
        Table 73 JD1, GP5 and MICDET Clamp Wake-Up Control Registers
Rev 4.1                                                                                                       177


                                                                                       WM8998
    When a valid ‘Wake-Up’ event is detected, the WM8998 will enable LDO1 (and DCVDD), and a user-
    configurable Boot Sequence is executed (see “Hardware Reset, Software Reset, Wake-Up, and
    Device ID”).
    Note that the trigger status (_TRIG_STS) bits are latching fields. Care is required when resetting
    these bits, to ensure the intended device behaviour - resetting the _TRIG_STS register(s) may cause
    LDO1 (and DCVDD) to be disabled.
    For normal device operation following a ‘Wake-Up’ transition, the LDO1_ENA register must be set (or
    the LDOENA pin asserted) before the _TRIG_STS bit(s) are reset. (Note that further options are
    described in the next section.)
    For recommended use of the Sleep / Wake-Up functions, it is assumed that DCVDD is powered from
    the output of LDO1 (see “Charge Pumps, Regulators and Voltage Reference”).
    If DCVDD is powered externally (not from LDO1), then the JD1, GP5 and MICDET Clamp inputs
    cannot trigger a Wake-Up transition directly; a Wake-Up transition will only occur by re-application of
    DCVDD. In this configuration, the JD1, GP5 or MICDET Clamp inputs can provide a signal to the host
    processor, via the IRQ¯¯¯ output; if a Wake-Up transition is required, this can be implemented by the
    host processor controlling the DCVDD supply.
    If DCVDD is powered externally, then the WKUP_* control bits described in Table 73 must be held at
    0 at all times.
    WRITE SEQUENCE CONTROL
    A Control Write Sequence can be associated with any of the JD1, GP5 or MICDET Clamp trigger
    status bits. This is selected using the register bits described in Table 74.
    Note that the JD1, GP5 and MICDET Clamp trigger status bits can be used to trigger the Control
    Write Sequencer at any time. This feature may be used during normal operation, or immediately
    following a Wake-Up transition.
        REGISTER          BIT            LABEL               DEFAULT                DESCRIPTION
         ADDRESS
       R65 (0041h)        7     WSEQ_ENA_MICD_C                  0       MICDET Clamp (Falling) Write
       Sequence                 LAMP_FALL                                Sequencer Select
       Control                                                           0 = Disabled
                                                                         1 = Enabled
                          6     WSEQ_ENA_MICD_C                  0       MICDET Clamp (Rising) Write
                                LAMP_RISE                                Sequencer Select
                                                                         0 = Disabled
                                                                         1 = Enabled
                          5     WSEQ_ENA_GP5_FA                  0       GP5 (Falling) Write Sequencer
                                LL                                       Select
                                                                         0 = Disabled
                                                                         1 = Enabled
                          4     WSEQ_ENA_GP5_RIS                 0       GP5 (Rising) Write Sequencer
                                E                                        Select
                                                                         0 = Disabled
                                                                         1 = Enabled
                          3     WSEQ_ENA_JD1_FAL                 0       JD1 (Falling) Write Sequencer
                                L                                        Select
                                                                         0 = Disabled
                                                                         1 = Enabled
                          2     WSEQ_ENA_JD1_RIS                 0       JD1 (Rising) Write Sequencer
                                E                                        Select
                                                                         0 = Disabled
                                                                         1 = Enabled
    Table 74 JD1, GP5 and MICDET Clamp Write Sequencer Control Registers
178                                                                                                Rev 4.1


                                                                                          WM8998
        When a valid ‘Write Sequencer’ control event is detected, the respective control sequence will be
        scheduled. See “Control Write Sequencer” for further details.
        Note that the trigger status (_TRIG_STS) bits are latching fields. Care is required when resetting
        these bits, to ensure the intended device behaviour - resetting the _TRIG_STS register(s) may cause
        LDO1 (and DCVDD) to be disabled.
        A valid clock (SYSCLK) must be enabled whenever a Control Write Sequence is scheduled.
        If the JD1, GP5 or MICDET Clamp trigger status bits are associated with the Control Write Sequencer
        (using the register bits in Table 74) and also configured as Wake-Up events (using the register bits in
        Table 73), then the Boot Sequence must be programmed to configure and enable SYSCLK. (Note
        that the default SYSCLK frequency must be used in this case.)
        The Boot Sequence (see “Hardware Reset, Software Reset, Wake-Up, and Device ID”) is scheduled
        as part of the Wake-Up transition, and provides the capability to configure SYSCLK (and other
        register settings) prior to the Control Write Sequencer being triggered.
        Note that, if the Control Write Sequencer is triggered during normal operation, then SYSCLK will
        typically be already available, and no additional requirements will apply.
        To return to Sleep mode following a Wake-Up / Write Sequence, the last step of the control sequence
        must be to write ‘1’ to the applicable trigger status bit(s). The _TRIG_STS bit(s) will be reset, LDO1
        will be disabled, and the WM8998 will be in Sleep mode. (The LDO1_ENA bit must be set to 0, and
        the LDOENA pin must not be asserted.)
        To remain ‘On’ at the end of a Wake-up / Write Sequence, the control sequence must write ‘1’ to the
        LDO1_ENA bit before resetting the trigger status bit(s). Alternatively, the host processor should assert
        the LDOENA pin before resetting the trigger status bit(s).
        When the Control Write Sequencer is triggered during normal operation, it can be programmed to
        select the Sleep mode by writing ‘0’ to the LDO1_ENA bit. (The LDOENA pin must not be asserted.)
        See “Charge Pumps, Regulators and Voltage Reference” for details of the LDO1_ENA control bit.
        INTERRUPT CONTROL
        An Interrupt Request (IRQ) event can be associated with the JD1, GP5 or MICDET Clamp signals.
        Separate ‘mask’ bits are provided to enable IRQ events on the rising and/or falling edges of each
        signal.
        See “Interrupts” for further details.
Rev 4.1                                                                                                    179


                                                                                                  WM8998
GENERAL PURPOSE INPUT / OUTPUT
              The WM8998 provides a number of GPIO functions to enable interfacing and detection of external
              hardware and to provide logic outputs to other devices. The GPIO input functions can be used to
              generate an Interrupt (IRQ) event. The GPIO and Interrupt circuits support the following functions:
                        Logic input / Button detect (GPIO input)
                        Logic ‘1’ and logic ‘0’ output (GPIO output)
                        Interrupt (IRQ) status output
                        Clock output
                        Frequency Locked Loop (FLL) status output
                        Frequency Locked Loop (FLL) Clock output
                        IEC-60958-3 compatible S/PDIF output
                        Pulse Width Modulation (PWM) Signal output
                        Headphone Detection status output
                        Microphone / Accessory Detection status output
                        Output Signal Path Enable/Disable status output
                        Boot Sequence status output
                        Asynchronous Sample Rate Converter (ASRC) Lock status and Configuration Error output
                        Isochronous Sample Rate Converter (ISRC) Configuration Error output
                        Over-Temperature, Short Circuit Protection, and Speaker Shutdown status output
                        Dynamic Range Control (DRC) status output
                        Control Write Sequencer status output
                        Control Interface Error status output
                        Clocking Error status output
              Note that the GPIO pins are referenced to different power domains (DBVDD1, DBVDD2 or DBVDD3),
              as noted in the “Pin Description” section.
              In addition to the functions described in this section, the GPIO5 pin can be configured as an input to
              the Control Write Sequencer (see “Control Write Sequencer”). See also Table 74 for details of the
              associated register control fields.
              The GPIO5 pin is one of the ‘Always On’ digital input / output pins and can be used as a ‘Wake-Up’
              input in the low-power ‘Sleep’ mode. The GPIO5 pin can also be used as an input to the MICDET
              Clamp function, supporting additional functionality relating to jack insertion or jack removal events See
              “Low Power Sleep Configuration” for further details.
              The WM8998 also incorporates a General Purpose Switch feature, which can be used as a
              controllable analogue switch; details of this are provided at the end of this “General Purpose Input /
              Output” section.
180                                                                                                           Rev 4.1


                                                                                          WM8998
        GPIO CONTROL
        For each GPIO, the selected function is determined by the GPn_FN field, where n identifies the GPIO
        pin (1, 2, 3, 4 or 5). The pin direction, set by GPn_DIR, must be set according to function selected by
        GPn_FN.
        When a pin is configured as a GPIO input (GPn_DIR = 1, GPn_FN = 01h), the logic level at the pin
        can be read from the respective GPn_LVL bit. Note that GPn_LVL is not affected by the GPn_POL
        bit.
        A de-bounce circuit can be enabled on any GPIO input, to avoid false event triggers. This is enabled
        on each pin by setting the respective GPn_DB bit. The de-bounce circuit uses the 32kHz clock, which
        must be enabled whenever input de-bounce functions are required. The de-bounce time is
        configurable using the GP_DBTIME register. See “Clocking and Sample Rates” for further details of
        the WM8998 clocking configuration.
        Each of the GPIO pins is an input to the Interrupt control circuit and can be used to trigger an Interrupt
        event. An interrupt event is triggered on the rising and falling edges of the GPIO input. The associated
        interrupt bit is latched once set; it can be polled at any time or used to control the IRQ signal. See
        “Interrupts” for more details of the Interrupt event handling.
        Integrated pull-up and pull-down resistors are provided on each of the GPIO pins; these can be
        configured independently using the GPn_PU and GPn_PD fields. Note that, if GPn_PU and GPn_PD
        are both set for any GPIO pin, then the pull-up and pull-down will be disabled.
        When a pin is configured as a GPIO output (GPn_DIR = 0, GPn_FN = 01h), its level can be set to
        logic 0 or logic 1 using the GPn_LVL field. Note that the GPn_LVL registers are ‘write only’ when the
        respective GPIO pin is configured as an output.
        When a pin is configured as an output (GPn_DIR = 0), the polarity can be inverted using the
        GPn_POL bit. When GPn_POL = 1, then the selected output function is inverted. In the case of Logic
        Level output (GPn_FN = 01h), the external output will be the opposite logic level to GPn_LVL when
        GPn_POL = 1.
        A GPIO output can be either CMOS driven or Open Drain. This is selected on each pin using the
        respective GPn_OP_CFG bit.
        The register fields that control the GPIO pins are described in Table 75.
Rev 4.1                                                                                                      181


                                                                                        WM8998
       REGISTER         BIT             LABEL             DEFAULT                    DESCRIPTION
       ADDRESS
     R3072              15       GPn_DIR                      1         GPIOn Pin Direction
     (0C00h)                                                            0 = Output
     GPIO1 CTRL                                                         1 = Input
                        14       GPn_PU                       0         GPIOn Pull-Up Enable
     to                                                                 0 = Disabled
                                                                        1 = Enabled
     R3076
                        13       GPn_PD                       1         GPIOn Pull-Down Enable
     (0C04h)
                                                                        0 = Disabled
     GPIO5 CTRL
                                                                        1 = Enabled
                        11       GPn_LVL                      0         GPIOn level. Write to this bit to set
                                                                        a GPIO output. Read from this bit to
                                                                        read GPIO input level.
                                                                        For output functions only, when
                                                                        GPn_POL is set, the register is the
                                                                        opposite logic level to the external
                                                                        pin.
                                                                        Note that the GPn_LVL register is
                                                                        ‘write only’ when GPn_DIR=0.
                        10       GPn_POL                      0         GPIOn Output Polarity Select
                                                                        0 = Non-inverted (Active High)
                                                                        1 = Inverted (Active Low)
                         9       GPn_OP_CFG                   0         GPIOn Output Configuration
                                                                        0 = CMOS
                                                                        1 = Open Drain
                         8       GPn_DB                       1         GPIOn Input De-bounce
                                                                        0 = Disabled
                                                                        1 = Enabled
                       6:0       GPn_FN [6:0]                01h        GPIOn Pin Function
                                                                        (see Table 76 or Table 77 for
                                                                        details)
     R3088            15:12      GP_DBTIME                  0001        GPIO Input de-bounce time
     (0C10h)                     [3:0]                                  0h = 100us
     GPIO                                                               1h = 1.5ms
     Debounce                                                           2h = 3ms
     Config                                                             3h = 6ms
                                                                        4h = 12ms
                                                                        5h = 24ms
                                                                        6h = 48ms
                                                                        7h = 96ms
                                                                        8h = 192ms
                                                                        9h = 384ms
                                                                        Ah = 768ms
                                                                        Bh to Fh = Reserved
     Note: n is a number (1, 2, 3, 4 or 5) that identifies the individual GPIO.
    Table 75 GPIO Control
182                                                                                                   Rev 4.1


                                                                                         WM8998
        GPIO FUNCTION SELECT
        The available GPIO functions for GPIO pins 1, 2, 3 and 4 are described in Table 76. A subset of these
        functions is available for GPIO5, as described in Table 77.
        The function of each GPIO is set using the GPn_FN register, where n identifies the GPIO pin (1, 2, 3,
        4 or 5). Note that the respective GPn_DIR must also be set according to whether the function is an
        input or output.
          GPn_FN              DESCRIPTION                                   COMMENTS
             00h                                     No function
             01h       Button detect input / Logic   GPn_DIR = 0: GPIO pin logic level is set by GPn_LVL.
                       level output                  GPn_DIR = 1: Button detect or logic level input.
             02h       IRQ1 Output                   Interrupt (IRQ1) output
                                                     0 = IRQ1 not asserted
                                                     1 = IRQ1 asserted
             03h       IRQ2 Output                   Interrupt (IRQ2) output
                                                     0 = IRQ2 not asserted
                                                     1 = IRQ2 asserted
             04h       OPCLK Clock Output            Configurable clock output derived from SYSCLK
             05h       FLL1 Clock                    Clock output from FLL1
             06h       FLL2 Clock                    Clock output from FLL2
             07h       S/PDIF Output                 IEC-60958-3 compatible S/PDIF output
             08h       PWM1 Output                   Configurable Pulse Width Modulation output PWM1
             09h       PWM2 Output                   Configurable Pulse Width Modulation output PWM2
             0Ah       SYSCLK Underclocked           Indicates that an unsupported clocking configuration has
                       Error                         been attempted
                                                     0 = Normal
                                                     1 = SYSCLK underclocking error
             0Bh       ASYNCCLK                      Indicates that an unsupported clocking configuration has
                       Underclocked Error            been attempted
                                                     0 = Normal
                                                     1 = ASYNCCLK underclocking error
            0Ch        FLL1 Lock                     Indicates FLL1 Lock status
                                                     0 = Not locked
                                                     1 = Locked
            0Dh        FLL2 Lock                     Indicates FLL2 Lock status
                                                     0 = Not locked
                                                     1 = Locked
             0Fh       FLL1 Clock OK                 Indicates FLL1 Clock OK status
                                                     0 = FLL1 Clock output is not active
                                                     1 = FLL1 Clock output is active
             10h       FLL2 Clock OK                 Indicates FLL2 Clock OK status
                                                     0 = FLL2 Clock output is not active
                                                     1 = FLL2 Clock output is active
             12h       Headphone detect              Indicates Headphone Detection status
                                                     0 = Headphone Detect not complete
                                                     1 = Headphone Detect complete
             13h       Microphone detect             Microphone Detect (MICDET accessory) IRQ output
                                                     A single 31s pulse is output whenever an accessory
                                                     insertion, removal or impedance change is detected.
             15h       Write Sequencer status        Indicates Write Sequencer status
                                                     A short pulse is output when the Write Sequencer has
                                                     completed all scheduled sequences.
Rev 4.1                                                                                                    183


                                                                         WM8998
    GPn_FN       DESCRIPTION                                  COMMENTS
     16h   Control Interface Address Indicates Control Interface Address error
           Error                     0 = Normal
                                     1 = Control Interface Address error
     1Ah   ASRC1 Lock                Indicates ASRC1 Lock status
                                     0 = Not locked
                                     1 = Locked
     1Bh   ASRC2 Lock                Indicates ASRC2 Lock status
                                     0 = Not locked
                                     1 = Locked
     1Ch   ASRC Configuration Error  Indicates ASRC configuration error
                                     0 = ASRC configuration OK
                                     1 = ASRC configuration error
     1Dh   DRC1 Signal Detect        Indicates DRC1 Signal Detect status
                                     0 = Signal threshold not exceeded
                                     1 = Signal threshold exceeded
     1Eh   DRC1 Anti-Clip Active     Indicates DRC1 Anti-Clip status
                                     0 = Anti-Clip is not active
                                     1 = Anti-Clip is active
     1Fh   DRC1 Decay Active         Indicates DRC1 Decay status
                                     0 = Decay is not active
                                     1 = Decay is active
     20h   DRC1 Noise Gate Active    Indicates DRC1 Noise Gate status
                                     0 = Noise Gate is not active
                                     1 = Noise Gate is active
     21h   DRC1 Quick Release        Indicates DRC1 Quick Release status
           Active                    0 = Quick Release is not active
                                     1 = Quick Release is active
     27h   Mixer Dropped Sample      Indicates a dropped sample in the digital core mixers
           Error                     0 = Normal
                                     1 = Mixer dropped sample error
     2Bh   Speaker Overheat          Indicates Shutdown Temperature status
           Shutdown                  0 = Temperature is below shutdown level
                                     1 = Temperature is above shutdown level
     2Ch   Speaker Overheat          Indicates Warning Temperature status
           Warning                   0 = Temperature is below warning level
                                     1 = Temperature is above warning level
     2Dh   Underclocked Error        Indicates insufficient SYSCLK or ASYNCCLK cycles for
                                     one or more of the selected signal paths or signal
                                     processing functions. Increasing the SYSCLK or
                                     ASYNCCLK frequency (as applicable) should allow the
                                     selected configuration to be supported.
                                     0 = Normal
                                     1 = Underclocked error
     2Eh   Overclocked Error         Indicates that an unsupported device configuration has
                                     been attempted, as the clocking requirements of the
                                     requested configuration exceed the device limits.
                                     0 = Normal
                                     1 = Overclocked error
     2Fh   HPL Enable Status         HPOUTL Enable Status
                                     A short pulse is output when the HPOUTL Enable
                                     control sequence has completed.
     30h   HPR Enable Status         HPOUTR Enable Status
                                     A short pulse is output when the HPOUTR Enable
                                     control sequence has completed.
     31h   LINEL Enable Status       LINEOUTL Enable Status
                                     A short pulse is output when the LINEOUTL Enable
                                     control sequence has completed.
184                                                                                   Rev 4.1


                                                                           WM8998
        GPn_FN       DESCRIPTION                              COMMENTS
         32h   LINER Enable Status     LINEOUTR Enable Status
                                       A short pulse is output when the LINEOUTR Enable
                                       control sequence has completed.
         33h   EP Enable Status        EPOUT Enable Status
                                       A short s pulse is output when the EPOUT Enable
                                       control sequence has completed.
         34h   HPL Disable Status      HPOUTL Disable Status
                                       A short pulse is output when the HPOUTL Disable
                                       control sequence has completed.
         35h   HPR Disable Status      HPOUTR Disable Status
                                       A short pulse is output when the HPOUTR Disable
                                       control sequence has completed.
         36h   LINEL Disable Status    LINEOUTL Disable Status
                                       A short pulse is output when the LINEOUTL Disable
                                       control sequence has completed.
         37h   LINER Disable Status    LINEOUTR Disable Status
                                       A short pulse is output when the LINEOUTR Disable
                                       control sequence has completed.
         38h   EP Disable Status       EPOUT Disable Status
                                       A short pulse is output when the EPOUT Disable control
                                       sequence has completed.
         3Dh   OPCLK Async Clock       Configurable clock output derived from ASYNCCLK
               Output
         44h   Boot Done               Boot Status
                                       A short pulse is output when the Boot Sequence has
                                       completed.
         45h   SPKL Enable Status      SPKOUTL Enable Status
                                       A short pulse is output when the SPKOUTL Enable
                                       control sequence has completed.
         46h   SPKR Enable Status      SPKOUTR Enable Status
                                       A short pulse is output when the SPKOUTR Enable
                                       control sequence has completed.
         47h   SPKL Disable Status     SPKOUTL Disable Status
                                       A short pulse is output when the SPKOUTL Disable
                                       control sequence has completed.
         48h   SPKR Disable Status     SPKOUTR Disable Status
                                       A short pulse is output when the SPKOUTR Disable
                                       control sequence has completed.
         4Bh   SYSCLK_ENA Status       SYSCLK_ENA Status
                                       0 = SYSCLK_ENA is enabled
                                       1 = SYSCLK_ENA is disabled
         4Ch   ASYNC_CLK_ENA           ASYNC_CLK_ENA Status
               Status                  0 = ASYNC_CLK_ENA is enabled
                                       1 = ASYNC_CLK_ENA is disabled
         4Dh   ISRC1 Configuration     Indicates ISRC1 configuration error
               Error                   0 = ISRC configuration OK
                                       1 = ISRC configuration error
         4Eh   ISRC2 Configuration     Indicates ISRC2 configuration error
               Error                   0 = ISRC configuration OK
                                       1 = ISRC configuration error
         5Fh   SPKOUTL Short Circuit   SPKOUTL Short Circuit status
               Status                  0 = Normal
                                       1 = Short Circuit detected
         60h   SPKOUTR Short Circuit   SPKOUTR Short Circuit status
               Status                  0 = Normal
                                       1 = Short Circuit detected
         61h   Speaker Shutdown Status Speaker Shutdown Status
                                       0 = Normal
Rev 4.1                                                                                   185


                                                                                      WM8998
        GPn_FN             DESCRIPTION                                   COMMENTS
                                                  1 = Speaker Shutdown completed (due to Overheat
                                                  Temperature or Short Circuit condition)
    Table 76 GPIO Function Select (GPIO1, GPIO2, GPIO3, GPIO4)
        GPn_FN             DESCRIPTION                                   COMMENTS
          00h                                     No function
          01h       Button detect input / Logic   GPn_DIR = 0: GPIO pin logic level is set by GPn_LVL.
                    level output                  GPn_DIR = 1: Button detect or logic level input.
          02h       IRQ1 Output                   Interrupt (IRQ1) output
                                                  0 = IRQ1 not asserted
                                                  1 = IRQ1 asserted
          03h       IRQ2 Output                   Interrupt (IRQ2) output
                                                  0 = IRQ2 not asserted
                                                  1 = IRQ2 asserted
          04h       OPCLK Clock Output            Configurable clock output derived from SYSCLK
          05h       FLL1 Clock                    Clock output from FLL1
          06h       FLL2 Clock                    Clock output from FLL2
          08h       PWM1 Output                   Configurable Pulse Width Modulation output PWM1
          09h       PWM2 Output                   Configurable Pulse Width Modulation output PWM2
          3Dh       OPCLK Async Clock             Configurable clock output derived from ASYNCCLK
                    Output
    Table 77 GPIO Function Select (GPIO5)
    BUTTON DETECT (GPIO INPUT)
    GPn_FN = 01h.
    Button detect functionality can be selected on a GPIO pin by setting the respective GPIO registers as
    described in “GPIO Control”. The same functionality can be used to support a Jack Detect input
    function.
    It is recommended to enable the GPIO input de-bounce feature when using GPIOs as button input or
    Jack Detect input.
    The GPn_LVL fields may be read to determine the logic levels on a GPIO input, after the selectable
    de-bounce controls. Note that GPn_LVL is not affected by the GPn_POL bit.
    The de-bounced GPIO signals are also inputs to the Interrupt control circuit. An interrupt event is
    triggered on the rising and falling edges of the GPIO input. The associated interrupt bits are latched
    once set; it can be polled at any time or used to control the IRQ signal. See “Interrupts” for more
    details of the Interrupt event handling.
    LOGIC ‘1’ AND LOGIC ‘0’ OUTPUT (GPIO OUTPUT)
    GPn_FN = 01h.
    The WM8998 can be programmed to drive a logic high or logic low level on a GPIO pin by selecting
    the “GPIO Output” function as described in “GPIO Control”.
    The output logic level is selected using the respective GPn_LVL bit. Note that the GPn_LVL registers
    are ‘write only’ when the respective GPIO pin is configured as an output.
    The polarity of the GPIO output can be inverted using the GPn_POL registers. If GPn_POL=1, then
    the external output will be the opposite logic level to GPn_LVL.
186                                                                                                Rev 4.1


                                                                                        WM8998
        INTERRUPT (IRQ) STATUS OUTPUT
        GPn_FN = 02h, 03h.
        The WM8998 has an Interrupt Controller which can be used to indicate when any selected Interrupt
        events occur. An interrupt can be generated by any of the events described throughout the GPIO
        function definition above. Individual interrupts may be masked in order to configure the Interrupt as
        required. See “Interrupts” for further details.
        The Interrupt Controller supports two separate Interrupt Request (IRQ) outputs. The IRQ1 or IRQ2
        status may be output directly on a GPIO pin by setting the respective GPIO registers as described in
        “GPIO Control”.
        Note that the IRQ1 status is output on the IRQ¯¯¯ pin at all times.
        OPCLK AND OPCLK_ASYNC CLOCK OUTPUT
        GPn_FN = 04h, 3Dh.
        A clock output (OPCLK) derived from SYSCLK can be output on a GPIO pin. The OPCLK frequency
        is controlled by OPCLK_DIV and OPCLK_SEL. The OPCLK output is enabled using the OPCLK_ENA
        register, as described in Table 78.
        A clock output (OPCLK_ASYNC) derived from ASYNCCLK can be output on a GPIO pin. The
        OPCLK_ASYNC frequency is controlled by OPCLK_ASYNC_DIV and OPCLK_ASYNC_SEL. The
        OPCLK_ASYNC output is enabled using the OPCLK_ASYNC_ENA register
        It is recommended to disable the clock output (OPCLK_ENA=0 or OPCLK_ASYNC_ENA=0) before
        making any change to the respective OPCLK_DIV, OPCLK_SEL, OPCLK_ASYNC_DIV or
        OPCLK_ASYNC_SEL registers.
        The OPCLK or OPCLK_ASYNC Clock outputs can be output directly on a GPIO pin by setting the
        respective GPIO registers as described in “GPIO Control”.
        Note that the OPCLK source frequency cannot be higher than the SYSCLK frequency. The
        OPCLK_ASYNC source frequency cannot be higher than the ASYNCCLK frequency. The maximum
        output frequency supported for GPIO output is noted in the “Electrical Characteristics”.
        See “Clocking and Sample Rates” for more details of the system clocks (SYSCLK and ASYNCCLK).
Rev 4.1                                                                                                 187


                                                                     WM8998
      REGISTER     BIT        LABEL     DEFAULT               DESCRIPTION
       ADDRESS
     R329         15    OPCLK_ENA          0    OPCLK Enable
     (0149h)                                    0 = Disabled
     Output                                     1 = Enabled
     system       7:3   OPCLK_DIV [4:0]   00h   OPCLK Divider
     clock
                                                00h = Divide by 1
                                                01h = Divide by 1
                                                02h = Divide by 2
                                                03h = Divide by 3
                                                …
                                                1Fh = Divide by 31
                  2:0   OPCLK_SEL [2:0]   000   OPCLK Source Frequency
                                                000 = 6.144MHz (5.6448MHz)
                                                001 = 12.288MHz (11.2896MHz)
                                                010 = 24.576MHz (22.5792MHz)
                                                011 = 49.152MHz (45.1584MHz)
                                                All other codes are Reserved
                                                The frequencies in brackets apply for
                                                44.1kHz-related SYSCLK rates only (ie.
                                                SAMPLE_RATE_n = 01XXX).
                                                The OPCLK Source Frequency must be
                                                less than or equal to the SYSCLK
                                                frequency.
     R330         15    OPCLK_ASYNC_       0    OPCLK_ASYNC Enable
     (014Ah)            ENA                     0 = Disabled
     Output                                     1 = Enabled
     async clock  7:3   OPCLK_ASYNC_      00h   OPCLK_ASYNC Divider
                        DIV [4:0]               00h = Divide by 1
                                                01h = Divide by 1
                                                02h = Divide by 2
                                                03h = Divide by 3
                                                …
                                                1Fh = Divide by 31
                  2:0   OPCLK_ASYNC_      000   OPCLK_ASYNC Source Frequency
                        SEL [2:0]               000 = 6.144MHz (5.6448MHz)
                                                001 = 12.288MHz (11.2896MHz)
                                                010 = 24.576MHz (22.5792MHz)
                                                011 = 49.152MHz (45.1584MHz)
                                                All other codes are Reserved
                                                The frequencies in brackets apply for
                                                44.1kHz-related ASYNCCLK rates only
                                                (ie. ASYNC_SAMPLE_RATE_n =
                                                01XXX).
                                                The OPCLK_ASYNC Source Frequency
                                                must be less than or equal to the
                                                ASYNCCLK frequency.
    Table 78 OPCLK and OPCLK_ASYNC Control
188                                                                               Rev 4.1


                                                                                        WM8998
        FREQUENCY LOCKED LOOP (FLL) STATUS OUTPUT
        GPn_FN = 0Ch, 0Dh, 0Fh, 10h.
        The WM8998 supports FLL status flags, which may be used to control other events. See “Clocking
        and Sample Rates” for more details of the FLL.
        The ‘FLL Clock OK’ signals indicate that the respective FLL has started up and is providing an output
        clock. The ‘FLL Lock’ signals indicate whether FLL Lock has been achieved.
        The FLL Clock OK and FLL Lock signals may be output directly on a GPIO pin by setting the
        respective GPIO registers as described in “GPIO Control”.
        The FLL Clock OK and FLL Lock signals are inputs to the Interrupt Controller circuit. An interrupt
        event is triggered on the rising and falling edges of these signals. The associated interrupt bits are
        latched once set; they can be polled at any time or used to control the IRQ signal. See “Interrupts” for
        more details of the Interrupt event handling.
        FREQUENCY LOCKED LOOP (FLL) CLOCK OUTPUT
        GPn_FN = 05h, 06h.
        Clock outputs derived from the FLLs may be output on a GPIO pin. The GPIO output from each FLLn
        (where ‘n’ is 1 or 2) is controlled by the respective FLLn_GPCLK_DIV and FLLn_GPCLK_ENA
        registers, as described in Table 79.
        It is recommended to disable the clock output (FLLn_GPCLK_ENA=0) before making any change to
        the respective FLLn_GPCLK_DIV register.
        Note that the FLLn_GPCLK_DIV and FLLn_GPCLK_ENA registers affect the GPIO outputs only; they
        do not affect the FLL frequency. The maximum output frequency supported for GPIO output is noted
        in the “Electrical Characteristics”.
        The Frequency Locked Loop (FLL) Clock outputs may be output directly on a GPIO pin by setting the
        respective GPIO registers as described in “GPIO Control”.
        See “Clocking and Sample Rates” for more details of the WM8998 system clocking and for details of
        how to configure the FLLs.
            REGISTER         BIT         LABEL         DEFAULT                    DESCRIPTION
            ADDRESS
          R394              7:1   FLL1_GPCLK_DI          02h       FLL1 GPIO Clock Divider
          (018Ah)                 V [6:0]                          00h = Divide by 1
          FLL1 GPIO                                                01h = Divide by 1
          Clock                                                    02h = Divide by 2
                                                                   03h = Divide by 3
                                                                   …
                                                                   7Fh = Divide by 127
                                                                   (FGPIO = FVCO / FLL1_GPCLK_DIV)
                             0    FLL1_GPCLK_EN           0        FLL1 GPIO Clock Enable
                                  A                                0 = Disabled
                                                                   1 = Enabled
          R426              7:1   FLL2_GPCLK_DI          02h       FLL2 GPIO Clock Divider
          (01AAh)                 V [6:0]                          00h = Divide by 1
          FLL2 GPIO                                                01h = Divide by 1
          Clock                                                    02h = Divide by 2
                                                                   03h = Divide by 3
                                                                   …
                                                                   7Fh = Divide by 127
                                                                   (FGPIO = FVCO / FLL2_GPCLK_DIV)
                             0    FLL2_GPCLK_EN           0        FLL2 GPIO Clock Enable
                                  A                                0 = Disabled
                                                                   1 = Enabled
        Table 79 FLL Clock Output Control
Rev 4.1                                                                                                   189


                                                                                     WM8998
    SPDIF AUDIO OUTPUT
    GPn_FN = 07h.
    The WM8998 incorporates an IEC-60958-3 compatible S/PDIF transmitter, which can be selected as
    a GPIO output. The S/PDIF transmitter supports stereo audio channels, and allows full control over
    the S/PDIF validity bits and channel status information.
    The S/PDIF signal may be output directly on a GPIO pin by setting the respective GPIO registers as
    described in “GPIO Control”.
    See “Digital Core” for details of how to configure the S/PDIF output generator.
    PULSE WIDTH MODULATION (PWM) SIGNAL OUTPUT
    GPn_FN = 08h, 09h.
    The WM8998 incorporates two Pulse Width Modulation (PWM) signal generators which can be
    enabled as GPIO outputs. The duty cycle of each PWM signal can be modulated by an audio source,
    or can be set to a fixed value using a control register setting.
    The Pulse Width Modulation (PWM) outputs may be output directly on a GPIO pin by setting the
    respective GPIO registers as described in “GPIO Control”.
    See “Digital Core” for details of how to configure the PWM signal generators.
    Note that the PWM output should always be disabled (PWMn_ENA=0, as described in Table 18)
    whenever the system clock, SYSCLK, is disabled. Failure to do this may result in a persistent logic ‘1’
    DC output from the PWM generator. See “Clocking and Sample Rates” for details of system clocking
    and the associated control requirements.
    HEADPHONE DETECTION STATUS OUTPUT
    GPn_FN = 12h.
    The WM8998 provides a headphone detection circuit on the HPDETL and HPDETR pins to measure
    the impedance of an external load connected to the headphone outputs. See “External Accessory
    Detection” for further details.
    A logic signal from the headphone detection circuit may be output directly on a GPIO pin by setting
    the respective GPIO registers as described in “GPIO Control”. This logic signal is set low when a
    Headphone Detect measurement is triggered, and is set high when the Headphone Detect function
    has completed. A rising edge indicates completion of a Headphone Detect measurement.
    The headphone detection circuit is also an input to the Interrupt control circuit. An interrupt event is
    triggered whenever a headphone detection measurement has completed. Note that the HPDET_EINT
    flag is also asserted when the headphone detection is initiated. The associated interrupt bit is latched
    once set; it can be polled at any time or used to control the IRQ signal. See “Interrupts” for more
    details of the Interrupt event handling.
    MICROPHONE / ACCESSORY DETECTION STATUS OUTPUT
    GPn_FN = 13h.
    The WM8998 provides an impedance measurement circuit on the MICDETn pins to detect the
    connection of a microphone or other external accessory. See “External Accessory Detection” for
    further details.
    A logic signal from the microphone detect circuit may be output directly on a GPIO pin by setting the
    respective GPIO registers as described in “GPIO Control”. This logic signal is set high for a pulse
    duration of 31s whenever an accessory insertion, removal or impedance change is detected.
    The microphone detection circuit is also an input to the Interrupt control circuit. An interrupt event is
    triggered whenever an accessory insertion, removal or impedance change is detected. The
    associated interrupt bit is latched once set; it can be polled at any time or used to control the IRQ
    signal. See “Interrupts” for more details of the Interrupt event handling.
190                                                                                                Rev 4.1


                                                                                            WM8998
        OUTPUT SIGNAL PATH ENABLE/DISABLE STATUS OUTPUT
        GPn_FN = 2Fh, 30h, 31h, 32h, 33h, 34h, 35h, 36h, 37h, 38h, 45h, 46h, 47h, 48h.
        Whenever the OUT1, OUT2, OUT3 or OUT4 signal path is enabled or disabled, a pop-suppression
        control sequence is triggered. Status outputs indicating the progress of these sequences are
        provided. See “Output Signal Path” for details of the Output Enable functions.
        A logic signal from the Output Signal Path control functions may be output directly on a GPIO pin by
        setting the respective GPIO registers as described in “GPIO Control”. This logic signal is set high for a
        short pulse duration (approx. 100ns) whenever the respective Enable/Disable control sequence has
        completed. The Output Signal Path control sequence status outputs are described in Table 80.
        The Output Signal Path control sequences also provide inputs to the Interrupt control circuit. An
        interrupt event is triggered on completion of the respective control sequence. The associated interrupt
        bits are latched once set; they can be polled at any time or used to control the IRQ signal. See
        “Interrupts” for more details of the Interrupt event handling.
            GPN_FN                   DESCRIPTION                                     COMMENTS
             2Fh         HPOUTL Enable Status                       A short pulse is output when the respective
             30h         HPOUTR Enable Status                       Enable/Disable control sequence has
                                                                    completed.
             31h         LINEOUTL Enable Status
             32h         LINEOUR Enable Status
             33h         EPOUT Enable Status
             34h         HPOUTL Disable Status
             35h         HPOUTR Disable Status
             36h         LINEOUTL Disable Status
             37h         LINEOUR Disable Status
             38h         EPOUT Disable Status
             45h         SPKOUTL Enable Status
             46h         SPKOUTR Enable Status
             47h         SPKOUTL Disable Status
             48h         SPKOUTR Disable Status
        Table 80 Output Signal Path Enable/Disable Status Indications
        BOOT DONE STATUS OUTPUT
        GPn_FN = 44h.
        The WM8998 executes a user-configurable Boot Sequence following Power-On Reset (POR),
        Hardware Reset, Software Reset or Wake-Up (from Sleep mode). Control register writes should not
        be attempted while the Boot Sequence is running.
        For details of the Boot Sequence, see “Control Write Sequencer”.
        The BOOT_DONE_STS register bit (see Table 115) indicates the status of the Boot Sequence.
        (When BOOT_DONE_STS=1, then the Boot Sequence is complete.)
        A logic signal from the Boot Sequence function may be output directly on a GPIO pin by setting the
        respective GPIO registers as described in “GPIO Control”. This logic signal is set high for a short
        pulse duration (approx. 100ns) when the Boot Sequence has completed. To output this signal, the
        Boot Sequence must be programmed to configure a GPIO pin for this function. Note that, under
        default register conditions, completion of the Boot Sequence is indicated via the Interrupt circuit.
        The BOOT_DONE_STS signal is also an input to the Interrupt Controller circuit. An interrupt event is
        triggered on the rising edge of this signal. The associated interrupt bit is latched once set; it can be
        polled at any time or used to control the IRQ signal. See “Interrupts” for more details of the Interrupt
        event handling.
Rev 4.1                                                                                                      191


                                                                                     WM8998
    ASYNCHRONOUS SAMPLE RATE CONVERTER (ASRC) LOCK STATUS OUTPUT
    GPn_FN = 1Ah, 1Bh.
    The WM8998 maintains a flag indicating the lock status of the Asynchronous Sample Rate Converters
    (ASRCs), which may be used to control other events if required. See “Digital Core” for more details of
    the ASRCs.
    The ASRC Lock signals may be output directly on a GPIO pin by setting the respective GPIO
    registers as described in “GPIO Control”.
    The ASRC Lock signals are inputs to the Interrupt control circuit. An interrupt event is triggered on the
    rising and falling edges of the ASRC Lock signals. The associated interrupt bits are latched once set;
    they can be polled at any time or used to control the IRQ signal. See “Interrupts” for more details of
    the Interrupt event handling.
    ASYNCHRONOUS SAMPLE RATE CONVERTER (ASRC) CONFIGURATION ERROR
    STATUS OUTPUT
    GPn_FN = 1Ch.
    The WM8998 performs automatic checks to confirm that the ASRCs are configured with valid settings.
    Invalid settings include conditions where one of the associated sample rates is higher than 48kHz. If
    an invalid ASRC configuration is detected, this can be indicated using the GPIO and/or Interrupt
    functions.
    The ASRC Configuration Error signal may be output directly on a GPIO pin by setting the respective
    GPIO registers as described in “GPIO Control”.
    The ASRC Configuration Error signal is an input to the Interrupt Controller circuit. An interrupt event is
    triggered on the rising edge of the ASRC Configuration Error signal. The associated interrupt bit is
    latched once set; it can be polled at any time or used to control the IRQ signal. See “Interrupts” for
    more details of the Interrupt event handling.
    ISOCHRONOUS SAMPLE RATE CONVERTER (ISRC) CONFIGURATION ERROR
    STATUS OUTPUT
    GPn_FN = 4Dh, 4Eh.
    The WM8998 performs automatic checks to confirm that the ISRCs are configured with valid settings.
    Invalid settings include conditions where an invalid combination of sample rates is configured. If an
    invalid ISRC configuration is detected, this can be indicated using the GPIO and/or Interrupt functions.
    The ISRC Configuration Error signal may be output directly on a GPIO pin by setting the respective
    GPIO registers as described in “GPIO Control”.
    The ISRC Configuration Error signals are inputs to the Interrupt Controller circuit. An interrupt event is
    triggered on the rising edge of the ISRC Configuration Error signals. The associated interrupt bits are
    latched once set; they can be polled at any time or used to control the IRQ signal. See “Interrupts” for
    more details of the Interrupt event handling.
192                                                                                                 Rev 4.1


                                                                                            WM8998
        OVER-TEMPERATURE, SHORT CIRCUIT PROTECTION, AND SPEAKER SHUTDOWN
        STATUS OUTPUT
        GPn_FN = 2Bh, 2Ch, 5Fh, 60h, 61h.
        The WM8998 incorporates a temperature sensor which detects when the device temperature is within
        normal limits or if the device is approaching a hazardous temperature condition.
        The temperature status may be output directly on a GPIO pin by setting the respective GPIO registers
        as described in “GPIO Control”. A GPIO pin can be used to indicate either an Overheat Warning
        Temperature event or an Overheat Shutdown Temperature event.
        The WM8998 provides short circuit protection on the Class D speaker output paths.
        The status of each of the short circuit detection circuits may be output directly on a GPIO pin by
        setting the respective GPIO registers as described in “GPIO Control”.
        If the Overheat Shutdown Temperature is exceeded, or if a short circuit is detected on the Class D
        speaker outputs, then the Class D speaker outputs will automatically be disabled in order to protect
        the device. When the speaker driver shutdown is complete, the Speaker Shutdown signal will be
        asserted. The speaker driver shutdown status can also be output directly on a GPIO pin.
        The Overtemperature, Short Circuit protection, and Speaker Shutdown status flags are inputs to the
        Interrupt control circuit. An interrupt event may be triggered on the applicable edges of these signals.
        The associated interrupt bit is latched once set; it can be polled at any time or used to control the IRQ
        signal. See “Interrupts” for more details of the Interrupt event handling.
        DYNAMIC RANGE CONTROL (DRC) STATUS OUTPUT
        GPn_FN = 1Dh, 1Eh, 1Fh, 20h, 21h.
        The Dynamic Range Control (DRC) circuits provide status outputs, which may be used to control
        other events if required.
        The DRC status flags may be output directly on a GPIO pin by setting the respective GPIO registers
        as described in “GPIO Control”. The DRC status outputs are described in Table 81.
        See “Digital Core” for more details of the DRC.
            GPN_FN             DESCRIPTION                                     COMMENTS
             1Dh        DRC1 Signal Detect             Indicates a signal is present on the respective DRC
                                                       path. The threshold level is configurable (see Table 13).
             1Eh        DRC1 Anti-Clip Active          Indicates the DRC anti-clip function has been triggered;
                                                       the DRC gain is decreasing in response to a rising
                                                       signal level.
             1Fh        DRC1 Decay Active              Indicates that the DRC gain is increasing in response to
                                                       a low-level signal input.
             20h        DRC1 Noise Gate Active         Indicates that the DRC noise gate has been triggered;
                                                       an idle signal condition has been detected.
             21h        DRC1 Quick Release             Indicates that the DRC quick-release function has been
                        Active                         triggered; the DRC gain is increasing rapidly following
                                                       detection of a short transient peak.
        Table 81 Dynamic Range Control (DRC) Status Indications
Rev 4.1                                                                                                       193


                                                                                      WM8998
    CONTROL WRITE SEQUENCER STATUS OUTPUT
    GPn_FN = 15h.
    The WM8998 Control Write Sequencer (WSEQ) can be used to execute a sequence of register write
    operations in response to a simple trigger event. See “Control Write Sequencer” for details of the
    Control Write Sequencer.
    The WSEQ_BUSY register bit (see Table 109) indicates the status of the Control Write Sequencer.
    When WSEQ_BUSY=1, this indicates that one or more Write Sequence operations are in progress or
    are queued for sequential execution.
    A logic signal from the Write Sequencer function may be output directly on a GPIO pin by setting the
    respective GPIO registers as described in “GPIO Control”. This logic signal is set high for a short
    pulse duration (approx. 100ns) whenever the Write Sequencer has completed all scheduled
    sequences, and there are no more pending operations.
    The Write Sequencer status is an input to the Interrupt control circuit. An interrupt event is triggered
    on completion of a Control Sequence. The associated interrupt bit is latched once set; it can be polled
    at any time or used to control the IRQ signal. See “Interrupts” for more details of the Interrupt event
    handling.
    CONTROL INTERFACE ERROR STATUS OUTPUT
    GPn_FN = 16h.
    The WM8998 is controlled by writing to registers through a 2-wire (I2C) serial control interface, as
    described in the “Control Interface” section. The SLIMbus interface also supports read/write access to
    the control registers, as described in the “SLIMbus Interface Control” section.
    The WM8998 performs automatic checks to confirm if a register access is successful. Register access
    will be unsuccessful if an invalid register address is selected. If an invalid or unsuccessful register
    operation is attempted, this can be indicated using the GPIO and/or Interrupt functions.
    The Control Interface Error signal may be output directly on a GPIO pin by setting the respective
    GPIO registers as described in “GPIO Control”.
    The Control Interface Error signal is an input to the Interrupt Controller circuit. An interrupt event is
    triggered on the rising edge of the Control Interface Error signal. The associated interrupt bit is latched
    once set; it can be polled at any time or used to control the IRQ signal. See “Interrupts” for more
    details of the Interrupt event handling.
    SYSTEM CLOCKS ENABLE STATUS OUTPUT
    GPn_FN = 4Bh, 4Ch.
    The WM8998 requires a system clock (SYSCLK) for its internal functions and to support the
    input/output signal paths. The WM8998 can support two independent clock domains, with selected
    functions referenced to the ASYNCCLK clock domain. See “Clocking and Sample Rates” for details of
    these clocks.
    The SYSCLK_ENA and ASYNC_CLK_ENA registers (see Table 90) control the SYSCLK and
    ASYNCCLK signals respectively. When ‘0’ is written to these registers, the host processor must wait
    until the WM8998 has shut down the associated functions before issuing any other register write
    commands.
    The SYSCLK Enable and ASYNCCLK Enable status may be output directly on a GPIO pin by setting
    the respective GPIO registers as described in “GPIO Control”.
    The SYSCLK Enable and ASYNCCLK Enable signals are inputs to the Interrupt Controller circuit. An
    interrupt event is triggered when the respective clock functions have been shut down. The associated
    interrupt bit is latched once set; it can be polled at any time or used to control the IRQ signal. See
    “Interrupts” for more details of the Interrupt event handling.
194                                                                                                  Rev 4.1


                                                                                           WM8998
        CLOCKING ERROR STATUS OUTPUT
        GPn_FN = 0Ah, 0Bh, 27h, 2Dh, 2Eh.
        The WM8998 performs automatic checks to confirm that the system clocks are correctly configured
        according to the commanded functionality. An invalid configuration is one where there are insufficient
        clock cycles to support the digital processing required by the commanded signal paths.
        An Underclocked Error condition is where there are insufficient clock cycles for the requested
        functionality, and increasing the SYSCLK or ASYNCCLK frequency (as applicable) should allow the
        selected configuration to be supported.
        An Overclocked Error condition is where the requested functionality cannot be supported, as the
        clocking requirements of the requested configuration exceed the device limits.
        The system clocks (SYSCLK and, where applicable, ASYNCCLK) must be enabled before any signal
        path is enabled. If an attempt is made to enable a signal path, and there are insufficient clock cycles
        to support that path, then the attempt will be unsuccessful. Note that any signal paths that are already
        active will not be affected under these circumstances.
        The Clocking Error signals may be output directly on a GPIO pin by setting the respective GPIO
        registers as described in “GPIO Control”. The Clocking Error conditions are described in Table 82.
        The Clocking Error signals are inputs to the Interrupt Controller circuit. An interrupt event is triggered
        on the rising and falling edges of the Clocking Error signals. The associated interrupt bits are latched
        once set; they can be polled at any time or used to control the IRQ signal. See “Interrupts” for more
        details of the Interrupt event handling.
           GPN_FN              DESCRIPTION                                    COMMENTS
             0Ah         SYSCLK Underclocked          Indicates insufficient SYSCLK cycles for the
                                                      commanded functionality.
             0Bh         ASYNCCLK                     Indicates insufficient ASYNCCLK cycles for the
                         Underclocked                 commanded functionality.
             27h         Mixer Dropped Sample         Indicates a dropped sample in the digital core mixer
                         Error                        function.
             2Dh         Underclocked Error           Indicates insufficient SYSCLK or ASYNCCLK cycles for
                                                      one or more of the selected signal paths or signal
                                                      processing functions. Increasing the SYSCLK or
                                                      ASYNCCLK frequency (as applicable) should allow the
                                                      selected configuration to be supported.
                                                      Status bits associated with specific sub-systems provide
                                                      further de-bug capability.
                                                      The INnx_ENA_STS bits in register R769 indicate the
                                                      status of each of the input (analogue or digital
                                                      microphone) signal paths.
                                                      The OUTnx_ENA_STS bits in registers R1025 and
                                                      R1030 indicate the status of each of the output
                                                      (Headphone, Earpiece, Speaker or PDM) signal paths.
                                                      The ASRCnx_ENA_STS bits in register R3809 indicate
                                                      the status of each of the ASRC signal paths.
                                                      The FX_STS field in register R3585 indicates the status
                                                      of each of the Effects (EQ, DRC or LHPF) signal paths.
                                                      The *MIX_STSn fields in registers R1600 to R3000
                                                      indicate the status of each of the Digital Core mixer
                                                      signal paths.
                                                      The ISRCn and AIFn functions are also inputs to the
                                                      Underclocked Error status indication, but there are no
                                                      specific _STS register bits associated with these.
             2Eh         Overclocked Error            Indicates that an unsupported device configuration has
                                                      been attempted, as the clocking requirements of the
                                                      requested configuration exceed the device limits.
        Table 82 Clocking Error Status Indications
Rev 4.1                                                                                                       195


                                                                                      WM8998
    GENERAL PURPOSE SWITCH
    The WM8998 provides a General Purpose Switch, which can be used as a controllable analogue
    switch for external functions. The switch is implemented between the GPSWP and GPSWN pins.
    Note that this feature is entirely independent to the GPIOn pins.
    The General Purpose Switch is configured using SW1_MODE. This register allows the switch to be
    disabled, enabled, or synchronised to the MICDET Clamp status, as described in Table 83.
    The switch is a bi-directional analogue switch, offering flexibility in the potential circuit applications.
    Refer to the “Absolute Maximum Ratings” and “Electrical Characteristics” for further details.
    The switch can be used in conjunction with the MICDET Clamp function, in order suppress pops and
    clicks associated with jack insertion and removal. An example circuit is shown in Figure 59, within the
    “External Accessory Detection” section. Note that the MICDET Clamp function must also be
    configured appropriately when using this method of pop suppression control.
         REGISTER        BIT            LABEL          DEFAULT                   DESCRIPTION
         ADDRESS
       R3096            1:0     SW1_MODE [1:0]            00       General Purpose Switch control
       (0C18h)                                                     00 = Disabled (open)
       GP Switch 1                                                 01 = Enabled (closed)
                                                                   10 = Enabled when MICDET Clamp is
                                                                   active
                                                                   11 = Enabled when MICDET Clamp is
                                                                   not active
    Table 83 General Purpose Switch control
196                                                                                                 Rev 4.1


                                                                                              WM8998
INTERRUPTS
           The Interrupt Controller has multiple inputs. These include the Jack Detect and GPIO input pins,
           headphone / accessory detection, FLL / ASRC Lock detection, and Clocking configuration error
           indications. (See Table 84, Table 85 and Table 86 for a full definition of the Interrupt Controller
           inputs.) Any combination of these inputs can be used to trigger an Interrupt Request (IRQ) event.
           The Interrupt Controller supports two sets of interrupt registers. This allows two separate Interrupt
           Request (IRQ) outputs to be generated, and for each IRQ to report a different set of input or status
           conditions.
           For each Interrupt Request (IRQ1 and IRQ2) output, there is an Interrupt register field associated with
           each of the interrupt inputs. These fields are asserted whenever a logic edge is detected on the
           respective input. Some inputs are triggered on rising edges only; some are triggered on both edges.
           Separate rising and falling interrupt registers are provided for the JD1 and GP5 signals. The Interrupt
           register fields for IRQ1 are described in Table 84. The Interrupt register fields for IRQ2 are described
           in Table 85. The Interrupt flags can be polled at any time, or else in response to the Interrupt Request
           (IRQ) output being signalled via the IRQ
                                                  ¯¯¯ pin or a GPIO pin.
           All of the Interrupts are edge-triggered, as noted above. Many of these are triggered on both the rising
           and falling edges and, therefore, the Interrupt registers cannot indicate which edge has been
           detected. The “Raw Status” fields described in Table 86 provide readback of the current value of the
           corresponding inputs to the Interrupt Controller. Note that the status of any GPIO inputs can be read
           using the GPn_LVL registers, as described in Table 75.
           The UNDERCLOCKED_STS and OVERCLOCKED_STS registers represent the logical ‘OR’ of status
           flags from multiple sub-systems. The status bits in registers R3364 to R3366 (see Table 86) provide
           readback of these lower-level signals. See “Clocking and Sample Rates” for a description of the
           Underclocked and Overclocked Error conditions.
           Individual mask bits can enable or disable different functions from the Interrupt controller. The mask
           bits are described in Table 84 (for IRQ1) and Table 85 (for IRQ2). Note that a masked interrupt input
           will not assert the corresponding interrupt register field, and will not cause the associated Interrupt
           Request (IRQ) output to be asserted.
           The Interrupt Request (IRQ) outputs represent the logical ‘OR’ of the associated interrupt registers.
           (IRQ1 is derived from the _EINT1 registers; IRQ2 is derived from the _EINT2 registers). The Interrupt
           register fields are latching fields and, once they are set, they are not reset until a ‘1’ is written to the
           respective register bit(s). The Interrupt Request (IRQ) outputs are not reset until each of the
           associated interrupts has been reset.
           A de-bounce circuit can be enabled on any GPIO input, to avoid false event triggers. This is enabled
           on each pin using the register bits described in Table 75. The GPIO de-bounce circuit uses the 32kHz
           clock, which must be enabled whenever the GPIO de-bounce function is required.
           A de-bounce circuit is always enabled on the FLL status inputs; either the 32kHz clock, or the
           SYSCLK signal, must be enabled to trigger an Interrupt from the FLL status inputs. Note that the “Raw
           Status” fields (described in Table 86), are valid without clocking, and can be used to provide FLL
           status readback when system clocks are not available.
           The IRQ outputs can be globally masked using the IM_IRQ1 and IM_IRQ2 register bits. When not
           masked, the IRQ status can be read from IRQ1_STS and IRQ2_STS for the respective IRQ outputs.
           The IRQ1 output is provided externally on the IRQ  ¯¯¯ pin. Under default conditions, this output is ‘Active
           Low’. The polarity can be inverted using the IRQ_POL register. The IRQ    ¯¯¯ output can be either CMOS
           driven or Open Drain; this is selected using the IRQ_OP_CFG register. Note that the IRQ       ¯¯¯ output is
           referenced to the DBVDD1 power domain.
           The IRQ1 and IRQ2 signals may be output on a GPIO pin - see “General Purpose Input / Output”.
           The WM8998 Interrupt Controller circuit is illustrated in Figure 63. (Note that not all interrupt inputs are
           shown.) The associated control fields are described in Table 84, Table 85 and Table 86.
           Note that, under default register conditions, the ‘Boot Done’ status is the only un-masked interrupt
           source; a falling edge on the IRQ
                                           ¯¯¯ pin will indicate completion of the Boot Sequence.
Rev 4.1                                                                                                           197


                                                                                                                                                WM8998
            xxx_STS                                                                        xxx_EINT1
                                                                IM_xxx_EINT1
                      De-bouncing & Edge detection
            xxx_STS                                                                        xxx_EINT1
                                                                IM_xxx_EINT1
            GP1_LVL                                                                        GP1_EINT1
                                                               IM_GP1_EINT1
                                                                                                                                                                IRQ1_STS
      FLL1_LOCK_STS                                                                        FLL1_LOCK_EINT1                                   IM_IRQ1
                                                         IM_FLL1_LOCK_EINT1
  DRC1_SIG_DET_STS                                                                         DRC1_SIG_DET_EINT1
                                                      IM_DRC1_SIG_DET_EINT1
 UNDERCLOCKED_STS                                                                          UNDERCLOCKED_EINT1
                                                     IM_UNDERCLOCKED_EINT1
                                                                                           xxx_EINT2
                                                                IM_xxx_EINT2
                                                                                           xxx_EINT2
                                                                IM_xxx_EINT2
                                                                                           GP1_EINT2
                                                               IM_GP1_EINT2
                                                                                                                                                                IRQ2_STS
                                                                                           FLL1_LOCK_EINT2                                   IM_IRQ2
                                                         IM_FLL1_LOCK_EINT2
                                                                                           DRC1_SIG_DET_EINT2
                                                      IM_DRC1_SIG_DET_EINT2
                                                                                           UNDERCLOCKED_EINT2
                                                     IM_UNDERCLOCKED_EINT2
                                                                                                                       Note: not all available interrupt sources are shown
Figure 63 Interrupt Controller
                                                        REGISTER               BIT       LABEL               DEFAULT                   DESCRIPTION
                                                        ADDRESS
                                                       R3087                   10    IRQ_POL                    1      IRQ Output Polarity Select
                                                       (0C0Fh)                                                         0 = Non-inverted (Active High)
                                                       IRQ CTRL                                                        1 = Inverted (Active Low)
                                                       1                       9     IRQ_OP_CFG                 0      IRQ Output Configuration
                                                                                                                       0 = CMOS
                                                                                                                       1 = Open Drain
                                                       R3328                   3     GP4_EINT1                  0      GPIO4 Interrupt
                                                       (0D00h)                                                         (Rising and falling edge triggered)
                                                       Interrupt                                                       Note: Cleared when a ‘1’ is written.
                                                       Status 1                2     GP3_EINT1                  0      GPIO3 Interrupt
                                                                                                                       (Rising and falling edge triggered)
                                                                                                                       Note: Cleared when a ‘1’ is written.
                                                                               1     GP2_EINT1                  0      GPIO2 Interrupt
                                                                                                                       (Rising and falling edge triggered)
                                                                                                                       Note: Cleared when a ‘1’ is written.
                                                                               0     GP1_EINT1                  0      GPIO1 Interrupt
                                                                                                                       (Rising and falling edge triggered)
                                                                                                                       Note: Cleared when a ‘1’ is written.
                                                       R3329                   15    SPKR_DISABLE               0      SPKOUTR Disable Interrupt
                                                       (0D01h)                       _DONE_EINT1                       (Rising edge triggered)
                                                       Interrupt                                                       Note: Cleared when a ‘1’ is written.
198                                                                                                                                                              Rev 4.1


                                                                 WM8998
         REGISTER BIT      LABEL    DEFAULT                DESCRIPTION
          ADDRESS
        Status 2  14  SPKL_DISABLE_   0     SPKOUTL Disable Interrupt
                      DONE_EINT1            (Rising edge triggered)
                                            Note: Cleared when a ‘1’ is written.
                  13  SPKR_ENABLE_    0     SPKOUTR Enable Interrupt
                      DONE_EINT1            (Rising edge triggered)
                                            Note: Cleared when a ‘1’ is written.
                  12  SPKL_ENABLE_    0     SPKOUTL Enable Interrupt
                      DONE_EINT1            (Rising edge triggered)
                                            Note: Cleared when a ‘1’ is written.
        R3330     15  SPK_OVERHEA     0     Speaker Overheat Warning Interrupt
        (0D02h)       T_WARN_EINT1          (Rising and falling edge triggered)
        Interrupt                           Note: Cleared when a ‘1’ is written.
        Status 3  14  SPK_OVERHEA     0     Speaker Overheat Interrupt
                      T_EINT1               (Rising and falling edge triggered)
                                            Note: Cleared when a ‘1’ is written.
                  13  HPDET_EINT1     0     Headphone Detect Interrupt
                                            (Rising edge triggered)
                                            Note: Cleared when a ‘1’ is written.
                  12  MICDET_EINT1    0     Microphone / Accessory Detect Interrupt
                                            (Detection event triggered)
                                            Note: Cleared when a ‘1’ is written.
                  11  WSEQ_DONE_EI    0     Write Sequencer Done Interrupt
                      NT1                   (Rising edge triggered)
                                            Note: Cleared when a ‘1’ is written.
                   9  DRC1_SIG_DET    0     DRC1 Signal Detect Interrupt
                      _EINT1                (Rising and falling edge triggered)
                                            Note: Cleared when a ‘1’ is written.
                   8  ASRC2_LOCK_E    0     ASRC2 Lock Interrupt
                      INT1                  (Rising and falling edge triggered)
                                            Note: Cleared when a ‘1’ is written.
                   7  ASRC1_LOCK_E    0     ASRC1 Lock Interrupt
                      INT1                  (Rising and falling edge triggered)
                                            Note: Cleared when a ‘1’ is written.
                   6  UNDERCLOCKE     0     Underclocked Error Interrupt
                      D_EINT1               (Rising edge triggered)
                                            Note: Cleared when a ‘1’ is written.
                   5  OVERCLOCKED     0     Overclocked Error Interrupt
                      _EINT1                (Rising edge triggered)
                                            Note: Cleared when a ‘1’ is written.
                   3  FLL2_LOCK_EIN   0     FLL2 Lock Interrupt
                      T1                    (Rising and falling edge triggered)
                                            Note: Cleared when a ‘1’ is written.
                   2  FLL1_LOCK_EIN   0     FLL1 Lock Interrupt
                      T1                    (Rising and falling edge triggered)
                                            Note: Cleared when a ‘1’ is written.
                   1  CLKGEN_ERR_E    0     SYSCLK Underclocked Error Interrupt
                      INT1                  (Rising edge triggered)
                                            Note: Cleared when a ‘1’ is written.
                   0  CLKGEN_ERR_A    0     ASYNCCLK Underclocked Error Interrupt
                      SYNC_EINT1            (Rising edge triggered)
                                            Note: Cleared when a ‘1’ is written.
        R3331     12  CTRLIF_ERR_EI   0     Control Interface Error Interrupt
        (0D03h)       NT1                   (Rising edge triggered)
        Interrupt                           Note: Cleared when a ‘1’ is written.
Rev 4.1                                                                          199


                                                             WM8998
     REGISTER BIT      LABEL    DEFAULT               DESCRIPTION
      ADDRESS
    Status 4  11  MIXER_DROPPE          Mixer Dropped Sample Interrupt
                  D_SAMPLE_EIN          (Rising edge triggered)
                  T1                    Note: Cleared when a ‘1’ is written.
              10  ASYNC_CLK_EN    0     ASYNC_CLK_ENA Interrupt
                  A_LOW_EINT1           (Triggered on ASYNCCLK shut-down)
                                        Note: Cleared when a ‘1’ is written.
               9  SYSCLK_ENA_L    0     SYSCLK_ENA Interrupt
                  OW_EINT1              (Triggered on SYSCLK shut-down)
                                        Note: Cleared when a ‘1’ is written.
               8  ISRC1_CFG_ER    0     ISRC1 Configuration Error Interrupt
                  R_EINT1               (Rising edge triggered)
                                        Note: Cleared when a ‘1’ is written.
               7  ISRC2_CFG_ER    0     ISRC2 Configuration Error Interrupt
                  R_EINT1               (Rising edge triggered)
                                        Note: Cleared when a ‘1’ is written.
               3  LINER_ENABLE_   0     LINEOUTR Enable Interrupt
                  DONE_EINT1            (Rising edge triggered)
                                        Note: Cleared when a ‘1’ is written.
               2  LINEL_ENABLE_   0     LINEOUTL Enable Interrupt
                  DONE_EINT1            (Rising edge triggered)
                                        Note: Cleared when a ‘1’ is written.
               1  HPR_ENABLE_D    0     HPOUTR Enable Interrupt
                  ONE_EINT1             (Rising edge triggered)
                                        Note: Cleared when a ‘1’ is written.
               0  HPL_ENABLE_D    0     HPOUTL Enable Interrupt
                  ONE_EINT1             (Rising edge triggered)
                                        Note: Cleared when a ‘1’ is written.
    R3332     14  EP_ENABLE_DO    0     EPOUT Enable Interrupt
    (0D04h)       NE_EINT1              (Rising edge triggered)
    Interrupt                           Note: Cleared when a ‘1’ is written.
    Status 5  13  EP_DISABLE_D    0     EPOUT Disable Interrupt
                  ONE_EINT1             (Rising edge triggered)
                                        Note: Cleared when a ‘1’ is written.
              12  LINER_DISABLE   0     LINEOUTR Disable Interrupt
                  _DONE_EINT1           (Rising edge triggered)
                                        Note: Cleared when a ‘1’ is written.
              11  LINEL_DISABLE   0     LINEOUTL Disable Interrupt
                  _DONE_EINT1           (Rising edge triggered)
                                        Note: Cleared when a ‘1’ is written.
              10  HPR_DISABLE_    0     HPOUTR Disable Interrupt
                  DONE_EINT1            (Rising edge triggered)
                                        Note: Cleared when a ‘1’ is written.
               9  HPL_DISABLE_D   0     HPOUTL Disable Interrupt
                  ONE_EINT1             (Rising edge triggered)
                                        Note: Cleared when a ‘1’ is written.
               8  BOOT_DONE_EI    0     Boot Done Interrupt
                  NT1                   (Rising edge triggered)
                                        Note: Cleared when a ‘1’ is written.
               3  ASRC_CFG_ER     0     ASRC Configuration Error Interrupt
                  R_EINT1               (Rising edge triggered)
                                        Note: Cleared when a ‘1’ is written.
               1  FLL2_CLOCK_O    0     FLL2 Clock OK Interrupt
                  K_EINT1               (Rising and falling edge triggered)
                                        Note: Cleared when a ‘1’ is written.
200                                                                       Rev 4.1


                                                                                        WM8998
          REGISTER       BIT          LABEL           DEFAULT                     DESCRIPTION
           ADDRESS
                          0    FLL1_CLOCK_O               0       FLL1 Clock OK Interrupt
                               K_EINT1                            (Rising and falling edge triggered)
                                                                  Note: Cleared when a ‘1’ is written.
         R3333           14    SPK_SHUTDOW                0       Speaker Shutdown Interrupt
         (0D05h)               N_EINT1                            (Rising edge triggered)
         Interrupt                                                Note: Cleared when a ‘1’ is written.
         Status 6        13    SPKR_SHORT_E               0       SPKOUTR Short Circuit Interrupt
                               INT1                               (Rising and falling edge triggered)
                                                                  Note: Cleared when a ‘1’ is written.
                         12    SPKL_SHORT_E               0       SPKOUTL Short Circuit Interrupt
                               INT1                               (Rising and falling edge triggered)
                                                                  Note: Cleared when a ‘1’ is written.
         R3336                 IM_*                  (see note)   For each *_EINT1 interrupt register in
         (0D08h)                                                  R3328 to R3333, a corresponding mask
         to                                                       bit (IM_*) is provided in R3336 to R3341.
         R3341                                                    The mask bits are coded as:
         (0D0Dh)                                                  0 = Do not mask interrupt
                                                                  1 = Mask interrupt
                               Note : The BOOT_DONE_EINT1 interrupt is ‘0’ (un-masked) by default; all
                               other interrupts are ‘1’ (masked) by default.
         R3343            0    IM_IRQ1                    0       IRQ1 Output Interrupt mask.
         (0D0Fh)                                                  0 = Do not mask interrupt.
         Interrupt                                                1 = Mask interrupt.
         Control
         R3409            7    MICD_CLAMP_F               0       MICDET Clamp Interrupt
         (0D51h)               ALL_EINT1                          (Falling edge triggered)
         AOD IRQ1                                                 Note: Cleared when a ‘1’ is written.
                          6    MICD_CLAMP_R               0       MICDET Clamp Interrupt
                               ISE_EINT1                          (Rising edge triggered)
                                                                  Note: Cleared when a ‘1’ is written.
                          5    GP5_FALL_EINT              0       GP5 Interrupt
                               1                                  (Falling edge triggered)
                                                                  Note: Cleared when a ‘1’ is written.
                          4    GP5_RISE_EINT              0       GP5 Interrupt
                               1                                  (Rising edge triggered)
                                                                  Note: Cleared when a ‘1’ is written.
                          3    JD1_FALL_EINT              0       JD1 Interrupt
                               1                                  (Falling edge triggered)
                                                                  Note: Cleared when a ‘1’ is written.
                          2    JD1_RISE_EINT              0       JD1 Interrupt
                               1                                  (Rising edge triggered)
                                                                  Note: Cleared when a ‘1’ is written.
         R3411                 IM_*                       1       For each *_EINT1 interrupt register in
         (0D53h)                                                  R3409, a corresponding mask bit (IM_*)
         AOD IRQ                                                  is provided in R3411.
         Mask IRQ1                                                The mask bits are coded as:
                                                                  0 = Do not mask interrupt
                                                                  1 = Mask interrupt
        Table 84 Interrupt 1 Control Registers
Rev 4.1                                                                                                  201


                                                             WM8998
     REGISTER BIT      LABEL    DEFAULT               DESCRIPTION
      ADDRESS
    R3344      3  GP4_EINT2       0     GPIO4 Interrupt
    (0D10h)                             (Rising and falling edge triggered)
    IRQ2                                Note: Cleared when a ‘1’ is written.
    Status 1   2  GP3_EINT2       0     GPIO3 Interrupt
                                        (Rising and falling edge triggered)
                                        Note: Cleared when a ‘1’ is written.
               1  GP2_EINT2       0     GPIO2 Interrupt
                                        (Rising and falling edge triggered)
                                        Note: Cleared when a ‘1’ is written.
               0  GP1_EINT2       0     GPIO1 Interrupt
                                        (Rising and falling edge triggered)
                                        Note: Cleared when a ‘1’ is written.
    R3345     15  SPKR_DISABLE    0     SPKOUTR Disable Interrupt
    (0D11h)       _DONE_EINT2           (Rising edge triggered)
    IRQ2                                Note: Cleared when a ‘1’ is written.
    Status 2  14  SPKL_DISABLE_   0     SPKOUTL Disable Interrupt
                  DONE_EINT2            (Rising edge triggered)
                                        Note: Cleared when a ‘1’ is written.
              13  SPKR_ENABLE_    0     SPKOUTR Enable Interrupt
                  DONE_EINT2            (Rising edge triggered)
                                        Note: Cleared when a ‘1’ is written.
              12  SPKL_ENABLE_    0     SPKOUTL Enable Interrupt
                  DONE_EINT2            (Rising edge triggered)
                                        Note: Cleared when a ‘1’ is written.
    R3346     15  SPK_OVERHEA     0     Speaker Overheat Warning Interrupt
    (0D12h)       T_WARN_EINT2          (Rising and falling edge triggered)
    IRQ2                                Note: Cleared when a ‘1’ is written.
    Status 3  14  SPK_OVERHEA     0     Speaker Overheat Interrupt
                  T_EINT2               (Rising and falling edge triggered)
                                        Note: Cleared when a ‘1’ is written.
              13  HPDET_EINT2     0     Headphone Detect Interrupt
                                        (Rising edge triggered)
                                        Note: Cleared when a ‘1’ is written.
              12  MICDET_EINT2    0     Microphone / Accessory Detect Interrupt
                                        (Detection event triggered)
                                        Note: Cleared when a ‘1’ is written.
              11  WSEQ_DONE_EI    0     Write Sequencer Done Interrupt
                  NT2                   (Rising edge triggered)
                                        Note: Cleared when a ‘1’ is written.
               9  DRC1_SIG_DET    0     DRC1 Signal Detect Interrupt
                  _EINT2                (Rising and falling edge triggered)
                                        Note: Cleared when a ‘1’ is written.
               8  ASRC2_LOCK_E    0     ASRC2 Lock Interrupt
                  INT2                  (Rising and falling edge triggered)
                                        Note: Cleared when a ‘1’ is written.
               7  ASRC1_LOCK_E    0     ASRC1 Lock Interrupt
                  INT2                  (Rising and falling edge triggered)
                                        Note: Cleared when a ‘1’ is written.
               6  UNDERCLOCKE     0     Underclocked Error Interrupt
                  D_EINT2               (Rising edge triggered)
                                        Note: Cleared when a ‘1’ is written.
               5  OVERCLOCKED     0     Overclocked Error Interrupt
                  _EINT2                (Rising edge triggered)
                                        Note: Cleared when a ‘1’ is written.
202                                                                       Rev 4.1


                                                                 WM8998
         REGISTER BIT      LABEL    DEFAULT                DESCRIPTION
          ADDRESS
                   3  FLL2_LOCK_EIN   0     FLL2 Lock Interrupt
                      T2                    (Rising and falling edge triggered)
                                            Note: Cleared when a ‘1’ is written.
                   2  FLL1_LOCK_EIN   0     FLL1 Lock Interrupt
                      T2                    (Rising and falling edge triggered)
                                            Note: Cleared when a ‘1’ is written.
                   1  CLKGEN_ERR_E    0     SYSCLK Underclocked Error Interrupt
                      INT2                  (Rising edge triggered)
                                            Note: Cleared when a ‘1’ is written.
                   0  CLKGEN_ERR_A    0     ASYNCCLK Underclocked Error Interrupt
                      SYNC_EINT2            (Rising edge triggered)
                                            Note: Cleared when a ‘1’ is written.
        R3347     12  CTRLIF_ERR_EI   0     Control Interface Error Interrupt
        (0D13h)       NT2                   (Rising edge triggered)
        IRQ2                                Note: Cleared when a ‘1’ is written.
        Status 4  11  MIXER_DROPPE          Mixer Dropped Sample Interrupt
                      D_SAMPLE_EIN          (Rising edge triggered)
                      T2                    Note: Cleared when a ‘1’ is written.
                  10  ASYNC_CLK_EN    0     ASYNC_CLK_ENA Interrupt
                      A_LOW_EINT2           (Triggered on ASYNCCLK shut-down)
                                            Note: Cleared when a ‘1’ is written.
                   9  SYSCLK_ENA_L    0     SYSCLK_ENA Interrupt
                      OW_EINT2              (Triggered on SYSCLK shut-down)
                                            Note: Cleared when a ‘1’ is written.
                   8  ISRC1_CFG_ER    0     ISRC1 Configuration Error Interrupt
                      R_EINT2               (Rising edge triggered)
                                            Note: Cleared when a ‘1’ is written.
                   7  ISRC2_CFG_ER    0     ISRC2 Configuration Error Interrupt
                      R_EINT2               (Rising edge triggered)
                                            Note: Cleared when a ‘1’ is written.
                   3  LINER_ENABLE_   0     LINEOUTR Enable Interrupt
                      DONE_EINT2            (Rising edge triggered)
                                            Note: Cleared when a ‘1’ is written.
                   2  LINEL_ENABLE_   0     LINEOUTL Enable Interrupt
                      DONE_EINT2            (Rising edge triggered)
                                            Note: Cleared when a ‘1’ is written.
                   1  HPR_ENABLE_D    0     HPOUTR Enable Interrupt
                      ONE_EINT2             (Rising edge triggered)
                                            Note: Cleared when a ‘1’ is written.
                   0  HPL_ENABLE_D    0     HPOUTL Enable Interrupt
                      ONE_EINT2             (Rising edge triggered)
                                            Note: Cleared when a ‘1’ is written.
        R3348     14  EP_ENABLE_DO    0     EPOUT Enable Interrupt
        (0D14h)       NE_EINT2              (Rising edge triggered)
        IRQ2                                Note: Cleared when a ‘1’ is written.
        Status 5  13  EP_DISABLE_D    0     EPOUT Disable Interrupt
                      ONE_EINT2             (Rising edge triggered)
                                            Note: Cleared when a ‘1’ is written.
                  12  LINER_DISABLE   0     LINEOUTR Disable Interrupt
                      _DONE_EINT2           (Rising edge triggered)
                                            Note: Cleared when a ‘1’ is written.
                  11  LINEL_DISABLE   0     LINEOUTL Disable Interrupt
                      _DONE_EINT2           (Rising edge triggered)
                                            Note: Cleared when a ‘1’ is written.
Rev 4.1                                                                          203


                                                                           WM8998
     REGISTER BIT        LABEL           DEFAULT                     DESCRIPTION
      ADDRESS
              10  HPR_DISABLE_               0       HPOUTR Disable Interrupt
                  DONE_EINT2                         (Rising edge triggered)
                                                     Note: Cleared when a ‘1’ is written.
               9  HPL_DISABLE_D              0       HPOUTL Disable Interrupt
                  ONE_EINT2                          (Rising edge triggered)
                                                     Note: Cleared when a ‘1’ is written.
               8  BOOT_DONE_EI               0       Boot Done Interrupt
                  NT2                                (Rising edge triggered)
                                                     Note: Cleared when a ‘1’ is written.
               3  ASRC_CFG_ER                0       ASRC Configuration Error Interrupt
                  R_EINT2                            (Rising edge triggered)
                                                     Note: Cleared when a ‘1’ is written.
               1  FLL2_CLOCK_O               0       FLL2 Clock OK Interrupt
                  K_EINT2                            (Rising and falling edge triggered)
                                                     Note: Cleared when a ‘1’ is written.
               0  FLL1_CLOCK_O               0       FLL1 Clock OK Interrupt
                  K_EINT2                            (Rising and falling edge triggered)
                                                     Note: Cleared when a ‘1’ is written.
    R3349     14  SPK_SHUTDOW                0       Speaker Shutdown Interrupt
    (0D15h)       N_EINT2                            (Rising edge triggered)
    IRQ2                                             Note: Cleared when a ‘1’ is written.
    Status 6  13  SPKR_SHORT_E               0       SPKOUTR Short Circuit Interrupt
                  INT2                               (Rising and falling edge triggered)
                                                     Note: Cleared when a ‘1’ is written.
              12  SPKL_SHORT_E               0       SPKOUTL Short Circuit Interrupt
                  INT2                               (Rising and falling edge triggered)
                                                     Note: Cleared when a ‘1’ is written.
    R3352         IM_*                  (see note)   For each *_EINT2 interrupt register in
    (0D18h)                                          R3344 to R3349, a corresponding mask
    to                                               bit (IM_*) is provided in R3352 to R3357.
    R3357                                            The mask bits are coded as:
    (0D1Dh)                                          0 = Do not mask interrupt
                                                     1 = Mask interrupt
                  Note : The BOOT_DONE_EINT2 interrupt is ‘0’ (un-masked) by default; all
                  other interrupts are ‘1’ (masked) by default.
    R3359      0  IM_IRQ2                    0       IRQ2 Output Interrupt mask.
    (0D1Fh)                                          0 = Do not mask interrupt.
    IRQ2                                             1 = Mask interrupt.
    Control
    R3410      7  MICD_CLAMP_F               0       MICDET Clamp Interrupt
    (0D52h)       ALL_EINT2                          (Falling edge triggered)
    AOD IRQ2                                         Note: Cleared when a ‘1’ is written.
               6  MICD_CLAMP_R               0       MICDET Clamp Interrupt
                  ISE_EINT2                          (Rising edge triggered)
                                                     Note: Cleared when a ‘1’ is written.
               5  GP5_FALL_EINT              0       GP5 Interrupt
                  2                                  (Falling edge triggered)
                                                     Note: Cleared when a ‘1’ is written.
               4  GP5_RISE_EINT              0       GP5 Interrupt
                  2                                  (Rising edge triggered)
                                                     Note: Cleared when a ‘1’ is written.
               3  JD1_FALL_EINT              0       JD1 Interrupt
                  2                                  (Falling edge triggered)
                                                     Note: Cleared when a ‘1’ is written.
204                                                                                    Rev 4.1


                                                                           WM8998
          REGISTER       BIT         LABEL     DEFAULT                DESCRIPTION
           ADDRESS
                          2    JD1_RISE_EINT     0     JD1 Interrupt
                               2                       (Rising edge triggered)
                                                       Note: Cleared when a ‘1’ is written.
         R3412                 IM_*              1     For each *_EINT2 interrupt register in
         (0D54h)                                       R3410, a corresponding mask bit (IM_*)
         AOD IRQ                                       is provided in R3412.
         Mask IRQ2                                     The mask bits are coded as:
                                                       0 = Do not mask interrupt
                                                       1 = Mask interrupt
        Table 85 Interrupt 2 Control Registers
          REGISTER       BIT         LABEL     DEFAULT                DESCRIPTION
           ADDRESS
         R3360           15    SPKR_DISABLE      0     SPKOUTR Disable Status
         (0D20h)               _DONE_STS               0 = Busy (sequence in progress)
         Interrupt                                     1 = Idle (sequence completed)
         Raw Status      14    SPKL_DISABLE_     0     SPKOUTL Disable Status
         1                     DONE_STS                0 = Busy (sequence in progress)
                                                       1 = Idle (sequence completed)
                         13    SPKR_ENABLE_      0     SPKOUTR Enable Status
                               DONE_STS                0 = Busy (sequence in progress)
                                                       1 = Idle (sequence completed)
                         12    SPKL_ENABLE_      0     SPKOUTL Enable Status
                               DONE_STS                0 = Busy (sequence in progress)
                                                       1 = Idle (sequence completed)
         R3361           15    SPK_OVERHEA       0     Speaker Overheat Warning Status
         (0D21h)               T_WARN_STS              0 = Normal
         Interrupt                                     1 = Warning temperature exceeded
         Raw Status      14    SPK_OVERHEA       0     Speaker Overheat Status
         2                     T_STS                   0 = Normal
                                                       1 = Shutdown temperature exceeded
                         11    WSEQ_DONE_S       0     Write Sequencer Status
                               TS                      0 = Busy (sequence in progress)
                                                       1 = Idle (sequence completed)
                          9    DRC1_SIG_DET      0     DRC1 Signal Detect Status
                               _STS                    0 = Normal
                                                       1 = Signal detected
                          8    ASRC2_LOCK_S      0     ASRC2 Lock Status
                               TS                      0 = Not locked
                                                       1 = Locked
                          7    ASRC1_LOCK_S      0     ASRC1 Lock Status
                               TS                      0 = Not locked
                                                       1 = Locked
                          6    UNDERCLOCKE       0     Underclocked Error Status
                               D_STS                   0 = Normal
                                                       1 = Underclocked Error
                          5    OVERCLOCKED       0     Overclocked Error Status
                               _STS                    0 = Normal
                                                       1 = Overclocked Error
                          3    FLL2_LOCK_ST      0     FLL2 Lock Status
                               S                       0 = Not locked
                                                       1 = Locked
                          2    FLL1_LOCK_ST      0     FLL1 Lock Status
                               S                       0 = Not locked
                                                       1 = Locked
Rev 4.1                                                                                       205


                                                              WM8998
     REGISTER  BIT      LABEL    DEFAULT                DESCRIPTION
      ADDRESS
                1  CLKGEN_ERR_S    0     SYSCLK Underclocked Error Status
                   TS                    0 = Normal
                                         1 = Underclocked Error
                0  CLKGEN_ERR_A    0     ASYNCCLK Underclocked Error Status
                   SYNC_STS              0 = Normal
                                         1 = Underclocked Error
    R3362      12  CTRLIF_ERR_ST   0     Control Interface Error Status
    (0D22h)        S                     0 = Normal
    Interrupt                            1 = Control Interface Error
    Raw Status 11  MIXER_DROPPE          Mixer Dropped Sample Status
    3              D_SAMPLE_STS          0 = Normal
                                         1 = Dropped Sample Error
               10  ASYNC_CLK_EN    0     ASYNC_CLK_ENA Status
                   A_LOW_STS             0 = ASYNC_CLK_ENA is enabled
                                         1 = ASYNC_CLK_ENA is disabled
                                         When a ‘0’ is written to
                                         ASYNCCLK_ENA, then no other control
                                         register writes should be attempted until
                                         ASYNC_CLK_ENA_LOW_STS=1.
                9  SYSCLK_ENA_L    0     SYSCLK_ENA Status
                   OW_STS                0 = SYSCLK_ENA is enabled
                                         1 = SYSCLK_ENA is disabled
                                         When a ‘0’ is written to SYSCLK_ENA,
                                         then no other control register writes
                                         should be attempted until
                                         SYSCLK_ENA_LOW_STS=1.
                8  ISRC1_CFG_ER    0     ISRC1 Configuration Error Interrupt
                   R_STS                 0 = Normal
                                         1 = Configuration Error
                7  ISRC2_CFG_ER    0     ISRC2 Configuration Error Interrupt
                   R_STS                 0 = Normal
                                         1 = Configuration Error
                3  LINER_ENABLE_   0     LINEOUTR Enable Status
                   DONE_STS              0 = Busy (sequence in progress)
                                         1 = Idle (sequence completed)
                2  LINER_ENABLE_   0     LINEOUTL Enable Status
                   DONE_STS              0 = Busy (sequence in progress)
                                         1 = Idle (sequence completed)
                1  HPR_ENABLE_D    0     HPOUTR Enable Status
                   ONE_STS               0 = Busy (sequence in progress)
                                         1 = Idle (sequence completed)
                0  HPL_ENABLE_D    0     HPOUTL Enable Status
                   ONE_STS               0 = Busy (sequence in progress)
                                         1 = Idle (sequence completed)
    R3363      14  EP_ENABLE_DO    0     EPOUT Enable Status
    (0D23h)        NE_STS                0 = Busy (sequence in progress)
    Interrupt                            1 = Idle (sequence completed)
    Raw Status 13  EP_DISABLE_D    0     EPOUT Disable Status
    4              ONE_STS               0 = Busy (sequence in progress)
                                         1 = Idle (sequence completed)
               12  LINER_DISABLE   0     LINEOUTR Disable Status
                   _DONE_STS             0 = Busy (sequence in progress)
                                         1 = Idle (sequence completed)
               11  LINER_DISABLE   0     LINEOUTL Disable Status
                   _DONE_STS             0 = Busy (sequence in progress)
                                         1 = Idle (sequence completed)
206                                                                         Rev 4.1


                                                                   WM8998
         REGISTER  BIT      LABEL    DEFAULT                DESCRIPTION
          ADDRESS
                   10  HPR_DISABLE_    0     HPOUTR Disable Status
                       DONE_STS              0 = Busy (sequence in progress)
                                             1 = Idle (sequence completed)
                    9  HPL_DISABLE_D   0     HPOUTL Disable Status
                       ONE_STS               0 = Busy (sequence in progress)
                                             1 = Idle (sequence completed)
                    8  BOOT_DONE_S     0     Boot Status
                       TS                    0 = Busy (boot sequence in progress)
                                             1 = Idle (boot sequence completed)
                                             Control register writes should not be
                                             attempted until Boot Sequence has
                                             completed.
                    3  ASRC_CFG_ER     0     ASRC Configuration Error Interrupt
                       R_STS                 0 = Normal
                                             1 = Configuration Error
                    1  FLL2_CLOCK_O    0     FLL2 Clock OK Interrupt
                       K_STS                 0 = FLL2 Clock is not OK
                                             1 = FLL2 Clock is OK
                    0  FLL1_CLOCK_O    0     FLL1 Clock OK Interrupt
                       K_STS                 0 = FLL1 Clock is not OK
                                             1 = FLL1 Clock is OK
        R3364      14  PWM_OVERCLO     0     Indicates an Overclocked Error condition
        (0D24h)        CKED_STS              for each respective sub-system.
        Interrupt  13  FX_CORE_OVE     0     The bits are coded as:
        Raw Status     RCLOCKED_ST           0 = Normal
        5              S                     1 = Overclocked
                   12  DAC_SYS_OVE     0     The OVERCLOCKED_STS bit will be
                       RCLOCKED_ST           asserted whenever any of these register
                       S                     bits is asserted.
                   11  DAC_WARP_OV     0
                       ERCLOCKED_S
                       TS
                   10  ADC_OVERCLO     0
                       CKED_STS
                    9  MIXER_OVERCL    0
                       OCKED_STS
                    7  AIF3_ASYNC_O    0
                       VERCLOCKED_
                       STS
                    6  AIF2_ASYNC_O    0
                       VERCLOCKED_
                       STS
                    5  AIF1_ASYNC_O    0
                       VERCLOCKED_
                       STS
                    3  AIF3_SYNC_OV    0
                       ERCLOCKED_S
                       TS
                    2  AIF2_SYNC_OV    0
                       ERCLOCKED_S
                       TS
                    1  AIF1_SYNC_OV    0
                       ERCLOCKED_S
                       TS
                    0  PAD_CTRL_OVE    0
                       RCLOCKED_ST
                       S
Rev 4.1                                                                            207


                                                              WM8998
     REGISTER  BIT      LABEL   DEFAULT                 DESCRIPTION
      ADDRESS
    R3365      15  SLIMBUS_SUBS   0     Indicates an Overclocked Error condition
    (0D25h)        YS_OVERCLOC          for each respective sub-system.
    Interrupt      KED_STS              The bits are coded as:
    Raw Status 14  SLIMBUS_ASYN   0     0 = Normal
    6              C_OVERCLOCK          1 = Overclocked
                   ED_STS               The OVERCLOCKED_STS bit will be
               13  SLIMBUS_SYNC   0     asserted whenever any of these register
                   _OVERCLOCKE          bits is asserted.
                   D_STS
               12  ASRC_ASYNC_S   0
                   YS_OVERCLOC
                   KED_STS
               11  ASRC_ASYNC_    0
                   WARP_OVERCL
                   OCKED_STS
               10  ASRC_SYNC_SY   0
                   S_OVERCLOCK
                   ED_STS
                9  ASRC_SYNC_W    0
                   ARP_OVERCLO
                   CKED_STS
                1  ISRC2_OVERCL   0
                   OCKED_STS
                0  ISRC1_OVERCL   0
                   OCKED_STS
    R3366      15  SPDIF_SYNC_O   0     Indicates an Underclocked or
    (0D26h)        VERCLOCKED_          Overclocked Error condition for each
    Interrupt      STS                  respective sub-system.
    Raw Status 10  AIF3_UNDERCL   0     The bits are coded as:
    7              OCKED_STS            0 = Normal
                9  AIF2_UNDERCL   0     1 = Overclocked
                   OCKED_STS            The UNDERCLOCKED_STS or
                8  AIF1_UNDERCL   0     OVERCLOCKED_STS bit (as applicable)
                   OCKED_STS            will be asserted whenever any of these
                                        register bits is asserted.
                6  ISRC2_UNDERC   0
                   LOCKED_STS
                5  ISRC1_UNDERC   0
                   LOCKED_STS
                4  FX_UNDERCLO    0
                   CKED_STS
                3  ASRC_UNDERC    0
                   LOCKED_STS
                2  DAC_UNDERCL    0
                   OCKED_STS
                1  ADC_UNDERCL    0
                   OCKED_STS
                0  MIXER_UNDERC   0
                   LOCKED_STS
    R3368      14  SPK_SHUTDOW    0     Speaker Shutdown Status
    (0D28h)        N_STS                0 = Normal
    Interrupt                           1 = Speaker Shutdown completed (due
    Raw Status                          to Overheat Temperature or Short Circuit
    8                                   condition)
               13  SPKOUTR_SHO    0     SPKOUTR Short Circuit Status
                   RT_STS               0 = Normal
                                        1 = Short Circuit detected
208                                                                      Rev 4.1


                                                                           WM8998
          REGISTER       BIT         LABEL   DEFAULT                DESCRIPTION
           ADDRESS
                         12     SPKOUTL_SHO    0     SPKOUTL Short Circuit Status
                                RT_STS               0 = Normal
                                                     1 = Short Circuit detected
         R3392            1     IRQ2_STS       0     IRQ2 Status
         (0D40h)                                     IRQ2_STS is the logical ‘OR’ of all
         Interrupt                                   unmasked _EINT2 interrupts.
         Pin Status                                  0 = Not asserted
                                                     1 = Asserted
                          0     IRQ1_STS       0     IRQ1 Status
                                                     IRQ1_STS is the logical ‘OR’ of all
                                                     unmasked _EINT1 interrupts.
                                                     0 = Not asserted
                                                     1 = Asserted
         R3413            3     MICD_CLAMP_S   0     MICDET Clamp status
         (0D55h)                TS                   0 = Clamp not active
         AOD IRQ                                     1 = Clamp active
         Raw Status       2     GP5_STS        0     GP5 Status
                                                     0 = Not asserted
                                                     1 = Asserted
                          0     JD1_STS        0     JACKDET input status
                                                     0 = Jack not detected
                                                     1 = Jack is detected
                                                     (Assumes the JACKDET pin is pulled
                                                     ‘low’ on Jack insertion.)
        Table 86 Interrupt Status
Rev 4.1                                                                                  209


                                                                                                  WM8998
CLOCKING AND SAMPLE RATES
               The WM8998 requires a clock reference for its internal functions and also for the input (ADC) paths,
               output (DAC) paths and digital audio interfaces. Under typical clocking configurations, all commonly-
               used audio sample rates can be derived directly from the external reference; for additional flexibility,
               the WM8998 incorporates two Frequency Locked Loop (FLL) circuits to perform frequency conversion
               and filtering.
               External clock signals may be connected via MCLK1 and MCLK2. (These inputs are referenced to the
               DBVDD1 power domain.) In AIF Slave modes, the BCLK signals may be used as a reference for the
               system clocks. The SLIMbus interface can provide the clock reference, when used as the input to one
               of the FLLs. To avoid audible glitches, all clock configurations must be set up before enabling
               playback.
               SYSTEM CLOCKING
               The WM8998 supports two independent clock domains, referenced to the SYSCLK and ASYNCCLK
               system clocks respectively.
               Up to five different sample rates may be independently selected for specific audio interfaces and other
               input/output signal paths. Each selected sample rate must be synchronised either to SYSCLK or to
               ASYNCCLK, as described later.
               The two system clocks are independent (ie. not synchronised). Stereo full-duplex sample rate
               conversion is supported, allowing asynchronous audio data to be mixed and to be routed between
               independent interfaces. See “Digital Core” for further details.
               Each subsystem within the WM8998 digital core is clocked at a dynamically-controlled rate, limited by
               the SYSCLK (or ASYNCCLK) frequency, as applicable. For maximum signal mixing and processing
               capacity, it is recommended that the highest possible SYSCLK and ASYNCCLK frequencies are
               configured.
               If the SUBSYS_MAX_FREQ bit is set to ‘0’, then the digital core clocking rate is restricted to a
               maximum of 24.576MHz (or 22.5792MHz), even if a higher system clock frequency is configured.
               The maximum digital core clocking rates of 49.152MHz (or 45.1584MHz) are only supported when
               SUBSYS_MAX_FREQ is set to ‘1’, and the DCVDD voltage is 1.8V (nominal).
               See “Recommended Operating Conditions” for details of the DCVDD operating conditions. Note that,
               if DCVDD is less than the minimum level for >24.576MHz clocking, then SUBSYS_MAX_FREQ must
               be set to ‘0’.
                   REGISTER        BIT         LABEL           DEFAULT                     DESCRIPTION
                   ADDRESS
                  R353              0    SUBSYS_MAX_F              0         Digital Core Clocking Limit
                  (0161h)                REQ                                 Sets the maximum digital core clocking
                  Dynamic                                                    rate. The higher rate should only be
                  Frequency                                                  selected when the DCVDD voltage is
                  Scaling 1                                                  1.8V (nominal).
                                                                             0 = 24.576MHz (22.5792MHz)
                                                                             1 = 49.152MHz (45.1584MHz)
               Table 87 System Clocking
               SAMPLE RATE CONTROL
               The WM8998 supports two independent clock domains, referenced to SYSCLK and ASYNCCLK
               respectively.
               Different sample rates may be selected for each of the audio interfaces (AIF1, AIF2, AIF3, SLIMbus),
               and for the input (ADC) and output (DAC) paths. Each of these must be referenced either to SYSCLK
               or to ASYNCCLK. (Note that the SLIMbus interface supports multiple sample rates, selected
               independently for each input or output channel.)
               The WM8998 can support a maximum of five different sample rates at any time. The supported
               sample rates range from 8kHz to 192kHz.
210                                                                                                            Rev 4.1


                                                                                              WM8998
        Up to three different sample rates can be selected using the SAMPLE_RATE_1, SAMPLE_RATE_2
        and SAMPLE_RATE_3 registers. These must each be numerically related to each other and to the
        SYSCLK frequency (further details of these requirements are provided in Table 88 and the
        accompanying text).
        The remaining two sample rates can be selected using the ASYNC_SAMPLE_RATE_1 and
        ASYNC_SAMPLE_RATE_2 registers. These sample rates must be numerically related to each other
        and to the ASYNCCLK frequency (further details of these requirements are provided in Table 89 and
        the accompanying text).
        Each of the audio interfaces, input paths and output paths is associated with one of the sample rates
        selected by the SAMPLE_RATE_n or ASYNC_SAMPLE_RATE_n registers.
        Note that if any two interfaces are operating at the same sample rate, but are not synchronised, then
        one of these must be referenced to the ASYNCCLK domain, and the other to the SYSCLK domain.
        Note that, when any of the SAMPLE_RATE_n or ASYNC_SAMPLE_RATE_n registers is written to,
        the activation of the new setting is automatically synchronised by the WM8998 to ensure continuity of
        all active signal paths. The SAMPLE_RATE_n_STS and ASYNC_SAMPLE_RATE_n_STS registers
        provide readback of the sample rate selections that have been implemented.
        There are some restrictions to be observed regarding the sample rate control configuration, as noted
        below:
                   The input (ADC / Digital Microphone) and output (DAC) signal paths must always be
                    associated with the SYSCLK clocking domain.
                   All external clock references (MCLK input or Slave mode AIF input) must be within 1% of
                    the applicable register setting(s).
                   The S/PDIF sample rate is valid from 32kHz to 192kHz.
                   The Asynchronous Sample Rate Converter (ASRC) supports sample rates 11.025kHz,
                    12kHz, 22.05kHz, 24kHz, 44.1kHz and 48kHz only. The SYSCLK and ASYNCCLK sample
                    rates must each be set to one of these valid sample rates.
                   The Isochronous Sample Rate Converters (ISRCs) support sample rates 8kHz to 192kHz.
                    For each ISRC, the higher sample rate must be an integer multiple of the lower rate. Integer
                    ratios in the range 1 to 6 are supported on ISRC1; integer ratios in the range 1 to 24 are
                    supported on ISRC2.
        AUTOMATIC SAMPLE RATE DETECTION
        The WM8998 supports automatic sample rate detection on the digital audio interfaces (AIF1, AIF2
        and AIF3). Note that this is only possible when the respective interface is operating in Slave mode (ie.
        when LRCLK and BCLK are inputs to the WM8998).
        Automatic sample rate detection is enabled using the RATE_EST_ENA register bit. The LRCLK input
        pin selected for sample rate detection is set using the LRCLK_SRC register.
        Up to four audio sample rates can be configured for automatic detection; these sample rates are
        selected using the SAMPLE_RATE_DETECT_n registers. Note that the function will only detect
        sample rates that match one of the SAMPLE_RATE_DETECT_n registers.
        If one of the selected audio sample rates is detected on the selected LRCLK input, then a Control
        Write Sequence will be triggered. A unique sequence of actions may be programmed for each of the
        detected sample rates. Note that the applicable control sequences must be programmed by the user
        for each detection outcome. See “Control Write Sequencer” for further details.
        The TRIG_ON_STARTUP register controls whether the sample rate detection circuit responds to the
        initial detection of the applicable interface (ie. when the AIFn interface starts up).
        When TRIG_ON_STARTUP=0, then the detection circuit will only respond (ie. trigger the Control
        Write Sequencer) to a change in the detected sample rate - the initial sample rate detection will be
        ignored. (Note that the ‘initial sample rate detection’ is the first detection of a sample rate that matches
        one of the SAMPLE_RATE_DETECT_n registers.)
        When TRIG_ON_STARTUP=1, then the detection circuit will trigger the Control Write Sequencer
        whenever a selected sample rate is detected, including when the AIF interface starts up, or when the
Rev 4.1                                                                                                         211


                                                                                   WM8998
    sample rate detection is first enabled.
    As described above, setting TRIG_ON_STARTUP=0 is designed to inhibit any response to the initial
    detection of a sample rate that matches one of the SAMPLE_RATE_DETECT_n registers. Note that,
    if the LRCLK_SRC setting is changed, or if the detection function is disabled and re-enabled, then a
    subsequent detection of a matching sample rate may trigger the Control Write Sequencer, regardless
    of the TRIG_ON_STARTUP setting.
    There are some restrictions to be observed regarding the automatic sample rate detection, as noted
    below:
               The same sample rate must not              be selected  on    more  than   one    of the
                SAMPLE_RATE_DETECT_n registers.
               Sample rates 192kHz and 176.4kHz must not be selected concurrently.
               Sample rates 96kHz and 88.2kHz must not be selected concurrently.
    The control registers associated with the automatic sample rate detection function are described in
    Table 90.
    SYSCLK AND ASYNCCLK CONTROL
    The SYSCLK and ASYNCCLK clocks may be provided directly from external inputs (MCLK, or slave
    mode BCLK inputs). Alternatively, the SYSCLK and ASYNCCLK clocks can be derived using the
    integrated FLL(s), with MCLK, BCLK, LRCLK or SLIMCLK as a reference.
    The required SYSCLK frequency is dependent on the SAMPLE_RATE_n registers. Table 88
    illustrates the valid SYSCLK frequencies for every supported sample rate.
    The SYSCLK_FREQ and SYSCLK_FRAC registers are used to identify the applicable SYSCLK
    frequency. It is recommended that the highest possible SYSCLK frequency is selected.
    The chosen SYSCLK frequency must be valid for all of the SAMPLE_RATE_n registers. It follows that
    all of the SAMPLE_RATE_n registers must select numerically-related values, ie. all from the same cell
    as represented in Table 88.
         Sample Rate        SAMPLE_RATE_n             SYSCLK        SYSCLK_FREQ         SYSCLK_FRAC
                                                     Frequency
             12kHz                 01h
             24kHz                 02h
             48kHz                 03h              6.144MHz,           000,
                                                   12.288MHz,           001,
             96kHz                 04h
                                                   24.576MHz,           010,                  0
            192kHz                 05h
                                                        or                or
              8kHz                 11h             49.152MHz             011
             16kHz                 12h
             32kHz                 13h
          11.025kHz                09h             5.6448MHz,           000,
           22.05kHz                0Ah            11.2896MHz,           001,
            44.1kHz                0Bh            22.5792MHz,           010,                  1
            88.2kHz                0Ch                  or                or
           176.4kHz                0Dh            45.1584MHz             011
       Note that each of the SAMPLE_RATE_n registers must select a sample rate value from the same
       group in the two lists above.
    Table 88 SYSCLK Frequency Selection
    The required ASYNCCLK frequency is dependent on the ASYNC_SAMPLE_RATE_n registers. Table
    89 illustrates the valid ASYNCCLK frequencies for every supported sample rate.
    The ASYNC_CLK_FREQ register is used to identify the applicable ASYNCCLK frequency. It is
    recommended that the highest possible ASYNCCLK frequency is selected.
    Note that, if all the sample rates in the system are synchronised to SYSCLK, then the ASYNCCLK
    may not be required at all. In this case, the ASYNCCLK should be disabled (see Table 90), and the
    associated register values are not important.
212                                                                                             Rev 4.1


                                                                                         WM8998
               Sample Rate           ASYNC_SAMPLE_RATE_n                 ASYNCCLK         ASYNC_CLK_FREQ
                                                                          Frequency
                   12kHz                         01h
                   24kHz                         02h
                   48kHz                         03h                     6.144MHz,                000,
                                                                        12.288MHz,                001,
                   96kHz                         04h
                                                                        24.576MHz,                010,
                  192kHz                         05h
                                                                             or                    or
                    8kHz                         11h                     49.152MHz                011
                   16kHz                         12h
                   32kHz                         13h
                11.025kHz                        09h                    5.6448MHz,                000,
                 22.05kHz                       0Ah                    11.2896MHz,                001,
                  44.1kHz                       0Bh                     22.5792MHz                010,
                  88.2kHz                       0Ch                          or                    or
                 176.4kHz                       0Dh                     45.1584MHz                011
           Note that each of the ASYNC_SAMPLE_RATE_n registers must select a sample rate value from
           the same group in the two lists above.
        Table 89 ASYNCCLK Frequency Selection
        The WM8998 supports automatic clocking configuration. The programmable dividers associated with
        the ADCs, DACs and all Digital Core functions are configured automatically, with values determined
        from the SYSCLK_FREQ, SAMPLE_RATE_n, ASYNC_CLK_FREQ and ASYNC_SAMPLE_RATE_n
        fields.
        Note that the digital audio interface (AIF) clocking rates must be configured separately.
        The sample rates of each AIF, the input (ADC) paths, output (DAC) paths and Digital Core functions
        are selected as described in the respective sections. Stereo full-duplex sample rate conversion is
        supported in multiple configurations to allow digital audio to be routed between interfaces and for
        asynchronous audio data to be mixed. See “Digital Core” for further details.
        The SYSCLK_SRC register is used to select the SYSCLK source, as described in Table 90. The
        source may be MCLKn, AIFnBCLK or FLLn. If one of the Frequency Locked Loop (FLL) circuits is
        selected as the source, then the relevant FLL must be enabled and configured, as described later.
        The SYSCLK_FREQ and SYSCLK_FRAC registers are set according to the frequency of the selected
        SYSCLK source.
        The SYSCLK-referenced circuits within the digital core are clocked at a dynamically-controlled rate,
        limited by the SYSCLK frequency itself. For maximum signal mixing and processing capacity, it is
        recommended that the highest possible SYSCLK frequency is configured.
        If the SUBSYS_MAX_FREQ bit is set to ‘0’, then the digital core clocking rate is restricted to a
        maximum of 24.576MHz (or 22.5792MHz), even if a higher SYSCLK frequency is configured. The
        SUBSYS_MAX_FREQ should only be set to ‘1’ when the applicable DCVDD condition is satisfied, as
        described in Table 87.
        The SAMPLE_RATE_n registers are set according to the sample rate(s) that are required by one or
        more of the WM8998 audio interfaces. The WM8998 supports sample rates ranging from 8kHz to
        192kHz.
Rev 4.1                                                                                                 213


                                                                                      WM8998
    The SYSCLK signal is enabled by the register bit SYSCLK_ENA. The applicable clock source
    (MCLKn, AIFnBCLK or FLLn) must be enabled before setting SYSCLK_ENA=1. This bit should be set
    to 0 when reconfiguring the clock sources (see below for additional requirements when setting
    SYSCLK_ENA=0).
    When disabling SYSCLK, note that all of the input, output or digital core functions associated with the
    SYSCLK clock domain must be disabled before setting SYSCLK_ENA=0.
    When ‘0’ is written to SYSCLK_ENA, the host processor must wait until the WM8998 has shut down
    the associated functions before issuing any other register write commands. The SYSCLK Enable
    status can be polled via the SYSCLK_ENA_LOW_STS bit (see Table 86), or else monitored using the
    Interrupt or GPIO functions.
    The SYSCLK Enable status is an input to the Interrupt control circuit and can be used to trigger an
    Interrupt event - see “Interrupts”. The corresponding Interrupt event indicates that the WM8998 has
    shut down the SYSCLK functions and is ready to accept register write commands.
    The SYSCLK Enable status can be output directly on a GPIO pin as an external indication of the
    SYSCLK status. See “General Purpose Input / Output” to configure a GPIO pin for this function.
    The required control sequence for disabling SYSCLK is summarised below:
               Disable all SYSCLK-associated functions (inputs, outputs, digital core)
               Set SYSCLK_ENA = 0
               Wait until SYSCLK_ENA_LOW = 1 (or wait for the corresponding IRQ/GPIO event)
    The ASYNC_CLK_SRC register is used to select the ASYNCCLK source, as described in Table 90.
    The source may be MCLKn, AIFnBCLK or FLLn. If one of the Frequency Locked Loop (FLL) circuits is
    selected as the source, then the relevant FLL must be enabled and configured, as described later.
    The ASYNC_CLK_FREQ register is set according to the frequency of the selected ASYNCCLK
    source.
    The ASYNCCLK-referenced circuits within the digital core are clocked at a dynamically-controlled
    rate, limited by the ASYNCCLK frequency itself. For maximum signal mixing and processing capacity,
    it is recommended that the highest possible ASYNCCLK frequency is configured.
    If the SUBSYS_MAX_FREQ bit is set to ‘0’, then the digital core clocking rate is restricted to a
    maximum of 24.576MHz (or 22.5792MHz), even if a higher ASYNCCLK frequency is configured. The
    SUBSYS_MAX_FREQ should only be set to ‘1’ when the applicable DCVDD condition is satisfied, as
    described in Table 87.
    The ASYNC_SAMPLE_RATE_n registers are set according to the sample rate(s) of any audio
    interface that is not synchronised to the SYSCLK clock domain.
    The ASYNCCLK signal is enabled by the register bit ASYNC_CLK_ENA. The applicable clock source
    (MCLKn, AIFnBCLK or FLLn) must be enabled before setting ASYNC_CLK_ENA=1. This bit should
    be set to 0 when reconfiguring the clock sources (see below for additional requirements when setting
    ASYNC_CLK_ENA=0).
    When disabling ASYNCCLK, note that all of the input, output or digital core functions associated with
    the ASYNCCLK clock domain must be disabled before setting ASYNC_CLK_ENA=0.
    When ‘0’ is written to ASYNC_CLK_ENA, the host processor must wait until the WM8998 has shut
    down the associated functions before issuing any other register write commands. The ASYNCCLK
    Enable status can be polled via the ASYNC_CLK_ENA_LOW_STS bit (see Table 86), or else
    monitored using the Interrupt or GPIO functions.
    The ASYNCCLK Enable status is an input to the Interrupt control circuit and can be used to trigger an
    Interrupt event - see “Interrupts”. The corresponding Interrupt event indicates that the WM8998 has
    shut down the ASYNCCLK functions and is ready to accept register write commands.
    The ASYNCCLK Enable status can be output directly on a GPIO pin as an external indication of the
    ASYNCCLK status. See “General Purpose Input / Output” to configure a GPIO pin for this function.
214                                                                                              Rev 4.1


                                                                                        WM8998
        The required control sequence for disabling ASYNCCLK is summarised below:
                  Disable all ASYNCCLK-associated functions (inputs, outputs, digital core)
                  Set ASYNCCLK_ENA = 0
                  Wait until ASYNCCLK_ENA_LOW = 1 (or wait for the corresponding IRQ/GPIO event)
        The SYSCLK (and ASYNCCLK, when applicable) clocks must be configured and enabled before any
        audio path is enabled.
        The WM8998 performs automatic checks to confirm that the SYSCLK and ASYNCCLK frequencies
        are high enough to support the commanded signal paths and processing functions. If an attempt is
        made to enable a signal path or processing function, and there are insufficient SYSCLK or
        ASYNCCLK cycles to support it, then the attempt will be unsuccessful. (Note that any signal paths
        that are already active will not be affected under these circumstances.)
        An Underclocked Error condition is where there are insufficient clock cycles for the requested
        functionality, and increasing the SYSCLK or ASYNCCLK frequency (as applicable) should allow the
        selected configuration to be supported.
        An Overclocked Error condition is where the requested functionality cannot be supported, as the
        clocking requirements of the requested configuration exceed the device limits.
        The SYSCLK Underclocked condition, ASYNCCLK Underclocked condition, and other Clocking Error
        conditions can be monitored using the GPIO and/or Interrupt functions. See “General Purpose Input /
        Output” and “Interrupts” for further details.
        MISCELLANEOUS CLOCK CONTROLS
        The WM8998 requires a 32kHz clock for miscellaneous de-bounce functions. This can be generated
        automatically from SYSCLK, or may be input directly as MCLK1 or MCLK2. The 32kHz clock source
        is selected using the CLK_32K_SRC register. The 32kHz clock is enabled using the CLK_32K_ENA
        register.
        The 32kHz clock can be maintained in Sleep mode, if required for de-bouncing any of the configured
        Wake-Up signals (eg. JACKDET or GPIO5). Note that the 32kHz clock must be derived from the
        MCLK2 pin in this case (CLK_32K_SRC=01). See “Low Power Sleep Configuration” for more details
        of the Sleep mode.
        A clock output (OPCLK) derived from SYSCLK can be output on a GPIO pin. See “General Purpose
        Input / Output” to configure a GPIO pin for this function.
        A clock output (OPCLK_ASYNC) derived from ASYNCCLK can be output on a GPIO pin. See
        “General Purpose Input / Output” to configure a GPIO pin for this function.
        The WM8998 provides integrated pull-down resistors on the MCLK1 and MCLK2 pins. This provides a
        flexible capability for interfacing with other devices.
        The clocking scheme for the WM8998 is illustrated in Figure 64.
Rev 4.1                                                                                               215


                                                                                                                                                                     WM8998
                                                                                                                                                                                                                                        32k Clock
                                                                                                                                 CLK_32K_ENA
                                                                                                                CLK_32K_SRC
                                                                                                  Divider
                                                                                                  (Auto)
                                                                                                                                                                                                                                        OPCLK
                                                                                                                                 OPCLK_ENA
                                                                                                                   Divider
                                                                                                                              OPCLK_SEL
 MCLK1                                                                                                                        OPCLK_DIV
 MCLK2
           AIF1BCLK
           AIF2BCLK
           AIF3BCLK                                                                                                                                                                                                                     SYSCLK
                                                                                                            SYSCLK_ENA
                                                                                             SYSCLK_SRC
                                                                                                                                                                                                                 OPCLK_ASYNC
                                                                                                                                 OPCLK_ASYNC_ENA
                                                                                                                   Divider
                                                                                                                              OPCLK_ASYNC_SEL
                                                                                                                              OPCLK_ASYNC_DIV
                                                                                                                                                                                                                                        ASYNCCLK
                                                                                                            ASYNC_CLK_ENA
                                                      FLL1_OUTDIV   Divider                  ASYNC_CLK_SRC
                                                         FLL1
                                                                                        Divider                   GPIO output
                                                                                                  FLL1_GPCLK_ENA
                                        FLL1_REFCLK_SRC
                                                                                        FLL1_GPCLK_DIV                                                 Automatic Clocking Control
                                                            FLL2_OUTDIV       Divider
                                                         FLL2
                                                                                                                                                       SYSCLK_FRAC
                                                                                                                                                                     SAMPLE_RATE_1 [4:0]   SAMPLE_RATE_2 [4:0]    SAMPLE_RATE_3 [4:0]
                                                                                                                                                                                                                                         ASYNC_CLK_FREQ [2:0]
                                                                                                                                                                                                                                                                ASYNC_SAMPLE_RATE_1 [4:0]   ASYNC_SAMPLE_RATE_2 [4:0]
                                                                                                                                   SYSCLK_FREQ [2:0]
                                                                                        Divider                   GPIO output
                                                                                                  FLL2_GPCLK_ENA
                                        FLL2_REFCLK_SRC
                                                                                        FLL2_GPCLK_DIV
          FLLn, AIFnLRCLK, and SLIMCLK can
          also be selected as FLLn input reference.
Figure 64 System Clocking
216                                                                                                                                                                                                                                                             Rev 4.1


                                                                                       WM8998
        The WM8998 clocking control registers are described in Table 90.
          REGISTER     BIT          LABEL           DEFAULT                      DESCRIPTION
          ADDRESS
         R256          6     CLK_32K_ENA               0        32kHz Clock Enable
         (0100h)                                                0 = Disabled
         Clock 32k                                              1 = Enabled
         1            1:0    CLK_32K_SRC               10       32kHz Clock Source
                             [1:0]                              00 = MCLK1 (direct)
                                                                01 = MCLK2 (direct)
                                                                10 = SYSCLK (automatically divided)
                                                                11 = Reserved
         R257         15     SYSCLK_FRAC               0        SYSCLK Frequency
         (0101h)                                                0 = SYSCLK is a multiple of 6.144MHz
         System                                                 1 = SYSCLK is a multiple of 5.6448MHz
         Clock 1     10:8    SYSCLK_FREQ              011       SYSCLK Frequency
                             [2:0]                              000 = 6.144MHz (5.6448MHz)
                                                                001 = 12.288MHz (11.2896MHz)
                                                                010 = 24.576MHz (22.5792MHz)
                                                                011 = 49.152MHz (45.1584MHz)
                                                                All other codes are Reserved
                                                                The frequencies in brackets apply for
                                                                44.1kHz-related sample rates only (ie.
                                                                SAMPLE_RATE_n = 01XXX).
                       6     SYSCLK_ENA                0        SYSCLK Control
                                                                0 = Disabled
                                                                1 = Enabled
                                                                SYSCLK should only be enabled after the
                                                                applicable clock source has been
                                                                configured and enabled.
                                                                Set this bit to 0 when reconfiguring the
                                                                clock sources.
                      3:0    SYSCLK_SRC              0100       SYSCLK Source
                             [3:0]                              0000 = MCLK1
                                                                0001 = MCLK2
                                                                0100 = FLL1
                                                                0101 = FLL2
                                                                1000 = AIF1BCLK
                                                                1001 = AIF2BCLK
                                                                1010 = AIF3BCLK
                                                                All other codes are Reserved
         R258         4:0    SAMPLE_RATE_            10001      Sample Rate 1 Select
         (0102h)             1 [4:0]                            00h = None
         Sample                                                 01h = 12kHz
         rate 1                                                 02h = 24kHz
                                                                03h = 48kHz
                                                                04h = 96kHz
                                                                05h = 192kHz
                                                                09h = 11.025kHz
                                                                0Ah = 22.05kHz
                                                                0Bh = 44.1kHz
                                                                0Ch = 88.2kHz
                                                                0Dh = 176.4kHz
                                                                11h = 8kHz
                                                                12h = 16kHz
                                                                13h = 32kHz
                                                                All other codes are Reserved
Rev 4.1                                                                                                  217


                                                                WM8998
     REGISTER   BIT        LABEL DEFAULT                  DESCRIPTION
     ADDRESS
    R259       4:0  SAMPLE_RATE_  10001  Sample Rate 2 Select
    (0103h)         2 [4:0]              Register coding is same as
    Sample                               SAMPLE_RATE_1.
    rate 2
    R260       4:0  SAMPLE_RATE_  10001  Sample Rate 3 Select
    (0104h)         3 [4:0]              Register coding is same as
    Sample                               SAMPLE_RATE_1.
    rate 3
    R266       4:0  SAMPLE_RATE_  00000  Sample Rate 1 Status
    (010Ah)         1_STS [4:0]          (Read only)
    Sample                               Register coding is same as
    rate 1                               SAMPLE_RATE_1.
    status
    R267       4:0  SAMPLE_RATE_  00000  Sample Rate 2 Status
    (010Bh)         2_STS [4:0]          (Read only)
    Sample                               Register coding is same as
    rate 2                               SAMPLE_RATE_1.
    status
    R268       4:0  SAMPLE_RATE_  00000  Sample Rate 3 Status
    (010Ch)         3_STS [4:0]          (Read only)
    Sample                               Register coding is same as
    rate 3                               SAMPLE_RATE_1.
    status
    R274      10:8  ASYNC_CLK_FR   011   ASYNCCLK Frequency
    (0112h)         EQ [2:0]             000 = 6.144MHz (5.6448MHz)
    Async                                001 = 12.288MHz (11.2896MHz)
    clock 1                              010 = 24.576MHz (22.5792MHz)
                                         011 = 49.152MHz (45.1584MHz)
                                         All other codes are Reserved
                                         The frequencies in brackets apply for
                                         44.1kHz-related sample rates only (ie.
                                         ASYNC_SAMPLE_RATE_n = 01XXX).
                6   ASYNC_CLK_EN    0    ASYNCCLK Control
                    A                    0 = Disabled
                                         1 = Enabled
                                         ASYNCCLK should only be enabled after
                                         the applicable clock source has been
                                         configured and enabled.
                                         Set this bit to 0 when reconfiguring the
                                         clock sources.
               3:0  ASYNC_CLK_SR  0101   ASYNCCLK Source
                    C [3:0]              0000 = MCLK1
                                         0001 = MCLK2
                                         0100 = FLL1
                                         0101 = FLL2
                                         1000 = AIF1BCLK
                                         1001 = AIF2BCLK
                                         1010 = AIF3BCLK
                                         All other codes are Reserved
218                                                                          Rev 4.1


                                                                      WM8998
         REGISTER  BIT       LABEL     DEFAULT                DESCRIPTION
         ADDRESS
        R275      4:0  ASYNC_SAMPL      10001  ASYNC Sample Rate 1 Select
        (0113h)        E_RATE_1 [4:0]          00h = None
        Async                                  01h = 12kHz
        sample                                 02h = 24kHz
        rate 1                                 03h = 48kHz
                                               04h = 96kHz
                                               05h = 192kHz
                                               09h = 11.025kHz
                                               0Ah = 22.05kHz
                                               0Bh = 44.1kHz
                                               0Ch = 88.2kHz
                                               0Dh = 176.4kHz
                                               11h = 8kHz
                                               12h = 16kHz
                                               13h = 32kHz
                                               All other codes are Reserved
        R276      4:0  ASYNC_SAMPL      10001  ASYNC Sample Rate 2 Select
        (0114h)        E_RATE_2 [4:0]          Register coding is same as
        Async                                  ASYNC_SAMPLE_RATE_1.
        sample
        rate 2
        R283      4:0  ASYNC_SAMPL      00000  ASYNC Sample Rate 1 Status
        (011Bh)        E_RATE_1_STS            (Read only)
        Async          [4:0]                   Register coding is same as
        sample                                 ASYNC_SAMPLE_RATE_1.
        rate 1
        status
        R284      4:0  ASYNC_SAMPL      00000  ASYNC Sample Rate 2 Status
        (011Ch)        E_RATE_2_STS            (Read only)
        Async          [4:0]                   Register coding is same as
        sample                                 ASYNC_SAMPLE_RATE_1.
        rate 2
        status
        R329      15   OPCLK_ENA          0    OPCLK Enable
        (0149h)                                0 = Disabled
        Output                                 1 = Enabled
        system    7:3  OPCLK_DIV [4:0]   00h   OPCLK Divider
        clock
                                               00h = Divide by 1
                                               01h = Divide by 1
                                               02h = Divide by 2
                                               03h = Divide by 3
                                               …
                                               1Fh = Divide by 31
                  2:0  OPCLK_SEL         000   OPCLK Source Frequency
                       [2:0]                   000 = 6.144MHz (5.6448MHz)
                                               001 = 12.288MHz (11.2896MHz)
                                               010 = 24.576MHz (22.5792MHz)
                                               011 = 49.152MHz (45.1584MHz)
                                               All other codes are Reserved
                                               The frequencies in brackets apply for
                                               44.1kHz-related SYSCLK rates only (ie.
                                               SAMPLE_RATE_n = 01XXX).
                                               The OPCLK Source Frequency must be
                                               less than or equal to the SYSCLK
                                               frequency.
Rev 4.1                                                                              219


                                                                 WM8998
     REGISTER  BIT       LABEL    DEFAULT                  DESCRIPTION
     ADDRESS
    R330      15   OPCLK_ASYNC_     0     OPCLK_ASYNC Enable
    (014Ah)        ENA                    0 = Disabled
    Output                                1 = Enabled
    async     7:3  OPCLK_ASYNC_    00h    OPCLK_ASYNC Divider
    clock          DIV [4:0]              00h = Divide by 1
                                          01h = Divide by 1
                                          02h = Divide by 2
                                          03h = Divide by 3
                                          …
                                          1Fh = Divide by 31
              2:0  OPCLK_ASYNC_    000    OPCLK_ASYNC Source Frequency
                   SEL [2:0]              000 = 6.144MHz (5.6448MHz)
                                          001 = 12.288MHz (11.2896MHz)
                                          010 = 24.576MHz (22.5792MHz)
                                          011 = 49.152MHz (45.1584MHz)
                                          All other codes are Reserved
                                          The frequencies in brackets apply for
                                          44.1kHz-related ASYNCCLK rates only
                                          (ie. ASYNC_SAMPLE_RATE_n =
                                          01XXX).
                                          The OPCLK_ASYNC Source Frequency
                                          must be less than or equal to the
                                          ASYNCCLK frequency.
    R338       4   TRIG_ON_STAR     0     Automatic Sample Rate Detection Start-
    (0152h)        TUP                    Up select
    Rate                                  0 = Do not trigger Write Sequence on
    Estimator                             initial detection
    1                                     1 = Always trigger the Write Sequencer on
                                          sample rate detection
              3:1  LRCLK_SRC       000    Automatic Sample Rate Detection source
                   [2:0]                  000 = AIF1LRCLK
                                          010 = AIF2LRCLK
                                          100 = AIF3LRCLK
                                          All other values are Reserved
               0   RATE_EST_ENA     0     Automatic Sample Rate Detection control
                                          0 = Disabled
                                          1 = Enabled
    R339      4:0  SAMPLE_RATE_    00h    Automatic Detection Sample Rate A
    (0153h)        DETECT_A [4:0]         (Up to four different sample rates can be
    Rate                                  configured for automatic detection.)
    Estimator                             Register coding is same as
    2                                     SAMPLE_RATE_n.
    R340      4:0  SAMPLE_RATE_    00h    Automatic Detection Sample Rate B
    (0154h)        DETECT_B [4:0]         (Up to four different sample rates can be
    Rate                                  configured for automatic detection.)
    Estimator                             Register coding is same as
    3                                     SAMPLE_RATE_n.
    R341      4:0  SAMPLE_RATE_    00h    Automatic Detection Sample Rate C
    (0155h)        DETECT_C [4:0]         (Up to four different sample rates can be
    Rate                                  configured for automatic detection.)
    Estimator                             Register coding is same as
    4                                     SAMPLE_RATE_n.
    R342      4:0  SAMPLE_RATE_    00h    Automatic Detection Sample Rate D
    (0156h)        DETECT_D [4:0]         (Up to four different sample rates can be
    Rate                                  configured for automatic detection.)
    Estimator                             Register coding is same as
    5                                     SAMPLE_RATE_n.
220                                                                           Rev 4.1


                                                                                                          WM8998
            REGISTER              BIT               LABEL             DEFAULT                     DESCRIPTION
            ADDRESS
           R3104                 13        MCLK2_PD                      0         MCLK2 Pull-Down Control
           (0C20h)                                                                 0 = Disabled
           Misc Pad                                                                1 = Enabled
           Ctrl 1
           R3105                 12        MCLK1_PD                      0         MCLK1 Pull-Down Control
           (0C21h)                                                                 0 = Disabled
           Misc Pad                                                                1 = Enabled
           Ctrl 2
        Table 90 Clocking Control
        In AIF Slave modes, it is important to ensure the applicable clock domain (SYSCLK or ASYNCCLK) is
        synchronised with the associated external LRCLK. This can be achieved by selecting an MCLK input
        that is derived from the same reference as the LRCLK, or can be achieved by selecting the external
        BCLK or LRCLK signal as a reference input to one of the FLLs, as a source for SYSCLK or
        ASYNCCLK.
        If the AIF clock domain is not synchronised with the LRCLK, then clicks arising from dropped or
        repeated audio samples will occur, due to the inherent tolerances of multiple, asynchronous, system
        clocks. See “Applications Information” for further details on valid clocking configurations.
        BCLK AND LRCLK CONTROL
        The digital audio interfaces (AIF1, AIF2 and AIF3) use BCLK and LRCLK signals for synchronisation.
        In master mode, these are output signals, generated by the WM8998. In slave mode, these are input
        signals to the WM8998. It is also possible to support mixed master/slave operation.
        The BCLK and LRCLK signals are controlled as illustrated in Figure 65. See the “Digital Audio
        Interface Control” section for further details of the relevant control registers.
        Note that the BCLK and LRCLK signals are synchronised to SYSCLK or ASYNCCLK, depending
        upon the applicable clocking domain for the respective interface. See “Digital Core” for further details.
                                          AIF1_BCLK_FREQ [4:0]                             AIF1_BCLK_MSTR
          SYSCLK                                                                           AIF1_LRCLK_MSTR
          ASYNCCLK                                              AIF1RX_BCPF [12:0]
                                                  f/N                                          MASTER        AIF1BCLK
                                                                                                MODE
                                                                                                CLOCK
                                 (see note below)                  f/N                                       AIF1LRCLK
                                                                                              OUTPUTS
                                                                                           AIF2_BCLK_MSTR
                                          AIF2_BCLK_FREQ [4:0]
                                                                                           AIF2_LRCLK_MSTR
                                                                AIF2RX_BCPF [12:0]
                                                  f/N                                          MASTER        AIF2BCLK
                                                                                                MODE
                                                                                                CLOCK
                                 (see note below)                  f/N                        OUTPUTS        AIF2LRCLK
                                                                                           AIF3_BCLK_MSTR
                                          AIF3_BCLK_FREQ [4:0]
                                                                                           AIF3_LRCLK_MSTR
                                                                AIF3RX_BCPF [12:0]
                                                  f/N                                          MASTER        AIF3BCLK
                                                                                                MODE
                                                                                                CLOCK
                                 (see note below)                  f/N                        OUTPUTS        AIF3LRCLK
            The clock reference for each AIF is SYSCLK or ASYNCCLK
            AIFn is clocked from SYSCLK if AIFn_RATE < 1000
            AIFn is clocked from ASYNCCLK if AIFn_RATE >= 1000
        Figure 65 BCLK and LRCLK Control
Rev 4.1                                                                                                                221


                                                                                      WM8998
    CONTROL INTERFACE CLOCKING
    Register map access is possible with or without a system clock. Clocking is provided from SYSCLK;
    the SYSCLK_SRC register selects the applicable SYSCLK source.
    See “Control Interface” for further details of control register access.
    FREQUENCY LOCKED LOOP (FLL)
    Two integrated FLLs are provided to support the clocking requirements of the WM8998. These can be
    enabled and configured independently according to the available reference clocks and the application
    requirements. The reference clock may be a high frequency (eg. 12.288MHz) or low frequency (eg.
    32.768kHz).
    The FLL is tolerant of jitter and may be used to generate a stable output clock from a less stable input
    reference. The FLL characteristics are summarised in “Electrical Characteristics”. Note that the FLL
    can be used to generate a free-running clock in the absence of an external reference source. This is
    described in the “Free-Running FLL Mode” section below. Configurable spread-spectrum modulation
    can be applied to the FLL outputs, to control EMI effects.
    Each of the FLLs comprises two sub-systems - the ‘main’ loop and the ‘synchroniser’ loop; these can
    be used together to maintain best frequency accuracy and noise (jitter) performance across multiple
    use-cases. The two-loop design enables the FLL to synchronise effectively to an input clock that may
    be intermittent or noisy, whilst also achieving the performance benefits of a stable clock reference that
    may be asynchronous to the audio data.
    The main loop takes a constant and stable clock reference as its input. For best performance, a high
    frequency (eg. 12.288MHz) reference is recommended. The main FLL loop will free-run without any
    clock reference if the input signal is removed; it can also be configured to initiate an output in the
    absence of any reference signal.
    The synchroniser loop takes a separate clock reference as its input. The synchroniser input may be
    intermittent (eg. during voice calls only). The FLL uses the synchroniser input, when available, as the
    frequency reference. To achieve the designed performance advantage, the synchroniser input must
    be synchronous with the audio data.
    Note that, if only a single clock input reference is used, this must be configured as the main FLL input
    reference. The synchroniser should be disabled in this case.
    The synchroniser loop should only be used when the main loop clock reference is present. If the input
    reference to the main FLL is intermittent, or may be interrupted unexpectedly, then the synchroniser
    should be disabled.
    The FLL is enabled using the FLLn_ENA register bit (where n = 1 or 2 for the corresponding FLL).
    The FLL Synchroniser is enabled using the FLLn_SYNC_ENA register bit.
    Note that the other FLL registers should be configured before enabling the FLL; the FLLn_ENA bit
    should be set as the final step of the FLLn enable sequence.
    The FLL_SYNC_ENA bit should not be changed if FLLn_ENA = 1; the FLLn_ENA bit should be
    cleared before changing FLLn_SYNC_ENA.
    The FLL supports configurable free-running operation, using the FLLn_FREERUN register bits
    described in the next section. Note that, once the FLL output has been established, the FLL will
    always free-run when the input reference clock is stopped, regardless of the FLLn_FREERUN bits.
    To disable the FLL while the input reference clock has stopped, the respective FLLn_FREERUN bit
    must be set to ‘1’, before setting the FLLn_ENA bit to ‘0’.
    When changing any of the FLL configuration fields, it is recommended that the digital circuit be
    disabled via FLLn_ENA and then re-enabled after the other register settings have been updated. If the
    FLL configuration is changed while the FLL is enabled, the respective FLLn_FREERUN bit should be
    set before updating any other FLL fields. A minimum delay of 32µs should be allowed between setting
    FLLn_FREERUN and writing to the required FLL register fields. The FLLn_FREERUN bit should
    remain set until after the FLL has been reconfigured.
    Note that, if the FLLn_N or FLLn_THETA fields are changed while the FLL is enabled, the
    FLLn_CTRL_UPD bit must also be written, as described below. As a general rule, however, it is
    recommended to configure the FLL (and FLL Synchroniser, if applicable), before setting the
222                                                                                                Rev 4.1


                                                                                                                             WM8998
                           corresponding _ENA register bit(s).
                           The FLL configuration requirements are illustrated in Figure 66.
                                                                                                                          FLLn_ENA
   MCLK1                                                                                              Main FLL path      (FLL Enable)
   MCLK2
                                                 Divide by              FREF      Multiply by       Multiply by        FVCO
                     FLLn,
                AIFnBCLK,                   FLLn_REFCLK_DIV                          N.K         FLLn_FRATIO                (90MHz ≤ Fvco ≤ 100MHz)
               AIFnLRCLK
                                           Divide by 1, 2, 4 or 8                                   Multiply by                                     FOUT
                                                                  FREF < 13.5MHz                   1, 2, 3 … 16                  Divide by
                                 FLLn_REFCLK_SRC                                                                              FLLn_OUTDIV
                                                                                                                               Divide by 2, 3 .. 7
                                                                                                                                                   FGPIO
                                                                                              FLL Synchroniser path              Divide by
                                                                                                                            FLLn_GPCLK_DIV
                                                 Divide by             FSYNC      Multiply by
                                                                                                    Multiply by
                                                                                                  FLLn_SYNC_                  Divide by 1, 2 .. 127
                                           FLLn_SYNCCLK_DIV                       N.K (Sync)
                                                                                                     FRATIO
                                           Divide by 1, 2, 4 or 8                                   Multiply by
                                                                                                 1, 2, 4, 8 or 16               FLLn_SYNC_ENA
                                                                  FSYNC < 13.5MHz
                                 FLLn_SYNCCLK_SRC                                                                       (FLL Synchroniser Enable)
                 Automatic
 SLIMCLK           Divider
                                                                              FLLn_THETA
            SLIMCLK_REF_GEAR     Synchroniser disabled:    N.K = FLLn_N +
                                                                             FLLn_LAMBDA
                                                                              FLLn_THETA                                      FLLn_SYNC_THETA
                                 Synchroniser enabled:     N.K = FLLn_N +                        N.K (Sync) = FLLn_SYNC_N +
                                                                                 65536                                       FLLn_SYNC_LAMBDA
Figure 66 FLL Configuration
                           The procedure for configuring the FLL is described below. Note that the configuration of the main FLL
                           path and the FLL Synchroniser path are very similar. One or both paths must be configured,
                           depending on the application requirements:
                                     If a single clock input reference is used, then only the main FLL path should be used.
                                     If the input reference to the main FLL is intermittent, or may be interrupted unexpectedly,
                                      then only the main FLL path should be used.
                                     If two clock input references are used, then the constant or low-noise clock is configured on
                                      the main FLL path, and the high-accuracy clock is configured on the FLL synchroniser path.
                                      Note that the synchroniser input must be synchronous with the audio data.
                           The following description is applicable to FLL1 and FLL2. The associated register control fields are
                           described in Table 95 and Table 96 respectively.
                           The main input reference is selected using FLLn_REFCLK_SRC. The synchroniser input reference is
                           selected using FLLn_SYNCCLK_SRC. The available options in each case comprise MCLK1, MCLK2,
                           SLIMCLK, AIFnBCLK, AIFnLRCLK, or the output from another FLL.
                           The SLIMCLK reference is controlled by an adaptive divider on the external SLIMCLK input. The
                           divider automatically adapts to the SLIMbus Clock Gear, to provide a constant reference frequency for
                           the FLL. See “SLIMbus Interface Control” for details.
                           The FLLn_REFCLK_DIV field controls a programmable divider on the main input reference. The
                           FLLn_SYNCCLK_DIV field controls a programmable divider on the synchroniser input reference.
                           Each input can be divided by 1, 2, 4 or 8. These registers should be set to bring each reference down
                           to 13.5MHz or below. For best performance, it is recommended that the highest possible frequency -
                           within the 13.5MHz limit - should be selected. (Note that additional guidelines also apply, as described
                           below.)
                           The FLL output frequency, relative to the main input reference FREF, is directly determined from
                           FLLn_FRATIO, FLLn_OUTDIV and the real number represented by N.K.
                           The integer value, N, is held in the FLLn_N register field. The fractional portion, K, is determined by
                           the FLLn_THETA and FLLn_LAMBDA fields.
Rev 4.1                                                                                                                                               223


                                                                                     WM8998
    The FLL output frequency is generated according to the following equation:
                FOUT = (FVCO / FLLn_OUTDIV)
    The FLL operating frequency, FVCO is set according to the following equation:
                FVCO = (FREF x N.K x FLLn_FRATIO)
    FREF is the input frequency, as determined by FLLn_REFCLK_DIV.
    FVCO must be in the range 90MHz to 100MHz. Frequencies outside this range cannot be supported.
    Note that the output frequencies that do not lie on or between the frequencies quoted above cannot
    be guaranteed across the full range of device operating conditions.
    In order to follow the above requirements for FVCO, the value of FLLn_OUTDIV should be selected
     according to the desired output FOUT. The divider, FLLn_OUTDIV, must be set so that FVCO is in the
     range 90MHz to 100MHz. The available divisions are integers from 2 to 7. Some typical settings of
     FLLn_OUTDIV are noted in Table 91.
             OUTPUT FREQUENCY FOUT                               FLLn_OUTDIV
       22.5 MHz to 26 MHz                           100 (divide by 4)
       45 MHz to 50 MHz                             010 (divide by 2)
    Table 91 Selection of FLLn_OUTDIV
    The FLLn_FRATIO field selects the frequency division ratio of the FLL input. The FLLn_GAIN field is
    used to optimise the FLL, according to the input frequency. As a general guide, these fields should be
    selected as described in Table 92. (Note that additional guidelines also apply, as described below.)
              REFERENCE                   FLLn_FRATIO                  FLLn_GAIN
           FREQUENCY FREF
       1MHz - 13.5MHz                    0h (divide by 1)           4h (16x gain)
       256kHz - 1MHz                     1h (divide by 2)             2h (4x gain)
       128kHz - 256kHz                   3h (divide by 4)             0h (1x gain)
       64kHz - 128kHz                    7h (divide by 8)             0h (1x gain)
       Less than 64kHz                  Fh (divide by 16)             0h (1x gain)
    Table 92 Selection of FLLn_FRATIO and FLLn_GAIN
    In order to determine the remaining FLL parameters, the FLL operating frequency, F VCO, must be
    calculated, as given by the following equation:
                FVCO = (FOUT x FLLn_OUTDIV)
    The value of N.K can then be determined as follows:
                N.K = FVCO / (FLLn_FRATIO x FREF)
    Note that, in the above equations:
                FLLn_OUTDIV is the FOUT clock ratio.
                FREF is the input frequency, after division by FLLn_REFCLK_DIV, where applicable.
                FLLn_FRATIO is the FVCO clock ratio (1, 2, 3 … 16).
224                                                                                               Rev 4.1


                                                                                        WM8998
        If the above equations produce an integer value for N.K, then the value of FLLn_FRATIO should be
        adjusted to a different, odd-number division (eg. divide by 3), and the value of N.K re-calculated. A
        non-integer value of N.K is recommended for best performance of the FLL. (If possible, the
        FLLn_FRATIO value should be decreased to the nearest alternative odd-number division. If a suitable
        lower value does not exist, FLLn_FRATIO should be increased to the nearest odd-number division
        instead.)
        After the value of FLLn_FRATIO has been determined, the input frequency, FREF, must be compared
        with the maximum frequency limit noted in Table 93. If the input frequency (after division by
        FLLn_REFCLK_DIV) is higher than the applicable limit, then the FLLn_REFCLK_DIV division ratio
        should be increased, and the value of N.K re-calculated. (Note that the same value of FLLn_FRATIO
        as already calculated should be used, when deriving the new value of N.K.)
                 FLLn_FRATIO            REFERENCE FREQUENCY
                                         FREF - MAXIMUM VALUE
            0h (divide by 1)                     13.5 MHz
            1h (divide by 2)                    6.144 MHz
            2h (divide by 3)
            3h (divide by 4)                    3.072 MHz
            4h (divide by 5)
            5h (divide by 6)                   2.8224 MHz
            6h (divide by 7)
            7h (divide by 8)                    1.536 MHz
            8h (divide by 9)
            9h (divide by 10)
            Ah (divide by 11)
            Bh (divide by 12)
            Ch (divide by 13)
            Dh (divide by 14)
            Eh (divide by 15)
            Fh (divide by 16)                     768 kHz
        Table 93 Maximum FLL input frequency (function of FLLn_FRATIO)
        The value of N is held in the FLLn_N register field.
        The value of K is determined by the FLLn_THETA and FLLn_LAMBDA fields, as described later.
        The FLLn_N, FLLn_THETA and FLLn_LAMBDA fields are all coded as integers (LSB = 1).
        If the FLLn_N or FLLn_THETA registers are updated while the FLL is enabled (FLLn_ENA=1), then
        the new values will only be effective when a ‘1’ is written to the FLLn_CTRL_UPD bit. This makes it
        possible to update the two registers simultaneously, without disabling the FLL.
        Note that, when the FLL is disabled (FLLn_ENA=0), then the FLLn_N and FLLn_THETA registers can
        be updated without writing to the FLLn_CTRL_UPD bit.
        The values of FLLn_THETA and FLLn_LAMBDA can be calculated as described later.
        A similar procedure applies for the deriviation of the FLL Synchroniser parameters - assuming that
        this function is used.
        The FLLn_SYNC_FRATIO field selects the frequency division ratio of the FLL synchroniser input. The
        FLLn_GAIN and FLLn_SYNC_DFSAT fields are used to optimise the FLL, according to the input
        frequency. These fields should be set as described in Table 94.
        Note that the FLLn_SYNC_FRATIO register coding is not the same as the FLLn_FRATIO register.
Rev 4.1                                                                                                  225


                                                                                  WM8998
           SYNCHRONISER              FLLn_SYNC_FRATIO           FLLn_SYNC_GAIN    FLLn_SYNC_DFSAT
          FREQUENCY FSYNC
       1MHz - 13.5MHz                  0h (divide by 1)           4h (16x gain)   0 (wide bandwidth)
       256kHz - 1MHz                   1h (divide by 2)            2h (4x gain)   0 (wide bandwidth)
       128kHz - 256kHz                 2h (divide by 4)            0h (1x gain)   0 (wide bandwidth)
       64kHz - 128kHz                  3h (divide by 8)            0h (1x gain)  1 (narrow bandwidth)
       Less than 64kHz                4h (divide by 16)            0h (1x gain)  1 (narrow bandwidth)
    Table 94 Selection of FLLn_SYNC_FRATIO, FLLn_SYNC_GAIN, FLLn_SYNC_DFSAT
    The FLL operating frequency, FVCO, is the same frequency calculated as described above.
    The value of N.K (Sync) can then be determined as follows:
               N.K (Sync) = FVCO / (FLLn_SYNC_FRATIO x FSYNC)
    Note that, in the above equations:
               FSYNC is the synchroniser input frequency, after division by FLLn_SYNCCLK_DIV, where
               applicable.
               FLLn_SYNC_FRATIO is the FVCO clock ratio (1, 2, 4, 8 or 16).
    The value of N (Sync) is held in the FLLn_SYNC_N register field.
    The value of K (Sync) is determined by the FLLn_SYNC_THETA and FLLn_SYNC_LAMBDA fields.
    The FLLn_SYNC_N, FLLn_SYNC_THETA and FLLn_SYNC_LAMBDA fields are all coded as
    integers (LSB = 1).
    In Fractional Mode, with the synchroniser disabled (K > 0, and FLLn_SYNC_ENA = 0), the register
    fields FLLn_THETA and FLLn_LAMBDA can be calculated as described below.
    The equivalent procedure is also used to derive the FLLn_SYNC_THETA and FLLn_SYNC_LAMBDA
    register values from the corresponding synchroniser parameters. (This is only required if the
    synchroniser is enabled.)
               Calculate GCD(FLL) using the ‘Greatest Common Denominator’ function:
               GCD(FLL) = GCD(FLLn_FRATIO x FREF, FVCO)
               where GCD(x, y) is the greatest common denominator of x and y
               FREF is the input frequency, after division by FLLn_REFCLK_DIV, where applicable.
               Next, calculate FLLn_THETA and FLLn_LAMBDA using the following equations:
               FLLn_THETA = (FVCO - (FLL_N x FLLn_FRATIO x FREF)) / GCD(FLL)
               FLLn_LAMBDA = (FLLn_FRATIO x FREF) / GCD(FLL)
    Note that, in the operating conditions described above, the values of FLLn_THETA and
    FLLn_LAMBDA must be co-prime (ie. not divisible by any common integer). The calculation above
    ensures that the values will be co-prime. The value of K must be a fraction less than 1 (ie.
    FLLn_THETA must be less than FLLn_LAMBDA).
    In Fractional Mode, with the synchroniser enabled (K > 0, and FLLn_SYNC_ENA = 1), the value of
    FLLn_THETA is calculated as described below. The value of FLLn_LAMBDA is ignored in this case.
               FLLn_THETA = K x 65536
226                                                                                           Rev 4.1


                                                                                       WM8998
        The FLL control registers are described in Table 95 and Table 96. Example settings for a variety of
        reference frequencies and output frequencies are shown in Table 99.
           REGISTER       BIT         LABEL         DEFAULT                     DESCRIPTION
           ADDRESS
          R369            0    FLL1_ENA                 0       FLL1 Enable
          (0171h)                                               0 = Disabled
          FLL1                                                  1 = Enabled
          Control 1                                             This should be set as the final step of the
                                                                FLL1 enable sequence, ie. after the other
                                                                FLL registers have been configured.
          R370           15    FLL1_CTRL_UP             0       FLL1 Control Update
          (0172h)              D                                Write ‘1’ to apply the FLL1_N and
          FLL1                                                  FLL1_THETA register settings.
          Control 2                                             (Only valid when FLL1_ENA=1)
                         9:0   FLL1_N [9:0]           008h      FLL1 Integer multiply for FREF
                                                                (LSB = 1)
                                                                If updated while the FLL is enabled, the
                                                                new value is only effective when a ‘1’ is
                                                                written to FLL1_CTRL_UPD.
          R371          15:0   FLL1_THETA            0018h      FLL1 Fractional multiply for FREF
          (0173h)              [15:0]                           This field sets the numerator (multiply)
          FLL1                                                  part of the FLL1_THETA / FLL1_LAMBDA
          Control 3                                             ratio.
                                                                Coded as LSB = 1.
                                                                If updated while the FLL is enabled, the
                                                                new value is only effective when a ‘1’ is
                                                                written to FLL1_CTRL_UPD.
          R372          15:0   FLL1_LAMBDA           007Dh      FLL1 Fractional multiply for FREF
          (0174h)              [15:0]                           This field sets the denominator (dividing)
          FLL1                                                  part of the FLL1_THETA / FLL1_LAMBDA
          Control 4                                             ratio.
                                                                Coded as LSB = 1.
          R373          11:8   FLL1_FRATIO              0h      FLL1 FVCO clock divider
          (0175h)              [3:0]                            0h = 1
          FLL1                                                  1h = 2
          Control 5                                             2h = 3
                                                                3h = 4
                                                                …
                                                                Fh = 16
                         3:1   FLL1_OUTDIV             010      FLL1 FOUT clock divider
                               [2:0]                            000 = Reserved
                                                                001 = Reserved
                                                                010 = Divide by 2
                                                                011 = Divide by 3
                                                                100 = Divide by 4
                                                                101 = Divide by 5
                                                                110 = Divide by 6
                                                                111 = Divide by 7
                                                                (FOUT = FVCO / FLL1_OUTDIV)
          R374           7:6   FLL1_REFCLK_             00      FLL1 Clock Reference Divider
          (0176h)              DIV [1:0]                        00 = 1
          FLL1                                                  01 = 2
          Control 6                                             10 = 4
                                                                11 = 8
                                                                MCLK (or other input reference) must be
                                                                divided down to <=13.5MHz.
                                                                For lower power operation, the reference
                                                                clock can be divided down further if
                                                                desired.
Rev 4.1                                                                                                   227


                                                                   WM8998
     REGISTER   BIT       LABEL     DEFAULT                 DESCRIPTION
     ADDRESS
               3:0  FLL1_REFCLK_S    0000   FLL1 Clock source
                    RC                      0000 = MCLK1
                                            0001 = MCLK2
                                            0011 = SLIMCLK
                                            0100 = FLL1
                                            0101 = FLL2
                                            1000 = AIF1BCLK
                                            1001 = AIF2BCLK
                                            1010 = AIF3BCLK
                                            1100 = AIF1LRCLK
                                            1101 = AIF2LRCLK
                                            1110 = AIF3LRCLK
                                            All other codes are Reserved
    R377       5:2  FLL1_GAIN [3:0]  0000   FLL1 Gain
    (0179h)                                 0000 = 1
    FLL1                                    0001 = 2
    Control 7                               0010 = 4
                                            0011 = 8
                                            0100 = 16
                                            0101 = 32
                                            0110 = 64
                                            0111 = 128
                                            1000 to 1111 = 256
    R385        0   FLL1_SYNC_EN       0    FLL1 Synchroniser Enable
    (0181h)         A                       0 = Disabled
    FLL1                                    1 = Enabled
    Synchroni                               This should be set as the final step of the
    ser 1                                   FLL1 synchroniser enable sequence, ie.
                                            after the other synchroniser registers have
                                            been configured.
    R386       9:0  FLL1_SYNC_N      000h   FLL1 Integer multiply for FSYNC
    (0182h)         [9:0]                   (LSB = 1)
    FLL1
    Synchroni
    ser 2
    R387      15:0  FLL1_SYNC_TH     0000h  FLL1 Fractional multiply for FSYNC
    (0183h)         ETA [15:0]              This field sets the numerator (multiply)
    FLL1                                    part of the FLL1_SYNC_THETA /
    Synchroni                               FLL1_SYNC_LAMBDA ratio.
    ser 3                                   Coded as LSB = 1.
    R388      15:0  FLL1_SYNC_LA     0000h  FLL1 Fractional multiply for FSYNC
    (0184h)         MBDA [15:0]             This field sets the denominator (dividing)
    FLL1                                    part of the FLL1_SYNC_THETA /
    Synchroni                               FLL1_SYNC_LAMBDA ratio.
    ser 4                                   Coded as LSB = 1.
    R389      10:8  FLL1_SYNC_FR      000   FLL1 Synchroniser FVCO clock divider
    (0185h)         ATIO [2:0]              000 = 1
    FLL1                                    001 = 2
    Synchroni                               010 = 4
    ser 5                                   011 = 8
                                            1XX = 16
228                                                                             Rev 4.1


                                                                          WM8998
          REGISTER     BIT         LABEL   DEFAULT                DESCRIPTION
          ADDRESS
         R390         7:6    FLL1_SYNCCLK    00    FLL1 Synchroniser Clock Reference
         (0186h)             _DIV [1:0]            Divider
         FLL1                                      00 = 1
         Synchroni                                 01 = 2
         ser 6                                     10 = 4
                                                   11 = 8
                                                   MCLK (or other input reference) must be
                                                   divided down to <=13.5MHz.
                                                   For lower power operation, the reference
                                                   clock can be divided down further if
                                                   desired.
                      3:0    FLL1_SYNCCLK   0000   FLL1 Synchroniser Clock source
                             _SRC                  0000 = MCLK1
                                                   0001 = MCLK2
                                                   0011 = SLIMCLK
                                                   0100 = FLL1
                                                   0101 = FLL2
                                                   1000 = AIF1BCLK
                                                   1001 = AIF2BCLK
                                                   1010 = AIF3BCLK
                                                   1100 = AIF1LRCLK
                                                   1101 = AIF2LRCLK
                                                   1110 = AIF3LRCLK
                                                   All other codes are Reserved
         R391         5:2    FLL1_SYNC_GAI  0000   FLL1 Synchroniser Gain
         (0187h)             N [3:0]               0000 = 1
         FLL1                                      0001 = 2
         Synchroni                                 0010 = 4
         ser 7                                     0011 = 8
                                                   0100 = 16
                                                   0101 = 32
                                                   0110 = 64
                                                   0111 = 128
                                                   1000 to 1111 = 256
                       0     FLL1_SYNC_DF    1     FLL1 Synchroniser Bandwidth
                             SAT                   0 = Wide bandwidth
                                                   1 = Narrow bandwidth
        Table 95 FLL1 Register Map
          REGISTER     BIT         LABEL   DEFAULT                DESCRIPTION
          ADDRESS
         R401          0     FLL2_ENA        0     FLL2 Enable
         (0191h)                                   0 = Disabled
         FLL2                                      1 = Enabled
         Control 1                                 This should be set as the final step of the
                                                   FLL2 enable sequence, ie. after the other
                                                   FLL registers have been configured.
         R402         15     FLL2_CTRL_UP    0     FLL2 Control Update
         (0192h)             D                     Write ‘1’ to apply the FLL2_N and
         FLL2                                      FLL2_THETA register settings.
         Control 2                                 (Only valid when FLL2_ENA=1)
                      9:0    FLL2_N [9:0]   008h   FLL2 Integer multiply for FREF
                                                   (LSB = 1)
                                                   If updated while the FLL is enabled, the
                                                   new value is only effective when a ‘1’ is
                                                   written to FLL2_CTRL_UPD.
Rev 4.1                                                                                      229


                                                                 WM8998
     REGISTER   BIT        LABEL  DEFAULT                 DESCRIPTION
     ADDRESS
    R403      15:0  FLL2_THETA     0018h  FLL2 Fractional multiply for FREF
    (0193h)         [15:0]                This field sets the numerator (multiply)
    FLL2                                  part of the FLL2_THETA / FLL2_LAMBDA
    Control 3                             ratio.
                                          Coded as LSB = 1.
                                          If updated while the FLL is enabled, the
                                          new value is only effective when a ‘1’ is
                                          written to FLL2_CTRL_UPD.
    R404      15:0  FLL2_LAMBDA    007Dh  FLL2 Fractional multiply for FREF
    (0194h)         [15:0]                This field sets the denominator (dividing)
    FLL2                                  part of the FLL2_THETA / FLL2_LAMBDA
    Control 4                             ratio.
                                          Coded as LSB = 1.
    R405      11:8  FLL2_FRATIO       0h  FLL2 FVCO clock divider
    (0195h)         [3:0]                 0h = 1
    FLL2                                  1h = 2
    Control 5                             2h = 3
                                          3h = 4
                                          …
                                          Fh = 16
               3:1  FLL2_OUTDIV      010  FLL2 FOUT clock divider
                    [2:0]                 000 = Reserved
                                          001 = Reserved
                                          010 = Divide by 2
                                          011 = Divide by 3
                                          100 = Divide by 4
                                          101 = Divide by 5
                                          110 = Divide by 6
                                          111 = Divide by 7
                                          (FOUT = FVCO / FLL2_OUTDIV)
    R406       7:6  FLL2_REFCLK_      00  FLL2 Clock Reference Divider
    (0196h)         DIV [1:0]             00 = 1
    FLL2                                  01 = 2
    Control 6                             10 = 4
                                          11 = 8
                                          MCLK (or other input reference) must be
                                          divided down to <=13.5MHz.
                                          For lower power operation, the reference
                                          clock can be divided down further if
                                          desired.
               3:0  FLL2_REFCLK_S   0000  FLL2 Clock source
                    RC                    0000 = MCLK1
                                          0001 = MCLK2
                                          0011 = SLIMCLK
                                          0100 = FLL1
                                          0101 = FLL2
                                          1000 = AIF1BCLK
                                          1001 = AIF2BCLK
                                          1010 = AIF3BCLK
                                          1100 = AIF1LRCLK
                                          1101 = AIF2LRCLK
                                          1110 = AIF3LRCLK
                                          All other codes are Reserved
230                                                                          Rev 4.1


                                                                       WM8998
         REGISTER   BIT       LABEL     DEFAULT                 DESCRIPTION
         ADDRESS
        R409       5:2  FLL2_GAIN [3:0]  0000   FLL2 Gain
        (0199h)                                 0000 = 1
        FLL2                                    0001 = 2
        Control 7                               0010 = 4
                                                0011 = 8
                                                0100 = 16
                                                0101 = 32
                                                0110 = 64
                                                0111 = 128
                                                1000 to 1111 = 256
        R417        0   FLL2_SYNC_EN       0    FLL2 Synchroniser Enable
        (01A1h)         A                       0 = Disabled
        FLL2                                    1 = Enabled
        Synchroni                               This should be set as the final step of the
        ser 1                                   FLL2 synchroniser enable sequence, ie.
                                                after the other synchroniser registers have
                                                been configured.
        R418       9:0  FLL2_SYNC_N      000h   FLL2 Integer multiply for FSYNC
        (01A2h)         [9:0]                   (LSB = 1)
        FLL2
        Synchroni
        ser 2
        R419      15:0  FLL2_SYNC_TH     0000h  FLL2 Fractional multiply for FSYNC
        (01A3h)         ETA [15:0]              This field sets the numerator (multiply)
        FLL2                                    part of the FLL2_SYNC_THETA /
        Synchroni                               FLL2_SYNC_LAMBDA ratio.
        ser 3                                   Coded as LSB = 1.
        R420      15:0  FLL2_SYNC_LA     0000h  FLL2 Fractional multiply for FSYNC
        (01A4h)         MBDA [15:0]             This field sets the denominator (dividing)
        FLL2                                    part of the FLL2_SYNC_THETA /
        Synchroni                               FLL2_SYNC_LAMBDA ratio.
        ser 4                                   Coded as LSB = 1.
        R421      10:8  FLL2_SYNC_FR      000   FLL2 Synchroniser FVCO clock divider
        (01A5h)         ATIO [2:0]              000 = 1
        FLL2                                    001 = 2
        Synchroni                               010 = 4
        ser 5                                   011 = 8
                                                1XX = 16
        R422       7:6  FLL2_SYNCCLK       00   FLL2 Synchroniser Clock Reference
        (01A6h)         _DIV [1:0]              Divider
        FLL2                                    00 = 1
        Synchroni                               01 = 2
        ser 6                                   10 = 4
                                                11 = 8
                                                MCLK (or other input reference) must be
                                                divided down to <=13.5MHz.
                                                For lower power operation, the reference
                                                clock can be divided down further if
                                                desired.
Rev 4.1                                                                                   231


                                                                                       WM8998
        REGISTER       BIT           LABEL          DEFAULT                      DESCRIPTION
        ADDRESS
                      3:0      FLL2_SYNCCLK          0000         FLL2 Synchroniser Clock source
                               _SRC                               0000 = MCLK1
                                                                  0001 = MCLK2
                                                                  0011 = SLIMCLK
                                                                  0100 = FLL1
                                                                  0101 = FLL2
                                                                  1000 = AIF1BCLK
                                                                  1001 = AIF2BCLK
                                                                  1010 = AIF3BCLK
                                                                  1100 = AIF1LRCLK
                                                                  1101 = AIF2LRCLK
                                                                  1110 = AIF3LRCLK
                                                                  All other codes are Reserved
       R423           5:2      FLL2_SYNC_GAI         0000         FLL2 Synchroniser Gain
       (01A7h)                 N [3:0]                            0000 = 1
       FLL2                                                       0001 = 2
       Synchroni                                                  0010 = 4
       ser 7                                                      0011 = 8
                                                                  0100 = 16
                                                                  0101 = 32
                                                                  0110 = 64
                                                                  0111 = 128
                                                                  1000 to 1111 = 256
                       0       FLL2_SYNC_DF            1          FLL2 Synchroniser Bandwidth
                               SAT                                0 = Wide bandwidth
                                                                  1 = Narrow bandwidth
    Table 96 FLL2 Register Map
    FREE-RUNNING FLL MODE
    The FLL can generate a clock signal even when no external reference is available. This may be
    because the normal input reference has been interrupted, or may be during a standby or start-up
    period when no initial reference clock is available.
    Free-running FLL mode is enabled using the FLLn_FREERUN register. (Note that FLLn_ENA must
    also be enabled in Free-running FLL mode.)
    In Free-running FLL mode, the normal feedback mechanism of the FLL is halted, and the FLL
    oscillates independently of the external input reference(s).
    If the FLL was previously operating normally, (with an input reference clock), then the FLL output
    frequency will remain unchanged when Free-running FLL mode is enabled. The FLL output will be
    independent of the input reference while operating in free-running mode with FLLn_FREERUN=1.
    The main FLL loop will always continue to free-run if the input reference clock is stopped (regardless
    of the FLLn_FREERUN setting). If FLLn_FREERUN=0, the FLL will re-lock to the input reference
    whenever it is available.
    In free-running mode, (with FLLn_FREERUN=1), the FLL integrator value (part of the feedback
    mechanism) can be commanded directly using the FLLn_FRC_INTEG_VAL register. The integrator
    value in this register is applied to the FLL when a ‘1’ is written to the FLLn_FRC_INTEG_UPD bit.
    If the FLL is started up in free-running mode, (ie. it was not previously running), then the default value
    of FLLn_FRC_INTEG_VAL will be applied.
    The FLL integrator value (part of the feedback mechanism) can be read from the FLLn_INTEG
    register; the value of this field may be stored for later use. Note that the readback value of the
    FLLn_INTEG register is only valid when FLLn_FREERUN=1, and the FLLn_INTEG_VALID bit is set.
    The FLL integrator setting does not ensure a specific output frequency for the FLL across all devices
    and operating conditions; some level of variation will apply.
    The free-running FLL clock may be selected as the SYSCLK source or ASYNCCLK source as shown
    Figure 64.
232                                                                                                 Rev 4.1


                                                                                        WM8998
        The control registers applicable to Free-running FLL mode are described in Table 97.
          REGISTER        BIT          LABEL          DEFAULT                    DESCRIPTION
          ADDRESS
         R369             1     FLL1_FREERUN              1      FLL1 Free-Running Mode Enable
         (0171h)                                                 0 = Disabled
         FLL1                                                    1 = Enabled
         Control 1                                               The FLL feedback mechanism is halted in
                                                                 Free-Running mode, and the latest
                                                                 integrator setting is maintained
         R375            15     FLL1_FRC_INTE             0      Write ‘1’ to apply the
         (0177h)                G_UPD                            FLL1_FRC_INTEG_VAL setting.
         FLL1 Loop                                               (Only valid when FLL1_FREERUN=1)
         Filter Test    11:0    FLL1_FRC_INTE           181h     FLL1 Forced Integrator Value
         1                      G_VAL [11:0]
         R376            15     FLL1_INTEG_VA             0      FLL1 Integrator Valid
         (0178h)                LID                              Indicates if the FLL1_INTEG register is
         FLL1 NCO                                                valid
         Test 0                                                  0 = Not valid
                                                                 1 = Valid
                        11:0    FLL1_INTEG              000h     FLL1 Integrator Value (Read-only)
                                [11:0]                           Indicates the current FLL1 integrator
                                                                 setting. Only valid when
                                                                 FLL1_INTEG_VALID = 1.
         R401             1     FLL2_FREERUN              0      FLL2 Free-Running Mode Enable
         (0191h)                                                 0 = Disabled
         FLL2                                                    1 = Enabled
         Control 1                                               The FLL feedback mechanism is halted in
                                                                 Free-Running mode, and the latest
                                                                 integrator setting is maintained
         R407            15     FLL2_FRC_INTE             0      Write ‘1’ to apply the
         (0197h)                G_UPD                            FLL2_FRC_INTEG_VAL setting.
         FLL2 Loop                                               (Only valid when FLL2_FREERUN=1)
         Filter Test    11:0    FLL2_FRC_INTE           000h     FLL2 Forced Integrator Value
         1                      G_VAL [11:0]
         R408            15     FLL2_INTEG_VA             0      FLL2 Integrator Valid
         (0198h)                LID                              Indicates if the FLL2_INTEG register is
         FLL2 NCO                                                valid
         Test 0                                                  0 = Not valid
                                                                 1 = Valid
                        11:0    FLL2_INTEG              000h     FLL2 Integrator Value
                                [11:0]                           (Read-only)
                                                                 Indicates the current FLL2 integrator
                                                                 setting. Only valid when
                                                                 FLL2_INTEG_VALID = 1.
        Table 97 Free-Running FLL Mode Control
Rev 4.1                                                                                                  233


                                                                                       WM8998
    SPREAD SPECTRUM FLL CONTROL
    The WM8998 can apply modulation to the FLL outputs, using spread spectrum techniques. This can
    be used to control the EMI characteristics of the circuits that are clocked via the FLLs.
    Each of the FLLs can be individually configured for Triangle modulation, Zero Mean Frequency
    Modulation (ZMFM) or Dither. The amplitude and frequency parameters of the spread spectrum
    functions is also programmable, using the registers described in Table 98.
       REGISTER        BIT        LABEL            DEFAULT                      DESCRIPTION
       ADDRESS
      R393            5:4   FLL1_SS_AMPL              00         FLL1 Spread Spectrum Amplitude
      (0189h)               [1:0]                                Controls the extent of the spread-
      FLL1                                                       spectrum modulation.
      Spread                                                     00 = 0.7% (triangle), 0.7% (ZMFM, dither)
      Spectrum                                                   01 = 1.1% (triangle), 1.3% (ZMFM, dither)
                                                                 10 = 2.3% (triangle), 2.6% (ZMFM, dither)
                                                                 11 = 4.6% (triangle), 5.2% (ZMFM, dither)
                      3:2   FLL1_SS_FREQ              00         FLL1 Spread Spectrum Frequency
                            [1:0]                                Controls the spread spectrum modulation
                                                                 frequency in Triangle mode.
                                                                 00 = 439kHz
                                                                 01 = 878kHz
                                                                 10 = 1.17MHz
                                                                 11 = 1.76MHz
                      1:0   FLL1_SS_SEL               00         FLL1 Spread Spectrum Select
                            [1:0]                                00 = Disabled
                                                                 01 = Zero Mean Frequency (ZMFM)
                                                                 10 = Triangle
                                                                 11 = Dither
      R425            5:4   FLL2_SS_AMPL              00         FLL2 Spread Spectrum Amplitude
      (01A9h)               [1:0]                                Controls the extent of the spread-
      FLL2                                                       spectrum modulation.
      Spread                                                     00 = 0.7% (triangle), 0.7% (ZMFM, dither)
      Spectrum                                                   01 = 1.1% (triangle), 1.3% (ZMFM, dither)
                                                                 10 = 2.3% (triangle), 2.6% (ZMFM, dither)
                                                                 11 = 4.6% (triangle), 5.2% (ZMFM, dither)
                      3:2   FLL2_SS_FREQ              00         FLL2 Spread Spectrum Frequency
                            [1:0]                                Controls the spread spectrum modulation
                                                                 frequency in Triangle mode.
                                                                 00 = 439kHz
                                                                 01 = 878kHz
                                                                 10 = 1.17MHz
                                                                 11 = 1.76MHz
                      1:0   FLL2_SS_SEL               00         FLL2 Spread Spectrum Select
                            [1:0]                                00 = Disabled
                                                                 01 = Zero Mean Frequency (ZMFM)
                                                                 10 = Triangle
                                                                 11 = Dither
    Table 98 FLL Spread Spectrum Control
234                                                                                                 Rev 4.1


                                                                                           WM8998
        FLL INTERRUPTS AND GPIO OUTPUT
        For each FLL, the WM8998 supports an ‘FLL Clock OK’ signal which, when asserted, indicates that
        the FLL has started up and is providing an output clock. Each FLL also supports an ‘FLL Lock’ signal
        which indicates whether FLL Lock has been achieved.
        The FLL Clock OK status and FLL Lock status are inputs to the Interrupt control circuit and can be
        used to trigger an Interrupt event - see “Interrupts”. Note that these Interrupt signals are de-bounced,
        and require clocking to be present in order to assert the respective Interrupt; either the 32kHz clock,
        or the SYSCLK signal, must be enabled to trigger an Interrupt from the FLL signals.
        The FLL Clock OK and FLL Lock signals can be output directly on a GPIO pin as an external
        indication of the FLL status. See “General Purpose Input / Output” to configure a GPIO pin for these
        functions. (These GPIO outputs are not de-bounced, and do not require clocking to be present.)
        Clock output signals derived from the FLL can be output on a GPIO pin. See “General Purpose Input /
        Output” to configure a GPIO pin for this function.
        The FLL clocking configuration is illustrated in Figure 66.
        EXAMPLE FLL CALCULATION
        The following example illustrates how to derive the FLL1 registers to generate 49.152 MHz output
        (FOUT) from a 12.000 MHz reference clock (FREF). Note that, for this calculation, it is assumed that the
        synchroniser is disabled.
                  Set FLL1_REFCLK_DIV in order to generate FREF <=13.5MHz:
                   FLL1_REFCLK_DIV = 00 (divide by 1)
                  Set FLL1_OUTDIV for the required output frequency as shown in Table 91:-
                   FOUT = 49.152 MHz, therefore FLL1_OUTDIV = 2h (divide by 2)
                  Set FLL1_FRATIO for the given reference frequency as shown in Table 92:
                   FREF = 12MHz, therefore FLL1_FRATIO = 0h (divide by 1)
                  Calculate FVCO as given by FVCO = FOUT x FLL1_OUTDIV:-
                   FVCO = 49.152 x 2 = 98.304MHz
                  Calculate N.K as given by N.K = FVCO / (FLL1_FRATIO x FREF):
                   N.K = 98.304 / (1 x 12) = 8.192
                  Determine FLL1_N from the integer portion of N.K:-
                   FLL1_N = 8 (008h)
                  Determine GCD(FLL), as given by GCD(FLL) = GCD(FLL1_FRATIO x FREF, FVCO):
                   GCD(FLL) = GCD(1 x 12000000, 98304000) = 96000
                  Determine FLL1_THETA, as given by
                   FLL1_THETA = (FVCO - (FLL1_N x FLL1_FRATIO x FREF)) / GCD(FLL):
                   FLL1_THETA = (98304000 - (8 x 1 x 12000000)) / 96000
                   FLL1_THETA = 24 (0018h)
                  Determine FLL_LAMBDA, as given by
                   FLL1_LAMBDA = (FLL1_FRATIO x FREF) / GCD(FLL):
                   FLL1_LAMBDA = (1 x 12000000) / 96000
                   FLL1_LAMBDA = 125 (007Dh)
Rev 4.1                                                                                                     235


                                                                                                            WM8998
                              EXAMPLE FLL SETTINGS
                              Table 99 provides example FLL settings for generating 49.152MHz SYSCLK from a variety of low and
                              high frequency reference inputs. Note that, in these examples, it is assumed that the synchroniser is
                              disabled.
 FLL (Main Loop) Settings
     FSOURCE       FOUT (MHz)       FREF        N.K     FRATIO         FVCO       OUTDIV      FLLn_N        FLLn_         FLLn_
                                   Divider                            (MHz)                                 THETA       LAMBDA
 32.000 kHz        49.152             1        204.8      15         98.304          2          0CCh        0004h         0005h
 32.768 kHz        49.152             1        187.5      16         98.304          2          0BBh        0001h         0002h
 48 kHz            49.152             1     136.5333      15         98.304          2           088h       0008h         000Fh
 128 kHz           49.152             1     109.7143      7          98.304          2          06Dh        0005h         0007h
 512 kHz           49.152             1         38.4      5          98.304          2           026h       0002h         0005h
 1.536 MHz         49.152             1      21.3333      3          98.304          2           015h       0001h         0003h
 3.072 MHz         49.152             1      10.6667      3          98.304          2          00Ah        0002h         0003h
 11.2896 MHz       49.152             1       8.7075      1          98.304          2           008h       0068h         0093h
 12.000 MHz        49.152             1        8.192      1          98.304          2           008h       0018h         007Dh
 12.288 MHz        49.152             2       5.3333      3          98.304          2           005h       0001h         0003h
 13.000 MHz        49.152             1       7.5618      1          98.304          2           007h       0391h         0659h
 19.200 MHz        49.152             2        10.24      1          98.304          2          00Ah        0006h         0019h
 24 MHz            49.152             2        8.192      1          98.304          2           008h       0018h         007Dh
 26 MHz            49.152             2       7.5618      1          98.304          2           007h       0391h         0659h
 27 MHz            49.152             2       7.2818      1          98.304          2           007h       013Dh         0465h
 FOUT = (FSOURCE / FREF Divider) * N.K * FRATIO / OUTDIV
 The values of N and K are contained in the FLLn_N, FLLn_THETA and FLLn_LAMBDA registers as shown above.
 See Table 95 and Table 96 for the coding of the FLLn_REFCLK_DIV, FLLn_FRATIO and FLLn_OUTDIV registers.
Table 99 Example FLL Settings – Synchroniser Disabled
                              Table 100 provides example FLL settings for generating 49.152MHz SYSCLK, with the synchroniser
                              enabled. The main loop and the synchroniser loop must each be configured according to the
                              respective input source.
236                                                                                                                      Rev 4.1


                                                                                                               WM8998
 FLL (Main Loop) Settings
     FSOURCE       FOUT (MHz)        FREF        N.K     FRATIO           FVCO      OUTDIV     FLLn_N          FLLn_     FLLn_
                                   Divider                               (MHz)                                 THETA    LAMBDA
 32.000 kHz        49.152             1         204.8       15          98.304         2        0CCh          CCCCh      0000h
 32.768 kHz        49.152             1         187.5       16          98.304         2         0BBh          8000h     0000h
 48 kHz            49.152             1       136.5333      15          98.304         2         088h          8888h     0000h
 128 kHz           49.152             1       109.7143       7          98.304         2         06Dh          B6DBh     0000h
 512 kHz           49.152             1          38.4        5          98.304         2         026h          6666h     0000h
 1.536 MHz         49.152             1        21.3333       3          98.304         2         015h          5555h     0000h
 3.072 MHz         49.152             1        10.6667       3          98.304         2         00Ah          AAAAh     0000h
 11.2896 MHz       49.152             1        8.7075        1          98.304         2         008h          B51Dh     0000h
 12.000 MHz        49.152             1         8.192        1          98.304         2         008h          3126h     0000h
 12.288 MHz        49.152             2        5.3333        3          98.304         2         005h          5555h     0000h
 13.000 MHz        49.152             1        7.5618        1          98.304         2         007h          8FD5h     0000h
 19.200 MHz        49.152             2         10.24        1          98.304         2         00Ah          3D70h     0000h
 24 MHz            49.152             2         8.192        1          98.304         2         008h          3126h     0000h
 26 MHz            49.152             2        7.5618        1          98.304         2         007h          8FD5h     0000h
 27 MHz            49.152             2        7.2818        1          98.304         2         007h          4822h     0000h
 FLL (Synchroniser Loop) Settings
     FSOURCE       FOUT (MHz)       FSYNC        N.K     FRATIO           FVCO      OUTDIV      FLLn_          FLLn_     FLLn_
                                   Divider     (SYNC)     (SYNC)         (MHz)                 SYNC_N          SYNC_     SYNC_
                                                                                                               THETA    LAMBDA
 32.000 kHz        49.152             1          192        16          98.304         2         0C0h          0000h     0000h
 32.768 kHz        49.152             1         187.5       16          98.304         2         0BBh          0001h     0002h
 48 kHz            49.152             1          128        16          98.304         2         080h          0000h     0000h
 128 kHz           49.152             1           96         8          98.304         2         060h          0000h     0000h
 512 kHz           49.152             1           96         2          98.304         2         060h          0000h     0000h
 1.536 MHz         49.152             1           64         1          98.304         2         040h          0000h     0000h
 3.072 MHz         49.152             1           32         1          98.304         2         020h          0000h     0000h
 11.2896 MHz       49.152             1        8.7075        1          98.304         2         008h          0068h     0093h
 12.000 MHz        49.152             1         8.192        1          98.304         2         008h          0018h     007Dh
 12.288 MHz        49.152             1            8         1          98.304         2         008h          0000h     0000h
 13.000 MHz        49.152             1        7.5618        1          98.304         2         007h          0391h     0659h
 19.200 MHz        49.152             2         10.24        1          98.304         2         00Ah          0006h     0019h
 24 MHz            49.152             2         8.192        1          98.304         2         008h          0018h     007Dh
 26 MHz            49.152             2        7.5618        1          98.304         2         007h          0391h     0659h
 27 MHz            49.152             2        7.2818        1          98.304         2         007h          013Dh     0465h
 FOUT = (FSOURCE / FREF Divider) * 3 * N.K * FRATIO / OUTDIV
 The values of N and K are contained in the FLLn_N, FLLn_THETA and FLLn_LAMBDA registers. See Table 95 and Table 96 for
 the coding of the FLL configuration registers. Note that the register coding of FLLn_FRATIO is different to FLLn_SYNC_FRATIO.
Table 100 Example FLL Settings – Synchroniser Enabled
Rev 4.1                                                                                                                     237


                                                                                                    WM8998
CONTROL INTERFACE
               The WM8998 is controlled by writing to its control registers. Readback is available for all registers.
               Note that the SLIMbus interface also supports read/write access to the WM8998 control registers -
               see “SLIMbus Interface Control”.
               Note that the Control Interface function can be supported with or without system clocking. Where
               applicable, the register map access is synchronised with SYSCLK in order to ensure predictable
               operation of cross-domain functions. See “Clocking and Sample Rates” for further details of Control
               Interface clocking.
               When SYSCLK is present and enabled, register access is possible on all of the Control Interfaces
               (including SLIMbus) simultaneously.
               When SYSCLK is disabled, then register access will only be supported on whichever interface (I2C or
               SLIMbus) is the first to attempt any register access after SYSCLK has stopped. Full access via all
               interfaces will be restored when SYSCLK is enabled.
               The WM8998 executes a Boot Sequence following Power-On Reset (POR), Hardware Reset,
               Software Reset or Wake-Up (from Sleep mode). A further sequence of device initialisation writes must
               then be executed by the host application. Note that Control Register writes should not be attempted
               until the Boot Sequence has completed. The host system should ensure that the WM8998 is ready
               before attempting the initialisation sequence (or any other) Control Register writes. See “Power-On
               Reset (POR)” and “Hardware Reset, Software Reset, Wake-Up, and Device ID” for further details.
               The WM8998 performs automatic checks to confirm that the control interface does not attempt a Read
               or Write operation to an invalid register address. The Control Interface Address Error condition can be
               monitored using the GPIO and/or Interrupt functions. See “General Purpose Input / Output” and
               “Interrupts” for further details.
               The Control Interface is a 2-wire (I2C) interface, comprising the following pins:
                         SDA - serial interface data input/output
                         SCLK - serial interface clock input
                         ADDR - logic level controlling the I2C device ID
               The Control Interface configuration registers are described in Table 101.
                   REGISTER        BIT           LABEL         DEFAULT                    DESCRIPTION
                   ADDRESS
                  R9 (09h)        1:0     I2C1_AUTO_IN            01       I2C Address auto-increment select
                  Ctrl IF                 C [1:0]                          00 = Disabled
                  I2C1 CFG                                                 01 = Increment by 1 on each access
                  1                                                        10 = Increment by 2 on each access
                                                                           11 = Increment by 3 on each access
                  R11 (0Bh)       6:0     I2C1_DEV_ID            1Ah       I2C Device ID
                  Ctrl IF                 [6:0]                            (Read Only)
                  I2C1 CFG                                                 Note that this 7-bit field identifies bits [7:1]
                  2                                                        of the I2C device ID. The read/write bit is
                                                                           appended to these 7 bits.
                  R3105             0     ADDR_PD                  1       ADDR Pull-down enable
                  (0C21h)                                                  0 = Disabled
                  Misc Pad                                                 1 = Enabled
                  Ctrl 2
               Table 101 Control Interface Configuration
238                                                                                                               Rev 4.1


                                                                                                                                                           WM8998
                                  The WM8998 is a slave device on the control interface; SCLK is a clock input, while SDA is a bi-
                                  directional data pin. To allow arbitration of multiple slaves (and/or multiple masters) on the same
                                  interface, the WM8998 transmits logic 1 by tri-stating the SDA pin, rather than pulling it high. An
                                  external pull-up resistor is required to pull the SDA line high so that the logic 1 can be recognised by
                                  the master.
                                  In order to allow many devices to share a single 2-wire control bus, every device on the bus has a
                                  unique 8-bit device ID (this is not the same as the address of each register in the WM8998).
                                  The device ID is selectable using the ADDR pin, as described in Table 102. The LSB of the Device ID
                                  is the Read/Write bit; this bit is set to logic 1 for “Read” and logic 0 for “Write”.
                                  The ADDR logic level is referenced to the DBVDD1 power domain. An internal pull-down resistor is
                                  enabled by default on the ADDR pin; this can be configured using the ADDR_PD register bit
                                  described in Table 101.
                                              ADDR                                          DEVICE ID
                                           Logic 0                    0011 010x = 34h (write) / 35h (read)
                                           Logic 1                    0011 011x = 36h (write) / 37h (read)
                                  Table 102 Control Interface Device ID Selection
                                  The WM8998 operates as a slave device only. The controller indicates the start of data transfer with a
                                  high to low transition on SDA while SCLK remains high. This indicates that a device ID, and
                                  subsequent address/data byte(s) will follow. The WM8998 responds to the start condition and shifts in
                                  the next eight bits on SDA (8-bit device ID, including Read/Write bit, MSB first). If the device ID
                                  received matches the device ID of the WM8998, then the WM8998 responds by pulling SDA low on
                                  the next clock pulse (ACK). If the device ID is not recognised or the R/W bit is set incorrectly, the
                                  WM8998 returns to the idle condition and waits for a new start condition and valid address.
                                  If the device ID matches the device ID of the WM8998, the data transfer continues as described
                                  below. The controller indicates the end of data transfer with a low to high transition on SDA while
                                  SCLK remains high. After receiving a complete address and data sequence the WM8998 returns to
                                  the idle state and waits for another start condition. If a start or stop condition is detected out of
                                  sequence at any point during data transfer (i.e. SDA changes while SCLK is high), the device returns
                                  to the idle condition.
                                  The WM8998 supports the following read and write operations:
                                                 Single write
                                                 Single read
                                                 Multiple write (with optional auto-increment)
                                                 Multiple read (with optional auto-increment)
                                  The sequence of signals associated with a single register write operation is illustrated in Figure 67.
  SCLK
  SDA        D7        D1  R/W         A31             A25    A24      A23             A17    A16         A15              A9     A8        A7
       START    device ID (Write) ACK  register address A31 – A24 ACK  register address A23 – A16  ACK     register address A15 – A8 ACK
                                                                                       A1      A0         B15              B9     B8        B7             B1    B0
                                                                        register address A7 – A0   ACK         data bits B15 – B8    ACK       data bits B7 – B0     ACK     STOP
                                                                                                  Note: The SDA pin is used as input for the control register address and data; SDA is
                                                                                                       pulled low by the receiving device to provide the acknowledge (ACK) response
Figure 67 Control Interface 2-wire (I2C) Register Write
Rev 4.1                                                                                                                                                                           239


                                                                                                                                                                            WM8998
                                           The sequence of signals associated with a single register read operation is illustrated in Figure 68.
  SCLK
  SDA          D7           D1     R/W             A31             A25    A24          A23             A17    A16          A15              A9     A8          A7
       START         device ID    (Write)  ACK     register address A31 – A24          register address A23 – A16    ACK    register address A15 – A8   ACK
                                                    A1      A0                      D7              D1     R/W          B15             B9     B8           B7              B1     B0
                                                                               Rpt                                          data bits B15 – B8                  data bits B7 – B0
                                     register address A7 – A0      ACK
                                                                             START          device ID    (Read)   ACK                                 ACK                             ACK   STOP
                                          Note: The SDA pin is driven by both the master and slave devices in turn to transfer device address, register address, data and ACK responses
Figure 68 Control Interface 2-wire (I2C) Register Read
                                           The Control Interface also supports other register operations, as listed above. The interface protocol
                                           for these operations is summarised below. The terminology used in the following figures is detailed in
                                           Table 103.
                                           Note that, for multiple write and multiple read operations, the auto-increment option may be enabled.
                                           The I2C multiple transfers illustrated below assume that “auto-increment by 1” is selected in each
                                           case. Auto-increment is enabled by default, as noted in Table 101.
                                                      TERMINOLOGY                                                            DESCRIPTION
                                                                  S                                                         Start Condition
                                                                 Sr                                                         Repeated start
                                                                  A                                                   Acknowledge (SDA Low)
                                                                 ¯¯
                                                                  A                                               Not Acknowledge (SDA High)
                                                                  P                                                         Stop Condition
                                                               R/W̄¯                                  ReadNotWrite                                       0 = Write
                                                                                                                                                        1 = Read
                                                         [White field]                                    Data flow from bus master to WM8998
                                                          [Grey field]                                    Data flow from WM8998 to bus master
                                           Table 103 Control Interface (I2C) Terminology
           8 bit Device ID                            8 bits                              8 bits                                8 bits                              8 bits
    S        Device ID        RW    A          Address Byte [3]             A      Address Byte [2]              A       Address Byte [1]             A   Address Byte [0]
                               (0)            (Most Significant Byte)                                                                                       (Least Significant Byte)
                                                                                                                                        8 bits                              8 bits
                                                                                                                       A         MSByte Data               A          LSByte Data         A   P
Figure 69 Single Register Write to Specified Address
    S        Device ID        RW    A          Address Byte [3]             A      Address Byte [2]              A       Address Byte [1]             A   Address Byte [0]
                               (0)            (Most Significant Byte)                                                                                       (Least Significant Byte)
                                                                              A Sr             Device ID          RW   A         MSByte Data               A          LSByte Data         A   P
                                                                                                                  (1)
Figure 70 Single Register Read from Specified Address
240                                                                                                                                                                                       Rev 4.1


                                                                                                                               WM8998
   S      Device ID  RW  A    Address Byte [3]       A     Address Byte [2]     A      Address Byte [1]        A   Address Byte [0]
                     (0)
                                Written to 'Register Address'                           Written to 'Register Address+1'
                    A     MSByte Data 0        A       LSByte Data 0      A      MSByte Data 1          A        LSByte Data 1      A
                                         Written to 'Register Address+N-1'                          Written to 'Register Address+N'
                             A    MSByte Data N-1         A     LSByte Data N-1      A       MSByte Data N         A       LSByte Data N   A P
Figure 71 Multiple Register Write to Specified Address using Auto-increment
   S      Device ID  RW  A    Address Byte [3]       A     Address Byte [2]     A      Address Byte [1]        A   Address Byte [0]
                     (0)
                                                                 Read from 'Register Address'
                    A Sr        Device ID     RW   A      MSByte Data 0       A       LSByte Data 0          A
                                              (1)
                                        Read from 'Register Address+N-1'                           Read from 'Register Address+N'
                             A    MSByte Data N-1         A     LSByte Data N-1      A       MSByte Data N         A       LSByte Data N   A P
Figure 72 Multiple Register Read from Specified Address using Auto-increment
                                   Read from 'Last Register Address'                          Read from 'Register Address+1'
   S      Device ID  RW  A     MSByte Data 0         A      LSByte Data 0       A      MSByte Data 1           A      LSByte Data 1      A
                     (1)
                                        Read from 'Register Address+N-1'                           Read from 'Register Address+N'
                             A    MSByte Data N-1         A     LSByte Data N-1      A       MSByte Data N         A       LSByte Data N   A P
Figure 73 Multiple Register Read from Last Address using Auto-increment
                            Continuous read and write modes enable multiple register operations to be scheduled faster than is
                            possible with single register operations. The auto-increment function supports selectable address
                            increments for each successive register access. This function is controlled using the I2C1_AUTO_INC
                            register. Auto-increment (by 1) is enabled by default, as described in Table 101.
Rev 4.1                                                                                                                                        241


                                                                                                    WM8998
CONTROL WRITE SEQUENCER
               The Control Write Sequencer is a programmable unit that forms part of the WM8998 control interface
               logic. It provides the ability to perform a sequence of register write operations with the minimum of
               demands on the host processor - the sequence may be initiated by a single operation from the host
               processor and then left to execute independently.
               Default sequences for pop-suppressed start-up and shut-down of each headphone/earpiece output
               driver are provided (these are scheduled automatically when the respective output paths are enabled
               or disabled). Other control sequences can be programmed, and may be associated with Jack Detect,
               MICDET Clamp, Wake-Up or Sample Rate Detection functions - these sequences are automatically
               scheduled whenever a corresponding event is detected.
               When a sequence is initiated, the sequencer performs a series of pre-defined register writes. The
               ‘start index’ of a control sequence within the sequencer’s memory may be commanded directly by the
               host processor. In the case of an output path enable/disable event, or sequences associated with
               Jack Detect, Wake-Up or Sample Rate Detection, the applicable ‘start index’ is held in a user-
               programmed control register for each sequence.
               The Control Write Sequencer may be triggered in a number of ways, as described above. Multiple
               sequences will be queued if necessary, and each is scheduled in turn. When all of the queued
               sequences have completed, the sequencer stops, and an Interrupt status flag is asserted.
               A valid clock (SYSCLK) must be enabled whenever a Control Write Sequence is scheduled. See
               “Clocking and Sample Rates” for further details.
               INITIATING A SEQUENCE
               The Register fields associated with running the Control Write Sequencer are described in Table 104.
               The Write Sequencer is enabled using the WSEQ_ENA bit. The index location of the first command in
               the selected sequence is held in the WSEQ_START_INDEX register.
               Writing a ‘1’ to the WSEQ_START bit commands the sequencer to execute a control sequence,
               starting at the given index. Note that, if the sequencer is already running, then the WSEQ_START
               command will be queued, and will be executed later when the sequencer becomes available.
               Note that the mechanism for queuing multiple sequence requests has some limitations, when using
               the WSEQ_START bit to trigger the write sequencer. If a sequence is initiated using the
               WSEQ_START bit, no other control sequences should be triggered until the sequence completes.
               The WSEQ_BUSY bit (described in Table 109) provides an indication of the sequencer status, and
               can be used to confirm that sequence has completed. Control sequences triggered by another other
               method are queued if necessary, and scheduled in turn.
               The Write Sequencer can be interrupted by writing a ‘1’ to the WSEQ_ABORT bit. Note that this
               command will only abort a sequence that is currently running; if other sequence commands are
               pending and not yet started, these sequences will not be aborted by writing to the WSEQ_ABORT bit.
               The Write Sequencer stores up to 256 register write commands. These are defined in Registers
               R12288 (3000h) to R12799 (31FFh). Each of the 256 possible commands is defined in 2 control
               registers - see Table 110 for a description of these registers.
                  REGISTER         BIT           LABEL          DEFAULT                     DESCRIPTION
                   ADDRESS
                 R22               11      WSEQ_ABORT              0         Writing a 1 to this bit aborts the current
                 (0016h)                                                     sequence.
                 Write             10      WSEQ_START              0         Writing a 1 to this bit starts the write
                 Sequencer                                                   sequencer at the index location selected
                 Ctrl 0                                                      by WSEQ_START_INDEX. At the end of
                                                                             the sequence, this bit will be reset by the
                                                                             Write Sequencer.
                                    9      WSEQ_ENA                0         Write Sequencer Enable
                                                                             0 = Disabled
                                                                             1 = Enabled
                                                                             Only applies to sequences triggered
                                                                             using the WSEQ_START bit.
242                                                                                                              Rev 4.1


                                                                                          WM8998
           REGISTER        BIT          LABEL           DEFAULT                    DESCRIPTION
            ADDRESS
                          8:0    WSEQ_START_I            000h       Sequence Start Index
                                 NDEX [8:0]                         This field contains the index location in
                                                                    the sequencer memory of the first
                                                                    command in the selected sequence.
                                                                    Only applies to sequences triggered
                                                                    using the WSEQ_START bit.
                                                                    Valid from 0 to 255 (0FFh).
        Table 104 Write Sequencer Control - Initiating a Sequence
        AUTOMATIC SAMPLE RATE DETECTION SEQUENCES
        The WM8998 supports automatic sample rate detection on the digital audio interfaces (AIF1, AIF2
        and AIF3), when operating in AIF Slave mode. Automatic sample rate detection is enabled using the
        RATE_EST_ENA register bit (see Table 90).
        Up to four audio sample rates can be configured for automatic detection; these sample rates are
        selected using the SAMPLE_RATE_DETECT_n registers. If one of the selected audio sample rates is
        detected, then the Control Write Sequencer will be triggered. The applicable start index location within
        the sequencer memory is separately configurable for each detected sample rate.
        The WSEQ_SAMPLE_RATE_DETECT_A_INDEX register defines the sequencer start index
        corresponding to the SAMPLE_RATE_DETECT_A sample rate. Equivalent start index values are
        defined for the other sample rates, as described in Table 105.
        Note that a sequencer start index of 1FFh will cause the respective sequence to be aborted.
        The automatic sample rate detection control sequences are undefined following Power-On Reset
        (POR), but can be user-programmed after power-up. Note that all control sequences are maintained
        in the sequencer memory through Hardware Reset, Software Reset and in Sleep mode.
        See “Clocking and Sample Rates” for further details of the automatic sample rate detection function.
           REGISTER        BIT          LABEL           DEFAULT                    DESCRIPTION
            ADDRESS
          R97             8:0    WSEQ_SAMPLE             1FFh       Sample Rate A Write Sequence start
          (0061h)                _RATE_DETECT                       index
          Sample                 _A_INDEX [8:0]                     This field contains the index location in
          Rate                                                      the sequencer memory of the first
          Sequence                                                  command in the sequence associated
          Select 1                                                  with Sample Rate A detection.
                                                                    Valid from 0 to 255 (0FFh).
          R98             8:0    WSEQ_SAMPLE             1FFh       Sample Rate B Write Sequence start
          (0062h)                _RATE_DETECT                       index
          Sample                 _B_INDEX [8:0]                     This field contains the index location in
          Rate                                                      the sequencer memory of the first
          Sequence                                                  command in the sequence associated
          Select 2                                                  with Sample Rate B detection.
                                                                    Valid from 0 to 255 (0FFh).
          R99             8:0    WSEQ_SAMPLE             1FFh       Sample Rate C Write Sequence start
          (0063h)                _RATE_DETECT                       index
          Sample                 _C_INDEX [8:0]                     This field contains the index location in
          Rate                                                      the sequencer memory of the first
          Sequence                                                  command in the sequence associated
          Select 3                                                  with Sample Rate C detection.
                                                                    Valid from 0 to 255 (0FFh).
          R100            8:0    WSEQ_SAMPLE             1FFh       Sample Rate D Write Sequence start
          (0064h)                _RATE_DETECT                       index
          Sample                 _D_INDEX [8:0]                     This field contains the index location in
          Rate                                                      the sequencer memory of the first
          Sequence                                                  command in the sequence associated
          Select 4                                                  with Sample Rate D detection.
                                                                    Valid from 0 to 255 (0FFh).
        Table 105 Write Sequencer Control - Automatic Sample Rate Detection
Rev 4.1                                                                                                      243


                                                                                      WM8998
    JACK DETECT, GPIO, MICDET CLAMP, AND WAKE-UP SEQUENCES
    The WM8998 supports external accessory detection and GPIO functions. The JD1 signal (associated
    with external accessory detection) and the GP5 signal (associated with the GPIO5 pin) can be used to
    trigger the Control Write Sequencer.
    The JD1 signal is configured using the register bits described in Table 65. The GP5 signal is derived
    from the GPIO5 pin, which is configured using the register bits described in Table 75.
    The MICDET Clamp is controlled by the JD1 and/or GP5 signals, as described in Table 66. The
    MICDET Clamp status can also be used to trigger the Control Write Sequencer.
    A Control Write Sequence can be associated with a rising edge and/or a falling edge of the JD1, GP5
    or MICDET Clamp. This is configured using the register bits described in Table 74.
    If one of the selected logic conditions is detected, the Control Write Sequencer will be triggered. The
    applicable start index location within the sequencer memory is separately configurable for each logic
    condition.
    The WSEQ_GP5_RISE_INDEX register defines the sequencer start index corresponding to a GP5
    Rising Edge event. Equivalent start index values are defined for the other logic conditions, as
    described in Table 106.
    Note that a sequencer start index of 1FFh will cause the respective sequence to be aborted.
    The JD1, GP5 and MICDET Clamp control sequences are undefined following Power-On Reset
    (POR), but can be user-programmed after power-up. Note that all control sequences are maintained
    in the sequencer memory through Hardware Reset, Software Reset and in Sleep mode.
    See “Low Power Sleep Configuration” for further details of the JD1, GP5 and MICDET Clamp status
    signals. See also “General Purpose Input / Output” for details of the GPIO5 pin.
        REGISTER        BIT          LABEL           DEFAULT                   DESCRIPTION
        ADDRESS
      R102             8:0    WSEQ_MICD_CL            1FFh      MICDET Clamp (Rising) Write Sequence
      (0066h)                 AMP_RISE_INDE                     start index
      Always On               X [8:0]                           This field contains the index location in
      Triggers                                                  the sequencer memory of the first
      Sequence                                                  command in the sequence associated
      Select 1                                                  with MICDET Clamp (Rising) detection.
                                                                Valid from 0 to 255 (0FFh).
      R103             8:0    WSEQ_MICD_CL            1FFh      MICDET Clamp (Falling) Write Sequence
      (0067h)                 AMP_FALL_INDE                     start index
      Always On               X [8:0]                           This field contains the index location in
      Triggers                                                  the sequencer memory of the first
      Sequence                                                  command in the sequence associated
      Select 2                                                  with MICDET Clamp (Falling) detection.
                                                                Valid from 0 to 255 (0FFh).
      R104             8:0    WSEQ_GP5_RIS            1FFh      GP5 (Rising) Write Sequence start index
      (0068h)                 E_INDEX [8:0]                     This field contains the index location in
      Always On                                                 the sequencer memory of the first
      Triggers                                                  command in the sequence associated
      Sequence                                                  with GP5 (Rising) detection.
      Select 3                                                  Valid from 0 to 255 (0FFh).
      R105             8:0    WSEQ_GP5_FAL            1FFh      GP5 (Falling) Write Sequence start index
      (0069h)                 L_INDEX [8:0]                     This field contains the index location in
      Always On                                                 the sequencer memory of the first
      Triggers                                                  command in the sequence associated
      Sequence                                                  with GP5 (Falling) detection.
      Select 4                                                  Valid from 0 to 255 (0FFh).
      R106             8:0    WSEQ_JD1_RIS            1FFh      JD1 (Rising) Write Sequence start index
      (006Ah)                 E_INDEX [8:0]                     This field contains the index location in
      Always On                                                 the sequencer memory of the first
      Triggers                                                  command in the sequence associated
      Sequence                                                  with JD1 (Rising) detection.
      Select 5                                                  Valid from 0 to 255 (0FFh).
244                                                                                                Rev 4.1


                                                                                          WM8998
            REGISTER        BIT          LABEL           DEFAULT                   DESCRIPTION
            ADDRESS
          R107             8:0     WSEQ_JD1_FAL            1FFh     JD1 (Falling) Write Sequence start index
          (006Bh)                  L_INDEX [8:0]                    This field contains the index location in
          Always On                                                 the sequencer memory of the first
          Triggers                                                  command in the sequence associated
          Sequence                                                  with JD1 (Falling) detection.
          Select 6                                                  Valid from 0 to 255 (0FFh).
        Table 106 Write Sequencer Control - JD1, GP5 and MICDET Clamp
        A valid clock (SYSCLK) must be enabled whenever a Control Write Sequence is scheduled.
        If the JD1, GP5 or MICDET Clamp trigger status bits are associated with the Control Write Sequencer
        (using the register bits in Table 74) and also configured as Wake-Up events (using the register bits in
        Table 73), then the Boot Sequence must be programmed to configure and enable SYSCLK. (Note
        that the default SYSCLK frequency must be used in this case.)
        The Boot Sequence (see below) is scheduled as part of the Wake-Up transition, and provides the
        capability to configure SYSCLK (and other register settings) prior to the Control Write Sequencer
        being triggered.
        Note that, if the Control Write Sequencer is triggered during normal operation, then SYSCLK will
        typically be already available, and no additional requirements will apply.
        DRC SIGNAL DETECT SEQUENCES
        The Dynamic Range Control (DRC) function within the WM8998 Digital Core provides a configurable
        signal detect function. This allows the signal level at the DRC input to be monitored and used to
        trigger other events.
        The DRC Signal Detect function is enabled and configured using the register fields described in Table
        13.
        A Control Write Sequence can be associated with a rising edge and/or a falling edge of the DRC1
        Signal Detect output. This is enabled using the DRC1_WSEQ_SIG_DET_ENA register bit.
        When the DRC Signal Detect sequence is enabled, the Control Write Sequencer will be triggered
        whenever the DRC1 Signal Detect output transitions (high or low). The applicable start index location
        within the sequencer memory is separately configurable for each logic condition.
        The WSEQ_DRC1_SIG_DET_RISE_SEQ_INDEX register defines the sequencer start index
        corresponding to a DRC Signal Detect Rising Edge event, as described in Table 107. The
        WSEQ_DRC1_SIG_DET_FALL_SEQ_INDEX register defines the sequencer start index
        corresponding to a DRC Signal Detect Falling Edge event.
        Note that a sequencer start index of 1FFh will cause the respective sequence to be aborted.
        The DRC Signal Detect sequences cannot be independently enabled for rising and falling edges.
        Instead, a start index of 1FFh can be used to disable the sequence for either edge, if required.
        The DRC Signal Detect control sequences are undefined following Power-On Reset (POR), but can
        be user-programmed after power-up. Note that all control sequences are maintained in the sequencer
        memory through Hardware Reset, Software Reset and in Sleep mode.
        See “Digital Core” for further details of the Dynamic Range Control (DRC) function.
            REGISTER        BIT          LABEL           DEFAULT                   DESCRIPTION
            ADDRESS
          R110             8:0     WSEQ_DRC1_SI            1FFh     DRC1 Signal Detect (Rising) Write
          (006Eh)                  G_DET_RISE_IN                    Sequence start index
          Trigger                  DEX [8:0]                        This field contains the index location in
          Sequence                                                  the sequencer memory of the first
          Select 32                                                 command in the sequence associated
                                                                    with DRC1 Signal Detect (Rising)
                                                                    detection.
                                                                    Valid from 0 to 255 (0FFh).
Rev 4.1                                                                                                      245


                                                                                      WM8998
        REGISTER       BIT           LABEL         DEFAULT                    DESCRIPTION
        ADDRESS
      R111            8:0     WSEQ_DRC1_SI          1FFh       DRC1 Signal Detect (Falling) Write
      (006Fh)                 G_DET_FALL_IN                    Sequence start index
      Trigger                 DEX [8:0]                        This field contains the index location in
      Sequence                                                 the sequencer memory of the first
      Select 33                                                command in the sequence associated
                                                               with DRC1 Signal Detect (Falling)
                                                               detection.
                                                               Valid from 0 to 255 (0FFh).
    Table 107 Write Sequencer Control - DRC Signal Detect
    BOOT SEQUENCE
    The WM8998 executes a Boot Sequence following Power-On Reset (POR), Hardware Reset,
    Software Reset or Wake-Up (from Sleep mode).
    See “Power-On Reset (POR)” and “Hardware Reset, Software Reset, Wake-Up, and Device ID” for
    further details.
    The Boot Sequence configures the WM8998 with factory-set parameters. User-defined register
    operations may be added to the Boot Sequence if required (eg. to automatically enable SYSCLK as
    part of the Boot Sequence). Further details of the sequencer memory are provided later in this
    section. Note that all control sequences are maintained in the sequencer memory through Hardware
    Reset, Software Reset and in Sleep mode.
    If the Boot Sequence is programmed to enable SYSCLK, note that the default SYSCLK frequency
    must be used. If a different SYSCLK frequency is required, this must be configured after the Boot
    Sequence has completed.
    The start index location of the the Boot Sequence is 192 (0C0h).
    The Boot Sequence can be commanded at any time by writing ‘1’ to the WSEQ_BOOT_START bit.
        REGISTER       BIT           LABEL         DEFAULT                    DESCRIPTION
        ADDRESS
      R24              1      WSEQ_BOOT_S              0       Writing a 1 to this bit starts the write
      (0018h)                 TART                             sequencer at the index location
      Write                                                    configured for the Boot Sequence.
      Sequencer                                                The Boot Sequence start index is 192
      Ctrl 2                                                   (0C0h).
    Table 108 Write Sequencer Control - Boot Sequence
    SEQUENCER OUTPUTS AND READBACK
    The status of the Write Sequencer can be read                       using   the     WSEQ_BUSY        and
    WSEQ_CURRENT_INDEX registers, as described in Table 109.
    When the WSEQ_BUSY bit is asserted, this indicates that the Write Sequencer is busy.
    The index address of the most recent Write Sequencer command can be read from the
    WSEQ_CURRENT_INDEX field. This can be used to provide a precise indication of the Write
    Sequencer progress.
        REGISTER       BIT           LABEL         DEFAULT                    DESCRIPTION
        ADDRESS
       R23             9      WSEQ_BUSY                0       Sequencer Busy flag (Read Only).
       (0017h)                (read only)                      0 = Sequencer idle
       Write                                                   1 = Sequencer busy
       Sequencer      8:0     WSEQ_CURREN           000h       Sequence Current Index. This indicates
       Ctrl 1                 T_INDEX [8:0]                    the memory location of the most recently
                              (read only)                      accessed command in the write
                                                               sequencer memory.
                                                               Coding is the same as
                                                               WSEQ_START_INDEX.
    Table 109 Write Sequencer Control - Status Readback
246                                                                                                Rev 4.1


                                                                                               WM8998
        The Write Sequencer status is an input to the Interrupt control circuit and can be used to trigger an
        Interrupt event - see “Interrupts”.
        The Write Sequencer status can be output directly on a GPIO pin as an external indication of the
        Write Sequencer. See “General Purpose Input / Output” to configure a GPIO pin for this function.
        PROGRAMMING A SEQUENCE
        A Control Write Sequence comprises a series of write operations to data bits (or groups of bits) within
        the control register map. Each write operation is defined by a block of 2 registers, each containing 5
        fields, as described below.
        The block of 2 registers is replicated 256 times, defining each of the sequencer’s 256 possible index
        addresses. Many sequences can be stored in the sequencer memory at the same time, with each
        assigned a unique range of index addresses.
        The WSEQ_DELAYn register is used to identify the ‘end of sequence’ position, as described below.
        Note that, in the following descriptions, the term ‘n’ denotes the sequencer index address (valid from 0
        to 255).
        WSEQ_DATA_WIDTHn is a 3-bit field which identifies the width of the data block to be written. Note
        that the maximum value of this field selects a width of 8-bits; writing to register fields greater than 8
        bits wide must be performed using two separate operations of the Write Sequencer.
        WSEQ_ADDRn is a 13-bit field containing the register address in which the data should be written.
        WSEQ_DELAYn is a 4-bit field which controls the waiting time between the current step and the next
        step in the sequence (ie. the delay occurs after the write in which it was called). The total delay time
        per step (including execution) is defined below, giving a useful range of execution/delay times from
        3.3s up to 1s per step. Setting this field to 0xF identifies the step as the last in the sequence.
                    If WSEQ_DELAYn = 0h or Fh, the step execution time is 3.3µs
                    For all other values, the step execution time is 61.44µs x ((2 WSEQ_DELAY ) - 1)
        WSEQ_DATA_STARTn is a 4-bit field which identifies the LSB position within the selected control
        register to which the data should be written. For example, setting WSEQ_DATA_STARTn = 0100 will
        select bit 4 as the LSB position of the data to be written.
        WSEQ_DATAn is an 8-bit field which contains the data to be written to the selected control register.
        The WSEQ_DATA_WIDTHn field determines how many of these bits are written to the selected
        control register; the most significant bits (above the number indicated by WSEQ_DATA_WIDTHn) are
        ignored.
        The register definitions for Step 0 are described in Table 110. The equivalent definitions also apply to
        Step 1 through to Step 255, in the subsequent register address locations.
             REGISTER           BIT           LABEL           DEFAULT                     DESCRIPTION
             ADDRESS
           R12288             15:13    WSEQ_DATA_                000         Width of the data block written in this
           (3000h)                     WIDTH0 [2:0]                          sequence step.
           WSEQ                                                              000 = 1 bit
           Sequence 1                                                        001 = 2 bits
                                                                             010 = 3 bits
                                                                             011 = 4 bits
                                                                             100 = 5 bits
                                                                             101 = 6 bits
                                                                             110 = 7 bits
                                                                             111 = 8 bits
                               12:0    WSEQ_ADDR0              0000h         Control Register Address to be
                                       [12:0]                                written to in this sequence step.
Rev 4.1                                                                                                         247


                                                                                    WM8998
        REGISTER            BIT        LABEL          DEFAULT                   DESCRIPTION
         ADDRESS
      R12289             15:12   WSEQ_DELAY0            0000       Time delay after executing this step.
      (3001h)                    [3:0]                             00h = 3.3us
      WSEQ                                                         01h to 0Eh = 61.44us x
      Sequence 2                                                   ((2^WSEQ_DELAY)-1)
                                                                   0Fh = End of sequence marker
                          11:8   WSEQ_DATA_S            0000       Bit position of the LSB of the data
                                 TART0 [3:0]                       block written in this sequence step.
                                                                   0000 = Bit 0
                                                                   …
                                                                   1111 = Bit 15
                           7:0   WSEQ_DATA0              00h       Data to be written in this sequence
                                 [7:0]                             step. When the data width is less
                                                                   than 8 bits, then one or more of the
                                                                   MSBs of WSEQ_DATAn are ignored.
                                                                   It is recommended that unused bits
                                                                   be set to 0.
    Table 110 Write Sequencer Control - Programming a Sequence
    SEQUENCER MEMORY DEFINITION
    The Write Sequencer memory defines up to 256 write operations; these are indexed as 0 to 255 in the
    sequencer memory map.
    Following Power-On Reset (POR), the sequencer memory will contain the Boot Sequence, and the
    OUT1, OUT2, OUT3, OUT4 signal path enable/disable sequences. The remainder of the sequencer
    memory will be undefined on power-up. See the “Applications Information” section for a summary of
    the WM8998 memory reset conditions.
    User-defined sequences can be programmed after power-up. Note that all control sequences are
    maintained in the sequencer memory through Hardware Reset, Software Reset and in Sleep mode.
    The default control sequences can be overwritten in the sequencer memory, if required. Note that the
    headphone and earpiece output path enable registers (HPx_ENA, LINEx_ENA, EP_ENA,
    SPKOUTx_ENA) will always trigger the Write Sequencer (at the pre-determined start index
    addresses).
    Writing ‘1’ to the WSEQ_LOAD_MEM bit will clear the sequencer memory to the POR state.
        REGISTER            BIT        LABEL          DEFAULT                   DESCRIPTION
         ADDRESS
      R24 (0018h)           0    WSEQ_LOAD_               0        Writing a 1 to this bit resets the
      Write                      MEM                               sequencer memory to the POR state.
      Sequencer
      Ctrl 2
    Table 111 Write Sequencer Control - Load Memory Control
    User-defined sequences must be assigned space within the Write Sequencer memory. The start
    index for the user-defined sequences is configured using the registers described in Table 105 and
    Table 106. The Boot Sequence has a fixed start address, as referenced in Table 108.
    The sequencer memory is illustrated in Figure 74. The pre-programmed sequencer index locations
    are highlighted. User-defined sequences should be programmed in other areas of the sequencer
    memory.
    Any user-defined additions to the Boot Sequence should be configured at index location 208 upwards.
    The final step of the Boot Sequence must be programmed with WSEQ_DELAYn = 0xF, identifying the
    end of the sequence. If there are no user-defined additions to the Boot Sequence, then the default
    values of sequencer index 208 should be left unchanged.
    Other user-defined sequences can be configured at index locations 209 upwards (excluding any index
    locations that have been allocated to the Boot Sequence).
248                                                                                               Rev 4.1


                                                                                                WM8998
               Index                     Description
                000h
                                         HPOUTL enable
                                         HPOUTL disable
                020h
                                         HPOUTR enable
                                         HPOUTR disable
                040h
                                         LINEOUTL enable
                                         LINEOUTL disable
                060h
                                         LINEOUTR enable
                                         LINEOUTR disable
                080h
                                         EPOUT enable
                                         EPOUT disable
                0A0h                     SPKOUTL enable
                                         SPKOUTL disable
                                         SPKOUTR enable
                0C0h                     SPKOUTR disable
                                         Boot Sequence (Reserved): 0C0h to 0CFh
                0E0h
                         User additions to the Boot Sequence can be defined at index 208 (0D0h) upwards.
                         Other user sequences can be defined at index 209 (0D1h) upwards.
        Figure 74 Write Sequencer Memory
        Further details of the pre-programmed sequencer index locations are provided in Table 112.
             SEQUENCE NAME                        START INDEX                     DEFAULT SEQUENCE
                                                                                      INDEX RANGES
              HPOUTL Enable                           0 (000h)                             0 to 19
              HPOUTL Disable                         24 (018h)                            24 to 27
              HPOUTR Enable                          32 (020h)                            32 to 51
              HPOUTR Disable                         56 (038h)                            56 to 59
             LINEOUTL Enable                         64 (040h)                            64 to 83
            LINEOUTL Disable                         88 (058h)                            88 to 91
             LINEOUTR Enable                         96 (060h)                           96 to 115
            LINEOUTR Disable                        120 (078h)                          120 to 123
               EPOUT Enable                         128 (080h)                          128 to 137
               EPOUT Disable                        144 (090h)                          144 to 147
             SPKOUTL Enable                         152 (098h)                          152 to 163
             SPKOUTL Disable                        164 (0A4h)                          164 to 171
             SPKOUTR Enable                         172 (0ACh)                          172 to 183
             SPKOUTR Disable                        184 (0B8h)                          184 to 191
               Boot Sequence                        192 (0C0h)                          192 to 207
          Note: User additions to the Boot Sequence can be defined at index 208 upwards;
          Other user sequences can be defined at index 209 upwards.
        Table 112 Default Sequencer Memory Allocation
Rev 4.1                                                                                                  249


                                                                                               WM8998
CHARGE PUMPS, REGULATORS AND VOLTAGE REFERENCE
               The WM8998 incorporates two Charge Pump circuits and two LDO Regulator circuits to generate
               supply rails for internal functions and to support external microphone requirements. The WM8998 also
               provides three MICBIAS generators which provide low noise reference voltages suitable for biasing
               electret condenser (ECM) type microphones or powering digital microphones.
               Refer to the “Applications Information” section for recommended external components.
               CHARGE PUMPS AND LDO2 REGULATOR
               Charge Pump 1 (CP1) is used to generate the positive and negative supply rails for the analogue
               output drivers. CP1 is enabled automatically by the WM8998 when required by the output drivers.
               Charge Pump 2 (CP2) powers LDO2, which provides the supply rail for analogue input circuits and for
               the MICBIAS generators. CP2 and LDO2 are enabled using the CP2_ENA register bit.
               The 32kHz clock must be configured and enabled when using CP2. See “Clocking and Sample Rates”
               for details of the system clocks.
               When CP2 and LDO2 are enabled, the MICVDD voltage can be selected using the LDO2_VSEL
               control field. Note that, when one or more of the MICBIAS generators is operating in normal
               (regulator) mode, then the MICVDD voltage must be at least 200mV greater than the highest selected
               MICBIASn output voltage(s).
               When CP2 and LDO2 are enabled, an internal bypass path may be selected, connecting the MICVDD
               pin directly to the CPVDD supply. This path is controlled using the CP2_BYPASS register. Note that
               the bypass path is only supported when CP2 is enabled.
               When CP2 is disabled, the CP2VOUT pin can be configured to be floating or to be actively
               discharged. This is selected using the CP2_DISCH register bit.
               When LDO2 is disabled, the MICVDD pin can be configured to be floating or to be actively
               discharged. This is selected using the LDO2_DISCH register bit.
               The MICVDD pin is connected to the output of LDO2. Note that the MICVDD does not support direct
               connection to an external supply; MICVDD is always powered internally to the WM8998.
               The Charge Pumps and LDO2 Regulator circuits are illustrated in Figure 75. The associated register
               control bits are described in Table 113.
               Note that decoupling capacitors and flyback capacitors are required for these circuits. Refer to the
               “Applications Information” section for recommended external components.
               MICBIAS BIAS (MICBIAS) CONTROL
               There are three MICBIAS generators which provide low noise reference voltages suitable for biasing
               electret condenser (ECM) type microphones or powering digital microphones. Refer to the
               “Applications Information” section for recommended external components.
               The MICBIAS generators are powered from MICVDD, which is generated by an internal Charge Pump
               and LDO, as illustrated in Figure 75.
               The MICBIAS outputs can be independently enabled using the MICBn_ENA register bits (where n = 1,
               2 or 3 for MICBIAS1, 2 or 3 respectively).
               When a MICBIAS output is disabled, the output pin can be configured to be floating or to be actively
               discharged. This is selected using the MICBn_DISCH register bits.
               The MICBIAS generators can each operate as a voltage regulator or in bypass mode. The applicable
               mode is selected using the MICBn_BYPASS registers.
               In Regulator mode, the output voltage is selected using the MICBn_LVL register bits. In this mode,
               MICVDD must be at least 200mV greater than the required MICBIAS output voltages. The MICBIAS
               outputs are powered from the MICVDD pin, and use the internal bandgap circuit as a reference.
               In Regulator mode, the MICBIAS regulators are designed to operate without external decoupling
               capacitors. The regulators can be configured to support a capacitive load if required, using the
               MICBn_EXT_CAP register bits. (This may be appropriate for a digital microphone supply.) It is
250                                                                                                       Rev 4.1


                                                                                          WM8998
        important that the external capacitance is compatible with the applicable MICBn_EXT_CAP setting.
        The compatible load conditions are detailed in the “Electrical Characteristics” section.
        In Bypass mode, the output pin (MICBIAS1, MICBIAS2 or MICBIAS3) is connected directly to
        MICVDD. This enables a low power operating state. Note that the MICBn_EXT_CAP register settings
        are not applicable in Bypass mode; there are no restrictions on the external MICBIAS capacitance in
        Bypass mode.
        The MICBIAS generators incorporate a pop-free control circuit to ensure smooth transitions when the
        MICBIAS outputs are enabled or disabled in Bypass mode; this feature is enabled using the
        MICBn_RATE registers.
        The MICBIAS generators are illustrated in Figure 75. The MICBIAS control register bits are described
        in Table 113.
        The maximum output current for each MICBIASn pin is noted in the “Electrical Characteristics”. This
        limit must be observed on each MICBIAS output, especially if more than one microphone is connected
        to a single MICBIAS pin. Note that the maximum output current differs between Regulator mode and
        Bypass mode.
        VOLTAGE REFERENCE CIRCUIT
        The WM8998 incorporates a voltage reference circuit, powered by AVDD. This circuit ensures the
        accuracy of the LDO Regulator and MICBIAS voltage settings.
        LDO1 REGULATOR AND DCVDD SUPPLY
        The LDO1 voltage regulator is intended for generating the DCVDD domain, which powers the digital
        core functions on the WM8998. In this configuration, the LDO output (LDOVOUT) should be
        connected to the DCVDD pin. Note that the use of the LDO1 regulator to power external circuits
        cannot be supported by the WM8998.
        LDO1 is powered by LDOVDD and can be controlled using hardware or software controls. Note that,
        depending on the application requirements, it may be necessary to use both the hardware and
        software enables for LDO1, as described below.
        Under hardware control, LDO1 is enabled when a logic ‘1’ is applied to the LDOENA pin. The logic
        level is determined with respect to the DBVDD1 voltage domain. LDO1 is also enabled when the
        LDO1_ENA software control register is set to 1. Note that, to disable LDO1, the hardware and
        software controls must both be de-asserted.
        When LDO1 is enabled, an internal bypass path may be selected, connecting the LDOVOUT pin
        directly to the LDOVDD supply. This path is controlled using the LDO1_BYPASS register. Note that
        the bypass path is only supported when LDO1 is enabled.
        When LDO1 is disabled, the LDOVOUT pin can be configured to be floating or to be actively
        discharged. This is selected using the LDO1_DISCH register bit.
        When LDO1 is enabled, the LDOVOUT voltage can be controlled using the LDO1_VSEL register.
        Setting LDO1_HI_PWR=1 will override the LDO1_VSEL register and select 1.8V LDO output voltage.
        Note that, under default conditions, LDO1_HI_PWR is set to ‘1’.
        It is possible to supply DCVDD from an external supply. In this configuration, the LDOVOUT pin
        should be left floating; it must not be connected to the DCVDD pin. The LDO1 regulator is not used in
        this case, and must be disabled at all times.
        For recommended use of the Sleep / Wake-Up functions (see “Low Power Sleep Configuration”), it is
        assumed that DCVDD is powered from the output of LDO1. In this case, Sleep mode is selected when
        LDO1 is disabled, causing the DCVDD supply to be removed. Note that the AVDD, DBVDD1, and
        LDOVDD supplies must be present throughout the Sleep mode duration.
        If DCVDD is powered externally (not from LDO1), then the ISOLATE_DCVDD1 register bit must be
        controlled as described in Table 113 when selecting WM8998 Sleep mode. In this case, Sleep mode
        is selected by setting the ISOLATE_DCVDD1 register bit, and then removing the DCVDD supply. For
        applications where DCVDD is powered externally, only the AVDD and DBVDD1 supplies are required
        in Sleep mode.
        An internal pull-down resistor is enabled by default on the LDOENA pin. This is configurable using the
        LDO1ENA_PD register bit. A pull-up resistor is also available, as described in Table 113. When the
Rev 4.1                                                                                                  251


                                                                                     WM8998
    pull-up and pull-down resistors are both enabled, the WM8998 provides a ‘bus keeper’ function on the
    LDOENA pin. The bus keeper function holds the input logic level unchanged whenever the external
    circuit removes the drive (eg. if the signal is tri-stated).
    If DCVDD is powered from LDO1, then a logic ‘1’ must be applied to the LDOENA pin during power-
    up, to enable LDO1. The LDO must also be enabled using the LDOENA pin following a Hardware
    Reset or Software Reset, to allow the device to re-start. (It is recommended that the LDOENA pin is
    asserted before any reset, and is held at logic ‘1’ until after the reset is complete; this ensures the
    Write Sequencer memory contents are retained, and also allows faster reset time.)
    For normal operation following Power-On Reset (POR), Hardware Reset, or Software Reset, LDO1
    must be enabled using the hardware or software controls described above. Note that when the
    LDO1_ENA bit is set to 1, the LDOENA pin has no effect and may be de-asserted - the LDO is then
    under software control, allowing Sleep mode to be selected under register control, including via the
    Control Write Sequencer.
    See “Power-On Reset (POR)” and “Hardware Reset, Software Reset, Wake-Up, and Device ID” for
    details of WM8998 Resets. See also “Low Power Sleep Configuration” for details of the Sleep / Wake-
    up functions.
    The LDO1 Regulator circuit is illustrated in Figure 75. The associated register control bits are
    described in Table 113.
    Note that a decoupling capacitor is recommended. Refer to the “Applications Information” section for
    recommended external components.
    BLOCK DIAGRAM AND CONTROL REGISTERS
    The Charge Pump and Regulator circuits are illustrated in Figure 75. Note that decoupling capacitors
    and flyback capacitors are required for these circuits. Refer to the “Applications Information” section
    for recommended external components.
252                                                                                               Rev 4.1


                                                                                                                      WM8998
                                               CP1VOUTP
                                      CP1CA                                      LDO1 may be used to generate the DCVDD supply. In this
                                               CP1VOUTN
                                                                                 case, the LDOVOUT pin must be connected to the DCVDD pin.
                                      CP1CB
    CPVDD                            Charge Pump 1
                                                                    Analogue output                                    LDOVDD
                                                                    supply
    CPGND
                                                                                      LDO1_ENA
                                                                                      LDO1_BYPASS
                                                                                                         LDO 1         LDOENA
    CP2CA        Charge           CP2_ENA                                             LDO1_VSEL[5:0]
                 Pump 2           CP2_BYPASS
    CP2CB                                                                             LDO1_DISCH
                                  CP2_DISCH                                           LDO1_HI_PWR
                                                                                      LDO1ENA_PD                       LDOVOUT
 CP2VOUT
                                                                                  Digital Core supply                  DCVDD
                  LDO2            LDO2_VSEL[5:0]
                                  LDO2_DISCH
                                                                                                                       DGND
   MICVDD
                                                                                        MICB1_ENA
                                                                                        MICB1_BYPASS
                                              Analogue input                            MICB1_LVL[3:0]
                                              supply                                    MICB1_RATE
                                                                                                                       MICBIAS1
                                                                                        MICB1_DISCH
                                                                                        MICB1_EXT_CAP
     AVDD                                     Analogue supply                           MICB2_ENA
                                                                                        MICB2_BYPASS
     AGND                                                                               MICB2_LVL[3:0]
                                                                                        MICB2_RATE
                                                                                                                       MICBIAS2
                                                                                        MICB2_DISCH
                                                                                        MICB2_EXT_CAP
                     Voltage
                                              Analogue reference
                    Reference                                                           MICB3_ENA
                                                                                        MICB3_BYPASS
                                                                                        MICB3_LVL[3:0]
                                                                                        MICB3_RATE
                                                                                                                       MICBIAS3
                                                                                        MICB3_DISCH
                                                                                        MICB3_EXT_CAP
                          VREFC
Figure 75 Charge Pumps and Regulators
                                  REGISTER          BIT            LABEL         DEFAULT                         DESCRIPTION
                                  ADDRESS
                                  R512              2     CP2_DISCH                     1        Charge Pump 2 Discharge
                                  (0200h)                                                        0 = CP2VOUT floating when disabled
                                  Mic                                                            1 = CP2VOUT discharged when disabled
                                  Charge            1     CP2_BYPASS                    1        Charge Pump 2 and LDO2 Bypass Mode
                                  Pump 1
                                                                                                 0 = Normal
                                                                                                 1 = Bypass mode
                                                                                                 In Bypass mode, CPVDD is connected
                                                                                                 directly to MICVDD.
                                                                                                 Note that CP2_ENA must also be set.
                                                    0     CP2_ENA                       0        Charge Pump 2 and LDO2 Control
                                                                                                 (Provides analogue input and MICVDD
                                                                                                 supplies)
                                                                                                 0 = Disabled
                                                                                                 1 = Enabled
Rev 4.1                                                                                                                                253


                                                                   WM8998
    REGISTER    BIT     LABEL       DEFAULT                DESCRIPTION
    ADDRESS
    R528      10:5  LDO1_VSEL [5:0]  06h    LDO1 Output Voltage Select
    (0210h)                                 Controls the LDO1 output voltage when
    LDO1                                    LDO1_HI_PWR=0.
    Control 1                               00h = 0.9V
                                            01h = 0.95V
                                            02h = 1.0V
                                            03h = 1.05V
                                            04h = 1.1V
                                            05h = 1.15V
                                            06h = 1.2V
                                            07h to 3Fh = Reserved
                2   LDO1_DISCH        1     LDO1 Discharge
                                            0 = LDOVOUT floating when disabled
                                            1 = LDOVOUT discharged when disabled
                1   LDO1_BYPASS       0     LDO1 Bypass Mode
                                            0 = Normal
                                            1 = Bypass mode
                                            In Bypass mode, LDOVDD is connected
                                            directly to LDOVOUT.
                                            Note that LDO1_ENA must also be set.
                0   LDO1_ENA          0     LDO1 Control
                                            0 = Disabled
                                            1 = Enabled
    R530        0   LDO1_HI_PWR       1     LDO1 Output Voltage Control
    (0212h)                                 0 = Set by LDO1_VSEL
    LDO1                                    1 = 1.8V
    Control 2
    R531      10:5  LDO2_VSEL [5:0]  1Ah    LDO2 Output Voltage Select
    (0213h)                                 00h = 1.7V
    LDO2                                    01h = 1.75V
    Control 1                               02h = 1.8V
                                            03h = 1.85V
                                            … (50mV steps)
                                            1Dh = 3.15V
                                            1Eh = 3.2V
                                            1Fh = 3.3V
                                            20h to 3Fh = Reserved
                                            (See Table 114 for voltage range)
                2   LDO2_DISCH        1     LDO2 Discharge
                                            0 = MICVDD floating when disabled
                                            1 = MICVDD discharged when disabled
    R536       15   MICB1_EXT_CA      0     Microphone Bias 1 External Capacitor
    (218h)          P                       (when MICB1_BYPASS = 0).
    Mic Bias                                Configures the MICBIAS1 regulator
    Ctrl 1                                  according to the specified capacitance
                                            connected to the MICBIAS1 output.
                                            0 = No external capacitor
                                            1 = External capacitor connected
               8:5  MICB1_LVL [3:0]   Dh    Microphone Bias 1 Voltage Control
                                            (when MICB1_BYPASS = 0)
                                            0h = 1.5V
                                            1h = 1.6V
                                            … (0.1V steps)
                                            Ch = 2.7V
                                            Dh to Fh = 2.8V
                3   MICB1_RATE        0     Microphone Bias 1 Rate (Bypass mode)
                                            0 = Fast start-up / shut-down
                                            1 = Pop-free start-up / shut-down
254                                                                            Rev 4.1


                                                                     WM8998
        REGISTER  BIT     LABEL       DEFAULT                DESCRIPTION
        ADDRESS
                  2   MICB1_DISCH       1     Microphone Bias 1 Discharge
                                              0 = MICBIAS1 floating when disabled
                                              1 = MICBIAS1 discharged when disabled
                  1   MICB1_BYPASS      1     Microphone Bias 1 Mode
                                              0 = Regulator mode
                                              1 = Bypass mode
                  0   MICB1_ENA         0     Microphone Bias 1 Enable
                                              0 = Disabled
                                              1 = Enabled
        R537     15   MICB2_EXT_CA      0     Microphone Bias 2 External Capacitor
        (219h)        P                       (when MICB2_BYPASS = 0).
        Mic Bias                              Configures the MICBIAS2 regulator
        Ctrl 2                                according to the specified capacitance
                                              connected to the MICBIAS2 output.
                                              0 = No external capacitor
                                              1 = External capacitor connected
                 8:5  MICB2_LVL [3:0]   Dh    Microphone Bias 2 Voltage Control
                                              (when MICB2_BYPASS = 0)
                                              0h = 1.5V
                                              1h = 1.6V
                                              … (0.1V steps)
                                              Ch = 2.7V
                                              Dh to Fh = 2.8V
                  3   MICB2_RATE        0     Microphone Bias 2 Rate (Bypass mode)
                                              0 = Fast start-up / shut-down
                                              1 = Pop-free start-up / shut-down
                  2   MICB2_DISCH       1     Microphone Bias 2 Discharge
                                              0 = MICBIAS2 floating when disabled
                                              1 = MICBIAS2 discharged when disabled
                  1   MICB2_BYPASS      1     Microphone Bias 2 Mode
                                              0 = Regulator mode
                                              1 = Bypass mode
                  0   MICB2_ENA         0     Microphone Bias 2 Enable
                                              0 = Disabled
                                              1 = Enabled
        R538     15   MICB3_EXT_CA      0     Microphone Bias 3 External Capacitor
        (21Ah)        P                       (when MICB3_BYPASS = 0).
        Mic Bias                              Configures the MICBIAS3 regulator
        Ctrl 3                                according to the specified capacitance
                                              connected to the MICBIAS3 output.
                                              0 = No external capacitor
                                              1 = External capacitor connected
                 8:5  MICB3_LVL [3:0]   Dh    Microphone Bias 3 Voltage Control
                                              (when MICB3_BYPASS = 0)
                                              0h = 1.5V
                                              1h = 1.6V
                                              … (0.1V steps)
                                              Ch = 2.7V
                                              Dh to Fh = 2.8V
                  3   MICB3_RATE        0     Microphone Bias 3 Rate (Bypass mode)
                                              0 = Fast start-up / shut-down
                                              1 = Pop-free start-up / shut-down
                  2   MICB3_DISCH       1     Microphone Bias 3 Discharge
                                              0 = MICBIAS3 floating when disabled
                                              1 = MICBIAS3 discharged when disabled
Rev 4.1                                                                              255


                                                                              WM8998
     REGISTER     BIT        LABEL        DEFAULT                     DESCRIPTION
     ADDRESS
                   1    MICB3_BYPASS         1       Microphone Bias 3 Mode
                                                     0 = Regulator mode
                                                     1 = Bypass mode
                   0    MICB3_ENA            0       Microphone Bias 3 Enable
                                                     0 = Disabled
                                                     1 = Enabled
     R715          0    ISOLATE_DCVD         0       Always-On power domain isolate control
     (02CBh)            D1                           Set this bit to 1 to isolate the ‘Always-On’
     Isolation                                       domain from the DCVDD pin.
     control
                                                     If DCVDD is powered externally (not from
                                                     LDO1), this bit must be set before
                                                     selecting Sleep mode (ie. before removing
                                                     the external DCVDD supply).
                                                     If DCVDD is powered from LDO1, then
                                                     there is no requirement to set this bit.
                                                     This bit is automatically reset to 0
                                                     following a Wake-up transition (from Sleep
                                                     mode).
     R3104        15    LDO1ENA_PD           1       LDOENA Pull-Down Control
     (0C20h)                                         0 = Disabled
     Misc Pad                                        1 = Enabled
     Ctrl 1                                          Note - when LDO1ENA_PD and
                                                     LDO1ENA_PU are both set to ‘1’, then a
                                                     ‘bus keeper’ function is enabled on the
                                                     LDOENA pin.
                  14    LDO1ENA_PU           0       LDOENA Pull-Up Control
                                                     0 = Disabled
                                                     1 = Enabled
                                                     Note - when LDO1ENA_PD and
                                                     LDO1ENA_PU are both set to ‘1’, then a
                                                     ‘bus keeper’ function is enabled on the
                                                     LDOENA pin.
    Table 113 Charge Pump and LDO Control Registers
       LDO2_VSEL [5:0]     LDO2 OUTPUT      LDO2_VSEL [5:0]          LDO2 OUTPUT
             00h              1.70V               10h                    2.50V
             01h              1.75V               11h                    2.55V
             02h              1.80V               12h                    2.60V
             03h              1.85V               13h                    2.65V
             04h              1.90V               14h                    2.70V
             05h              1.95V               15h                    2.75V
             06h              2.00V               16h                    2.80V
             07h              2.05V               17h                    2.85V
             08h              2.10V               18h                    2.90V
             09h              2.15V               19h                    2.95V
             0Ah              2.20V              1Ah                     3.00V
             0Bh              2.25V              1Bh                     3.05V
             0Ch              2.30V              1Ch                     3.10V
             0Dh              2.35V              1Dh                     3.15V
             0Eh              2.40V              1Eh                     3.20V
             0Fh              2.45V               1Fh                    3.30V
    Table 114 LDO2 Voltage Control
256                                                                                        Rev 4.1


                                                                                                 WM8998
THERMAL SHUTDOWN AND SHORT CIRCUIT PROTECTION
              The WM8998 incorporates thermal protection functions, and also provides short-circuit detection on
              the Class D speaker output paths, as described below.
              The temperature sensor detects when the device temperature is within normal limits or if the device is
              approaching a hazardous temperature condition.
              The temperature sensor is an input to the Interrupt control circuit and can be used to trigger an
              Interrupt event - see “Interrupts”. A two-stage indication is provided, via the
              SPK_OVERHEAT_WARN_EINTn and SPK_OVERHEAT_EINTn interrupts.
              If the upper temperature threshold (SPK_OVERHEAT_EINTn) is exceeded, then the Class D speaker
              outputs will automatically be disabled in order to protect the device. When the speaker driver
              shutdown is complete, a further interrupt, SPK_SHUTDOWN_EINTn, will be asserted.
              The short circuit detection function for the Class D speaker outputs is triggered when the respective
              output drivers are enabled (using the register bits described in Table 52). If a short circuit is detected
              at this time, then the enable will be unsuccessful, and the respective output driver will not be enabled.
              The Class D speaker short circuit detection provides inputs to the Interrupt control circuit and can be
              used to trigger an Interrupt event - see “Interrupts”.
              If the Class D speaker short circuit condition is detected, then the respective driver(s) will
              automatically be disabled in order to protect the device. When the speaker driver shutdown is
              complete, a further interrupt, SPK_SHUTDOWN_EINTn, will be asserted.
              To enable the Class D speaker outputs following a short circuit detection, the host processor must
              disable and re-enable the output driver(s). Note that the short circuit status bits will always be cleared
              when the drivers are disabled.
              The Thermal Shutdown and Short Circuit protection status flags can be output directly on a GPIO pin
              as an external indication of the associated events. See “General Purpose Input / Output” to configure
              a GPIO pin for this function.
Rev 4.1                                                                                                             257


                                                                                                   WM8998
POWER-ON RESET (POR)
                The WM8998 will remain in the reset state until AVDD, DBVDD1 and DCVDD are all above their
                respective reset thresholds. Note that specified device performance is not assured outside the voltage
                ranges defined in the “Recommended Operating Conditions” section.
                Refer to “Recommended Operating Conditions” for the WM8998 power-up sequencing requirements.
                If DCVDD is powered from LDO1, then the DCVDD supply must be enabled using the LDOENA pin
                for the initial power-up. Note that subsequent interruption to DCVDD should only be permitted as part
                of a control sequence for entering Sleep mode.
                After the initial power-up, the Power-On Reset will be re-scheduled following an interruption to the
                DBVDD1 or AVDD supplies. Note that the AVDD supply must always be maintained whenever the
                DCVDD supply is present.
                If the WM8998 SLIMbus component is in its operational state, then it must be reset prior to scheduling
                a Power-On Reset. See “SLIMbus Interface Control” for details of the SLIMbus reset control
                messages.
                Following Power-On Reset (POR), a Boot Sequence is executed. The BOOT_DONE_STS register is
                asserted on completion of the Boot Sequence, as described in Table 115. Control register writes
                should not be attempted until the BOOT_DONE_STS register has been asserted.
                The BOOT_DONE_STS signal is an input to the Interrupt control circuit and can be used to trigger an
                Interrupt event - see “Interrupts”. Under default register conditions, a falling edge on the IRQ
                                                                                                             ¯¯¯ pin will
                indicate completion of the Boot Sequence.
                The BOOT_DONE_STS signal can also generate a GPIO output, providing an external indication of
                the Boot Sequence. See “General Purpose Input / Output” to configure a GPIO pin for this function.
                For details of the Boot Sequence, see “Control Write Sequencer”.
                    REGISTER       BIT          LABEL           DEFAULT                    DESCRIPTION
                    ADDRESS
                   R3363            8      BOOT_DONE_S              0       Boot Status
                   (0D23h)                 TS                               0 = Busy (boot sequence in progress)
                   Interrupt                                                1 = Idle (boot sequence completed)
                   Raw                                                      Control register writes should not be
                   Status 5                                                 attempted until Boot Sequence has
                                                                            completed.
                Table 115 Device Boot-Up Status
                Following Power-On Reset (POR), Hardware Reset, Software Reset, or Wake-Up (from Sleep mode),
                a sequence of device initialisation writes must be executed, as detailed in Table 116.
                The host system should ensure that the WM8998 is ready before attempting these (or any other)
                Control Register writes: the initialisation settings should be written after the BOOT_DONE_STS bit
                has been asserted (also indicated by a falling edge of the IRQ
                                                                            ¯¯¯ pin).
258                                                                                                             Rev 4.1


                                                                                         WM8998
                                WM8998 INITIALISATION
               1      Write 0x0014 to Register R529 (0x0211)
               2      Write 0x0064 to Register R622 (0x026E)
               3      Write 0x00EA to Register R623 (0x026F)
               4      Write 0x1F16 to Register R624 (0x0270)
               5      Write 0x2080 to Register R1040 (0x0410)
               6      Write 0x2080 to Register R1048 (0x0418)
               7      Write 0x2080 to Register R1056 (0x0420)
               8      Write 0xC759 to Register R1089 (0x0441)
               9      Write 0x2A08 to Register R1090 (0x0442)
              10      Write 0x5CFA to Register R1091 (0x0443)
              11      Write 0x080E to Register R1150 (0x047E)
              12      Write 0x1120 to Register R1208 (0x04B8)
              13      Write 0x0E0D to Register R1252 (0x04E4)
              14      Write 0x0E0D to Register R1253 (0x04E5)
              15      Write 0x0E0D to Register R1254 (0x04E6)
              16      Write 0x060E to Register R1259 (0x04EB)
        Table 116 Device Initialisation Register Settings
        The WM8998 is in Sleep mode when AVDD and DBVDD1 are present, and DCVDD is below its reset
        threshold. (Note that specific control requirements are also applicable for entering Sleep mode, as
        described in “Low Power Sleep Configuration”.)
        In Sleep mode, most of the Digital Core (and control registers) are held in reset; selected functions
        and control registers are maintained via an ‘Always-On’ internal supply domain. See “Low Power
        Sleep Configuration” for details of the ‘Always-On’ functions.
        See “Hardware Reset, Software Reset, Wake-Up, and Device ID” for details of the Wake-Up transition
        (exit from Sleep mode).
        Table 117 describes the default status of the WM8998 digital I/O pins on completion of Power-On
        Reset, prior to any register writes. The same default conditions are also applicable on completion of a
        Hardware Reset or Software Reset (see “Hardware Reset, Software Reset, Wake-Up, and Device
        ID”).
        The same default conditions are applicable following a Wake-Up transition, except for the GPIO5,
        IRQ, LDOENA, MCLK2 and RESET      ¯¯¯¯¯¯ pins. These are ‘Always-On’ pins whose configuration is
        unchanged in Sleep mode and during a Wake-Up transition.
        Note that the default conditions described in Table 117 will not be valid if modified by the Boot
        Sequence or by a ‘Wake-Up’ control sequence. See “Control Write Sequencer” for details of these
        functions.
Rev 4.1                                                                                                   259


                                                                               WM8998
       PIN NO               NAME                             TYPE                RESET STATUS
      MICVDD power domain
         C1         IN1LN / DMICCLK1         Analogue Input / Digital Output  Analogue input
         C3         IN1RN / DMICDAT1         Analogue input / Digital Input   Analogue input
         B1          IN2N / DMICCLK2         Analogue Input / Digital Output  Analogue input
         B2          IN2P / DMICDAT2         Analogue input / Digital Input   Analogue input
      DBVDD1 power domain
         F7                ADDR              Digital Input                    Digital input,
                                                                              Pull-down to DGND
        J12              AIF1BCLK            Digital Input / Output           Digital input
        H11             AIF1RXDAT            Digital Input                    Digital input
        F10             AIF1LRCLK            Digital Input / Output           Digital input
        G10             AIF1TXDAT            Digital Output                   Digital output
         F9                GPIO1             Digital Input / Output           Digital input,
                                                                              Pull-down to DGND
        E11                GPIO5             Digital Input / Output           Digital input,
                                                                              Pull-down to DGND
        F11                  IRQ
                             ¯¯¯             Digital Output                   Digital output
        F13              LDOENA              Digital Input                    Digital input,
                                                                              Pull-down to DGND
        H12               MCLK1              Digital Input                    Digital input
        F12               MCLK2              Digital Input                    Digital input
         D9               RESET
                           ¯¯¯¯¯¯            Digital Input                    Digital input,
                                                                              Pull-up to DBVDD1
        J11                 SCLK             Digital Input                    Digital input
         F8                 SDA              Digital Input / Output           Digital input
        J13              SLIMCLK             Digital Input                    Digital input
        G11              SLIMDAT             Digital Input / Output           Digital input
        H10               SPKCLK             Digital Output                   Digital output
         G9               SPKDAT             Digital Output                   Digital output
      DBVDD2 power domain
         J9              AIF2BCLK            Digital Input / Output           Digital input
         G7             AIF2RXDAT            Digital Input                    Digital input
         H9             AIF2LRCLK            Digital Input / Output           Digital input
         H8             AIF2TXDAT            Digital Output                   Digital output
         H7                GPIO2             Digital Input / Output           Digital input,
                                                                              Pull-down to DGND
         G8                GPIO4             Digital Input / Output           Digital input,
                                                                              Pull-down to DGND
      DBVDD3 power domain
         J6              AIF3BCLK            Digital Input / Output           Digital input
         G5             AIF3RXDAT            Digital Input                    Digital input
         H5             AIF3LRCLK            Digital Input / Output           Digital input
         F5             AIF3TXDAT            Digital Output                   Digital output
         G4                GPIO3             Digital Input / Output           Digital input,
                                                                              Pull-down to DGND
    Table 117 WM8998 Digital I/O Status in Reset
    Note that the dual function IN1LN/DMICCLK1, IN1RN/DMICDAT1, IN2N/DMICCLK2 and
    IN2P/DMICDAT2 pins default to their respective analogue input functions after Power-On Reset is
    completed. The analogue input functions are referenced to the MICVDD power domain.
260                                                                                          Rev 4.1


                                                                                                     WM8998
HARDWARE RESET, SOFTWARE RESET, WAKE-UP, AND DEVICE ID
               The WM8998 provides a Hardware Reset function, which is executed whenever the RESET          ¯¯¯¯¯¯ input is
               asserted (logic 0). The RESET
                                        ¯¯¯¯¯¯ input is active low and is referenced to the DBVDD1 power domain.
               A Hardware Reset causes most of the WM8998 control registers to be reset to their default states.
               Note that the Control Write Sequencer memory contents are retained during Hardware Reset
               (assuming the conditions noted below).
               An internal pull-up resistor is enabled by default on the RESET
                                                                            ¯¯¯¯¯¯ pin; this can be configured using the
               RESET_PU register bit. A pull-down resistor is also available, as described in Table 118. When the
               pull-up and pull-down resistors are both enabled, the WM8998 provides a ‘bus keeper’ function on the
               RESET
               ¯¯¯¯¯¯ pin. The bus keeper function holds the input logic level unchanged whenever the external
               circuit removes the drive (eg. if the signal is tri-stated).
               If the WM8998 SLIMbus component is in its operational state, then it must be reset prior to scheduling
               a Hardware Reset. See “SLIMbus Interface Control” for details of the SLIMbus reset control
               messages.
                   REGISTER       BIT           LABEL            DEFAULT                    DESCRIPTION
                   ADDRESS
                  R3104           1       RESET_PU                    1      RESET Pull-up enable
                  (0C20h)                                                    0 = Disabled
                  Misc Pad                                                   1 = Enabled
                  Ctrl 1                                                     Note - when RESET_PD and RESET_PU
                                                                             are both set to ‘1’, then a ‘bus keeper’
                                                                             function is enabled on the RESET pin.
                                  0       RESET_PD                    0      RESET Pull-down enable
                                                                             0 = Disabled
                                                                             1 = Enabled
                                                                             Note - when RESET_PD and RESET_PU
                                                                             are both set to ‘1’, then a ‘bus keeper’
                                                                             function is enabled on the RESET pin.
               Table 118 Reset Pull-Up Configuration
               A Software Reset is executed by writing any value to register R0. A Software Reset causes most of
               the WM8998 control registers to be reset to their default states. Note that the Control Write Sequencer
               memory contents are retained during Software Reset (assuming the conditions noted below).
               A Wake-Up transition (from Sleep mode) is similar to a Software Reset, but selected functions and
               control registers are maintained via an ‘Always-On’ internal supply domain. The ‘Always-On’ registers
               are not reset during Wake-Up. See “Low Power Sleep Configuration” for details of the ‘Always-On’
               functions.
               The Control Write Sequencer memory contents are retained during Hardware Reset, Software Reset
               or Sleep mode; these registers are only reset following a Power-On Reset (POR).
               If DCVDD is powered from LDO1, it is recommended that the LDOENA pin is asserted (logic 1) before
               Hardware Reset or Software Reset, as this enables a faster reset time.
               Following Hardware Reset, Software Reset or Wake-Up (from Sleep mode), a Boot Sequence is
               executed. The BOOT_DONE_STS register (see Table 115) is de-asserted during Hardware Reset,
               Software Reset and in Sleep mode. The BOOT_DONE_STS register is asserted on completion of the
               boot-up sequence. Control register writes should not be attempted until the BOOT_DONE_STS
               register has been asserted.
               The BOOT_DONE_STS signal is an input to the Interrupt control circuit and can be used to trigger an
               Interrupt event - see “Interrupts”.
               The BOOT_DONE_STS signal can also generate a GPIO output, providing an external indication of
               the Boot Sequence. See “General Purpose Input / Output” to configure a GPIO pin for this function.
               For details of the Boot Sequence, see “Control Write Sequencer”.
Rev 4.1                                                                                                               261


                                                                                        WM8998
    Following Power-On Reset (POR), Hardware Reset, Software Reset, or Wake-Up (from Sleep mode),
    a sequence of device initialisation writes must be executed, as detailed in Table 119.
    The host system should ensure that the WM8998 is ready before attempting these (or any other)
    Control Register writes: the initialisation settings should be written after the BOOT_DONE_STS bit
    has been asserted (also indicated by a falling edge of the IRQ
                                                                ¯¯¯ pin).
                           WM8998 INITIALISATION
          1       Write 0x0014 to Register R529 (0x0211)
          2       Write 0x0064 to Register R622 (0x026E)
          3       Write 0x00EA to Register R623 (0x026F)
          4       Write 0x1F16 to Register R624 (0x0270)
          5       Write 0x2080 to Register R1040 (0x0410)
          6       Write 0x2080 to Register R1048 (0x0418)
          7       Write 0x2080 to Register R1056 (0x0420)
          8       Write 0xC759 to Register R1089 (0x0441)
          9       Write 0x2A08 to Register R1090 (0x0442)
         10       Write 0x5CFA to Register R1091 (0x0443)
         11       Write 0x080E to Register R1150 (0x047E)
         12       Write 0x1120 to Register R1208 (0x04B8)
         13       Write 0x0E0D to Register R1252 (0x04E4)
         14       Write 0x0E0D to Register R1253 (0x04E5)
         15       Write 0x0E0D to Register R1254 (0x04E6)
         16       Write 0x060E to Register R1259 (0x04EB)
    Table 119 Device Initialisation Register Settings
    The status of the WM8998 digital I/O pins following Hardware Reset, Software Reset or Wake-Up is
    described in the “Power-On Reset (POR)” section.
    The Device ID can be read back from Register R0. The Hardware Revision can be read back from
    Register R1.
    The Software Revision can be read back from Register R2. The Software Revision code is
    incremented if software driver compatibility or software feature support is changed.
       REGISTER        BIT          LABEL            DEFAULT                    DESCRIPTION
        ADDRESS
      R0 (0000h)      15:0    SW_RST_DEV_             6349h      Writing to this register resets all registers
      Software                ID [15:0]                          to their default state.
      Reset                                                      Reading from this register will indicate
                                                                 Device ID 6349h.
      R1 (0001h)      7:0     HW_REVISION                        Hardware Device revision.
      Hardware                [7:0]                              (incremented for every new revision of
      Revision                                                   the device)
      R2 (0002h)      7:0     SW_REVISION                        Software Device revision.
      Software                [7:0]                              (incremented if software driver
      Revision                                                   compatibility or software feature support
                                                                 is changed)
    Table 120 Device Reset and ID
262                                                                                                   Rev 4.1


                                                                                                                       WM8998
REGISTER MAP
The WM8998 control registers are listed below. Note that only the register addresses described here should be accessed; writing to
other addresses may result in undefined behaviour. Register bits that are not documented should not be changed from the default
values.
   REG           NAME     15  14    13    12       11    10    9        8     7        6       5      4     3        2    1         0 DEFAULT
  R0 (0h)  Software Reset                                        SW_RST_DEV_ID [15:0]                                                  6349h
  R1 (1h)  Hardware       0   0     0     0        0     0     0        0                        HW_REVISION [7:0]                     0000h
           Revision
  R2 (2h)  Software       0   0     0     0        0     0     0        0                        SW_REVISION [7:0]                     0000h
           Revision
  R9 (9h)  Ctrl IF I2C1   0   0     0     0        0     0     0        0     0        0       0     0      0       0  I2C1_AUTO_IN    0001h
           CFG 1                                                                                                            C [1:0]
 R11 (Bh)  Ctrl IF I2C1   0   0     0     0        0     0     0        0     0                      I2C1_DEV_ID [6:0]                 001Ah
           CFG 2
 R22 (16h) Write          0   0     0     0      WSEQ WSEQ WSEQ                            WSEQ_START_INDEX [8:0]                      0000h
           Sequencer Ctrl                        _ABOR _STAR _ENA
           0                                       T     T
 R23 (17h) Write          0   0     0     0        0     0   WSEQ                        WSEQ_CURRENT_INDEX [8:0]                      0000h
           Sequencer Ctrl                                    _BUSY
           1
 R24 (18h) Write          0   0     0     0        0     0     0        0     0        0       0     0      0       0  WSEQ WSEQ       0000h
           Sequencer Ctrl                                                                                              _BOOT _LOAD
           2                                                                                                           _STAR _MEM
                                                                                                                          T
 R32 (20h) Tone Generator 0      TONE_RATE [3:0]         0   TONE_OFFSET      0        0    TONE2 TONE1     0       0  TONE2 TONE1     0000h
           1                                                      [1:0]                      _OVD _OVD                  _ENA _ENA
 R33 (21h) Tone Generator                                           TONE1_LVL [15:0]                                                   1000h
           2
 R34 (22h) Tone Generator 0   0     0     0        0     0     0        0                         TONE1_LVL [7:0]                      0000h
           3
 R35 (23h) Tone Generator                                           TONE2_LVL [15:0]                                                   1000h
           4
 R36 (24h) Tone Generator 0   0     0     0        0     0     0        0                         TONE2_LVL [7:0]                      0000h
           5
 R48 (30h) PWM Drive 1    0      PWM_RATE [3:0]         PWM_CLK_SEL [2:0]     0        0    PWM2 PWM1       0       0  PWM2 PWM1       0000h
                                                                                             _OVD _OVD                  _ENA _ENA
 R49 (31h) PWM Drive 2    0   0     0     0        0     0                                  PWM1_LVL [9:0]                             0100h
 R50 (32h) PWM Drive 3    0   0     0     0        0     0                                  PWM2_LVL [9:0]                             0100h
 R64 (40h) Wake control   0   0     0     0        0     0     0        0  WKUP      WKUP WKUP WKUP WKUP WKUP             0         0  0000h
                                                                           _MICD     _MICD _GP5_ _GP5_ _JD1_ _JD1_
                                                                           _CLAM     _CLAM FALL RISE FALL RISE
                                                                           P_FAL     P_RIS
                                                                              L        E
 R65 (41h) Sequence       0   0     0     0        0     0     0        0  WSEQ      WSEQ WSEQ WSEQ WSEQ WSEQ             0         0  0000h
           control                                                         _ENA_     _ENA_ _ENA_ _ENA_ _ENA_ _ENA_
                                                                           MICD_     MICD_ GP5_F GP5_R JD1_F JD1_RI
                                                                            CLAM     CLAM ALL       ISE    ALL     SE
                                                                           P_FAL     P_RIS
                                                                              L        E
 R97 (61h) Sample Rate    0   0     0     0        0     0     0                WSEQ_SAMPLE_RATE_DETECT_A_INDEX [8:0]                  01FFh
           Sequence
           Select 1
 R98 (62h) Sample Rate    0   0     0     0        0     0     0                WSEQ_SAMPLE_RATE_DETECT_B_INDEX [8:0]                  01FFh
           Sequence
           Select 2
 R99 (63h) Sample Rate    0   0     0     0        0     0     0                WSEQ_SAMPLE_RATE_DETECT_C_INDEX [8:0]                  01FFh
           Sequence
Rev 4.1                                                                                                                                  263


                                                                                                                 WM8998
   REG           NAME        15  14   13    12     11  10    9       8     7       6     5      4      3       2    1        0  DEFAULT
            Select 3
R100 (64h) Sample Rate       0   0    0      0     0   0     0               WSEQ_SAMPLE_RATE_DETECT_D_INDEX [8:0]               01FFh
            Sequence
            Select 4
R102 (66h) Always On         0   0    0      0     0   0     0                  WSEQ_MICD_CLAMP_RISE_INDEX [8:0]                 01FFh
            Triggers
            Sequence
            Select 1
R103 (67h) Always On         0   0    0      0     0   0     0                  WSEQ_MICD_CLAMP_FALL_INDEX [8:0]                 01FFh
            Triggers
            Sequence
            Select 2
R104 (68h) Always On         0   0    0      0     0   0     0                       WSEQ_GP5_RISE_INDEX [8:0]                   01FFh
            Triggers
            Sequence
            Select 3
R105 (69h) Always On         0   0    0      0     0   0     0                       WSEQ_GP5_FALL_INDEX [8:0]                   01FFh
            Triggers
            Sequence
            Select 4
R106 (6Ah) Always On         0   0    0      0     0   0     0                       WSEQ_JD1_RISE_INDEX [8:0]                   01FFh
            Triggers
            Sequence
            Select 5
R107 (6Bh) Always On         0   0    0      0     0   0     0                       WSEQ_JD1_FALL_INDEX [8:0]                   01FFh
            Triggers
            Sequence
            Select 6
R110 (6Eh) Trigger           0   0    0      0     0   0     0                 WSEQ_DRC1_SIG_DET_RISE_INDEX [8:0]                01FFh
            Sequence
            Select 32
R111 (6Fh) Trigger           0   0    0      0     0   0     0                 WSEQ_DRC1_SIG_DET_FALL_INDEX [8:0]                01FFh
            Sequence
            Select 33
R144 (90h) Haptics Control   0      HAP_RATE [3:0]     0     0      0      0       0     0   ONES     HAP_CTRL    HAP_A      0   0000h
            1                                                                                HOT_T       [1:0]     CT
                                                                                              RIG
R145 (91h) Haptics Control   0                                       LRA_FREQ [14:0]                                             7FFFh
            2
R146 (92h) Haptics phase 1   0   0    0      0     0   0     0      0                    PHASE1_INTENSITY [7:0]                  0000h
            intensity
R147 (93h) Haptics phase 1   0   0    0      0     0   0     0                        PHASE1_DURATION [8:0]                      0000h
            duration
R148 (94h) Haptics phase 2   0   0    0      0     0   0     0      0                    PHASE2_INTENSITY [7:0]                  0000h
            intensity
R149 (95h) Haptics phase 2   0   0    0      0     0                          PHASE2_DURATION [10:0]                             0000h
            duration
R150 (96h) Haptics phase 3   0   0    0      0     0   0     0      0                    PHASE3_INTENSITY [7:0]                  0000h
            intensity
R151 (97h) Haptics phase 3   0   0    0      0     0   0     0                        PHASE3_DURATION [8:0]                      0000h
            duration
R152 (98h) Haptics Status    0   0    0      0     0   0     0      0      0       0     0     0       0       0    0      ONES  0000h
                                                                                                                         HOT_S
                                                                                                                            TS
R256 (100h) Clock 32k 1      0   0    0      0     0   0     0      0      0    CLK_3    0     0       0       0  CLK_32K_SRC    0002h
                                                                                2K_EN                                 [1:0]
                                                                                   A
R257 (101h) System Clock 1 SYSCL 0    0      0     0  SYSCLK_FREQ [2:0]    0    SYSCL    0     0          SYSCLK_SRC [3:0]       0304h
                           K_FRA                                                K_ENA
264                                                                                                                            Rev 4.1


                                                                                                                 WM8998
   REG            NAME       15  14 13 12 11    10      9        8      7        6      5       4       3      2      1       0 DEFAULT
                              C
R258 (102h) Sample rate 1     0  0  0  0  0      0      0        0     0         0     0              SAMPLE_RATE_1 [4:0]        0011h
R259 (103h) Sample rate 2     0  0  0  0  0      0      0        0     0         0     0              SAMPLE_RATE_2 [4:0]        0011h
R260 (104h) Sample rate 3     0  0  0  0  0      0      0        0     0         0     0              SAMPLE_RATE_3 [4:0]        0011h
R266 (10Ah) Sample rate 1     0  0  0  0  0      0      0        0     0         0     0            SAMPLE_RATE_1_STS [4:0]      0000h
            status
R267 (10Bh) Sample rate 2     0  0  0  0  0      0      0        0     0         0     0            SAMPLE_RATE_2_STS [4:0]      0000h
            status
R268 (10Ch) Sample rate 3     0  0  0  0  0      0      0        0     0         0     0            SAMPLE_RATE_3_STS [4:0]      0000h
            status
R274 (112h) Async clock 1     0  0  0  0  0     ASYNC_CLK_FREQ         0       ASYN    0        0         ASYNC_CLK_SRC [3:0]    0305h
                                                      [2:0]                  C_CLK
                                                                               _ENA
R275 (113h) Async sample      0  0  0  0  0      0      0        0     0         0     0           ASYNC_SAMPLE_RATE_1 [4:0]     0011h
            rate 1
R276 (114h) Async sample      0  0  0  0  0      0      0        0     0         0     0           ASYNC_SAMPLE_RATE_2 [4:0]     0011h
            rate 2
R283 (11Bh) Async sample      0  0  0  0  0      0      0        0     0         0     0       ASYNC_SAMPLE_RATE_1_STS [4:0]     0000h
            rate 1 status
R284 (11Ch) Async sample      0  0  0  0  0      0      0        0     0         0     0       ASYNC_SAMPLE_RATE_2_STS [4:0]     0000h
            rate 2 status
R329 (149h) Output system  OPCLK 0  0  0  0      0      0        0                OPCLK_DIV [4:0]              OPCLK_SEL [2:0]   0000h
            clock           _ENA
R330 (14Ah) Output async   OPCLK 0  0  0  0      0      0        0           OPCLK_ASYNC_DIV [4:0]            OPCLK_ASYNC_SEL    0000h
            clock          _ASYN                                                                                    [2:0]
                           C_ENA
R338 (152h) Rate Estimator    0  0  0  0  0      0      0        0     0         0     0      TRIG_     LRCLK_SRC [2:0]   RATE_  0000h
            1                                                                                ON_ST                        EST_E
                                                                                             ARTUP                          NA
R339 (153h) Rate Estimator    0  0  0  0  0      0      0        0     0         0     0          SAMPLE_RATE_DETECT_A [4:0]     0000h
            2
R340 (154h) Rate Estimator    0  0  0  0  0      0      0        0     0         0     0          SAMPLE_RATE_DETECT_B [4:0]     0000h
            3
R341 (155h) Rate Estimator    0  0  0  0  0      0      0        0     0         0     0          SAMPLE_RATE_DETECT_C [4:0]     0000h
            4
R342 (156h) Rate Estimator    0  0  0  0  0      0      0        0     0         0     0          SAMPLE_RATE_DETECT_D [4:0]     0000h
            5
R353 (161h) Dynamic           0  0  0  0  0      0      0        0     0         0     0        0       0      0      0   SUBSY  0000h
            Frequency                                                                                                     S_MAX
            Scaling 1                                                                                                     _FREQ
R369 (171h) FLL1 Control 1    0  0  0  0  0      0      0        0     0         0     0        0       0      0   FLL1_ FLL1_   0002h
                                                                                                                   FREER ENA
                                                                                                                     UN
R370 (172h) FLL1 Control 2 FLL1_ 0  0  0  0      0                                    FLL1_N [9:0]                               0008h
                           CTRL_
                            UPD
R371 (173h) FLL1 Control 3                                   FLL1_THETA [15:0]                                                   0018h
R372 (174h) FLL1 Control 4                                  FLL1_LAMBDA [15:0]                                                   007Dh
R373 (175h) FLL1 Control 5    0  0  0  0     FLL1_FRATIO [3:0]         0         0     0        0      FLL1_OUTDIV [2:0]      0  0004h
R374 (176h) FLL1 Control 6    0  0  0  0  0      0      0        0   FLL1_REFCLK_      0        0        FLL1_REFCLK_SRC [3:0]   0000h
                                                                        DIV [1:0]
R375 (177h) FLL1 Loop      FLL1_ 0  0  0                              FLL1_FRC_INTEG_VAL [11:0]                                  0181h
            Filter Test 1  FRC_I
                           NTEG_
                            UPD
R376 (178h) FLL1 NCO Test FLL1_I 0  0  0                                    FLL1_INTEG [11:0]                                    0000h
            0              NTEG_
Rev 4.1                                                                                                                            265


                                                                                                                   WM8998
   REG            NAME       15  14 13 12 11    10      9        8      7        6     5         4     3         2   1        0   DEFAULT
                           VALID
R377 (179h) FLL1 Control 7   0   0  0  0  0      0      0        0     0        0            FLL1_GAIN [3:0]         0        0    0000h
R385 (181h) FLL1             0   0  0  0  0      0      0        0     0        0      0         0     0         0   0      FLL1_  0000h
            Synchroniser 1                                                                                                 SYNC_
                                                                                                                             ENA
R386 (182h) FLL1             0   0  0  0  0      0                                 FLL1_SYNC_N [9:0]                               0000h
            Synchroniser 2
R387 (183h) FLL1                                        FLL1_SYNC_THETA [15:0]                                                     0000h
            Synchroniser 3
R388 (184h) FLL1                                       FLL1_SYNC_LAMBDA [15:0]                                                     0000h
            Synchroniser 4
R389 (185h) FLL1             0   0  0  0  0    FLL1_SYNC_FRATIO        0        0      0         0     0         0   0        0    0000h
            Synchroniser 5                            [2:0]
R390 (186h) FLL1             0   0  0  0  0      0      0        0   FLL1_SYNCCL       0         0    FLL1_SYNCCLK_SRC [3:0]       0000h
            Synchroniser 6                                             K_DIV [1:0]
R391 (187h) FLL1             0   0  0  0  0      0      0        0     0        0        FLL1_SYNC_GAIN [3:0]        0      FLL1_  0001h
            Synchroniser 7                                                                                                 SYNC_
                                                                                                                           DFSAT
R393 (189h) FLL1 Spread      0   0  0  0  0      0      0        0     0        0    FLL1_SS_AMP FLL1_SS_FRE FLL1_SS_SEL           0000h
            Spectrum                                                                     L [1:0]         Q [1:0]        [1:0]
R394 (18Ah) FLL1 GPIO        0   0  0  0  0      0      0        0                   FLL1_GPCLK_DIV [6:0]                   FLL1_  0004h
            Clock                                                                                                          GPCLK
                                                                                                                            _ENA
R401 (191h) FLL2 Control 1   0   0  0  0  0      0      0        0     0        0      0         0     0         0 FLL2_ FLL2_     0000h
                                                                                                                   FREER ENA
                                                                                                                    UN
R402 (192h) FLL2 Control 2 FLL2_ 0  0  0  0      0                                    FLL2_N [9:0]                                 0008h
                           CTRL_
                            UPD
R403 (193h) FLL2 Control 3                                   FLL2_THETA [15:0]                                                     0018h
R404 (194h) FLL2 Control 4                                  FLL2_LAMBDA [15:0]                                                     007Dh
R405 (195h) FLL2 Control 5   0   0  0  0     FLL2_FRATIO [3:0]         0        0      0         0    FLL2_OUTDIV [2:0]       0    0004h
R406 (196h) FLL2 Control 6   0   0  0  0  0      0      0        0   FLL2_REFCLK_      0         0      FLL2_REFCLK_SRC [3:0]      0000h
                                                                        DIV [1:0]
R407 (197h) FLL2 Loop      FLL2_ 0  0  0                              FLL2_FRC_INTEG_VAL [11:0]                                    0000h
            Filter Test 1  FRC_I
                           NTEG_
                            UPD
R408 (198h) FLL2 NCO Test FLL2_I 0  0  0                                    FLL2_INTEG [11:0]                                      0000h
            0              NTEG_
                           VALID
R409 (199h) FLL2 Control 7   0   0  0  0  0      0      0        0     0        0            FLL2_GAIN [3:0]         0        0    0000h
R417 (1A1h) FLL2             0   0  0  0  0      0      0        0     0        0      0         0     0         0   0      FLL2_  0000h
            Synchroniser 1                                                                                                 SYNC_
                                                                                                                             ENA
R418 (1A2h) FLL2             0   0  0  0  0      0                                 FLL2_SYNC_N [9:0]                               0000h
            Synchroniser 2
R419 (1A3h) FLL2                                        FLL2_SYNC_THETA [15:0]                                                     0000h
            Synchroniser 3
R420 (1A4h) FLL2                                       FLL2_SYNC_LAMBDA [15:0]                                                     0000h
            Synchroniser 4
R421 (1A5h) FLL2             0   0  0  0  0    FLL2_SYNC_FRATIO        0        0      0         0     0         0   0        0    0000h
            Synchroniser 5                            [2:0]
R422 (1A6h) FLL2             0   0  0  0  0      0      0        0   FLL2_SYNCCL       0         0    FLL2_SYNCCLK_SRC [3:0]       0000h
            Synchroniser 6                                             K_DIV [1:0]
R423 (1A7h) FLL2             0   0  0  0  0      0      0        0     0        0        FLL2_SYNC_GAIN [3:0]        0      FLL2_  0001h
            Synchroniser 7                                                                                                 SYNC_
266                                                                                                                             Rev 4.1


                                                                                                                                       WM8998
   REG           NAME           15     14     13     12   11      10    9       8      7         6      5         4        3         2       1         0 DEFAULT
                                                                                                                                                  DFSAT
R425 (1A9h) FLL2 Spread         0      0       0     0    0       0    0        0      0        0    FLL2_SS_AMP FLL2_SS_FRE FLL2_SS_SEL                  0000h
            Spectrum                                                                                      L [1:0]            Q [1:0]           [1:0]
   R426     FLL2 GPIO           0      0       0     0    0       0    0        0                    FLL2_GPCLK_DIV [6:0]                          FLL2_  0004h
  (1AAh)    Clock                                                                                                                                 GPCLK
                                                                                                                                                    _ENA
R512 (200h) Mic Charge          0      0       0     0    0       0    0        0      0        0       0         0        0     CP2_D CP2_B CP2_E        0006h
            Pump 1                                                                                                                ISCH YPASS NA
R528 (210h) LDO1 Control 1      0      0       0     0    0                  LDO1_VSEL [5:0]                      1        0     LDO1_ LDO1_ LDO1_        00D4h
                                                                                                                                 DISCH BYPAS ENA
                                                                                                                                             S
R530 (212h) LDO1 Control 2      0      0       0     0    0       0    0        0      0        0       0         0        0         0       0    LDO1_   0001h
                                                                                                                                                  HI_PW
                                                                                                                                                      R
R531 (213h) LDO2 Control 1      0      0       0     0    0                  LDO2_VSEL [5:0]                      0        0     LDO2_       0         0  0344h
                                                                                                                                 DISCH
R536 (218h) Mic Bias Ctrl 1   MICB1    0       0     0    0       0    0            MICB1_LVL [3:0]               0     MICB1 MICB1 MICB1 MICB1           01A6h
                              _EXT_                                                                                    _RATE _DISC _BYPA _ENA
                               CAP                                                                                                   H      SS
R537 (219h) Mic Bias Ctrl 2   MICB2    0       0     0    0       0    0            MICB2_LVL [3:0]               0     MICB2 MICB2 MICB2 MICB2           01A6h
                              _EXT_                                                                                    _RATE _DISC _BYPA _ENA
                               CAP                                                                                                   H      SS
R538 (21Ah) Mic Bias Ctrl 3   MICB3    0       0     0    0       0    0            MICB3_LVL [3:0]               0     MICB3 MICB3 MICB3 MICB3           01A6h
                              _EXT_                                                                                    _RATE _DISC _BYPA _ENA
                               CAP                                                                                                   H      SS
R659 (293h) Accessory           0      0    ACCD     0    0       0    0        0      1        0       0         0        0       ACCDET_MODE [2:0]      0080h
            Detect Mode 1                  ET_SR
                                              C
R667 (29Bh) Headphone           0      0       0     0    0    HP_IMPEDANC      0     HP_HOLDTIME [2:0]         HP_CLK_DIV           0       0    HP_PO   0000h
            Detect 1                                           E_RANGE [1:0]                                        [1:0]                             LL
R668 (29Ch) Headphone         HP_D                                                HP_LVL [14:0]                                                           0000h
            Detect 2           ONE
R674 (2A2h) Micd Clamp          0      0       0     0    0       0    0        0      0        0       0         0        MICD_CLAMP_MODE [3:0]          0000h
            control
R675 (2A3h) Mic Detect 1       MICD_BIAS_STARTTIME [3:0]      MICD_RATE [3:0]          0        0    MICD_BIAS_SR          0         0    MICD_ MICD_     1102h
                                                                                                          C [1:0]                         DBTIM ENA
                                                                                                                                             E
R676 (2A4h) Mic Detect 2        0   MICDET_HOLD      0    0       0    0        0                          MICD_LVL_SEL [7:0]                             009Fh
                                      _TIME [1:0]
R677 (2A5h) Mic Detect 3        0      0       0     0    0                              MICD_LVL [8:0]                                   MICD_ MICD_     0000h
                                                                                                                                           VALID STS
   R683     Mic Detect 4                     MICDET_ADCVAL_DIFF [7:0]                  0                       MICDET_ADCVAL [6:0]                        0000h
  (2ABh)
   R715     Isolation control   0      0       0     0    0       0    0        0      0        0       0         0        0         0       0     ISOLA  0000h
  (2CBh)                                                                                                                                          TE_DC
                                                                                                                                                    VDD1
R723 (2D3h) Jack detect         0      0       0     0    0       0    0        0      0        0       0         0        0         0       0     JD1_E  0000h
            analogue                                                                                                                                  NA
R768 (300h) Input Enables       0      0       0     0    0       0    0        0      0        0       0         0     IN2_E        0    IN1L_E IN1R_    0000h
                                                                                                                          NA                NA       ENA
R769 (301h) Input Enables       0      0       0     0    0       0    0        0      0        0       0         0     IN2_E        0    IN1L_E IN1R_    0000h
            Status                                                                                                     NA_ST              NA_ST ENA_S
                                                                                                                          S                  S        TS
R776 (308h) Input Rate          0           IN_RATE [3:0]         0    0        0      0        0       0         0        0         0       0         0  0000h
R777 (309h) Input Volume        0      0       0     0    0       0    0        0      0        IN_VD_RAMP [2:0]           0         IN_VI_RAMP [2:0]     0022h
            Ramp
R780 (30Ch) HPF Control         0      0       0     0    0       0    0        0      0        0       0         0        0         IN_HPF_CUT [2:0]     0002h
Rev 4.1                                                                                                                                                     267


                                                                                                                        WM8998
   REG           NAME          15     14     13    12       11  10     9     8     7     6     5       4       3      2       1     0   DEFAULT
R784 (310h) IN1L Control    IN1L_H IN1_OSR [1:0] IN1_DMIC_SUP IN1_M    0     0               IN1L_PGA_VOL [6:0]                    0     2080h
                               PF                     [1:0]    ODE
R785 (311h) ADC Digital         0  IN1L_SRC [1:0]   0       0   0   IN_VU IN1L_                     IN1L_VOL [7:0]                       0180h
            Volume 1L                                                      MUTE
R786 (312h) DMIC1L Control      0     0      0      0       0   0      0     0    0      0               IN1L_DMIC_DLY [5:0]             0000h
R788 (314h) IN1R Control     IN1R_    0      0      0       0   0      0     0               IN1R_PGA_VOL [6:0]                    0     0080h
                              HPF
R789 (315h) ADC Digital         0  IN1R_SRC [1:0]   0       0   0   IN_VU IN1R_                     IN1R_VOL [7:0]                       0180h
            Volume 1R                                                      MUTE
R790 (316h) DMIC1R              0     0      0      0       0   0      0     0    0      0               IN1R_DMIC_DLY [5:0]             0000h
            Control
R792 (318h) IN2L Control     IN2_H IN2_OSR [1:0] IN2_DMIC_SUP IN2_M    0     0                IN2_PGA_VOL [6:0]                    0     2080h
                               PF                     [1:0]    ODE
R793 (319h) ADC Digital         0   IN2_SRC [1:0]   0       0   0   IN_VU IN2_M                      IN2_VOL [7:0]                       0180h
            Volume 2L                                                       UTE
R794 (31Ah) DMIC2L Control      0     0      0      0       0   0      0     0    0      0                IN2_DMIC_DLY [5:0]             0000h
  R1024     Output Enables      0     0      0      0       0   0   OUT5L OUT5R SPKO SPKO EP_EN        0    LINEL_ LINER HPL_E HPR_E     0000h
  (400h)    1                                                        _ENA _ENA UTL_E UTR_E     A             ENA _ENA        NA   NA
                                                                                 NA     NA
  R1025     Output Status 1     0     0      0      0       0   0   OUT5L OUT5R OUT4L OUT4R    0       0       0      0       0    0     0000h
  (401h)                                                            _ENA_ _ENA_ _ENA_ _ENA_
                                                                      STS   STS  STS   STS
  R1030     Raw Output          0     0      0      0       0   0      0     0    0      0  OUT3_      0    OUT2L OUT2R OUT1L OUT1R      0000h
  (406h)    Status 1                                                                        ENA_S           _ENA_ _ENA_ _ENA_ _ENA_
                                                                                              TS             STS    STS      STS  STS
  R1032     Output Rate 1       0         OUT_RATE [3:0]        0      0     0    0      0     0       0       0      0       0    0     0000h
  (408h)
  R1033     Output Volume       0     0      0      0       0   0      0     0    0    OUT_VD_RAMP [2:0]       0     OUT_VI_RAMP [2:0]   0022h
  (409h)    Ramp
  R1040     Output Path         0     0   OUT1_ OUT1_       0   0      0     0    0      0     0       0       0      0       0    0     0000h
  (410h)    Config 1L                      OSR MONO
  R1041     DAC Digital         0     0      0      0       0   0   OUT_V OUT1L                    OUT1L_VOL [7:0]                       0180h
  (411h)    Volume 1L                                                  U  _MUTE
  R1043     Noise Gate          0     0      0      0                             OUT1L_NGATE_SRC [11:0]                                 0001h
  (413h)    Select 1L
  R1045     DAC Digital         0     0      0      0       0   0   OUT_V OUT1R                   OUT1R_VOL [7:0]                        0180h
  (415h)    Volume 1R                                                  U  _MUTE
  R1047     Noise Gate          0     0      0      0                             OUT1R_NGATE_SRC [11:0]                                 0002h
  (417h)    Select 1R
  R1048     Output Path         0     0   OUT2_ OUT2_       0   0      0     0    0      0     0       0       0      0       0    0     0000h
  (418h)    Config 2L                      OSR MONO
  R1049     DAC Digital         0     0      0      0       0   0   OUT_V OUT2L                    OUT2L_VOL [7:0]                       0180h
  (419h)    Volume 2L                                                  U  _MUTE
  R1051     Noise Gate          0     0      0      0                             OUT2L_NGATE_SRC [11:0]                                 0004h
  (41Bh)    Select 2L
  R1053     DAC Digital         0     0      0      0       0   0   OUT_V OUT2R                   OUT2R_VOL [7:0]                        0180h
  (41Dh)    Volume 2R                                                  U  _MUTE
  R1055     Noise Gate          0     0      0      0                             OUT2R_NGATE_SRC [11:0]                                 0008h
  (41Fh)    Select 2R
  R1057     DAC Digital         0     0      0      0       0   0   OUT_V OUT3_                    OUT3_VOL [7:0]                        0180h
  (421h)    Volume 3L                                                  U   MUTE
  R1059     Noise Gate          0     0      0      0                             OUT3_NGATE_SRC [11:0]                                  0010h
  (423h)    Select 3L
  R1064     Output Path         0     0   OUT4_     0       0   0      0     0    0      0     0       0       0      0       0    0     0000h
  (428h)    Config 4L                      OSR
  R1065     DAC Digital         0     0      0      0       0   0   OUT_V OUT4L                    OUT4L_VOL [7:0]                       0180h
  (429h)    Volume 4L                                                  U  _MUTE
268                                                                                                                                    Rev 4.1


                                                                                                                        WM8998
  REG        NAME        15 14    13    12        11    10       9     8      7       6      5        4      3       2        1       0 DEFAULT
 R1067  Noise Gate       0  0     0     0                                    OUT4L_NGATE_SRC [11:0]                                      0040h
 (42Bh) Select 4L
 R1069  DAC Digital      0  0     0     0         0     0      OUT_V OUT4R                        OUT4R_VOL [7:0]                        0180h
 (42Dh) Volume 4R                                                U   _MUTE
 R1071  Noise Gate       0  0     0     0                                    OUT4R_NGATE_SRC [11:0]                                      0080h
 (42Fh) Select 4R
 R1072  Output Path      0  0  OUT5_    0         0     0        0     0      0       0      0        0      0       0        0       0  0000h
 (430h) Config 5L               OSR
 R1073  DAC Digital      0  0     0     0         0     0      OUT_V OUT5L                        OUT5L_VOL [7:0]                        0180h
 (431h) Volume 5L                                                U   _MUTE
 R1075  Noise Gate       0  0     0     0                                    OUT5L_NGATE_SRC [11:0]                                      0100h
 (433h) Select 5L
 R1077  DAC Digital      0  0     0     0         0     0      OUT_V OUT5R                        OUT5R_VOL [7:0]                        0180h
 (435h) Volume 5R                                                U   _MUTE
 R1079  Noise Gate       0  0     0     0                                    OUT5R_NGATE_SRC [11:0]                                      0200h
 (437h) Select 5R
 R1104  DAC AEC          0  0     0     0         0     0        0     0      0       0     AEC1_LOOPBACK_SRC [3:0]        AEC1_ AEC1_   0000h
 (450h) Control 1                                                                                                         ENA_S LOOP
                                                                                                                             TS BACK_
                                                                                                                                    ENA
 R1105  DAC AEC          0  0     0     0         0     0        0     0      0       0     AEC2_LOOPBACK_SRC [3:0]        AEC2_ AEC2_   0000h
 (451h) Control 2                                                                                                         ENA_S LOOP
                                                                                                                             TS BACK_
                                                                                                                                    ENA
 R1112  Noise Gate       0  0     0     0         0     0        0     0      0       0   NGATE_HOLD         NGATE_THR [2:0]       NGAT  0000h
 (458h) Control                                                                                 [1:0]                             E_ENA
 R1168  PDM SPK1         0  0  SPK1R SPK1L        0     0        0   SPK1_                     SPK1_MUTE_SEQ [7:0]                       0069h
 (490h) CTRL 1                 _MUTE _MUTE                           MUTE_
                                                                     ENDIA
                                                                       N
 R1169  PDM SPK1         0  0     0     0         0     0        0     0      0       0      0        0      0       0        0   SPK1_  0000h
 (491h) CTRL 2                                                                                                                      FMT
 R1280  AIF1 BCLK Ctrl   0  0     0     0         0     0        0     0   AIF1_B AIF1_B AIF1_B           AIF1_BCLK_FREQ [4:0]           000Ch
 (500h)                                                                    CLK_I CLK_F CLK_M
                                                                             NV      RC    STR
 R1281  AIF1 Tx Pin Ctrl 0  0     0     0         0     0        0     0      0       0   AIF1TX      0      1       0        0       0  0008h
 (501h)                                                                                   _DAT_
                                                                                            TRI
 R1282  AIF1 Rx Pin Ctrl 0  0     0     0         0     0        0     0      0       0      0        0      0    AIF1_L AIF1_L AIF1_L   0000h
 (502h)                                                                                                           RCLK_ RCLK_ RCLK_
                                                                                                                   INV      FRC MSTR
 R1283  AIF1 Rate Ctrl   0     AIF1_RATE [3:0]          0        0     0      0    AIF1_T    0        0      0       0        0       0  0000h
 (503h)                                                                              RI
 R1284  AIF1 Format      0  0     0     0         0     0        0     0      0       0      0        0      0         AIF1_FMT [2:0]    0000h
 (504h)
 R1286  AIF1 Rx BCLK     0  0     0                                           AIF1_BCPF [12:0]                                           0040h
 (506h) Rate
 R1287  AIF1 Frame Ctrl  0  0                  AIF1TX_WL [5:0]                                 AIF1TX_SLOT_LEN [7:0]                     1818h
 (507h) 1
 R1288  AIF1 Frame Ctrl  0  0                  AIF1RX_WL [5:0]                                 AIF1RX_SLOT_LEN [7:0]                     1818h
 (508h) 2
 R1289  AIF1 Frame Ctrl  0  0     0     0         0     0        0     0      0       0                 AIF1TX1_SLOT [5:0]               0000h
 (509h) 3
 R1290  AIF1 Frame Ctrl  0  0     0     0         0     0        0     0      0       0                 AIF1TX2_SLOT [5:0]               0001h
 (50Ah) 4
 R1291  AIF1 Frame Ctrl  0  0     0     0         0     0        0     0      0       0                 AIF1TX3_SLOT [5:0]               0002h
 (50Bh) 5
 R1292  AIF1 Frame Ctrl  0  0     0     0         0     0        0     0      0       0                 AIF1TX4_SLOT [5:0]               0003h
Rev 4.1                                                                                                                                    269


                                                                                                                WM8998
  REG        NAME        15 14    13    12        11    10     9 8    7       6      5       4       3       2       1        0  DEFAULT
 (50Ch) 6
 R1293  AIF1 Frame Ctrl  0  0     0     0         0     0      0 0    0       0                AIF1TX5_SLOT [5:0]                 0004h
 (50Dh) 7
 R1294  AIF1 Frame Ctrl  0  0     0     0         0     0      0 0    0       0                AIF1TX6_SLOT [5:0]                 0005h
 (50Eh) 8
 R1297  AIF1 Frame Ctrl  0  0     0     0         0     0      0 0    0       0                AIF1RX1_SLOT [5:0]                 0000h
 (511h) 11
 R1298  AIF1 Frame Ctrl  0  0     0     0         0     0      0 0    0       0                AIF1RX2_SLOT [5:0]                 0001h
 (512h) 12
 R1299  AIF1 Frame Ctrl  0  0     0     0         0     0      0 0    0       0                AIF1RX3_SLOT [5:0]                 0002h
 (513h) 13
 R1300  AIF1 Frame Ctrl  0  0     0     0         0     0      0 0    0       0                AIF1RX4_SLOT [5:0]                 0003h
 (514h) 14
 R1301  AIF1 Frame Ctrl  0  0     0     0         0     0      0 0    0       0                AIF1RX5_SLOT [5:0]                 0004h
 (515h) 15
 R1302  AIF1 Frame Ctrl  0  0     0     0         0     0      0 0    0       0                AIF1RX6_SLOT [5:0]                 0005h
 (516h) 16
 R1305  AIF1 Tx          0  0     0     0         0     0      0 0    0       0   AIF1TX AIF1TX AIF1TX AIF1TX AIF1TX AIF1TX       0000h
 (519h) Enables                                                                   6_ENA 5_ENA 4_ENA 3_ENA 2_ENA 1_ENA
 R1306  AIF1 Rx          0  0     0     0         0     0      0 0    0       0   AIF1R AIF1R AIF1R AIF1R AIF1R AIF1R             0000h
 (51Ah) Enables                                                                   X6_EN X5_EN X4_EN X3_EN X2_EN X1_EN
                                                                                     A       A      A       A        A        A
 R1344  AIF2 BCLK Ctrl   0  0     0     0         0     0      0 0 AIF2_B AIF2_B AIF2_B           AIF2_BCLK_FREQ [4:0]            000Ch
 (540h)                                                            CLK_I CLK_F CLK_M
                                                                     NV      RC    STR
 R1345  AIF2 Tx Pin Ctrl 0  0     0     0         0     0      0 0    0       0   AIF2TX     0      1       0        0        0   0008h
 (541h)                                                                           _DAT_
                                                                                    TRI
 R1346  AIF2 Rx Pin Ctrl 0  0     0     0         0     0      0 0    0       0      0       0      0    AIF2_L AIF2_L AIF2_L     0000h
 (542h)                                                                                                  RCLK_ RCLK_ RCLK_
                                                                                                          INV       FRC MSTR
 R1347  AIF2 Rate Ctrl   0     AIF2_RATE [3:0]          0      0 0    0    AIF2_T    0       0      0       0        0        0   0000h
 (543h)                                                                      RI
 R1348  AIF2 Format      0  0     0     0         0     0      0 0    0       0      0       0      0          AIF2_FMT [2:0]     0000h
 (544h)
 R1350  AIF2 Rx BCLK     0  0     0                                   AIF2_BCPF [12:0]                                            0040h
 (546h) Rate
 R1351  AIF2 Frame Ctrl  0  0                  AIF2TX_WL [5:0]                         AIF2TX_SLOT_LEN [7:0]                      1818h
 (547h) 1
 R1352  AIF2 Frame Ctrl  0  0                  AIF2RX_WL [5:0]                         AIF2RX_SLOT_LEN [7:0]                      1818h
 (548h) 2
 R1353  AIF2 Frame Ctrl  0  0     0     0         0     0      0 0    0       0                AIF2TX1_SLOT [5:0]                 0000h
 (549h) 3
 R1354  AIF2 Frame Ctrl  0  0     0     0         0     0      0 0    0       0                AIF2TX2_SLOT [5:0]                 0001h
 (54Ah) 4
 R1355  AIF2 Frame Ctrl  0  0     0     0         0     0      0 0    0       0                AIF2TX3_SLOT [5:0]                 0002h
 (54Bh) 5
 R1356  AIF2 Frame Ctrl  0  0     0     0         0     0      0 0    0       0                AIF2TX4_SLOT [5:0]                 0003h
 (54Ch) 6
 R1357  AIF2 Frame Ctrl  0  0     0     0         0     0      0 0    0       0                AIF2TX5_SLOT [5:0]                 0004h
 (54Dh) 7
 R1358  AIF2 Frame Ctrl  0  0     0     0         0     0      0 0    0       0                AIF2TX6_SLOT [5:0]                 0005h
 (54Eh) 8
 R1361  AIF2 Frame Ctrl  0  0     0     0         0     0      0 0    0       0                AIF2RX1_SLOT [5:0]                 0000h
 (551h) 11
 R1362  AIF2 Frame Ctrl  0  0     0     0         0     0      0 0    0       0                AIF2RX2_SLOT [5:0]                 0001h
 (552h) 12
270                                                                                                                             Rev 4.1


                                                                                                                            WM8998
  REG        NAME        15    14     13     12       11     10    9       8    7       6      5       4       3         2        1       0  DEFAULT
 R1363  AIF2 Frame Ctrl  0     0      0       0       0      0     0       0    0       0                AIF2RX3_SLOT [5:0]                   0002h
 (553h) 13
 R1364  AIF2 Frame Ctrl  0     0      0       0       0      0     0       0    0       0                AIF2RX4_SLOT [5:0]                   0003h
 (554h) 14
 R1365  AIF2 Frame Ctrl  0     0      0       0       0      0     0       0    0       0                AIF2RX5_SLOT [5:0]                   0004h
 (555h) 15
 R1366  AIF2 Frame Ctrl  0     0      0       0       0      0     0       0    0       0                AIF2RX6_SLOT [5:0]                   0005h
 (556h) 16
 R1369  AIF2 Tx          0     0      0       0       0      0     0       0    0       0   AIF2TX AIF2TX AIF2TX AIF2TX AIF2TX AIF2TX         0000h
 (559h) Enables                                                                             6_ENA 5_ENA 4_ENA 3_ENA 2_ENA 1_ENA
 R1370  AIF2 Rx          0     0      0       0       0      0     0       0    0       0   AIF2R AIF2R AIF2R AIF2R AIF2R AIF2R               0000h
 (55Ah) Enables                                                                             X6_EN X5_EN X4_EN X3_EN X2_EN X1_EN
                                                                                               A       A      A         A        A        A
 R1408  AIF3 BCLK Ctrl   0     0      0       0       0      0     0       0 AIF3_B AIF3_B AIF3_B           AIF3_BCLK_FREQ [4:0]              000Ch
 (580h)                                                                      CLK_I CLK_F CLK_M
                                                                               NV      RC    STR
 R1409  AIF3 Tx Pin Ctrl 0     0      0       0       0      0     0       0    0       0   AIF3TX     0       1         0       0        0   0008h
 (581h)                                                                                     _DAT_
                                                                                              TRI
 R1410  AIF3 Rx Pin Ctrl 0     0      0       0       0      0     0       0    0       0      0       0       0    AIF3_L AIF3_L AIF3_L      0000h
 (582h)                                                                                                             RCLK_ RCLK_ RCLK_
                                                                                                                       INV      FRC MSTR
 R1411  AIF3 Rate Ctrl   0         AIF3_RATE [3:0]           0     0       0    0    AIF3_T    0       0       0         0       0        0   0000h
 (583h)                                                                                RI
 R1412  AIF3 Format      0     0      0       0       0      0     0       0    0       0      0       0       0           AIF3_FMT [2:0]     0000h
 (584h)
 R1414  AIF3 Rx BCLK     0     0      0                                         AIF3_BCPF [12:0]                                              0040h
 (586h) Rate
 R1415  AIF3 Frame Ctrl  0     0                   AIF3TX_WL [5:0]                               AIF3TX_SLOT_LEN [7:0]                        1818h
 (587h) 1
 R1416  AIF3 Frame Ctrl  0     0                   AIF3RX_WL [5:0]                               AIF3RX_SLOT_LEN [7:0]                        1818h
 (588h) 2
 R1417  AIF3 Frame Ctrl  0     0      0       0       0      0     0       0    0       0                 AIF3TX1_SLOT [5:0]                  0000h
 (589h) 3
 R1418  AIF3 Frame Ctrl  0     0      0       0       0      0     0       0    0       0                 AIF3TX2_SLOT [5:0]                  0001h
 (58Ah) 4
 R1425  AIF3 Frame Ctrl  0     0      0       0       0      0     0       0    0       0                AIF3RX1_SLOT [5:0]                   0000h
 (591h) 11
 R1426  AIF3 Frame Ctrl  0     0      0       0       0      0     0       0    0       0                AIF3RX2_SLOT [5:0]                   0001h
 (592h) 12
 R1433  AIF3 Tx          0     0      0       0       0      0     0       0    0       0      0       0       0         0    AIF3TX AIF3TX   0000h
 (599h) Enables                                                                                                                2_ENA 1_ENA
 R1434  AIF3 Rx          0     0      0       0       0      0     0       0    0       0      0       0       0         0     AIF3R AIF3R    0000h
 (59Ah) Enables                                                                                                                X2_EN X1_EN
                                                                                                                                 A        A
 R1474  SPD1 TX          0     0   SPD1_ SPD1_        0      0     0       0        SPD1_RATE [3:0]            0         0       0     SPD1_  0000h
 (5C2h) Control                     VAL2 VAL1                                                                                            ENA
 R1475  SPD1 TX                          SPD1_CATCODE [7:0]                  SPD1_CHSTM      SPD1_PREEMPH [2:0] SPD1_ SPD1_ SPD1_             0000h
 (5C3h) Channel Status                                                          ODE [1:0]                            NOCO NOAU PRO
        1                                                                                                               PY      DIO
 R1476  SPD1 TX             SPD1_FREQ [3:0]              SPD1_CHNUM2 [3:0]        SPD1_CHNUM1 [3:0]              SPD1_SRCNUM [3:0]            0B01h
 (5C4h) Channel Status
        2
 R1477  SPD1 TX          0     0      0       0         SPD1_ORGSAMP [3:0]      SPD1_TXWL [2:0]      SPD1_ SPD1_CS31_30 SPD1_CLKACU           0000h
 (5C5h) Channel Status                                                                               MAXW        [1:0]              [1:0]
        3                                                                                              L
 R1490  SLIMbus RX       0     0             SLIMRX2_PORT_ADDR [5:0]            0       0             SLIMRX1_PORT_ADDR [5:0]                 0100h
 (5D2h) Ports0
Rev 4.1                                                                                                                                         271


                                                                                                    WM8998
  REG        NAME        15  14     13    12       11  10      9  8 7 6      5     4        3     2     1       0  DEFAULT
 R1491  SLIMbus RX       0   0            SLIMRX4_PORT_ADDR [5:0]   0 0           SLIMRX3_PORT_ADDR [5:0]           0302h
 (5D3h) Ports1
 R1494  SLIMbus TX       0   0            SLIMTX2_PORT_ADDR [5:0]   0 0           SLIMTX1_PORT_ADDR [5:0]           0908h
 (5D6h) Ports0
 R1495  SLIMbus TX       0   0            SLIMTX4_PORT_ADDR [5:0]   0 0           SLIMTX3_PORT_ADDR [5:0]           0B0Ah
 (5D7h) Ports1
 R1496  SLIMbus TX       0   0            SLIMTX6_PORT_ADDR [5:0]   0 0           SLIMTX5_PORT_ADDR [5:0]           0D0Ch
 (5D8h) Ports2
 R1507  SLIMbus          0   0      0      0       0   0       0  0 0 0      0     0       SLIMCLK_REF_GEAR [3:0]   0004h
 (5E3h) Framer Ref
        Gear
 R1509  SLIMbus Rates    0      SLIMRX2_RATE [3:0]     0       0  0 0   SLIMRX1_RATE [3:0]        0     0      0    0000h
 (5E5h) 1
 R1510  SLIMbus Rates    0      SLIMRX4_RATE [3:0]     0       0  0 0   SLIMRX3_RATE [3:0]        0     0      0    0000h
 (5E6h) 2
 R1513  SLIMbus Rates    0      SLIMTX2_RATE [3:0]     0       0  0 0   SLIMTX1_RATE [3:0]        0     0      0    0000h
 (5E9h) 5
 R1514  SLIMbus Rates    0      SLIMTX4_RATE [3:0]     0       0  0 0   SLIMTX3_RATE [3:0]        0     0      0    0000h
 (5EAh) 6
 R1515  SLIMbus Rates    0      SLIMTX6_RATE [3:0]     0       0  0 0   SLIMTX5_RATE [3:0]        0     0      0    0000h
 (5EBh) 7
 R1525  SLIMbus RX       0   0      0      0       0   0       0  0 0 0      0     0     SLIMR SLIMR SLIMR SLIMR    0000h
 (5F5h) Channel Enable                                                                   X4_EN X3_EN X2_EN X1_EN
                                                                                           A      A     A      A
 R1526  SLIMbus TX       0   0      0      0       0   0       0  0 0 0    SLIMT SLIMT SLIMT SLIMT SLIMT SLIMT      0000h
 (5F6h) Channel Enable                                                    X6_EN X5_EN X4_EN X3_EN X2_EN X1_EN
                                                                             A     A       A      A     A      A
 R1527  SLIMbus RX       0   0      0      0       0   0       0  0 0 0      0     0     SLIMR SLIMR SLIMR SLIMR    0000h
 (5F7h) Port Status                                                                      X4_PO X3_PO X2_PO X1_PO
                                                                                         RT_ST RT_ST RT_ST RT_ST
                                                                                           S      S     S      S
 R1528  SLIMbus TX       0   0      0      0       0   0       0  0 0 0    SLIMT SLIMT SLIMT SLIMT SLIMT SLIMT      0000h
 (5F8h) Port Status                                                       X6_PO X5_PO X4_PO X3_PO X2_PO X1_PO
                                                                          RT_ST RT_ST RT_ST RT_ST RT_ST RT_ST
                                                                             S     S       S      S     S      S
 R1600  PWM1MIX        PWM1  0      0      0       0   0       0  0            PWM1MIX_SRC1 [7:0]                   0000h
 (640h) Input 1 Source MIX_S
                        TS1
 R1601  PWM1MIX          0   0      0      0       0   0       0  0         PWM1MIX_VOL1 [6:0]                 0    0080h
 (641h) Input 1 Volume
 R1602  PWM1MIX        PWM1  0      0      0       0   0       0  0            PWM1MIX_SRC2 [7:0]                   0000h
 (642h) Input 2 Source MIX_S
                        TS2
 R1603  PWM1MIX          0   0      0      0       0   0       0  0         PWM1MIX_VOL2 [6:0]                 0    0080h
 (643h) Input 2 Volume
 R1604  PWM1MIX        PWM1  0      0      0       0   0       0  0            PWM1MIX_SRC3 [7:0]                   0000h
 (644h) Input 3 Source MIX_S
                        TS3
 R1605  PWM1MIX          0   0      0      0       0   0       0  0         PWM1MIX_VOL3 [6:0]                 0    0080h
 (645h) Input 3 Volume
 R1606  PWM1MIX        PWM1  0      0      0       0   0       0  0            PWM1MIX_SRC4 [7:0]                   0000h
 (646h) Input 4 Source MIX_S
                        TS4
 R1607  PWM1MIX          0   0      0      0       0   0       0  0         PWM1MIX_VOL4 [6:0]                 0    0080h
 (647h) Input 4 Volume
 R1608  PWM2MIX        PWM2  0      0      0       0   0       0  0            PWM2MIX_SRC1 [7:0]                   0000h
 (648h) Input 1 Source MIX_S
                        TS1
272                                                                                                               Rev 4.1


                                                                              WM8998
  REG        NAME        15  14 13 12 11 10 9 8 7 6   5      4      3       2  1 0 DEFAULT
 R1609  PWM2MIX          0   0  0  0  0  0  0 0     PWM2MIX_VOL1 [6:0]           0  0080h
 (649h) Input 1 Volume
 R1610  PWM2MIX        PWM2  0  0  0  0  0  0 0         PWM2MIX_SRC2 [7:0]          0000h
 (64Ah) Input 2 Source MIX_S
                        TS2
 R1611  PWM2MIX          0   0  0  0  0  0  0 0     PWM2MIX_VOL2 [6:0]           0  0080h
 (64Bh) Input 2 Volume
 R1612  PWM2MIX        PWM2  0  0  0  0  0  0 0         PWM2MIX_SRC3 [7:0]          0000h
 (64Ch) Input 3 Source MIX_S
                        TS3
 R1613  PWM2MIX          0   0  0  0  0  0  0 0     PWM2MIX_VOL3 [6:0]           0  0080h
 (64Dh) Input 3 Volume
 R1614  PWM2MIX        PWM2  0  0  0  0  0  0 0         PWM2MIX_SRC4 [7:0]          0000h
 (64Eh) Input 4 Source MIX_S
                        TS4
 R1615  PWM2MIX          0   0  0  0  0  0  0 0     PWM2MIX_VOL4 [6:0]           0  0080h
 (64Fh) Input 4 Volume
 R1664  OUT1LMIX       OUT1L 0  0  0  0  0  0 0         OUT1LMIX_SRC1 [7:0]         0000h
 (680h) Input 1 Source MIX_S
                        TS1
 R1665  OUT1LMIX         0   0  0  0  0  0  0 0     OUT1LMIX_VOL1 [6:0]          0  0080h
 (681h) Input 1 Volume
 R1666  OUT1LMIX       OUT1L 0  0  0  0  0  0 0         OUT1LMIX_SRC2 [7:0]         0000h
 (682h) Input 2 Source MIX_S
                        TS2
 R1667  OUT1LMIX         0   0  0  0  0  0  0 0     OUT1LMIX_VOL2 [6:0]          0  0080h
 (683h) Input 2 Volume
 R1668  OUT1LMIX       OUT1L 0  0  0  0  0  0 0         OUT1LMIX_SRC3 [7:0]         0000h
 (684h) Input 3 Source MIX_S
                        TS3
 R1669  OUT1LMIX         0   0  0  0  0  0  0 0     OUT1LMIX_VOL3 [6:0]          0  0080h
 (685h) Input 3 Volume
 R1670  OUT1LMIX       OUT1L 0  0  0  0  0  0 0         OUT1LMIX_SRC4 [7:0]         0000h
 (686h) Input 4 Source MIX_S
                        TS4
 R1671  OUT1LMIX         0   0  0  0  0  0  0 0     OUT1LMIX_VOL4 [6:0]          0  0080h
 (687h) Input 4 Volume
 R1672  OUT1RMIX       OUT1R 0  0  0  0  0  0 0         OUT1RMIX_SRC1 [7:0]         0000h
 (688h) Input 1 Source MIX_S
                        TS1
 R1673  OUT1RMIX         0   0  0  0  0  0  0 0     OUT1RMIX_VOL1 [6:0]          0  0080h
 (689h) Input 1 Volume
 R1674  OUT1RMIX       OUT1R 0  0  0  0  0  0 0         OUT1RMIX_SRC2 [7:0]         0000h
 (68Ah) Input 2 Source MIX_S
                        TS2
 R1675  OUT1RMIX         0   0  0  0  0  0  0 0     OUT1RMIX_VOL2 [6:0]          0  0080h
 (68Bh) Input 2 Volume
 R1676  OUT1RMIX       OUT1R 0  0  0  0  0  0 0         OUT1RMIX_SRC3 [7:0]         0000h
 (68Ch) Input 3 Source MIX_S
                        TS3
 R1677  OUT1RMIX         0   0  0  0  0  0  0 0     OUT1RMIX_VOL3 [6:0]          0  0080h
 (68Dh) Input 3 Volume
 R1678  OUT1RMIX       OUT1R 0  0  0  0  0  0 0         OUT1RMIX_SRC4 [7:0]         0000h
 (68Eh) Input 4 Source MIX_S
                        TS4
 R1679  OUT1RMIX         0   0  0  0  0  0  0 0     OUT1RMIX_VOL4 [6:0]          0  0080h
 (68Fh) Input 4 Volume
 R1680  OUT2LMIX       OUT2L 0  0  0  0  0  0 0         OUT2LMIX_SRC1 [7:0]         0000h
Rev 4.1                                                                               273


                                                                              WM8998
  REG        NAME        15  14 13 12 11 10 9 8 7 6   5      4      3       2  1 0  DEFAULT
 (690h) Input 1 Source MIX_S
                        TS1
 R1681  OUT2LMIX         0   0  0  0  0  0  0 0     OUT2LMIX_VOL1 [6:0]          0   0080h
 (691h) Input 1 Volume
 R1682  OUT2LMIX       OUT2L 0  0  0  0  0  0 0         OUT2LMIX_SRC2 [7:0]          0000h
 (692h) Input 2 Source MIX_S
                        TS2
 R1683  OUT2LMIX         0   0  0  0  0  0  0 0     OUT2LMIX_VOL2 [6:0]          0   0080h
 (693h) Input 2 Volume
 R1684  OUT2LMIX       OUT2L 0  0  0  0  0  0 0         OUT2LMIX_SRC3 [7:0]          0000h
 (694h) Input 3 Source MIX_S
                        TS3
 R1685  OUT2LMIX         0   0  0  0  0  0  0 0     OUT2LMIX_VOL3 [6:0]          0   0080h
 (695h) Input 3 Volume
 R1686  OUT2LMIX       OUT2L 0  0  0  0  0  0 0         OUT2LMIX_SRC4 [7:0]          0000h
 (696h) Input 4 Source MIX_S
                        TS4
 R1687  OUT2LMIX         0   0  0  0  0  0  0 0     OUT2LMIX_VOL4 [6:0]          0   0080h
 (697h) Input 4 Volume
 R1688  OUT2RMIX       OUT2R 0  0  0  0  0  0 0         OUT2RMIX_SRC1 [7:0]          0000h
 (698h) Input 1 Source MIX_S
                        TS1
 R1689  OUT2RMIX         0   0  0  0  0  0  0 0     OUT2RMIX_VOL1 [6:0]          0   0080h
 (699h) Input 1 Volume
 R1690  OUT2RMIX       OUT2R 0  0  0  0  0  0 0         OUT2RMIX_SRC2 [7:0]          0000h
 (69Ah) Input 2 Source MIX_S
                        TS2
 R1691  OUT2RMIX         0   0  0  0  0  0  0 0     OUT2RMIX_VOL2 [6:0]          0   0080h
 (69Bh) Input 2 Volume
 R1692  OUT2RMIX       OUT2R 0  0  0  0  0  0 0         OUT2RMIX_SRC3 [7:0]          0000h
 (69Ch) Input 3 Source MIX_S
                        TS3
 R1693  OUT2RMIX         0   0  0  0  0  0  0 0     OUT2RMIX_VOL3 [6:0]          0   0080h
 (69Dh) Input 3 Volume
 R1694  OUT2RMIX       OUT2R 0  0  0  0  0  0 0         OUT2RMIX_SRC4 [7:0]          0000h
 (69Eh) Input 4 Source MIX_S
                        TS4
 R1695  OUT2RMIX         0   0  0  0  0  0  0 0     OUT2RMIX_VOL4 [6:0]          0   0080h
 (69Fh) Input 4 Volume
 R1696  OUT3LMIX       OUT3  0  0  0  0  0  0 0         OUT3MIX_SRC1 [7:0]           0000h
 (6A0h) Input 1 Source MIX_S
                        TS1
 R1697  OUT3LMIX         0   0  0  0  0  0  0 0     OUT3MIX_VOL1 [6:0]           0   0080h
 (6A1h) Input 1 Volume
 R1698  OUT3LMIX       OUT3  0  0  0  0  0  0 0         OUT3MIX_SRC2 [7:0]           0000h
 (6A2h) Input 2 Source MIX_S
                        TS2
 R1699  OUT3LMIX         0   0  0  0  0  0  0 0     OUT3MIX_VOL2 [6:0]           0   0080h
 (6A3h) Input 2 Volume
 R1700  OUT3LMIX       OUT3  0  0  0  0  0  0 0         OUT3MIX_SRC3 [7:0]           0000h
 (6A4h) Input 3 Source MIX_S
                        TS3
 R1701  OUT3LMIX         0   0  0  0  0  0  0 0     OUT3MIX_VOL3 [6:0]           0   0080h
 (6A5h) Input 3 Volume
 R1702  OUT3LMIX       OUT3  0  0  0  0  0  0 0         OUT3MIX_SRC4 [7:0]           0000h
 (6A6h) Input 4 Source MIX_S
                        TS4
 R1703  OUT3LMIX         0   0  0  0  0  0  0 0     OUT3MIX_VOL4 [6:0]           0   0080h
274                                                                                Rev 4.1


                                                                              WM8998
  REG        NAME        15  14 13 12 11 10 9 8 7 6   5      4      3       2  1 0 DEFAULT
 (6A7h) Input 4 Volume
 R1712  OUT4LMIX       OUT4L 0  0  0  0  0  0 0         OUT4LMIX_SRC1 [7:0]         0000h
 (6B0h) Input 1 Source MIX_S
                        TS1
 R1713  OUT4LMIX         0   0  0  0  0  0  0 0     OUT4LMIX_VOL1 [6:0]          0  0080h
 (6B1h) Input 1 Volume
 R1714  OUT4LMIX       OUT4L 0  0  0  0  0  0 0         OUT4LMIX_SRC2 [7:0]         0000h
 (6B2h) Input 2 Source MIX_S
                        TS2
 R1715  OUT4LMIX         0   0  0  0  0  0  0 0     OUT4LMIX_VOL2 [6:0]          0  0080h
 (6B3h) Input 2 Volume
 R1716  OUT4LMIX       OUT4L 0  0  0  0  0  0 0         OUT4LMIX_SRC3 [7:0]         0000h
 (6B4h) Input 3 Source MIX_S
                        TS3
 R1717  OUT4LMIX         0   0  0  0  0  0  0 0     OUT4LMIX_VOL3 [6:0]          0  0080h
 (6B5h) Input 3 Volume
 R1718  OUT4LMIX       OUT4L 0  0  0  0  0  0 0         OUT4LMIX_SRC4 [7:0]         0000h
 (6B6h) Input 4 Source MIX_S
                        TS4
 R1719  OUT4LMIX         0   0  0  0  0  0  0 0     OUT4LMIX_VOL4 [6:0]          0  0080h
 (6B7h) Input 4 Volume
 R1720  OUT4RMIX       OUT4R 0  0  0  0  0  0 0         OUT4RMIX_SRC1 [7:0]         0000h
 (6B8h) Input 1 Source MIX_S
                        TS1
 R1721  OUT4RMIX         0   0  0  0  0  0  0 0     OUT4RMIX_VOL1 [6:0]          0  0080h
 (6B9h) Input 1 Volume
 R1722  OUT4RMIX       OUT4R 0  0  0  0  0  0 0         OUT4RMIX_SRC2 [7:0]         0000h
 (6BAh) Input 2 Source MIX_S
                        TS2
 R1723  OUT4RMIX         0   0  0  0  0  0  0 0     OUT4RMIX_VOL2 [6:0]          0  0080h
 (6BBh) Input 2 Volume
 R1724  OUT4RMIX       OUT4R 0  0  0  0  0  0 0         OUT4RMIX_SRC3 [7:0]         0000h
 (6BCh) Input 3 Source MIX_S
                        TS3
 R1725  OUT4RMIX         0   0  0  0  0  0  0 0     OUT4RMIX_VOL3 [6:0]          0  0080h
 (6BDh) Input 3 Volume
 R1726  OUT4RMIX       OUT4R 0  0  0  0  0  0 0         OUT4RMIX_SRC4 [7:0]         0000h
 (6BEh) Input 4 Source MIX_S
                        TS4
 R1727  OUT4RMIX         0   0  0  0  0  0  0 0     OUT4RMIX_VOL4 [6:0]          0  0080h
 (6BFh) Input 4 Volume
 R1728  OUT5LMIX       OUT5L 0  0  0  0  0  0 0         OUT5LMIX_SRC1 [7:0]         0000h
 (6C0h) Input 1 Source MIX_S
                        TS1
 R1729  OUT5LMIX         0   0  0  0  0  0  0 0     OUT5LMIX_VOL1 [6:0]          0  0080h
 (6C1h) Input 1 Volume
 R1730  OUT5LMIX       OUT5L 0  0  0  0  0  0 0         OUT5LMIX_SRC2 [7:0]         0000h
 (6C2h) Input 2 Source MIX_S
                        TS2
 R1731  OUT5LMIX         0   0  0  0  0  0  0 0     OUT5LMIX_VOL2 [6:0]          0  0080h
 (6C3h) Input 2 Volume
 R1732  OUT5LMIX       OUT5L 0  0  0  0  0  0 0         OUT5LMIX_SRC3 [7:0]         0000h
 (6C4h) Input 3 Source MIX_S
                        TS3
 R1733  OUT5LMIX         0   0  0  0  0  0  0 0     OUT5LMIX_VOL3 [6:0]          0  0080h
 (6C5h) Input 3 Volume
 R1734  OUT5LMIX       OUT5L 0  0  0  0  0  0 0         OUT5LMIX_SRC4 [7:0]         0000h
 (6C6h) Input 4 Source MIX_S
Rev 4.1                                                                               275


                                                                                 WM8998
  REG        NAME         15  14 13 12 11 10 9 8 7 6    5      4      3        2  1 0  DEFAULT
                         TS4
 R1735  OUT5LMIX          0   0  0  0  0  0  0 0      OUT5LMIX_VOL4 [6:0]           0   0080h
 (6C7h) Input 4 Volume
 R1736  OUT5RMIX       OUT5R  0  0  0  0  0  0 0          OUT5RMIX_SRC1 [7:0]           0000h
 (6C8h) Input 1 Source MIX_S
                         TS1
 R1737  OUT5RMIX          0   0  0  0  0  0  0 0     OUT5RMIX_VOL1 [6:0]            0   0080h
 (6C9h) Input 1 Volume
 R1738  OUT5RMIX       OUT5R  0  0  0  0  0  0 0          OUT5RMIX_SRC2 [7:0]           0000h
 (6CAh) Input 2 Source MIX_S
                         TS2
 R1739  OUT5RMIX          0   0  0  0  0  0  0 0     OUT5RMIX_VOL2 [6:0]            0   0080h
 (6CBh) Input 2 Volume
 R1740  OUT5RMIX       OUT5R  0  0  0  0  0  0 0          OUT5RMIX_SRC3 [7:0]           0000h
 (6CCh) Input 3 Source MIX_S
                         TS3
 R1741  OUT5RMIX          0   0  0  0  0  0  0 0     OUT5RMIX_VOL3 [6:0]            0   0080h
 (6CDh) Input 3 Volume
 R1742  OUT5RMIX       OUT5R  0  0  0  0  0  0 0          OUT5RMIX_SRC4 [7:0]           0000h
 (6CEh) Input 4 Source MIX_S
                         TS4
 R1743  OUT5RMIX          0   0  0  0  0  0  0 0     OUT5RMIX_VOL4 [6:0]            0   0080h
 (6CFh) Input 4 Volume
 R1792  AIF1TX1MIX     AIF1TX 0  0  0  0  0  0 0         AIF1TX1MIX_SRC1 [7:0]          0000h
 (700h) Input 1 Source 1MIX_
                        STS1
 R1793  AIF1TX1MIX        0   0  0  0  0  0  0 0     AIF1TX1MIX_VOL1 [6:0]          0   0080h
 (701h) Input 1 Volume
 R1794  AIF1TX1MIX     AIF1TX 0  0  0  0  0  0 0         AIF1TX1MIX_SRC2 [7:0]          0000h
 (702h) Input 2 Source 1MIX_
                        STS2
 R1795  AIF1TX1MIX        0   0  0  0  0  0  0 0     AIF1TX1MIX_VOL2 [6:0]          0   0080h
 (703h) Input 2 Volume
 R1796  AIF1TX1MIX     AIF1TX 0  0  0  0  0  0 0         AIF1TX1MIX_SRC3 [7:0]          0000h
 (704h) Input 3 Source 1MIX_
                        STS3
 R1797  AIF1TX1MIX        0   0  0  0  0  0  0 0     AIF1TX1MIX_VOL3 [6:0]          0   0080h
 (705h) Input 3 Volume
 R1798  AIF1TX1MIX     AIF1TX 0  0  0  0  0  0 0         AIF1TX1MIX_SRC4 [7:0]          0000h
 (706h) Input 4 Source 1MIX_
                        STS4
 R1799  AIF1TX1MIX        0   0  0  0  0  0  0 0     AIF1TX1MIX_VOL4 [6:0]          0   0080h
 (707h) Input 4 Volume
 R1800  AIF1TX2MIX     AIF1TX 0  0  0  0  0  0 0         AIF1TX2MIX_SRC1 [7:0]          0000h
 (708h) Input 1 Source 2MIX_
                        STS1
 R1801  AIF1TX2MIX        0   0  0  0  0  0  0 0     AIF1TX2MIX_VOL1 [6:0]          0   0080h
 (709h) Input 1 Volume
 R1802  AIF1TX2MIX     AIF1TX 0  0  0  0  0  0 0         AIF1TX2MIX_SRC2 [7:0]          0000h
 (70Ah) Input 2 Source 2MIX_
                        STS2
 R1803  AIF1TX2MIX        0   0  0  0  0  0  0 0     AIF1TX2MIX_VOL2 [6:0]          0   0080h
 (70Bh) Input 2 Volume
 R1804  AIF1TX2MIX     AIF1TX 0  0  0  0  0  0 0         AIF1TX2MIX_SRC3 [7:0]          0000h
 (70Ch) Input 3 Source 2MIX_
                        STS3
 R1805  AIF1TX2MIX        0   0  0  0  0  0  0 0     AIF1TX2MIX_VOL3 [6:0]          0   0080h
 (70Dh) Input 3 Volume
276                                                                                   Rev 4.1


                                                                                 WM8998
  REG        NAME         15  14 13 12 11 10 9 8 7 6    5      4      3        2  1 0 DEFAULT
 R1806  AIF1TX2MIX     AIF1TX 0  0  0  0  0  0 0         AIF1TX2MIX_SRC4 [7:0]         0000h
 (70Eh) Input 4 Source 2MIX_
                        STS4
 R1807  AIF1TX2MIX        0   0  0  0  0  0  0 0     AIF1TX2MIX_VOL4 [6:0]          0  0080h
 (70Fh) Input 4 Volume
 R1808  AIF1TX3MIX     AIF1TX 0  0  0  0  0  0 0         AIF1TX3MIX_SRC1 [7:0]         0000h
 (710h) Input 1 Source 3MIX_
                        STS1
 R1809  AIF1TX3MIX        0   0  0  0  0  0  0 0     AIF1TX3MIX_VOL1 [6:0]          0  0080h
 (711h) Input 1 Volume
 R1810  AIF1TX3MIX     AIF1TX 0  0  0  0  0  0 0         AIF1TX3MIX_SRC2 [7:0]         0000h
 (712h) Input 2 Source 3MIX_
                        STS2
 R1811  AIF1TX3MIX        0   0  0  0  0  0  0 0     AIF1TX3MIX_VOL2 [6:0]          0  0080h
 (713h) Input 2 Volume
 R1812  AIF1TX3MIX     AIF1TX 0  0  0  0  0  0 0         AIF1TX3MIX_SRC3 [7:0]         0000h
 (714h) Input 3 Source 3MIX_
                        STS3
 R1813  AIF1TX3MIX        0   0  0  0  0  0  0 0     AIF1TX3MIX_VOL3 [6:0]          0  0080h
 (715h) Input 3 Volume
 R1814  AIF1TX3MIX     AIF1TX 0  0  0  0  0  0 0         AIF1TX3MIX_SRC4 [7:0]         0000h
 (716h) Input 4 Source 3MIX_
                        STS4
 R1815  AIF1TX3MIX        0   0  0  0  0  0  0 0     AIF1TX3MIX_VOL4 [6:0]          0  0080h
 (717h) Input 4 Volume
 R1816  AIF1TX4MIX     AIF1TX 0  0  0  0  0  0 0         AIF1TX4MIX_SRC1 [7:0]         0000h
 (718h) Input 1 Source 4MIX_
                        STS1
 R1817  AIF1TX4MIX        0   0  0  0  0  0  0 0     AIF1TX4MIX_VOL1 [6:0]          0  0080h
 (719h) Input 1 Volume
 R1818  AIF1TX4MIX     AIF1TX 0  0  0  0  0  0 0         AIF1TX4MIX_SRC2 [7:0]         0000h
 (71Ah) Input 2 Source 4MIX_
                        STS2
 R1819  AIF1TX4MIX        0   0  0  0  0  0  0 0     AIF1TX4MIX_VOL2 [6:0]          0  0080h
 (71Bh) Input 2 Volume
 R1820  AIF1TX4MIX     AIF1TX 0  0  0  0  0  0 0         AIF1TX4MIX_SRC3 [7:0]         0000h
 (71Ch) Input 3 Source 4MIX_
                        STS3
 R1821  AIF1TX4MIX        0   0  0  0  0  0  0 0     AIF1TX4MIX_VOL3 [6:0]          0  0080h
 (71Dh) Input 3 Volume
 R1822  AIF1TX4MIX     AIF1TX 0  0  0  0  0  0 0         AIF1TX4MIX_SRC4 [7:0]         0000h
 (71Eh) Input 4 Source 4MIX_
                        STS4
 R1823  AIF1TX4MIX        0   0  0  0  0  0  0 0     AIF1TX4MIX_VOL4 [6:0]          0  0080h
 (71Fh) Input 4 Volume
 R1824  AIF1TX5MIX     AIF1TX 0  0  0  0  0  0 0         AIF1TX5MIX_SRC1 [7:0]         0000h
 (720h) Input 1 Source 5MIX_
                        STS1
 R1825  AIF1TX5MIX        0   0  0  0  0  0  0 0     AIF1TX5MIX_VOL1 [6:0]          0  0080h
 (721h) Input 1 Volume
 R1826  AIF1TX5MIX     AIF1TX 0  0  0  0  0  0 0         AIF1TX5MIX_SRC2 [7:0]         0000h
 (722h) Input 2 Source 5MIX_
                        STS2
 R1827  AIF1TX5MIX        0   0  0  0  0  0  0 0     AIF1TX5MIX_VOL2 [6:0]          0  0080h
 (723h) Input 2 Volume
 R1828  AIF1TX5MIX     AIF1TX 0  0  0  0  0  0 0         AIF1TX5MIX_SRC3 [7:0]         0000h
 (724h) Input 3 Source 5MIX_
                        STS3
Rev 4.1                                                                                  277


                                                                                 WM8998
  REG        NAME         15  14 13 12 11 10 9 8 7 6    5      4      3        2  1 0  DEFAULT
 R1829  AIF1TX5MIX        0   0  0  0  0  0  0 0     AIF1TX5MIX_VOL3 [6:0]          0   0080h
 (725h) Input 3 Volume
 R1830  AIF1TX5MIX     AIF1TX 0  0  0  0  0  0 0         AIF1TX5MIX_SRC4 [7:0]          0000h
 (726h) Input 4 Source 5MIX_
                        STS4
 R1831  AIF1TX5MIX        0   0  0  0  0  0  0 0     AIF1TX5MIX_VOL4 [6:0]          0   0080h
 (727h) Input 4 Volume
 R1832  AIF1TX6MIX     AIF1TX 0  0  0  0  0  0 0         AIF1TX6MIX_SRC1 [7:0]          0000h
 (728h) Input 1 Source 6MIX_
                        STS1
 R1833  AIF1TX6MIX        0   0  0  0  0  0  0 0     AIF1TX6MIX_VOL1 [6:0]          0   0080h
 (729h) Input 1 Volume
 R1834  AIF1TX6MIX     AIF1TX 0  0  0  0  0  0 0         AIF1TX6MIX_SRC2 [7:0]          0000h
 (72Ah) Input 2 Source 6MIX_
                        STS2
 R1835  AIF1TX6MIX        0   0  0  0  0  0  0 0     AIF1TX6MIX_VOL2 [6:0]          0   0080h
 (72Bh) Input 2 Volume
 R1836  AIF1TX6MIX     AIF1TX 0  0  0  0  0  0 0         AIF1TX6MIX_SRC3 [7:0]          0000h
 (72Ch) Input 3 Source 6MIX_
                        STS3
 R1837  AIF1TX6MIX        0   0  0  0  0  0  0 0     AIF1TX6MIX_VOL3 [6:0]          0   0080h
 (72Dh) Input 3 Volume
 R1838  AIF1TX6MIX     AIF1TX 0  0  0  0  0  0 0         AIF1TX6MIX_SRC4 [7:0]          0000h
 (72Eh) Input 4 Source 6MIX_
                        STS4
 R1839  AIF1TX6MIX        0   0  0  0  0  0  0 0     AIF1TX6MIX_VOL4 [6:0]          0   0080h
 (72Fh) Input 4 Volume
 R1856  AIF2TX1MIX     AIF2TX 0  0  0  0  0  0 0         AIF2TX1MIX_SRC1 [7:0]          0000h
 (740h) Input 1 Source 1MIX_
                        STS1
 R1857  AIF2TX1MIX        0   0  0  0  0  0  0 0     AIF2TX1MIX_VOL1 [6:0]          0   0080h
 (741h) Input 1 Volume
 R1858  AIF2TX1MIX     AIF2TX 0  0  0  0  0  0 0         AIF2TX1MIX_SRC2 [7:0]          0000h
 (742h) Input 2 Source 1MIX_
                        STS2
 R1859  AIF2TX1MIX        0   0  0  0  0  0  0 0     AIF2TX1MIX_VOL2 [6:0]          0   0080h
 (743h) Input 2 Volume
 R1860  AIF2TX1MIX     AIF2TX 0  0  0  0  0  0 0         AIF2TX1MIX_SRC3 [7:0]          0000h
 (744h) Input 3 Source 1MIX_
                        STS3
 R1861  AIF2TX1MIX        0   0  0  0  0  0  0 0     AIF2TX1MIX_VOL3 [6:0]          0   0080h
 (745h) Input 3 Volume
 R1862  AIF2TX1MIX     AIF2TX 0  0  0  0  0  0 0         AIF2TX1MIX_SRC4 [7:0]          0000h
 (746h) Input 4 Source 1MIX_
                        STS4
 R1863  AIF2TX1MIX        0   0  0  0  0  0  0 0     AIF2TX1MIX_VOL4 [6:0]          0   0080h
 (747h) Input 4 Volume
 R1864  AIF2TX2MIX     AIF2TX 0  0  0  0  0  0 0         AIF2TX2MIX_SRC1 [7:0]          0000h
 (748h) Input 1 Source 2MIX_
                        STS1
 R1865  AIF2TX2MIX        0   0  0  0  0  0  0 0     AIF2TX2MIX_VOL1 [6:0]          0   0080h
 (749h) Input 1 Volume
 R1866  AIF2TX2MIX     AIF2TX 0  0  0  0  0  0 0         AIF2TX2MIX_SRC2 [7:0]          0000h
 (74Ah) Input 2 Source 2MIX_
                        STS2
 R1867  AIF2TX2MIX        0   0  0  0  0  0  0 0     AIF2TX2MIX_VOL2 [6:0]          0   0080h
 (74Bh) Input 2 Volume
 R1868  AIF2TX2MIX     AIF2TX 0  0  0  0  0  0 0         AIF2TX2MIX_SRC3 [7:0]          0000h
278                                                                                   Rev 4.1


                                                                                 WM8998
  REG        NAME         15  14 13 12 11 10 9 8 7 6    5      4      3        2  1 0 DEFAULT
 (74Ch) Input 3 Source 2MIX_
                        STS3
 R1869  AIF2TX2MIX        0   0  0  0  0  0  0 0     AIF2TX2MIX_VOL3 [6:0]          0  0080h
 (74Dh) Input 3 Volume
 R1870  AIF2TX2MIX     AIF2TX 0  0  0  0  0  0 0         AIF2TX2MIX_SRC4 [7:0]         0000h
 (74Eh) Input 4 Source 2MIX_
                        STS4
 R1871  AIF2TX2MIX        0   0  0  0  0  0  0 0     AIF2TX2MIX_VOL4 [6:0]          0  0080h
 (74Fh) Input 4 Volume
 R1872  AIF2TX3MIX     AIF2TX 0  0  0  0  0  0 0         AIF2TX3MIX_SRC1 [7:0]         0000h
 (750h) Input 1 Source 3MIX_
                        STS1
 R1873  AIF2TX3MIX        0   0  0  0  0  0  0 0     AIF2TX3MIX_VOL1 [6:0]          0  0080h
 (751h) Input 1 Volume
 R1874  AIF2TX3MIX     AIF2TX 0  0  0  0  0  0 0         AIF2TX3MIX_SRC2 [7:0]         0000h
 (752h) Input 2 Source 3MIX_
                        STS2
 R1875  AIF2TX3MIX        0   0  0  0  0  0  0 0     AIF2TX3MIX_VOL2 [6:0]          0  0080h
 (753h) Input 2 Volume
 R1876  AIF2TX3MIX     AIF2TX 0  0  0  0  0  0 0         AIF2TX3MIX_SRC3 [7:0]         0000h
 (754h) Input 3 Source 3MIX_
                        STS3
 R1877  AIF2TX3MIX        0   0  0  0  0  0  0 0     AIF2TX3MIX_VOL3 [6:0]          0  0080h
 (755h) Input 3 Volume
 R1878  AIF2TX3MIX     AIF2TX 0  0  0  0  0  0 0         AIF2TX3MIX_SRC4 [7:0]         0000h
 (756h) Input 4 Source 3MIX_
                        STS4
 R1879  AIF2TX3MIX        0   0  0  0  0  0  0 0     AIF2TX3MIX_VOL4 [6:0]          0  0080h
 (757h) Input 4 Volume
 R1880  AIF2TX4MIX     AIF2TX 0  0  0  0  0  0 0         AIF2TX4MIX_SRC1 [7:0]         0000h
 (758h) Input 1 Source 4MIX_
                        STS1
 R1881  AIF2TX4MIX        0   0  0  0  0  0  0 0     AIF2TX4MIX_VOL1 [6:0]          0  0080h
 (759h) Input 1 Volume
 R1882  AIF2TX4MIX     AIF2TX 0  0  0  0  0  0 0         AIF2TX4MIX_SRC2 [7:0]         0000h
 (75Ah) Input 2 Source 4MIX_
                        STS2
 R1883  AIF2TX4MIX        0   0  0  0  0  0  0 0     AIF2TX4MIX_VOL2 [6:0]          0  0080h
 (75Bh) Input 2 Volume
 R1884  AIF2TX4MIX     AIF2TX 0  0  0  0  0  0 0         AIF2TX4MIX_SRC3 [7:0]         0000h
 (75Ch) Input 3 Source 4MIX_
                        STS3
 R1885  AIF2TX4MIX        0   0  0  0  0  0  0 0     AIF2TX4MIX_VOL3 [6:0]          0  0080h
 (75Dh) Input 3 Volume
 R1886  AIF2TX4MIX     AIF2TX 0  0  0  0  0  0 0         AIF2TX4MIX_SRC4 [7:0]         0000h
 (75Eh) Input 4 Source 4MIX_
                        STS4
 R1887  AIF2TX4MIX        0   0  0  0  0  0  0 0     AIF2TX4MIX_VOL4 [6:0]          0  0080h
 (75Fh) Input 4 Volume
 R1888  AIF2TX5MIX     AIF2TX 0  0  0  0  0  0 0         AIF2TX5MIX_SRC1 [7:0]         0000h
 (760h) Input 1 Source 5MIX_
                        STS1
 R1889  AIF2TX5MIX        0   0  0  0  0  0  0 0     AIF2TX5MIX_VOL1 [6:0]          0  0080h
 (761h) Input 1 Volume
 R1890  AIF2TX5MIX     AIF2TX 0  0  0  0  0  0 0         AIF2TX5MIX_SRC2 [7:0]         0000h
 (762h) Input 2 Source 5MIX_
                        STS2
 R1891  AIF2TX5MIX        0   0  0  0  0  0  0 0     AIF2TX5MIX_VOL2 [6:0]          0  0080h
Rev 4.1                                                                                  279


                                                                                 WM8998
  REG        NAME         15  14 13 12 11 10 9 8 7 6    5      4      3        2  1 0  DEFAULT
 (763h) Input 2 Volume
 R1892  AIF2TX5MIX     AIF2TX 0  0  0  0  0  0 0         AIF2TX5MIX_SRC3 [7:0]          0000h
 (764h) Input 3 Source 5MIX_
                        STS3
 R1893  AIF2TX5MIX        0   0  0  0  0  0  0 0     AIF2TX5MIX_VOL3 [6:0]          0   0080h
 (765h) Input 3 Volume
 R1894  AIF2TX5MIX     AIF2TX 0  0  0  0  0  0 0         AIF2TX5MIX_SRC4 [7:0]          0000h
 (766h) Input 4 Source 5MIX_
                        STS4
 R1895  AIF2TX5MIX        0   0  0  0  0  0  0 0     AIF2TX5MIX_VOL4 [6:0]          0   0080h
 (767h) Input 4 Volume
 R1896  AIF2TX6MIX     AIF2TX 0  0  0  0  0  0 0         AIF2TX6MIX_SRC1 [7:0]          0000h
 (768h) Input 1 Source 6MIX_
                        STS1
 R1897  AIF2TX6MIX        0   0  0  0  0  0  0 0     AIF2TX6MIX_VOL1 [6:0]          0   0080h
 (769h) Input 1 Volume
 R1898  AIF2TX6MIX     AIF2TX 0  0  0  0  0  0 0         AIF2TX6MIX_SRC2 [7:0]          0000h
 (76Ah) Input 2 Source 6MIX_
                        STS2
 R1899  AIF2TX6MIX        0   0  0  0  0  0  0 0     AIF2TX6MIX_VOL2 [6:0]          0   0080h
 (76Bh) Input 2 Volume
 R1900  AIF2TX6MIX     AIF2TX 0  0  0  0  0  0 0         AIF2TX6MIX_SRC3 [7:0]          0000h
 (76Ch) Input 3 Source 6MIX_
                        STS3
 R1901  AIF2TX6MIX        0   0  0  0  0  0  0 0     AIF2TX6MIX_VOL3 [6:0]          0   0080h
 (76Dh) Input 3 Volume
 R1902  AIF2TX6MIX     AIF2TX 0  0  0  0  0  0 0         AIF2TX6MIX_SRC4 [7:0]          0000h
 (76Eh) Input 4 Source 6MIX_
                        STS4
 R1903  AIF2TX6MIX        0   0  0  0  0  0  0 0     AIF2TX6MIX_VOL4 [6:0]          0   0080h
 (76Fh) Input 4 Volume
 R1920  AIF3TX1MIX     AIF3TX 0  0  0  0  0  0 0         AIF3TX1MIX_SRC1 [7:0]          0000h
 (780h) Input 1 Source 1MIX_
                        STS1
 R1921  AIF3TX1MIX        0   0  0  0  0  0  0 0     AIF3TX1MIX_VOL1 [6:0]          0   0080h
 (781h) Input 1 Volume
 R1922  AIF3TX1MIX     AIF3TX 0  0  0  0  0  0 0         AIF3TX1MIX_SRC2 [7:0]          0000h
 (782h) Input 2 Source 1MIX_
                        STS2
 R1923  AIF3TX1MIX        0   0  0  0  0  0  0 0     AIF3TX1MIX_VOL2 [6:0]          0   0080h
 (783h) Input 2 Volume
 R1924  AIF3TX1MIX     AIF3TX 0  0  0  0  0  0 0         AIF3TX1MIX_SRC3 [7:0]          0000h
 (784h) Input 3 Source 1MIX_
                        STS3
 R1925  AIF3TX1MIX        0   0  0  0  0  0  0 0     AIF3TX1MIX_VOL3 [6:0]          0   0080h
 (785h) Input 3 Volume
 R1926  AIF3TX1MIX     AIF3TX 0  0  0  0  0  0 0         AIF3TX1MIX_SRC4 [7:0]          0000h
 (786h) Input 4 Source 1MIX_
                        STS4
 R1927  AIF3TX1MIX        0   0  0  0  0  0  0 0     AIF3TX1MIX_VOL4 [6:0]          0   0080h
 (787h) Input 4 Volume
 R1928  AIF3TX2MIX     AIF3TX 0  0  0  0  0  0 0         AIF3TX2MIX_SRC1 [7:0]          0000h
 (788h) Input 1 Source 2MIX_
                        STS1
 R1929  AIF3TX2MIX        0   0  0  0  0  0  0 0     AIF3TX2MIX_VOL1 [6:0]          0   0080h
 (789h) Input 1 Volume
 R1930  AIF3TX2MIX     AIF3TX 0  0  0  0  0  0 0         AIF3TX2MIX_SRC2 [7:0]          0000h
 (78Ah) Input 2 Source 2MIX_
280                                                                                   Rev 4.1


                                                                                  WM8998
  REG        NAME         15  14 13 12 11 10 9 8 7 6     5       4     3        2  1 0 DEFAULT
                        STS2
 R1931  AIF3TX2MIX        0   0  0  0  0  0  0 0      AIF3TX2MIX_VOL2 [6:0]          0  0080h
 (78Bh) Input 2 Volume
 R1932  AIF3TX2MIX     AIF3TX 0  0  0  0  0  0 0          AIF3TX2MIX_SRC3 [7:0]         0000h
 (78Ch) Input 3 Source 2MIX_
                        STS3
 R1933  AIF3TX2MIX        0   0  0  0  0  0  0 0      AIF3TX2MIX_VOL3 [6:0]          0  0080h
 (78Dh) Input 3 Volume
 R1934  AIF3TX2MIX     AIF3TX 0  0  0  0  0  0 0          AIF3TX2MIX_SRC4 [7:0]         0000h
 (78Eh) Input 4 Source 2MIX_
                        STS4
 R1935  AIF3TX2MIX        0   0  0  0  0  0  0 0      AIF3TX2MIX_VOL4 [6:0]          0  0080h
 (78Fh) Input 4 Volume
 R1984  SLIMTX1MIX     SLIMT  0  0  0  0  0  0 0           SLIMTX1MIX_SRC [7:0]         0000h
 (7C0h) Input 1 Source X1MIX
                        _STS
 R1985  SLIMTX1MIX        0   0  0  0  0  0  0 0      SLIMTX1MIX_VOL [6:0]           0  0080h
 (7C1h) Input 1 Volume
 R1992  SLIMTX2MIX     SLIMT  0  0  0  0  0  0 0           SLIMTX2MIX_SRC [7:0]         0000h
 (7C8h) Input 1 Source X2MIX
                        _STS
 R1993  SLIMTX2MIX        0   0  0  0  0  0  0 0      SLIMTX2MIX_VOL [6:0]           0  0080h
 (7C9h) Input 1 Volume
 R2000  SLIMTX3MIX     SLIMT  0  0  0  0  0  0 0           SLIMTX3MIX_SRC [7:0]         0000h
 (7D0h) Input 1 Source X3MIX
                        _STS
 R2001  SLIMTX3MIX        0   0  0  0  0  0  0 0      SLIMTX3MIX_VOL [6:0]           0  0080h
 (7D1h) Input 1 Volume
 R2008  SLIMTX4MIX     SLIMT  0  0  0  0  0  0 0           SLIMTX4MIX_SRC [7:0]         0000h
 (7D8h) Input 1 Source X4MIX
                        _STS
 R2009  SLIMTX4MIX        0   0  0  0  0  0  0 0      SLIMTX4MIX_VOL [6:0]           0  0080h
 (7D9h) Input 1 Volume
 R2016  SLIMTX5MIX     SLIMT  0  0  0  0  0  0 0           SLIMTX5MIX_SRC [7:0]         0000h
 (7E0h) Input 1 Source X5MIX
                        _STS
 R2017  SLIMTX5MIX        0   0  0  0  0  0  0 0      SLIMTX5MIX_VOL [6:0]           0  0080h
 (7E1h) Input 1 Volume
 R2024  SLIMTX6MIX     SLIMT  0  0  0  0  0  0 0           SLIMTX6MIX_SRC [7:0]         0000h
 (7E8h) Input 1 Source X6MIX
                        _STS
 R2025  SLIMTX6MIX        0   0  0  0  0  0  0 0      SLIMTX6MIX_VOL [6:0]           0  0080h
 (7E9h) Input 1 Volume
 R2048  SPDIF1TX1MIX SPDIF    0  0  0  0  0  0 0         SPDIF1TX1MIX_SRC [7:0]         0000h
 (800h) Input 1 Source 1TX1_
                         STS
 R2049  SPDIF1TX1MIX      0   0  0  0  0  0  0 0     SPDIF1TX1MIX_VOL [6:0]          0  0080h
 (801h) Input 1 Volume
 R2056  SPDIF1TX2MIX SPDIF    0  0  0  0  0  0 0         SPDIF1TX2MIX_SRC [7:0]         0000h
 (808h) Input 1 Source 1TX2_
                         STS
 R2057  SPDIF1TX2MIX      0   0  0  0  0  0  0 0     SPDIF1TX2MIX_VOL [6:0]          0  0080h
 (809h) Input 1 Volume
 R2176  EQ1MIX Input 1 EQ1MI  0  0  0  0  0  0 0             EQ1MIX_SRC [7:0]           0000h
 (880h) Source         X_STS
 R2177  EQ1MIX Input 1    0   0  0  0  0  0  0 0        EQ1MIX_VOL [6:0]             0  0080h
 (881h) Volume
 R2184  EQ2MIX Input 1 EQ2MI  0  0  0  0  0  0 0             EQ2MIX_SRC [7:0]           0000h
Rev 4.1                                                                                   281


                                                                              WM8998
  REG        NAME        15  14 13 12 11 10 9 8 7 6   5      4      3       2  1 0  DEFAULT
 (888h) Source         X_STS
 R2185  EQ2MIX Input 1    0  0  0  0  0  0  0 0      EQ2MIX_VOL [6:0]            0   0080h
 (889h) Volume
 R2192  EQ3MIX Input 1 EQ3MI 0  0  0  0  0  0 0          EQ3MIX_SRC [7:0]            0000h
 (890h) Source         X_STS
 R2193  EQ3MIX Input 1    0  0  0  0  0  0  0 0      EQ3MIX_VOL [6:0]            0   0080h
 (891h) Volume
 R2200  EQ4MIX Input 1 EQ4MI 0  0  0  0  0  0 0          EQ4MIX_SRC [7:0]            0000h
 (898h) Source         X_STS
 R2201  EQ4MIX Input 1    0  0  0  0  0  0  0 0      EQ4MIX_VOL [6:0]            0   0080h
 (899h) Volume
 R2240  DRC1LMIX       DRC1L 0  0  0  0  0  0 0         DRC1LMIX_SRC [7:0]           0000h
 (8C0h) Input 1 Source MIX_S
                         TS
 R2241  DRC1LMIX          0  0  0  0  0  0  0 0     DRC1LMIX_VOL [6:0]           0   0080h
 (8C1h) Input 1 Volume
 R2248  DRC1RMIX       DRC1  0  0  0  0  0  0 0         DRC1RMIX_SRC [7:0]           0000h
 (8C8h) Input 1 Source RMIX_
                        STS
 R2249  DRC1RMIX          0  0  0  0  0  0  0 0     DRC1RMIX_VOL [6:0]           0   0080h
 (8C9h) Input 1 Volume
 R2304  HPLP1MIX       LHPF1 0  0  0  0  0  0 0         LHPF1MIX_SRC1 [7:0]          0000h
 (900h) Input 1 Source MIX_S
                        TS1
 R2305  HPLP1MIX          0  0  0  0  0  0  0 0     LHPF1MIX_VOL1 [6:0]          0   0080h
 (901h) Input 1 Volume
 R2306  HPLP1MIX       LHPF1 0  0  0  0  0  0 0         LHPF1MIX_SRC2 [7:0]          0000h
 (902h) Input 2 Source MIX_S
                        TS2
 R2307  HPLP1MIX          0  0  0  0  0  0  0 0     LHPF1MIX_VOL2 [6:0]          0   0080h
 (903h) Input 2 Volume
 R2308  HPLP1MIX       LHPF1 0  0  0  0  0  0 0         LHPF1MIX_SRC3 [7:0]          0000h
 (904h) Input 3 Source MIX_S
                        TS3
 R2309  HPLP1MIX          0  0  0  0  0  0  0 0     LHPF1MIX_VOL3 [6:0]          0   0080h
 (905h) Input 3 Volume
 R2310  HPLP1MIX       LHPF1 0  0  0  0  0  0 0         LHPF1MIX_SRC4 [7:0]          0000h
 (906h) Input 4 Source MIX_S
                        TS4
 R2311  HPLP1MIX          0  0  0  0  0  0  0 0     LHPF1MIX_VOL4 [6:0]          0   0080h
 (907h) Input 4 Volume
 R2312  HPLP2MIX       LHPF2 0  0  0  0  0  0 0         LHPF2MIX_SRC1 [7:0]          0000h
 (908h) Input 1 Source MIX_S
                        TS1
 R2313  HPLP2MIX          0  0  0  0  0  0  0 0     LHPF2MIX_VOL1 [6:0]          0   0080h
 (909h) Input 1 Volume
 R2314  HPLP2MIX       LHPF2 0  0  0  0  0  0 0         LHPF2MIX_SRC2 [7:0]          0000h
 (90Ah) Input 2 Source MIX_S
                        TS2
 R2315  HPLP2MIX          0  0  0  0  0  0  0 0     LHPF2MIX_VOL2 [6:0]          0   0080h
 (90Bh) Input 2 Volume
 R2316  HPLP2MIX       LHPF2 0  0  0  0  0  0 0         LHPF2MIX_SRC3 [7:0]          0000h
 (90Ch) Input 3 Source MIX_S
                        TS3
 R2317  HPLP2MIX          0  0  0  0  0  0  0 0     LHPF2MIX_VOL3 [6:0]          0   0080h
 (90Dh) Input 3 Volume
 R2318  HPLP2MIX       LHPF2 0  0  0  0  0  0 0         LHPF2MIX_SRC4 [7:0]          0000h
 (90Eh) Input 4 Source MIX_S
282                                                                                Rev 4.1


                                                                              WM8998
  REG        NAME         15 14 13 12 11 10 9 8 7 6   5      4      3       2  1 0 DEFAULT
                         TS4
 R2319  HPLP2MIX          0  0  0  0  0  0  0 0     LHPF2MIX_VOL4 [6:0]          0  0080h
 (90Fh) Input 4 Volume
 R2320  HPLP3MIX       LHPF3 0  0  0  0  0  0 0         LHPF3MIX_SRC1 [7:0]         0000h
 (910h) Input 1 Source MIX_S
                         TS1
 R2321  HPLP3MIX          0  0  0  0  0  0  0 0     LHPF3MIX_VOL1 [6:0]          0  0080h
 (911h) Input 1 Volume
 R2322  HPLP3MIX       LHPF3 0  0  0  0  0  0 0         LHPF3MIX_SRC2 [7:0]         0000h
 (912h) Input 2 Source MIX_S
                         TS2
 R2323  HPLP3MIX          0  0  0  0  0  0  0 0     LHPF3MIX_VOL2 [6:0]          0  0080h
 (913h) Input 2 Volume
 R2324  HPLP3MIX       LHPF3 0  0  0  0  0  0 0         LHPF3MIX_SRC3 [7:0]         0000h
 (914h) Input 3 Source MIX_S
                         TS3
 R2325  HPLP3MIX          0  0  0  0  0  0  0 0     LHPF3MIX_VOL3 [6:0]          0  0080h
 (915h) Input 3 Volume
 R2326  HPLP3MIX       LHPF3 0  0  0  0  0  0 0         LHPF3MIX_SRC4 [7:0]         0000h
 (916h) Input 4 Source MIX_S
                         TS4
 R2327  HPLP3MIX          0  0  0  0  0  0  0 0     LHPF3MIX_VOL4 [6:0]          0  0080h
 (917h) Input 4 Volume
 R2328  HPLP4MIX       LHPF4 0  0  0  0  0  0 0         LHPF4MIX_SRC1 [7:0]         0000h
 (918h) Input 1 Source MIX_S
                         TS1
 R2329  HPLP4MIX          0  0  0  0  0  0  0 0     LHPF4MIX_VOL1 [6:0]          0  0080h
 (919h) Input 1 Volume
 R2330  HPLP4MIX       LHPF4 0  0  0  0  0  0 0         LHPF4MIX_SRC2 [7:0]         0000h
 (91Ah) Input 2 Source MIX_S
                         TS2
 R2331  HPLP4MIX          0  0  0  0  0  0  0 0     LHPF4MIX_VOL2 [6:0]          0  0080h
 (91Bh) Input 2 Volume
 R2332  HPLP4MIX       LHPF4 0  0  0  0  0  0 0         LHPF4MIX_SRC3 [7:0]         0000h
 (91Ch) Input 3 Source MIX_S
                         TS3
 R2333  HPLP4MIX          0  0  0  0  0  0  0 0     LHPF4MIX_VOL3 [6:0]          0  0080h
 (91Dh) Input 3 Volume
 R2334  HPLP4MIX       LHPF4 0  0  0  0  0  0 0         LHPF4MIX_SRC4 [7:0]         0000h
 (91Eh) Input 4 Source MIX_S
                         TS4
 R2335  HPLP4MIX          0  0  0  0  0  0  0 0     LHPF4MIX_VOL4 [6:0]          0  0080h
 (91Fh) Input 4 Volume
 R2688  ASRC1LMIX      ASRC1 0  0  0  0  0  0 0           ASRC1L_SRC [7:0]          0000h
 (A80h) Input 1 Source LMIX_
                         STS
 R2696  ASRC1RMIX      ASRC1 0  0  0  0  0  0 0           ASRC1R_SRC [7:0]          0000h
 (A88h) Input 1 Source RMIX_
                         STS
 R2704  ASRC2LMIX      ASRC2 0  0  0  0  0  0 0           ASRC2L_SRC [7:0]          0000h
 (A90h) Input 1 Source LMIX_
                         STS
 R2712  ASRC2RMIX      ASRC2 0  0  0  0  0  0 0           ASRC2R_SRC [7:0]          0000h
 (A98h) Input 1 Source RMIX_
                         STS
 R2816  ISRC1DEC1MI ISRC1    0  0  0  0  0  0 0         ISRC1DEC1_SRC [7:0]         0000h
 (B00h) X Input 1       DEC1
        Source         MIX_S
Rev 4.1                                                                               283


                                                                                                         WM8998
  REG        NAME         15    14     13       12    11    10     9    8   7 6 5       4      3       2   1         0  DEFAULT
                          TS
 R2824  ISRC1DEC2MI ISRC1        0     0        0     0      0    0     0         ISRC1DEC2_SRC [7:0]                    0000h
 (B08h) X Input 1        DEC2
        Source          MIX_S
                          TS
 R2832  ISRC1DEC3MI ISRC1        0     0        0     0      0    0     0         ISRC1DEC3_SRC [7:0]                    0000h
 (B10h) X Input 1        DEC3
        Source          MIX_S
                          TS
 R2840  ISRC1DEC4MI ISRC1        0     0        0     0      0    0     0         ISRC1DEC4_SRC [7:0]                    0000h
 (B18h) X Input 1        DEC4
        Source          MIX_S
                          TS
 R2848  ISRC1INT1MIX ISRC1I      0     0        0     0      0    0     0          ISRC1INT1_SRC [7:0]                   0000h
 (B20h) Input 1 Source NT1MI
                        X_STS
 R2856  ISRC1INT2MIX ISRC1I      0     0        0     0      0    0     0          ISRC1INT2_SRC [7:0]                   0000h
 (B28h) Input 1 Source NT2MI
                        X_STS
 R2864  ISRC1INT3MIX ISRC1I      0     0        0     0      0    0     0          ISRC1INT3_SRC [7:0]                   0000h
 (B30h) Input 1 Source NT3MI
                        X_STS
 R2872  ISRC1INT4MIX ISRC1I      0     0        0     0      0    0     0          ISRC1INT4_SRC [7:0]                   0000h
 (B38h) Input 1 Source NT4MI
                        X_STS
 R2880  ISRC2DEC1MI ISRC2        0     0        0     0      0    0     0         ISRC2DEC1_SRC [7:0]                    0000h
 (B40h) X Input 1        DEC1
        Source          MIX_S
                          TS
 R2888  ISRC2DEC2MI ISRC2        0     0        0     0      0    0     0         ISRC2DEC2_SRC [7:0]                    0000h
 (B48h) X Input 1        DEC2
        Source          MIX_S
                          TS
 R2912  ISRC2INT1MIX ISRC2I      0     0        0     0      0    0     0          ISRC2INT1_SRC [7:0]                   0000h
 (B60h) Input 1 Source NT1MI
                        X_STS
 R2920  ISRC2INT2MIX ISRC2I      0     0        0     0      0    0     0          ISRC2INT2_SRC [7:0]                   0000h
 (B68h) Input 1 Source NT2MI
                        X_STS
 R3072  GPIO1 CTRL      GP1_D GP1_P GP1_P       0   GP1_L GP1_P GP1_O GP1_D 0             GP1_FN [6:0]                   A101h
 (C00h)                   IR    U      D             VL     OL P_CFG    B
 R3073  GPIO2 CTRL      GP2_D GP2_P GP2_P       0   GP2_L GP2_P GP2_O GP2_D 0             GP2_FN [6:0]                   A101h
 (C01h)                   IR    U      D             VL     OL P_CFG    B
 R3074  GPIO3 CTRL      GP3_D GP3_P GP3_P       0   GP3_L GP3_P GP3_O GP3_D 0             GP3_FN [6:0]                   A101h
 (C02h)                   IR    U      D             VL     OL P_CFG    B
 R3075  GPIO4 CTRL      GP4_D GP4_P GP4_P       0   GP4_L GP4_P GP4_O GP4_D 0             GP4_FN [6:0]                   A101h
 (C03h)                   IR    U      D             VL     OL P_CFG    B
 R3076  GPIO5 CTRL      GP5_D GP5_P GP5_P       0   GP5_L GP5_P GP5_O GP5_D 0             GP5_FN [6:0]                   A101h
 (C04h)                   IR    U      D             VL     OL P_CFG    B
 R3087  IRQ CTRL 1         0     0     0        0     0   IRQ_P IRQ_O   0   0 0 0       0     0        0   0         0   0400h
 (C0Fh)                                                     OL P_CFG
 R3088  GPIO                  GP_DBTIME [3:0]         0      0    0     0   0 0 0       0     0        0   0         0   1000h
 (C10h) Debounce
        Config
 R3096  GP Switch 1        0     0     0        0     0      0    0     0   0 0 0       0     0        0  SW1_MODE       0000h
 (C18h)                                                                                                       [1:0]
 R3104  Misc Pad Ctrl 1 LDO1E LDO1E MCLK2       0     0      0    0     0   0 0 0       0     0        0 RESET RESET     8002h
 (C20h)                 NA_PD NA_PU _PD                                                                   _PU       _PD
 R3105  Misc Pad Ctrl 2    0     0     0      MCLK1   0      0    0     0   0 0 0       0     0        0   0     ADDR_   0001h
284                                                                                                                    Rev 4.1


                                                                                                                       WM8998
  REG        NAME           15     14     13     12     11     10    9       8      7     6     5      4       3     2       1      0  DEFAULT
 (C21h)                                         _PD                                                                                PD
 R3106  Misc Pad Ctrl 3     0       0     0       0     0      0     0       0      0     0     0      0       0     0   DMICD DMICD    0000h
 (C22h)                                                                                                                  AT2_P AT1_P
                                                                                                                             D      D
 R3107  Misc Pad Ctrl 4     0       0     0       0     0      0     0       0      0     0  AIF1LR AIF1LR AIF1B AIF1B AIF1R AIF1R      0000h
 (C23h)                                                                                      CLK_P CLK_P CLK_P CLK_P XDAT_ XDAT_
                                                                                                U      D       U     D      PU     PD
 R3108  Misc Pad Ctrl 5     0       0     0       0     0      0     0       0      0     0  AIF2LR AIF2LR AIF2B AIF2B AIF2R AIF2R      0000h
 (C24h)                                                                                      CLK_P CLK_P CLK_P CLK_P XDAT_ XDAT_
                                                                                                U      D       U     D      PU     PD
 R3109  Misc Pad Ctrl 6     0       0     0       0     0      0     0       0      0     0  AIF3LR AIF3LR AIF3B AIF3B AIF3R AIF3R      0000h
 (C25h)                                                                                      CLK_P CLK_P CLK_P CLK_P XDAT_ XDAT_
                                                                                                U      D       U     D      PU     PD
 R3328  Interrupt Status    0       0     0       0     0      0     0       0      0     0     0      0   GP4_E GP3_E GP2_E GP1_E      0000h
 (D00h) 1                                                                                                    INT1 INT1 INT1 INT1
 R3329  Interrupt Status SPKR_ SPKL_   SPKR_  SPKL_     0      0     0       0      0     0     0      0       0     0       0      0   0000h
 (D01h) 2                DISAB DISAB   ENABL  ENABL
                         LE_DO LE_DO    E_DO   E_DO
                          NE_EI NE_EI   NE_EI NE_EI
                           NT1    NT1    NT1    NT1
 R3330  Interrupt Status SPK_O SPK_O HPDET MICDE WSEQ          0  DRC1_ ASRC2 ASRC1 UNDE OVER          0   FLL2_L FLL1_L CLKGE CLKGE    0000h
 (D02h) 3                 VERH VERH _EINT1 T_EIN _DONE            SIG_D _LOCK _LOCK RCLO CLOC              OCK_E OCK_E N_ERR N_ERR
                          EAT_ EAT_E             T1 _EINT1         ET_EI _EINT1 _EINT1 CKED_ KED_E           INT1 INT1 _EINT1 _ASYN
                         WARN INT1                                  NT1                EINT1 INT1                               C_EIN
                         _EINT1                                                                                                    T1
 R3331  Interrupt Status AIF3_E AIF2_E AIF1_E CTRLI MIXER    ASYN SYSCL   ISRC1  ISRC2    0     0      0    LINER LINEL_ HPR_E  HPL_E   0000h
 (D03h) 4                RR_EI RR_EI RR_EI F_ERR _DROP      C_CLK K_ENA  _CFG_  _CFG_                      _ENAB  ENABL  NABLE  NABLE
                           NT1    NT1    NT1 _EINT1 PED_S   _ENA_ _LOW_  ERR_E  ERR_E                      LE_DO   E_DO   _DON   _DON
                                                     AMPLE  LOW_  EINT1    INT1   INT1                      NE_EI  NE_EI E_EIN  E_EIN
                                                     _EINT1 EINT1                                             NT1   NT1     T1     T1
 R3332  Interrupt Status    0   EP_EN   EP_DI LINER  LINEL_ HPR_D HPL_D BOOT_       0     0     0      0   ASRC_     0    FLL2_  FLL1_  0000h
 (D04h) 5                       ABLE_  SABLE  _DISA  DISAB  ISABL  ISABL DONE                              CFG_E          CLOC   CLOC
                                 DONE   _DON  BLE_D  LE_DO   E_DO  E_DO _EINT1                              RR_EI        K_OK_  K_OK_
                                _EINT1  E_EIN ONE_E  NE_EI  NE_EI NE_EI                                       NT1        EINT1  EINT1
                                         T1    INT1    NT1    NT1   NT1
 R3333  Interrupt Status    0   SPK_S SPKR_ SPKL_       0      0     0       0      0     0     0      0       0     0       0      0   0000h
 (D05h) 6                        HUTD SHOR SHOR
                                OWN_ T_EIN T_EIN
                                 EINT1   T1      T1
 R3336  Interrupt Status    0       0     0       0     0      0     0       0      0     0     0      0   IM_GP IM_GP IM_GP IM_GP      000Fh
 (D08h) 1 Mask                                                                                             4_EINT 3_EINT 2_EINT 1_EINT
                                                                                                               1     1       1      1
 R3337  Interrupt Status IM_SP IM_SP   IM_SP  IM_SP     0      0     0       0      0     0     0      0       0     0       0      0   F000h
 (D09h) 2 Mask           KR_DI KL_DI   KR_EN  KL_EN
                         SABLE SABLE   ABLE_  ABLE_
                          _DON _DON     DONE  DONE
                          E_EIN E_EIN  _EINT1 _EINT1
                            T1     T1
 R3338  Interrupt Status IM_SP IM_SP IM_HP IM_MI IM_WS         0  IM_DR   IM_AS  IM_AS IM_UN IM_OV     0   IM_FLL IM_FLL IM_CL IM_CL    FBEFh
 (D0Ah) 3 Mask           K_OVE K_OVE DET_E CDET_ EQ_D              C1_SI RC2_L  RC1_L  DERCL  ERCL         2_LOC 1_LOC KGEN_ KGEN_
                         RHEAT RHEAT INT1 EINT1 ONE_E             G_DET  OCK_E  OCK_E   OCKE  OCKE          K_EIN K_EIN ERR_E ERR_A
                          _WAR _EINT1                 INT1        _EINT1   INT1   INT1 D_EIN D_EIN            T1    T1     INT1 SYNC_
                         N_EIN                                                           T1    T1                                EINT1
                            T1
 R3339  Interrupt Status IM_AIF IM_AIF IM_AIF IM_CT IM_MIX  IM_AS IM_SY  IM_ISR IM_ISR    0     0      0   IM_LIN IM_LIN IM_HP  IM_HP   FF8Fh
 (D0Bh) 4 Mask           3_ERR 2_ERR 1_ERR RLIF_E ER_DR     YNC_C SCLK_  C1_CF  C2_CF                      ER_EN  EL_EN  R_ENA  L_ENA
                         _EINT1 _EINT1 _EINT1 RR_EI OPPE    LK_EN ENA_L   G_ER   G_ER                      ABLE_  ABLE_  BLE_D  BLE_D
                                                NT1 D_SAM    A_LO OW_EI   R_EIN  R_EIN                      DONE   DONE  ONE_E  ONE_E
                                                     PLE_EI W_EIN   NT1     T1     T1                      _EINT1 _EINT1   INT1   INT1
                                                       NT1    T1
Rev 4.1                                                                                                                                   285


                                                                                                                  WM8998
  REG        NAME           15      14     13     12     11    10     9       8      7     6     5  4     3     2       1       0  DEFAULT
 R3340  Interrupt Status    0   IM_EP  IM_EP  IM_LIN IM_LIN IM_HP  IM_HP  IM_BO      0     0     0  0  IM_AS    0   IM_FLL IM_FLL   7E0Bh
 (D0Ch) 5 Mask                  _ENAB  _ENAB  ER_DI  EL_DIS R_DIS   L_DIS   OT_D                      RC_CF         2_CLO  1_CLO
                                LE_DO  LE_DO  SABLE   ABLE_ ABLE_  ABLE_  ONE_E                        G_ER         CK_OK  CK_OK
                                 NE_EI  NE_EI  _DON  DONE_  DONE   DONE     INT1                       R_EIN        _EINT1 _EINT1
                                   NT1   NT1   E_EIN  EINT1 _EINT1 _EINT1                                T1
                                                 T1
 R3341  Interrupt Status    0   IM_SP  IM_SP  IM_SP      0      0     0       0      0     0     0  0     0     0       0       0   7000h
 (D0Dh) 6 Mask                  K_SHU  KR_SH  KL_SH
                                TDOW   ORT_E  ORT_E
                                N_EIN    INT1   INT1
                                   T1
 R3343  Interrupt           0       0      0      0      0      0     0       0      0     0     0  0     0     0       0    IM_IR  0000h
 (D0Fh) Control                                                                                                                Q1
 R3344  IRQ2 Status 1       0       0      0      0      0      0     0       0      0     0     0  0 GP4_E GP3_E GP2_E GP1_E       0000h
 (D10h)                                                                                                 INT2 INT2 INT2 INT2
 R3345  IRQ2 Status 2    SPKR_  SPKL_  SPKR_  SPKL_      0      0     0       0      0     0     0  0     0     0       0       0   0000h
 (D11h)                  DISAB  DISAB  ENABL  ENABL
                         LE_DO  LE_DO   E_DO   E_DO
                          NE_EI  NE_EI  NE_EI  NE_EI
                           NT2     NT2   NT2     NT2
 R3346  IRQ2 Status 3    SPK_O  SPK_O HPDET MICDE WSEQ          0  DRC1_ ASRC2 ASRC1 UNDE OVER      0 FLL2_L FLL1_L CLKGE CLKGE     0000h
 (D12h)                   VERH   VERH _EINT2 T_EIN _DONE           SIG_D _LOCK _LOCK RCLO CLOC        OCK_E OCK_E N_ERR N_ERR
                          EAT_  EAT_E            T2 _EINT2          ET_EI _EINT2 _EINT2 CKED_ KED_E     INT2 INT2 _EINT2 _ASYN
                         WARN     INT2                               NT2                EINT2 INT2                          C_EIN
                         _EINT2                                                                                                T2
 R3347  IRQ2 Status 4    AIF3_E AIF2_E AIF1_E CTRLI MIXER ASYN SYSCL       ISRC1  ISRC2    0     0  0  LINER LINEL_ HPR_E  HPL_E    0000h
 (D13h)                  RR_EI RR_EI RR_EI F_ERR _DROP C_CLK K_ENA        _CFG_  _CFG_                _ENAB  ENABL  NABLE  NABLE
                           NT2     NT2   NT2 _EINT2 PED_S _ENA_ _LOW_     ERR_E  ERR_E                LE_DO   E_DO   _DON   _DON
                                                     AMPLE LOW_ EINT2       INT2   INT2                NE_EI  NE_EI  E_EIN  E_EIN
                                                     _EINT2 EINT2                                        NT2   NT2     T2      T2
 R3348  IRQ2 Status 5       0   EP_EN   EP_DI LINER  LINEL_ HPR_D  HPL_D BOOT_       0     0     0  0 ASRC_     0    FLL2_  FLL1_   0000h
 (D14h)                         ABLE_  SABLE   _DISA  DISAB  ISABL  ISABL DONE                        CFG_E          CLOC   CLOC
                                 DONE   _DON  BLE_D  LE_DO   E_DO   E_DO _EINT2                        RR_EI        K_OK_  K_OK_
                                _EINT2  E_EIN ONE_E   NE_EI NE_EI  NE_EI                                 NT2         EINT2  EINT2
                                          T2    INT2   NT2    NT2    NT2
 R3349  IRQ2 Status 6       0   SPK_S SPKR_ SPKL_        0      0     0       0      0     0     0  0     0     0       0       0   0000h
 (D15h)                          HUTD SHOR SHOR
                                OWN_ T_EIN T_EIN
                                 EINT2    T2     T2
 R3352  IRQ2 Status 1       0       0      0      0      0      0     0       0      0     0     0  0 IM_GP IM_GP IM_GP IM_GP       000Fh
 (D18h) Mask                                                                                          4_EINT 3_EINT 2_EINT 1_EINT
                                                                                                          2     2       2       2
 R3353  IRQ2 Status 2    IM_SP  IM_SP  IM_SP  IM_SP      0      0     0       0      0     0     0  0     0     0       0       0   F000h
 (D19h) Mask             KR_DI   KL_DI KR_EN  KL_EN
                         SABLE  SABLE  ABLE_  ABLE_
                          _DON   _DON   DONE   DONE
                          E_EIN  E_EIN _EINT2 _EINT2
                            T      T2
 R3354  IRQ2 Status 3    IM_SP  IM_SP IM_HP IM_MI IM_WS         0  IM_DR   IM_AS  IM_AS IM_UN IM_OV 0 IM_FLL IM_FLL IM_CL IM_CL     FBEFh
 (D1Ah) Mask             K_OVE  K_OVE DET_E CDET_ EQ_D              C1_SI RC2_L  RC1_L  DERCL  ERCL   2_LOC 1_LOC KGEN_ KGEN_
                         RHEAT  RHEAT INT2 EINT2 ONE_E             G_DET  OCK_E  OCK_E   OCKE  OCKE    K_EIN K_EIN ERR_E ERR_A
                          _WAR  _EINT2                 INT2        _EINT2   INT2   INT2 D_EIN D_EIN      T2    T2     INT2 SYNC_
                         N_EIN                                                            T2    T2                          EINT2
                            T2
 R3355  IRQ2 Status 4    IM_AIF IM_AIF IM_AIF IM_CT  IM_MIX IM_AS  IM_SY  IM_ISR IM_ISR    0     0  0 IM_LIN IM_LIN  IM_HP  IM_HP   FF8Fh
 (D1Bh) Mask             3_ERR 2_ERR 1_ERR RLIF_E    ER_DR  YNC_C  SCLK_  C1_CF  C2_CF                ER_EN  EL_EN  R_ENA  L_ENA
                         _EINT2 _EINT2 _EINT2 RR_EI   OPPE  LK_EN  ENA_L   G_ER   G_ER                ABLE_  ABLE_  BLE_D  BLE_D
                                                 NT2 D_SAM   A_LO  OW_EI   R_EIN  R_EIN                DONE   DONE  ONE_E  ONE_E
                                                     PLE_EI W_EIN    NT2     T2     T2                _EINT2 _EINT2   INT2    INT2
                                                       NT2     T2
 R3356  IRQ2 Status 5       0   IM_EP IM_EP IM_LIN IM_LIN IM_HP IM_HP IM_BO          0     0     0  0  IM_AS    0   IM_FLL IM_FLL   7E0Bh
286                                                                                                                               Rev 4.1


                                                                                                                     WM8998
  REG        NAME        15      14     13     12    11     10      9     8      7       6      5     4      3     2       1      0  DEFAULT
 (D1Ch) Mask                  _ENAB _ENAB ER_DI EL_DIS R_DIS     L_DIS OT_D                              RC_CF         2_CLO 1_CLO
                              LE_DO LE_DO SABLE ABLE_ ABLE_     ABLE_ ONE_E                               G_ER         CK_OK CK_OK
                              NE_EI NE_EI _DON DONE_ DONE       DONE INT2                                R_EIN         _EINT2 _EINT2
                                NT2    NT2 E_EIN EINT2 _EINT2   _EINT2                                      T2
                                              T2
 R3357  IRQ2 Status 6     0   IM_SP  IM_SP  IM_SP    0      0       0     0      0       0      0     0      0     0       0      0   7000h
 (D1Dh) Mask                  K_SHU  KR_SH  KL_SH
                              TDOW   ORT_E  ORT_E
                              N_EIN   INT2   INT2
                                 T2
 R3359  IRQ2 Control      0       0     0      0     0      0       0     0      0       0      0     0      0     0       0   IM_IR  0000h
 (D1Fh)                                                                                                                         Q2
 R3360  Interrupt Raw  SPKR_  SPKL_  SPKR_  SPKL_    0      0       0     0      0       0      0     0      0     0       0      0   0000h
 (D20h) Status 1       DISAB  DISAB  ENABL  ENABL
                       LE_DO  LE_DO  E_DO    E_DO
                       NE_ST  NE_ST  NE_ST  NE_ST
                          S      S      S      S
 R3361  Interrupt Raw  SPK_O SPK_O      0      0  WSEQ      0   DRC1_ ASRC2 ASRC1 UNDE OVER           0  FLL2_L FLL1_L CLKGE CLKGE    0000h
 (D21h) Status 2        VERH VERH                 _DONE         SIG_D _LOCK _LOCK RCLO CLOC              OCK_S OCK_S N_ERR N_ERR
                        EAT_ EAT_S                 _STS         ET_ST _STS _STS CKED_ KED_S                 TS    TS    _STS _ASYN
                       WARN TS                                     S                   STS     TS                             C_STS
                        _STS
 R3362  Interrupt Raw  AIF3_E AIF2_E AIF1_E CTRLI MIXER ASYN SYSCL ISRC1 ISRC2           0      0     0  LINER  LINEL_ HPR_E  HPL_E   0000h
 (D22h) Status 3       RR_ST RR_ST RR_ST F_ERR _DROP C_CLK K_ENA _CFG_ _CFG_                             _ENAB  ENABL  NABLE  NABLE
                          S      S      S    _STS PED_S _ENA_ _LOW_ ERR_S ERR_S                          LE_DO   E_DO   _DON   _DON
                                                  AMPLE LOW_ STS         TS     TS                       NE_ST  NE_ST  E_STS  E_STS
                                                   _STS STS                                                 S      S
 R3363  Interrupt Raw     0   EP_EN  EP_DI  LINER LINEL_ HPR_D  HPL_D BOOT_      0       0      0     0  ASRC_     0    FLL2_ FLL1_   0000h
 (D23h) Status 4              ABLE_  SABLE  _DISA DISAB  ISABL   ISABL DONE                              CFG_E          CLOC CLOC
                              DONE   _DON   BLE_D LE_DO   E_DO   E_DO _STS                               RR_ST         K_OK_ K_OK_
                               _STS  E_STS  ONE_S NE_ST  NE_ST  NE_ST                                       S            STS    STS
                                              TS     S      S      S
 R3364  Interrupt Raw     0   PWM_   FX_CO  DAC_S  DAC_   ADC_  MIXER     0   AIF3_A AIF2_A AIF1_A    0  AIF3_S AIF2_S AIF1_S PAD_C   0000h
 (D24h) Status 5              OVER   RE_OV  YS_OV WARP   OVER   _OVER         SYNC_  SYNC_  SYNC_         YNC_   YNC_   YNC_  TRL_O
                              CLOC    ERCL   ERCL _OVER  CLOC    CLOC         OVER    OVER   OVER        OVER   OVER    OVER  VERCL
                              KED_S  OCKE    OCKE CLOCK  KED_S  KED_S         CLOC    CLOC   CLOC        CLOC   CLOC    CLOC   OCKE
                                 TS  D_STS  D_STS ED_ST    TS      TS         KED_S  KED_S  KED_S        KED_S  KED_S  KED_S  D_STS
                                                     S                          TS      TS     TS           TS    TS      TS
 R3365  Interrupt Raw  SLIMB  SLIMB  SLIMB  ASRC_ ASRC_  ASRC_  ASRC_     0      0       0      0     0      0     0   ISRC2  ISRC1   0000h
 (D25h) Status 6       US_SU  US_AS  US_SY   ASYN ASYNC  SYNC_  SYNC_                                                  _OVER  _OVER
                       BSYS_   YNC_  NC_O   C_SYS  _WAR  SYS_O  WARP                                                    CLOC   CLOC
                       OVER   OVER   VERCL  _OVER P_OVE  VERCL  _OVER                                                  KED_S  KED_S
                        CLOC  CLOC   OCKE    CLOC  RCLO  OCKE    CLOC                                                     TS     TS
                       KED_S  KED_S  D_STS  KED_S CKED_  D_STS  KED_S
                         TS      TS           TS    STS            TS
 R3366  Interrupt Raw  SPDIF      0     0      0     0   AIF3_U AIF2_U AIF1_U    0   ISRC2  ISRC1  FX_UN ASRC_  DAC_U  ADC_U  MIXER   0000h
 (D26h) Status 7       _SYNC                             NDER    NDER  NDER          _UNDE  _UNDE  DERCL UNDE   NDER    NDER  _UNDE
                       _OVER                             CLOC    CLOC  CLOC           RCLO   RCLO  OCKE  RCLO   CLOC    CLOC   RCLO
                        CLOC                             KED_S  KED_S  KED_S         CKED_  CKED_  D_STS CKED_  KED_S  KED_S  CKED_
                       KED_S                               TS      TS    TS            STS    STS          STS    TS      TS    STS
                         TS
 R3368  Interrupt Raw     0   SPK_S SPKR_ SPKL_      0      0       0     0      0       0      0     0      0     0       0      0   0000h
 (D28h) Status 8              HUTD SHOR SHOR
                              OWN_ T_STS T_STS
                                STS
 R3392  IRQ Pin Status    0       0     0      0     0      0       0     0      0       0      0     0      0     0   IRQ2_ IRQ1_    0000h
 (D40h)                                                                                                                  STS    STS
 R3408  AOD wkup and      0       0     0      0     0      0       0     0   MICD_  MICD_ GP5_F GP5_R JD1_F JD1_RI        0      0   0000h
 (D50h) trig                                                                  CLAM    CLAM ALL_T ISE_T ALL_T SE_TR
                                                                              P_FAL  P_RIS RIG_S RIG_S RIG_S IG_ST
                                                                              L_TRI   E_TRI    TS    TS     TS     S
Rev 4.1                                                                                                                                 287


                                                                                                              WM8998
  REG        NAME    15 14     13     12   11  10       9       8      7        6     5      4     3       2   1    0  DEFAULT
                                                                    G_STS G_STS
 R3409  AOD IRQ1     0  0      0       0   0    0      0       0    MICD_    MICD_ GP5_F GP5_R JD1_F JD1_RI    0    0   0000h
 (D51h)                                                              CLAM    CLAM ALL_EI ISE_EI ALL_EI SE_EI
                                                                    P_FAL    P_RIS NT1     NT1    NT1    NT1
                                                                    L_EINT   E_EIN
                                                                       1       T1
 R3410  AOD IRQ2     0  0      0       0   0    0      0       0    MICD_    MICD_ GP5_F GP5_R JD1_F JD1_RI    0    0   0000h
 (D52h)                                                              CLAM    CLAM ALL_EI ISE_EI ALL_EI SE_EI
                                                                    P_FAL    P_RIS NT2     NT2    NT2    NT2
                                                                    L_EINT   E_EIN
                                                                       2       T2
 R3411  AOD IRQ Mask 0  0      0       0   0    0      0       0     IM_MI   IM_MI IM_GP IM_GP IM_JD IM_JD     0    0   00FCh
 (D53h) IRQ1                                                        CD_CL    CD_CL 5_FAL 5_RIS 1_FAL 1_RIS
                                                                    AMP_F    AMP_ L_EINT E_EIN L_EINT E_EIN
                                                                    ALL_EI   RISE_   1     T1      1      T1
                                                                      NT1    EINT1
 R3412  AOD IRQ Mask 0  0      0       0   0    0      0       0     IM_MI   IM_MI IM_GP IM_GP IM_JD IM_JD     0    0   00FCh
 (D54h) IRQ2                                                        CD_CL    CD_CL 5_FAL 5_RIS 1_FAL 1_RIS
                                                                    AMP_F    AMP_ L_EINT E_EIN L_EINT E_EIN
                                                                    ALL_EI   RISE_   2     T2      2      T2
                                                                      NT2    EINT2
 R3413  AOD IRQ Raw  0  0      0       0   0    0      0       0       0        0    0      0    MICD_ GP5_S   0 JD1_S  0000h
 (D55h) Status                                                                                   CLAM     TS       TS
                                                                                                 P_STS
 R3414  Jack detect  0  0      0       0   0    0      0       0       0        0    0      0    MICD_     0   0 JD1_D  0000h
 (D56h) debounce                                                                                 CLAM              B
                                                                                                 P_DB
 R3584  FX_Ctrl1     0       FX_RATE [3:0]      0      0       0       0        0    0      0      0       0   0    0   0000h
 (E00h)
 R3585  FX_Ctrl2                              FX_STS [11:0]                                        0       0   0    0   0000h
 (E01h)
 R3600  EQ1_1           EQ1_B1_GAIN [4:0]              EQ1_B2_GAIN [4:0]                    EQ1_B3_GAIN [4:0]    EQ1_E  6318h
 (E10h)                                                                                                           NA
 R3601  EQ1_2           EQ1_B4_GAIN [4:0]              EQ1_B5_GAIN [4:0]             0      0      0       0   0 EQ1_B  6300h
 (E11h)                                                                                                          1_MO
                                                                                                                  DE
 R3602  EQ1_3                                                EQ1_B1_A [15:0]                                            0FC8h
 (E12h)
 R3603  EQ1_4                                                EQ1_B1_B [15:0]                                            03FEh
 (E13h)
 R3604  EQ1_5                                               EQ1_B1_PG [15:0]                                            00E0h
 (E14h)
 R3605  EQ1_6                                                EQ1_B2_A [15:0]                                            1EC4h
 (E15h)
 R3606  EQ1_7                                                EQ1_B2_B [15:0]                                            F136h
 (E16h)
 R3607  EQ1_8                                                EQ1_B2_C [15:0]                                            0409h
 (E17h)
 R3608  EQ1_9                                               EQ1_B2_PG [15:0]                                            04CCh
 (E18h)
 R3609  EQ1_10                                               EQ1_B3_A [15:0]                                            1C9Bh
 (E19h)
 R3610  EQ1_11                                               EQ1_B3_B [15:0]                                            F337h
 (E1Ah)
 R3611  EQ1_12                                               EQ1_B3_C [15:0]                                            040Bh
 (E1Bh)
 R3612  EQ1_13                                              EQ1_B3_PG [15:0]                                            0CBBh
 (E1Ch)
288                                                                                                                   Rev 4.1


                                                                                     WM8998
  REG      NAME 15 14     13     12  11 10  9     8       7    6 5  4     3       2   1   0   DEFAULT
 R3613  EQ1_14                                 EQ1_B4_A [15:0]                                 16F8h
 (E1Dh)
 R3614  EQ1_15                                 EQ1_B4_B [15:0]                                 F7D9h
 (E1Eh)
 R3615  EQ1_16                                 EQ1_B4_C [15:0]                                 040Ah
 (E1Fh)
 R3616  EQ1_17                                EQ1_B4_PG [15:0]                                 1F14h
 (E20h)
 R3617  EQ1_18                                 EQ1_B5_A [15:0]                                 058Ch
 (E21h)
 R3618  EQ1_19                                 EQ1_B5_B [15:0]                                 0563h
 (E22h)
 R3619  EQ1_20                                EQ1_B5_PG [15:0]                                 4000h
 (E23h)
 R3620  EQ1_21                                 EQ1_B1_C [15:0]                                 0B75h
 (E24h)
 R3622  EQ2_1      EQ2_B1_GAIN [4:0]       EQ2_B2_GAIN [4:0]       EQ2_B3_GAIN [4:0]    EQ2_E  6318h
 (E26h)                                                                                  NA
 R3623  EQ2_2      EQ2_B4_GAIN [4:0]       EQ2_B5_GAIN [4:0]     0 0      0       0   0 EQ2_B  6300h
 (E27h)                                                                                 1_MO
                                                                                         DE
 R3624  EQ2_3                                  EQ2_B1_A [15:0]                                 0FC8h
 (E28h)
 R3625  EQ2_4                                  EQ2_B1_B [15:0]                                 03FEh
 (E29h)
 R3626  EQ2_5                                 EQ2_B1_PG [15:0]                                 00E0h
 (E2Ah)
 R3627  EQ2_6                                  EQ2_B2_A [15:0]                                 1EC4h
 (E2Bh)
 R3628  EQ2_7                                  EQ2_B2_B [15:0]                                 F136h
 (E2Ch)
 R3629  EQ2_8                                  EQ2_B2_C [15:0]                                 0409h
 (E2Dh)
 R3630  EQ2_9                                 EQ2_B2_PG [15:0]                                 04CCh
 (E2Eh)
 R3631  EQ2_10                                 EQ2_B3_A [15:0]                                 1C9Bh
 (E2Fh)
 R3632  EQ2_11                                 EQ2_B3_B [15:0]                                 F337h
 (E30h)
 R3633  EQ2_12                                 EQ2_B3_C [15:0]                                 040Bh
 (E31h)
 R3634  EQ2_13                                EQ2_B3_PG [15:0]                                 0CBBh
 (E32h)
 R3635  EQ2_14                                 EQ2_B4_A [15:0]                                 16F8h
 (E33h)
 R3636  EQ2_15                                 EQ2_B4_B [15:0]                                 F7D9h
 (E34h)
 R3637  EQ2_16                                 EQ2_B4_C [15:0]                                 040Ah
 (E35h)
 R3638  EQ2_17                                EQ2_B4_PG [15:0]                                 1F14h
 (E36h)
 R3639  EQ2_18                                 EQ2_B5_A [15:0]                                 058Ch
 (E37h)
 R3640  EQ2_19                                 EQ2_B5_B [15:0]                                 0563h
 (E38h)
 R3641  EQ2_20                                EQ2_B5_PG [15:0]                                 4000h
 (E39h)
Rev 4.1                                                                                          289


                                                                                     WM8998
  REG      NAME 15 14     13     12  11 10  9     8       7    6 5  4     3       2   1   0   DEFAULT
 R3642  EQ2_21                                 EQ2_B1_C [15:0]                                 0B75h
 (E3Ah)
 R3644  EQ3_1      EQ3_B1_GAIN [4:0]       EQ3_B2_GAIN [4:0]       EQ3_B3_GAIN [4:0]    EQ3_E  6318h
 (E3Ch)                                                                                  NA
 R3645  EQ3_2      EQ3_B4_GAIN [4:0]       EQ3_B5_GAIN [4:0]     0 0      0       0   0 EQ3_B  6300h
 (E3Dh)                                                                                 1_MO
                                                                                         DE
 R3646  EQ3_3                                  EQ3_B1_A [15:0]                                 0FC8h
 (E3Eh)
 R3647  EQ3_4                                  EQ3_B1_B [15:0]                                 03FEh
 (E3Fh)
 R3648  EQ3_5                                 EQ3_B1_PG [15:0]                                 00E0h
 (E40h)
 R3649  EQ3_6                                  EQ3_B2_A [15:0]                                 1EC4h
 (E41h)
 R3650  EQ3_7                                  EQ3_B2_B [15:0]                                 F136h
 (E42h)
 R3651  EQ3_8                                  EQ3_B2_C [15:0]                                 0409h
 (E43h)
 R3652  EQ3_9                                 EQ3_B2_PG [15:0]                                 04CCh
 (E44h)
 R3653  EQ3_10                                 EQ3_B3_A [15:0]                                 1C9Bh
 (E45h)
 R3654  EQ3_11                                 EQ3_B3_B [15:0]                                 F337h
 (E46h)
 R3655  EQ3_12                                 EQ3_B3_C [15:0]                                 040Bh
 (E47h)
 R3656  EQ3_13                                EQ3_B3_PG [15:0]                                 0CBBh
 (E48h)
 R3657  EQ3_14                                 EQ3_B4_A [15:0]                                 16F8h
 (E49h)
 R3658  EQ3_15                                 EQ3_B4_B [15:0]                                 F7D9h
 (E4Ah)
 R3659  EQ3_16                                 EQ3_B4_C [15:0]                                 040Ah
 (E4Bh)
 R3660  EQ3_17                                EQ3_B4_PG [15:0]                                 1F14h
 (E4Ch)
 R3661  EQ3_18                                 EQ3_B5_A [15:0]                                 058Ch
 (E4Dh)
 R3662  EQ3_19                                 EQ3_B5_B [15:0]                                 0563h
 (E4Eh)
 R3663  EQ3_20                                EQ3_B5_PG [15:0]                                 4000h
 (E4Fh)
 R3664  EQ3_21                                 EQ3_B1_C [15:0]                                 0B75h
 (E50h)
 R3666  EQ4_1      EQ4_B1_GAIN [4:0]       EQ4_B2_GAIN [4:0]       EQ4_B3_GAIN [4:0]    EQ4_E  6318h
 (E52h)                                                                                  NA
 R3667  EQ4_2      EQ4_B4_GAIN [4:0]       EQ4_B5_GAIN [4:0]     0 0      0       0   0 EQ4_B  6300h
 (E53h)                                                                                 1_MO
                                                                                         DE
 R3668  EQ4_3                                  EQ4_B1_A [15:0]                                 0FC8h
 (E54h)
 R3669  EQ4_4                                  EQ4_B1_B [15:0]                                 03FEh
 (E55h)
 R3670  EQ4_5                                 EQ4_B1_PG [15:0]                                 00E0h
 (E56h)
 R3671  EQ4_6                                  EQ4_B2_A [15:0]                                 1EC4h
290                                                                                         Rev 4.1


                                                                                                                    WM8998
  REG      NAME    15    14    13       12    11       10       9         8    7         6    5     4      3     2     1         0 DEFAULT
 (E57h)
 R3672  EQ4_7                                                        EQ4_B2_B [15:0]                                                F136h
 (E58h)
 R3673  EQ4_8                                                        EQ4_B2_C [15:0]                                                0409h
 (E59h)
 R3674  EQ4_9                                                       EQ4_B2_PG [15:0]                                                04CCh
 (E5Ah)
 R3675  EQ4_10                                                       EQ4_B3_A [15:0]                                                1C9Bh
 (E5Bh)
 R3676  EQ4_11                                                       EQ4_B3_B [15:0]                                                F337h
 (E5Ch)
 R3677  EQ4_12                                                       EQ4_B3_C [15:0]                                                040Bh
 (E5Dh)
 R3678  EQ4_13                                                      EQ4_B3_PG [15:0]                                                0CBBh
 (E5Eh)
 R3679  EQ4_14                                                       EQ4_B4_A [15:0]                                                16F8h
 (E5Fh)
 R3680  EQ4_15                                                       EQ4_B4_B [15:0]                                                F7D9h
 (E60h)
 R3681  EQ4_16                                                       EQ4_B4_C [15:0]                                                040Ah
 (E61h)
 R3682  EQ4_17                                                      EQ4_B4_PG [15:0]                                                1F14h
 (E62h)
 R3683  EQ4_18                                                       EQ4_B5_A [15:0]                                                058Ch
 (E63h)
 R3684  EQ4_19                                                       EQ4_B5_B [15:0]                                                0563h
 (E64h)
 R3685  EQ4_20                                                      EQ4_B5_PG [15:0]                                                4000h
 (E65h)
 R3686  EQ4_21                                                       EQ4_B1_C [15:0]                                                0B75h
 (E66h)
 R3712  DRC1 ctrl1    DRC1_SIG_DET_RMS [4:0]         DRC1_SIG_DE DRC1_ DRC1_ DRC1_ DRC1_ DRC1_ DRC1_ DRC1_ DRC1L DRC1               0018h
 (E80h)                                                T_PK [1:0]      NG_E SIG_D SIG_D KNEE2 QR ANTIC WSEQ _ENA R_ENA
                                                                        NA   ET_M       ET _OP_E         LIP _SIG_
                                                                             ODE             NA                DET_E
                                                                                                                NA
 R3713  DRC1 ctrl2 0      0     0          DRC1_ATK [3:0]                   DRC1_DCY [3:0]        DRC1_MINGAIN [2:0] DRC1_MAXGAI    0933h
 (E81h)                                                                                                                  N [1:0]
 R3714  DRC1 ctrl3  DRC1_NG_MINGAIN [3:0]   DRC1_NG_EXP DRC1_QR_TH DRC1_QR_DC               DRC1_HI_COMP [2:0] DRC1_LO_COMP [2:0]   0018h
 (E82h)                                          [1:0]            R [1:0]        Y [1:0]
 R3715  DRC1 ctrl4 0      0     0       0     0                    DRC1_KNEE_IP [5:0]                   DRC1_KNEE_OP [4:0]          0000h
 (E83h)
 R3716  DRC1 ctrl5 0      0     0       0     0        0               DRC1_KNEE2_IP [4:0]             DRC1_KNEE2_OP [4:0]          0000h
 (E84h)
 R3776  HPLPF1_1   0      0     0       0     0        0       0          0    0         0    0     0      0     0   LHPF1 LHPF1    0000h
 (EC0h)                                                                                                              _MOD _ENA
                                                                                                                       E
 R3777  HPLPF1_2                                                   LHPF1_COEFF [15:0]                                               0000h
 (EC1h)
 R3780  HPLPF2_1   0      0     0       0     0        0       0          0    0         0    0     0      0     0   LHPF2 LHPF2    0000h
 (EC4h)                                                                                                              _MOD _ENA
                                                                                                                       E
 R3781  HPLPF2_2                                                   LHPF2_COEFF [15:0]                                               0000h
 (EC5h)
 R3784  HPLPF3_1   0      0     0       0     0        0       0          0    0         0    0     0      0     0   LHPF3 LHPF3    0000h
 (EC8h)                                                                                                              _MOD _ENA
                                                                                                                       E
Rev 4.1                                                                                                                               291


                                                                                                                             WM8998
   REG       NAME         15      14       13    12      11     10        9     8      7       6    5      4     3         2   1      0  DEFAULT
  R3785  HPLPF3_2                                                           LHPF3_COEFF [15:0]                                            0000h
  (EC9h)
  R3788  HPLPF4_1         0       0        0     0       0      0         0     0     0        0    0      0     0         0 LHPF4 LHPF4  0000h
 (ECCh)                                                                                                                      _MOD _ENA
                                                                                                                               E
  R3789  HPLPF4_2                                                           LHPF4_COEFF [15:0]                                            0000h
 (ECDh)
  R3808  ASRC_ENABL       0       0        0     0       0      0         0     0     0        0    0      0  ASRC2 ASRC2 ASRC1 ASRC1     0000h
  (EE0h) E                                                                                                    L_ENA R_ENA L_ENA R_ENA
  R3809  ASRC_STATU       0       0        0     0       0      0         0     0     0        0    0      0  ASRC2 ASRC2 ASRC1 ASRC1     0000h
  (EE1h) S                                                                                                    L_ENA R_ENA L_ENA R_ENA
                                                                                                               _STS _STS _STS _STS
  R3810  ASRC_RATE1       0           ASRC_RATE1 [3:0]          0         0     0     0        0    0      0     0         0   0     0    0000h
  (EE2h)
  R3811  ASRC_RATE2       0           ASRC_RATE2 [3:0]          0         0     0     0        0    0      0     0         0   0     0    4000h
  (EE3h)
  R3824  ISRC 1 CTRL 1    0             ISRC1_FSH [3:0]         0         0     0     0        0    0      0     0         0   0     0    0000h
  (EF0h)
  R3825  ISRC 1 CTRL 2    0             ISRC1_FSL [3:0]         0         0     0     0        0    0      0     0         0   0     1    0001h
  (EF1h)
  R3826  ISRC 1 CTRL 3 ISRC1 ISRC1 ISRC1 ISRC1           0      0      ISRC1 ISRC1 ISRC1 ISRC1      0      0     0         0   0   ISRC1  0000h
  (EF2h)               _INT1_ _INT2_ _INT3_ _INT4_                     _DEC1 _DEC2 _DEC3 _DEC4                                     _NOTC
                        ENA     ENA       ENA   ENA                     _ENA _ENA _ENA _ENA                                        H_ENA
  R3827  ISRC 2 CTRL 1    0             ISRC2_FSH [3:0]         0         0     0     0        0    0      0     0         0   0     0    0000h
  (EF3h)
  R3828  ISRC 2 CTRL 2    0             ISRC2_FSL [3:0]         0         0     0     0        0    0      0     0         0   0     1    0001h
  (EF4h)
  R3829  ISRC 2 CTRL 3 ISRC2 ISRC2         0     0       0      0      ISRC2 ISRC2    0        0    0      0     0         0   0   ISRC2  0000h
  (EF5h)               _INT1_ _INT2_                                   _DEC1 _DEC2                                                 _NOTC
                        ENA     ENA                                     _ENA _ENA                                                  H_ENA
 R12288  WSEQ          WSEQ_DATA_WIDTH0                                             WSEQ_ADDR0 [12:0] (O)                                 0225h
 (3000h) Sequence 1           [2:0] (O)
 R12289  WSEQ              WSEQ_DELAY0 [3:0] (O)        WSEQ_DATA_START0 [3:0] (O)                    WSEQ_DATA0 [7:0] (O)                0001h
 (3001h) Sequence 2
 R12290  WSEQ          WSEQ_DATA_WIDTH1                                             WSEQ_ADDR1 [12:0] (O)                                 0000h
 (3002h) Sequence 3           [2:0] (O)
 R12291  WSEQ              WSEQ_DELAY1 [3:0] (O)        WSEQ_DATA_START1 [3:0] (O)                    WSEQ_DATA1 [7:0] (O)                0003h
 (3003h) Sequence 4
                                                             (similar for WSEQ_ADDR2* … WSEQ_ADDR254*)
 R12798  WSEQ          WSEQ_DATA_WIDTH25                                           WSEQ_ADDR255 [12:0] (O)                                0000h
 (31FEh) Sequence 511        5 [2:0] (O)
 R12799  WSEQ             WSEQ_DELAY255 [3:0] (O)       WSEQ_DATA_START255 [3:0]                    WSEQ_DATA255 [7:0] (O)                0000h
 (31FFh) Sequence 512                                               (O)
292                                                                                                                                     Rev 4.1


                                                                                               WM8998
APPLICATIONS INFORMATION
RECOMMENDED EXTERNAL COMPONENTS
              ANALOGUE INPUT PATHS
              The WM8998 provides up to 6 analogue audio input paths. Each of these inputs is referenced to the
              internal DC reference, VMID. A DC blocking capacitor is required for each analogue input pin used in
              the target application. The choice of capacitor is determined by the filter that is formed between that
              capacitor and the impedance of the input pin. The circuit is illustrated in Figure 76.
                                                                               1
                                                                     Fc =
                              VMID               -
                                                                            2 p RC
                                                  PGA
                                                 +
                       C
               Input                                                Fc = high pass 3dB cut-off frequency
                                        R
              Figure 76 Audio Input Path DC Blocking Capacitor
              In accordance with the WM8998 input pin resistance (see “Electrical Characteristics”), it is
              recommended that a 1F capacitance for all input connections will give good results in most cases,
              with a 3dB cut-off frequency around 13Hz.
              Ceramic capacitors are suitable, but care must be taken to ensure the desired capacitance is
              maintained at the AVDD operating voltage. Also, ceramic capacitors may show microphonic effects,
              where vibrations and mechanical conditions give rise to electrical signals. This is particularly
              problematic for microphone input paths where a large signal gain is required.
              A single capacitor is required for a single-ended line or microphone input connection. For a differential
              input connection, a DC blocking capacitor is required on both input pins.
              The external connections for single-ended and differential microphones, incorporating the WM8998
              microphone bias circuit, are shown later in the “Microphone Bias Circuit” section - see Figure 77.
              DIGITAL MICROPHONE INPUT PATHS
              The WM8998 provides up to 3 digital microphone input paths. The DMICDAT1 pin carries two
              multiplexed channels of audio data; the DMICDAT2 pin supports a single channel of audio data.
              These interfaces are clocked using the respective DMICCLK1 or DMICCLK2 pin.
              The external connections for digital microphones, incorporating the WM8998 microphone bias circuit,
              are shown later in the “Microphone Bias Circuit” section - see Figure 79.
              Ceramic decoupling capacitors for the digital microphones may be required - refer to the specific
              recommendations for the application microphone(s).
              When two microphones are connected to a single DMICDAT pin, the microphones must be configured
              to ensure that the Left mic transmits a data bit when DMICCLK is high, and the Right mic transmits a
              data bit when DMICCLK is low. The WM8998 samples the digital microphone data at the end of each
              DMICCLK phase. Each microphone must tri-state its data output when the other microphone is
              transmitting. Integrated pull-down resistors can be enabled on the DMICDAT pins if required.
              The voltage reference for each digital microphone interface is selectable. It is important that the
              selected reference for the WM8998 interface is compatible with the applicable configuration of the
              external microphone.
Rev 4.1                                                                                                           293


                                                                                                            WM8998
                          MICROPHONE BIAS CIRCUIT
                          The WM8998 is designed to interface easily with up to 6 analogue microphones or up to 3 digital
                          microphones.
                          Each microphone requires a bias current (electret condenser microphones) or voltage supply (silicon
                          microphones); these can be provided by the MICBIAS1, MICBIAS2 or MICBIAS3 regulators on the
                          WM8998.
                          Note that the MICVDD pin can also be used (instead of MICBIASn) as a reference or power supply for
                          external microphones. The MICBIAS outputs are recommended, as these offer better noise
                          performance and independent enable/disable control.
                          Analogue microphones may be connected in single-ended or differential configurations, as illustrated
                          in Figure 77. The differential configuration provides better performance due to its rejection of
                          common-mode noise; the single-ended method provides a reduction in external component count.
                          A bias resistor is required when using an electret condenser microphone (ECM). The bias resistor
                          should be chosen according to the minimum operating impedance of the microphone and MICBIAS
                          voltage so that the maximum bias current of the WM8998 is not exceeded.
                          A 2.2k bias resistor is recommended; this provides compatibility with a wide range of microphone
                          components.
                                  MICBIAS                                              MICBIAS
                                            IN1AxP,                                               IN1AxP,
                                            IN1BxP,                                               IN1BxP,
                                            IN2AP,                                                IN2AP,
                                            IN2BP                                                 IN2BP
                                            IN1AxN,            +                                  IN1AxN,        +
                             MIC            IN1BxN,            PGA        To ADC     MIC          IN1BxN,        PGA   To ADC
                                            IN2AN,             -                                  IN2AN,         -
                                            IN2BN                                                 IN2BN
                                   GND
                                              VMID                                                  VMID
                                                                                           GND
                          Figure 77 Single-Ended and Differential Analogue Microphone Connections
                          Analogue MEMS microphones can be connected to the WM8998 as illustrated in Figure 78. In this
                          configuration, the MICBIAS generators provide a low-noise supply for the microphones; a bias resistor
                          is not required.
         MICBIAS
                        IN1AxP,                                                                  IN1AxP,
                        IN1BxP,                                              MICBIAS             IN1BxP,
           VDD          IN2AP,                                                                   IN2AP,
 MEMS                   IN2BP                                                                    IN2BP
                 OUT
 Mic
                                                                               VDD
           GND          IN1AxN,               +                                                  IN1AxN,     +
                                                                   MEMS           OUT-P
                        IN1BxN,                PGA    To ADC                                     IN1BxN,     PGA       To ADC
                        IN2AN,                -
                                                                   Mic           OUT-N           IN2AN,      -
                        IN2BN                                                  GND               IN2BN
           GND
                          VREF                                                                     VREF
                                                                               GND
Figure 78 Single-Ended and Differential Analogue Microphone Connections
294                                                                                                                    Rev 4.1


                                                                                      WM8998
        Digital microphone connection to the WM8998 is illustrated in Figure 79.
        Ceramic decoupling capacitors for the digital microphones may be required - refer to the specific
        recommendations for the application microphone(s).
                                                                       MICVDD or
                                                                       MICBIASn
                                                                       DMICCLKn
                                                                                         Digital
                                                                       DMICDATn       Microphone
                                                                                       Interface
                 VDD   CLK  DATA             VDD  CLK   DATA
          VDD      Digital Mic                 Digital Mic
                 CHAN                        CHAN
                                                                       AGND
        Figure 79 Digital Microphone Connection
        The MICBIAS generators can each operate as a voltage regulator or in bypass mode. See “Charge
        Pumps, Regulators and Voltage Reference” for details of the MICBIAS generators.
        In Regulator mode, the MICBIAS regulators are designed to operate without external decoupling
        capacitors. The regulators can be configured to support a capacitive load if required (eg. for digital
        microphone supply decoupling). The compatible load conditions are detailed in the “Electrical
        Characteristics” section.
        If the capacitive load on MICBIAS1, MICBIAS2 or MICBIAS3 exceeds the specified conditions for
        Regulator mode (eg. due to a decoupling capacitor or long PCB trace), then the respective generator
        must be configured in Bypass mode.
        The maximum output current for each MICBIASn pin is noted in the “Electrical Characteristics”. This
        limit must be observed on each MICBIAS output, especially if more than one microphone is connected
        to a single MICBIAS pin. Note that the maximum output current differs between Regulator mode and
        Bypass mode. The MICBIAS output voltage can be adjusted using register control in Regulator mode.
Rev 4.1                                                                                                 295


                                                                                              WM8998
    HEADPHONE/LINE/EARPIECE DRIVER OUTPUT PATH
    The WM8998 provides stereo headphone, stereo line, and mono earpiece output drivers. These
    outputs are all ground-referenced, allowing direct connection to the external load(s). There is no
    requirement for DC blocking capacitors.
    In single-ended (default) configuration, the headphone and line outputs comprise 4 independently
    controlled output channels, for up to 2 stereo outputs. In mono (BTL) mode, the drivers support up to
    2 differential outputs.
    The headphone and line outputs incorporate a common mode, or ground loop, feedback path which
    provides rejection of system-related ground noise. The feedback pins must be connected to ground
    for normal operation of the respective outputs.
    The feedback pins should be connected to GND close to the respective headphone/line jack, as
    illustrated in Figure 80. In mono (differential) mode, the feedback pin(s) should be connected to the
    ground plane that is physically closest to the earpiece output PCB tracks.
    The mono earpiece output is supported on the EPOUTP and EPOUTN pins. The output configuration
    is differential (BTL), suitable for direct connection to an external earpiece or hearing coil load.
    Typical headphone, line, and earpiece connections are illustrated in Figure 80.
    It is recommended to ensure that the electrical characteristics of the PCB traces for each output pair
    are closely matched. This is particularly important to matching the two traces of a differential (BTL)
    output.
                                   HPOUTL
                                  HPOUTR
                                HPOUTFB1
                                                                       The HPOUTFB1 or HPOUTFB2 pin is
                                HPOUTFB2                               selected by the ACCDET_SRC register bit.
                                 LINEOUTL
                     WM8998
                                LINEOUTR
                               LINEOUTFB
                                                                       Note that the headphone and line outputs support
                                                                       stereo (single-ended) or mono (differential) output.
                                   EPOUTP
                                                                       Earpiece
                                   EPOUTN
    Figure 80 Headphone, Line, and Earpiece Connection
    It is common for ESD diodes to be wired to pins that link to external connectors. This provides
    protection from potentially harmful ESD effects. In a typical application, ESD diodes would be
    recommended for the headphone and line output paths (HPOUT and LINEOUT), when used as
    external headphone or line output.
    The HPOUT and LINEOUT outputs are ground-referenced, and the respective voltages may swing
    between +1.8V and -1.8V. The ESD diode configuration must be carefully chosen.
    The recommended ESD diode configuration for these ground-referenced outputs is illustrated in
    Figure 81. The ‘back-to-back’ arrangement is necessary in order to prevent clipping and distortion of
    the output signal.
    Note that similar care is required when connecting the WM8998 outputs to external circuits that
    provide input path ESD protection - the configuration on those input circuits must be correctly
    designed to accommodate ground-referenced signals.
296                                                                                                            Rev 4.1


                                                                                            WM8998
                                       HPOUTL,                            External Headphone/Line
                                     LINEOUTL                             output connection
                        WM8998
                                      HPOUTR,                             External Headphone/Line
                                     LINEOUTR                             output connection
                                                                ESD Protection Diodes
        Figure 81 ESD Diode Configuration for External Output Connections
        SPEAKER DRIVER OUTPUT PATH
        The WM8998 incorporates two Class D speaker drivers, offering high amplifier efficiency at large
        signal levels. As the Class D output is a pulse width modulated signal, the choice of speakers and
        tracking of signals is critical for ensuring good performance and reducing EMI in this mode.
        The efficiency of the speaker drivers is affected by the series resistance between the WM8998 and
        the speaker (e.g. PCB track loss and inductor ESR) as shown in Figure 82. This resistance should be
        as low as possible to maximise efficiency.
             SPKVDD
                                                                  Switching
                   Class D                                          Losses
                     output
           SPKVDD/2
                   GND
                                 Losses due to resistance between output driver and
                                 speaker (e.g. inductor ESR). This resistance must be
                                 minimised in order to maximise efficiency.
        Figure 82 Speaker Connection Losses
        The Class D output requires external filtering in order to recreate the audio signal. This may be
        implemented using a 2nd order LC or 1st order RC filter, or else may be achieved by using a
        loudspeaker whose internal inductance provides the required filter response. An LC or RC filter should
        be used if the loudspeaker characteristics are unknown or unsuitable, or if the length of the
        loudspeaker connection is likely to lead to EMI problems.
        In applications where it is necessary to provide Class D filter components, a 2 nd order LC filter is the
        recommended solution as it provides more attenuation at higher frequencies and minimises power
        dissipated in the filter when compared to a first order RC filter (lower ESR). This maximises both
        rejection of unwanted switching frequencies and overall speaker efficiency. A suitable implementation
        is illustrated in Figure 83.
Rev 4.1                                                                                                     297


                                                                                        WM8998
                                               L = 22H                                 Fc =
                                                                                                  1
                                                                                              2 p LC
                             SPKOUTxP
            WM8998
                             SPKOUTxN           C = 3F
                                                                                       Fc = low pass 3dB
                                                                                       cut-off frequency
    Figure 83 Class D Output Filter Components
    A simple equivalent circuit of a loudspeaker consists of a serially connected resistor and inductor, as
    shown in Figure 84. This circuit provides a low pass filter for the speaker output. If the loudspeaker
    characteristics are suitable, then the loudspeaker itself can be used in place of the filter components
    described earlier. This is known as ‘filterless’ operation.
                                                                               R
                                                                      Fc =
                             SPKOUTxP                                        2pL
                                                   L
            WM8998                                    R
                                                                      Fc = low pass 3dB cut-off frequency
                             SPKOUTxN
    Figure 84 Speaker Equivalent Circuit for Filterless Operation
    For filterless Class D operation, it is important to ensure that a speaker with suitable inductance is
    chosen. For example, if we know the speaker impedance is 8Ω and the desired cut-off frequency is
    20kHz, then the optimum speaker inductance may be calculated as:
                R                8
      L=                =                     = 64H
             2 p Fc        2 p * 20kHz
    8 loudspeakers typically have an inductance in the range 20H to 100H, however, it should be
    noted that a loudspeaker inductance will not be constant across the relevant frequencies for Class D
    operation (up to and beyond the Class D switching frequency). Care should be taken to ensure that
    the cut-off frequency of the loudspeaker’s filtering is low enough to suppress the high frequency
    energy of the Class D switching and, in so doing, to prevent speaker damage. The Class D outputs of
    the WM8998 operate at much higher frequencies than is recommended for most speakers and it must
    be ensured that the cut-off frequency is low enough to protect the speaker.
298                                                                                                  Rev 4.1


                                                                                         WM8998
        POWER SUPPLY / REFERENCE DECOUPLING
        Electrical coupling exists particularly in digital logic systems where switching in one sub-system
        causes fluctuations on the power supply. This effect occurs because the inductance of the power
        supply acts in opposition to the changes in current flow that are caused by the logic switching. The
        resultant variations (‘spikes’) in the power supply voltage can cause malfunctions and unintentional
        behavior in other components. A decoupling (‘bypass’) capacitor can be used as an energy storage
        component which will provide power to the decoupled circuit for the duration of these power supply
        variations, protecting it from malfunctions that could otherwise arise.
        Coupling also occurs in a lower frequency form when ripple is present on the power supply rail caused
        by changes in the load current or by limitations of the power supply regulation method. In audio
        components such as the WM8998, these variations can alter the performance of the signal path,
        leading to degradation in signal quality. A decoupling capacitor can be used to filter these effects, by
        presenting the ripple voltage with a low impedance path that does not affect the circuit to be
        decoupled.
        These coupling effects are addressed by placing a capacitor between the supply rail and the
        corresponding ground reference. In the case of systems comprising multiple power supply rails,
        decoupling should be provided on each rail.
        The recommended power supply and voltage reference decoupling capacitors for WM8998 are
        detailed below in Table 121.
                             POWER SUPPLY                                   DECOUPLING CAPACITOR
          LDOVDD, DBVDD1, DBVDD2, DBVDD3, AVDD                     0.1F ceramic (see Note)
          CPVDD                                                    4.7F ceramic
          MICVDD                                                   4.7F ceramic
          DCVDD                                                    4.7F ceramic
          SPKVDDL, SPKVDDR                                         4.7F ceramic
          VREFC                                                    1.0F ceramic
        Table 121 Power Supply Decoupling Capacitors
        Note: 0.1F is required with 4.7F a guide to the total required power rail capacitance.
        All decoupling capacitors should be placed as close as possible to the WM8998 device. The
        connection between AGND, the AVDD decoupling capacitor and the main system ground should be
        made at a single point as close as possible to the AGND balls of the WM8998.
        Due to the wide tolerance of many types of ceramic capacitors, care must be taken to ensure that the
        selected components provide the required capacitance across the required temperature and voltage
        ranges in the intended application. For most application the use of ceramic capacitors with capacitor
        dielectric X5R is recommended.
Rev 4.1                                                                                                    299


                                                                                         WM8998
    CHARGE PUMP COMPONENTS
    The WM8998 incorporates two Charge Pump circuits, identified as CP1 and CP2.
    CP1 generates the CP1VOUTP and CP1VOUTN supply rails for the ground-referenced headphone
    drivers; CP2 generates the CP2VOUT supply rail for the microphone bias (MICBIAS) regulators.
    Decoupling capacitors are required on each of the Charge Pump outputs. A fly-back capacitor is also
    required for each Charge Pump.
    The recommended Charge Pump capacitors for WM8998 are detailed below in Table 122.
                        DESCRIPTION                                            CAPACITOR
       CP1VOUTP decoupling                                 Required capacitance is 2.0F at 2V.
                                                           Suitable component typically 4.7F.
       CP1VOUTN decoupling                                 Required capacitance is 2.0F at 2V.
                                                           Suitable component typically 4.7F.
       CP1 fly-back                                        Required capacitance is 1.0F at 2V.
       (connect between CP1CA and CP1CB)                   Suitable component typically 2.2F.
       CP2VOUT decoupling                                  Required capacitance is 1.0F at 3.6V.
                                                           Suitable component typically 4.7F.
       CP2 fly-back                                        Required capacitance is 220nF at 2V.
       (connect between CP2CA and CP2CB)                   Suitable component typically 470nF.
    Table 122 Charge Pump External Capacitors
    Ceramic capacitors are recommended for these Charge Pump requirements. Note that, due to the
    wide tolerance of many types of ceramic capacitors, care must be taken to ensure that the selected
    components provide the required capacitance across the required temperature and voltage ranges in
    the intended application. Ceramic capacitors with X5R dielectric are recommended.
    The positioning of the Charge Pump capacitors is important, particularly the fly-back capacitors.
    These capacitors should be placed as close as possible to the WM8998. The component choice and
    positioning of the CP1 components are more critical than those of CP2, due to the higher output
    power requirements of CP1.
    EXTERNAL ACCESSORY DETECTION COMPONENTS
    The external accessory detection circuit measures jack insertion using the JACKDET pin. The
    insertion switch status is detected using an internal pull-up resistor circuit on the JACKDET pin.
    Microphone detection and key-button press detection is supported using the MICDETn pins. The
    applicable MICDET pin should be connected to one of the MICBIASn outputs, via a 2.2k bias
    resistor, as described in the “Microphone Bias Circuit” section. Note that, when using the External
    Accessory Detection function, the MICBIASn resistor must be 2.2k +/-2%.
    A recommended circuit configuration, including headphone output and microphone connections, is
    shown in Figure 85. See “Analogue Input Paths” for details of the DC-blocking microphone input
    capacitor selection.
    The recommended external components and connections for microphone / push-button detection are
    illustrated in Figure 86.
    Note that, when using the Microphone Detect circuit, it is recommended to use the IN2B analogue
    microphone input paths, to ensure best immunity to electrical transients arising from the external
    accessory.
300                                                                                                Rev 4.1


                                                                                                                                                                                                                     WM8998
                                                                                                                                                      2.2k (+/-2%)
                                                                                                                           MICBIASn
                                                                                                                                                                        C
                                                                                                                                        * IN2BP
                                                                                                                                MICDET1
                                                                                                                                        HPOUTL
                                                                                               WM8998
                                                                                                                                  HPOUTR
                                                                                                                    HPOUTFB1
                                                                                                                                                                                                                  Note: The illustrated circuit assumes
                                                                         * Note that the IN2B analogue input                 JACKDET                                                                              the jack insertion switch contacts are
                                                                         channel is recommended with the                                                                    (jack insertion switch)               closed when jack is inserted.
                                                                         external accessory detect function
                                                            Figure 85 External Accessory Detection
                                                            The accessory detection circuit measures the impedance of an external load connected to one of the
                                                            MICDET pins.
                                                            The microphone detection circuit uses MICVDD, MICBIAS1, MICBIAS2 or MICBIAS3 as a reference.
                                                            The applicable source is configured using the MICD_BIAS_SRC register.
                                                            The WM8998 can detect the presence of a typical microphone and up to 6 push-buttons, using the
                                                            components shown in Figure 86. When the microphone detection circuit is enabled, then each of the
                                                            push-buttons shown will cause a different bit within the MICD_LVL register to be set.
                                                            The microphone detect function is specifically designed to detect a video accessory (typical 75) load
                                                            if required. A measured external impedance of 75 will cause the MICD_LVL [3] bit to be set.
                                                                                                                                                                                                       MICBIAS
 The measured impedance is reported using the MICD_STS and MICD_LVL bits.
 When no accessory or push-button is detected, the MICD_STS bit is set to 0.
 When MICD_STS = 1, then one of the MICD_LVL bits is set to indicate the measured impedance.
 The applicable MICD_LVL bit for each push-button is noted below.
 Detection of the microphone alone (no push-buttons closed) is indicated in MICD_LVL[8].                                                                                                             2.2k
                                                                                                                                                                                                    (+/-2%)
                        220                        82                       33                             22                       18
                                                                                                                                                                                                        MICDET
                                                                                                                                                                                                              C             Analogue Input
   MICD_LVL[5] - 375          MICD_LVL[4] - 155                                                                                                                             MICD_LVL[8] - >475
                                                          MICD_LVL[3] – 73               MICD_LVL[2] – 40         MICD_LVL[1] - 18             MICD_LVL[0] - <3
                                                                                                                                                                                                          AGND
                                                                                                                                                                      Microphone:
    Push-buttons
                                                                                                                                                                      475 to 30k
Figure 86 External Accessory Detect Connection
Rev 4.1                                                                                                                                                                                                                                            301


                                                                                                                                                                               WM8998
                                                RECOMMENDED EXTERNAL COMPONENTS DIAGRAM
    4.2V                 1.8V
                                                                                                                                                        1.0F
                                                                                                    SPKGNDR
                                                                                                              AGND
                                                                                          SPKGNDL
                                                                                                                     CPGND
                                                                                                                             DGND
                                                                                                                                       VREFC
                                                                              SPKVDDL                                                    SDA
                                                                              SPKVDDR                                                   SCLK                             Control Interface
                                                                              CPVDD                                                    ADDR
                                                                              LDOVDD
4.7F      4.7F                                                              AVDD
                                                                              DBVDD1                                                   MCLK1
                                                                                                                                                                         Master Clocks
                                                                              DBVDD2                                                   MCLK2
                                                                              DBVDD3
                    4.7F                                                                                                              GPIO1
                                                                                                                                       GPIO2
                                                                                                                                       GPIO3                      GPIO
                                    5 x 0.1F                                 DCVDD
                                                                4.7F                                                                  GPIO4
                                                                                                                                       GPIO5
                                                                              LDOVOUT
                                                                                                                                      GPSWP
                                   LDO Control                                LDOENA                                                  GPSWN
                                 Reset Control                                RESET
                                Interrupt Output                              IRQ                                                               2.2F
                                                                                                                                       CP1CA
                                                                                                                                       CP1CB
                                                                                                                                                         4.7F
                                                                              SLIMCLK                                               CP1VOUTP
                      SLIMbus Interface                                                                                                                         4.7F
                                                                              SLIMDAT                                               CP1VOUTN
                                                                                                                                                470nF
                                                                                                                                       CP2CA
                                                                              AIF1BCLK
                                                                                                                                       CP2CB
                                                                              AIF1LRCLK                                                                  4.7F
                      Audio Interface 1                                                                                              CP2VOUT
                                                                              AIF1RXDAT
                                                                              AIF1TXDAT
                                                                                                                                     JACKDET                              Jack Detect input
                                                                                          WM8998
                                                                              AIF2BCLK
                                                                              AIF2LRCLK                                               HPOUTL                                             Headphone
                      Audio Interface 2
                                                                              AIF2RXDAT                                              HPOUTR
                                                                              AIF2TXDAT                       HPOUTFB1/MICDET2
                                                                                                                                                                         (Note: HPOUTFB ground
                                                                                                                                      HPDETL                             connection close to headset jack)
                                                                              AIF3BCLK                                               HPDETR
                                                                              AIF3LRCLK
                      Audio Interface 3
                                                                              AIF3RXDAT                                             LINEOUTL
                                                                              AIF3TXDAT                                                                                                       Line Output
                                                                                                                                    LINEOUTR
                                                                                                                                LINEOUTFB
                      MICBIAS1                                                                                                                                           (Note: LINEOUTFB ground
                                                                                                                                                                         connection close to output jack)
                                       VDD
                                                                CLK
                                      CHAN
                                                   DMIC         DAT                                                                                                         Outputs HPOUT and LINEOUT
                                       GND                                                                                           EPOUTN                 Earpiece
Stereo Digital                                                                IN1ALP                                                                                        can be configured as Stereo
                                                                                                                                      EPOUTP                Speaker
Microphone                                                                                                                                                                  pairs or Differential Mono.
                                                                              IN1ALN/DMICCLK1
connection                             VDD
                                                                CLK           IN1ARP
                                      CHAN
                                                   DMIC         DAT
                                       GND                                    IN1ARN/DMICDAT1
                                                                                                                                    SPKOUTLN
                                                                                                                                                                               Loudspeaker
                                                                                                                                    SPKOUTLP
                                                          1F
Single-ended                                                                  IN1BLP
Line                                                                                                                                SPKOUTRN
                                                                              IN1BLN                                                                                                Loudspeaker
connection                                                1F                                                                       SPKOUTRP
                                                                              IN1BRP
                                                                              IN1BRN
                             MICBIAS2                                                                                                 SPKCLK                      Digital Speaker
                                                                              MICDET1/HPOUTFB2                                                                    (PDM) interface
                                                                                                                                      SPKDAT
                         2.2k                                          1F
                                                                              IN2BP
Differential                                              1F
Microphone                                                                    IN2BN                                                 MICBIAS1
connection                                                                                                                          MICBIAS2                Bias / Supplies for
                                                                                                                                                            Microphones and External
                                                                              IN2AP/DMICDAT2                                        MICBIAS3
                         2.2k                                                                                                                              Accessory Detection
                                                                              IN2AN/DMICCLK2                                          MICVDD
                   Analogue and Digital Inputs                                                                                                 4.7F
302                                                                                                                                                                                                Rev 4.1


                                                                                               WM8998
RESETS SUMMARY
               The contents of Table 123 provide a summary of the WM8998 registers and other programmable
               memory under different reset conditions. The associated events and conditions are listed below.
                       A Power-On Reset occurs when AVDD or DBVDD1 is below its respective reset threshold.
                        (Note that DCVDD is also required for initial start-up; subsequent interruption to DCVDD
                        should only be permitted as part of a control sequence for entering Sleep mode.)
                       A Hardware Reset occurs when the RESET
                                                             ¯¯¯¯¯¯ input is asserted (logic 0).
                       A Software Reset occurs when register R0 is written to.
                       Sleep Mode is selected when LDO1 is disabled. (LDO1 can be controlled using the
                        LDO1_ENA register bit, or using the LDOENA pin; both of these controls must be de-
                        asserted to disable the LDO.) Note that the AVDD, DBVDD1 and LDOVDD supplies must
                        be present, and the LDOENA pin held low. It is assumed that DCVDD is supplied by LDO1.
                                              ALWAYS-ON                    OTHER                   CONTROL
                                               REGISTERS                 REGISTERS               SEQUENCER
                                                                                                    MEMORY
                 Power-On Reset                  Reset                     Reset                     Reset
                 Hardware Reset                  Reset                     Reset                   Retained
                 Software Reset                  Reset                     Reset                   Retained
                 Sleep Mode                     Retained                   Reset                   Retained
               Table 123 Memory Reset Summary
               See “Low Power Sleep Configuration” for details of the ‘Always-On’ registers.
Rev 4.1                                                                                                        303


                                                                                                     WM8998
DIGITAL AUDIO INTERFACE CLOCKING CONFIGURATIONS
                 The digital audio interfaces (AIF1, AIF2, AIF3) can be configured in Master or Slave modes. In all
                 applications, it is important that the system clocking configuration is correctly designed. Incorrect clock
                 configurations will lead to audible clicks arising from dropped or repeated audio samples; this is
                 caused by the inherent tolerances of multiple asynchronous system clocks.
                 To ensure reliable clocking of the audio interface functions, it is a requirement that the external
                 interface clocks (eg. BCLK, LRCLK) are derived from the same clock source as SYSCLK (or
                 ASYNCCLK, where applicable).
                 In AIF Master mode, the external BCLK and LRCLK signals are generated by the WM8998 and
                 synchronisation of these signals with SYSCLK (or ASYNCCLK) is ensured. In this case, clocking of
                 the AIF is typically derived from the MCLK1 or MCLK2 inputs, either directly or via one of the
                 Frequency Locked Loop (FLL) circuits. It is also possible to use a different interface (AIFn or
                 SLIMbus) to provide the reference clock to which the AIF Master can be synchronised.
                 In AIF Slave mode, the external BCLK and LRCLK signals are generated by another device, as inputs
                 to the WM8998. In this case, it must be ensured that the applicable system clock (SYSCLK or
                 ASYNCCLK) is generated from a source that is synchronised to the external BCLK and LRCLK
                 inputs.
                 In a typical Slave mode application, the BCLK input is selected as the clock reference, using the FLL
                 to perform frequency shifting. It is also possible to use the MCLK1 or MCLK2 inputs, but only if the
                 selected clock is synchronised externally to the BCLK and LRCLK inputs. The SLIMbus interface can
                 also provide the clock reference, via one of the FLLs, provided that the BCLK and LRCLK signals are
                 externally synchronised with the SLIMCLK input.
                 The valid AIF clocking configurations are listed in Table 124 for AIF Master and AIF Slave modes.
                 The applicable system clock (SYSCLK or ASYNCCLK) depends on the AIFn_RATE setting for the
                 relevant digital audio interface; if AIFn_RATE < 1000, then SYSCLK is applicable; if
                 AIFn_RATE ≥ 1000, then ASYNCCLK is applicable.
                        AIF MODE                                   CLOCKING CONFIGURATION
                   AIF Master Mode         SYSCLK_SRC (ASYNCCLK_SRC) selects MCLK1 or MCLK2 as SYSCLK
                                           (ASYNCCLK) source.
                                           SYSCLK_SRC (ASYNCCLK_SRC) selects FLLn as SYSCLK (ASYNCCLK)
                                           source; FLLn_REFCLK_SRC selects MCLK1 or MCLK2 as FLLn source.
                                           SYSCLK_SRC (ASYNCCLK_SRC) selects FLLn as SYSCLK (ASYNCCLK)
                                           source; FLLn_REFCLK_SRC selects a different interface (BCLK, LRCLK,
                                           SLIMCLK) as FLLn source.
                   AIF Slave Mode          SYSCLK_SRC (ASYNCCLK_SRC) selects FLLn as SYSCLK (ASYNCCLK)
                                           source; FLLn_REFCLK_SRC selects BCLK as FLLn source.
                                           SYSCLK_SRC (ASYNCCLK_SRC) selects MCLK1 or MCLK2 as SYSCLK
                                           (ASYNCCLK) source, provided MCLK is externally synchronised to the
                                           BCLK input.
                                           SYSCLK_SRC (ASYNCCLK_SRC) selects FLLn as SYSCLK (ASYNCCLK)
                                           source; FLLn_REFCLK_SRC selects MCLK1 or MCLK2 as FLLn source,
                                           provided MCLK is externally synchronised to the BCLK input.
                                           SYSCLK_SRC (ASYNCCLK_SRC) selects FLLn as SYSCLK (ASYNCCLK)
                                           source; FLLn_REFCLK_SRC selects a different interface (eg. SLIMCLK) as
                                           FLLn source, provided the other interface is externally synchronised to the
                                           BCLK input.
                 Table 124 Audio Interface (AIF) Clocking Confgurations
304                                                                                                               Rev 4.1


                                                                                                                      WM8998
                                      In each case, the SYSCLK (ASYNCCLK) frequency must be a valid ratio to the LRCLK frequency; the
                                      supported clocking rates are defined by the SYSCLK_FREQ (ASYNC_CLK_FREQ) and
                                      SAMPLE_RATE_n (ASYNC_SAMPLE_RATE_n) registers.
                                      The valid AIF clocking configurations are illustrated in Figure 87 to Figure 93 below. Note that, where
                                      MCLK1 is illustrated as the clock source, it is equally possible to select MCLK2 as the clock source.
                                      Similarly, in cases where FLL1 is illustrated, it is equally possible to select FLL2.
  WM8998                                                                                Processor
                                                                       AIFnBCLK
                                   SYSCLK
                                                                       AIFnLRCLK
                              (or ASYNCCLK)
                                                    AIFn
                                                (Master Mode)          AIFnRXDAT
                                                                       AIFnTXDAT
    MCLK1   MCLK2
                        SYSCLK_SRC
                    (or ASYNCCLK_SRC)
    Oscillator
Figure 87 AIF Master Mode, using MCLK as Reference
   WM8998                                                                                                    Processor
                                    FLL1
                                                                                          AIFnBCLK
                                                            SYSCLK
                    FLL1_REFCLK_SRC                    (or ASYNCCLK)
                                                                                          AIFnLRCLK
                                                                            AIFn
                                                                        (Master Mode)     AIFnRXDAT
                                                                                          AIFnTXDAT
    MCLK1   MCLK2
                                                SYSCLK_SRC
                                           (or ASYNCCLK_SRC)
    Oscillator
Figure 88 AIF Master Mode, using MCLK and FLL as Reference
Rev 4.1                                                                                                                                 305


                                                                                                                                                   WM8998
   WM8998                                                                                                                                  Processor
                                                         FLL1
                                                                                                                           AIFnBCLK
                                                                                    SYSCLK
                                        FLL1_REFCLK_SRC                        (or ASYNCCLK)
                                                                                                                           AIFnLRCLK
                                                                                                   AIFn
                                                                                               (Master Mode)               AIFnRXDAT
      SLIMCLK    AIFnLRCLK   AIFnBCLK
                                                                                                                           AIFnTXDAT
                                                                     SYSCLK_SRC
                                                                (or ASYNCCLK_SRC)
                                                                                                                                           Processor
                                                                                                                           AIFnBCLK
                                                                                                                           AIFnLRCLK
                                                                                                       AIFn
                                                                                                   (Slave Mode)            AIFnRXDAT
   Automatic                                                                                                               AIFnTXDAT
    Divider
                FRAMER_REF_GEAR
                                                                                                                                           Processor
                                                                                                                          SLIMCLK
                                                                                                    SLIMbus
                                                                                                    Interface             SLIMDAT
Figure 89 AIF Master Mode, using another Interface as Reference
   WM8998                                                                                                                              Processor
                                           FLL1
                                                                                                                    AIFnBCLK
                                                                     SYSCLK
  FLL1_REFCLK_SRC                                                                                                   AIFnLRCLK
                                                                (or ASYNCCLK)
                                                                                        AIFn
                                                                                    (Slave Mode)                    AIFnRXDAT
                                                                                                                    AIFnTXDAT
                                                       SYSCLK_SRC
                                                  (or ASYNCCLK_SRC)
Figure 90 AIF Slave Mode, using BCLK and FLL as Reference
  WM8998                                                                                                          Processor
                                                                                       AIFnBCLK
                                                  SYSCLK
                                             (or ASYNCCLK)
                                                                                       AIFnLRCLK
                                                                    AIFn
                                                                (Slave Mode)           AIFnRXDAT
                                                                                       AIFnTXDAT                      Synchronous
      MCLK1     MCLK2
                                 SYSCLK_SRC                                                                          Clock Generator
                             (or ASYNCCLK_SRC)
306                                                                                                                                                    Rev 4.1


                                                                                                                              WM8998
Figure 91 AIF Slave Mode, using MCLK as Reference
   WM8998                                                                                                              Processor
                                                FLL1
                                                                                                         AIFnBCLK
                                                                           SYSCLK
                          FLL1_REFCLK_SRC                             (or ASYNCCLK)
                                                                                                         AIFnLRCLK
                                                                                          AIFn
                                                                                      (Slave Mode)       AIFnRXDAT
                                                                                                         AIFnTXDAT         Synchronous
     MCLK1     MCLK2
                                                            SYSCLK_SRC                                                    Clock Generator
                                                       (or ASYNCCLK_SRC)
Figure 92 AIF Slave Mode, using MCLK and FLL as Reference
   WM8998                                                                                                                Processor
                                                       FLL1
                                                                                                           AIFnBCLK
                                                                               SYSCLK
                                     FLL1_REFCLK_SRC                      (or ASYNCCLK)
                                                                                                           AIFnLRCLK
                                                                                              AIFn
                                                                                          (Slave Mode)     AIFnRXDAT
    SLIMCLK   AIFnLRCLK   AIFnBCLK
                                                                                                           AIFnTXDAT             Synchronous
                                                                   SYSCLK_SRC                                                   Clock Generator
                                                              (or ASYNCCLK_SRC)
                                                                                                                         Processor
                                                                                                           AIFnBCLK
                                                                                                           AIFnLRCLK
                                                                                              AIFn
                                                                                          (Slave Mode)     AIFnRXDAT
   Automatic                                                                                               AIFnTXDAT
    Divider
              FRAMER_REF_GEAR
                                                                                                                         Processor
                                                                                                           SLIMCLK
                                                                                            SLIMbus
                                                                                            Interface      SLIMDAT
Figure 93 AIF Slave Mode, using another Interface as Reference
PCB LAYOUT CONSIDERATIONS
                                                Poor PCB layout will degrade the performance and be a contributory factor in EMI, ground bounce
                                                and resistive voltage losses. All external components should be placed as close to the WM8998
                                                device as possible, with current loop areas kept as small as possible.
Rev 4.1                                                                                                                                           307


                   WM8998
PACKAGE DIMENSIONS
308                   Rev 4.1


                                                                                                                     WM8998
IMPORTANT NOTICE
Contacting Cirrus Logic Support
For all product questions and inquiries, contact a Cirrus Logic Sales Representative.
To find one nearest you, go to www.cirrus.com.
For the purposes of our terms and conditions of sale, "Preliminary" or "Advanced" datasheets are non-final datasheets that include
but are not limited to datasheets marked as “Target”, “Advance”, “Product Preview”, “Preliminary Technical Data” and/or “Pre-
production.” Products provided with any such datasheet are therefore subject to relevant terms and conditions associated with
"Preliminary" or "Advanced" designations. The products and services of Cirrus Logic International (UK) Limited; Cirrus Logic, Inc.;
and other companies in the Cirrus Logic group (collectively either “Cirrus Logic” or “Cirrus”) are sold subject to Cirrus Logic’s terms
and conditions of sale supplied at the time of order acknowledgment, including those pertaining to warranty, indemnification, and
limitation of liability. Software is provided pursuant to applicable license terms. Cirrus Logic reserves the right to make changes to its
products and specifications or to discontinue any product or service without notice. Customers should therefore obtain the latest
version of relevant information from Cirrus Logic to verify that the information is current and complete. Testing and other quality
control techniques are utilized to the extent Cirrus Logic deems necessary. Specific testing of all parameters of each device is not
necessarily performed. In order to minimize risks associated with customer applications, the customer must use adequate design
and operating safeguards to minimize inherent or procedural hazards. Cirrus Logic is not liable for applications assistance or
customer product design. The customer is solely responsible for its selection and use of Cirrus Logic products. Use of Cirrus Logic
products may entail a choice between many different modes of operation, some or all of which may require action by the user, and
some or all of which may be optional. Nothing in these materials should be interpreted as instructions or suggestions to choose one
mode over another. Likewise, description of a single mode should not be interpreted as a suggestion that other modes should not be
used or that they would not be suitable for operation. Features and operations described herein are for illustrative purposes only.
CERTAIN APPLICATIONS USING SEMICONDUCTOR PRODUCTS MAY INVOLVE POTENTIAL RISKS OF DEATH, PERSONAL
INJURY, OR SEVERE PROPERTY OR ENVIRONMENTAL DAMAGE (“CRITICAL APPLICATIONS”). CIRRUS PRODUCTS ARE
NOT DESIGNED, AUTHORIZED OR WARRANTED FOR USE IN PRODUCTS SURGICALLY IMPLANTED INTO THE BODY,
AUTOMOTIVE SAFETY OR SECURITY DEVICES, NUCLEAR SYSTEMS, LIFE SUPPORT PRODUCTS OR OTHER CRITICAL
APPLICATIONS. INCLUSION OF CIRRUS PRODUCTS IN SUCH APPLICATIONS IS UNDERSTOOD TO BE FULLY AT THE
CUSTOMER’S RISK AND CIRRUS DISCLAIMS AND MAKES NO WARRANTY, EXPRESS, STATUTORY OR IMPLIED,
INCLUDING THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR PARTICULAR PURPOSE, WITH
REGARD TO ANY CIRRUS PRODUCT THAT IS USED IN SUCH A MANNER. IF THE CUSTOMER OR CUSTOMER’S
CUSTOMER USES OR PERMITS THE USE OF CIRRUS PRODUCTS IN CRITICAL APPLICATIONS, CUSTOMER AGREES, BY
SUCH USE, TO FULLY INDEMNIFY CIRRUS, ITS OFFICERS, DIRECTORS, EMPLOYEES, DISTRIBUTORS AND OTHER
AGENTS FROM ANY AND ALL LIABILITY, INCLUDING ATTORNEYS’ FEES AND COSTS, THAT MAY RESULT FROM OR
ARISE IN CONNECTION WITH THESE USES.
This document is the property of Cirrus and by furnishing this information, Cirrus grants no license, express or implied, under any
patents, mask work rights, copyrights, trademarks, trade secrets or other intellectual property rights. Any provision or publication of
any third party’s products or services does not constitute Cirrus’s approval, license, warranty or endorsement thereof. Cirrus gives
consent for copies to be made of the information contained herein only for use within your organization with respect to Cirrus
integrated circuits or other products of Cirrus, and only if the reproduction is without alteration and is accompanied by all associated
copyright, proprietary and other notices and conditions (including this notice). This consent does not extend to other copying such as
copying for general distribution, advertising or promotional purposes, or for creating any work for resale. This document and its
information is provided “AS IS” without warranty of any kind (express or implied). All statutory warranties and conditions are
excluded to the fullest extent possible. No responsibility is assumed by Cirrus for the use of information herein, including use of this
information as the basis for manufacture or sale of any items, or for infringement of patents or other rights of third parties. Cirrus
Logic, Cirrus, the Cirrus Logic logo design, SoundClear, and WISCE are among the trademarks of Cirrus. Other brand and product
names may be trademarks or service marks of their respective owners.
Copyright © 2014–2017 Cirrus Logic, Inc. All rights reserved.
SLIMbus is a trademark or registered trademark of MIPI Alliance, Inc.
Rev 4.1                                                                                                                                309


                                                                                                   WM8998
REVISION HISTORY
    DATE   REV                      DESCRIPTION OF CHANGES                                 PAGE      CHANGED BY
  02/01/14 1.0 First Release.
  14/01/14 2.0 Reel Quantity changed                                                                     PH
  25/02/14 2.0 Digital Speaker (PDM) output added.                                                       PH
               Additional notes on SLIMbus Value Map & Information Map.
               Clarification of the TRIG_ON_STARTUP (automatic sample rate
               detection) behaviour.
               IN1 / IN3 input pins changed to IN1A / IN1B.
               IN2 / IN4 input pins changed to IN2A / IN2B.
               SLIMbus Timing information added.
  25/03/14 2.0 Updated Electrical Characteristics                                                        SS
  14/05/14 2.1 Recommended DBVDD1 operating range updated - 1.7V to 1.9V.                   13           PH
               SLIMCLK_REF_GEAR description updated.                                       136
  21/05/14 2.2 Updates to Charge Pump configuration requirements, according to        15, 140, 142       PH
               HPOUT or EPOUT load condition.
               Electrical Characteristics and Reset Thresholds updated.                   16-23
               Thermal characteristics added.                                               25
               Control logic affecting ‘on-the-fly’ AIF configuration described.        108-119
               SLIMbus description for control register access updated.                 134-135
               Added ‘Initialisation Sequence’ definition - required after Power-Up,    235, 255,
               Reset, or Wake-Up.                                                       256, 259
  26/06/14 3.0 Product Status updated to Pre-Production                                     All        JMacDs
  15/10/14 4.0 Clarification to the AEC Loopback path description                      2, 140, 151       PH
               Clarification of LDOENA & LDOVDD pin requirements                          9, 249
               Electrical Characteristics updated                                         16-18
               Typical Performance data added                                             26-27
               Clarification of Sleep Mode control requirements when using                 176
               external DCVDD (not LDO1)
               Bus-keeper function on GPIO pins is removed                              179-180
  09/01/17 4.1 Clarification of DCVDD, GPSWN, GPSWP voltage limits                        12, 21         PH
               Clarification of PDM input/output digital signal levels.              14, 16, 50, 147
               Electrical Characteristics updated.                                          15
               Correction to PWMn_LVL description.                                     86, 87, 190
               Sample Rate control requirements updated (*RATE, *FSL, *FSH).             88-103
               ASRC sample rate restrictions added.                                    96, 98, 211
               Clarification of SLIMbus requirements for different TP options.          128, 129
               Clocking required for FLL Interrupt.                                        197
               FLL configuration and example settings updated.                          222-237
               Correction to FLLn_SS_SEL description.                                      234
               Noted constraints for using WSEQ_START to trigger WSEQ.                     242
310                                                                                                         Rev 4.1


Mouser Electronics
Authorized Distributor
Click to View Pricing, Inventory, Delivery & Lifecycle Information:
Cirrus Logic:
 WM8998ECS/R
