                                                                      MCP2510
        Stand-Alone CAN Controller with SPI™ Interface
Features                                                Description
• Implements Full CAN V2.0A and V2.0B at 1 Mb/s:        The Microchip Technology Inc. MCP2510 is a Full Con-
  - 0 - 8 byte message length                           troller Area Network (CAN) protocol controller imple-
  - Standard and extended data frames                   menting CAN specification V2.0 A/B. It supports CAN
                                                        1.2, CAN 2.0A, CAN 2.0B Passive, and CAN 2.0B
  - Programmable bit rate up to 1 Mb/s
                                                        Active versions of the protocol, and is capable of trans-
  - Support for remote frames                           mitting and receiving standard and extended mes-
  - Two receive buffers with prioritized message        sages. It is also capable of both acceptance filtering
    storage                                             and message management. It includes three transmit
  - Six full acceptance filters                         buffers and two receive buffers that reduce the amount
  - Two full acceptance filter masks                    of microcontroller (MCU) management required. The
                                                        MCU communication is implemented via an industry
  - Three transmit buffers with prioritization and
                                                        standard Serial Peripheral Interface (SPI) with data
    abort features
                                                        rates up to 5 Mb/s.
  - Loop-back mode for self test operation
• Hardware Features:                                    Package Types
  - High Speed SPI Interface
                                                          18 LEAD PDIP/SOIC
    (5 MHz at 4.5V I temp)
  - Supports SPI modes 0,0 and 1,1                                  TXCAN     1               18   VDD
  - Clock out pin with programmable prescaler                       RXCAN     2               17   RESET
  - Interrupt output pin with selectable enables                   CLKOUT     3               16   CS
  - ‘Buffer full’ output pins configureable as inter-
                                                                                   MCP2510
                                                                    TX0RTS    4               15   SO
    rupt pins for each receive buffer or as general
                                                                    TX1RTS    5               14   SI
    purpose digital outputs
  - ‘Request to Send’ input pins configureable as                   TX2RTS    6               13   SCK
    control pins to request immediate message                         OSC2    7               12   INT
    transmission for each transmit buffer or as                                                    RX0BF
                                                                      OSC1    8               11
    general purpose digital inputs
                                                                        VSS   9               10   RX1BF
  - Low Power Sleep mode
• Low power CMOS technology:
  - Operates from 3.0V to 5.5V                            20 LEAD TSSOP
  - 5 mA active current typical                                    TXCAN      1               20   VDD
  - 10 µA standby current typical at 5.5V                          RXCAN      2               19   RESET
• 18-pin PDIP/SOIC and 20-pin TSSOP packages                      CLKOUT      3               18   CS
                                                                                    MCP2510
                                                                  TX0RTS      4               17   SO
• Temperature ranges supported:                                               5               16
                                                                  TX1RTS                           SI
  - Industrial (I):        -40°C to +85°C                             NC      6               15   NC
  - Extended (E):          -40°C to +125°C                        TX2RTS      7               14   SCK
                                                                    OSC2      8               13   INT
                                                                    OSC1      9               12   RX0BF
                                                                     VSS      10              11   RX1BF
© 2007 Microchip Technology Inc.                                                                   DS21291F-page 1


MCP2510
Table of Contents
1.0          Device Functionality . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 3
2.0          Can Message Frames. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 7
3.0          Message Transmission . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 15
4.0          Message Reception . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 21
5.0          Bit Timing . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 35
6.0          Error Detection . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 41
7.0          Interrupts. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 45
8.0          Oscillator . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 49
9.0          Modes of Operation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 51
10.0         Register Map. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 55
11.0         SPI Interface . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 57
12.0         Electrical Characteristics. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 61
13.0         Packaging Information . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 65
Index . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 69
On-Line Support . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 71
Reader Response . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 72
Product Identification System . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 73
Worldwide Sales and Service . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 76
                                                             TO OUR VALUED CUSTOMERS
  It is our intention to provide our valued customers with the best documentation possible to ensure successful use of your Micro-
  chip products. To this end, we will continue to improve our publications to better suit your needs. Our publications will be refined
  and enhanced as new volumes and updates are introduced.
  If you have any questions or comments regarding this publication, please contact the Marketing Communications Department via
  E-mail at docerrors@microchip.com or fax the Reader Response Form in the back of this data sheet to (480) 792-4150. We
  welcome your feedback.
  Most Current Data Sheet
  To obtain the most up-to-date version of this data sheet, please register at our Worldwide Web site at:
         http://www.microchip.com
  You can determine the version of a data sheet by examining its literature number found on the bottom outside corner of any page.
  The last character of the literature number is the version number, (e.g., DS30000A is version A of document DS30000).
  Errata
  An errata sheet, describing minor operational differences from the data sheet and recommended workarounds, may exist for cur-
  rent devices. As device/documentation issues become known to us, we will publish an errata sheet. The errata will specify the revi-
  sion of silicon and revision of document to which it applies.
  To determine if an errata sheet exists for a particular device, please check with one of the following:
  • Microchip’s Worldwide Web site; http://www.microchip.com
  • Your local Microchip sales office (see last page)
  When contacting a sales office, please specify which device, revision of silicon and data sheet (include literature number) you are
  using.
  Customer Notification System
  Register on our web site at www.microchip.com to receive the most current information on all of our products.
DS21291F-page 2                                                                                                                                         © 2007 Microchip Technology Inc.


                                                                                                        MCP2510
1.0        DEVICE FUNCTIONALITY                                       checked for errors and then matched against the user
                                                                      defined filters to see if it should be moved into one of
1.1        Overview                                                   the two receive buffers.
                                                                      The MCU interfaces to the device via the SPI interface.
The MCP2510 is a stand-alone CAN controller devel-
                                                                      Writing to and reading from all registers is done using
oped to simplify applications that require interfacing
                                                                      standard SPI read and write commands.
with a CAN bus. A simple block diagram of the
MCP2510 is shown in Figure 1-1. The device consists                   Interrupt pins are provided to allow greater system flex-
of three main blocks:                                                 ibility. There is one multi-purpose interrupt pin as well
                                                                      as specific interrupt pins for each of the receive regis-
1.    The CAN protocol engine.
                                                                      ters that can be used to indicate when a valid message
2.    The control logic and SRAM registers that are                   has been received and loaded into one of the receive
      used to configure the device and its operation.                 buffers. Use of the specific interrupt pins is optional,
3.    The SPI protocol block.                                         and the general purpose interrupt pin as well as status
A typical system implementation using the device is                   registers (accessed via the SPI interface) can also be
shown in Figure 1-2.                                                  used to determine when a valid message has been
                                                                      received.
The CAN protocol engine handles all functions for
receiving and transmitting messages on the bus. Mes-                  There are also three pins available to initiate immediate
sages are transmitted by first loading the appropriate                transmission of a message that has been loaded into
message buffer and control registers. Transmission is                 one of the three transmit registers. Use of these pins is
initiated by using control register bits, via the SPI inter-          optional and initiating message transmission can also
face, or by using the transmit enable pins. Status and                be done by utilizing control registers accessed via the
errors can be checked by reading the appropriate reg-                 SPI interface.
isters. Any message detected on the CAN bus is                        Table 1-1 gives a complete list of all of the pins on the
                                                                      MCP2510.
FIGURE 1-1:             BLOCK DIAGRAM
       RXCAN                                                      2 RX Buffers
                    CAN                                                                            SPI         CS
                                               3 TX               6 Acceptance
                  Protocol                                                                      Interface      SCK     SPI
                   Engine                     Buffers                Filters
                                                                                                  Logic        SI       Bus
       TXCAN                                                   Message Assembly
                                                                     Buffer                                    SO
                                                      Control Logic
                                                                                                               INT
                                                                                                               RX0BF
                                                                                                               RX1BF
                                                                                                               TX0RTS
                                                                                                               TX1RTS
                                                                                                               TX2RTS
© 2007 Microchip Technology Inc.                                                                              DS21291F-page 3


MCP2510
FIGURE 1-2:             TYPICAL SYSTEM IMPLEMENTATION
                                                                       Main
                                                                      System
                                                                    Controller
                                                                    MCP2510
                                                                       CAN
                                                                   Transceiver
         CAN
         BUS
                        CAN                             CAN                           CAN                         CAN
                   Transceiver                     Transceiver                    Transceiver                 Transceiver
                    MCP2510                         MCP2510                         MCP2510                     MCP2510
       SPI
    INTERFACE
                        Node                           Node                           Node                        Node
                    Controller                      Controller                      Controller                  Controller
TABLE 1-1:        PIN DESCRIPTIONS
              DIP/
                        TSSOP        I/O/P
    Name     SOIC                                                                   Description
                         Pin #       Type
             Pin #
 TXCAN          1           1          O    Transmit output pin to CAN bus
 RXCAN          2           2           I   Receive input pin from CAN bus
 CLKOUT         3           3          O    Clock output pin with programmable prescaler
 TX0RTS         4           4           I   Transmit buffer TXB0 request to send or general purpose digital input. 100 kΩ
                                            internal pullup to VDD
 TX1RTS         5           5           I   Transmit buffer TXB1 request to send or general purpose digital input. 100 kΩ
                                            internal pullup to VDD
 TX2RTS         6           7           I   Transmit buffer TXB2 request to send or general purpose digital input. 100 kΩ
                                            internal pullup to VDD
 OSC2           7           8          O    Oscillator output
 OSC1           8           9           I   Oscillator input
 VSS            9          10          P    Ground reference for logic and I/O pins
 RX1BF         10          11          O    Receive buffer RXB1 interrupt pin or general purpose digital output
 RX0BF         11          12          O    Receive buffer RXB0 interrupt pin or general purpose digital output
 INT           12          13          O    Interrupt output pin
 SCK           13          14           I   Clock input pin for SPI interface
 SI            14          16           I   Data input pin for SPI interface
 SO            15          17          O    Data output pin for SPI interface
 CS            16          18           I   Chip select input pin for SPI interface
 RESET         17          19           I   Active low device reset input
 VDD           18          20          P    Positive supply for logic and I/O pins
 NC            —          6,15         —    No internal connection
   Note:   Type Identification: I=Input; O=Output; P=Power
DS21291F-page 4                                                                                 © 2007 Microchip Technology Inc.


                                                                                                         MCP2510
1.2      Transmit/Receive Buffers
The MCP2510 has three transmit and two receive buffers, two acceptance masks (one for each receive buffer), and a
total of six acceptance filters. Figure 1-3 is a block diagram of these buffers and their connection to the protocol engine.
FIGURE 1-3:              CAN BUFFERS AND PROTOCOL ENGINE BLOCK DIAGRAM
                                                                                                         Acceptance Mask
   BUFFERS                                                                                                    RXM1
                                                                                                         Acceptance Filter
                                                                                                              RXF2
                                                                             Acceptance Mask             Acceptance Filter         A
       TXB0                  TXB1                   TXB2             A            RXM0                        RXF3                 c
                                                                     c                                                             c
               MESSAGE              MESSAGE                MESSAGE
                                                                     c       Acceptance Filter           Acceptance Filter         e
  TXREQ                  TXREQ                TXREQ                               RXF0                        RXF4                 p
  ABTF                   ABTF                 ABTF                   e
  MLOA                   MLOA                 MLOA                   p                                                             t
  TXERR                  TXERR                TXERR                  t       Acceptance Filter           Acceptance Filter
                                                                                  RXF1                        RXF5
                                                                      R                                                        R
                                                                                                     M
                                                                      X          Identifier              Identifier            X
 Message                                                                                             A
                                                                      B                                                        B
  Queue                                                                                              B
                                                                      0                                                        1
  Control
                          Transmit Byte Sequencer                               Data Field                Data Field
                                                                                                             Receive          REC
                                                                                                              Error
   PROTOCOL                                                                                                  Counter          TEC
   ENGINE                                                                                                    Transmit        ErrPas
                                                                                                               Error         BusOff
                                                                                                             Counter
                                              Transmit<7:0>                Receive<7:0>
                                         Shift<14:0>
                                {Transmit<5:0>, Receive<8:0>}
                                                              Comparator
                                                                                                             Protocol
                                                                                                              Finite
                                                                                                              State
                                                              CRC<14:0>                                      Machine
                                                                                                Bit
                         Transmit
                                                                                              Timing             Clock
                          Logic
                                                                                               Logic            Generator
                           TX                                                                   RX
                                                                                                              Configuration
                                                                                                               Registers
© 2007 Microchip Technology Inc.                                                                                 DS21291F-page 5


MCP2510
1.3       CAN Protocol Engine                                          1.6       Error Management Logic
The CAN protocol engine combines several functional                    The Error Management Logic is responsible for the
blocks, shown in Figure 1-4. These blocks and their                    fault confinement of the CAN device. Its two counters,
functions are described below.                                         the Receive Error Counter (REC) and the Transmit
                                                                       Error Counter (TEC), are incremented and decre-
1.4       Protocol Finite State Machine                                mented by commands from the Bit Stream Processor.
                                                                       According to the values of the error counters, the CAN
The heart of the engine is the Finite State Machine
                                                                       controller is set into the states error-active, error-pas-
(FSM). This state machine sequences through mes-
                                                                       sive or bus-off.
sages on a bit by bit basis, changing states as the fields
of the various frame types are transmitted or received.                1.7       Bit Timing Logic
The FSM is a sequencer controlling the sequential data
stream between the TX/RX Shift Register, the CRC                       The Bit Timing Logic (BTL) monitors the bus line input
Register, and the bus line. The FSM also controls the                  and handles the bus related bit timing according to the
Error Management Logic (EML) and the parallel data                     CAN protocol. The BTL synchronizes on a recessive to
stream between the TX/RX Shift Registers and the                       dominant bus transition at Start of Frame (hard syn-
buffers. The FSM insures that the processes of recep-                  chronization) and on any further recessive to dominant
tion, arbitration, transmission, and error signaling are               bus line transition if the CAN controller itself does not
performed according to the CAN protocol. The auto-                     transmit a dominant bit (resynchronization). The BTL
matic retransmission of messages on the bus line is                    also provides programmable time segments to com-
also handled by the FSM.                                               pensate for the propagation delay time, phase shifts,
                                                                       and to define the position of the Sample Point within the
1.5       Cyclic Redundancy Check                                      bit time. The programming of the BTL depends upon
                                                                       the baud rate and external physical delay times.
The Cyclic Redundancy Check Register generates the
Cyclic Redundancy Check (CRC) code which is trans-
mitted after either the Control Field (for messages with
0 data bytes) or the Data Field, and is used to check the
CRC field of incoming messages.
FIGURE 1-4:              CAN PROTOCOL ENGINE BLOCK DIAGRAM
               RX                                                                                        TX
                                      Bit Timing Logic                                 Transmit Logic
                                              SAM
                                                                                                               REC
                       Sample<2:0>                                                           Receive
                                                                                          Error Counter
                                                                                                               TEC
                                                        StuffReg<5:0>
                                                                                            Transmit           ErrPas
                         Majority                                                         Error Counter
                         Decision                                                                              BusOff
                                  BusMon
                                                         Comparator
                                          CRC<14:0>
                                                                                             Protocol
                                                                                              FSM
                                          Comparator
                                                           Shift<14:0>
                                                   (Transmit<5:0>, Receive<7:0>)
                           Receive<7:0>              Transmit<7:0>
                            RecData<7:0>              TrmData<7:0>
                                   Interface to Standard Buffer                            Rec/Trm Addr.
DS21291F-page 6                                                                                   © 2007 Microchip Technology Inc.


                                                                                                     MCP2510
2.0        CAN MESSAGE FRAMES                                      dard CAN frame will win arbitration due to the assertion
                                                                   of a dominant lDE bit. Also, the SRR bit in an extended
The MCP2510 supports Standard Data Frames,                         CAN frame must be recessive to allow the assertion of
Extended Data Frames, and Remote Frames (Stan-                     a dominant RTR bit by a node that is sending a stan-
dard and Extended) as defined in the CAN 2.0B speci-               dard CAN remote frame.
fication.
                                                                   The SRR and lDE bits are followed by the remaining 18
2.1        Standard Data Frame                                     bits of the identifier (Extended lD) and the remote trans-
                                                                   mission request bit.
The CAN Standard Data Frame is shown in Figure 2-1.                To enable standard and extended frames to be sent
In common with all other frames, the frame begins with             across a shared network, it is necessary to split the 29-
a Start Of Frame (SOF) bit, which is of the dominant               bit extended message identifier into 11-bit (most signif-
state, which allows hard synchronization of all nodes.             icant) and 18-bit (least significant) sections. This split
The SOF is followed by the arbitration field, consisting           ensures that the lDE bit can remain at the same bit
of 12 bits; the 11-bit ldentifier and the Remote Trans-            position in both standard and extended frames.
mission Request (RTR) bit. The RTR bit is used to dis-             Following the arbitration field is the six-bit control field.
tinguish a data frame (RTR bit dominant) from a remote             the first two bits of this field are reserved and must be
frame (RTR bit recessive).                                         dominant. the remaining four bits of the control field are
Following the arbitration field is the control field, con-         the Data Length Code (DLC) which specifies the num-
sisting of six bits. The first bit of this field is the Identifier ber of data bytes contained in the message.
Extension (IDE) bit which must be dominant to specify              The remaining portion of the frame (data field, CRC
a standard frame. The following bit, Reserved Bit Zero             field, acknowledge field, end of frame and lntermission)
(RB0), is reserved and is defined to be a dominant bit             is constructed in the same way as for a standard data
by the can protocol. the remaining four bits of the con-           frame (see Section 2.1).
trol field are the Data Length Code (DLC) which speci-
fies the number of bytes of data contained in the                  2.3        Remote Frame
message.
                                                                   Normally, data transmission is performed on an auton-
After the control field is the data field, which contains
                                                                   omous basis by the data source node (e.g. a sensor
any data bytes that are being sent, and is of the length
                                                                   sending out a data frame). It is possible, however, for a
defined by the DLC above (0-8 bytes).
                                                                   destination node to request data from the source. To
The Cyclic Redundancy Check (CRC) Field follows the                accomplish this, the destination node sends a remote
data field and is used to detect transmission errors. The          frame with an identifier that matches the identifier of the
CRC Field consists of a 15-bit CRC sequence, followed              required data frame. The appropriate data source node
by the recessive CRC Delimiter bit.                                will then send a data frame in response to the remote
The final field is the two-bit acknowledge field. During           frame request.
the ACK Slot bit, the transmitting node sends out a                There are two differences between a remote frame
recessive bit. Any node that has received an error free            (shown in Figure 2-3) and a data frame. First, the RTR
frame acknowledges the correct reception of the frame              bit is at the recessive state, and second, there is no
by sending back a dominant bit (regardless of whether              data field. In the event of a data frame and a remote
the node is configured to accept that specific message             frame with the same identifier being transmitted at the
or not). The recessive acknowledge delimiter com-                  same time, the data frame wins arbitration due to the
pletes the acknowledge field and may not be overwrit-              dominant RTR bit following the identifier. In this way,
ten by a dominant bit.                                             the node that transmitted the remote frame receives
                                                                   the desired data immediately.
2.2        Extended Data Frame
In the Extended CAN Data Frame, the SOF bit is fol-
                                                                   2.4        Error Frame
lowed by the arbitration field which consists of 32 bits,          An Error Frame is generated by any node that detects
as shown in Figure 2-2. The first 11 bits are the most             a bus error. An error frame, shown in Figure 2-4, con-
significant bits (Base-lD) of the 29-bit identifier. These         sists of two fields, an error flag field followed by an error
11 bits are followed by the Substitute Remote Request              delimiter field. There are two types of error flag fields.
(SRR) bit which is defined to be recessive. The SRR bit            Which type of error flag field is sent depends upon the
is followed by the lDE bit which is recessive to denote            error status of the node that detects and generates the
an extended CAN frame.                                             error flag field.
It should be noted that if arbitration remains unresolved          If an error-active node detects a bus error then the
after transmission of the first 11 bits of the identifier, and     node interrupts transmission of the current message by
one of the nodes involved in the arbitration is sending            generating an active error flag. The active error flag is
a standard CAN frame (11-bit identifier), then the stan-           composed of six consecutive dominant bits. This bit
© 2007 Microchip Technology Inc.                                                                                DS21291F-page 7


MCP2510
sequence actively violates the bit stuffing rule. All other 2.5        Overload Frame
stations recognize the resulting bit stuffing error and in
turn generate error frames themselves, called error         An Overload Frame, shown in Figure 2-5, has the
echo flags. The error flag field, therefore, consists of    same format as an active error frame. An overload
between six and twelve consecutive dominant bits            frame, however can only be generated during an lnter-
(generated by one or more nodes). The error delimiter       frame space. In this way an overload frame can be dif-
field completes the error frame. After completion of the    ferentiated from an error frame (an error frame is sent
error frame, bus activity returns to normal and the inter-  during the transmission of a message). The overload
rupted node attempts to resend the aborted message.         frame consists of two fields, an overload flag followed
                                                            by an overload delimiter. The overload flag consists of
If an error-passive node detects a bus error then the       six dominant bits followed by overload flags generated
node transmits an error-passive flag followed by the        by other nodes (and, as for an active error flag, giving
error delimiter field. The error-passive flag consists of   a maximum of twelve dominant bits). The overload
six consecutive recessive bits, and the error frame for     delimiter consists of eight recessive bits. An overload
an error-passive node consists of 14 recessive bits.        frame can be generated by a node as a result of two
From this, it follows that unless the bus error is          conditions. First, the node detects a dominant bit during
detected by the node that is actually transmitting, the     the interframe space which is an illegal condition. Sec-
transmission of an error frame by an error-passive          ond, due to internal conditions the node is not yet able
node will not affect any other node on the network. If      to start reception of the next message. A node may
the transmitting node generates an error-passive flag       generate a maximum of two sequential overload
then this will cause other nodes to generate error          frames to delay the start of the next message.
frames due to the resulting bit stuffing violation. After
transmission of an error frame, an error-passive node       2.6        Interframe Space
must wait for six consecutive recessive bits on the bus
before attempting to rejoin bus communications.             The lnterframe Space separates a preceeding frame
                                                            (of any type) from a subsequent data or remote frame.
The error delimiter consists of eight recessive bits and
                                                            The interframe space is composed of at least three
allows the bus nodes to restart bus communications
                                                            recessive bits called the Intermission. This is provided
cleanly after an error has occurred.
                                                            to allow nodes time for internal processing before the
                                                            start of the next message frame. After the intermission,
                                                            the bus line remains in the recessive state (bus idle)
                                                            until the next transmission starts.
DS21291F-page 8                                                                       © 2007 Microchip Technology Inc.


                                   FIGURE 2-1:                    STANDARD DATA FRAME
© 2007 Microchip Technology Inc.
                                                                                                              Data Frame (number of bits = 44 + 8N)
                                                               12                        6                                8N (0≤N≤8)                    16                         7
                                                         Arbitration Field            Control                             Data Field                  CRC Field
                                        Start of Frame
                                                                                      Field                                                                                      End of
                                                                                            4                                                                     CRC Del        Frame
                                                             11                                                  8                              8      15
                                                                                                                                                                  Ack Slot Bit
                                        ID 10
                                                                             ID0                                                                      CRC
                                                                                                    DLC0
                                                                             RTR
                                                                   ID3                                                                                            ACK Del
                                                                             IDE
                                                                             RB0                                                                                                           IFS
                                                                             DLC3
                                         0                                   0 0 0                                                                                1       1 1 1 1 1 1 1 1 1 1 1
                                                                                Reserved Bit
                                                           Identifier                           Data
                                                                                               Length
                                                           Message                              Code
                                                           Filtering
                                                                                                           Stored in Transmit/Receive Buffers
                                                         Stored in Buffers
                                                                                                                      Bit Stuffing
DS21291F-page 9
                                                                                                                                                                                                  MCP2510


                                   FIGURE 2-2:                       EXTENDED DATA FRAME
© 2007 Microchip Technology Inc.
                                                                                                                               Data Frame (number of bits = 64 + 8N)
                                                                            32                                              6                       8N (0≤N≤8)                16                        7
                                                                                                                         Control                    Data Field              CRC Field
                                     Start of Frame
                                                                       Arbitration Field
                                                                                                                         Field                                                                         End of
                                                          11                               18                                              8                            8    15         CRC Del        Frame
                                                                                                                               4
                                                                                                                                                                             CRC        Ack Slot Bit
                                     ID10
                                                                     ID0                                  EID0
                                                                                                                                   DLC0
                                                                     SRR                                  RTR
                                                               ID3                                                                                                                      ACK Del
                                                                     IDE                                  RB1                                                                                                   IFS
                                                                     EID17                                RB0
                                                                                                          DLC3
                                      0                               11                                  000                                                                           1       11111111111
                                                                                                             Reserved bits
                                                      Identifier                                                             Data
                                                                                    Extended Identifier
                                                                                                                             Length
                                                      Message                                                                Code
                                                      Filtering
                                                                      Stored in Buffers                                            Stored in Transmit/Receive Buffers
                                                                                                          Bit Stuffing
DS21291F-page 10
                                                                                                                                                                                                                      MCP2510


                                   FIGURE 2-3:                REMOTE DATA FRAME
© 2007 Microchip Technology Inc.
                                                                                  32                                            6               16                        7
                                                                            Arbitration Field                                Control          CRC Field
                                           Start of Frame
                                                                                                                             Field                                       End of
                                                                11                               18
                                                                                                                                   4
                                                                                                                                               15         CRC Del        Frame
                                                                                                                                               CRC        Ack Slot Bit
                                           ID10
                                                                           ID0                                  EID0
                                                                                                                                       DLC0
                                                                           SRR                                  RTR
                                                                     ID3                                                                                  ACK Del
                                                                           IDE                                  RB1
                                                                           EID17                                RB0
                                                                                                                DLC3                                                              IFS
                                            0                               11                                  100                                       1       11111111 111
                                                                                                                 Reserved bits
                                                            Identifier                                                           Data
                                                                                          Extended Identifier
                                                                                                                                 Length
                                                            Message                                                              Code
                                                            Filtering
                                           Remote Data Frame with Extended Identifier
DS21291F-page 11
                                                                                                                                                                                        MCP2510


                                   FIGURE 2-4:                    ERROR DATA FRAME
© 2007 Microchip Technology Inc.
                                                                                                 Interrupted Data Frame
                                                                   12                    6                                8N (0≤N≤8)
                                                           Arbitration Field          Control                             Data Field
                                          Start of Frame
                                                                                      Field
                                                                                            4
                                                                 11                                               8                           8
                                         ID 10
                                                                               ID0
                                                                                                       DLC0
                                                                               RTR
                                                                        ID3
                                                                               IDE
                                                                               RB0
                                                                               DLC3
                                          0                                    0 0 0
                                                               Identifier                        Data
                                                                                  Reserved Bit
                                                                                                 Length
                                                               Message                           Code
                                                               Filtering
                                                                                                                                                                    Error Frame
                                                                                                   Bit Stuffing
                                                                                                                                                       6           ≤6                 8
                                                                                                                              Data Frame or                                                   Inter-Frame Space or
                                                                                                                              Remote Frame           Error        Echo            Error
                                                                                                                                                                                              Overload Frame
                                                                                                                                                     Flag         Error           Delimiter
                                                                                                                                                                  Flag
                                                                                                                                                  0 0 0 0 0 0 0           0 0 1 1 1 1 1 1 1 1 0
DS21291F-page 12
                                                                                                                                                                                                                     MCP2510


                                   FIGURE 2-5:                       OVERLOAD FRAME
© 2007 Microchip Technology Inc.
                                                                                      Remote Frame (number of bits = 44)
                                                                  12                 6                      16                                 7
                                                          Arbitration Field       Control                 CRC Field
                                         Start of Frame
                                                                                  Field                                                      End of
                                                                                        4                                     CRC Del        Frame
                                                                11                                         15
                                                                                                                              Ack Slot Bit
                                        ID 10
                                                                              ID0                         CRC
                                                                                            DLC0
                                                                              RTR
                                                                                                                              ACK Del
                                                                              IDE
                                                                              RB0
                                                                              DLC3
                                         0                                    1 0 0                                           1       1 1 1 1 1 1 1 1
                                                                                                                                                                 Overload Frame
                                                                                                                           End of Frame or                                              Inter-Frame Space or
                                                                                                                           Error Delimiter or                6                8         Error Frame
                                                                                                                           Overload Delimiter
                                                                                                                                                         Overload          Overload
                                                                                                                                                         Flag              Delimiter
                                                                                                                                                        0 0 0 0 0 0 0 1 1 1 1 1 1 1 1
DS21291F-page 13
                                                                                                                                                                                                               MCP2510


MCP2510
NOTES:
DS21291F-page 14 © 2007 Microchip Technology Inc.


                                                                                                MCP2510
3.0        MESSAGE TRANSMISSION                               ted. If transmission is initiated via the SPI interface, the
                                                              TXREQ bit can be set at the same time as the TXP pri-
3.1        Transmit Buffers                                   ority bits.
                                                              When         TXBNCTRL.TXREQ              is     set,     the
The MCP2510 implements three Transmit Buffers.
                                                              TXBNCTRL.ABTF,               TXBNCTRL.MLOA              and
Each of these buffers occupies 14 bytes of SRAM and
                                                              TXBNCTRL.TXERR bits will be cleared.
are mapped into the device memory maps. The first
byte, TXBNCTRL, is a control register associated with         Setting the TXBNCTRL.TXREQ bit does not initiate a
the message buffer. The information in this register          message transmission, it merely flags a message
determines the conditions under which the message             buffer as ready for transmission. Transmission will start
will be transmitted and indicates the status of the mes-      when the device detects that the bus is available. The
sage transmission. (see Register 3-2). Five bytes are         device will then begin transmission of the highest prior-
used to hold the standard and extended identifiers and        ity message that is ready.
other message arbitration information (see Register 3-        When the transmission has completed successfully the
3 through Register 3-8). The last eight bytes are for the     TXBNCTRL.TXREQ bit will be cleared, the CAN-
eight possible data bytes of the message to be trans-         INTF.TXNIF bit will be set, and an interrupt will be gen-
mitted (see Register 3-8).                                    erated if the CANINTE.TXNIE bit is set.
For the MCU to have write access to the message               If the message transmission fails, the TXBNC-
buffer, the TXBNCTRL.TXREQ bit must be clear, indi-           TRL.TXREQ will remain set indicating that the mes-
cating that the message buffer is clear of any pending        sage is still pending for transmission and one of the
message to be transmitted. At a minimum, the TXBN-            following condition flags will be set. If the message
SIDH, TXBNSIDL, and TXBNDLC registers must be                 started to transmit but encountered an error condition,
loaded. If data bytes are present in the message, the         the TXBNCTRL. TXERR and the CANINTF.MERRF
TXBNDm registers must also be loaded. If the message          bits will be set and an interrupt will be generated on the
is to use extended identifiers, the TXBNEIDm registers        INT pin if the CANINTE.MERRE bit is set. If the mes-
must also be loaded and the TXBNSIDL.EXIDE bit set.           sage lost arbitration the TXBNCTRL.MLOA bit will be
Prior to sending the message, the MCU must initialize         set.
the CANINTE.TXINE bit to enable or disable the gener-
                                                              3.4         TXnRTS Pins
ation of an interrupt when the message is sent. The
MCU must also initialize the TXBNCTRL.TXP priority            The TXNRTS Pins are input pins that can be configured
bits (see Section 3.2).                                       as request-to-send inputs, which provides a secondary
                                                              means of initiating the transmission of a message from
3.2        Transmit Priority                                  any of the transmit buffers, or as standard digital inputs.
                                                              Configuration and control of these pins is accomplished
Transmit priority is a prioritization, within the MCP2510,
                                                              using the TXRTSCTRL register (see Register 3-2). The
of the pending transmittable messages. This is inde-
                                                              TXRTSCTRL register can only be modified when the
pendent from, and not necessarily related to, any prior-
                                                              MCP2510 is in configuration mode (see Section 9.0). If
itization implicit in the message arbitration scheme built
                                                              configured to operate as a request to send pin, the pin
into the CAN protocol. Prior to sending the SOF, the pri-
                                                              is mapped into the respective TXBNCTRL.TXREQ bit
ority of all buffers that are queued for transmission is
                                                              for the transmit buffer. The TXREQ bit is latched by the
compared. The transmit buffer with the highest priority
                                                              falling edge of the TXNRTS pin. The TXNRTS pins are
will be sent first. For example, if transmit buffer 0 has a
                                                              designed to allow them to be tied directly to the RXNBF
higher priority setting than transmit buffer 1, buffer 0 will
                                                              pins to automatically initiate a message transmission
be sent first. If two buffers have the same priority set-
                                                              when the RXNBF pin goes low. The TXNRTS pins have
ting, the buffer with the highest buffer number will be
                                                              internal pullup resistors of 100 kΩ (nominal).
sent first. For example, if transmit buffer 1 has the same
priority setting as transmit buffer 0, buffer 1 will be sent  3.5         Aborting Transmission
first. There are four levels of transmit priority. If TXBNC-
TRL.TXP<1:0> for a particular message buffer is set to        The MCU can request to abort a message in a specific
11, that buffer has the highest possible priority. If         message buffer by clearing the associated TXBnC-
TXBNCTRL.TXP<1:0> for a particular message buffer             TRL.TXREQ bit. Also, all pending messages can be
is 00, that buffer has the lowest possible priority.          requested to be aborted by setting the CAN-
                                                              CTRL.ABAT bit. If the CANCTRL.ABAT bit is set to
3.3        Initiating Transmission                            abort all pending messages, the user MUST reset this
                                                              bit (typically after the user verifies that all TXREQ bits
To initiate message transmission the TXBNC-                   have been cleared) to continue trasmit messages. The
TRL.TXREQ bit must be set for each buffer to be trans-        CANCTRL.ABTF flag will only be set if the abort was
mitted. This can be done by writing to the register via       requested via the CANCTRL.ABAT bit. Aborting a mes-
the SPI interface or by setting the TXNRTS pin low for        sage by resetting the TXREQ bit does cause the ATBF
the particular transmit buffer(s) that are to be transmit-    bit to be set.
© 2007 Microchip Technology Inc.                                                                        DS21291F-page 15


MCP2510
Only messages that have not already begun to be                              of a message has begun, if an error occurs on the bus
transmitted can be aborted. Once a message has                               or if the message loses arbitration, the message will be
begun transmission, it will not be possible for the user                     retransmitted regardless of a request to abort.
to reset the TXBnCTRL.TXREQ bit. After transmission
FIGURE 3-1:                TRANSMIT MESSAGE FLOWCHART
                                                Start
                                                                  The message transmission
                                                                  sequence begins when the
                                                                  device determines that the
                                                                  TXBnCTRL.TXREQ for any of
                                                                  the transmit registers has been
                                                                  set.
                                  No          Are any
                                       TXBnCTRL.TXREQ
                                              bits = 1
                                                  ?
                                                     Yes
                                                                                      Clearing the TxBnCTRL.TXREQ
                                       Clear:                                         bit while it is set, or setting the
                                       TXBnCTRL.ABTF                                  CANCTRL.ABAT bit before the
                                       TXBnCTRL.MLOA                                  message has started transmission
                                       TXBnCTRL.TXERR                                 will abort the message.
                                                  Is          No                            is
                                        CAN Bus available                                                  No
                                                                                TXBnCTRL.TXREQ=0
                                       to start transmission                       CANCTRL.ABAT=1
                                                  ?                                         ?
                                                     Yes                                      Yes
                               Examine TXBnCTRL.TXP <1:0> to
                               Determine Highest Priority Message
                                        Transmit Message
                                                 Was           No                  Did
                                                                           a message error          Yes            Set
                                      Message Transmitted
                                           Successfully?                         occur?                  TxBnCTRL.TXERR=1
                                             Yes                                No
                                      Set TxBnCTRL.TXREQ=0
                                                                                   Was              Yes
                                                                         Arbitration lost during         TxBnCTRL.MLOA=1
                                  Yes                                       transmission?
                    Generate           CANINTE.TXnIE=1?
                    Interrupt
                                                                                No
                                                     No
                                                 Set
                                        CANTINF.TXnIF=1
       The CANINTE.TXnIE bit
       determines if an interrupt
       should be generated when
       a message is successfully
       transmitted.
                                          GOTO START
DS21291F-page 16                                                                                              © 2007 Microchip Technology Inc.


                                                                                               MCP2510
REGISTER 3-1:          TXBNCTRL Transmit Buffer N Control Register
                       (ADDRESS: 30h, 40h, 50h)
                            U-0         R-0          R-0           R-0    R/W-0           U-0      R/W-0        R/W-0
                             —         ABTF         MLOA         TXERR   TXREQ            —        TXP1         TXP0
                        bit 7                                                                                      bit 0
          bit 7         Unimplemented: Read as '0'
          bit 6         ABTF: Message Aborted Flag
                        1 = Message was aborted
                        0 = Message completed transmission successfully
          bit 5         MLOA: Message Lost Arbitration
                        1 = Message lost arbitration while being sent
                        0 = Message did not lose arbitration while being sent
          bit 4         TXERR: Transmission Error Detected
                        1 = A bus error occurred while the message was being transmitted
                        0 = No bus error occurred while the message was being transmitted
          bit 3         TXREQ: Message Transmit Request
                        1 = Buffer is currently pending transmission
                             (MCU sets this bit to request message be transmitted - bit is automatically cleared when
                             the message is sent)
                        0 = Buffer is not currently pending transmission
                             (MCU can clear this bit to request a message abort)
          bit 2         Unimplemented: Read as '0'
          bit 1-0       TXP<1:0>: Transmit Buffer Priority
                        11 = Highest Message Priority
                        10 = High Intermediate Message Priority
                        11 = Low Intermediate Message Priority
                        00 = Lowest Message Priority
                        Legend:
                        R = Readable bit              W = Writable bit    U = Unimplemented bit, read as ‘0’
                        -n = Value at POR             ’1’ = Bit is set    ’0’ = Bit is cleared   x = Bit is unknown
© 2007 Microchip Technology Inc.                                                                       DS21291F-page 17


MCP2510
REGISTER 3-2:    TXRTSCTRL - TXNRTS PIN CONTROL AND STATUS REGISTER
                 (ADDRESS: 0Dh)
                      U-0         U-0         R-x           R-x     R-x           R/W-0        R/W-0        R/W-0
                        —         —        B2RTS         B1RTS     B0RTS        B2RTSM        B1RTSM B0RTSM
                  bit 7                                                                                        bit 0
         bit 7    Unimplemented: Read as '0'
         bit 6    Unimplemented: Read as '0'
         bit 5    B2RTS: TX2RTS Pin State
                  - Reads state of TX2RTS pin when in digital input mode
                  - Reads as ‘0’ when pin is in ‘request to send’ mode
         bit 4    B1RTS: TX1RTX Pin State
                  - Reads state of TX1RTS pin when in digital input mode
                  - Reads as ‘0’ when pin is in ‘request to send’ mode
         bit 3    B0RTS: TX0RTS Pin State
                  - Reads state of TX0RTS pin when in digital input mode
                  - Reads as ‘0’ when pin is in ‘request to send’ mode
         bit 2    B2RTSM: TX2RTS Pin Mode
                  1 = Pin is used to request message transmission of TXB2 buffer (on falling edge)
                  0 = Digital input
         bit 1    B1RTSM: TX1RTS Pin Mode
                  1 = Pin is used to request message transmission of TXB1 buffer (on falling edge)
                  0 = Digital input
         bit 0    B0RTSM: TX0RTS Pin Mode
                  1 = Pin is used to request message transmission of TXB0 buffer (on falling edge)
                  0 = Digital input
                  Legend:
                  R = Readable bit             W = Writable bit     U = Unimplemented bit, read as ‘0’
                  -n = Value at POR            ’1’ = Bit is set     ’0’ = Bit is cleared     x = Bit is unknown
REGISTER 3-3:    TXBNSIDH - TRANSMIT BUFFER N STANDARD IDENTIFIER HIGH
                 (ADDRESS: 31h, 41h, 51h)
                     R/W-x      R/W-x       R/W-x          R/W-x    R/W-x         R/W-x       R/W-x        R/W-x
                    SID10        SID9        SID8          SID7      SID6          SID5        SID4         SID3
                  bit 7                                                                                        bit 0
         bit 7-0  SID<10:3>: Standard Identifier Bits <10:3>
                  Legend:
                  R = Readable bit             W = Writable bit     U = Unimplemented bit, read as ‘0’
                  -n = Value at POR            ’1’ = Bit is set     ’0’ = Bit is cleared     x = Bit is unknown
DS21291F-page 18                                                                     © 2007 Microchip Technology Inc.


                                                                                           MCP2510
REGISTER 3-4:          TXBNSIDL - Transmit Buffer N Standard Identifier Low
                       (ADDRESS: 32h, 42h, 52h)
                           R/W-x      R/W-x      R/W-x          R/W-x R/W-x         R/W-x   R/W-x        R/W-x
                           SID2        SID1      SID0             —   EXIDE           —     EID17        EID16
                        bit 7                                                                                bit 0
          bit 7-5       SID<2:0>: Standard Identifier Bits <2:0>
          bit 4         Unimplemented: Reads as '0’
          bit 3         EXIDE: Extended Identifier Enable
                        1 = Message will transmit extended identifier
                        0 = Message will transmit standard identifier
          bit 2         Unimplemented: Reads as '0’
          bit 1-0       EID<17:16>: Extended Identifier Bits <17:16>
                        Legend:
                        R = Readable bit            W = Writable bit  U = Unimplemented bit, read as ‘0’
                        -n = Value at POR           ’1’ = Bit is set  ’0’ = Bit is cleared x = Bit is unknown
REGISTER 3-5:          TXBNEID8 - TRANSMIT BUFFER N EXTENDED IDENTIFIER HIGH
                       (ADDRESS: 33h, 43h, 53h)
                           R/W-x      R/W-x      R/W-x          R/W-x R/W-x         R/W-x   R/W-x        R/W-x
                          EID15       EID14      EID13          EID12 EID11         EID10    EID9         EID8
                        bit 7                                                                                bit 0
          bit 7-0       EID<15:8>: Extended Identifier Bits <15:8>
                        Legend:
                        R = Readable bit            W = Writable bit  U = Unimplemented bit, read as ‘0’
                        -n = Value at POR           ’1’ = Bit is set  ’0’ = Bit is cleared x = Bit is unknown
REGISTER 3-6:          TXBNEID0 - TRANSMIT BUFFER N EXTENDED IDENTIFIER LOW
                       (ADDRESS: 34h, 44h, 54h)
                           R/W-x      R/W-x      R/W-x          R/W-x R/W-x         R/W-x   R/W-x        R/W-x
                           EID7        EID6      EID5           EID4   EID3          EID2    EID1         EID0
                        bit 7                                                                                bit 0
          bit 7-0       EID<7:0>: Extended Identifier Bits <7:0>
                        Legend:
                        R = Readable bit            W = Writable bit  U = Unimplemented bit, read as ‘0’
                        -n = Value at POR           ’1’ = Bit is set  ’0’ = Bit is cleared x = Bit is unknown
© 2007 Microchip Technology Inc.                                                                DS21291F-page 19


MCP2510
REGISTER 3-7:    TXBNDLC - Transmit Buffer N Data Length Code
                 (ADDRESS: 35h, 45h, 55h)
                     R/W-x        R/W-x        R/W-x          R/W-x    R/W-x         R/W-x       R/W-x        R/W-x
                       —           RTR           —              —      DLC3           DLC2        DLC1         DLC0
                  bit 7                                                                                           bit 0
         bit 7    Unimplemented: Reads as '0’
         bit 6    RTR: Remote Transmission Request Bit
                  1 = Transmitted Message will be a Remote Transmit Request
                  0 = Transmitted Message will be a Data Frame
         bit 5-4  Unimplemented: Reads as '0’
         bit 3-0  DLC<3:0>: Data Length Code
                  Sets the number of data bytes to be transmitted (0 to 8 bytes)
                  Note:    It is possible to set the DLC to a value greater than 8, however only 8 bytes are trans-
                           mitted
                  Legend:
                  R = Readable bit                W = Writable bit     U = Unimplemented bit, read as ‘0’
                  -n = Value at POR               ’1’ = Bit is set     ’0’ = Bit is cleared     x = Bit is unknown
REGISTER 3-8:    TXBNDM - Transmit Buffer N Data Field Byte m
                 (ADDRESS: 36h-3Dh, 46h-4Dh, 56h-5Dh)
                     R/W-x        R/W-x        R/W-x          R/W-x    R/W-x         R/W-x       R/W-x        R/W-x
                  TXBNDm         TXBNDm      TXBNDm         TXBNDm   TXBNDm         TXBNDm      TXBNDm       TXBNDm
                        7           6             5             4         3             2           1           0
                  bit 7                                                                                           bit 0
         bit 7-0  TXBNDM7:TXBNDM0: Transmit Buffer N Data Field Byte m
                  Legend:
                  R = Readable bit                W = Writable bit     U = Unimplemented bit, read as ‘0’
                  -n = Value at POR               ’1’ = Bit is set     ’0’ = Bit is cleared     x = Bit is unknown
DS21291F-page 20                                                                        © 2007 Microchip Technology Inc.


                                                                                             MCP2510
4.0        MESSAGE RECEPTION                                When a message is received, bits <3:0> of the RXBNC-
                                                            TRL Register will indicate the acceptance filter number
4.1        Receive Message Buffering                        that enabled reception, and whether the received mes-
                                                            sage is a remote transfer request.
The MCP2510 includes two full receive buffers with
                                                            The RXBNCTRL.RXM bits set special receive modes.
multiple acceptance filters for each. There is also a
                                                            Normally, these bits are set to 00 to enable reception of
separate Message Assembly Buffer (MAB) which acts
                                                            all valid messages as determined by the appropriate
as a third receive buffer (see Figure 4-1).
                                                            acceptance filters. In this case, the determination of
4.2        Receive Buffers                                  whether or not to receive standard or extended mes-
                                                            sages is determined by the RFXNSIDL.EXIDE bit in the
Of the three Receive Buffers, the MAB is always com-        acceptance filter register. If the RXBNCTRL.RXM bits
mitted to receiving the next message from the bus. The      are set to 01 or 10, the receiver will accept only mes-
remaining two receive buffers are called RXB0 and           sages with standard or extended identifiers respec-
RXB1 and can receive a complete message from the            tively. If an acceptance filter has the RFXNSIDL.EXIDE
protocol engine. The MCU can access one buffer while        bit set such that it does not correspond with the
the other buffer is available for message reception or      RXBNCTRL.RXM mode, that acceptance filter is ren-
holding a previously received message.                      dered useless. These two modes of RXBNCTRL.RXM
The MAB assembles all messages received. These              bits can be used in systems where it is known that only
messages will be transferred to the RXBN buffers (See       standard or extended messages will be on the bus. If
Register 4-4 to Register 4-9) only if the acceptance fil-   the RXBNCTRL.RXM bits are set to 11, the buffer will
ter criteria are met.                                       receive all messages regardless of the values of the
                                                            acceptance filters. Also, if a message has an error
    Note:     The entire contents of the MAB is moved       before the end of frame, that portion of the message
              into the receive buffer once a message is     assembled in the MAB before the error frame will be
              accepted. This means that regardless of       loaded into the buffer. This mode has some value in
              the type of identifier (standard or extended) debugging a CAN system and would not be used in an
              and the number of data bytes received, the    actual system environment.
              entire receive buffer is overwritten with the
              MAB contents. Therefore the contents of       4.4         RX0BF and RX1BF Pins
              all registers in the buffer must be assumed   In addition to the INT pin which provides an interrupt
              to have been modified when any message        signal to the MCU for many different conditions, the
              is received.                                  receive buffer full pins (RX0BF and RX1BF) can be
When a message is moved into either of the receive          used to indicate that a valid message has been loaded
buffers the appropriate CANINTF.RXNIF bit is set. This      into RXB0 or RXB1, respectively.
bit must be cleared by the MCU, when it has completed       The RXBNBF full pins can be configured to act as buffer
processing the message in the buffer, in order to allow     full interrupt pins or as standard digital outputs. Config-
a new message to be received into the buffer. This bit      uration and status of these pins is available via the
provides a positive lockout to ensure that the MCU has      BFPCTRL register (Register 4-3). When set to operate
finished with the message before the MCP2510                in interrupt mode (by setting BFPCTRL.BxBFE and
attempts to load a new message into the receive buffer.     BFPCTRL.BxBFM bits to a 1), these pins are active low
If the CANINTE.RXNIE bit is set an interrupt will be gen-   and are mapped to the CANINTF.RXNIF bit for each
erated on the INT pin to indicate that a valid message      receive buffer. When this bit goes high for one of the
has been received.                                          receive buffers, indicating that a valid message has
                                                            been loaded into the buffer, the corresponding RXNBF
4.3        Receive Priority                                 pin will go low. When the CANINTF.RXNIF bit is cleared
RXB0 is the higher priority buffer and has two message      by the MCU, then the corresponding interrupt pin will
acceptance filters associated with it. RXB1 is the lower    go to the logic high state until the next message is
priority buffer and has four acceptance filters associ-     loaded into the receive buffer.
ated with it. The lower number of acceptance filters        When used as digital outputs, the BFPCTRL.BxBFM
makes the match on RXB0 more restrictive and implies        bits must be cleared to a ‘0’ and BFPCTRL.BxBFE bits
a higher priority for that buffer. Additionally, the        must be set to a ‘1’ for the associated buffer. In this
RXB0CTRL register can be configured such that if            mode the state of the pin is controlled by the BFPC-
RXB0 contains a valid message, and another valid            TRL.BxBFS bits. Writting a ‘1’ to the BxBFS bit will
message is received, an overflow error will not occur       cause a high level to be driven on the assicated buffer
and the new message will be moved into RXB1 regard-         full pin, and a ‘0’ will cause the pin to drive low. When
less of the acceptance criteria of RXB1. There are also     using the pins in this mode the state of the pin should
two programmable acceptance filter masks available,         be modified only by using the Bit Modify SPI command
one for each receive buffer (see Section 4.5).              to prevent glitches from occuring on either of the buffer
                                                            full pins.
© 2007 Microchip Technology Inc.                                                                    DS21291F-page 21


MCP2510
FIGURE 4-1:          RECEIVE BUFFER BLOCK DIAGRAM
                                                Acceptance Mask
                                                      RXM1
                                                 Acceptance Filter
                                                      RXF2
                          Acceptance Mask        Acceptance Filter
                               RXM0                   RXF3
                                                                              A
                                                                              c
                          Acceptance Filter      Acceptance Filter            c
                               RXF0                   RXF4                    e
                 A                                                            p
                 c                                                            t
                 c        Acceptance Filter      Acceptance Filter
                 e             RXF1                   RXF5
                 p
                 t
                   R                                                        R
                              Identifier    M        Identifier
                   X                                                        X
                                            A
                   B                                                        B
                                            B
                   0                                                        1
                              Data Field             Data Field
DS21291F-page 22                                                   © 2007 Microchip Technology Inc.


                                                                                                                                  MCP2510
FIGURE 4-2:              MESSAGE RECEPTION FLOWCHART
                                                                                      Start
                                                                                     Detect
                                                                      No            Start of
                                                                                  Message
                                                                                        ?
                                                                                         Yes
                                                                      Begin Loading Message into
                                                                   Message Assembly Buffer (MAB)
                                                 Generate                             Valid
                                                                       No         Message
                                                    Error
                                                   Frame                          Received
                                                                                        ?
                                                                                         Yes
                                                     Yes, meets criteria           Message         Yes, meets criteria
                                                          for RXBO             Identifier meets        for RXB1
                                                                                a filter criteria
                                                                                        ?
                                                                                          No
                                                                                 Go to Start
                              The CANINTF.RXnIF bit
                              determines if the receive
                              register is empty and able
                              to accept a new message
                                                              The RXB0CTRL.BUKT
                                                              bit determines if RXB0
                                                              can roll over into RXB1
                                                              if it is full
                          Is              No               Is                 Yes
                 CANINTF.RX0IF=0                 RXB0CTRL.BUKT=1
                          ?                                ?
                       Yes                                    No
                                                                                                                                     Is
              Move message into RXB0           Generate Overflow Error:                   Generate Overflow Error: No
                                                                                                                            CANINTF.RX1IF = 0
                                                 Set EFLG.RX0OVR                              Set EFLG.RX1OVR
                                                                                                                                     ?
                Set CANINTF.RX0IF=1                                                                                              Yes
                                                                                                                         Move message into RXB1
                                                                                   Is             No
             Set RXB0CTRL.FILHIT <0>                                    CANINTE.ERRIE=1
            according to which filter criteria                                      ?
                                                                                                                           Set CANINTF.RX1IF=1
                                                                               Yes
                                                                                                  Go to Start           Set RXB0CTRL.FILHIT <2:0>
                                                                                                                       according to which filter criteria
                                                                                                                                  was met
                                          Yes                                  Generate                              Yes
                 CANINTE.RX0IE=1?                                                                                           CANINTE.RX1IE=1?
                                                                           Interrupt on INT
                             No                      RXB0        Set CANSTAT <3:0> accord-               RXB1                             No
                                                                 ing to which receive buffer
                                                                 the message was loaded into                                        ARE
                         ARE                                                                                            Yes
                                         Yes                                                                                 BFPCTRL.B1BFM=1
                  BFPCTRL.B0BFM=1                                                                        Set RXBF1
                                                Set RXBF0                                                                           AND
                         AND                                                                                Pin = 0
                                                  Pin = 0                                                                    BF1CTRL.B1BFE=1
                  BF1CTRL.B0BFE=1
                                                                                                                                     ?
                           ?
                                 No                                                                                                       No
© 2007 Microchip Technology Inc.                                                                                                           DS21291F-page 23


MCP2510
REGISTER 4-1:    RXB0CTRL - RECEIVE BUFFER 0 CONTROL REGISTER
                 (ADDRESS: 60h)
                      U-0          R/W-0        R/W-0          U-0     R-0          R/W-0          R-0            R-0
                       —           RXM1         RXM0            —    RXRTR           BUKT        BUKT1          FILHIT0
                  bit 7                                                                                             bit 0
         bit 7    Unimplemented: Read as '0'
         bit 6-5  RXM<1:0>: Receive Buffer Operating Mode
                  11 =Turn mask/filters off; receive any message
                  10 =Receive only valid messages with extended identifiers that meet filter criteria
                  01 =Receive only valid messages with standard identifiers that meet filter criteria
                  00 =Receive all valid messages using either standard or extended identifiers that meet filter
                        criteria
         bit 4    Unimplemented: Read as '0'
         bit 3    RXRTR: Received Remote Transfer Request
                  1 = Remote Transfer Request Received
                  0 = No Remote Transfer Request Received
         bit 2    BUKT: Rollover Enable
                  1 = RXB0 message will rollover and be written to RXB1 if RXB0 is full
                  0 = Rollover disabled
         bit 1    BUKT1: Read Only Copy of BUKT Bit (used internally by the MCP2510).
         bit 0    FILHIT<0>: Filter Hit - indicates which acceptance filter enabled reception of message
                  1 = Acceptance Filter 1 (RXF1)
                  0 = Acceptance Filter 0 (RXF0)
                  Note:     If a rollover from RXB0 to RXB1 occurs, the FILHIT bit will reflect the filter that accepted
                            the message that rolled over
                  Legend:
                  R = Readable bit                W = Writable bit    U = Unimplemented bit, read as ‘0’
                  -n = Value at POR               ’1’ = Bit is set    ’0’ = Bit is cleared      x = Bit is unknown
DS21291F-page 24                                                                       © 2007 Microchip Technology Inc.


                                                                                               MCP2510
REGISTER 4-2:          RXB1CTRL - RECEIVE BUFFER 1 CONTROL REGISTER
                       (ADDRESS: 70h)
                            U-0        R/W-0       R/W-0           U-0     R-0            R-0       R-0          R-0
                             —         RXM1        RXM0             —    RXRTR         FILHIT2    FILHIT1      FILHIT0
                        bit 7                                                                                      bit 0
          bit 7         Unimplemented: Read as '0'
          bit 6-5       RXM<1:0>: Receive Buffer Operating Mode
                        11 =Turn mask/filters off; receive any message
                        10 =Receive only valid messages with extended identifiers that meet filter criteria
                        01 =Receive only valid messages with standard identifiers that meet filter criteria
                        00 =Receive all valid messages using either standard or extended identifiers that meet filter
                              criteria
          bit 4         Unimplemented: Read as '0'
          bit 3         RXRTR: Received Remote Transfer Request
                        1 = Remote Transfer Request Received
                        0 = No Remote Transfer Request Received
          bit 2-0       FILHIT<2:0>: Filter Hit - indicates which acceptance filter enabled reception of message
                        101 = Acceptance Filter 5 (RXF5)
                        100 = Acceptance Filter 4 (RXF4)
                        011 = Acceptance Filter 3 (RXF3)
                        010 = Acceptance Filter 2 (RXF2)
                        001 = Acceptance Filter 1 (RXF1) (Only if BUKT bit set in RXB0CTRL)
                        000 = Acceptance Filter 0 (RXF0) (Only if BUKT bit set in RXB0CTRL)
                        Legend:
                        R = Readable bit              W = Writable bit    U = Unimplemented bit, read as ‘0’
                        -n = Value at POR             ’1’ = Bit is set    ’0’ = Bit is cleared   x = Bit is unknown
© 2007 Microchip Technology Inc.                                                                      DS21291F-page 25


MCP2510
REGISTER 4-3:    BFPCTRL - RXNBF PIN CONTROL AND STATUS REGISTER
                 (ADDRESS: 0Ch)
                      U-0        U-0        R/W-0          R/W-0       R/W-0         R/W-0       R/W-0        R/W-0
                       —          —         B1BFS         B0BFS       B1BFE          B0BFE       B1BFM        B0BFM
                  bit 7                                                                                           bit 0
         bit 7    Unimplemented: Read as '0'
         bit 6    Unimplemented: Read as '0'
         bit 5    B1BFS: RX1BF Pin State (digital output mode only)
                  - Reads as ‘0’ when RX1BF is configured as interrupt pin
         bit 4    B0BFS: RX0BF Pin State (digital output mode only)
                  - Reads as ‘0’ when RX0BF is configured as interrupt pin
         bit 3    B1BFE: RX1BF Pin Function Enable
                  1 = Pin function enabled, operation mode determined by B1BFM bit
                  0 = Pin function disabled, pin goes to high impedance state
         bit 2    B0BFE: RX0BF Pin Function Enable
                  1 = Pin function enabled, operation mode determined by B0BFM bit
                  0 = Pin Function disabled, pin goes to high impedance state
         bit 1    B1BFM: RX1BF Pin Operation Mode
                  1 = Pin is used as interrupt when valid message loaded into RXB1
                  0 = Digital output mode
         bit 0    B0BFM: RX0BF Pin Operation Mode
                  1 = Pin is used as interrupt when valid message loaded into RXB0
                  0 = Digital output mode
                  Legend:
                  R = Readable bit             W = Writable bit        U = Unimplemented bit, read as ‘0’
                  -n = Value at POR            ’1’ = Bit is set        ’0’ = Bit is cleared     x = Bit is unknown
REGISTER 4-4:    RXBNSIDH - RECEIVE BUFFER N STANDARD IDENTIFIER HIGH
                 (ADDRESS: 61h, 71h)
                      R-x         R-x         R-x           R-x          R-x           R-x         R-x          R-x
                    SID10        SID9        SID8          SID7         SID6          SID5        SID4         SID3
                  bit 7                                                                                           bit 0
         bit 7-0  SID<10:3>: Standard Identifier Bits <10:3>
                  These bits contain the eight most significant bits of the Standard Identifier for the received mes-
                  sage
                  Legend:
                  R = Readable bit             W = Writable bit        U = Unimplemented bit, read as ‘0’
                  -n = Value at POR            ’1’ = Bit is set        ’0’ = Bit is cleared     x = Bit is unknown
DS21291F-page 26                                                                        © 2007 Microchip Technology Inc.


                                                                                                   MCP2510
REGISTER 4-5:          RXBNSIDL - RECEIVE BUFFER N STANDARD IDENTIFIER LOW
                       (ADDRESS: 62h, 72h)
                            R-x          R-x        R-x           R-x           R-x           U-0        R-x          R-x
                           SID2         SID1       SID0           SRR           IDE           —         EID17        EID16
                        bit 7                                                                                           bit 0
          bit 7-5       SID<2:0>: Standard Identifier Bits <2:0>
                        These bits contain the three least significant bits of the Standard Identifier for the received mes-
                        sage
          bit 4         SRR: Standard Frame Remote Transmit Request Bit (valid only if IDE bit = ‘0’)
                        1 = Standard Frame Remote Transmit Request Received
                        0 = Standard Data Frame Received
          bit 3         IDE: Extended Identifier Flag
                        This bit indicates whether the received message was a Standard or an Extended Frame
                        1 = Received message was an Extended Frame
                        0 = Received message was a Standard Frame
          bit 2         Unimplemented: Reads as '0'
          bit 1-0       EID<17:16>: Extended Identifier Bits <17:16>
                        These bits contain the two most significant bits of the Extended Identifier for the received mes-
                        sage
                        Legend:
                        R = Readable bit             W = Writable bit         U = Unimplemented bit, read as ‘0’
                        -n = Value at POR            ’1’ = Bit is set         ’0’ = Bit is cleared    x = Bit is unknown
REGISTER 4-6:          RXBNEID8 - RECEIVE BUFFER N EXTENDED IDENTIFIER MID
                       (ADDRESS: 63h, 73h)
                            R-x          R-x        R-x           R-x           R-x           R-x        R-x          R-x
                          EID15        EID14       EID13         EID12        EID11         EID10       EID9         EID8
                        bit 7                                                                                           bit 0
          bit 7-0       EID<15:8>: Extended Identifier Bits <15:8>
                        These bits hold bits 15 through 8 of the Extended Identifier for the received message
                        Legend:
                        R = Readable bit             W = Writable bit         U = Unimplemented bit, read as ‘0’
                        -n = Value at POR            ’1’ = Bit is set         ’0’ = Bit is cleared    x = Bit is unknown
© 2007 Microchip Technology Inc.                                                                            DS21291F-page 27


MCP2510
REGISTER 4-7:    RXBNEID0 - RECEIVE BUFFER N EXTENDED IDENTIFIER LOW
                 (ADDRESS: 64h, 74h)
                      R-x         R-x         R-x           R-x           R-x           R-x         R-x          R-x
                     EID7        EID6        EID5          EID4          EID3          EID2        EID1         EID0
                  bit 7                                                                                            bit 0
         bit 7-0  EID<7:0>: Extended Identifier Bits <7:0>
                  These bits hold the least significant eight bits of the Extended Identifier for the received mes-
                  sage
                  Legend:
                  R = Readable bit             W = Writable bit         U = Unimplemented bit, read as ‘0’
                  -n = Value at POR            ’1’ = Bit is set         ’0’ = Bit is cleared     x = Bit is unknown
REGISTER 4-8:    RXBNDLC - RECEIVE BUFFER N DATA LENGTH CODE
                 (ADDRESS: 65h, 75h)
                      U-0         R-x         R-x           R-x           R-x           R-x         R-x          R-x
                       —         RTR          RB1           RB0         DLC3           DLC2        DLC1         DLC0
                  bit 7                                                                                            bit 0
         bit 7    Unimplemented: Reads as '0'
         bit 6    RTR: Extended Frame Remote Transmission Request Bit (valid only when RXBnSIDL.IDE = 1)
                  1 = Extended Frame Remote Transmit Request Received
                  0 = Extended Data Frame Received
         bit 5    RB1: Reserved Bit 1
         bit 4    RB0: Reserved Bit 0
         bit 3-0  DLC<3:0>: Data Length Code
                  Indicates number of data bytes that were received
                  Legend:
                  R = Readable bit             W = Writable bit         U = Unimplemented bit, read as ‘0’
                  -n = Value at POR            ’1’ = Bit is set         ’0’ = Bit is cleared     x = Bit is unknown
REGISTER 4-9:    RXBNDM - RECEIVE BUFFER N DATA FIELD BYTE M
                 (ADDRESS: 66h-6Dh, 76h-7Dh)
                      R-x         R-x         R-x           R-x           R-x           R-x         R-x          R-x
                  RBNDm7      RBNDm6       RBNDm5        RBNDm4       RBNDm3         RBNDm2      RBNDm1       RBNDm0
                  bit 7                                                                                            bit 0
         bit 7-0  RBNDm7:RBNDm0: Receive Buffer N Data Field Byte m
                  Eight bytes containing the data bytes for the received message
                  Legend:
                  R = Readable bit             W = Writable bit         U = Unimplemented bit, read as ‘0’
                  -n = Value at POR            ’1’ = Bit is set         ’0’ = Bit is cleared     x = Bit is unknown
DS21291F-page 28                                                                         © 2007 Microchip Technology Inc.


                                                                                                MCP2510
4.5        Message Acceptance Filters and                         Note:     000 and 001 can only occur if the BUKT bit
           Masks                                                            (see Table 4-1) is set in the RXB0CTRL
                                                                            register allowing RXB0 messages to roll
The Message Acceptance Filters And Masks are used
                                                                            over into RXB1.
to determine if a message in the message assembly
buffer should be loaded into either of the receive buff-      RXB0CTRL contains two copies of the BUKT bit and
ers (see Figure 4-3). Once a valid message has been           the FILHIT<0> bit.
received into the MAB, the identifier fields of the mes-      The coding of the BUKT bit enables these three bits to
sage are compared to the filter values. If there is a         be used similarly to the RXB1CTRL.FILHIT bits and to
match, that message will be loaded into the appropriate       distinguish a hit on filter RXF0 and RXF1 in either
receive buffer. The filter masks (see Register 4-10           RXB0 or after a roll over into RXB1.
through Register 4-17) are used to determine which                - 111 = Acceptance Filter 1 (RXF1)
bits in the identifier are examined with the filters. A truth
                                                                  - 110 = Acceptance Filter 0 (RXF0)
table is shown below in Table 4-1 that indicates how
each bit in the identifier is compared to the masks and           - 001 = Acceptance Filter 1 (RXF1)
filters to determine if a the message should be loaded            - 000 = Acceptance Filter 0
into a receive buffer. The mask essentially determines        If the BUKT bit is clear, there are six codes correspond-
which bits to apply the acceptance filters to. If any mask    ing to the six filters. If the BUKT bit is set, there are six
bit is set to a zero, then that bit will automatically be     codes corresponding to the six filters plus two addi-
accepted regardless of the filter bit.                        tional codes corresponding to RXF0 and RXF1 filters
                                                              that roll over into RXB1.
TABLE 4-1:            FILTER/MASK TRUTH TABLE
                                                              If more than one acceptance filter matches, the FILHIT
                                Message                       bits will encode the binary value of the lowest num-
   Mask Bit     Filter Bit                     Accept or      bered filter that matched. In other words, if filter RXF2
                              Identifier bit
       n              n                       reject bit n    and filter RXF4 match, FILHIT will be loaded with the
                                 n001
                                                              value for RXF2. This essentially prioritizes the accep-
       0              X             X            Accept
                                                              tance filters with a lower number filter having higher pri-
       1              0             0            Accept       ority. Messages are compared to filters in ascending
                                                              order of filter number.
       1              0             1             Reject
                                                              The mask and filter registers can only be modified
       1              1             0             Reject
                                                              when the MCP2510 is in configuration mode (see
       1              1             1            Accept       Section 9.0).
    Note:     X = don’t care
As shown in the Receive Buffers Block Diagram
(Figure 4-1), acceptance filters RXF0 and RXF1, and
filter mask RXM0 are associated with RXB0. Filters
RXF2, RXF3, RXF4, and RXF5 and mask RXM1 are
associated with RXB1. When a filter matches and a
message is loaded into the receive buffer, the filter
number that enabled the message reception is loaded
into the RXBNCTRL register FILHIT bit(s). For RXB1
the RXB1CTRL register contains the FILHIT<2:0> bits.
They are coded as follows:
    - 101 = Acceptance Filter 5 (RXF5)
    - 100 = Acceptance Filter 4 (RXF4)
    - 011 = Acceptance Filter 3 (RXF3)
    - 010 = Acceptance Filter 2 (RXF2)
    - 001 = Acceptance Filter 1 (RXF1)
    - 000 = Acceptance Filter 0 (RXF0)
© 2007 Microchip Technology Inc.                                                                        DS21291F-page 29


MCP2510
FIGURE 4-3:          MESSAGE ACCEPTANCE MASK AND FILTER OPERATION
                 Acceptance Filter Register                   Acceptance Mask Register
       RXFn0                                         RXMn0
                                                                   RXMn1                                      RxRqst
                   RXFn1
                                  RXFnn                                       RXMnn
                 Message Assembly Buffer
                          Identifier
REGISTER 4-10:        RXFNSIDH - ACCEPTANCE FILTER N STANDARD IDENTIFIER HIGH
                     (ADDRESS: 00h, 04h, 08h, 10h, 14h, 18h)
                         R/W-x       R/W-x        R/W-x          R/W-x       R/W-x         R/W-x       R/W-x        R/W-x
                        SID10        SID9          SID8          SID7         SID6          SID5        SID4         SID3
                      bit 7                                                                                             bit 0
         bit 7-0      SID<10:3>: Standard Identifier Filter Bits <10:3>
                      These bits hold the filter bits to be applied to bits <10:3> of the Standard Identifier portion of a
                      received message
                      Legend:
                      R = Readable bit               W = Writable bit        U = Unimplemented bit, read as ‘0’
                      -n = Value at POR              ’1’ = Bit is set        ’0’ = Bit is cleared     x = Bit is unknown
DS21291F-page 30                                                                              © 2007 Microchip Technology Inc.


                                                                                                    MCP2510
REGISTER 4-11:         RXFNSIDL - ACCEPTANCE FILTER N STANDARD IDENTIFIER LOW
                       (ADDRESS: 01h, 05h, 09h, 11h, 15h, 19h)
                           R/W-x       R/W-x        R/W-x           U-0        R/W-x           U-0    R/W-x         R/W-x
                           SID2        SID1          SID0            —         EXIDE           —      EID17         EID16
                        bit 7                                                                                           bit 0
          bit 7-5       SID<2:0>: Standard Identifier Filter Bits <2:0>
                        These bits hold the filter bits to be applied to bits <2:0> of the Standard Identifier portion of a
                        received message
          bit 4         Unimplemented: Reads as '0'
          bit 3         EXIDE: Extended Identifier Enable
                        1 = Filter is applied only to Extended Frames
                        0 = Filter is applied only to Standard Frames
          bit 2         Unimplemented: Reads as '0
          bit 1-0       EID<17:16>: Exended Identifier Filter Bits <17:16>
                        These bits hold the filter bits to be applied to bits <17:16> of the Extended Identifier portion of
                        a received message
                        Legend:
                        R = Readable bit               W = Writable bit        U = Unimplemented bit, read as ‘0’
                        -n = Value at POR              ’1’ = Bit is set        ’0’ = Bit is cleared  x = Bit is unknown
REGISTER 4-12:         RXFNEID8 - ACCEPTANCE FILTER N EXTENDED IDENTIFIER HIGH
                       (ADDRESS: 02h, 06h, 0Ah, 12h, 16h, 1Ah)
                           R/W-x       R/W-x        R/W-x          R/W-x       R/W-x         R/W-x    R/W-x         R/W-x
                          EID15        EID14        EID13          EID12       EID11         EID10     EID9          EID8
                        bit 7                                                                                           bit 0
          bit 7-0       EID<15:8>: Extended Identifier Bits <15:8>
                        These bits hold the filter bits to be applied to bits <15:8> of the Extended Identifier portion of a
                        received message
                        Legend:
                        R = Readable bit               W = Writable bit        U = Unimplemented bit, read as ‘0’
                        -n = Value at POR              ’1’ = Bit is set        ’0’ = Bit is cleared  x = Bit is unknown
© 2007 Microchip Technology Inc.                                                                          DS21291F-page 31


MCP2510
REGISTER 4-13:   RXFNEID0 - ACCEPTANCE FILTER N EXTENDED IDENTIFIER LOW
                 (ADDRESS: 03h, 07h, 0Bh, 13h, 17h, 1Bh)
                     R/W-x      R/W-x         R/W-x           R/W-x      R/W-x         R/W-x       R/W-x        R/W-x
                     EID7        EID6          EID5           EID4        EID3          EID2        EID1         EID0
                  bit 7                                                                                             bit 0
         bit 7-0  EID<7:0>: Extended Identifier Bits <7:0>
                  These bits hold the filter bits to be applied to the bits <7:0> of the Extended Identifier portion of
                  a received message
                  Legend:
                  R = Readable bit                W = Writable bit       U = Unimplemented bit, read as ‘0’
                  -n = Value at POR               ’1’ = Bit is set       ’0’ = Bit is cleared     x = Bit is unknown
REGISTER 4-14:   RXMNSIDH - ACCEPTANCE FILTER MASK N STANDARD IDENTIFIER HIGH
                 (ADDRESS: 20h, 24h)
                     R/W-x      R/W-x         R/W-x           R/W-x      R/W-x         R/W-x       R/W-x        R/W-x
                    SID10        SID9          SID8           SID7        SID6          SID5        SID4         SID3
                  bit 7                                                                                             bit 0
         bit 7-0  SID<10:3>: Standard Identifier Mask Bits <10:3>
                  These bits hold the mask bits to be applied to bits <10:3> of the Standard Identifier portion of a
                  received message
                  Legend:
                  R = Readable bit                W = Writable bit       U = Unimplemented bit, read as ‘0’
                  -n = Value at POR               ’1’ = Bit is set       ’0’ = Bit is cleared     x = Bit is unknown
REGISTER 4-15:   RXMNSIDL - ACCEPTANCE FILTER MASK N STANDARD IDENTIFIER LOW
                 (ADDRESS: 21h, 25h)
                     R/W-x      R/W-x         R/W-x            U-0         U-0           U-0       R/W-x        R/W-x
                     SID2        SID1          SID0             —          —             —         EID17        EID16
                  bit 7                                                                                             bit 0
         bit 7-5  SID<2:0>: Standard Identifier Mask Bits <2:0>
                  These bits hold the mask bits to be applied to bits<2:0> of the Standard Identifier portion of a
                  received message
         bit 4-2  Unimplemented: Reads as '0'
         bit 1-0  EID<17:16>: Extended Identifier Mask Bits <17:16>
                  These bits hold the mask bits to be applied to bits <17:16> of the Extended Identifier portion of
                  a received message
                  Legend:
                  R = Readable bit                W = Writable bit       U = Unimplemented bit, read as ‘0’
                  -n = Value at POR               ’1’ = Bit is set       ’0’ = Bit is cleared     x = Bit is unknown
DS21291F-page 32                                                                          © 2007 Microchip Technology Inc.


                                                                                                    MCP2510
REGISTER 4-16:         RXMNEID8 - ACCEPTANCE FILTER MASK N EXTENDED IDENTIFIER HIGH
                       (ADDRESS: 22h, 26h)
                           R/W-x      R/W-x         R/W-x          R/W-x       R/W-x         R/W-x    R/W-x        R/W-x
                          EID15       EID14         EID13          EID12       EID11         EID10     EID9         EID8
                        bit 7                                                                                           bit 0
          bit 7-0       EID<15:8>: Extended Identifier Bits <15:8>
                        These bits hold the filter bits to be applied to bits <15:8> of the Extended Identifier portion of a
                        received message
                        Legend:
                        R = Readable bit               W = Writable bit        U = Unimplemented bit, read as ‘0’
                        -n = Value at POR              ’1’ = Bit is set        ’0’ = Bit is cleared x = Bit is unknown
REGISTER 4-17:         RXMNEID0 - ACCEPTANCE FILTER MASK N EXTENDED IDENTIFIER LOW
                       (ADDRESS: 23h, 27h)
                           R/W-x      R/W-x         R/W-x          R/W-x       R/W-x         R/W-x    R/W-x        R/W-x
                           EID7        EID6          EID5          EID4         EID3          EID2     EID1         EID0
                        bit 7                                                                                           bit 0
          bit 7-0       EID<7:0>: Extended Identifier Mask Bits <7:0>
                        These bits hold the mask bits to be applied to the bits <7:0> of the Extended Identifier portion
                        of a received message
                        Legend:
                        R = Readable bit               W = Writable bit        U = Unimplemented bit, read as ‘0’
                        -n = Value at POR              ’1’ = Bit is set        ’0’ = Bit is cleared x = Bit is unknown
© 2007 Microchip Technology Inc.                                                                         DS21291F-page 33


MCP2510
NOTES:
DS21291F-page 34 © 2007 Microchip Technology Inc.


                                                                                                MCP2510
5.0        BIT TIMING                                           The nominal bit rate is the number of bits transmitted
                                                                per second assuming an ideal transmitter with an ideal
All nodes on a given CAN bus must have the same                 oscillator, in the absence of resynchronization. The
nominal bit rate. The CAN protocol uses Non Return to           nominal bit rate is defined to be a maximum of 1 Mb/s.
Zero (NRZ) coding which does not encode a clock
                                                                Nominal Bit Time is defined as:
within the data stream. Therefore, the receive clock
must be recovered by the receiving nodes and syn-                     TBIT = 1 / NOMlNAL BlT RATE
chronized to the transmitters clock.                            The nominal bit time can be thought of as being divided
As oscillators and transmission time may vary from              into separate non-overlapping time segments. These
node to node, the receiver must have some type of               segments are shown in Figure 5-1.
Phase Lock Loop (PLL) synchronized to data transmis-               -  Synchronization Segment (Sync_Seg)
sion edges to synchronize and maintain the receiver
                                                                   -  Propagation Time Segment (Prop_Seg)
clock. Since the data is NRZ coded, it is necessary to
include bit stuffing to ensure that an edge occurs at              -  Phase Buffer Segment 1 (Phase_Seg1)
least every six bit times, to maintain the Digital Phase           -  Phase Buffer Segment 2 [Phase_Seg2)
Lock Loop (DPLL) synchronization.                               Nominal Bit Time = TQ * (Sync_Seg + Prop_Seg +
The bit timing of the MCP2510 is implemented using a            Phase_Seg1 + Phase_Seg2)
DPLL that is configured to synchronize to the incoming          The time segments and also the nominal bit time are
data, and provide the nominal timing for the transmitted        made up of integer units of time called time quanta or
data. The DPLL breaks each bit time into multiple seg-          TQ (see Figure 5-1). By definition, the nominal bit time
ments made up of minimal periods of time called the             is programmable from a minimum of 8 TQ to a maxi-
time quanta (TQ).                                               mum of 25 TQ. Also, by definition the minimum nominal
Bus timing functions executed within the bit time frame,        bit time is 1 µs, corresponding to a maximum 1 Mb/s
such as synchronization to the local oscillator, network        rate.
transmission delay compensation, and sample point
positioning, are defined by the programmable bit timing
logic of the DPLL.
All devices on the CAN bus must use the same bit rate.
However, all devices are not required to have the same
master oscillator clock frequency. For the different
clock frequencies of the individual devices, the bit rate
has to be adjusted by appropriately setting the baud
rate prescaler and number of time quanta in each seg-
ment.
FIGURE 5-1:             BIT TIME PARTITIONING
          Input Signal
                                   Prop                   Phase                              Phase
                       Sync      Segment                Segment 1                         Segment 2
                                                             Sample Point
           TQ
© 2007 Microchip Technology Inc.                                                                      DS21291F-page 35


MCP2510
5.1       Time Quanta                                      The total delay is calculated from the following individ-
                                                           ual delays:
The Time Quanta (TQ) is a fixed unit of time derived
from the oscillator period. There is a programmable            - 2 * physical bus end to end delay; TBUS
baud-rate prescaler, with integral values ranging from 1       - 2 * input comparator delay; TCOMP (depends
to 64, in addition to a fixed divide by two for clock gen-        on application circuit)
eration.                                                       - 2 * output driver delay; TDRIVE (depends on
Time quanta is defined as:                                        application circuit)
                                                               - 1 * input to output of CAN controller; TCAN
             T Q = 2* ( Baud Rate + 1 )*TOSC                      (maximum defined as 1 TQ + delay ns)
                                                               - TPROPOGATION = 2 * (TBUS + TCOMP +
where Baud Rate is the binary value represented by                TDRIVE) + TCAN
CNF1.BRP<5:0>                                                  - Prop_Seg = TPROPOGATION / TQ
For some examples:
                                                           5.4         Phase Buffer Segments
If FOSC = 16 MHz, BRP<5:0> = 00h, and Nominal Bit
Time = 8 TQ;                                               The Phase Buffer Segments are used to optimally
                                                           locate the sampling point of the received bit within the
   then TQ= 125 nsec and Nominal Bit Rate = 1 Mb/s         nominal bit time. The sampling point occurs between
If FOSC = 20 MHz, BRP<5:0> = 01h, and Nominal Bit          phase segment 1 and phase segment 2. These seg-
Time = 8 TQ;                                               ments can be lengthened or shortened by the resyn-
   then TQ= 200 nsec and Nominal Bit Rate = 625 Kb/s       chronization process (see Section 5.7.2). Thus, the
                                                           variation of the values of the phase buffer segments
If FOSC = 25 MHz, BRP<5:0> = 3Fh, and Nominal Bit          represent the DPLL functionality. The end of phase
Time = 25 TQ;                                              segment 1 determines the sampling point within a bit
   then TQ = 5.12 µsec and Nominal Bit Rate = 7.8 Kb/s     time. phase segment 1 is programmable from 1 TQ to 8
The frequencies of the oscillators in the different nodes  TQ in duration. Phase segment 2 provides delay before
                                                           the next transmitted data transition and is also pro-
must be coordinated in order to provide a system-wide
specified nominal bit time. This means that all oscilla-   grammable from 1 TQ to 8 TQ in duration (however due
tors must have a TOSC that is a integral divisor of TQ. It to IPT requirements the actual minimum length of
                                                           phase segment 2 is 2 TQ - see Section 5.6 below), or it
should also be noted that although the number of TQ is
                                                           may be defined to be equal to the greater of phase seg-
programmable from 4 to 25, the usable minimum is 6
TQ. Attempting to a bit time of less than 6 TQ in length   ment 1 or the Information Processing Time (IPT). (see
                                                           Section 5.6).
is not guaranteed to operate correctly
5.2       Synchronization Segment                          5.5         Sample Point
                                                           The Sample Point is the point of time at which the bus
This part of the bit time is used to synchronize the var-
                                                           level is read and value of the received bit is determined.
ious CAN nodes on the bus. The edge of the input sig-
nal is expected to occur during the sync segment. The      The Sampling point occurs at the end of phase seg-
                                                           ment 1. If the bit timing is slow and contains many TQ,
duration is 1 TQ.
                                                           it is possible to specify multiple sampling of the bus line
5.3       Propagation Segment                              at the sample point. The value of the received bit is
                                                           determined to be the value of the majority decision of
This part of the bit time is used to compensate for phys-  three values. The three samples are taken at the sam-
ical delay times within the network. These delay times     ple point, and twice before with a time of TQ/2 between
consist of the signal propagation time on the bus line     each sample.
and the internal delay time of the nodes. The delay is
calculated as being the round trip time from transmitter   5.6         Information Processing Time
to receiver (twice the signal's propagation time on the
                                                           The Information Processing Time (IPT) is the time seg-
bus line), the input comparator delay, and the output
                                                           ment, starting at the sample point, that is reserved for
driver delay. The length of the Propagation Segment
can be programmed from 1 TQ to 8 TQ by setting the         calculation of the subsequent bit level. The CAN spec-
                                                           ification defines this time to be less than or equal to 2
PRSEG2:PRSEG0 bits of the CNF2 register
                                                           TQ. The MCP2510 defines this time to be 2 TQ. Thus,
(Register 5-2).
                                                           phase segment 2 must be at least 2 TQ long.
DS21291F-page 36                                                                       © 2007 Microchip Technology Inc.


                                                                                                MCP2510
5.7        Synchronization                                   The phase error of an edge is given by the position of
                                                             the edge relative to Sync Seg, measured in TQ. The
To compensate for phase shifts between the oscillator        phase error is defined in magnitude of TQ as follows:
frequencies of each of the nodes on the bus, each CAN
controller must be able to synchronize to the relevant       • e = 0 if the edge lies within SYNCESEG
signal edge of the incoming signal. Synchronization is       • e > 0 if the edge lies before the SAMPLE POINT
the process by which the DPLL function is imple-             • e < 0 if the edge lies after the SAMPLE POINT of
mented. When an edge in the transmitted data is                  the previous bit
detected, the logic will compare the location of the edge    If the magnitude of the phase error is less than or equal
to the expected time (Sync Seg). The circuit will then       to the programmed value of the synchronization jump
adjust the values of phase segment 1 and phase seg-          width, the effect of a resynchronization is the same as
ment 2 as necessary. There are two mechanisms used           that of a hard synchronization.
for synchronization.
                                                             If the magnitude of the phase error is larger than the
5.7.1         HARD SYNCHRONIZATION                           synchronization jump width, and if the phase error is
                                                             positive, then phase segment 1 is lengthened by an
Hard Synchronization is only done when there is a            amount equal to the synchronization jump width.
recessive to dominant edge during a BUS IDLE condi-
tion, indicating the start of a message. After hard syn-     If the magnitude of the phase error is larger than the
chronization, the bit time counters are restarted with       resynchronization jump width, and if the phase error is
Sync Seg. Hard synchronization forces the edge which         negative, then phase segment 2 is shortened by an
has occurred to lie within the synchronization segment       amount equal to the synchronization jump width.
of the restarted bit time. Due to the rules of synchroni-
                                                             5.7.3          SYNCHRONIZATION RULES
zation, if a hard synchronization occurs there will not be
a resynchronization within that bit time.                    • Only one synchronization within one bit time is
                                                                 allowed
5.7.2         RESYNCHRONIZATION                              • An edge will be used for synchronization only if
As a result of Resynchronization, phase segment 1                the value detected at the previous sample point
may be lengthened or phase segment 2 may be short-               (previously read bus value) differs from the bus
ened. The amount of lengthening or shortening of the             value immediately after the edge
phase buffer segments has an upper bound given by            • All other recessive to dominant edges fulfilling
the Synchronization Jump Width (SJW). The value of               rules 1 and 2 will be used for resynchronization
the SJW will be added to phase segment 1 (see                    with the exception that a node transmitting a dom-
Figure 5-2) or subtracted from phase segment 2 (see              inant bit will not perform a resynchronization as a
Figure 5-3). The SJW represents the loop filtering of            result of a recessive to dominant edge with a pos-
the DPLL. The SJW is programmable between 1 TQ                   itive phase error
and 4 TQ.
Clocking information will only be derived from reces-
sive to dominant transitions. The property that only a
fixed maximum number of successive bits have the
same value ensures resynchronization to the bit stream
during a frame.
FIGURE 5-2:              LENGTHENING A BIT PERIOD
        Input Signal
                           Prop              Phase                                    Phase
               Sync      Segment          Segment 1        ≤ SJW                    Segment 2
                                                                     Sample                  Nominal    Actual Bit
                                                                      Point                 Bit Length    Length
      TQ
© 2007 Microchip Technology Inc.                                                                      DS21291F-page 37


MCP2510
FIGURE 5-3:             SHORTENING A BIT PERIOD
    Input Signal
                        Prop                  Phase                      Phase
             Sync    Segment                Segment 1                 Segment 2                 ≤ SJW
                                                        Sample                         Actual         Nominal
                                                         Point                       Bit Length      Bit Length
    TQ
5.8       Programming Time Segments                        5.9       Oscillator Tolerance
Some requirements for programming of the time seg-         The bit timing requirements allow ceramic resonators
ments:                                                     to be used in applications with transmission rates of up
• Prop Seg + Phase Seg 1 >= Phase Seg 2                    to 125 kbit/sec, as a rule of thumb. For the full bus
                                                           speed range of the CAN protocol, a quartz oscillator is
• Prop Seg + Phase Seg 1 >= TDELAY
                                                           required. A maximum node-to-node oscillator variation
• Phase Seg 2 > Sync Jump Width                            of 1.7% is allowed.
For example, assuming that a 125 kHz CAN baud rate
with FOSC = 20 MHz is desired:
TOSC = 50 nsec, choose BRP<5:0> = 04h, then TQ =
500 nsec. To obtain 125 kHz, the bit time must be 16
TQ.
Typically, the sampling of the bit should take place at
about 60-70% of the bit time, depending on the system
parameters. Also, typically, the TDELAY is 1-2 TQ.
Sync Seg = 1 TQ; Prop Seg = 2 TQ; So setting Phase
Seg 1 = 7 TQ would place the sample at 10 TQ after the
transition. This would leave 6 TQ for Phase Seg 2.
Since Phase Seg 2 is 6, by the rules, SJW could be the
maximum of 4 TQ. However, normally a large SJW is
only necessary when the clock generation of the differ-
ent nodes is inaccurate or unstable, such as using
ceramic resonators. So an SJW of 1 is typically
enough.
DS21291F-page 38                                                                    © 2007 Microchip Technology Inc.


                                                                                                         MCP2510
5.10       Bit Timing Configuration                                 ting this bit to a ‘1’ causes the bus to be sampled three
           Registers                                                times; twice at TQ/2 before the sample point, and once
                                                                    at the normal sample point (which is at the end of phase
The configuration registers (CNF1, CNF2, CNF3) con-                 segment 1). The value of the bus is determined to be
trol the bit timing for the CAN bus interface. These reg-           the value read during at least two of the samples. If the
isters can only be modified when the MCP2510 is in                  SAM bit is set to a ‘0’ then the RXCAN pin is sampled
configuration mode (see Section 9.0).                               only once at the sample point. The BTLMODE bit con-
                                                                    trols how the length of phase segment 2 is determined.
5.10.1         CNF1                                                 If this bit is set to a ‘1’ then the length of phase segment
The BRP<5:0> bits control the baud rate prescaler.                  2 is determined by the PHSEG2<2:0> bits of CNF3
These bits set the length of TQ relative to the OSC1                (see Section 5.10.3). If the BTLMODE bit is set to a ‘0’
input frequency, with the minimum length of TQ being 2              then the length of phase segment 2 is the greater of
OSC1 clock cycles in length (when BRP<5:0> are set                  phase segment 1 and the information processing time
to 000000). The SJW<1:0> bits select the synchroni-                 (which is fixed at 2 TQ for the MCP2510).
zation jump width in terms of number of TQ’s.
                                                                    5.10.3          CNF3
5.10.2         CNF2                                                 The PHSEG2<2:0> bits set the length, in TQ’s, of
The PRSEG<2:0> bits set the length, in TQ’s, of the                 Phase Segment 2, if the CNF2.BTLMODE bit is set to
propagation segment. The PHSEG1<2:0> bits set the                   a ‘1’. If the BTLMODE bit is set to a ‘0’ then the
length, in TQ’s, of phase segment 1. The SAM bit con-               PHSEG2<2:0> bits have no effect.
trols how many times the RXCAN pin is sampled. Set-
REGISTER 5-1:             CNF1 - CONFIGURATION REGISTER1 (ADDRESS: 2Ah)
                             R/W-0       R/W-0      R/W-0         R/W-0          R/W-0          R/W-0       R/W-0        R/W-0
                              SJW1       SJW0       BRP5          BRP4           BRP3           BRP2         BRP1        BRP0
                           bit 7                                                                                            bit 0
             bit 7-6       SJW<1:0>: Synchronization Jump Width Length
                           11 = Length = 4 x TQ
                           10 = Length = 3 x TQ
                           01 = Length = 2 x TQ
                           00 = Length = 1 x TQ
             bit 5-0       BRP<5:0>: Baud Rate Prescaler
                           TQ = 2 x (BRP + 1) / FOSC
                           Legend:
                           R = Readable bit           W = Writable bit           U = Unimplemented bit, read as ‘0’
                           -n = Value at POR          ’1’ = Bit is set           ’0’ = Bit is cleared      x = Bit is unknown
© 2007 Microchip Technology Inc.                                                                                DS21291F-page 39


MCP2510
REGISTER 5-2:     CNF2 - CONFIGURATION REGISTER2 (ADDRESS: 29h)
                    R/W-0       R/W-0       R/W-0         R/W-0    R/W-0          R/W-0       R/W-0       R/W-0
                 BTLMODE         SAM      PHSEG12 PHSEG11 PHSEG10               PRSEG2      PRSEG1       PRSEG0
                 bit 7                                                                                        bit 0
        bit 7    BTLMODE: Phase Segment 2 Bit Time Length
                 1 = Length of Phase Seg 2 determined by PHSEG22:PHSEG20 bits of CNF3
                 0 = Length of Phase Seg 2 is the greater of Phase Seg 1 and IPT (2TQ)
        bit 6    SAM: Sample Point Configuration
                 1 = Bus line is sampled three times at the sample point
                 0 = Bus line is sampled once at the sample point
        bit 5-3  PHSEG1<2:0>: Phase Segment 1 Length
                 (PHSEG1 + 1) x TQ
        bit 2-0  PRSEG<2:0>: Propagation Segment Length
                 (PRSEG + 1) x TQ
                 Legend:
                 R = Readable bit            W = Writable bit     U = Unimplemented bit, read as ‘0’
                 -n = Value at POR           ’1’ = Bit is set     ’0’ = Bit is cleared     x = Bit is unknown
REGISTER 5-3:     CNF3 - CONFIGURATION REGISTER 3 (ADDRESS: 28h)
                       U-0       R/W-0       U-0           U-0    U-0         R/W-0        R/W-0          R/W-0
                        —       WAKFIL        —            —      —         PHSEG22      PHSEG21        PHSEG20
                   bit 7                                                                                      bit 0
         bit 7     Unimplemented: Reads as '0'
         bit 6     WAKFIL: Wake-up Filter
                   1 = Wake-up filter enabled
                   0 = Wake-up filter disabled
         bit 5-3   Unimplemented: Reads as '0'
         bit 2-0   PHSEG2<2:0>: Phase Segment 2 Length
                   (PHSEG2 + 1) x TQ
                   Note:   Minimum valid setting for Phase Segment 2 is 2TQ
                   Legend:
                   R = Readable bit            W = Writable bit    U = Unimplemented bit, read as ‘0’
                   -n = Value at POR           ’1’ = Bit is set    ’0’ = Bit is cleared     x = Bit is unknown
DS21291F-page 40                                                                    © 2007 Microchip Technology Inc.


                                                                                            MCP2510
6.0       ERROR DETECTION                                  6.6        Error States
The CAN protocol provides sophisticated error detec-       Detected errors are made public to all other nodes via
tion mechanisms. The following errors can be detected.     error frames. The transmission of the erroneous mes-
                                                           sage is aborted and the frame is repeated as soon as
6.1       CRC Error                                        possible. Furthermore, each CAN node is in one of the
                                                           three error states “error-active”, “error-passive” or “bus-
With the Cyclic Redundancy Check (CRC), the trans-         off” according to the value of the internal error counters.
mitter calculates special check bits for the bit sequence  The error-active state is the usual state where the bus
from the start of a frame until the end of the data field. node can transmit messages and active error frames
This CRC sequence is transmitted in the CRC Field.         (made of dominant bits) without any restrictions. In the
The receiving node also calculates the CRC sequence        error-passive state, messages and passive error
using the same formula and performs a comparison to        frames (made of recessive bits) may be transmitted.
the received sequence. If a mismatch is detected, a        The bus-off state makes it temporarily impossible for
CRC error has occurred and an error frame is gener-        the station to participate in the bus communication.
ated. The message is repeated.                             During this state, messages can neither be received
                                                           nor transmitted.
6.2       Acknowledge Error
In the acknowledge field of a message, the transmitter     6.7        Error Modes and Error Counters
checks if the acknowledge slot (which has sent out as      The MCP2510 contains two error counters: the
a recessive bit) contains a dominant bit. If not, no other Receive Error Counter (REC) (see Register 6-2), and
node has received the frame correctly. An acknowl-         the Transmit Error Counter (TEC) (see Register 6-1).
edge error has occurred; an error frame is generated;      The values of both counters can be read by the MCU.
and the message will have to be repeated.                  These counters are incremented or decremented in
                                                           accordance with the CAN bus specification.
6.3       Form Error
                                                           The MCP2510 is error-active if both error counters are
lf a node detects a dominant bit in one of the four seg-   below the error-passive limit of 128. It is error-passive
ments including end of frame, interframe space,            if at least one of the error counters equals or exceeds
acknowledge delimiter or CRC delimiter; then a form        128. It goes to bus-off if the transmit error counter
error has occurred and an error frame is generated.        equals or exceeds the bus-off limit of 256. The device
The message is repeated.                                   remains in this state, until the bus-off recovery
                                                           sequence is received. The bus-off recovery sequence
6.4       Bit Error                                        consists of 128 occurrences of 11 consecutive reces-
A Bit Error occurs if a transmitter sends a dominant bit   sive bits (see Figure 6-1). Note that the MCP2510, after
and detects a recessive bit or if it sends a recessive bit going bus-off, will recover back to error-active, without
and detects a dominant bit when monitoring the actual      any intervention by the MCU, if the bus remains idle for
bus level and comparing it to the just transmitted bit. In 128 X 11 bit times. If this is not desired, the error inter-
the case where the transmitter sends a recessive bit       rupt service routine should address this. The current
and a dominant bit is detected during the arbitration      error mode of the MCP2510 can be read by the MCU
field and the acknowledge slot, no bit error is generated  via the EFLG register (Register 6-3).
because normal arbitration is occurring.                   Additionally, there is an error state warning flag bit,
                                                           EFLG:EWARN, which is set if at least one of the error
6.5       Stuff Error                                      counters equals or exceeds the error warning limit of
                                                           96. EWARN is reset if both error counters are less than
lf, between the start of frame and the CRC delimiter, six
                                                           the error warning limit.
consecutive bits with the same polarity are detected,
the bit stuffing rule has been violated. A stuff error
occurs and an error frame is generated. The message
is repeated.
© 2007 Microchip Technology Inc.                                                                   DS21291F-page 41


MCP2510
FIGURE 6-1:       ERROR MODES STATE DIAGRAM
                                                           RESET
                 REC > 127 or                  Error-Active
                 TEC > 127
                                                                               128 occurrences of
                                                                               11 consecutive
                                         REC < 127 or                          “recessive” bits
                                         TEC < 127
                  Error-Passive
                                       TEC > 255
                                                              Bus-Off
REGISTER 6-1:     TEC - TRANSMITTER ERROR COUNTER (ADDRESS: 1Ch)
                       R-0         R-0      R-0           R-0          R-0            R-0         R-0          R-0
                      TEC7        TEC6     TEC5          TEC4         TEC3           TEC2        TEC1         TEC0
                   bit 7                                                                                         bit 0
         bit 7-0   TEC<7:0>: Transmit Error Count
                    Legend:
                    R = Readable bit         W = Writable bit         U = Unimplemented bit, read as ‘0’
                    -n = Value at POR        ’1’ = Bit is set         ’0’ = Bit is cleared     x = Bit is unknown
REGISTER 6-2:      REC - RECEIVER ERROR COUNTER (ADDRESS: 1Dh)
                       R-0         R-0      R-0           R-0          R-0            R-0         R-0          R-0
                      REC7        REC6     REC5          REC4         REC3           REC2        REC1        REC0
                   bit 7                                                                                         bit 0
         bit 7-0   REC<7:0>: Receive Error Count
                    Legend:
                    R = Readable bit         W = Writable bit         U = Unimplemented bit, read as ‘0’
                    -n = Value at POR        ’1’ = Bit is set         ’0’ = Bit is cleared     x = Bit is unknown
DS21291F-page 42                                                                       © 2007 Microchip Technology Inc.


                                                                                              MCP2510
REGISTER 6-3:          EFLG - ERROR FLAG REGISTER (ADDRESS: 2Dh)
                          R/W-0       R/W-0         R-0           R-0     R-0            R-0     R-0         R-0
                        RX1OVR       RX0OVR       TXBO           TXEP   RXEP          TXWAR    RXWAR       EWARN
                       bit 7                                                                                   bit 0
          bit 7         RX1OVR: Receive Buffer 1 Overflow Flag
                        - Set when a valid message is received for RXB1 and CANINTF.RX1IF = 1
                        - Must be reset by MCU
          bit 6         RX0OVR: Receive Buffer 0 Overflow Flag
                        - Set when a valid message is received for RXB0 and CANINTF.RX0IF = 1
                        - Must be reset by MCU
          bit 5         TXBO: Bus-Off Error Flag
                        - Bit set when TEC reaches 255
                        - Reset after a successful bus recovery sequence
          bit 4         TXEP: Transmit Error-Passive Flag
                        - Set when TEC is equal to or greater than 128
                        - Reset when TEC is less than 128
          bit 3         RXEP: Receive Error-Passive Flag
                        - Set when REC is equal to or greater than 128
                        - Reset when REC is less than 128
          bit 2         TXWAR: Transmit Error Warning Flag
                        - Set when TEC is equal to or greater than 96
                        - Reset when TEC is less than 96
          bit 1         RXWAR: Receive Error Warning Flag
                        - Set when REC is equal to or greater than 96
                        - Reset when REC is less than 96
          bit 0         EWARN: Error Warning Flag
                        - Set when TEC or REC is equal to or greater than 96 (TXWAR or RXWAR = 1)
                        - Reset when both REC and TEC are less than 96
                        Legend:
                        R = Readable bit             W = Writable bit    U = Unimplemented bit, read as ‘0’
                        -n = Value at POR            ’1’ = Bit is set    ’0’ = Bit is cleared x = Bit is unknown
© 2007 Microchip Technology Inc.                                                                   DS21291F-page 43


MCP2510
NOTES:
DS21291F-page 44 © 2007 Microchip Technology Inc.


                                                                                                MCP2510
7.0        INTERRUPTS                                         7.2        Transmit Interrupt
The device has eight sources of interrupts. The CAN-          When the Transmit Interrupt is enabled (CAN-
INTE register contains the individual interrupt enable        INTE.TXNIE = 1) an Interrupt will be generated on the
bits for each interrupt source. The CANINTF register          INT pin when the associated transmit buffer becomes
contains the corresponding interrupt flag bit for each        empty and is ready to be loaded with a new message.
interrupt source. When an interrupt occurs the INT pin        The CANINTF.TXNIF bit will be set to indicate the
is driven low by the MCP2510 and will remain low until        source of the interrupt. The interrupt is cleared by the
the Interrupt is cleared by the MCU. An Interrupt can         MCU resetting the TXNIF bit to a ‘0’.
not be cleared if the respective condition still prevails.
                                                              7.3        Receive Interrupt
It is recommended that the bit modify command be
used to reset flag bits in the CANINTF register rather        When the Receive Interrupt is enabled (CAN-
than normal write operations. This is to prevent unin-        INTE.RXNIE = 1) an interrupt will be generated on the
tentionally changing a flag that changes during the           INT pin when a message has been successfully
write command, potentially causing an interrupt to be         received and loaded into the associated receive buffer.
missed.                                                       This interrupt is activated immediately after receiving
It should be noted that the CANINTF flags are read/           the EOF field. The CANINTF.RXNIF bit will be set to
write and an Interrupt can be generated by the MCU            indicate the source of the interrupt. The interrupt is
setting any of these bits, provided the associated CAN-       cleared by the MCU resetting the RXNIF bit to a ‘0’.
INTE bit is also set.
                                                              7.4        Message Error Interrupt
7.1        Interrupt Code Bits                                When an error occurs during transmission or reception
The source of a pending interrupt is indicated in the         of a message the message error flag (CAN-
CANSTAT.ICOD (interrupt code) bits as indicated in            INTF.MERRF) will be set and, if the CANINTE.MERRE
Register 9-2. In the event that multiple interrupts occur,    bit is set, an interrupt will be generated on the INT pin.
the INT will remain low until all interrupts have been        This is intended to be used to facilitate baud rate deter-
reset by the MCU, and the CANSTAT.ICOD bits will              mination when used in conjunction with listen-only
reflect the code for the highest priority interrupt that is   mode.
currently pending. Interrupts are internally prioritized
such that the lower the ICOD value the higher the inter-      7.5        Bus Activity Wakeup Interrupt
rupt priority. Once the highest priority interrupt condi-     When the MCP2510 is in sleep mode and the bus activ-
tion has been cleared, the code for the next highest          ity wakeup interrupt is enabled (CANINTE.WAKIE = 1),
priority interrupt that is pending (if any) will be reflected an interrupt will be generated on the INT pin, and the
by the ICOD bits (see Table 7-1). Note that only those        CANINTF.WAKIF bit will be set when activity is
interrupt sources that have their associated CANINTE          detected on the CAN bus. This interrupt causes the
enable bit set will be reflected in the ICOD bits.            MCP2510 to exit sleep mode. The interrupt is reset by
                                                              the MCU clearing the WAKIF bit.
TABLE 7-1:           ICOD<2:0> DECODE
  ICOD<2:0>                Boolean Expression
      000        ERR•WAK•TX0•TX1•TX2•RX0•RX1
      001        ERR
      010        ERR•WAK
      011        ERR•WAK•TX0
      100        ERR•WAK•TX0•TX1
      101        ERR•WAK•TX0•TX1•TX2
      110        ERR•WAK•TX0•TX1•TX2•RX0
      111        ERR•WAK•TX0•TX1•TX2•RX0•RX1
© 2007 Microchip Technology Inc.                                                                      DS21291F-page 45


MCP2510
7.6        Error Interrupt                                 7.6.4         RECEIVER ERROR-PASSIVE
When the error interrupt is enabled (CANINTE.ERRIE         The receive error counter has exceeded the error- pas-
= 1) an interrupt is generated on the INT pin if an over-  sive limit of 127 and the device has gone to error- pas-
flow condition occurs or if the error state of transmitter sive state.
or receiver has changed. The Error Flag Register
(EFLG) will indicate one of the following conditions.      7.6.5         TRANSMITTER ERROR-PASSIVE
                                                           The transmit error counter has exceeded the error-
7.6.1         RECEIVER OVERFLOW
                                                           passive limit of 127 and the device has gone to error-
An overflow condition occurs when the MAB has              passive state.
assembled a valid received message (the message
meets the criteria of the acceptance filters) and the      7.6.6         BUS-OFF
receive buffer associated with the filter is not available The transmit error counter has exceeded 255 and the
for loading of a new message. The associated               device has gone to bus-off state.
EFLG.RXNOVR bit will be set to indicate the overflow
condition. This bit must be cleared by the MCU.            7.7        Interrupt Acknowledge
7.6.2         RECEIVER WARNING                             Interrupts are directly associated with one or more sta-
                                                           tus flags in the CANINTF register. Interrupts are pend-
The receive error counter has reached the MCU warn-
                                                           ing as long as one of the flags is set. Once an interrupt
ing limit of 96.
                                                           flag is set by the device, the flag can not be reset by the
                                                           MCU until the interrupt condition is removed.
7.6.3         TRANSMITTER WARNING
The transmit error counter has reached the MCU warn-
ing limit of 96.
DS21291F-page 46                                                                     © 2007 Microchip Technology Inc.


                                                                                               MCP2510
REGISTER 7-1:          CANINTE - INTERRUPT ENABLE REGISTER (ADDRESS: 2Bh)
                          R/W-0       R/W-0       R/W-0          R/W-0    R/W-0         R/W-0   R/W-0        R/W-0
                         MERRE        WAKIE      ERRIE           TX2IE    TX1IE         TX0IE   RX1IE        RX0IE
                       bit 7                                                                                    bit 0
          bit 7         MERRE: Message Error Interrupt Enable
                        1 = Interrupt on error during message reception or transmission
                        0 = Disabled
          bit 6         WAKIE: Wakeup Interrupt Enable
                        1 = Interrupt on CAN bus activity
                        0 = Disabled
          bit 5         ERRIE: Error Interrupt Enable (multiple sources in EFLG register)
                        1 = Interrupt on EFLG error condition change
                        0 = Disabled
          bit 4         TX2IE: Transmit Buffer 2 Empty Interrupt Enable
                        1 = Interrupt on TXB2 becoming empty
                        0 = Disabled
          bit 3         TX1IE: Transmit Buffer 1 Empty Interrupt Enable
                        1 = Interrupt on TXB1 becoming empty
                        0 = Disabled
          bit 2         TX0IE: Transmit Buffer 0 Empty Interrupt Enable
                        1 = Interrupt on TXB0 becoming empty
                        0 = Disabled
          bit 1         RX1IE: Receive Buffer 1 Full Interrupt Enable
                        1 = Interrupt when message received in RXB1
                        0 = Disabled
          bit 0         RX0IE: Receive Buffer 0 Full Interrupt Enable
                        1 = Interrupt when message received in RXB0
                        0 = Disabled
                        Legend:
                        R = Readable bit             W = Writable bit     U = Unimplemented bit, read as ‘0’
                        -n = Value at POR            ’1’ = Bit is set     ’0’ = Bit is cleared x = Bit is unknown
© 2007 Microchip Technology Inc.                                                                    DS21291F-page 47


MCP2510
REGISTER 7-2:    CANINTF - INTERRUPT FLAG REGISTER (ADDRESS: 2Ch)
                    R/W-0       R/W-0      R/W-0          R/W-0    R/W-0         R/W-0       R/W-0        R/W-0
                   MERRF        WAKIF      ERRIF          TX2IF    TX1IF         TX0IF       RX1IF        RX0IF
                 bit 7                                                                                        bit 0
         bit 7   MERRF: Message Error Interrupt Flag
                 1 = Interrupt pending (must be cleared by MCU to reset interrupt condition)
                 0 = No interrupt pending
         bit 6   WAKIF: Wakeup Interrupt Flag
                 1 = Interrupt pending (must be cleared by MCU to reset interrupt condition)
                 0 = No interrupt pending
         bit 5   ERRIF: Error Interrupt Flag (multiple sources in EFLG register)
                 1 = Interrupt pending (must be cleared by MCU to reset interrupt condition)
                 0 = No interrupt pending
         bit 4   TX2IF: Transmit Buffer 2 Empty Interrupt Flag
                 1 = Interrupt pending (must be cleared by MCU to reset interrupt condition)
                 0 = No interrupt pending
         bit 3   TX1IF: Transmit Buffer 1 Empty Interrupt Flag
                 1 = Interrupt pending (must be cleared by MCU to reset interrupt condition)
                 0 = No interrupt pending
         bit 2   TX0IF: Transmit Buffer 0 Empty Interrupt Flag
                 1 = Interrupt pending (must be cleared by MCU to reset interrupt condition)
                 0 = No interrupt pending
         bit 1   RX1IF: Receive Buffer 1 Full Interrupt Flag
                 1 = Interrupt pending (must be cleared by MCU to reset interrupt condition)
                 0 = No interrupt pending
         bit 0   RX0IF: Receive Buffer 0 Full Interrupt Flag
                 1 = Interrupt pending (must be cleared by MCU to reset interrupt condition)
                 0 = No interrupt pending
                  Legend:
                  R = Readable bit            W = Writable bit     U = Unimplemented bit, read as ‘0’
                  -n = Value at POR           ’1’ = Bit is set     ’0’ = Bit is cleared     x = Bit is unknown
DS21291F-page 48                                                                    © 2007 Microchip Technology Inc.


                                                                                                  MCP2510
8.0        OSCILLATOR                                              8.2       CLKOUT Pin
The MCP2510 is designed to be operated with a crystal              The clock out pin is provided to the system designer for
or ceramic resonator connected to the OSC1 and                     use as the main system clock or as a clock input for
OSC2 pins. The MCP2510 oscillator design requires                  other devices in the system. The CLKOUT has an inter-
the use of a parallel cut crystal. Use of a series cut crys-       nal prescaler which can divide FOSC by 1, 2, 4 and 8.
tal may give a frequency out of the crystal manufactur-            The CLKOUT function is enabled and the prescaler is
ers specifications. A typical oscillator circuit is shown in       selected via the CANCNTRL register (see Register 9-
Figure 8-1. The MCP2510 may also be driven by an                   1). The CLKOUT pin will be active upon system reset
external clock source connected to the OSC1 pin as                 and default to the slowest speed (divide by 8) so that it
shown in Figure 8-2 and Figure 8-3.                                can be used as the MCU clock. When sleep mode is
                                                                   requested, the MCP2510 will drive sixteen additional
8.1        Oscillator Startup Timer                                clock cycles on the CLKOUT pin before entering sleep
                                                                   mode. The idle state of the CLKOUT pin in sleep mode
The MCP2510 utilizes an oscillator startup timer (OST),
                                                                   is low. When the CLKOUT function is disabled (CAN-
which holds the MCP2510 in reset, to insure that the
                                                                   CNTRL.CLKEN = ‘0’) the CLKOUT pin is in a high
oscillator has stabilized before the internal state
                                                                   impedance state.
machine begins to operate. The OST maintains reset
for the first 128 OSC1 clock cycles after power up,                The CLKOUT function is designed to guarantee that
RESET, or wake up from sleep mode occurs. It should                thCLKOUT and tlCLKOUT timings are preserved when the
be noted that no SPI operations should be attempted                CLKOUT pin function is enabled, disabled, or the pres-
until after the OST has expired.                                   caler value is changed.
FIGURE 8-1:              CRYSTAL/CERAMIC RESONATOR OPERATION
                                                OSC1
                                     C1                                  To internal logic
                                              XTAL                       SLEEP
                                                             RF(2)
                                             RS(1)
                                     C2          OSC2
                        Note 1: A series resistor, RS, may be required for AT strip cut crystals.
                        Note 2: The feedback resistor, RF , is typically in the range of 2 to 10 MΩ.
FIGURE 8-2:              EXTERNAL CLOCK SOURCE
                               Clock from
                                                                           OSC1
                             external system
                                                   (1)
                                                 Open                      OSC2
         Note 1: A resistor to ground may be used to reduce system noise. This may increase system current.
         Note 2: Duty cycle restrictions must be observed (see Table 12-2).
© 2007 Microchip Technology Inc.                                                                          DS21291F-page 49


MCP2510
FIGURE 8-3:       EXTERNAL SERIES RESONANT CRYSTAL OSCILLATOR CIRCUIT
                  330 kΩ                    330 kΩ                       To Other
                                                                          Devices
                 74AS04                    74AS04             74AS04                MCP2510
                                                                                     OSC1
                                0.1 mF
                                 XTAL
                     Note 1: Duty cycle restrictions must be observed (see Table 12-2).
DS21291F-page 50                                                                  © 2007 Microchip Technology Inc.


                                                                                             MCP2510
9.0        MODES OF OPERATION                               be placed into a sleep mode and use the MCP2510 to
                                                            wake it up upon detecting activity on the bus.
The MCP2510 has five modes of operation. These
modes are:                                                      Note:     Care must be exercised to not enter sleep
1.    Configuration Mode.                                                 mode while the MCP2510 is transmitting a
                                                                          message. If sleep mode is requested while
2.    Normal Mode.
                                                                          transmitting, the transmission will stop
3.    Sleep Mode.                                                         without completing and errors will occur on
4.    Listen-Only Mode.                                                   the bus. Also, the message will remain
5.    Loopback Mode.                                                      pending and transmit upon wake up.
The operational mode is selected via the CANCTRL.           When in sleep mode, the MCP2510 stops its internal
REQOP bits (see Register 9-1). When changing                oscillator. The MCP2510 will wake-up when bus activity
modes, the mode will not actually change until all pend-    occurs or when the MCU sets, via the SPI interface, the
ing message transmissions are complete. Because of          CANINTF.WAKIF bit to ‘generate’ a wake up attempt
this, the user must verify that the device has actually     (the CANINTF.WAKIF bit must also be set in order for
changed into the requested mode before further oper-        the wakeup interrupt to occur). The TXCAN pin will
ations are executed. Verification of the current operat-    remain in the recessive state while the MCP2510 is in
ing mode is done by reading the CANSTAT. OPMODE             sleep mode. Note that Sleep Mode will be entered
bits (see Register 9-2).                                    immediately, even if a message is currently being
                                                            transmitted, so it is necessary to insure that all TXREQ
9.1        Configuration Mode                               bits are clear before setting Sleep Mode.
The MCP2510 must be initialized before activation.          9.2.1          WAKE-UP FUNCTIONS
This is only possible if the device is in the configuration
mode. Configuration mode is automatically selected          The device will monitor the RXCAN pin for activity while
after powerup or a reset, or can be entered from any        it is in sleep mode. If the CANINTE.WAKIE bit is set,
other mode by setting the CANTRL.REQOP bits to              the device will wake up and generate an interrupt.
‘100’. When configuration mode is entered all error         Since the internal oscillator is shut down when sleep
counters are cleared. Configuration mode is the only        mode is entered, it will take some amount of time for the
mode where the following registers are modifiable:          oscillator to start up and the device to enable itself to
                                                            receive messages. The device will ignore the message
•  CNF1, CNF2, CNF3                                         that caused the wake-up from sleep mode as well as
•  TXRTSCTRL                                                any messages that occur while the device is ‘waking
•  Acceptance Filter Registers                              up.’ The device will wake up in listen-only mode. The
•  Acceptance Mask Registers                                MCU must set normal mode before the MCP2510 will
                                                            be able to communicate on the bus.
Only when the CANSTAT.OPMODE bits read as ‘100’
can the initialization be performed, allowing the config-   The device can be programmed to apply a low-pass fil-
uration registers, acceptance mask registers, and the       ter function to the RXCAN input line while in internal
acceptance filter registers to be written. After the con-   sleep mode. This feature can be used to prevent the
figuration is complete, the device can be activated by      device from waking up due to short glitches on the CAN
programming the CANCTRL.REQOP bits for normal               bus lines. The CNF3.WAKFIL bit enables or disables
operation mode (or any other mode).                         the filter.
9.2        Sleep Mode                                       9.3         Listen Only Mode
The MCP2510 has an internal sleep mode that is used         Listen-only mode provides a means for the MCP2510
to minimize the current consumption of the device. The      to receive all messages including messages with
SPI interface remains active even when the MCP2510          errors. This mode can be used for bus monitor applica-
is in sleep mode, allowing access to all registers.         tions or for detecting the baud rate in ‘hot plugging’ sit-
                                                            uations. For auto-baud detection it is necessary that
To enter sleep mode, the mode request bits are set in       there are at least two other nodes, which are communi-
the CANCTRL register. The CANSTAT.OPMODE bits               cating with each other. The baud rate can be detected
indicate whether the device successfully entered sleep      empirically by testing different values until valid mes-
mode. These bits should be read after sending the           sages are received. The listen-only mode is a silent
sleep command to the MCP2510. The MCP2510 is                mode, meaning no messages will be transmitted while
active and has not yet entered sleep mode until these       in this state, including error flags or acknowledge sig-
bits indicate that sleep mode has been entered. When        nals. The filters and masks can be used to allow only
in internal sleep mode, the wakeup interrupt is still       particular messages to be loaded into the receive reg-
active (if enabled). This is done so the MCU can also       isters, or the filter masks can be set to all zeros to allow
                                                            a message with any identifier to pass. The error
© 2007 Microchip Technology Inc.                                                                    DS21291F-page 51


MCP2510
counters are reset and deactivated in this state. The lis-           9.5       Normal Mode
ten-only mode is activated by setting the mode request
bits in the CANCTRL register.                                        This is the standard operating mode of the MCP2510.
                                                                     In this mode the device actively monitors all bus mes-
9.4        Loopback Mode                                             sages and generates acknowledge bits, error frames,
                                                                     etc. This is also the only mode in which the MCP2510
This mode will allow internal transmission of messages               will transmit messages over the CAN bus.
from the transmit buffers to the receive buffers without
actually transmitting messages on the CAN bus. This
mode can be used in system development and testing.
In this mode the ACK bit is ignored and the device will
allow incoming messages from itself just as if they were
coming from another node. The loopback mode is a
silent mode, meaning no messages will be transmitted
while in this state, including error flags or acknowledge
signals. The TXCAN pin will be in a reccessive state
while the device is in this mode. The filters and masks
can be used to allow only particular messages to be
loaded into the receive registers. The masks can be set
to all zeros to provide a mode that accepts all mes-
sages. The loopback mode is activated by setting the
mode request bits in the CANCTRL register.
REGISTER 9-1:             CANCTRL - CAN CONTROL REGISTER (ADDRESS: XFh)
                             R/W-1       R/W-1      R/W-1          R/W-0         U-0          R/W-1       R/W-1        R/W-1
                           REQOP2       REQOP1     REQOP0          ABAT           —           CLKEN     CLKPRE1 CLKPRE0
                          bit 7                                                                                            bit 0
            bit 7-5       REQOP<2:0>: Request Operation Mode
                          000 = Set Normal Operation Mode
                          001 = Set Sleep Mode
                          010 = Set Loopback Mode
                          011 = Set Listen Only Mode
                          100 = Set Configuration Mode
                          All other values for REQOP bits are invalid and should not be used
                             Note:     On power up, REQOP = b’111’
            bit 4         ABAT: Abort All Pending Transmissions
                          1 = Request abort of all pending transmit buffers
                          0 = Terminate request to abort all transmissions
            bit 3         Unimplemented: Read as '0'
            bit 2         CLKEN: CLKOUT Pin Enable
                          1 = CLKOUT pin enabled
                          0 = CLKOUT pin disabled (Pin is in high impedance state)
            bit 1-0       CLKPRE <1:0>: CLKOUT Pin Prescaler
                          00 = FCLKOUT = System Clock/1
                          01 = FCLKOUT = System Clock/2
                          10 = FCLKOUT = System Clock/4
                          11 = FCLKOUT = System Clock/8
                           Legend:
                           R = Readable bit            W = Writable bit         U = Unimplemented bit, read as ‘0’
                           -n = Value at POR           ’1’ = Bit is set         ’0’ = Bit is cleared     x = Bit is unknown
DS21291F-page 52                                                                                 © 2007 Microchip Technology Inc.


                                                                                          MCP2510
REGISTER 9-2:          CANSTAT - CAN STATUS REGISTER (ADDRESS: XEh)
                           R-1         R-0        R-0           U-0   R-0            R-0     R-0         U-0
                        OPMOD2 OPMOD1 OPMOD0                     —  ICOD2          ICOD1   ICOD0          —
                       bit 7                                                                               bit 0
          bit 7-5       OPMOD<2:0>: Operation Mode
                        000 = Device is in Normal Operation Mode
                        001 = Device is in Sleep Mode
                        010 = Device is in Loopback Mode
                        011 = Device is in Listen Only Mode
                        100 = Device is in Configuration Mode
          bit 4         Unimplemented: Read as '0'
          bit 3-1       ICOD<2:0>: Interrupt Flag Code
                        000 = No Interrupt
                        001 = Error Interrupt
                        010 = Wake Up Interrupt
                        011 = TXB0 Interrupt
                        100 = TXB1 Interrupt
                        101 = TXB2 Interrupt
                        110 = RXB0 Interrupt
                        111 = RXB1 Interrupt
          bit 0         Unimplemented: Read as '0'
                        Legend:
                        R = Readable bit           W = Writable bit  U = Unimplemented bit, read as ‘0’
                        -n = Value at POR          ’1’ = Bit is set  ’0’ = Bit is cleared x = Bit is unknown
© 2007 Microchip Technology Inc.                                                               DS21291F-page 53


MCP2510
NOTES:
DS21291F-page 54 © 2007 Microchip Technology Inc.


                                                                                                            MCP2510
10.0      REGISTER MAP                                                   writing of data. Some specific control and status regis-
                                                                         ters allow individual bit modification using the SPI Bit
The register map for the MCP2510 is shown in                             Modify command. The registers that allow this com-
Table 10-1. Address locations for each register are                      mand are shown as shaded locations in Table 10-1. A
determined by using the column (higher order 4 bits)                     summary of the MCP2510 control registers is shown in
and row (lower order 4 bits) values. The registers have                  Table 10-2.
been arranged to optimize the sequential reading and
TABLE 10-1:        CAN CONTROLLER REGISTER MAP
    Lower                                                   Higher Order Address Bits
  Address
     Bits      x000 xxxx       x001 xxxx       x010 xxxx      x0011 xxxx x100 xxxx x101 xxxx x110 xxxx x111 xxxx
    0000       RXF0SIDH        RXF3SIDH        RXM0SIDH        TXB0CTRL        TXB1CTRL      TXB2CTRL       RXB0CTRL        RXB1CTRL
    0001        RXF0SIDL        RXF3SIDL       RXM0SIDL        TXB0SIDH        TXB1SIDH       TXB2SIDH       RXB0SIDH       RXB1SIDH
    0010        RXF0EID8        RXF3EID8       RXM0EID8         TXB0SIDL       TXB1SIDL       TXB2SIDL       RXB0SIDL        RXB1SIDL
    0011        RXF0EID0        RXF3EID0       RXM0EID0         TXB0EID8       TXB1EID8       TXB2EID8       RXB0EID8        RXB1EID8
    0100       RXF1SIDH        RXF4SIDH        RXM1SIDH         TXB0EID0       TXB1EID0       TXB2EID0       RXB0EID0        RXB1EID0
    0101        RXF1SIDL        RXF4SIDL       RXM1SIDL         TXB0DLC         TXB1DLC       TXB2DLC         RXB0DLC        RXB1DLC
    0110        RXF1EID8        RXF4EID8       RXM1EID8          TXB0D0          TXB1D0        TXB2D0         RXB0D0          RXB1D0
    0111        RXF1EID0        RXF4EID0       RXM1EID0          TXB0D1          TXB1D1        TXB2D1         RXB0D1          RXB1D1
    1000       RXF2SIDH        RXF5SIDH           CNF3           TXB0D2          TXB1D2        TXB2D2         RXB0D2          RXB1D2
    1001        RXF2SIDL        RXF5SIDL          CNF2           TXB0D3          TXB1D3        TXB2D3         RXB0D3          RXB1D3
    1010        RXF2EID8        RXF5EID8          CNF1           TXB0D4          TXB1D4        TXB2D4         RXB0D4          RXB1D4
    1011        RXF2EID0        RXF5EID0        CANINTE          TXB0D5          TXB1D5        TXB2D5         RXB0D5          RXB1D5
    1100        BFPCTRL            TEC          CANINTF          TXB0D6          TXB1D6        TXB2D6         RXB0D6          RXB1D6
    1101      TXRTSCTRL            REC           EFLG            TXB0D7          TXB1D7        TXB2D7         RXB0D7          RXB1D7
    1110        CANSTAT         CANSTAT         CANSTAT         CANSTAT         CANSTAT       CANSTAT         CANSTAT        CANSTAT
    1111        CANCTRL         CANCTRL         CANCTRL         CANCTRL        CANCTRL        CANCTRL        CANCTRL         CANCTRL
  Note:     Shaded register locations indicate that these allow the user to manipulate individual bits using the ‘Bit Modify’ Command.
TABLE 10-2:        CONTROL REGISTER SUMMARY
   Register   Address                                                                                                         POR/RST
                            Bit 7        Bit 6       Bit 5        Bit 4       Bit 3      Bit 2        Bit 1       Bit 0
     Name       (Hex)                                                                                                          Value
  BFPCTRL        0C           —           —         B1BFS       B0BFS       B1BFE       B0BFE       B1BFM        B0BFM      --00 0000
 TXRTSCTRL       0D           —           —         B2RTS       B1RTS       B0RTS     B2RTSM       B1RTSM       B0RTSM --xx x000
  CANSTAT         xE     OPMOD2 OPMOD1 OPMOD0                      —        ICOD2       ICOD1       ICOD0           —       100- 000-
  CANCTRL         xF     REQOP2 REQOP1 REQOP0                    ABAT          —       CLKEN      CLKPRE1 CLKPRE0 1110 -111
      TEC        1C                                           Transmit Error Counter                                        0000 0000
     REC         1D                                           Receive Error Counter                                         0000 0000
     CNF3         28          —        WAKFIL         —            —           —     PHSEG22 PHSEG21 PHSEG20 -0-- -000
     CNF2         29    BTLMODE          SAM      PHSEG12 PHSEG11 PHSEG10 PRSEG2                   PRSEG1       PRSEG0 0000 0000
     CNF1        2A        SJW1         SJW0         BRP5        BRP4        BRP3        BRP2        BRP1         BRP0      0000 0000
   CANINTE       2B       MERRE        WAKIE        ERRIE        TX2IE       TX1IE      TX0IE        RX1IE       RX0IE      0000 0000
   CANINTF       2C       MERRF         WAKIF       ERRIF        TX2IF       TX1IF       TX0IF       RX1IF        RX0IF     0000 0000
     EFLG        2D      RX1OVR       RX0OVR        TXBO         TXEP        RXEP      TXWAR       RXWAR        EWARN       0000 0000
  TXB0CTRL        30          —         ABTF        MLOA        TXERR       TXREQ         —          TXP1         TXP0      -000 0-00
  TXB1CTRL        40          —         ABTF        MLOA        TXERR       TXREQ         —          TXP1         TXP0      -000 0-00
  TXB2CTRL        50          —         ABTF        MLOA        TXERR       TXREQ         —          TXP1         TXP0      -000 0-00
  RXB0CTRL        60          —         RXM1        RXM0           —        RXRTR        BUKT        BUKT       FILHIT0     -00- 0000
  RXB1CTRL        70          —         RSM1        RXM0           —        RXRTR      FILHIT2     FILHIT1      FILHIT0     -00- 0000
© 2007 Microchip Technology Inc.                                                                                     DS21291F-page 55


MCP2510
NOTES:
DS21291F-page 56 © 2007 Microchip Technology Inc.


                                                                                                MCP2510
11.0       SPI INTERFACE                                     11.5       Read Status Instruction
                                                             The Read Status Instruction allows single instruction
11.1       Overview
                                                             access to some of the often used status bits for mes-
The MCP2510 is designed to interface directly with the       sage reception and transmission.
Serial Peripheral Interface (SPI) port available on many     The part is selected by lowering the CS pin and the
microcontrollers and supports Mode 0,0 and Mode 1,1.         read status command byte, shown in Figure 11-6, is
Commands and data are sent to the device via the SI          sent to the MCP2510. After the command byte is sent,
pin, with data being clocked in on the rising edge of        the MCP2510 will return eight bits of data that contain
SCK. Data is driven out by the MCP2510, on the SO            the status. If additional clocks are sent after the first
line, on the falling edge of SCK. The CS pin must be         eight bits are transmitted, the MCP2510 will continue to
held low while any operation is performed. Table 11-1        output the status bits as long as the CS pin is held low
shows the instruction bytes for all operations. Refer to     and clocks are provided on SCK. Each status bit
Figure 11-8 and Figure 11-9 for detailed input and out-      returned in this command may also be read by using
put timing diagrams for both Mode 0,0 and Mode 1,1           the standard read command with the appropriate regis-
operation.                                                   ter address.
11.2       Read Instruction                                  11.6       Bit Modify Instruction
The Read Instruction is started by lowering the CS pin.      The Bit Modify Instruction provides a means for setting
The read instruction is then sent to the MCP2510 fol-        or clearing individual bits in specific status and control
lowed by the 8-bit address (A7 through A0). After the        registers. This command is not available for all regis-
read instruction and address are sent, the data stored       ters. See Section 10.0 (register map) to determine
in the register at the selected address will be shifted out  which registers allow the use of this command.
on the SO pin. The internal address pointer is automat-
ically incremented to the next address after each byte       The part is selected by lowering the CS pin and the Bit
of data is shifted out. Therefore it is possible to read the Modify command byte is then sent to the MCP2510.
next consecutive register address by continuing to pro-      After the command byte is sent, the address for the
vide clock pulses. Any number of consecutive register        register is sent followed by the mask byte and then the
locations can be read sequentially using this method.        data byte. The mask byte determines which bits in the
The read operation is terminated by raising the CS pin       register will be allowed to change. A ‘1’ in the mask byte
(Figure 11-2).                                               will allow a bit in the register to change and a ‘0’ will not.
                                                             The data byte determines what value the modified bits
11.3       Write Instruction                                 in the register will be changed to. A ‘1’ in the data byte
                                                             will set the bit and a ‘0’ will clear the bit, provided that
The Write Instruction is started by lowering the CS pin.     the mask for that bit is set to a ‘1’. (see Figure 11-1)
The write instruction is then sent to the MCP2510 fol-
lowed by the address and at least one byte of data. It is    11.7       Reset Instruction
possible to write to sequential registers by continuing to
clock in data bytes, as long as CS is held low. Data will    The Reset Instruction can be used to re-initialize the
actually be written to the register on the rising edge of    internal registers of the MCP2510 and set configuration
the SCK line for the D0 bit. If the CS line is brought high  mode. This command provides the same functionality,
before eight bits are loaded, the write will be aborted for  via the SPI interface, as the RESET pin. The Reset
that data byte, previous bytes in the command will have      instruction is a single byte instruction which requires
been written. Refer to the timing diagram in                 selecting the device by pulling CS low, sending the
Figure 11-3 for more detailed illustration of the byte       instruction byte, and then raising CS. It is highly recom-
write sequence.                                              mended that the reset command be sent (or the
                                                             RESET pin be lowered) as part of the power-on initial-
11.4       Request To Send (RTS) Instruction                 ization sequence. The MCP2510 will be held in reset
                                                             for 128 FOSC cycles.
The RTS command can be used to initiate message
transmission for one or more of the transmit buffers.
The part is selected by lowering the CS pin and the
RTS command byte is then sent to the MCP2510. As
shown in Figure 11-4, the last 3 bits of this command
indicate which transmit buffer(s) are enabled to send.
This command will set the TxBnCTRL.TXREQ bit for
the respective buffer(s). Any or all of the last three bits
can be set in a single command. If the RTS command
is sent with nnn = 000, the command will be ignored.
© 2007 Microchip Technology Inc.                                                                      DS21291F-page 57


MCP2510
FIGURE 11-1:             BIT MODIFY
            Mask byte 0 0 1 1 0 1 0 1
            Data byte X X 1 0 X 0 X 1
            Previous
            Register      0 1 0 1 0 0 0 1
            Contents
            Resulting
            Register 0 1 1 0 0 0 0 1
            Contents
TABLE 11-1:       SPI INSTRUCTION SET
 Instruction Name        Instruction Format                                              Description
       RESET                   1100 0000             Resets internal registers to default state, set configuration mode
        READ                   0000 0011             Read data from register beginning at selected address
       WRITE                   0000 0010             Write data to register beginning at selected address
         RTS                   1000 0nnn             Sets TXBnCTRL.TXREQ bit for one or more transmit buffers
 (Request To Send)
                                                                                      1000 0nnn
                                                                Request to send for TXB2                  Request to send for TXB0
                                                                                     Request to send for TXB1
    Read Status                1010 0000             Polling command that outputs status bits for transmit/receive functions
      Bit Modify               0000 0101             Bit modify selected registers
FIGURE 11-2:             READ INSTRUCTION
    CS
              0   1    2     3    4   5     6    7    8    9   10 11 12 13 14 15 16 17 18 19 20 21 22 23
   SCK
                        instruction                             address byte
      SI     0    0    0    0    0    0     1    1  A7    6    5   4    3    2     1   A0                don’t care
                                                                                                           data out
                                          high impedance
    SO                                                                                      7     6    5    4    3    2    1    0
FIGURE 11-3:             BYTE WRITE INSTRUCTION
  CS
           0    1   2     3    4    5    6     7   8    9 10 11 12 13 14 15 16 17 18 19                       20 21 22 23
 SCK
                     instruction                             address byte                              data byte
   SI      0    0   0    0     0    0   1     0   A7   6    5    4   3    2    1    A0   7    6     5    4    3    2    1    0
                                                          high impedance
  SO
DS21291F-page 58                                                                                         © 2007 Microchip Technology Inc.


                                                                                                             MCP2510
FIGURE 11-4:              REQUEST TO SEND INSTRUCTION
                                       CS
                                                 0    1    2     3   4    5   6   7
                                     SCK
                                                           instruction
                                        SI       1    0    0     0   0   T2 T1 T0
                                                           high impedance
                                       SO
FIGURE 11-5:              BIT MODIFY INSTRUCTION
         CS
               0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31
       SCK
                      instruction                address byte                mask byte               data byte
          SI   0 0 0 0 0 1 0 1 A7 6 5 4 3 2 1 A0 7 6 5 4 3 2 1 0 7 6 5 4 3 2 1 0
         SO                                                    high impedance
                Note:    Not all registers can be accessed with this command. See the register map in Section 10.0
                         for a list of the registers that apply.
FIGURE 11-6:              READ STATUS INSTRUCTION
     CS
              0    1    2     3     4    5    6    7     8   9    10 11 12 13 14 15 16 17 18 19 20 21 22 23
    SCK
                         instruction
      SI      1    0    1     0     0    0    0   0                                   don’t care
                                                                                                          repeat
                                                                    data out                             data out
                high impedance
     SO                                                7   6     5    4   3   2    1   0    7    6  5    4   3    2  1   0
                                                                                                CANINTF.RX0IF
                                                                                                CANINTF.RX1IF
                                                                                                TXB0CNTRL.TXREQ
                                                                                                CANINTF.TX0IF
                                                                                                TXB1CNTRL.TXREQ
                                                                                                CANINTF.TX1IF
                                                                                                TXB2CNTRL.TXREQ
                                                                                                CANINTF.TX2IF
© 2007 Microchip Technology Inc.                                                                                    DS21291F-page 59


MCP2510
FIGURE 11-7:          RESET INSTRUCTION
                                CS
                                      0    1    2    3    4 5   6 7
                               SCK
                                                instruction
                                 SI   1    1    0    0    0 0   0 0
                                                high impedance
                                SO
FIGURE 11-8:          SPI INPUT TIMING
                                                                                     3
        CS
                                                                                       11
                    1                         6                                     10
            Mode 1,1                                          7     2
       SCK Mode 0,0
                      4      5
         SI
                        MSB in                                        LSB in
        SO                          high impedance
FIGURE 11-9:          SPI OUTPUT TIMING
    CS
                                                                                         2
                         8        9
   SCK                                                                                           Mode 1,1
                                                                                                 Mode 0,0
                        12
                                                                                        14
                                                        13
    SO               MSB out                                                          LSB out
                                           don’t care
     SI
DS21291F-page 60                                                             © 2007 Microchip Technology Inc.


                                                                                                                                                 MCP2510
12.0       ELECTRICAL CHARACTERISTICS
12.1       Absolute Maximum Ratings†
VDD.............................................................................................................................................................................7.0V
All inputs and outputs w.r.t. VSS ..........................................................................................................-0.6V to VDD +1.0V
Storage temperature ...............................................................................................................................-65°C to +150°C
Ambient temp. with power applied ..........................................................................................................-65°C to +125°C
Soldering temperature of leads (10 seconds) ....................................................................................................... +300°C
ESD protection on all pins ......................................................................................................................................................≥ 4 kV
 † Notice: Stresses above those listed under “Maximum Ratings” may cause permanent damage to the device. This
 is a stress rating only and functional operation of the device at those or any other conditions above those indicated in
 the operational listings of this specification is not implied. Exposure to maximum rating conditions for extended peri-
 ods may affect device reliability.
© 2007 Microchip Technology Inc.                                                                                                                             DS21291F-page 61


MCP2510
TABLE 12-1:       DC CHARACTERISTICS
                                                       Industrial (I):     TAMB = -40°C to +85°C       VDD = 3.0V to 5.5V
 DC Characteristics
                                                       Extended (E):       TAMB = -40°C to +125°C      VDD = 4.5V to 5.5V
  Param.
   No.      Sym               Characteristic                Min          Max        Units                Conditions
             VDD     Supply Voltage                          3.0          5.5         V
            VRET     Register Retention Voltage              2.4           —          V
                     High Level Input Voltage                                               Note
             VIH     RXCAN                                    2         VDD+1         V
                     SCK, CS, SI, TXnRTS Pins             .7 VDD        VDD+1         V
                     OSC1                                .85 VDD         VDD          V
                     RESET                               .85 VDD         VDD          V
                     Low Level Input Voltage                                                Note
             VIL     RXCAN,TXnRTS Pins                      -0.3       .15 VDD        V
                     SCK, CS, SI                            -0.3          0.4         V
                     OSC1                                   VSS         .3 VDD        V
                     RESET                                  VSS        .15 VDD        V
                     Low Level Output Voltage
             VOL     TXCAN                                   —            0.6         V     IOL = -6.0 mA, VDD = 4.5V
                     RXnBF Pins                              —            0.6         V     IOL = -8.5 mA, VDD = 4.5V
                     SO, CLKOUT                              —            0.6         V     IOL = -2.1 mA, VDD = 4.5V
                     INT                                     —            0.6         V     IOL = -1.6 mA, VDD = 4.5V
                     High Level Output Voltage                                        V
             VOH     TXCAN, RXnBF Pins                   VDD -0.7          —          V     IOH = 3.0 mA, VDD = 4.5V, I temp
                     SO, CLKOUT                          VDD -0.5          —          V     IOH = 400 µA, VDD = 4.5V
                     INT                                 VDD -0.7          —          V     IOH = 1.0 mA, VDD = 4.5V
                     Input Leakage Current
              ILI    All I/O except OSC1 and                 -1           +1         µA     CS = RESET = VDD,
                     TXnRTS pins                                                            VIN = VSS to VDD
                     OSC1 Pin                                -5           +5         µA
            CINT     Internal Capacitance                    —             7         pF     TAMB = 25°C, fC = 1.0 MHz,
                     (All Inputs And Outputs)                                               VDD = 5.0V (Note)
             IDD     Operating Current                       —            10         mA     VDD = 5.5V, FOSC = 25 MHz,
                                                                                            FCLK = 1 MHz, SO = Open
            IDDS     Standby Current (Sleep Mode)            —             5         µA     CS, TXnRTS = VDD, Inputs tied to
                                                                                            VDD or VSS
  Note:   This parameter is periodically sampled and not 100% tested.
DS21291F-page 62                                                                                © 2007 Microchip Technology Inc.


                                                                                                       MCP2510
TABLE 12-2:          OSCILLATOR TIMING CHARACTERISTICS
                                                          Industrial (I):   TAMB = -40°C to +85°C      VDD = 3.0V to 5.5V
 Oscillator Timing Characteristics
                                                          Extended (E):     TAMB = -40°C to +125°C     VDD = 4.5V to 5.5V
  Param.         Sym             Characteristic               Min         Max        Units                Conditions
   No.
                FOSC    Clock In Frequency                      1          25        MHz     4.5V to 5.5V
                                                                1          16        MHz     3.0V to 4.5V
                TOSC    Clock In Period                        40         1000        ns     4.5V to 5.5V
                                                              62.5        1000        ns     3.0V to 4.5V
                TDUTY   Duty Cycle (External Clock            0.45        0.55        —      TOSH / (TOSH + TOSL)
                        Input)
  Note:      This parameter is periodically sampled and not 100% tested.
TABLE 12-3:          CAN INTERFACE AC CHARACTERISTICS
                                                          Industrial (I):   TAMB = -40°C to +85°C      VDD = 3.0V to 5.5V
 CAN Interface AC Characteristics
                                                          Extended (E):     TAMB = -40°C to +125°C     VDD = 4.5V to 5.5V
  Param.         Sym             Characteristic               Min         Max        Units                Conditions
   No.
                 TWF    Wakeup Noise Filter                    50           —         ns
                TDCLK   CLOCKOUT Propagation                   —           100        ns
                        Delay
TABLE 12-4:          CLKOUT PIN AC/DC CHARACTERISTICS
                                                          Industrial (I):   TAMB = -40°C to +85°C      VDD = 3.0V to 5.5V
 CLKOUT Pin AC/DC Characteristics
                                                          Extended (E):     TAMB = -40°C to +125°C     VDD = 4.5V to 5.5V
  Param.         Sym             Characteristic               Min         Max        Units                Conditions
   No.
             thCLKOUT   CLKOUT Pin High Time                   15           —         ns     TOSC = 40 ns (Note)
              tlCLKOUT  CLKOUT Pin Low Time                    15           —         ns     TOSC = 40 ns (Note)
              trCLKOUT  CLKOUT Pin Rise Time                   —            5         ns     Measured from 0.3 VDD to 0.7 VDD
                                                                                             (Note)
              tfCLKOUT  CLKOUT Pin Fall Time                   —            5         ns     Measured from 0.7 VDD to 0.3 VDD
                                                                                             (Note)
             tdCLKOUT   CLOCKOUT Propagation Delay             —           100        ns
  Note:      CLKOUT prescaler set to divide by one.
© 2007 Microchip Technology Inc.                                                                              DS21291F-page 63


MCP2510
TABLE 12-5:         SPI INTERFACE AC CHARACTERISTICS
                                                    Industrial (I):  TAMB = -40°C to +85°C     VDD = 3.0V to 5.5V
 SPI Interface AC Characteristics
                                                    Extended (E):    TAMB = -40°C to +125°C    VDD = 4.5V to 5.5V
  Param.
               Sym               Characteristic        Min          Max       Units               Conditions
   No.
               FCLK     Clock Frequency                  —            5        MHz    VDD = 4.5V to 5.5V
                                                         —            4        MHz    VDD = 4.5V to 5.5V (E temp)
                                                         —          2.5        MHz    VDD = 3.0V to 4.5V
     1         TCSS     CS Setup Time                   100          —          ns
     2         TCSH     CS Hold Time                    100          —          ns    VDD = 4.5V to 5.5V
                                                        115          —          ns    VDD = 4.5V to 5.5V (E temp)
                                                        180          —          ns    VDD = 3.0V to 4.5V
     3         TCSD     CS Disable Time                 100          —          ns    VDD = 4.5V to 5.5V
                                                        100          —          ns    VDD = 4.5V to 5.5V (E temp)
                                                        280          —          ns    VDD = 3.0V to 4.5V
     4          TSU     Data Setup Time                  20          —          ns    VDD = 4.5V to 5.5V
                                                        20           —          ns    VDD = 4.5V to 5.5V (E temp)
                                                        30           —          ns    VDD = 3.0V to 4.5V
     5          THD     Data Hold Time                   20          —          ns    VDD = 4.5V to 5.5V
                                                        20           —          ns    VDD = 4.5V to 5.5V (E temp)
                                                        50           —          ns    VDD = 3.0V to 4.5V
     6           TR     CLK Rise Time                    —            2         µs    Note
     7           TF     CLK Fall Time                    —            2         µs    Note
     8          THI     Clock High Time                 90           —          ns    VDD = 4.5V to 5.5V
                                                        115          —          ns    VDD = 4.5V to 5.5V (E temp)
                                                        180          —          ns    VDD = 3.0V to 4.5V
     9          TLO     Clock Low Time                  90           —          ns    VDD = 4.5V to 5.5V
                                                        115          —          ns    VDD = 4.5V to 5.5V (E temp)
                                                        180          —          ns    VDD = 3.0V to 4.5V
    10         TCLD     Clock Delay Time                 50          —          ns
    11         TCLE     Clock Enable Time               50           —          ns
    12           TV     Output Valid from Clock Low      —           90         ns    VDD = 4.5V to 5.5V
                                                         —          115         ns    VDD = 4.5V to 5.5V (E temp)
                                                         —          180         ns    VDD = 3.0V to 4.5V
    13          THO     Output Hold Time                  0          —          ns    Note
    14         TDIS     Output Disable Time              —          200         ns    Note
  Note:      This parameter is not 100% tested.
DS21291F-page 64                                                                         © 2007 Microchip Technology Inc.


                                                                                              MCP2510
13.0    PACKAGING INFORMATION
13.1    Package Marking Information
         18-Lead PDIP (300 mil)                                          Example:
                 XXXXXXXXXXXXXXXXX                                                 MCP2510-I/P e3
                 XXXXXXXXXXXXXXXXX                                              XXXXXXXXXXXXXXXXX
                        YYWWNNN                                                       0726NNN
         18-Lead SOIC (300 mil)                                          Example:
                XXXXXXXXXXXX                                                    MCP2510-I/SO e3
                XXXXXXXXXXXX                                                    XXXXXXXXXXXX
                XXXXXXXXXXXX                                                    XXXXXXXXXXXX
                       YYWWNNN                                                       0737NNN
         20-Lead TSSOP (4.4 mm)                                          Example:
                  XXXXXXXX                                                        MCP2510 e3
                  XXXXXNNN                                                        I/STNNN
                      YYWW                                                           0728
                Legend: XX...X       Customer-specific information
                            Y        Year code (last digit of calendar year)
                            YY       Year code (last 2 digits of calendar year)
                            WW       Week code (week of January 1 is week ‘01’)
                            NNN      Alphanumeric traceability code
                             e3      Pb-free JEDEC designator for Matte Tin (Sn)
                            *        This package is Pb-free. The Pb-free JEDEC designator ( e3 )
                                     can be found on the outer packaging for this package.
                Note:    In the event the full Microchip part number cannot be marked on one line, it will
                         be carried over to the next line, thus limiting the number of available
                         characters for customer-specific information.
© 2007 Microchip Technology Inc.                                                                       DS21291F-page 65


MCP2510
18-Lead Plastic Dual In-Line (P) – 300 mil Body [PDIP]
   Note:     For the most current package drawings, please see the Microchip Packaging Specification located at
             http://www.microchip.com/packaging
                        N
    NOTE 1
                                                                           E1
                        1    2     3
                                             D
                                                                                                      E
       A                                                                   A2
                                                                                  L                                    c
              A1
                                 b1
                               b                                 e                                    eB
                                                                Units                 INCHES
                                                    Dimension Limits        MIN         NOM            MAX
                    Number of Pins                                N                      18
                    Pitch                                         e                  .100 BSC
                    Top to Seating Plane                          A           –           –            .210
                    Molded Package Thickness                     A2         .115        .130           .195
                    Base to Seating Plane                        A1        .015           –              –
                    Shoulder to Shoulder Width                    E        .300         .310           .325
                    Molded Package Width                         E1        .240         .250           .280
                    Overall Length                                D        .880         .900           .920
                    Tip to Seating Plane                          L         .115        .130           .150
                    Lead Thickness                                c        .008         .010           .014
                    Upper Lead Width                             b1        .045         .060           .070
                    Lower Lead Width                              b        .014         .018           .022
                    Overall Row Spacing §                        eB           –           –            .430
Notes:
1. Pin 1 visual index feature may vary, but must be located within the hatched area.
2. § Significant Characteristic.
3. Dimensions D and E1 do not include mold flash or protrusions. Mold flash or protrusions shall not exceed .010" per side.
4. Dimensioning and tolerancing per ASME Y14.5M.
       BSC: Basic Dimension. Theoretically exact value shown without tolerances.
                                                                                          Microchip Technology Drawing C04-007B
DS21291F-page 66                                                                                  © 2007 Microchip Technology Inc.


                                                                                                         MCP2510
18-Lead Plastic Small Outline (SO) – Wide, 7.50 mm Body [SOIC]
   Note:     For the most current package drawings, please see the Microchip Packaging Specification located at
             http://www.microchip.com/packaging
                                          D
                              N
                                                               E
                                                           E1
                  NOTE 1
                               1  2 3
                                                     e
                                    b
                                                       α
                                                                                           h
                                                                                  h
                                                                                                                 c
                                                                      φ
                    A                                          A2
                                                                                              β
                      A1                                                     L
                                                                                   L1
                                                                Units                MILLMETERS
                                                    Dimension Limits        MIN          NOM           MAX
                    Number of Pins                                N                       18
                    Pitch                                          e                   1.27 BSC
                    Overall Height                                A          –             –           2.65
                    Molded Package Thickness                     A2        2.05            –             –
                    Standoff §                                   A1        0.10            –           0.30
                    Overall Width                                 E                   10.30 BSC
                    Molded Package Width                         E1                    7.50 BSC
                    Overall Length                                D                   11.55 BSC
                    Chamfer (optional)                             h       0.25            –           0.75
                    Foot Length                                    L       0.40            –           1.27
                    Footprint                                     L1                   1.40 REF
                    Foot Angle                                     φ         0°            –            8°
                    Lead Thickness                                 c       0.20            –           0.33
                    Lead Width                                     b       0.31            –           0.51
                    Mold Draft Angle Top                          α          5°            –            15°
                    Mold Draft Angle Bottom                        β         5°            –            15°
Notes:
1. Pin 1 visual index feature may vary, but must be located within the hatched area.
2. § Significant Characteristic.
3. Dimensions D and E1 do not include mold flash or protrusions. Mold flash or protrusions shall not exceed 0.15 mm per side.
4. Dimensioning and tolerancing per ASME Y14.5M.
       BSC: Basic Dimension. Theoretically exact value shown without tolerances.
       REF: Reference Dimension, usually without tolerance, for information purposes only.
                                                                                           Microchip Technology Drawing C04-051B
© 2007 Microchip Technology Inc.                                                                               DS21291F-page 67


MCP2510
20-Lead Plastic Thin Shrink Small Outline (ST) – 4.4 mm Body [TSSOP]
   Note:     For the most current package drawings, please see the Microchip Packaging Specification located at
             http://www.microchip.com/packaging
                                         D
                          N
                                                                    E
                                                             E1
           NOTE 1
                          1 2
                                b                             e
                                                                         c                                         φ
               A                                              A2
                 A1                                                               L1                                  L
                                                                Units               MILLIMETERS
                                                    Dimension Limits        MIN         NOM            MAX
                    Number of Pins                                N                       20
                    Pitch                                         e                   0.65 BSC
                    Overall Height                                A          –             –           1.20
                    Molded Package Thickness                     A2        0.80          1.00          1.05
                    Standoff                                     A1        0.05            –           0.15
                    Overall Width                                 E                   6.40 BSC
                    Molded Package Width                         E1        4.30          4.40          4.50
                    Molded Package Length                         D        6.40          6.50          6.60
                    Foot Length                                   L        0.45          0.60          0.75
                    Footprint                                    L1                   1.00 REF
                    Foot Angle                                    φ          0°            –            8°
                    Lead Thickness                                c        0.09            –           0.20
                    Lead Width                                    b        0.19            –           0.30
Notes:
1. Pin 1 visual index feature may vary, but must be located within the hatched area.
2. Dimensions D and E1 do not include mold flash or protrusions. Mold flash or protrusions shall not exceed 0.15 mm per side.
3. Dimensioning and tolerancing per ASME Y14.5M.
       BSC: Basic Dimension. Theoretically exact value shown without tolerances.
       REF: Reference Dimension, usually without tolerance, for information purposes only.
                                                                                           Microchip Technology Drawing C04-088B
DS21291F-page 68                                                                                  © 2007 Microchip Technology Inc.


                                                MCP2510
APPENDIX A:            REVISION HISTORY
Revision F (January 2007)
This revision includes updates to the packaging
diagrams.
© 2007 Microchip Technology Inc.                  DS21291F-page 69


NOTES:
DS21291F-page 70 © 2007 Microchip Technology Inc.


                                                                                                                                            MCP2510
INDEX                                                                                        Interrupts . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 45
                                                                                             L
A
                                                                                             Lenghtening a Bit Period . . . . . . . . . . . . . . . . . . . . . . . . . 37
Acknowledge Error . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 41
                                                                                             Listen Only Mode . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 51
B                                                                                            Loopback Mode . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 52
BFpctrl - RXnBF Pin Control and Status Register . . . . . . . 26
                                                                                             M
Bit Error . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 41
                                                                                             Maximum Ratings . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .         61
BIT Modify instruction . . . . . . . . . . . . . . . . . . . . . . . . . . . . 59
Bit Modify Instruction . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 57          Message Acceptance Filter . . . . . . . . . . . . . . . . . . . . . . .               30
                                                                                             Message Acceptance Filters and Masks . . . . . . . . . . . . .                        29
Bit Timing . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 35
                                                                                             Message Reception . . . . . . . . . . . . . . . . . . . . . . . . . . . . .           21
Bit Timing Configuration Registers . . . . . . . . . . . . . . . . . . 39
Bit Timing Logic . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6       Message Reception Flowchart . . . . . . . . . . . . . . . . . . . . .                 23
                                                                                             Modes of Operation . . . . . . . . . . . . . . . . . . . . . . . . . . . . .          51
Bus Activity Wakeup Interrupt . . . . . . . . . . . . . . . . . . . . . . 45
Bus Off . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 46   N
Byte Write instruction . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 58          Normal Mode . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 52
C                                                                                            O
CAN Buffers and Protocol Engine Block Diagram . . . . . . . . 5                              Oscillator . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 49
CAN controller Register Map . . . . . . . . . . . . . . . . . . . . . . . 55                 Oscillator Tolerance . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 38
CAN Interface AC characteristics . . . . . . . . . . . . . . . . . . . 63                    Overload Frame . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 8
CAN Protocol Engine . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6            Overview . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 3
CAN Protocol Engine Block Diagram . . . . . . . . . . . . . . . . . 6
                                                                                             P
CANCTRL - CAN Control Register . . . . . . . . . . . . . . . . . . 52
CANINTE - Interrupt Enable Register . . . . . . . . . . . . . . . . 47                       Package Types . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1
CANSTAT - CAN Status Register . . . . . . . . . . . . . . . . . . . 53                       Packaging Information . . . . . . . . . . . . . . . . . . . . . . . . . . . 65
CNF1 - Configuration Register1 . . . . . . . . . . . . . . . . . . . . 39                    Phase Buffer Segments . . . . . . . . . . . . . . . . . . . . . . . . . . 36
CNF2 - Configuration Register2 . . . . . . . . . . . . . . . . . . . . 40                    Programming Time Segments . . . . . . . . . . . . . . . . . . . . . 38
CNF3 - Configuration Register3 . . . . . . . . . . . . . . . . . . . . 40                    Propagation Segment . . . . . . . . . . . . . . . . . . . . . . . . . . . . 36
Configuration Mode . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 51            Protocol Finite State Machine . . . . . . . . . . . . . . . . . . . . . . 6
CRC Error . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 41       R
Crystal/ceramic resonator operation . . . . . . . . . . . . . . . . . 49
                                                                                             Read Instruction . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 57
Cyclic Redundancy Check . . . . . . . . . . . . . . . . . . . . . . . . . . 6
                                                                                             Read instruction Diagram . . . . . . . . . . . . . . . . . . . . . . . . . 58
D                                                                                            Read Status Instruction . . . . . . . . . . . . . . . . . . . . . . . . . . 57
DC Characteristics . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 62          Read Status instruction . . . . . . . . . . . . . . . . . . . . . . . . . . 59
Description . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1    REC - Receiver Error Count . . . . . . . . . . . . . . . . . . . . . . . 42
Device Functionality . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 5         Receive Buffers . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 21
                                                                                             Receive Buffers Diagram . . . . . . . . . . . . . . . . . . . . . . . . . 22
E
                                                                                             Receive Interrupt . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 45
EFLG - Error Flag Register . . . . . . . . . . . . . . . . . . . . . . . . 43                Receive Message Buffering . . . . . . . . . . . . . . . . . . . . . . . 21
Electrical Characteristics . . . . . . . . . . . . . . . . . . . . . . . . . . 61            Receiver Error Passive . . . . . . . . . . . . . . . . . . . . . . . . . . . 46
Errata . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 2 Receiver Overrun . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 46
Error Detection . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 41       Receiver Warning . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 46
Error Frame . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 7, 13          Register Map . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 55
Error Interrupt . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 46       Remote Frame . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 7
Error Management Logic . . . . . . . . . . . . . . . . . . . . . . . . . . . 6               Request To Send (RTS) Instruction . . . . . . . . . . . . . . 57, 59
Error Modes . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 42       Resynchronization . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 37
Error Modes and Error Counters . . . . . . . . . . . . . . . . . . . . 41                    RXB0BF and RXB1BF Pins . . . . . . . . . . . . . . . . . . . . . . . 21
Error States . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 41      RXB0CTRL - Receive Buffer 0 Control Register . . . . . . . 24
Extended Data Frame . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 7              RXB1CTRL - Receive Buffer 1 Control Register . . . . . . . 25
External Clock (osc1) Timing characteristics . . . . . . . . . . . 63                        RXBnDLC - Receive Buffer n Data Length Code . . . . . . . 28
External Clock Source . . . . . . . . . . . . . . . . . . . . . . . . . . . . 49             RXBnDm - Receive Buffer n Data Field Byte m . . . . . . . . 28
External Series Resonant Crystal Oscillator Circuit . . . . . . 50                           RXBnEID0 - Receive Buffer n Extended Identifier Low . . 28
F                                                                                            RXBnEID8 - Receive Buffer n Extended Identifier Mid . . 27
                                                                                             RXBnSIDH - Receive Buffer n Standard Identifier High . . 26
Features . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1
Filter/Mask Truth Table . . . . . . . . . . . . . . . . . . . . . . . . . . . 29             RXBnSIDL - Receive Buffer n Standard Identifier Low . . 27
                                                                                             RXFnEID0 - Acceptance Filter n Extended Identifier Low 32
Form Error . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 41
                                                                                             RXFnEID8 - Acceptance Filter n Extended Identifier Mid 31
Frame Types . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 7
                                                                                             RXFnSIDH - Acceptance Filter n Standard Identifier High 30
H                                                                                            RXFnSIDL - Acceptance Filter n Standard Identifier Low 31
Hard Synchronization . . . . . . . . . . . . . . . . . . . . . . . . . . . . 37              RXMnEID0 - Acceptance Filter Mask n Extended Identifier
                                                                                                   Low . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 33
I
                                                                                             RXMnEID8 - Acceptance Filter Mask n Extended Identifier
Information Processing Time . . . . . . . . . . . . . . . . . . . . . . . 36
                                                                                                   Mid . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 33
Initiating Message Transmission . . . . . . . . . . . . . . . . . . . . 15
                                                                                             RXMnSIDH - Acceptance Filter Mask n Standard Identifier
Interframe Space . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 8
                                                                                                   High . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 32
Interrupt Acknowledge . . . . . . . . . . . . . . . . . . . . . . . . . . . . 46
© 2007 Microchip Technology Inc.                                                                                                                        DS21291F-page 71


MCP2510
RXMnSIDL - Acceptance Filter Mask n Standard Identifier
      Low . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 32
S
Sample Point . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 36
Shortening a Bit Period . . . . . . . . . . . . . . . . . . . . . . . . . . . 38
Sleep Mode . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 51
SPI Interface . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 57
SPI Interface Overview . . . . . . . . . . . . . . . . . . . . . . . . . . . 57
SPI Port AC Characteristics . . . . . . . . . . . . . . . . . . . . . . . . 64
Standard Data Frame . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 7
Stuff Error . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 41
Synchronization . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 37
Synchronization Rules . . . . . . . . . . . . . . . . . . . . . . . . . . . . 37
Synchronization Segment . . . . . . . . . . . . . . . . . . . . . . . . . 36
T
TEC - Transmitter Error Count . . . . . . . . . . . . . . . . . . . . . . 42
Time Quanta . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 36
Transmit Interrupt . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 45
Transmit Message Aborting . . . . . . . . . . . . . . . . . . . . . . . . 15
Transmit Message Buffering . . . . . . . . . . . . . . . . . . . . . . . 15
Transmit Message Buffers . . . . . . . . . . . . . . . . . . . . . . . . . 15
Transmit Message flowchart . . . . . . . . . . . . . . . . . . . . . . . 16
Transmit Message Priority . . . . . . . . . . . . . . . . . . . . . . . . . 15
Transmitter Error Passive . . . . . . . . . . . . . . . . . . . . . . . . . 46
Transmitter Warning . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 46
TXBnCTRL Transmit buffer n Control Register . . . . . . . . . 17
TXBnDm - Transmit Buffer n Data Field Byte m . . . . . . . . 20
TXBnEID0 - Transmit Buffer n Extended Identifier Low . . 20
TXBnEID8 - Transmit Buffer n Extended Identifier Mid . . . 19
TXBnEIDH - Transmit Buffer n Extended Identifier High . . 19
TXBnSIDH - Transmit Buffer n Standard Identifier High . . 18
TXBnSIDL - Transmit Buffer n Standard Identifier Low . . . 19
TXnRTS Pins . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 15
TXRTSCTRL - TXBNRTS Pin Control and Status Register .
      18
Typical System Implementation . . . . . . . . . . . . . . . . . . . . . . 4
W
WAKE-up functions . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 51
Write Instruction . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 57
WWW, On-Line Support . . . . . . . . . . . . . . . . . . . . . . . . . . . 2
DS21291F-page 72                                                                         © 2007 Microchip Technology Inc.


                                                                                           MCP2510
THE MICROCHIP WEB SITE                                      CUSTOMER SUPPORT
Microchip provides online support via our WWW site at       Users of Microchip products can receive assistance
www.microchip.com. This web site is used as a means         through several channels:
to make files and information easily available to           •  Distributor or Representative
customers. Accessible by using your favorite Internet
                                                            •  Local Sales Office
browser, the web site contains the following
information:                                                •  Field Application Engineer (FAE)
                                                            •  Technical Support
• Product Support – Data sheets and errata,
   application notes and sample programs, design            •  Development Systems Information Line
   resources, user’s guides and hardware support            Customers       should    contact    their  distributor,
   documents, latest software releases and archived         representative or field application engineer (FAE) for
   software                                                 support. Local sales offices are also available to help
• General Technical Support – Frequently Asked              customers. A listing of sales offices and locations is
   Questions (FAQ), technical support requests,             included in the back of this document.
   online discussion groups, Microchip consultant           Technical support is available through the web site
   program member listing                                   at: http://support.microchip.com
• Business of Microchip – Product selector and
   ordering guides, latest Microchip press releases,
   listing of seminars and events, listings of
   Microchip sales offices, distributors and factory
   representatives
CUSTOMER CHANGE NOTIFICATION
SERVICE
Microchip’s customer notification service helps keep
customers current on Microchip products. Subscribers
will receive e-mail notification whenever there are
changes, updates, revisions or errata related to a
specified product family or development tool of interest.
To register, access the Microchip web site at
www.microchip.com, click on Customer Change
Notification and follow the registration instructions.
© 2007 Microchip Technology Inc.               Advance Information                                DS21291F-page 73


MCP2510
READER RESPONSE
It is our intention to provide you with the best documentation possible to ensure successful use of your Microchip prod-
uct. If you wish to provide your comments on organization, clarity, subject matter, and ways in which our documentation
can better serve you, please FAX your comments to the Technical Publications Manager at (480) 792-4150.
Please list the following information, and use this outline to provide us with your comments about this document.
      To:     Technical Publications Manager                                 Total Pages Sent ________
      RE:     Reader Response
      From: Name
              Company
              Address
              City / State / ZIP / Country
              Telephone: (_______) _________ - _________                  FAX: (______) _________ - _________
      Application (optional):
      Would you like a reply?       Y      N
      Device: MCP2510                             Literature Number: DS21291F
      Questions:
      1. What are the best features of this document?
      2. How does this document meet your hardware and software development needs?
      3. Do you find the organization of this document easy to follow? If not, why?
      4. What additions to the document do you think would enhance the structure and subject?
      5. What deletions from the document could be made without affecting the overall usefulness?
      6. Is there any incorrect or misleading information (what and where)?
      7. How would you improve this document?
DS21291F-page 74                               Advance Information                        © 2007 Microchip Technology Inc.


                                                                                                                  MCP2510
PRODUCT IDENTIFICATION SYSTEM
To order or obtain information, e.g., on pricing or delivery, refer to the factory or the listed sales office.
       PART NO.            X               /XX                                          Examples:
                                                                                        a)     MCP2510-E/P:       Extended     temperature,
         Device       Temperature       Package
                                                                                               PDIP package.
                         Range
                                                                                        b)     MCP2510-I/P:       Industrial   temperature,
                                                                                               PDIP package.
  Device:               MCP2510:       CAN Controller w/SPI Interface                   c)     MCP2510-E/SO:      Extended     temperature,
                        MCP2510T:      CAN Controller w/SPI Interface                          SOIC package.
                                      (Tape and Reel)                                   d)     MCP2510-I/SO:      Industrial   temperature,
                                                                                               SOIC package.
  Temperature Range:    -    = -40°C to +85°C                                           e)     MCP2510-I/SO:      Tape and Reel, Industrial
                        E    = -40°C to +125°C                                                 temperature, SOIC package.
                                                                                        f)     MCP2510I/ST:       Industrial   temperature,
  Package:              P    = Plastic DIP (300 mil Body), 18-Lead                             TSSOP package.
                        SO = Plastic SOIC (300 mil Body), 18-Lead                       g)     MCP2510T-I/ST:     Tape and Reel, Industrial
                        ST = TSSOP, (4.4 mm Body), 20-Lead                                     temperature, TSSOP package.
© 2007 Microchip Technology Inc.                                                                                             DS21291F-page75


MCP2510
NOTES:
DS21291F-page 76 © 2007 Microchip Technology Inc.


 Note the following details of the code protection feature on Microchip devices:
 •     Microchip products meet the specification contained in their particular Microchip Data Sheet.
 •     Microchip believes that its family of products is one of the most secure families of its kind on the market today, when used in the
       intended manner and under normal conditions.
 •     There are dishonest and possibly illegal methods used to breach the code protection feature. All of these methods, to our
       knowledge, require using the Microchip products in a manner outside the operating specifications contained in Microchip’s Data
       Sheets. Most likely, the person doing so is engaged in theft of intellectual property.
 •     Microchip is willing to work with the customer who is concerned about the integrity of their code.
 •     Neither Microchip nor any other semiconductor manufacturer can guarantee the security of their code. Code protection does not
       mean that we are guaranteeing the product as “unbreakable.”
 Code protection is constantly evolving. We at Microchip are committed to continuously improving the code protection features of our
 products. Attempts to break Microchip’s code protection feature may be a violation of the Digital Millennium Copyright Act. If such acts
 allow unauthorized access to your software or other copyrighted work, you may have a right to sue for relief under that Act.
Information contained in this publication regarding device                  Trademarks
applications and the like is provided only for your convenience
                                                                            The Microchip name and logo, the Microchip logo, Accuron,
and may be superseded by updates. It is your responsibility to
                                                                            dsPIC, KEELOQ, microID, MPLAB, PIC, PICmicro, PICSTART,
ensure that your application meets with your specifications.
                                                                            PRO MATE, PowerSmart, rfPIC, and SmartShunt are
MICROCHIP MAKES NO REPRESENTATIONS OR
                                                                            registered trademarks of Microchip Technology Incorporated
WARRANTIES OF ANY KIND WHETHER EXPRESS OR
                                                                            in the U.S.A. and other countries.
IMPLIED, WRITTEN OR ORAL, STATUTORY OR
OTHERWISE, RELATED TO THE INFORMATION,                                      AmpLab, FilterLab, Migratable Memory, MXDEV, MXLAB,
INCLUDING BUT NOT LIMITED TO ITS CONDITION,                                 SEEVAL, SmartSensor and The Embedded Control Solutions
QUALITY, PERFORMANCE, MERCHANTABILITY OR                                    Company are registered trademarks of Microchip Technology
FITNESS FOR PURPOSE. Microchip disclaims all liability                      Incorporated in the U.S.A.
arising from this information and its use. Use of Microchip                 Analog-for-the-Digital Age, Application Maestro, CodeGuard,
devices in life support and/or safety applications is entirely at           dsPICDEM, dsPICDEM.net, dsPICworks, ECAN,
the buyer’s risk, and the buyer agrees to defend, indemnify and             ECONOMONITOR, FanSense, FlexROM, fuzzyLAB,
hold harmless Microchip from any and all damages, claims,                   In-Circuit Serial Programming, ICSP, ICEPIC, Linear Active
suits, or expenses resulting from such use. No licenses are                 Thermistor, Mindi, MiWi, MPASM, MPLIB, MPLINK, PICkit,
conveyed, implicitly or otherwise, under any Microchip                      PICDEM, PICDEM.net, PICLAB, PICtail, PowerCal,
intellectual property rights.                                               PowerInfo, PowerMate, PowerTool, REAL ICE, rfLAB,
                                                                            rfPICDEM, Select Mode, Smart Serial, SmartTel, Total
                                                                            Endurance, UNI/O, WiperLock and ZENA are trademarks of
                                                                            Microchip Technology Incorporated in the U.S.A. and other
                                                                            countries.
                                                                            SQTP is a service mark of Microchip Technology Incorporated
                                                                            in the U.S.A.
                                                                            All other trademarks mentioned herein are property of their
                                                                            respective companies.
                                                                            © 2007, Microchip Technology Incorporated, Printed in the
                                                                            U.S.A., All Rights Reserved.
                                                                                 Printed on recycled paper.
                                                                            Microchip received ISO/TS-16949:2002 certification for its worldwide
                                                                            headquarters, design and wafer fabrication facilities in Chandler and
                                                                            Tempe, Arizona, Gresham, Oregon and Mountain View, California. The
                                                                            Company’s quality system processes and procedures are for its PIC®
                                                                            MCUs and dsPIC DSCs, KEELOQ® code hopping devices, Serial
                                                                            EEPROMs, microperipherals, nonvolatile memory and analog
                                                                            products. In addition, Microchip’s quality system for the design and
                                                                            manufacture of development systems is ISO 9001:2000 certified.
© 2007 Microchip Technology Inc.                                                                                             DS21291F-page 77


                             WORLDWIDE SALES AND SERVICE
AMERICAS                      ASIA/PACIFIC               ASIA/PACIFIC              EUROPE
Corporate Office              Asia Pacific Office        India - Bangalore         Austria - Wels
2355 West Chandler Blvd.      Suites 3707-14, 37th Floor Tel: 91-80-4182-8400      Tel: 43-7242-2244-39
Chandler, AZ 85224-6199       Tower 6, The Gateway       Fax: 91-80-4182-8422      Fax: 43-7242-2244-393
Tel: 480-792-7200             Habour City, Kowloon                                 Denmark - Copenhagen
                                                         India - New Delhi
Fax: 480-792-7277             Hong Kong                                            Tel: 45-4450-2828
                                                         Tel: 91-11-4160-8631
Technical Support:            Tel: 852-2401-1200                                   Fax: 45-4485-2829
                                                         Fax: 91-11-4160-8632
http://support.microchip.com  Fax: 852-2401-3431
                                                         India - Pune              France - Paris
Web Address:
                              Australia - Sydney         Tel: 91-20-2566-1512      Tel: 33-1-69-53-63-20
www.microchip.com
                              Tel: 61-2-9868-6733        Fax: 91-20-2566-1513      Fax: 33-1-69-30-90-79
Atlanta                       Fax: 61-2-9868-6755
                                                         Japan - Yokohama          Germany - Munich
Duluth, GA
                              China - Beijing                                      Tel: 49-89-627-144-0
Tel: 678-957-9614                                        Tel: 81-45-471- 6166
                              Tel: 86-10-8528-2100                                 Fax: 49-89-627-144-44
Fax: 678-957-1455                                        Fax: 81-45-471-6122
                              Fax: 86-10-8528-2104                                 Italy - Milan
Boston                                                   Korea - Gumi
                              China - Chengdu                                      Tel: 39-0331-742611
Westborough, MA                                          Tel: 82-54-473-4301
                              Tel: 86-28-8665-5511                                 Fax: 39-0331-466781
Tel: 774-760-0087                                        Fax: 82-54-473-4302
                              Fax: 86-28-8665-7889                                 Netherlands - Drunen
Fax: 774-760-0088                                        Korea - Seoul
                              China - Fuzhou             Tel: 82-2-554-7200        Tel: 31-416-690399
Chicago
                              Tel: 86-591-8750-3506      Fax: 82-2-558-5932 or     Fax: 31-416-690340
Itasca, IL
Tel: 630-285-0071             Fax: 86-591-8750-3521      82-2-558-5934             Spain - Madrid
Fax: 630-285-0075             China - Hong Kong SAR                                Tel: 34-91-708-08-90
                                                         Malaysia - Penang
                              Tel: 852-2401-1200         Tel: 60-4-646-8870        Fax: 34-91-708-08-91
Dallas
Addison, TX                   Fax: 852-2401-3431         Fax: 60-4-646-5086        UK - Wokingham
Tel: 972-818-7423             China - Qingdao                                      Tel: 44-118-921-5869
                                                         Philippines - Manila
Fax: 972-818-2924             Tel: 86-532-8502-7355                                Fax: 44-118-921-5820
                                                         Tel: 63-2-634-9065
Detroit                       Fax: 86-532-8502-7205      Fax: 63-2-634-9069
Farmington Hills, MI          China - Shanghai           Singapore
Tel: 248-538-2250             Tel: 86-21-5407-5533       Tel: 65-6334-8870
Fax: 248-538-2260             Fax: 86-21-5407-5066       Fax: 65-6334-8850
Kokomo                        China - Shenyang           Taiwan - Hsin Chu
Kokomo, IN                    Tel: 86-24-2334-2829       Tel: 886-3-572-9526
Tel: 765-864-8360             Fax: 86-24-2334-2393       Fax: 886-3-572-6459
Fax: 765-864-8387
                              China - Shenzhen           Taiwan - Kaohsiung
Los Angeles                   Tel: 86-755-8203-2660      Tel: 886-7-536-4818
Mission Viejo, CA             Fax: 86-755-8203-1760      Fax: 886-7-536-4803
Tel: 949-462-9523
                              China - Shunde             Taiwan - Taipei
Fax: 949-462-9608
                              Tel: 86-757-2839-5507      Tel: 886-2-2500-6610
Santa Clara                   Fax: 86-757-2839-5571      Fax: 886-2-2508-0102
Santa Clara, CA
                              China - Wuhan              Thailand - Bangkok
Tel: 408-961-6444
                              Tel: 86-27-5980-5300       Tel: 66-2-694-1351
Fax: 408-961-6445
                              Fax: 86-27-5980-5118       Fax: 66-2-694-1350
Toronto
                              China - Xian
Mississauga, Ontario,
                              Tel: 86-29-8833-7250
Canada
                              Fax: 86-29-8833-7256
Tel: 905-673-0699
Fax: 905-673-6509
                                                                                                     12/08/06
DS21291F-page 78                                                               © 2007 Microchip Technology Inc.


                                                                                                                                                                   MCP2510
Stand-Alone CAN Controller with SPI™ Interface 1
1.0          Device Functionality . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 3
2.0          Can Message Frames . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 7
3.0          Message Transmission . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 15
4.0          Message Reception . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 21
5.0          Bit Timing . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 35
6.0          Error Detection . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 41
7.0          Interrupts. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 45
8.0          Oscillator . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 49
9.0          Modes of Operation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 51
10.0         Register Map . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 55
11.0         SPI Interface . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 57
12.0         Electrical Characteristics . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 61
13.0         Packaging Information . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 65
Index . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 69
On-Line Support . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 71
Reader Response . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 72
Product Identification System . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 73
Worldwide Sales and Service ............................................................................................................................................................. 76
© 2007 Microchip Technology Inc.                                                                                                                                               DS21291F-page 79


MCP2510
DS21291F-page 80 © 2007 Microchip Technology Inc.


Mouser Electronics
Authorized Distributor
Click to View Pricing, Inventory, Delivery & Lifecycle Information:
Microchip:
 MCP2510T-I/ST MCP2510T-I/SO MCP2510T-E/SO MCP2510-I/ST
