                                                                                       USB4604
           USB 2.0 HSIC Hi-Speed 4-Port Hub Controller
Highlights                                       Additional Features
• Hub Controller IC with 4 downstream ports      • MultiTRAK™
• High-Speed Inter-Chip (HSIC) support             - Dedicated Transaction Translator per port
  - Upstream port selectable between HSIC or     • PortMap
     USB 2.0                                       - Configurable port mapping and disable
• USB-IF Battery Charger revision 1.2 support on      sequencing
  up & downstream ports (DCP, CDP, SDP)          • PortSwap
                                      
• Battery charging support for Apple devices       - Configurable differential intra-pair signal
• FlexConnect: Downstream port 1 able to swap         swapping
  with upstream port, allowing master capable    • PHYBoost™
  devices to control other devices on the hub      - Programmable USB transceiver drive
• USB to I2C/SPI bridge endpoint support              strength for recovering signal integrity
• USB Link Power Management (LPM) support        • VariSense™
• SUSPEND pin for remote wakeup indication to      - Programmable USB receiver sensitivity
  host                                           • Low power operation
• Start Of Frame (SOF) synchronized clock output • Full Power Management with individual or ganged
  pin                                              power control of each downstream port
• Vendor Specific Messaging (VSM) support        • Built-in Self-Powered or Bus-Powered internal
• Enhanced OEM configuration options available     default settings provide flexibility in the quantity of
  through OTP or SMBus Slave Port                  USB expansion ports utilized without redesign
• Flexible power rail support                    • Supports “Quad Page” configuration OTP flash
  - VBUS or VBAT only operation                    - Four consecutive 200 byte configuration
  - 3.3V only operation                               pages
  - VBAT + 1.8V operation                        • Fully integrated USB termination and Pull-up/Pull-
  - 3.3V + 1.8V operation                          down resistors
• 48-pin (7x7mm) SQFN, RoHS compliant package    • On-chip Power On Reset (POR)
                                                 • Internal 3.3V and 1.2V voltage regulators
Target Applications                              • On Board 24MHz Crystal Driver, Resonator, or
                                                   External 24MHz clock input
• LCD monitors and TVs
                                                 • USB host/device speed indicator. Per-port 3-color
• Multi-function USB peripherals                   LED drivers indicate the speed of USB host and
• PC mother boards                                 device connection - hi-speed (480 Mbps), full-
• Set-top boxes, DVD players, DVR/PVR              speed (12 Mbps), low-speed (1.5 Mbps)
• Printers and scanners                          • Environmental
• PC media drive bay                               - Commercial temperature range support (0ºC
• Portable hub boxes                                  to 70ºC)
• Mobile PC docking                                - Industrial temperature range support (-40ºC
• Embedded systems                                    to 85ºC)
 2012 - 2019 Microchip Technology Inc.                                                DS00001716C-page 1


USB4604
                                            TO OUR VALUED CUSTOMERS
 It is our intention to provide our valued customers with the best documentation possible to ensure successful use of your Microchip
 products. To this end, we will continue to improve our publications to better suit your needs. Our publications will be refined and
 enhanced as new volumes and updates are introduced.
 If you have any questions or comments regarding this publication, please contact the Marketing Communications Department via
 E-mail at docerrors@microchip.com. We welcome your feedback.
 Most Current Data Sheet
 To obtain the most up-to-date version of this data sheet, please register at our Worldwide Web site at:
        http://www.microchip.com
 You can determine the version of a data sheet by examining its literature number found on the bottom outside corner of any page.
 The last character of the literature number is the version number, (e.g., DS30000000A is version A of document DS30000000).
 Errata
 An errata sheet, describing minor operational differences from the data sheet and recommended workarounds, may exist for cur-
 rent devices. As device/documentation issues become known to us, we will publish an errata sheet. The errata will specify the
 revision of silicon and revision of document to which it applies.
 To determine if an errata sheet exists for a particular device, please check with one of the following:
 • Microchip’s Worldwide Web site; http://www.microchip.com
 • Your local Microchip sales office (see last page)
 When contacting a sales office, please specify which device, revision of silicon and data sheet (include -literature number) you are
 using.
 Customer Notification System
 Register on our web site at www.microchip.com to receive the most current information on all of our products.
DS00001716C-page 2                                                                            2012 - 2019 Microchip Technology Inc.


                                                                                                                                                                            USB4604
Table of Contents
1.0 Introduction ..................................................................................................................................................................................... 4
2.0 Acronyms and Definitions ............................................................................................................................................................... 6
3.0 Pin Descriptions .............................................................................................................................................................................. 7
4.0 Power Connections ....................................................................................................................................................................... 17
5.0 Modes of Operation ...................................................................................................................................................................... 19
6.0 Device Configuration ..................................................................................................................................................................... 23
7.0 Device Interfaces .......................................................................................................................................................................... 27
8.0 Functional Descriptions ................................................................................................................................................................. 34
9.0 Operational Characteristics ........................................................................................................................................................... 39
10.0 Package Outline
       ................................................................................................................................................................................................... 49
Appendix A: Data sheet Revision History ........................................................................................................................................... 50
The Microchip Web Site ...................................................................................................................................................................... 51
Customer Change Notification Service ............................................................................................................................................... 51
Customer Support ............................................................................................................................................................................... 51
Product Identification System ............................................................................................................................................................. 52
 2012 - 2019 Microchip Technology Inc.                                                                                                                                    DS00001716C-page 3


USB4604
1.0        INTRODUCTION
The USB4604 is a low-power, OEM configurable, MTT (Multi-Transaction Translator) USB 2.0 hub controller with 4
downstream ports and advanced features for embedded USB applications. The USB4604 is fully compliant with the
USB 2.0 Specification, USB 2.0 Link Power Management Addendum, High-Speed Inter-Chip (HSIC) USB Electrical
Specification Revision 1.0, and will attach to an upstream port as a Full-Speed hub or as a Full-/Hi-Speed hub. The 4-
port hub supports Low-Speed, Full-Speed, and Hi-Speed (if operating as a Hi-Speed hub) downstream devices on all of
the enabled downstream (non-HSIC) ports. HSIC ports support only Hi-Speed operation.
The USB4604 has been specifically optimized for embedded systems where high performance, and minimal BOM costs
are critical design requirements. Standby mode power has been minimized and reference clock inputs can be aligned
to the customer’s specific application. Flexible power rail options ease integration into energy efficient designs by allow-
ing the USB4604 to be powered in a single-source (VBUS, VBAT, 3.3V) or a dual-source (VBAT + 1.8, 3.3V + 1.8) con-
figuration. Additionally, all required resistors on the USB ports are integrated into the hub, including all series termination
and pull-up/pull-down resistors on the D+ and D– pins.
The USB4604 supports both upstream battery charger detection and downstream battery charging. The USB4604 inte-
grated battery charger detection circuitry supports the USB-IF Battery Charging (BC1.2) detection method and most
Apple devices. These circuits are used to detect the attachment and type of a USB charger and provide an interrupt
output to indicate charger information is available to be read from the device’s status registers via the serial interface.
The USB4604 provides the battery charging handshake and supports the following USB-IF BC1.2 charging profiles:
•  DCP: Dedicated Charging Port (Power brick with no data)
•  CDP: Charging Downstream Port (1.5A with data)
•  SDP: Standard Downstream Port (0.5A with data)
•  Custom profiles loaded via SMBus or OTP
The USB4604 provides an additional USB endpoint dedicated for use as a USB to I2C/SPI interface, allowing external
circuits or devices to be monitored, controlled, or configured via the USB interface. Additionally, the USB4604 includes
many powerful and unique features such as:
FlexConnect, which provides flexible connectivity options. The USB4604’s downstream port 1 can be swapped with
the upstream port, allowing master capable devices to control other devices on the hub.
MultiTRAK™ Technology, which utilizes a dedicated Transaction Translator (TT) per port to maintain consistent full-
speed data throughput regardless of the number of active downstream connections. MultiTRAKTM outperforms conven-
tional USB 2.0 hubs with a single TT in USB full-speed data transfers.
PortMap, which provides flexible port mapping and disable sequences. The downstream ports of a USB4604 hub can
be reordered or disabled in any sequence to support multiple platform designs with minimum effort. For any port that is
disabled, the USB4604 hub controllers automatically reorder the remaining ports to match the USB host controller’s port
numbering scheme.
PortSwap, which adds per-port programmability to USB differential-pair pin locations. PortSwap allows direct alignment
of USB signals (D+/D-) to connectors to avoid uneven trace length or crossing of the USB differential signals on the
PCB.
PHYBoost, which provides programmable levels of Hi-Speed USB signal drive
strength in the downstream port transceivers. PHYBoost attempts to restore USB sig-
nal integrity in a compromised system environment. The graphic on the right shows
an example of Hi-Speed USB eye diagrams before and after PHYBoost signal integ-
rity restoration.
VariSense, which controls the USB receiver sensitivity enabling programmable lev-
els of USB signal receive sensitivity. This capability allows operation in a sub-optimal
system environment, such as when a captive USB cable is used.
The USB4604 is available in commercial (0°C to +70°C) and industrial (-40°C to +85°C) temperature range versions.
As shown in the ordering code matrix, two USB4604 firmware revisions are available: “-1080” and “-1070”. The -1080
version enables the internal Hub Controller, while the -1070 version disables it. There are no additional differences
between these two versions.
DS00001716C-page 4                                                                       2012 - 2019 Microchip Technology Inc.


                                                                                                  USB4604
The Hub Controller adds advanced functionality to the USB4604 by enabling the host to send commands directly to it
via the upstream USB connection. Commands to the Hub Controller must be sent to the virtual 5th port in the hub. The
following functions can be controlled via commands through the Hub Controller:
• USB to SMBus Bridging: The host can send commands through USB to any device connected to the hub through
   the SMBus.
• USB to UART Bridging: The host can send commands through SUB to any device connected to the hub through
   the UART.
• GPIO Control: The GPIOs on the hub can be dynamically configured and controlled by the host.
• OTP Programming: Permanent customer configurations can be loaded to the One Time Programmable memory.
1.1       Block Diagram
Figure 1-1 details the internal block diagram of the USB4604.
FIGURE 1-1:             SYSTEM BLOCK DIAGRAM
                             Up or
                         Downstream                        VDDCOREREG         To I2C Master/Slave
                           HSIC/USB
      RESET_N                               VBAT      VDDA33                       SDA   SCL
                                                           VDD33     VDDCR12
                                                                                    Serial
                                                                                  Interface
                                               3.3V Reg          1.2V Reg
                   Flex HSIC Flex PHY
                                                           SIE                   Controller
                         Repeater
                                          TT #1   TT #2 TT #3 TT #4 TT #5      Port Controller
                                                                          2KB
                                                                  UDC                                  Port Power
               Routing & Port Re-Ordering Logic        Bridge              DP
                                                                   20                                  OCS
                                                                         SRAM
                                                                                                        GPIO
                                                                    256B          8051       GPIO
                                                                    IRAM       Controller              SPI/I2C
                                                                                              SPI
             Swap PHY     PHY         PHY        PHY
                                                                         2KB       4KB     32KB
                                                                         OTP     SRAM      ROM
              USB         USB        USB        USB
             Down or   Downstream Downstream Downstream
             Upstream
 2012 - 2019 Microchip Technology Inc.                                                           DS00001716C-page 5


USB4604
2.0      ACRONYMS AND DEFINITIONS
2.1      Acronyms
EOP:     End of Packet
EP:      Endpoint
FS:      Full-Speed
GPIO:    General Purpose I/O (that is input/output to/from the device)
HS:      Hi-Speed
HSOS: High Speed Over Sampling
HSIC:    High-Speed Inter-Chip
 2
I C:     Inter-Integrated Circuit
LS:      Low-Speed
OTP:     One Time Programmable
PCB:     Printed Circuit Board
PCS:     Physical Coding Sublayer
PHY:     Physical Layer
SMBus: System Management Bus
UUID:    Universally Unique IDentification
2.2      Reference Documents
1.   UNICODE UTF-16LE For String Descriptors USB Engineering Change Notice, December 29th, 2004, http://
     www.usb.org
2.   Universal Serial Bus Specification, Revision 2.0, April 27th, 2000, http://www.usb.org
3.   Battery Charging Specification, Revision 1.2, Dec. 07, 2010, http://www.usb.org
4.   High-Speed Inter-Chip USB Electrical Specification, Version 1.0, Sept. 23, 2007, http://www.usb.org
5.   I2C-Bus Specification, Version 1.1, http://www.nxp.com
6.   System Management Bus Specification, Version 1.0, http://smbus.org/specs
DS00001716C-page 6                                                                  2012 - 2019 Microchip Technology Inc.


                                                                                                                                                                                                                                                                                                                                 USB4604
3.0      PIN DESCRIPTIONS
FIGURE 3-1:            48-SQFN PIN ASSIGNMENTS
                                                                                                                                                                           UART_TX/OCS4_N   PRTPWR4/PRTCTL4            UART_RX/OCS3_N                                        SPI_DO/SPI_SPD_SEL
                                          VBUS_DET                                         SCL/SMBCLK                                            SDA/SMBDATA
                                                     RESET_N                                                             VDD33                                                                                                                      SPI_CLK                                                SPI_CE_N
                                                               NC
                                          36         35        34                          33                            32                      31                        30               29                         28                           27                        26                           25
                       VDDA33        37                                                                                                                                                                                                                                                                                    SPI_DI
                                                                                                                                                                                                                                                                                                                      24
                        VDD12        38                                                                                                                                                                                                                                                                               23   NC
       FLEX_HSIC_UP_STROBE           39                                                                                                                                                                                                                                                                                    NC
                                                                                                                                                                                                                                                                                                                      22
 FLEX_USBUP_DM/PRT_DIS_M0            40                                                                                                                                                                                                                                                                               21   PRTPWR3/PRTCTL3
  FLEX_USBUP_DP/PRT_DIS_P0           41                                                                                                                                                                                                                                                                               20   OCS2_N
         FLEX_HSIC_UP_DATA           42                                                                                   USB4604                                                                                                                                                                                     19   PRTPWR2/PRTCTL2
                        XTAL2        43                                                                                  (Top View)                                                                                                                                                                                   18   VDD33
               XTAL1/REFCLK          44                                                                                                                                                                                                                                                                               17   VDDCR12
                           NC        45                                                                                                                                                                                                                                                                               16   OCS1_N
                        RBIAS        46                                                                                                                                                                                                                                                                               15   PRTPWR1/PRTCTL1
                                                                        Ground Pad
                VDDCOREREG           47                          (must be connected to VSS)                                                                                                                                                                                                                           14   SUSPEND
                       VDDA33        48                                                                                                                                                                                                                                                                               13   SOF
                                           1         2         3                            4                            5                        6                         7                8                          9                           10                          11                         12
                                             VBAT
                                                                                                                                                                                                USBDN3_DM/PRT_DIS_M3
                                                                                                                                                                                                                             USBDN3_DP/PRT_DIS_P3
                                                                                                                                                                                                                                                      USBDN4_DM/PRT_DIS_M4
                                                                                                                                                                                                                                                                                    USBDN4_DP/PRT_DIS_P4
                                                                                                                                                                                                                                                                                                             VDDA33
                                                       NC                                                                                                                     NC
                                                               SWAP_USBDN1_DM/PRT_DIS_M1
                                                                                             SWAP_USBDN1_DP/PRT_DIS_P1
                                                                                                                          USBDN2_DM/PRT_DIS_M2
                                                                                                                                                    USBDN2_DP/PRT_DIS_P2
                                                        Indicates pins on the bottom of the device.
 2012 - 2019 Microchip Technology Inc.                                                                                                                                                                                                                                                                                          DS00001716C-page 7


USB4604
3.1       Pin Descriptions
This section provides a detailed description of each pin. The signals are arranged in functional groups according to their
associated interface.
The “_N” symbol in the signal name indicates that the active, or asserted, state occurs when the signal is at a low voltage
level. For example, RESET_N indicates that the reset signal is active low. When “_N” is not present after the signal
name, the signal is asserted when at the high voltage level.
The terms assertion and negation are used exclusively. This is done to avoid confusion when working with a mixture of
“active low” and “active high” signals. The term assert, or assertion, indicates that a signal is active, independent of
whether that level is represented by a high or low voltage. The term negate, or negation, indicates that a signal is inac-
tive.
   Note:    The buffer type for each signal is indicated in the BUFFER TYPE column of Table 3-1. A description of the
            buffer types is provided in Section 3.3.
   Note:    Compatibility with the UCS100x family of USB port power controllers requires the UCS100x be connected
            on Port 1 of the USB4604. Additionally, both PRTPWR1 and OCS1_N must be pulled high at Power-On
            Reset (POR).
TABLE 3-1:         PIN DESCRIPTIONS
                                                          Buffer
   Num Pins           Name              Symbol                                           Description
                                                           Type
                                                USB/HSIC INTERFACES
                Upstream USB       FLEX_USBUP_DP            AIO     Upstream USB Port 0 D+ data signal.
                        D+                                          See Note 3-1.
                 (Flex Port 0)                                         Note:     The upstream Port 0 signals can be
                                                                                 optionally swapped with the down-
                                                                                 stream Port 1 signals.
                   Port 0 D+        PRT_DIS_P0               IS     This strap is used in conjunction with
                     Disable                                        PRT_DIS_M0 to disable USB Port 0.
        1        Configuration
                      Strap                                         0 = Port 0 D+ Enabled
                                                                    1 = Port 0 D+ Disabled
                                                                       Note:     Both PRT_DIS_P0 and PRT_DIS_M0
                                                                                 must be tied to VDD33 at reset to place
                                                                                 Port 0 into HSIC mode.
                                                                    See Note 3-2 for more information on configuration
                                                                    straps.
                Upstream USB       FLEX_USBUP_DM            AIO     Upstream USB Port 0 D- data signal.
                        D-                                          See Note 3-1.
                 (Flex Port 0)                                         Note:     The upstream Port 0 signals can be
                                                                                 optionally swapped with the down-
                                                                                 stream Port 1 signals.
                    Port 0 D-       PRT_DIS_M0               IS     This strap is used in conjunction with PRT_DIS_P0
                     Disable                                        to disable USB Port 0.
        1        Configuration
                      Strap                                         0 = Port 0 D- Enabled
                                                                    1 = Port 0 D- Disabled
                                                                       Note:     Both PRT_DIS_P0 and PRT_DIS_M0
                                                                                 must be tied to VDD33 at reset to place
                                                                                 Port 0 into HSIC mode.
                                                                    See Note 3-2 for more information on configuration
                                                                    straps.
DS00001716C-page 8                                                                    2012 - 2019 Microchip Technology Inc.


                                                                                           USB4604
TABLE 3-1:         PIN DESCRIPTIONS (CONTINUED)
                                                  Buffer
  Num Pins            Name              Symbol                                Description
                                                  Type
                    Upstream        FLEX_HSIC_UP_ HSIC   Upstream HSIC Port 0 DATA signal.
                   HSIC Data             DATA            See Note 3-1.
      1           (Flex Port 0)                             Note:     The upstream Port 0 signals can be
                                                                      optionally swapped with the down-
                                                                      stream Port 1 signals.
                    Upstream        FLEX_HSIC_UP_ HSIC   Upstream HSIC Port 0 STROBE signal.
                  HSIC Strobe           STROBE           See Note 3-1.
      1           (Flex Port 0)                             Note:     The upstream Port 0 signals can be
                                                                      optionally swapped with the down-
                                                                      stream Port 1 signals.
                  Downstream       SWAP_USBDN1_DP  AIO   Downstream USB Port 1 D+ data signal.
                    USB D+                                  Note:     The downstream Port 1 signals can be
                 (Swap Port 1)                                        optionally swapped with the upstream
                                                                      Port 0 signals.
                   Port 1 D+         PRT_DIS_P1     IS   This strap is used in conjunction with
                     Disable                             PRT_DIS_M1 to disable USB Port 1.
      1           Configuration
                      Strap                              0 = Port 1 D+ Enabled
                                                         1 = Port 1 D+ Disabled
                                                            Note:     Both PRT_DIS_P1 and PRT_DIS_M1
                                                                      must be tied to VDD33 at reset to dis-
                                                                      able the associated port.
                                                         See Note 3-2 for more information on configuration
                                                         straps.
                  Downstream       SWAP_USBDN1_DM  AIO   Downstream USB Port 1 D- data signal.
                     USB D-                                 Note:     The downstream Port 1 signals can be
                 (Swap Port 1)                                        optionally swapped with the upstream
                                                                      Port 0 signals.
                    Port 1 D-        PRT_DIS_M1     IS   This strap is used in conjunction with PRT_DIS_P1
                     Disable                             to disable USB Port 1.
      1           Configuration
                      Strap                              0 = Port 1 D- Enabled
                                                         1 = Port 1 D- Disabled
                                                            Note:     Both PRT_DIS_P1 and PRT_DIS_M1
                                                                      must be tied to VDD33 at reset to dis-
                                                                      able the associated port.
                                                         See Note 3-2 for more information on configuration
                                                         straps.
                  Downstream         USBDN2_DP     AIO   Downstream USB Port 2 D+ data signal.
                    USB D+
                     (Port 2)
                   Port 2 D+         PRT_DIS_P2     IS   This strap is used in conjunction with
                     Disable                             PRT_DIS_M2 to disable USB Port 2.
                  Configuration
      1               Strap                              0 = Port 2 D+ Enabled
                                                         1 = Port 2 D+ Disabled
                                                            Note:     Both PRT_DIS_P2 and PRT_DIS_M2
                                                                      must be tied to VDD33 at reset to dis-
                                                                      able the associated port.
                                                         See Note 3-2 for more information on configuration
                                                         straps.
 2012 - 2019 Microchip Technology Inc.                                                   DS00001716C-page 9


USB4604
TABLE 3-1:      PIN DESCRIPTIONS (CONTINUED)
                                         Buffer
  Num Pins         Name        Symbol                                Description
                                          Type
               Downstream    USBDN2_DM     AIO  Downstream USB Port 2 D- data signal.
                  USB D-
                  (Port 2)
                 Port 2 D-   PRT_DIS_M2     IS  This strap is used in conjunction with PRT_DIS_P2
                  Disable                       to disable USB Port 2.
               Configuration
      1            Strap                        0 = Port 2 D- Enabled
                                                1 = Port 2 D- Disabled
                                                   Note:     Both PRT_DIS_P2 and PRT_DIS_M2
                                                             must be tied to VDD33 at reset to dis-
                                                             able the associated port.
                                                See Note 3-2 for more information on configuration
                                                straps.
               Downstream    USBDN3_DP     AIO  Downstream USB Port 3 D+ data signal.
                 USB D+
                  (Port 3)
                Port 3 D+    PRT_DIS_P3     IS  This strap is used in conjunction with
                  Disable                       PRT_DIS_M3 to disable USB Port 3.
               Configuration
      1            Strap                        0 = Port 3 D+ Enabled
                                                1 = Port 3 D+ Disabled
                                                   Note:     Both PRT_DIS_P3 and PRT_DIS_M3
                                                             must be tied to VDD33 at reset to dis-
                                                             able the associated port.
                                                See Note 3-2 for more information on configuration
                                                straps.
               Downstream    USBDN3_DM     AIO  Downstream USB Port 3 D- data signal.
                  USB D-
                  (Port 3)
                 Port 3 D-   PRT_DIS_M3     IS  This strap is used in conjunction with PRT_DIS_P3
                  Disable                       to disable USB Port 3.
               Configuration
      1            Strap                        0 = Port 3 D- Enabled
                                                1 = Port 3 D- Disabled
                                                   Note:     Both PRT_DIS_P3 and PRT_DIS_M3
                                                             must be tied to VDD33 at reset to dis-
                                                             able the associated port.
                                                See Note 3-2 for more information on configuration
                                                straps.
               Downstream    USBDN4_DP     AIO  Downstream USB Port 4 D+ data signal.
                 USB D+
                  (Port 4)
                Port 4 D+    PRT_DIS_P4     IS  This strap is used in conjunction with
                  Disable                       PRT_DIS_M4 to disable USB Port 4.
               Configuration
      1            Strap                        0 = Port 4 D+ Enabled
                                                1 = Port 4 D+ Disabled
                                                   Note:     Both PRT_DIS_P4 and PRT_DIS_M4
                                                             must be tied to VDD33 at reset to dis-
                                                             able the associated port.
                                                See Note 3-2 for more information on configuration
                                                straps.
DS00001716C-page 10                                              2012 - 2019 Microchip Technology Inc.


                                                                                                   USB4604
TABLE 3-1:         PIN DESCRIPTIONS (CONTINUED)
                                                        Buffer
  Num Pins             Name             Symbol                                        Description
                                                         Type
                  Downstream         USBDN4_DM            AIO  Downstream USB Port 4 D- data signal.
                      USB D-
                      (Port 4)
                    Port 4 D-        PRT_DIS_M4            IS  This strap is used in conjunction with PRT_DIS_P4
                      Disable                                  to disable USB Port 4.
                 Configuration
      1                Strap                                   0 = Port 4 D- Enabled
                                                               1 = Port 4 D- Disabled
                                                                  Note:     Both PRT_DIS_P4 and PRT_DIS_M4
                                                                            must be tied to VDD33 at reset to dis-
                                                                            able the associated port.
                                                               See Note 3-2 for more information on configuration
                                                               straps.
                                                I2C/SMBUS INTERFACE
                     2C   Serial          SCL           I_SMB  I2C serial clock input
                    I
      1            Clock Input
                 SMBus Clock            SMBCLK          I_SMB  SMBus serial clock input
                 2
                I C Serial Data           SDA          IS/OD8  I2C bidirectional serial data
      1          SMBus Serial          SMBDATA         IS/OD8  SMBus bidirectional serial data
                        Data
                                              SPI MASTER INTERFACE
                     SPI Chip         SPI_CE_N            O12  Active-low SPI chip enable output.
      1          Enable Output                                    Note:     If the SPI is enabled, this pin will be
                                                                            driven high in powerdown states.
                   SPI Clock            SPI_CLK           O12  SPI clock output
      1
                       Output
                    SPI Data            SPI_DO            O12  SPI data output
                       Output
                   SPI Speed        SPI_SPD_SEL            IS  This strap is used to select the speed of the SPI.
                       Select                            (PD)
                 Configuration                                 0 = 30MHz (default)
                       Strap                                   1 = 60MHz
      1                                                           Note:     If the latched value on reset is 1, this pin
                                                                            is tri-stated when the chip is in the sus-
                                                                            pend state. If the latched value on reset
                                                                            is 0, this pin is driven low during a sus-
                                                                            pend state.
                                                               See Note 3-2 for more information on configuration
                                                               straps.
                SPI Data Input           SPI_DI            IS  SPI data input
      1
                                                         (PD)
                                                         MISC.
                  Port 1 Over-          OCS1_N             IS  This active-low signal is input from an external
      1          Current Sense                           (PU)  current monitor to indicate an over-current
                        Input                                  condition on USB Port 1.
                  Port 2 Over-          OCS2_N             IS  This active-low signal is input from an external
      1          Current Sense                           (PU)  current monitor to indicate an over-current
                        Input                                  condition on USB Port 2.
 2012 - 2019 Microchip Technology Inc.                                                           DS00001716C-page 11


USB4604
TABLE 3-1:       PIN DESCRIPTIONS (CONTINUED)
                                          Buffer
  Num Pins         Name        Symbol                                 Description
                                           Type
              UART Receive    UART_RX       IS   Internal UART receive input
                   Input                            Note:     This is a 3.3V signal. For RS232 opera-
                                                              tion, an external 12V translator is
      1                                                       required.
               Port 3 Over-    OCS3_N       IS   This active-low signal is input from an external
              Current Sense                (PU)  current monitor to indicate an over-current
                   Input                         condition on USB Port 3.
              UART Transmit   UART_TX       O8   Internal UART transmit output
                  Output                            Note:     This is a 3.3V signal. For RS232 opera-
                                                              tion, an external 12V driver is required.
      1
               Port 4 Over-    OCS4_N       IS   This active-low signal is input from an external
              Current Sense                (PU)  current monitor to indicate an over-current
                   Input                         condition on USB Port 4.
              System Reset    RESET_N     I_RST  This active-low signal allows external hardware to
                   Input                         reset the device.
                                                    Note:     The active-low pulse must be at least
      1
                                                              5us wide. Refer to Section 8.4.2, "Exter-
                                                              nal Chip Reset (RESET_N)," on
                                                              page 37 for additional information.
               Crystal Input    XTAL1      ICLK  External 24 MHz crystal input
                 Reference     REFCLK      ICLK  Reference clock input. The device may be
      1         Clock Input                      alternatively driven by a single-ended clock
                                                 oscillator. When this method is used, XTAL2
                                                 should be left unconnected.
      1       Crystal Output    XTAL2     OCLK   External 24 MHz crystal output
               External USB     RBIAS       AI   A 12.0k (+/- 1%) resistor is attached from ground
      1         Transceiver                      to this pin to set the transceiver’s internal bias
               Bias Resistor                     settings.
                 Suspend      SUSPEND       PU   This signal is used to indicate that the entire hub
                  Output                         has entered the USB suspend state and that
                                                 VBUS current consumption should be reduced in
                                                 accordance with the USB specification. Refer to
      1                                          Section 8.6, "Suspend (SUSPEND)," on page 38
                                                 for additional information.
                                                    Note:     SUSPEND must be enabled via the
                                                              Protouch configuration tool.
                   SOF           SOF        O8   This signal outputs an 8KHz clock synchronized
               Synchronized                      with the USB Host SOF.
      1         8KHz Clock                          Note:     SOF output is controlled via the
                  Output                                      SOF_ENABLE bit in the UTIL_CON-
                                                              FIG1 register
                  Detect     VBUS_DET       IS   Detects state of upstream bus power.
                 Upstream
               VBUS Power                        When designing a detachable hub, this pin must
                                                 be connected to the VBUS power pin of the
                                                 upstream USB port through a resistor divider
                                                 (50k by 100k) to provide 3.3V.
                                                 For self-powered applications with a permanently
      1                                          attached host, this pin must be connected to either
                                                 3.3V or 5.0V through a resistor divider to provide
                                                 3.3V.
                                                 In embedded applications, VBUS_DET may be
                                                 controlled (toggled) when the host desires to
                                                 renegotiate a connection without requiring a full
                                                 reset of the device.
DS00001716C-page 12                                                2012 - 2019 Microchip Technology Inc.


                                                                                        USB4604
TABLE 3-1:         PIN DESCRIPTIONS (CONTINUED)
                                                Buffer
  Num Pins           Name                Symbol                            Description
                                                 Type
                 Port 1 Power         PRTPWR1     O8   Enables power to a downstream USB device
                     Output                            attached to Port 1.
                                                       0 = Power disabled on downstream Port 1
                                                       1 = Power enabled on downstream Port 1
      1
                 Port 1 Control         PRTCTL1 OD8/IS When configured as PRTCTL1, this pin functions
                                                 (PU)  as both the Port 1 power enable output
                                                       (PRTPWR1) and the Port 1 over-current sense
                                                       input (OCS1_N). Refer to the PRTPWR1 and
                                                       OCS1_N descriptions for additional information.
                 Port 2 Power         PRTPWR2     O8   Enables power to a downstream USB device
                     Output                            attached to Port 2.
                                                       0 = Power disabled on downstream Port 2
                                                       1 = Power enabled on downstream Port 2
      1
                 Port 2 Control         PRTCTL2 OD8/IS When configured as PRTCTL2, this pin functions
                                                 (PU)  as both the Port 2 power enable output
                                                       (PRTPWR2) and the Port 2 over-current sense
                                                       input (OCS2_N). Refer to the PRTPWR2 and
                                                       OCS2_N descriptions for additional information.
                 Port 3 Power         PRTPWR3     O8   Enables power to a downstream USB device
                     Output                            attached to Port 3.
                                                       0 = Power disabled on downstream Port 3
                                                       1 = Power enabled on downstream Port 3
      1
                 Port 3 Control         PRTCTL3 OD8/IS When configured as PRTCTL3, this pin functions
                                                 (PU)  as both the Port 3 power enable output
                                                       (PRTPWR3) and the Port 3 over-current sense
                                                       input (OCS3_N). Refer to the PRTPWR3 and
                                                       OCS3_N descriptions for additional information.
                 Port 4 Power         PRTPWR4     O8   Enables power to a downstream USB device
                     Output                            attached to Port 4.
                                                       0 = Power disabled on downstream Port 4
                                                       1 = Power enabled on downstream Port 4
      1
                 Port 4 Control         PRTCTL4 OD8/IS When configured as PRTCTL4, this pin functions
                                                 (PU)  as both the Port 4 power enable output
                                                       (PRTPWR4) and the Port 4 over-current sense
                                                       input (OCS4_N). Refer to the PRTPWR4 and
                                                       OCS4_N descriptions for additional information.
                  No Connect               NC      -   These pins must be left floating for normal device
      6                                                operation.
                                                POWER
                 Battery Power            VBAT     P   Battery power supply input. When VBAT is
                  Supply Input                         connected directly to a +3.3V supply from the
                                                       system, the internal +3.3V regulator runs in
                                                       dropout and regulator power consumption is
                                                       eliminated. A 4.7 F (<1  ESR) capacitor to
      1                                                ground is required for regulator stability. The
                                                       capacitor should be placed as close as possible to
                                                       the device. Refer to Section 4.0, "Power
                                                       Connections," on page 17 for power connection
                                                       information.
                 +3.3V Analog           VDDA33     P   +3.3V analog power supply. A 1.0 F (<1  ESR)
                 Power Supply                          capacitor to ground is required for regulator
                                                       stability. The capacitor should be placed as close
      3                                                as possible to the device. Refer to Section 4.0,
                                                       "Power Connections," on page 17 for power
                                                       connection information.
 2012 - 2019 Microchip Technology Inc.                                                DS00001716C-page 13


USB4604
TABLE 3-1:       PIN DESCRIPTIONS (CONTINUED)
                                                       Buffer
  Num Pins         Name              Symbol                                          Description
                                                       Type
               +3.3V Power           VDD33               P       +3.3V power supply. These pins must be
                  Supply                                         connected to VDDA33. Refer to Section 4.0,
      2                                                          "Power Connections," on page 17 for power
                                                                 connection information.
              +1.8-3.3V Core    VDDCOREREG               P       +1.8-3.3V core power supply input to internal
               Power Supply                                      +1.2V regulator. This pin may be connected to
                   Input                                         VDD33 for single supply applications when VBAT
                                                                 equals +3.3V. Running in a dual supply
                                                                 configuration with VDDCOREREG at a lower
                                                                 voltage, such as +1.8V, may reduce overall system
      1                                                          power consumption. In dual supply configurations,
                                                                 a 4.7 F (<1  ESR) capacitor to ground is
                                                                 required for regulator stability. The capacitor
                                                                 should be placed as close as possible to the
                                                                 device. Refer to Section 4.0, "Power Connections,"
                                                                 on page 17 for power connection information.
                +1.2V Core          VDDCR12              P       +1.2V core power supply. In single supply
               Power Supply                                      applications or dual supply applications where
                                                                 1.2V is not used, a 1.0 F (<1  ESR) capacitor
                                                                 to ground is required for regulator stability. The
      1                                                          capacitor should be placed as close as possible to
                                                                 the device. Refer to Section 4.0, "Power
                                                                 Connections," on page 17 for power connection
                                                                 information.
                +1.2V HSIC           VDD12               P       +1.2V HSIC power supply input. Refer to Section
      1        Power Supply                                      4.0, "Power Connections," on page 17 for power
                   Input                                         connection information.
   Exposed        Ground              VSS                P       Common ground. This exposed pad must be
   Pad on                                                        connected to the ground plane with a via array.
   package
    bottom
 (Figure 3-1)
  Note 3-1    When the device is configured to enable the HSIC upstream port, the USB Product ID (PID) will be
              4604. When the device is configured to enable the USB upstream port, the USB PID will be 4504.
  Note 3-2    Configuration strap values are latched on Power-On Reset (POR) and the rising edge of RESET_N
              (external chip reset). Configuration straps are identified by an underlined symbol name. Signals that
              function as configuration straps must be augmented with an external resistor when connected to a
              load. Refer to Section 6.3, "Device Configuration Straps," on page 25 for additional information.
DS00001716C-page 14                                                               2012 - 2019 Microchip Technology Inc.


                                                                       USB4604
3.2       Pin Assignments
TABLE 3-2:         48-SQFN PACKAGE PIN ASSIGNMENTS
 Pin Num                    Pin Name        Pin Num           Pin Name
      1                        VBAT            25            SPI_CE_N
      2                         NC             26       SPI_DO/SPI_SPD_SEL
      3            USBDN1_DM/PRT_DIS_M1        27             SPI_CLK
      4            USBDN1_DP/PRT_DIS_P1        28        UART_RX/OCS3_N
      5            USBDN2_DM/PRT_DIS_M2        29        PRTPWR4/PRTCTL4
      6            USBDN2_DP/PRT_DIS_P2        30         UART_TX/OCS4_N
      7                         NC             31          SDA/SMBDATA
      8            USBDN3_DM/PRT_DIS_M3        32              VDD33
      9            USBDN3_DP/PRT_DIS_P3        33           SCL/SMBCLK
     10            USBDN4_DM/PRT_DIS_M4        34                NC
     11            USBDN4_DP/PRT_DIS_P4        35             RESET_N
     12                      VDDA33            36            VBUS_DET
     13                        SOF             37             VDDA33
     14                     SUSPEND            38              VDD12
     15               PRTPWR1/PRTCTL1/         39     FLEX_HSIC_UP_STROBE
     16                      OCS1_N            40   FLEX_USBUP_DM/PRT_DIS_M0
     17                     VDDCR12            41   FLEX_USBUP_DP/PRT_DIS_P0
     18                       VDD33            42       FLEX_HSIC_UP_DATA
     19               PRTPWR2/PRTCTL2/         43              XTAL2
     20                      OCS2_N            44          XTAL1/REFCLK
     21                PRTPWR3/PRTCTL3         45                NC
     22                         NC             46              RBIAS
     23                         NC             47          VDDCOREREG
     24                       SPI_DI           48             VDDA33
 2012 - 2019 Microchip Technology Inc.                               DS00001716C-page 15


USB4604
3.3     Buffer Type Descriptions
TABLE 3-3:      BUFFER TYPES
    Buffer Type                                                Description
          IS        Schmitt-triggered input
       I_RST        Reset Input
       I_SMB        I2C/SMBus Clock Input
         O8         Output with 8 mA sink and 8 mA source
        OD8         Open-drain output with 8 mA sink
         O12        Output with 12 mA sink and 12 mA source
        OD12        Open-drain output with 12 mA sink
        HSIC        High-Speed Inter-Chip (HSIC) USB Specification, Version 1.0 compliant input/output
         PU         50 µA (typical) internal pull-up. Unless otherwise noted in the pin description, internal pull-
                    ups are always enabled.
                      Note:     Internal pull-up resistors prevent unconnected inputs from floating. Do not rely on
                                internal resistors to drive signals external to the device. When connected to a load
                                that must be pulled high, an external resistor must be added.
         PD         50 µA (typical) internal pull-down. Unless otherwise noted in the pin description, internal pull-
                    downs are always enabled.
                      Note:     Internal pull-down resistors prevent unconnected inputs from floating. Do not rely
                                on internal resistors to drive signals external to the device. When connected to a
                                load that must be pulled low, an external resistor must be added.
         AIO        Analog bi-directional
        ICLK        Crystal oscillator input pin
       OCLK         Crystal oscillator output pin
           P        Power pin
DS00001716C-page 16                                                                2012 - 2019 Microchip Technology Inc.


                                                                                                       USB4604
4.0       POWER CONNECTIONS
4.1       Integrated Power Regulators
The integrated 3.3V and 1.2V power regulators provide flexibility to the system in providing power the device. Several
different configurations are allowed in order to align the power structure to supplies available in the system.
The regulators are controlled by RESET_N. When RESET_N is brought high, the 3.3V regulator will turn on. When
RESET_N is brought low the 3.3V regulator will turn off.
4.1.1        3.3V REGULATOR
The device has an integrated regulator to convert from VBAT to 3.3V.
4.1.2        1.2V REGULATOR
The device has an integrated regulator to convert from a variable voltage input on VDDCOREREG to 1.2V. The 1.2V
regulator is tolerant to the presence of low voltage (~0V) on the VDDCOREREG pin in order to support system power
solutions where a supply is not always present in low power states.
The 1.2V regulator supports an input voltage range consistent with a 1.8V input in order to reduce power consumption
in systems which provide multiple power supply levels. In addition, the 1.2V regulator supports an input voltage up to
3.3V for systems which provide only a single power supply. The device will support operation where the 3.3V regulator
output can drive the 1.2V regulator input such that VBAT is the only required supply.
4.2       Power Configurations
The device supports operation with no back current when power is connected in each of the following configurations.
Power connection diagrams for these configurations are included in Section 4.3, "Power Connection Diagrams," on
page 18.
4.2.1        SINGLE SUPPLY CONFIGURATIONS
4.2.1.1        VBAT Only
VBAT must be tied to the VBAT system supply. VDD33, VDDA33, and VDDCOREREG must be tied together on the
board. In this configuration the 3.3V and 1.2V regulators will be active. For HSIC operation, VDD12 must be tied to
VDDCR12.
4.2.1.2        3.3V Only
VBAT must be tied to the 3.3V system supply. VDD33, VDDA33, and VDDCOREREG must be tied together on the
board. In this configuration the 3.3V regulator will operate in dropout mode and the 1.2V regulator will be active. For
HSIC operation, VDD12 must be tied to VDDCR12.
4.2.2        DUAL SUPPLY CONFIGURATIONS
4.2.2.1        VBAT + 1.8V
VBAT must be tied to the VBAT system supply. VDDCOREREG must be tied to the 1.8V system supply. In this config-
uration, the 3.3V regulator and the 1.2V regulator will be active. For HSIC operation, VDD12 must be tied to VDDCR12.
4.2.2.2        3.3V + 1.8V
VBAT must be tied to the 3.3V system supply. VDDCOREREG must be tied to the 1.8V system supply. In this configu-
ration the 3.3V regulator will operate in dropout mode and the 1.2V regulator will be active. For HSIC operation, VDD12
must be tied to VDDCR12.
 2012 - 2019 Microchip Technology Inc.                                                              DS00001716C-page 17


USB4604
4.3       Power Connection Diagrams
Figure 4-1 illustrates the power connections for the USB4604 with various power supply configurations.
FIGURE 4-1:             POWER CONNECTIONS
                                        Single Supply Application
                                                                                                           VDD12
                                      3.3V Internal                          1.2V                  HSIC
                                                             3.3V I/O
                                         Logic                             Core Logic
           VBAT/+3.3V
             Supply
                                                                                                                HSIC Only
                                3.3V Regulator                            1.2V Regulator
                        VBAT
                               (IN)          (OUT)                       (IN)        (OUT)
                4.7uF
                        USB4604          VSS
                                                      VDDA33 VDD33
                                                      (3x)       (2x)   VDDCOREREG             VDDCR12
                                                         1.0uF                                   1.0uF
                           Dual Supply Application (3.3V & 1.8V)
                                                                                                           VDD12
                                      3.3V Internal                          1.2V                  HSIC
                                                             3.3V I/O
                                         Logic                             Core Logic
             +3.3V
             Supply
                                                                                                                HSIC Only
                                3.3V Regulator                            1.2V Regulator
                        VBAT
                               (IN)          (OUT)                       (IN)        (OUT)
                4.7uF
                        USB4604          VSS
                                                      VDDA33 VDD33
                                                      (3x)       (2x)   VDDCOREREG             VDDCR12
                                                                             +1.8V
                                                         1.0uF              Supply               1.0uF
                                                                         4.7uF
  Note:    To achieve the lowest power possible, tie the VDD12 pin to VDD12CR.
DS00001716C-page 18                                                                      2012 - 2019 Microchip Technology Inc.


                                                                                                      USB4604
5.0       MODES OF OPERATION
The device provides two main modes of operation: Standby Mode and Hub Mode. The operating mode of the device is
selected by setting values on primary inputs according to the table below.
TABLE 5-1:         CONTROLLING MODES OF OPERATION
    RESET_N            Resulting
                                                                           Summary
      Input              Mode
         0              Standby         Lowest Power Mode: No functions are active other than monitoring the
                                        RESET_N input. All port interfaces are high impedance. All regulators are
                                        powered off.
         1                Hub           Full Feature Mode: Device operates as a configurable USB hub with battery
                                        charger detection. Power consumption is based on the number of active ports,
                                        their speed, and amount of data transferred.
  Note:     Refer to Section 8.4.2, "External Chip Reset (RESET_N)," on page 37 for additional information on
            RESET_N.
The flowchart in Figure 5-1 shows the modes of operation. It also shows how the device traverses through the Hub
mode stages (shown in bold.) The flow of control is dictated by control register bits shown in italics as well as other
events such as availability of a reference clock. The remaining sections in this chapter provide more detail on each stage
and mode of operation.
 2012 - 2019 Microchip Technology Inc.                                                             DS00001716C-page 19


USB4604
FIGURE 5-1:          HUB OPERATIONAL MODE FLOWCHART
                                                (HW_INIT)
                                                                                  (SW_INIT)
                                       YES       External         NO
                                                 SPI ROM
                                                  present?
                          Run From                                         Run from
                      External SPI ROM                                   Internal ROM
                                         YES     SMBus or I2C
                                                    Present?
                                                            NO
                              Do SMBus or I2C                     Config Load
                                 Initialization                From Internal ROM
                     NO
                                SOC Done?
                                          YES                    Combine OTP
                                                                   Config Data
                    (SOC_CFG)                                                     (CONFIG)
                                                                 SW Upstream
                                                                  BC detection
                                                                   (CHGDET)
                                                                  Hub Connect
                                                                 (Hub.Connect)
                                                                     Normal
                                                                    operation
DS00001716C-page 20                                                           2012 - 2019 Microchip Technology Inc.


                                                                                                       USB4604
5.1        Boot Sequence
5.1.1         STANDBY MODE
If the external hardware reset is asserted, the hub will be in Standby Mode. This mode provides a very low power state
for maximum power efficiency when no signaling is required. This is the lowest power state. In Standby Mode all internal
regulators are powered off, the PLL is not running, and core logic is powered down in order to minimize power consump-
tion. Because core logic is powered off, no configuration settings are retained in this mode and must be re-initialized
after RESET_N is negated high.
5.1.2         HARDWARE INITIALIZATION STAGE (HW_INIT)
The first stage is the initialization stage and occurs on the negation of RESET_N. In this stage the 1.2V regulator is
enabled and stabilizes, internal logic is reset, and the PLL locks if a valid REFCLK is supplied. Configuration registers
are initialized to their default state and strap input values are latched. The device will complete initialization and auto-
matically enter the next stage. Because the digital logic within the device is not yet stable, no communication with the
device using the SMBus is possible. Configuration registers are initialized to their default state.
If there is a REFCLK present, the next state is SW_INIT.
5.1.3         SOFTWARE INITIALIZATION STAGE (SW_INIT)
Once the hardware is initialized, the firmware can begin to execute. The internal firmware checks for an external SPI
ROM. The firmware looks for an external SPI flash device that contains a valid signature of “2DFU” (device firmware
upgrade) beginning at address 0xFFFA. If a valid signature is found, then the external ROM is enabled and the code
execution begins at address 0x0000 in the external SPI device. If a valid signature is not found, then execution continues
from internal ROM. SPI ROMs used with the device must be 1 Mbit and support either 30 MHz or 60 MHz. The frequency
used is set using the SPI_SPD_SEL configuration strap. Both 1- and 2-bit SPI operation is supported. For optimum
throughput, a 2-bit SPI ROM is recommended. Both mode 0 and mode 3 SPI ROMS are also supported. Refer to Sec-
tion 6.3.2, "SPI Speed Select (SPI_SPD_SEL)," on page 26 for additional information on selection of the SPI speed.For
all other configurations, the firmware checks for the presence of an external I2C/SMBus. It does this by asserting two
pull down resistors on the data and clock lines of the bus. The pull downs are typically 50Kohm. If there are 10Kohm
pull-ups present, the device becomes aware of the presence of an external SMBus/I2C bus. If a bus is detected, the
firmware transitions to the SOC_CFG state.
5.1.4         SOC CONFIGURATION STAGE (SOC_CFG)
In this stage, the SOC may modify any of the default configuration settings specified in the integrated ROM such as USB
device descriptors, or port electrical settings, and control features such as upstream battery charging detection.
There is no time limit. In this stage the firmware will wait indefinitely for the SMBus/I2C configuration. When the SOC
has completed configuring the device, it must write to register 0xFF to end the configuration.
5.1.5         CONFIGURATION STAGE (CONFIG)
Once the SOC has indicated that it is done with configuration, then all the configuration data is combined. The default
data, the SOC configuration data, the OTP data are all combined in the firmware and device is programmed.
After the device is fully configured, it will go idle and then into suspend if there is no VBUS or Hub.Connect present.
Once VBUS is present, and upstream battery charging is enabled, the device will transition to the Battery Charger
Detection Stage (CHGDET). If VBUS is present, and upstream battery charging is not enabled, the device will transitions
to the Connect (Hub.Connect) stage.
5.1.6         BATTERY CHARGER DETECTION STAGE (CHGDET)
After configuration, if enabled, the device enters the Battery Charger Detection Stage. If the battery charger detection
feature was disabled during the CONFIG stage, the device will immediately transition to the Hub Connect (Hub.Con-
nect) stage. If the battery charger detection feature remains enabled, the battery charger detection sequence is started
automatically.
If the charger detection remains enabled, the device will transition to the Hub.Connect stage if using the hardware detec-
tion mechanism.
5.1.7         HUB CONNECT STAGE (HUB.CONNECT)
Once the CHGDET stage is completed, the device enters the Hub.Connect stage.
 2012 - 2019 Microchip Technology Inc.                                                              DS00001716C-page 21


USB4604
5.1.8        NORMAL MODE
Lastly the SOC enters the Normal Mode of operation. In this stage, full USB operation is supported under control of the
USB Host on the upstream port. The device will remain in the normal mode until the operating mode is changed by the
system.
If RESET_N is asserted low, then Standby Mode is entered. The device may then be placed into any of the designated
Hub stages. Asserting the soft disconnect on the upstream port will cause the Hub to return to the Hub.Connect stage
until the soft disconnect is negated.
To save power, communication over the SMBus is not supported while in USB Suspend. The system can prevent the
device from going to sleep by asserting the ClkSusp control bit of the Configure Portable Hub Register anytime before
entering USB Suspend. While the device is kept awake during USB Suspend, it will provide the SMBus functionality at
the expense of not meeting USB requirements for average suspend current consumption.
DS00001716C-page 22                                                                2012 - 2019 Microchip Technology Inc.


                                                                                                     USB4604
6.0       DEVICE CONFIGURATION
The device supports a large number of features (some mutually exclusive), and must be configured in order to correctly
function when attached to a USB host controller. The hub can be configured either internally or externally depending on
the implemented interface.
Microchip provides a comprehensive software programming tool, Pro-Touch, for configuring the USB4604 functions,
registers and OTP memory. All configuration is to be performed via the Pro-Touch programming tool. For additional infor-
mation on the Pro-Touch programming tool, contact your local Microchip sales representative.
6.1       Configuration Method Selection
The hub will interface to external memory depending on the configuration of the device pins associated with each inter-
face type. The device will first check whether an external SPI ROM is present. If present, the device will operate entirely
from the external ROM. When an external SPI ROM is not present, the device will check whether the SMBus is config-
ured. When the SMBus is enabled, it can be used to configure the internal device registers via the XDATA address
space, or to program the internal OTP memory. If no external options are detected, the device will operate using the
internal default and configuration strap settings. The order in which device configuration is attempted is summarized
below:
1.   SPI (Reading the configuration from an SPI ROM)
2.   SMBus (either writing the configuration registers in the XDATA address space, or to OTP)
3.   Internal default settings (with or without configuration strap over-rides)
   Note:     Refer to Section 7.0, "Device Interfaces," on page 27 for detailed information on each device configuration
             interface.
6.2       Customer Accessible Functions
The following USB or SMBus accessible functions are available to the customer via the Pro-Touch Programming Tool.
   Note:     For additional programming details, refer to the Pro-Touch Programming Tool User Manual.
6.2.1        USB ACCESSIBLE FUNCTIONS
6.2.1.1        VSM commands over USB
By default, Vendor Specific Messaging (VSM) commands to the hub are enabled. The supported commands are:
•  Enable Embedded Controller
•  Disable Embedded Controller
•  Enable Special Resume
•  Disable Special Resume
•  Reset Hub
6.2.1.2        I2C Master Access over USB
Access to I2C devices is performed as a pass-through operation from the USB Host. The device firmware has no knowl-
edge of the operation of the attached I2C device. The supported commands are:
•  Enable I2C pass through mode
•  Disable I2C pass through mode
•  I2C write
•  I2C read
•  Send I2C start
•  Send I2C stop
 2012 - 2019 Microchip Technology Inc.                                                             DS00001716C-page 23


USB4604
6.2.1.3         SPI Access over USB
Access to an attached SPI device is performed as a pass-through operation from the USB Host. The device firmware
has no knowledge of the operation of the attached SPI device. The supported commands are:
• Enable SPI pass through mode
• Disable SPI pass through mode
• SPI write
• SPI read
  Note:       Refer to Section 7.1, "SPI Interface," on page 27 for additional information on the SPI interface.
6.2.1.4         OTP Access over USB
The OTP ROM in the device is accessible via the USB bus. All OTP parameters can modified via the USB Host. The
OTP operates in Single Ended mode. The supported commands are:
• Enable OTP reset
• Set OTP operating mode
• Set OTP read mode
• Program OTP
• Get OTP status
• Program OTP control parameters
6.2.1.5         Battery Charging Access over USB
The Battery charging behavior of the device can be dynamically changed by the USB Host when something other than
the preprogrammed or OTP programmed behavior is desired. The supported commands are:
• Enable/Disable battery charging
• Upstream battery charging mode control
• Downstream battery charging mode control
• Battery charging timing parameters
• Download custom battery charging algorithm
6.2.1.6         Other Embedded Controller functions over USB
The following miscellaneous functions may be configured via USB:
• Enable/Disable Embedded controller enumeration
• Program Configuration parameters.
• Program descriptor fields:
  - Language ID
  - Manufacturer string
  - Product string
  - idVendor
  - idProduct
  - bcdDevice
6.2.2         SMBUS ACCESSIBLE FUNCTIONS
6.2.2.1         OTP Access over SMBus
The device’s OTP ROM is accessible over SMBus. All OTP parameters can modified via the SMbus Host. The OTP can
be programmed to operate in Single-Ended, Differential, Redundant, or Differential Redundant mode, depending on the
level of reliability required. The supported commands are:
• Enable OTP reset
• Set OTP operating mode
• Set OTP read mode
• Program OTP
DS00001716C-page 24                                                                   2012 - 2019 Microchip Technology Inc.


                                                                                                          USB4604
• Get OTP Status
• Program OTP control parameters
6.2.2.2        Configuration Access over SMBus
The following functions are available over SMBus prior to the hub attaching to the USB host:
• Program Configuration parameters.
• Program descriptor fields:
   - Language ID
   - Manufacturer string
   - Product string
   - idVendor
   - idProduct
   - bcdDevice
• Program Control Register
6.3        Device Configuration Straps
Configuration straps are multi-function pins that are driven as outputs during normal operation. During a Power-On
Reset (POR) or an External Chip Reset (RESET_N), these outputs are tri-stated. The high or low state of the signal is
latched following de-assertion of the reset and is used to determine the default configuration of a particular feature. Con-
figuration straps are latched as a result of a Power-On Reset (POR) or a External Chip Reset (RESET_N). Configuration
strap signals are noted in Section 3.0, "Pin Descriptions," on page 7 and are identified by an underlined symbol name.
The following sub-sections detail the various configuration straps.
Configuration straps include internal resistors in order to prevent the signal from floating when unconnected. If a partic-
ular configuration strap is connected to a load, an external pull-up or pull-down should be used to augment the internal
resistor to ensure that it reaches the required voltage level prior to latching. The internal resistor can also be overridden
by the addition of an external resistor.
   Note:
• The system designer must ensure that configuration straps meet the timing requirements specified in Section
   9.6.2, "Reset and Configuration Strap Timing," on page 45 and Section 9.6.1, "Power-On Configuration Strap
   Valid Timing," on page 45. If configuration straps are not at the correct voltage level prior to being latched, the
   device may capture incorrect strap values.
• Configuration straps must never be driven as inputs. If required, configuration straps can be augmented, or over-
   ridden with external resistors.
6.3.1        PORT DISABLE (PRT_DIS_MX/PRT_DIS_PX)
These configuration straps disable the associated USB ports D- and D+ signals, respectively, where “x” is the USB port
number. Both the negative “M” and positive “P” port disable configuration straps for a given USB port must be tied high
at reset to disable the associated port.
TABLE 6-1:          PRT_DIS_MX/PRT_DIS_PX CONFIGURATION DEFINITIONS
      PRT_DIS_MX/PRT_DIS_PX                                                   Definition
                   ‘0’                    Port x D-/D+ Signal is Enabled (Default)
                   ‘1’                    Port x D-/D+ Signal is Disabled
 2012 - 2019 Microchip Technology Inc.                                                                 DS00001716C-page 25


USB4604
6.3.2        SPI SPEED SELECT (SPI_SPD_SEL)
This strap is used to select the speed of the SPI as follows:
TABLE 6-2:           SPI_SPD_SEL CONFIGURATION DEFINITIONS
            SPI_SPD_SEL                                                       Definition
                    ‘0’                   30 MHz SPI Operation (Default)
                    ‘1’                   60 MHz SPI Operation
  Note:      If the latched value on reset is 1, this pin is tri-stated when the chip is in the suspend state. If the latched
             value on reset is 0, this pin is driven low during a suspend state.
DS00001716C-page 26                                                                      2012 - 2019 Microchip Technology Inc.


                                                                                                                 USB4604
7.0        DEVICE INTERFACES
The USB4604 provides multiple interfaces for configuration and external memory access. This chapter details the var-
ious device interfaces and their usage.
   Note:     For information on device configuration, refer to Section 6.0, "Device Configuration," on page 23.
7.1        SPI Interface
The device is capable of code execution from an external SPI ROM. On power up, the firmware looks for an external
SPI flash device that contains a valid signature of 2DFU (device firmware upgrade) beginning at address 0xFFFA. If a
valid signature is found, then the external ROM is enabled and the code execution begins at address 0x0000 in the
external SPI device. If a valid signature is not found, then execution continues from internal ROM. The following sections
describe the interface options to the external SPI ROM.
The SPI interface is always enabled after reset. It can be disabled by setting the SPI_DISABLE bit in the UTIL_CON-
FIG1 register.
   Note:     For SPI timing information, refer to Section 9.6.7, "SPI Timing," on page 46.
7.1.1        OPERATION OF THE HI-SPEED READ SEQUENCE
The SPI controller will automatically handle code reads going out to the SPI ROM address. When the controller detects
a read, the controller drives SPI_CE_N low, and outputs 0x0B, followed by the 24-bit address. The SPI controller outputs
a DUMMY byte. The next eight clocks will clock-in the first byte. When the first byte is clocked-in, a ready signal is sent
back to the processor, and the processor gets one byte.
After the processor gets the first byte, its address will change. If the address is one more than the last address, the SPI
controller will clock out one more byte. If the address is anything other than one more than the last address, the SPI
controller will terminate the transaction by driving SPI_CE_N high. As long as the addresses are sequential, the SPI
Controller will continue clocking data in.
FIGURE 7-1:              SPI HI-SPEED READ SEQUENCE
 SPI_CE_N
                            0 1 2 3 4 5 6 7 8           15 16    23 24     31 32   39 40    47 48     55 56     63 64     71 72     80
  SPI_CLK
   SPI_DO                           0B             ADD.      ADD.     ADD.       X
                            MSB                  MSB
                                                                                         N        N+1       N+2       N+3       N+4
                                        HIGH IMPEDANCE
     SPI_DI                                                                            DOUT     DOUT       DOUT      DOUT      DOUT
                                                                                     MSB
7.1.2        OPERATION OF THE DUAL HIGH SPEED READ SEQUENCE
The SPI controller also supports dual data mode. When configured in dual mode, the SPI controller will automatically
handle XDATA reads going out to the SPI ROM. When the controller detects a read, the controller drives SPI_CE_N low
and outputs 0x3B (the value must be programmed into the SPI_ FR_OPCODE Register) followed by the 24 bit address.
Bits 23 through Bit 17 are forced to zero, and address bits 16 through 0 are directly from the XDATA address bus.
Because it is in fast read mode, the SPI controller then outputs a DUMMY byte. The next four clocks will clock-in the
first byte. The data appears two bits at a time on SPI_DO and SPI_DI. When the first byte is clocked in, a ready signal
is sent back to the processor, and the processor gets one byte.
 2012 - 2019 Microchip Technology Inc.                                                                        DS00001716C-page 27


USB4604
After the processor gets the first byte, its address will change. If the address is one more than the last address, the SPI
controller will clock out one more byte. If the address in anything other than one more than the last address, the SPI
controller will terminate the transaction by driving SPI_CE_N high. As long as the addresses are sequential, the SPI
Controller will continue clocking data in.
FIGURE 7-2:              SPI DUAL HI-SPEED READ SEQUENCE
 SPI_CE_N
                            0 1 2 3 4 5 6 7 8          15 16    23 24     31 32   39 40         43 44        47 48         51 52         55 56        59
   SPI_CLK
                                                                                           N           N+1           N+2          N+3           N+4
                                   0B             ADD.      ADD.     ADD.       X       D1            D2             D3           D4            D5
    SPI_DO                                                                           Bits-6,4,2,0  Bits-6,4,2,0 Bits-6,4,2,0  Bits-6,4,2,0  Bits-6,4,2,0
                            MSB                 MSB
                                                                                    MSB
                                                                                           N            N+1          N+2           N+3          N+4
                                       HIGH IMPEDANCE                                    D1            D2            D3            D4            D5
     SPI_DI                                                                          Bits-7,5,3,1  Bits-7,5,3,1  Bits-7,5,3,1  Bits-7,5,3,1 Bits-7,5,3,1
                                                                                    MSB
7.1.3        32 BYTE CACHE
There is a 32-byte pipeline cache with an associated base address pointer and length pointer. Once the SPI controller
detects a jump, the base address pointer is initialized to that address. As each new sequential data byte is fetched, the
data is written into the cache and the length is incremented. If the sequential run exceeds 32 bytes, the base address
pointer is incremented to indicate the last 32 bytes fetched. If the firmware performs a jump, and the jump is in the cache
address range, the fetch is done in 1 clock from the internal cache instead of an external access.
7.1.4        INTERFACE OPERATION TO THE SPI PORT WHEN NOT PERFORMING FAST READS
There is a 8-byte command buffer (SPI_CMD_BUF[7:0]), an 8-byte response buffer (SPI_RESP_BUF[7:0]), and a
length register that counts out the number of bytes (SPI_CMD_LEN). Additionally, there is a self-clearing GO bit in the
SPI_CTL register. Once the GO bit is set, device drives SPI_CE_N low and starts clocking. It will then output SPI_CM-
D_LEN x 8 number of clocks. After the first COMMAND byte has been sent out, the SPI_DI input is stored in the
SPI_RESP buffer. If the SPI_CMD_LEN is longer than the SPI_CMD_BUF, don’t cares are sent out on the SPI_DO out-
put.
This mode is used for program execution out of internal RAM or ROM.
Automatic reads and writes happen when there is an external XDATA read or write, using the serial stream that has
been previously discussed.
DS00001716C-page 28                                                                             2012 - 2019 Microchip Technology Inc.


                                                                                                             USB4604
7.1.5         ERASE EXAMPLE
To perform a SCTR_ERASE, 32BLK_ERASE, or 64BLK_ERASE, the device writes 0x20, 0x52, or 0xD8, respectively
to the first byte of the command buffer, followed by a 3-byte address. The length of the transfer is set to 4 bytes. To
perform this, the device drives SPI_CE_N low, then counts out 8 clocks. It then outputs on SPI_DO the 8 bits of com-
mand, followed by 24 bits of address of the location to be erased. When the transfer is complete, SPI_CE_N goes high,
while the SPI_DI line is ignored in this example.
FIGURE 7-3:               SPI ERASE SEQUENCE
                 SPI_CE_N
                                                   0 1 2 3 4 5 6 7 8                15 16    23 24       31
                   SPI_CLK
                    SPI_DO                               Command               ADD.      ADD.       ADD.
                                                  MSB                       MSB
                                                                   HIGH IMPEDANCE
                      SPI_DI
7.1.6         BYTE PROGRAM EXAMPLE
To perform a Byte Program, the device writes 0x02 to the first byte of the command buffer, followed by a 3-byte address
of the location that will be written to, and one data byte. The length of the transfer is set to 5 bytes. The device first drives
SPI_CE_N low, then SPI_DO outputs 8 bits of command, followed by 24 bits of address, and one byte of data. SPI_DI
is not used in this example.
FIGURE 7-4:               SPI BYTE PROGRAM SEQUENCE
             SPI_CE_N
                                                0 1 2 3 4 5 6 7 8                15 16    23 24      31 32     39
               SPI_CLK
                                                                                                0xFE
                                                         0xDB               0x00      0xBF                Data
                SPI_DO                                                                          /0xFF
                                               MSB                       MSB                           MSB     LSB
                                                               HIGH IMPEDANCE
                  SPI_DI
 2012 - 2019 Microchip Technology Inc.                                                                    DS00001716C-page 29


USB4604
7.1.7         COMMAND ONLY PROGRAM EXAMPLE
To perform a single byte command such as the following:
•  - WRDI
•  - WREN
•  - EWSR
•  - CHIP_ERASE
•  - EBSY
•  - DBSY
The device writes the opcode into the first byte of the SPI_CMD_BUF and the SPI_CMD_LEN is set to one. The device
first drives SPI_CE_N low, then 8 bits of the command are clocked out on SPI_DO. SPI_DI is not used in this example.
FIGURE 7-5:            SPI COMMAND ONLY SEQUENCE
                   SPI_CE_N
                                                             0 1 2 3 4 5 6 7
                     SPI_CLK
                       SPI_DO                                     Command
                                                             MSB
                        SPI_DI                                       HIGH IMPEDANCE
DS00001716C-page 30                                                             2012 - 2019 Microchip Technology Inc.


                                                                                                           USB4604
7.1.8         JEDEC-ID READ EXAMPLE
To perform a JEDEC-ID command, the device writes 0x9F into the first byte of the SPI_CMD_BUF. The length of the
transfer is 4 bytes. The device first drives SPI_CE_N low, then SPI_DO is output with 8 bits of the command, followed
by the 24 bits of dummy bytes (due to the length being set to 4). When the transfer is complete, SPI_CE_N goes high.
After the first byte, the data on SPI_DI is clocked into the SPI_RSP_BUF. At the end of the command, there are three
valid bytes in the SPI_RSP_BUF. In this example, 0xBF, 0x25, 0x8E.
FIGURE 7-6:                SPI JEDEC-ID READ SEQUENCE
 SPI_CE_N
                                0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34
    SPI_CLK
     SPI_DO                            9F
                                MSB
                 HIGH IMPEDANCE
      SPI_DI                                              BF                   25                       8E
                                                 MSB                  MSB
7.2       I2C Master Interface
The I2C master interface implements a subset of the I2C Master Specification (Please refer to the Philips Semiconductor
Standard I2C-Bus Specification for details on I2C bus protocols). The device’s I2C master interface conforms to the Stan-
dard-Mode I2C Specification (100 kbit/s transfer rate and 7-bit addressing) for protocol and electrical compatibility. The
device acts as the master and generates the serial clock SCL, controls the bus access (determines which device acts
as the transmitter and which device acts as the receiver), and generates the START and STOP conditions.
   Note:
• Extensions to the I2C Specification are not supported.
• All device configuration must be performed via the Pro-Touch Programming Tool. For additional information on
   the Pro-Touch programming tool, contact your local sales representative.
 2012 - 2019 Microchip Technology Inc.                                                                  DS00001716C-page 31


USB4604
7.2.1           I2C MESSAGE FORMAT
7.2.1.1           Sequential Access Writes
The  I2C   interface supports sequential writing of the device’s register address space. This mode is useful for configuring
contiguous blocks of registers. Figure 7-7 shows the format of the sequential write operation. Where color is visible in
the figure, blue indicates signaling from the I2C master, and gray indicates signaling from the slave.
FIGURE 7-7:                 I2C SEQUENTIAL ACCESS WRITE FORMAT
    S     7-Bit Slave Address        0   A     xxxxxxxx     A    nnnnnnnn       A             ...      nnnnnnnn        A     P
                                               Register        Data value for                      Data value for
                                               Address           XXXXXX                            XXXXXX + y
                                              (bits 7-0)
In this operation, following the 7-bit slave address, the 8-bit register address is written indicating the start address for
sequential write operation. Every subsequent access is a data write to a data register, where the register address incre-
ments after each access and an ACK from the slave occurs. Sequential write access is terminated by a Stop condition.
7.2.1.2           Sequential Access Reads
The   I2C   interface supports direct reading of the device registers. In order to read one or more register addresses, the
starting address must be set by using a write sequence followed by a read. The read register interface supports auto-
increment mode. The master must send a NACK instead of an ACK when the last byte has been transferred.
In this operation, following the 7-bit slave address, the 8-bit register address is written indicating the start address for
the subsequent sequential read operation. In the read sequence, every data access is a data read from a data register
where the register address increments after each access. The write sequence can end with optional Stop (P). If so, the
read sequence must begin with a Start (S). Otherwise, the read sequence must start with a Repeated Start (Sr).
Figure 7-8 shows the format of the read operation. Where color is visible in the figure, blue and gold indicate signaling
from the I2C master, and gray indicates signaling from the slave.
FIGURE 7-8:                 I2C SEQUENTIAL ACCESS READ FORMAT
                                                                  Optional. If present, Next
                                                                  access must have Start(S),
                                                                  otherwise Repeat Start (Sr)
    S     7-Bit Slave Address     0    A   xxxxxxxx     A    P
                                          Register
                                          Address
                                          (bits 7-0)
         If previous write setting up
         Register address ended with a
         Stop (P), otherwise it will be
         Repeated Start (Sr)
    S     7-Bit Slave Address     1   ACK    nnnnnnnn         ACK    nnnnnnnn          ACK    ...  nnnnnnnn          NACK    P
                                             Register value          Register value                  Register value
                                              for xxxxxxxx          for xxxxxxxx + 1                for xxxxxxxx + y
7.2.2           PULL-UP RESISTORS FOR I2C
The circuit board designer is required to place external pull-up resistors (10 k recommended) on the SDA & SCL sig-
nals (per SMBus 1.0 Specification) to Vcc in order to assure proper operation.
DS00001716C-page 32                                                                           2012 - 2019 Microchip Technology Inc.


                                                                                                   USB4604
7.3       SMBus Slave Interface
The USB4604 includes an integrated SMBus slave interface, which can be used to access internal device run time reg-
isters or program the internal OTP memory. SMBus detection is accomplished by detection of pull-up resistors (10 K
recommended) on both the SMBDATA and SMBCLK signals. To disable the SMBus, a pull-down resistor of 10 K must
be applied to SMBDATA. The SMBus interface can be used to configure the device as detailed in Section 6.1, "Config-
uration Method Selection," on page 23.
   Note:     All device configuration must be performed via the Pro-Touch Programming Tool. For additional information
             on the Pro-Touch programming tool, contact your local Microchip sales representative.
 2012 - 2019 Microchip Technology Inc.                                                          DS00001716C-page 33


USB4604
8.0       FUNCTIONAL DESCRIPTIONS
This chapter provides additional functional descriptions of key device features.
8.1       Battery Charger Detection & Charging
The USB4604 supports both upstream battery charger detection and downstream battery charging. The integrated bat-
tery charger detection circuitry supports the USB-IF Battery Charging (BC1.2) detection method and most Apple
devices. These circuits are used to detect the attachment and type of a USB charger and provide an interrupt output to
indicate charger information is available to be read from the device’s status registers via the serial interface. The
USB4604 provides the battery charging handshake and supports the following USB-IF BC1.2 charging profiles:
•  DCP: Dedicated Charging Port (Power brick with no data)
•  CDP: Charging Downstream Port (1.5A with data)
•  SDP: Standard Downstream Port (0.5A with data)
•  Custom profiles loaded via SMBus or OTP
The following sub-sections detail the upstream battery charger detection and downstream battery charging features.
8.1.1        UPSTREAM BATTERY CHARGER DETECTION
Battery charger detection is available on the upstream facing port. The detection sequence is intended to identify char-
gers which conform to the Chinese battery charger specification, chargers which conform to the USB-IF Battery Charger
Specification 1.2, and most Apple devices.
In order to detect the charger, the device applies and monitors voltages on the upstream DP and DM pins. If a voltage
within the specified range is detected, the device will be updated to reflect the proper status.
The device includes the circuitry required to implement battery charging detection using the Battery Charging Specifi-
cation. When enabled, the device will automatically perform charger detection upon entering the Hub.ChgDet stage in
Hub Mode. The device includes a state machine to provide the detection of the USB chargers listed in the table below.
TABLE 8-1:          CHARGERS COMPATIBLE WITH UPSTREAM DETECTION
                 USB Attach TypeE                                 DP/DM Profile                     Charger Type
 DCP (Dedicated Charging Port)                                  Shorted < 200ohm                          001
 CDP (Charging Downstream Port)                               VDP reflected to VDM                        010
                                                                                                (EnhancedChrgDet = 1)
 SDP                                                    15Kohm pull-down on DP and DM                      011
 (Standard Downstream Port)
 USB Host or downstream hub port
  Apple Low Current Charger                                            Apple                              100
  Apple High Current Charger                                           Apple                              101
  Apple Super High Current Charger                                   DP=2.7V                               110
                                                                     DM=2.0V
  Apple Charger Low Current Charger (500mA)                          DP=2.0V                              100
                                                                     DM=2.0V
  Apple Charger High Current Charger (1000mA)                        DP=2.0V                              101
                                                                     DM=2.7V
If a custom charger detection algorithm is desired, the SMBus registers can also be used to control the charger detection
block to implement a custom charger detection algorithm. In order to avoid negative interactions with automatic battery
charger detection or normal hub operation, the user should only attempt Custom battery charger detection during the
Hub.Config stage or Hub.Connect stage. No logic is implemented to disable custom detection at other times - it is up to
the user software to observe this restriction.
There is a possibility that the system is not running the reference clock when battery charger detection is required (for
example if the battery is dead or missing). During the Hub.WaitRefClk stage the battery charger detection sequence can
be configured to be followed regardless of the activity of REFCLK by relying on the operation of the internal oscillator.
   Note:     Battery charger detection is not available when utilizing HSIC on the upstream port.
DS00001716C-page 34                                                                   2012 - 2019 Microchip Technology Inc.


                                                                                                     USB4604
8.1.2        DOWNSTREAM BATTERY CHARGING
The device can be configured by an OEM to have any of the downstream ports to support battery charging. The Hub's
role in battery charging is to provide an acknowledge to a device's query as to if the hub system supports USB battery
charging. The hub silicon does not provide any current or power FETs or any additional circuitry to actually charge the
device. Those components must be provided as externally by the OEM.
FIGURE 8-1:             BATTERY CHARGING EXTERNAL POWER SUPPLY
                                                                            DC Power
                              INT
                              SCL
                                Microchip
                              SDA     SOC
                                   Hub            PRTPWR[n]
                                                                                VBUS[n]
If the OEM provides an external supply capable of supplying current per the battery charging specification, the hub can
be configured to indicate the presence of such a supply to the device. This indication, via the PRTPWR[1:4] output pins,
is on a per/port basis. For example, the OEM can configure two ports to support battery charging through high current
power FET's and leave the other two ports as standard USB ports.
    Note:    Battery charging is not available on downstream HSIC ports.
8.1.2.1        Downstream Battery Charging Modes
In the terminology of the USB Battery Charging Specification, if a port is configured to support battery charging, the
downstream port is a considered a CDP (Charging Downstream Port) if connected to a USB host, or a DCP (Dedicated
Charging Port) if not connected to a USB host. If the port is not configured to support battery charging, the port is con-
sidered an SDP (Standard Downstream Port). All charging ports have electrical characteristics different from standard
non-charging ports.
A downstream port will behave as a CDP, DCP, or SDP depending on the port’s configuration and mode of operation.
The port will not switch between a CDP/DCP or SDP at any time after initial power-up and configuration. A downstream
port can be in one of three modes shown in the table below.
TABLE 8-2:         DOWNSTREAM PORT TYPES
              USB Attach Type                                DP/DM Profile
                    DCP                                Apple charging mode or
          (Dedicated Charging Port)               China Mode (Shorted < 200ohm) or
                                                         MCHP custom mode
                    CDP                                 VDP reflected to VDM
        (Charging Downstream Port)
                    SDP                            15Kohm pull-down on DP and DM
        (Standard Downstream Port)
     USB Host or downstream hub port
8.1.2.2        Downstream Battery Charging Configuration
Configuration of ports to support battery charging is performed via USB configuration, SMBus configuration, or OTP.
The Battery Charging Enable Register provides per port battery charging configuration. Starting from bit 1, this register
enables battery charging for each down stream port when asserted. Bit 1 represents port 1 and so on. Each port with
battery charging enabled asserts the corresponding PRTPWR register bit.
 2012 - 2019 Microchip Technology Inc.                                                            DS00001716C-page 35


USB4604
8.1.2.3             Downstream Over-Current Management
It is the devices responsibility to manage over-current conditions. Over-Current Sense (OCS) is handled according to
the USB specification. For battery charging ports, PRTPWR is driven high (asserted) after hardware initialization. If an
OCS event occurs, the PRTPWR is negated. PRTPWR will be negated for all ports in a ganged configuration. Only the
respective PRTPWR will be negated in the individual configuration.
If there is an over-current event in DCP mode, the port is turned off for one second and is then re-enabled. If the OCS
event persists, the cycle is repeated for a total or three times. If after three attempts, the OCS still persists, the cycle is
still repeated, but with a retry interval of ten seconds. This retry persists for indefinitely. The indefinite retry prevents a
defective device from permanently disabling the port.
In CDP or SDP mode, the port power and over-current events are controlled by the USB host. The OCS event does not
have to be registered. When and if the hub is connected to a host, the host will initialize the hub and enable its port
power. If the over current still exists, it will be notified at that point.
8.2            SOF Clock Output
The USB4604 provides an 8Khz clock output synchronized to the USB host SOFs. The SOF output is generated from
the previous SOF packet on the USB line. The device includes an internal free running frame counter to generate inter-
nal start of frame and end of frame events. The internal counter is re-synchronized every time a successful packet is
received and decoded. The internal counter is advanced to compensate for the packet decode time. If the incoming SOF
jitters early or late, the jitter will be visible in the next frame SOF output clock rising edge.
If one or two SOFs are missing, the SOF output will continue based on the internal frame counter. If more than two SOF
are missing, the SOF output signal will stop. The clock is ensured to stop in a low state. When enabled or disabled, there
will never be a short cycle.
FIGURE 8-2:                SOF OUTPUT TIMING
     Upstream HS USB
                                                                  EOF1                                     EOF1
                                                                    EOF2                                     EOF2
                                  SOF packet accepted                      SOF packet accepted
                                                                       SOF                                      SOF
     Internal frame
     counter events
     SOF (kHz)
DS00001716C-page 36                                                                             2012 - 2019 Microchip Technology Inc.


                                                                                                        USB4604
8.3        Flex Connect
This feature allows the upstream port to be swapped with downstream physical port 1. Only downstream port 1 can be
swapped physically. Using port remapping, any logical port (number assignment) can be swapped with the upstream
port (non-physical).
Flex Connect is enabled/disabled via two control bits in the Connect Configuration Register. The FLEXCONNECT con-
figuration bit switches the port, and EN_FLEX_MODE enables the mode.
8.3.1         PORT CONTROL
Once EN_FLEX_MODE bit is set, the functions of certain pins change, as outlined below.
If EN_FLEX_MODE is set and FLEXCONNECT is not set:
1.   PRTPWR1 enters combined mode, becoming PRTPWR1/OCS1_N
2.   OCS1_N becomes a don’t care
3.   SUSPEND outputs ‘0’ to keep any upstream power controller off
If EN_FLEX_MODE is set and FLEXCONNECT is set:
1.   The normal upstream VBUS pin becomes a don’t care
2.   PRTPWR1 is forced to a ‘1’ in combined mode, keeping the port power on to the application processor.
3.   OCS1 becomes VBUS from the application processor through a GPIO
4.   SUSPEND becomes PRTPWR1/OCS1_N for the port power controller for the connector port
8.4        Resets
The device has the following chip level reset sources:
• Power-On Reset (POR)
• External Chip Reset (RESET_N)
• USB Bus Reset
8.4.1         POWER-ON RESET (POR)
A power-on reset occurs whenever power is initially supplied to the device, or if power is removed and reapplied to the
device. A timer within the device will assert the internal reset per the specifications listed in Section 9.6.1, "Power-On
Configuration Strap Valid Timing," on page 45.
8.4.2         EXTERNAL CHIP RESET (RESET_N)
A valid hardware reset is defined as assertion of RESET_N, after all power supplies are within operating range, per the
specifications in Section 9.6.2, "Reset and Configuration Strap Timing," on page 45. While reset is asserted, the device
(and its associated external circuitry) enters Standby Mode and consumes minimal current.
Assertion of RESET_N causes the following:
1.   The PHY is disabled and the differential pairs will be in a high-impedance state.
2.   All transactions immediately terminate; no states are saved.
3.   All internal registers return to the default state.
4.   The external crystal oscillator is halted.
5.   The PLL is halted.
6.   The HSIC Strobe and Data pins are driven low.
   Note:      All power supplies must have reached the operating levels mandated in Section 9.2, "Operating Condi-
              tions**," on page 40, prior to (or coincident with) the assertion of RESET_N.
 2012 - 2019 Microchip Technology Inc.                                                               DS00001716C-page 37


USB4604
8.4.3         USB BUS RESET
In response to the upstream port signaling a reset to the device, the device performs the following:
    Note:     The device does not propagate the upstream USB reset to downstream devices.
1.    Sets default address to 0.
2.    Sets configuration to: Unconfigured.
3.    Moves device from suspended to active (if suspended).
4.    Complies with Section 11.10 of the USB 2.0 Specification for behavior after completion of the reset sequence.
The host then configures the device in accordance with the USB Specification.
8.5         Link Power Management (LPM)
The device supports the L0 (On), L1 (Sleep), and L2 (Suspend) link power management states per the USB 2.0 Link
Power Management Addendum. These supported LPM states offer low transitional latencies in the tens of microsec-
onds versus the much longer latencies of the traditional USB suspend/resume in the tens of milliseconds. The supported
LPM states are detailed in Table 8-3. For additional information, refer to the USB 2.0 Link Power Management Adden-
dum.
TABLE 8-3:           LPM STATE DEFINITIONS
        State                          Description                                  Entry/Exit Time to L0
          L2          Suspend                                         Entry: ~3 ms
                                                                      Exit: ~2 ms
          L1          Sleep                                           Entry: ~65 us
                                                                      Exit: ~100 us
          L0          Fully Enabled (On)                              -
    Note:
• State change timing is approximate and is measured by change in power consumption.
• System clocks are stopped only in suspend mode or when power is removed from the device.
8.6         Suspend (SUSPEND)
When enabled, the SUSPEND signal can be used to indicate that the entire hub has entered the USB suspend state
and that VBUS current consumption should be reduced in accordance with the USB specification. Selective suspend
set by the host on downstream hub ports have no effect on this signal because there is no requirement to reduce current
consumption from the upstream VBUS. Suspend can be used by the system to monitor and dynamically adjust how
much current the PMIC draws from VBUS to charge the battery in the system during a USB session. Because it is a
level indication, it will assert or negate to reflect the current status of suspend without any interaction through the
SMBus.
A negation of this signal indicates no level suspend interrupt and device has been configured by the USB Host. The full
configured current can be drawn from the USB VBUS pin on the USB connector for charging - up to 500mA - depending
on descriptor settings. When asserted, this signal indicates a suspend interrupt or that the device has not yet been con-
figured by USB Host. The current draw can be limited by the system according to the USB specification. The USB spec-
ification limits current to 100mA before configuration, and up to 12.5mA in USB suspend mode.
DS00001716C-page 38                                                                  2012 - 2019 Microchip Technology Inc.


                                                                                                                                              USB4604
9.0       OPERATIONAL CHARACTERISTICS
9.1       Absolute Maximum Ratings*
VBAT Supply Voltage (Note 9-1).................................................................................................................. 0 V to +5.5 V
VDDCOREREG Supply Voltage (Note 9-1) ................................................................................................. 0 V to +3.6 V
Positive voltage on input signal pins, with respect to ground (Note 9-2)...................................................................3.6 V
Negative voltage on input signal pins, with respect to ground (Note 9-3) ................................................................-0.5 V
Positive voltage on XTAL1/REFCLK, with respect to ground........................................................................... VDDCR12
Positive voltage on HSIC signals, with respect to ground....................................................................................... 1.32 V
Positive voltage on USB DP/DM signals, with respect to ground (Note 9-4) ............................................................5.5 V
Storage Temperature ..............................................................................................................................-55oC to +150oC
Lead Temperature Range ........................................................................................... Refer to JEDEC Spec. J-STD-020
HBM ESD Performance ........................................................................................................................ .JEDEC Class 3A
  Note 9-1       When powering this device from laboratory or system power supplies, it is important that the absolute
                 maximum ratings not be exceeded or device failure can result. Some power supplies exhibit voltage
                 spikes on their outputs when AC power is switched on or off. In addition, voltage transients on the
                 AC power line may appear on the DC output. If this possibility exists, it is suggested to use a clamp
                 circuit.
  Note 9-2       This rating does not apply to the following signals: All USB DM/DP pins, XTAL1/REFCLK, XTAL2,
                 and all HSIC signals.
  Note 9-3       This rating does not apply to the HSIC signals.
  Note 9-4       This rating applies only when VDD33 is powered.
*Stresses exceeding those listed in this section could cause permanent damage to the device. This is a stress rating
only. Exposure to absolute maximum rating conditions for extended periods may affect device reliability. Functional
operation of the device at any condition exceeding those indicated in Section 9.2, "Operating Conditions**", Section 9.5,
"DC Specifications", or any other applicable section of this specification is not implied. Note, device signals are NOT 5
volt tolerant unless specified otherwise.
 2012 - 2019 Microchip Technology Inc.                                                                                                    DS00001716C-page 39


USB4604
9.2      Operating Conditions**
VBAT Supply Voltage .............................................................................................................................. +3.0 V to +5.5 V
VDDCOREREG Supply Voltage.......................................................................................................................... Note 9-5
Power Supply Rise Time ..................................................................................................................................... Note 9-6
Ambient Operating Temperature in Still Air (TA) ................................................................................................. Note 9-7
  Note 9-5       +1.6 V to +2.0 V when VDDCOREREG is connected to an external +1.8V power supply, +3.0 V to
                 +3.6 V when VDDCOREREG is connected to VDD33.
  Note 9-6       The power supply rise time requirements vary dependent on the usage of the external reset
                 (RESET_N). If RESET_N is asserted at power-on, the power supply rise time must be 10mS or less
                 (tRT(max) = 10mS). If RESET_N is not used at power-on (tied high), the power supply rise time must
                 be 1mS or less (tRT(max) = 1mS). Higher voltage supplies must always be at an equal or higher
                 voltage than lower voltage supplies. Figure 9-1 illustrates the supply rise time requirements.
  Note 9-7       0oC to +70oC for commercial version, -40oC to +85oC for industrial version.
**Proper operation of the device is ensured only within the ranges specified in this section.
FIGURE 9-1:             SINGLE/DUAL SUPPLY RISE TIME MODELS
 Voltage                                                                             Voltage
                           tRT                                                                                              tRT
                                                       3.3V/VBAT                                                                                            3.3V
  VBAT                                                            100%                 VBAT                                                                      100%
                                                 90%                                                                                               90%
                                                                                                                                                            1.8V
                                                                            VDDCOREREG                                                                           100%
                                                                                                                                                   90%
         10%                                                                                       10%
   VSS                                                                                  VSS
             t10%                             t90%         Time                                         t10%                                    t90%       Time
             Single Supply Rise Time Model                                                               Dual Supply Rise Time Model
DS00001716C-page 40                                                                                                2012 - 2019 Microchip Technology Inc.


                                                                                                 USB4604
9.3       Power Consumption
This section details the power consumption of the device as measured during various modes of operation. Power dis-
sipation is determined by temperature, supply voltage, and external source/sink requirements.
9.3.1        OPERATIONAL / UNCONFIGURED
9.3.1.1        HSIC Upstream
TABLE 9-1:         OPERATIONAL/UNCONFIGURED POWER CONSUMPTION (HSIC UPSTREAM)
                                                     Typical (mA)                         Maximum (mA)
                                                             VDDCOREREG                            VDDCOREREG
                                               VBAT                                   VBAT
                                                               (Note 9-8)                            (Note 9-8)
 HS Host / 1 HS Device                           30                40                  35                45
 HS Host / 2 HS Devices                          50                50                  60                55
 HS Host / 4 HS Devices                          90                60                  100               70
 HS Host / 1 FS Device                           15                30                  20                40
 HS Host / 2 FS Devices                          20                35                  20                45
 HS Host / 4 FS Devices                          20                40                  25                50
 Unconfigured                                    10                20                   -                 -
   Note 9-8      Includes VDD12 current.
9.3.1.2        USB Upstream
TABLE 9-2:         OPERATIONAL/UNCONFIGURED POWER CONSUMPTION (USB UPSTREAM)
                                                     Typical (mA)                         Maximum (mA)
                                               VBAT          VDDCOREREG               VBAT         VDDCOREREG
 HS Host / 1 HS Device                           30                40                  40                45
 HS Host / 2 HS Devices                          55                50                  65                55
 HS Host / 4 HS Devices                         100                65                  105               75
 HS Host / 1 FS Device                           20                30                  25                40
 HS Host / 2 FS Devices                          20                40                  30                40
 HS Host / 4 FS Devices                          25                40                  30                45
 Unconfigured                                    10                20                   -                 -
   Note 9-9      Includes VDD12 current.
9.3.2        SUSPEND / STANDBY
9.3.2.1        Single Supply
The following tables detail the device power consumption when configured with a single VBAT supply and an externally
supplied VDD12 for HSIC (when applicable) For additional information on power connections, refer to Section 4.0,
"Power Connections," on page 17.
9.3.2.1.1         USB Upstream
TABLE 9-3:         SINGLE SUPPLY SUSPEND/STANDBY POWER CONSUMPTION (USB UPSTREAM)
       Mode                Symbol         Typical @ 25oC      Commercial MAX         Industrial MAX         Unit
      Suspend                IVBAT               320                 1200                  2000             uA
      Standby                IVBAT               0.4                  2.0                   2.4             uA
 2012 - 2019 Microchip Technology Inc.                                                         DS00001716C-page 41


USB4604
  Note:    Typical values measured with VBAT = 4.2V. Maximum values measured with VBAT = 5.5V.
9.3.2.1.2       HSIC Upstream
TABLE 9-4:        SINGLE SUPPLY SUSPEND/STANDBY POWER CONSUMPTION (HSIC UPSTREAM)
       Mode               Symbol          Typical @ 25oC     Commercial MAX     Industrial MAX          Unit
                            IVBAT              120                  1200              1500               uA
     Suspend
                           IVDD12                5                  550                750               uA
      Standby               IVBAT               0.2                  1.9               2.2               uA
  Note:    Typical values measured with VBAT = 4.2V, VDD12 = 1.2V. Maximum values measured with VBAT = 5.5V,
           VDD12 = 1.32V.
9.3.2.2      Dual Supply
The following tables detail the device power consumption when configured with a dual supply (VBAT and 1.8V
VDDCOREREG) and an externally supplied VDD12 for HSIC (when applicable) For additional information on power
connections, refer to Section 4.0, "Power Connections," on page 17.
9.3.2.2.1       USB Upstream
TABLE 9-5:        DUAL SUPPLY SUSPEND/STANDBY POWER CONSUMPTION (USB UPSTREAM)
       Mode               Symbol          Typical @ 25oC     Commercial MAX     Industrial MAX          Unit
                       IVDDCOREREG              80                  900               1350               uA
     Suspend
                            IVBAT              230                  400                400               uA
                       IVDDCOREREG              0.1                  1.2               2.5               uA
      Standby
                            IVBAT               0.4                  2.1               2.5               uA
  Note:    Typical values measured with VBAT = 4.2V, VDDCOREREG = 1.8V. Maximum values measured with VBAT
           = 5.5V, VDDCOREREG = 2.0V.
9.3.2.2.2       HSIC Upstream
TABLE 9-6:        DUAL SUPPLY SUSPEND/STANDBY POWER CONSUMPTION (USB UPSTREAM)
       Mode               Symbol          Typical @ 25oC     Commercial MAX     Industrial MAX          Unit
                       IVDDCOREREG              90                  900               1300               uA
     Suspend                IVBAT               30                  500                750               uA
                           IVDD12               5.5                 650               1100               uA
                       IVDDCOREREG              0.1                  1.2               2.5               uA
      Standby
                            IVBAT               0.4                  2.1               2.5               uA
  Note:    Typical values measured with VBAT = 4.2V, VDDCOREREG = 1.8V, VDD12 = 1.2V. Maximum values mea-
           sured with VBAT = 5.5V, VDDCOREREG = 2.0V, VDD12 = 1.32V.
DS00001716C-page 42                                                          2012 - 2019 Microchip Technology Inc.


                                                                                               USB4604
9.4       Package Thermal Specifications
Thermal parameters are measured or estimated for devices with the ground soldered to thermal vias in a multilayer
2S2P PCB per JESD51. Thermal resistance is measured from the die to the ambient air. The values provided are based
on the package body, die size, maximum power consumption, 85°C ambient temperature, and 125°C junction tempera-
ture of the die.
TABLE 9-7:         PACKAGE THERMAL RESISTANCE PARAMETERS
      Symbol                               °C/W                                 Velocity (Meter/s)
                                             33                                           0
         JA                                 29                                           1
                                             26                                          2.5
         JB                                 19                                           -
         JC                                3.5                                           -
         JT                                0.3                                           0
         JB                                 18                                           0
Use the following formulas to calculate the junction temperature:
TJ = P x JA + TA
TJ = P x JT + TT
TJ = P x JC + TC
TABLE 9-8:         PACKAGE THERMALS LEGEND
   Symbol                      Description
 TJ            Junction temperature
 P             Power dissipated
 JA           Junction-to-ambient-temperature
 JC           Junction-to-top-of-package
 JT           Junction-to-bottom-of-case
 TA            Ambient temperature
 TC            Temperature of the bottom of the case
 TT            Temperature of the top of the case
 2012 - 2019 Microchip Technology Inc.                                                       DS00001716C-page 43


USB4604
9.5      DC Specifications
TABLE 9-9:        DC ELECTRICAL CHARACTERISTICS
         Parameter          Symbol     MIN      TYP    MAX         Units             Notes
 IS Type Input Buffer
 Low Input Level              VIL      -0.3             0.8          V
 High Input Level             VIH       2.0             3.6          V
 I_RST Type Input Buffer
 Low Input Level              VIL      -0.3             0.4          V
 High Input Level             VIH      1.25             3.6          V
 I_SMB Type Input Buffer
 Low Input Level              VIL      -0.3            0.35          V
 High Input Level             VIH      1.25             3.6          V
 O8 Type Buffers
 Low Output Level            VOL                        0.4          V             IOL = 8 mA
 High Output Level           VOH    VDD33 - 0.4                      V            IOH = -8 mA
 OD8 Type Buffer
 Low Output Level            VOL                        0.4          V             IOL = 8 mA
 O12 Type Buffers
 Low Output Level            VOL                        0.4          V            IOL = 12 mA
 High Output Level           VOH    VDD33 - 0.4                      V           IOH = -12 mA
 OD12 Type Buffer
 Low Output Level            VOL                        0.4          V            IOL = 12 mA
 HSIC Type Buffers
 Low Input Level              VIL      -0.3         0.35*VDD12       V
 High Input Level             VIH   0.65*VDD12      VDD12+0.3        V
 Low Output Level            VOL                    0.25*VDD12       V
 High Output Level           VOH    0.75*VDD12                       V
 ICLK Type Buffer
 (XTAL1/REFCLK Input)
 Low Input Level              VIL      -0.3            0.35          V
 High Input Level             VIH       0.8             3.6          V
DS00001716C-page 44                                            2012 - 2019 Microchip Technology Inc.


                                                                                                    USB4604
9.6        AC Specifications
This section details the various AC timing specifications of the device.
9.6.1         POWER-ON CONFIGURATION STRAP VALID TIMING
Figure 9-2 illustrates the configuration strap timing requirements, in relation to power-on, for applications where
RESET_N is not used at power-on. The operational levels (Vopp) for the external power supplies are detailed in Section
9.2, "Operating Conditions**," on page 40.
  Note:       For RESET_N configuration strap timing requirements, refer to Section 9.6.2, "Reset and Configuration
              Strap Timing," on page 45.
FIGURE 9-2:              POWER-ON CONFIGURATION STRAP VALID TIMING
      All External            Vopp
 Power Supplies
                                               tcsh
    Configuration
              Straps
TABLE 9-10:         POWER-ON CONFIGURATION STRAP VALID TIMING
    Symbol                               Description                           MIN         TYP       MAX       Units
       tcsh       Configuration strap hold after external power supplies at      1                              ms
                  operational levels
9.6.2         RESET AND CONFIGURATION STRAP TIMING
Figure 9-3 illustrates the RESET_N timing requirements and its relation to the configuration strap signals. Assertion of
RESET_N is not a requirement. However, if used, it must be asserted for the minimum period specified.
Refer to Section 8.4, "Resets," on page 37 for additional information on resets. Refer to Section 6.3, "Device Configu-
ration Straps," on page 25 for additional information on configuration straps.
FIGURE 9-3:              RESET_N CONFIGURATION STRAP TIMING
                                              trstia
      RESET_N
                                                                       tcsh
  Configuration
             Straps
TABLE 9-11:         RESET_N CONFIGURATION STRAP TIMING
    Symbol                               Description                           MIN         TYP       MAX       Units
      trstia      RESET_N input assertion time                                   5                               us
       tcsh       Configuration strap hold after RESET_N deassertion             1                              ms
 2012 - 2019 Microchip Technology Inc.                                                           DS00001716C-page 45


USB4604
9.6.3        USB TIMING
All device USB signals conform to the voltage, power, and timing characteristics/specifications as set forth in the Uni-
versal Serial Bus Specification. Please refer to the Universal Serial Bus Specification, Revision 2.0, available at http://
www.usb.org.
9.6.4        HSIC TIMING
All device HSIC signals conform to the voltage, power, and timing characteristics/specifications as set forth in the High-
Speed Inter-Chip USB Electrical Specification. Please refer to the High-Speed Inter-Chip USB Electrical Specification,
Version 1.0, available at http://www.usb.org.
9.6.5        SMBUS TIMING
All device SMBus signals conform to the voltage, power, and timing characteristics/specifications as set forth in the Sys-
tem Management Bus Specification. Please refer to the System Management Bus Specification, Version 1.0, available
at http://smbus.org/specs.
9.6.6        I2C TIMING
All device I2C signals conform to the 100KHz Standard Mode (Sm) voltage, power, and timing characteristics/specifica-
tions as set forth in the I2C-Bus Specification. Please refer to the I2C-Bus Specification, available at http://www.nxp.com.
9.6.7        SPI TIMING
The following specifies the SPI timing requirements for the device.
FIGURE 9-4:               SPI TIMING
                                                                                       tceh
           SPI_CE_N
                                                    tcel                        tfc
             SPI_CLK
                                                                           tclq                  tdh
                 SPI_DI
                                                         tos toh
                                                                         tov        toh
               SPI_DO
   Note:     The SPI can be configured for 30 MHz or 60 MHz operation via the SPI_SPD_SEL configuration strap. 30
             MHz operation timing values are shown in Table 9-12. 60 MHz operation timing values are shown in
             Table 9-13.
DS00001716C-page 46                                                                    2012 - 2019 Microchip Technology Inc.


                                                                                                     USB4604
TABLE 9-12:         SPI TIMING VALUES (30 MHZ OPERATION)
     Symbol                              Description                            MIN        TYP        MAX       Units
         tfc      Clock frequency                                                                       30       MHz
        tceh      Chip enable (SPI_CE_EN) high time                             100                               ns
        tclq      Clock to input data                                                                   13        ns
         tdh      Input data hold time                                           0                                ns
         tos      Output setup time                                              5                                ns
         toh      Output hold time                                               5                                ns
         tov      Clock to output valid                                          4                                ns
        tcel      Chip enable (SPI_CE_EN) low to first clock                     12                               ns
        tceh      Last clock to chip enable (SPI_CE_EN) high                     12                               ns
TABLE 9-13:         SPI TIMING VALUES (60 MHZ OPERATION)
     Symbol                              Description                            MIN        TYP        MAX       Units
         tfc      Clock frequency                                                                       60       MHz
        tceh      Chip enable (SPI_CE_EN) high time                              50                               ns
        tclq      Clock to input data                                                                   9         ns
         tdh      Input data hold time                                           0                                ns
         tos      Output setup time                                              5                                ns
         toh      Output hold time                                               5                                ns
         tov      Clock to output valid                                          4                                ns
        tcel      Chip enable (SPI_CE_EN) low to first clock                     12                               ns
        tceh      Last clock to chip enable (SPI_CE_EN) high                     12                               ns
9.7          Clock Specifications
The device can accept either a 24 MHz crystal or a 24 MHz single-ended clock oscillator input. If the single-ended clock
oscillator method is implemented, XTAL1 should be left unconnected and REFCLK should be driven with a clock that
adheres to the specifications outlined in Section 9.7.2, "External Reference Clock (REFCLK)".
9.7.1          OSCILLATOR/CRYSTAL
It is recommended that a crystal utilizing matching parallel load capacitors be used for the crystal input/output signals
(XTAL1I/XTAL2). See Table 9-14 for the recommended crystal specifications.
TABLE 9-14:         CRYSTAL SPECIFICATIONS
               Parameter                 Symbol           MIN          NOM            MAX         Units       Notes
 Crystal Cut                                                        AT, typ
 Crystal Oscillation Mode                                     Fundamental Mode
 Crystal Calibration Mode                                  Parallel Resonant Mode
 Frequency                                Ffund            -          24.000            -          MHz
 Total Allowable PPM Budget                                -              -          +/-350        PPM
                                                                                                    oC
 Operating Temperature Range                           Note 9-1           -         Note 9-2
    Note 9-1      0oC for commercial version, -40oC for industrial version.
    Note 9-2      +70oC for commercial version, +85oC for industrial version.
 2012 - 2019 Microchip Technology Inc.                                                            DS00001716C-page 47


USB4604
9.7.2       EXTERNAL REFERENCE CLOCK (REFCLK)
The following input clock specifications are suggested:
• 24 MHz  350 PPM
  Note:     The external clock is recommended to conform to the signalling levels designated in the JEDEC specifica-
            tion on 1.2V CMOS Logic. XTAL2 should be treated as a no connect when an external clock is supplied.
DS00001716C-page 48                                                               2012 - 2019 Microchip Technology Inc.


                                                                                                                                          USB4604
10.0      PACKAGE OUTLINE
  Note:     For the most current package drawings, please see the Microchip Packaging Specification located at
            http://www.microchip.com/packaging.
FIGURE 10-1:           48-SQFN PACKAGE DRAWING
                                                                                           Note: For the most current package drawings,
                                                                                           see the Microchip Packaging Specification at
                                                                                           http://www.microchip.com/packaging
 2012 - 2019 Microchip Technology Inc.                                                                                     DS00001716C-page 49


USB4604
APPENDIX A:         DATA SHEET REVISION HISTORY
TABLE A-1:      REVISION HISTORY
 REVISION LEVEL
       & DATE               SECTION/FIGURE/ENTRY                             CORRECTION
   DS00001716C      Section 9.4, "Package Thermal        Added table number title to: Table 9-7, "Package
      (9-08-19)     Specifications"                      Thermal Resistance Parameters"
   DS00001716B      Product Identification System        Added “Direction of Unreeling”, pin 1 drawing.
      (7-26-19)
                    Section 9.4, "Package Thermal        Updated Table 9-7, "Package Thermal Resistance
                    Specifications"                      Parameters"
  USB4604 Revision A replaces the previous SMSC version, revision 1.1
       Rev. 1.1     Ordering Codes, Intro                Added new “-1070” ordering option and detailed the
     (03-06-14)                                          differences between -1080 and -1070 (Hub
                                                         Controller Enabled/Disabled).
       Rev. 1.1     SMBus Runtime Registers              Register definitions removed. These definitions are
     (12-06-13)                                          provided in application note AN 26.18 “SMBus Slave
                                                         Interface for the USB253x/USB3x13/USB46x4”.
       Rev. 1.1     Table 9-9, “DC Electrical            Updated ICLK VIH max from “VDDCR12” to “3.6”
     (09-24-13)     Characteristics,” on page 44
                    Section 9.7.2, "External Reference   Removed 50% duty cycle requirement.
                    Clock (REFCLK)," on page 48
       Rev. 1.0     Initial Release
     (06-17-13)
DS00001716C-page 50                                                         2012 - 2019 Microchip Technology Inc.


                                                                                                        USB4604
THE MICROCHIP WEB SITE
Microchip provides online support via our WWW site at www.microchip.com. This web site is used as a means to make
files and information easily available to customers. Accessible by using your favorite Internet browser, the web site con-
tains the following information:
• Product Support – Data sheets and errata, application notes and sample programs, design resources, user’s
    guides and hardware support documents, latest software releases and archived software
• General Technical Support – Frequently Asked Questions (FAQ), technical support requests, online discussion
    groups, Microchip consultant program member listing
• Business of Microchip – Product selector and ordering guides, latest Microchip press releases, listing of semi-
    nars and events, listings of Microchip sales offices, distributors and factory representatives
CUSTOMER CHANGE NOTIFICATION SERVICE
Microchip’s customer notification service helps keep customers current on Microchip products. Subscribers will receive
e-mail notification whenever there are changes, updates, revisions or errata related to a specified product family or
development tool of interest.
To register, access the Microchip web site at www.microchip.com. Under “Support”, click on “Customer Change Notifi-
cation” and follow the registration instructions.
CUSTOMER SUPPORT
Users of Microchip products can receive assistance through several channels:
•   Distributor or Representative
•   Local Sales Office
•   Field Application Engineer (FAE)
•   Technical Support
Customers should contact their distributor, representative or field application engineer (FAE) for support. Local sales
offices are also available to help customers. A listing of sales offices and locations is included in the back of this docu-
ment.
Technical support is available through the web site at: http://www.microchip.com/support
 2012 - 2019 Microchip Technology Inc.                                                               DS00001716C-page 51


USB4604
PRODUCT IDENTIFICATION SYSTEM
To order or obtain information, e.g., on pricing or delivery, refer to the factory or the listed sales office.
          PART NO.           [X]       -     XXX      -         [X](1)                  Examples:
            Device     Temperature        Package        Tape and Reel                  a)     USB4604-1080HN, Commercial Temp
                         Range                               Option                            48-pin SQFN Pkg., Tray
                                                                                        b)     USB4604-1070HN, Commercial Temp
                                                                                               48-pin SQFN Pkg., Tray
  Device:              USB4604, USB4604i
                                                                                        c)     USB4604-1080HN-TR, Commercial Temp
                                                                                               48-pin SQFN Pkg., Tape & Reel
  Temperature          Blank    = 0C to +70C Commercial                               d)     USB4604-1070HN-TR, Commercial Temp
  Range:               i        = -40C to+85C Industrial                                     48-pin SQFN Pkg., Tape & Reel
                                                                                        e)     USB4604i-1080HN, Industrial Temp
                                                                                               48-pin SQFN Pkg., Tray
  Package:             1080HN = 48-pin SQFN (Hub Controller Enabled)
                                                                                        f)     USB4604i-1070HN, Industrial Temp
                       1070HN = 48-pin SQFN (Hub Controller Disabled)
                                                                                               48-pin SQFN Pkg., Tray
                                                                                        g)     USB4604i-1080HN-TR, Industrial Temp
  Tape and Reel        Blank   = Standard packaging (tray)                                     48-pin SQFN Pkg., Tape & Reel
  Option:              TR      = Tape and Reel(1)                                       h)     USB4604i-1070HN-TR, Industrial Temp
                                                                                               48-pin SQFN Pkg., Tape & Reel
                                                                                        Note 1:    Tape and Reel identifier only appears in the
                                                                                                   catalog part number description. This identifier
                                                                                                   is used for ordering purposes and is not
                                                                                                   printed on the device package. Check with
                                                                                                   your Microchip Sales Office for package
                                                                                                   availability with the Tape and Reel option.
                                                                                                   Reel size is 4,000.
DS00001716C-page 52                                                                                 2012 - 2019 Microchip Technology Inc.


                                                               USB4604
PREVIOUS VERSION ORDERING INFORMATION:
                                              TEMPERATURE
                           ORDER NUMBER           RANGE       PACKAGE TYPE
 USB4604-1080HN (Hub Controller Enabled)
                                                0°C to +70°C     48-pin SQFN
 USB4604-1070HN (Hub Controller Disabled)
 USB4604-1080HN-TR (Hub Controller Enabled)
                                                                 48-pin SQFN
                                                0°C to +70°C    (Tape & Reel)
 USB4604-1070HN-TR (Hub Controller Disabled)
 USB4604i-1080HN (Hub Controller Enabled)
                                               -40°C to +85°C    48-pin SQFN
 USB4604i-1070HN (Hub Controller Disabled)
 USB4604i-1080HN-TR (Hub Controller Enabled)
                                                                 48-pin SQFN
                                               -40°C to +85°C   (Tape & Reel)
 USB4604i-1070HN-TR (Hub Controller Disabled)
 2012 - 2019 Microchip Technology Inc.                       DS00001716C-page 53


USB4604
    Note the following details of the code protection feature on Microchip devices:
    •     Microchip products meet the specification contained in their particular Microchip Data Sheet.
    •     Microchip believes that its family of products is one of the most secure families of its kind on the market today, when used in the
          intended manner and under normal conditions.
    •     There are dishonest and possibly illegal methods used to breach the code protection feature. All of these methods, to our
          knowledge, require using the Microchip products in a manner outside the operating specifications contained in Microchip’s Data
          Sheets. Most likely, the person doing so is engaged in theft of intellectual property.
    •     Microchip is willing to work with the customer who is concerned about the integrity of their code.
    •     Neither Microchip nor any other semiconductor manufacturer can guarantee the security of their code. Code protection does not
          mean that we are guaranteeing the product as “unbreakable.”
    Code protection is constantly evolving. We at Microchip are committed to continuously improving the code protection features of our
    products. Attempts to break Microchip’s code protection feature may be a violation of the Digital Millennium Copyright Act. If such acts
    allow unauthorized access to your software or other copyrighted work, you may have a right to sue for relief under that Act.
    Information contained in this publication regarding device applications and the like is provided only for your convenience and may be super-
    seded by updates. It is your responsibility to ensure that your application meets with your specifications. MICROCHIP MAKES NO REP-
    RESENTATIONS OR WARRANTIES OF ANY KIND WHETHER EXPRESS OR IMPLIED, WRITTEN OR ORAL, STATUTORY OR
    OTHERWISE, RELATED TO THE INFORMATION, INCLUDING BUT NOT LIMITED TO ITS CONDITION, QUALITY, PERFORMANCE,
    MERCHANTABILITY OR FITNESS FOR PURPOSE. Microchip disclaims all liability arising from this information and its use. Use of Micro-
    chip devices in life support and/or safety applications is entirely at the buyer’s risk, and the buyer agrees to defend, indemnify and hold
    harmless Microchip from any and all damages, claims, suits, or expenses resulting from such use. No licenses are conveyed, implicitly or
    otherwise, under any Microchip intellectual property rights unless otherwise stated.
    Trademarks
    The Microchip name and logo, the Microchip logo, AnyRate, AVR, AVR logo, AVR Freaks, BitCloud, chipKIT, chipKIT logo, CryptoMemory,
    CryptoRF, dsPIC, FlashFlex, flexPWR, Heldo, JukeBlox, KeeLoq, Kleer, LANCheck, LINK MD, maXStylus, maXTouch, MediaLB, megaAVR,
    MOST, MOST logo, MPLAB, OptoLyzer, PIC, picoPower, PICSTART, PIC32 logo, Prochip Designer, QTouch, SAM-BA, SpyNIC, SST, SST
    Logo, SuperFlash, tinyAVR, UNI/O, and XMEGA are registered trademarks of Microchip Technology Incorporated in the U.S.A. and other
    countries.
    ClockWorks, The Embedded Control Solutions Company, EtherSynch, Hyper Speed Control, HyperLight Load, IntelliMOS, mTouch, Precision
    Edge, and Quiet-Wire are registered trademarks of Microchip Technology Incorporated in the U.S.A.
    Adjacent Key Suppression, AKS, Analog-for-the-Digital Age, Any Capacitor, AnyIn, AnyOut, BodyCom, CodeGuard, CryptoAuthentication,
    CryptoAutomotive, CryptoCompanion, CryptoController, dsPICDEM, dsPICDEM.net, Dynamic Average Matching, DAM, ECAN, EtherGREEN,
    In-Circuit Serial Programming, ICSP, INICnet, Inter-Chip Connectivity, JitterBlocker, KleerNet, KleerNet logo, memBrain, Mindi, MiWi,
    motorBench, MPASM, MPF, MPLAB Certified logo, MPLIB, MPLINK, MultiTRAK, NetDetach, Omniscient Code Generation, PICDEM,
    PICDEM.net, PICkit, PICtail, PowerSmart, PureSilicon, QMatrix, REAL ICE, Ripple Blocker, SAM-ICE, Serial Quad I/O, SMART-I.S., SQI,
    SuperSwitcher, SuperSwitcher II, Total Endurance, TSHARC, USBCheck, VariSense, ViewSpan, WiperLock, Wireless DNA, and ZENA are
    trademarks of Microchip Technology Incorporated in the U.S.A. and other countries.
    SQTP is a service mark of Microchip Technology Incorporated in the U.S.A.
    Silicon Storage Technology is a registered trademark of Microchip Technology Inc. in other countries.
    GestIC is a registered trademark of Microchip Technology Germany II GmbH & Co. KG, a subsidiary of Microchip Technology Inc., in other
    countries.
    All other trademarks mentioned herein are property of their respective companies.
    © 2012 - 2019, Microchip Technology Incorporated, Printed in the U.S.A., All Rights Reserved.
    ISBN: 9781522445142
     QUALITY MANAGEMENT SYSTEM                                                       Microchip received ISO/TS-16949:2009 certification for its worldwide
                                                                                     headquarters, design and wafer fabrication facilities in Chandler and
                                                                                     Tempe, Arizona; Gresham, Oregon and design centers in California
                    CERTIFIED BY DNV                                                 and India. The Company’s quality system processes and procedures
                                                                                     are for its PIC® MCUs and dsPIC® DSCs, KEELOQ® code hopping
              == ISO/TS 16949 ==                                                     devices, Serial EEPROMs, microperipherals, nonvolatile memory and
                                                                                     analog products. In addition, Microchip’s quality system for the design
                                                                                     and manufacture of development systems is ISO 9001:2000 certified.
DS00001716C-page 54                                                                                  2012 - 2019 Microchip Technology Inc.


                                 Worldwide Sales and Service
AMERICAS                         ASIA/PACIFIC          ASIA/PACIFIC            EUROPE
Corporate Office                 Australia - Sydney    India - Bangalore       Austria - Wels
2355 West Chandler Blvd.         Tel: 61-2-9868-6733   Tel: 91-80-3090-4444    Tel: 43-7242-2244-39
Chandler, AZ 85224-6199          China - Beijing       India - New Delhi       Fax: 43-7242-2244-393
Tel: 480-792-7200                Tel: 86-10-8569-7000  Tel: 91-11-4160-8631    Denmark - Copenhagen
Fax: 480-792-7277                                                              Tel: 45-4450-2828
                                 China - Chengdu       India - Pune
Technical Support:                                                             Fax: 45-4485-2829
                                 Tel: 86-28-8665-5511  Tel: 91-20-4121-0141
http://www.microchip.com/
                                 China - Chongqing     Japan - Osaka           Finland - Espoo
support
                                 Tel: 86-23-8980-9588  Tel: 81-6-6152-7160     Tel: 358-9-4520-820
Web Address:
www.microchip.com                China - Dongguan      Japan - Tokyo           France - Paris
                                 Tel: 86-769-8702-9880 Tel: 81-3-6880- 3770    Tel: 33-1-69-53-63-20
Atlanta                                                                        Fax: 33-1-69-30-90-79
Duluth, GA                       China - Guangzhou     Korea - Daegu
Tel: 678-957-9614                Tel: 86-20-8755-8029  Tel: 82-53-744-4301     Germany - Garching
                                                                               Tel: 49-8931-9700
Fax: 678-957-1455                China - Hangzhou      Korea - Seoul
                                 Tel: 86-571-8792-8115 Tel: 82-2-554-7200      Germany - Haan
Austin, TX
                                                                               Tel: 49-2129-3766400
Tel: 512-257-3370                China - Hong Kong SAR Malaysia - Kuala Lumpur
                                 Tel: 852-2943-5100    Tel: 60-3-7651-7906     Germany - Heilbronn
Boston
                                                                               Tel: 49-7131-67-3636
Westborough, MA                  China - Nanjing       Malaysia - Penang
Tel: 774-760-0087                Tel: 86-25-8473-2460  Tel: 60-4-227-8870      Germany - Karlsruhe
Fax: 774-760-0088                                                              Tel: 49-721-625370
                                 China - Qingdao       Philippines - Manila
Chicago                          Tel: 86-532-8502-7355 Tel: 63-2-634-9065      Germany - Munich
Itasca, IL                                                                     Tel: 49-89-627-144-0
                                 China - Shanghai      Singapore
Tel: 630-285-0071                                                              Fax: 49-89-627-144-44
                                 Tel: 86-21-3326-8000  Tel: 65-6334-8870
Fax: 630-285-0075                                                              Germany - Rosenheim
                                 China - Shenyang      Taiwan - Hsin Chu
Dallas                                                                         Tel: 49-8031-354-560
                                 Tel: 86-24-2334-2829  Tel: 886-3-577-8366
Addison, TX                                                                    Israel - Ra’anana
                                 China - Shenzhen      Taiwan - Kaohsiung
Tel: 972-818-7423                                                              Tel: 972-9-744-7705
                                 Tel: 86-755-8864-2200 Tel: 886-7-213-7830
Fax: 972-818-2924                                                              Italy - Milan
                                 China - Suzhou        Taiwan - Taipei
Detroit                                                                        Tel: 39-0331-742611
                                 Tel: 86-186-6233-1526 Tel: 886-2-2508-8600
Novi, MI                                                                       Fax: 39-0331-466781
Tel: 248-848-4000                China - Wuhan         Thailand - Bangkok
                                 Tel: 86-27-5980-5300  Tel: 66-2-694-1351      Italy - Padova
Houston, TX                                                                    Tel: 39-049-7625286
Tel: 281-894-5983                China - Xian          Vietnam - Ho Chi Minh
                                 Tel: 86-29-8833-7252  Tel: 84-28-5448-2100    Netherlands - Drunen
Indianapolis                                                                   Tel: 31-416-690399
Noblesville, IN                  China - Xiamen                                Fax: 31-416-690340
                                 Tel: 86-592-2388138
Tel: 317-773-8323                                                              Norway - Trondheim
Fax: 317-773-5453                China - Zhuhai                                Tel: 47-7288-4388
Tel: 317-536-2380                Tel: 86-756-3210040
                                                                               Poland - Warsaw
Los Angeles                                                                    Tel: 48-22-3325737
Mission Viejo, CA
                                                                               Romania - Bucharest
Tel: 949-462-9523                                                              Tel: 40-21-407-87-50
Fax: 949-462-9608
Tel: 951-273-7800                                                              Spain - Madrid
                                                                               Tel: 34-91-708-08-90
Raleigh, NC                                                                    Fax: 34-91-708-08-91
Tel: 919-844-7510
                                                                               Sweden - Gothenberg
New York, NY                                                                   Tel: 46-31-704-60-40
Tel: 631-435-6000
                                                                               Sweden - Stockholm
San Jose, CA                                                                   Tel: 46-8-5090-4654
Tel: 408-735-9110
Tel: 408-436-4270                                                              UK - Wokingham
                                                                               Tel: 44-118-921-5800
Canada - Toronto                                                               Fax: 44-118-921-5820
Tel: 905-695-1980
Fax: 905-695-2078
                                                                                                 08/15/18
       2012 - 2019 Microchip Technology Inc.                                              DS00001716C-page 55


Mouser Electronics
Authorized Distributor
Click to View Pricing, Inventory, Delivery & Lifecycle Information:
Microchip:
 USB4604-1080HN USB4604I-1080HN
